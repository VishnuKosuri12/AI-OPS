var e=globalThis.parcelRequired477,t=e.register;t("bqMS3",function(t,i){var s=e("dwp40"),n=e("jSnXV");let r=()=>({params:{},headers:{}});class o{subscribe(e,t,i,s,n,r){t&&this.changeListeners.set(e,t),i&&this.errListeners.set(e,i),s&&this.infoListeners.set(e,s),n&&this.allResultsListeners.set(e,n),r&&this.analyticsListeners.set(e,r)}unsubscribe(e){this.changeListeners.delete(e),this.errListeners.delete(e),this.infoListeners.delete(e),this.allResultsListeners.delete(e),this.analyticsListeners.delete(e)}constructor(){this.changeListeners=void 0,this.errListeners=void 0,this.infoListeners=void 0,this.allResultsListeners=void 0,this.analyticsListeners=void 0,this.changeListeners=new Map,this.allResultsListeners=new Map,this.errListeners=new Map,this.infoListeners=new Map,this.analyticsListeners=new Map}}class a extends o{shouldHighlightMention(e){return!1}filter(e){throw Error(`not yet implemented.
Params: query=${e}`)}recordMentionSelection(e){}isFiltering(e){return!1}_notifyListeners(t,i){(0,e("jaPjp").default)("ak-mention-resource._notifyListeners",t&&t.mentions&&t.mentions.length,this.changeListeners),this.changeListeners.forEach((s,n)=>{try{s(t.mentions.slice(0,20),t.query,i)}catch(t){(0,e("jaPjp").default)(`error from listener '${n}', ignoring`,t)}})}_notifyAllResultsListeners(t){(0,e("jaPjp").default)("ak-mention-resource._notifyAllResultsListeners",t&&t.mentions&&t.mentions.length,this.changeListeners),this.allResultsListeners.forEach((i,s)=>{try{i(t.mentions.slice(0,20),t.query)}catch(t){(0,e("jaPjp").default)(`error from listener '${s}', ignoring`,t)}})}_notifyErrorListeners(t,i){this.errListeners.forEach((s,n)=>{try{s(t,i)}catch(t){(0,e("jaPjp").default)(`error from listener '${n}', ignoring`,t)}})}_notifyInfoListeners(t){this.infoListeners.forEach((i,s)=>{try{i(t)}catch(t){(0,e("jaPjp").default)(`error from listener '${s}', ignoring`,t)}})}_notifyAnalyticsListeners(t,i,s,n){this.analyticsListeners.forEach((r,o)=>{try{r(t,i,s,n)}catch(t){(0,e("jaPjp").default)(`error from listener '${o}', ignoring`,t)}})}}var c=class extends a{shouldHighlightMention(e){return!!this.config.shouldHighlightMention&&this.config.shouldHighlightMention(e)}notify(t,i,s){if(t>this.lastReturnedSearch)this.lastReturnedSearch=t,this._notifyListeners(i,{duration:Date.now()-t});else{let i=new Date(t).toISOString().substr(17,6);(0,e("jaPjp").default)("Stale search result, skipping",i,s)}this._notifyAllResultsListeners(i)}notifyError(e,t){this._notifyErrorListeners(e,t),t&&this.activeSearches.delete(t)}async filter(e,t){try{let i,s=Date.now();if(e){this.activeSearches.add(e);let s=this.search(e,t);i=await s.mentions}else i=await this.initialState(t);this.notify(s,i,e)}catch(t){this.notifyError(t,e)}}isFiltering(e){return this.activeSearches.has(e)}resolveMentionName(t){return this.config.mentionNameResolver?this.config.mentionNameResolver.lookupName(t):{id:t,name:"",status:e("6mYMS").MentionNameStatus.UNKNOWN}}cacheMentionName(e,t){this.config.mentionNameResolver&&this.config.mentionNameResolver.cacheName(e,t)}supportsMentionNameResolving(){return!!this.config.mentionNameResolver}updateActiveSearches(e){this.activeSearches.add(e)}verifyMentionConfig(e){if(!e.url)throw Error("config.url is a required parameter");e.securityProvider||(e.securityProvider=r)}initialState(e){return this.remoteInitialState(e)}clearContext(e={}){return Object.keys(e).filter(t=>e[t]).reduce((t,i)=>({[i]:e[i],...t}),{})}getQueryParams(e){let t={};return this.config.containerId&&(t.containerId=this.config.containerId),this.config.productId&&(t.productIdentifier=this.config.productId),{...t,...this.clearContext(e)}}async remoteInitialState(t){let i=this.getQueryParams(t);try{let t=await s.utils.requestService(this.config,{path:"bootstrap",queryParams:i});return this._notifyAnalyticsListeners(e("3jsXx").SLI_EVENT_TYPE,e("6mYMS").SliNames.INITIAL_STATE,e("6mYMS").Actions.SUCCEEDED),this.transformServiceResponse(t,"")}catch(t){throw this._notifyAnalyticsListeners(e("3jsXx").SLI_EVENT_TYPE,e("6mYMS").SliNames.INITIAL_STATE,e("6mYMS").Actions.FAILED),t}}search(e,t){return{mentions:this.remoteSearch(e,t)}}async remoteSearch(t,i){let n={path:"search",queryParams:{query:t,limit:100,...this.getQueryParams(i)}};try{let i=await s.utils.requestService(this.config,n);return this._notifyAnalyticsListeners(e("3jsXx").SLI_EVENT_TYPE,e("6mYMS").SliNames.SEARCH,e("6mYMS").Actions.SUCCEEDED),this.transformServiceResponse(i,t)}catch(t){throw this._notifyAnalyticsListeners(e("3jsXx").SLI_EVENT_TYPE,e("6mYMS").SliNames.SEARCH,e("6mYMS").Actions.FAILED),t}}transformServiceResponse(t,i){let s=t.mentions.map(t=>{let s;return(0,e("6mYMS").isAppMention)(t)?s=t.userType:(0,e("6mYMS").isTeamMention)(t)&&(s=t.userType),{...t,lozenge:s,query:i}});return{...t,mentions:s,query:t.query||i}}constructor(e){super(),this.config=void 0,this.lastReturnedSearch=void 0,this.activeSearches=void 0,this.productName=void 0,this.shouldEnableInvite=void 0,this.userRole=void 0,this.onInviteItemClick=void 0,this.inviteXProductUser=void 0,this.verifyMentionConfig(e),this.config=e,this.lastReturnedSearch=0,this.activeSearches=new Set,this.productName=e.productName,this.shouldEnableInvite=!!e.shouldEnableInvite,this.onInviteItemClick=e.onInviteItemClick,this.inviteXProductUser=e.inviteXProductUser,this.userRole=e.userRole||"basic",this.config.debounceTime&&(this.filter=(n&&n.__esModule?n.default:n)(this.filter,this.config.debounceTime))}};t.exports.AbstractResource=o,t.exports.AbstractMentionResource=a,t.exports.isResolvingMentionProvider=e=>!!(e&&e.supportsMentionNameResolving&&e.supportsMentionNameResolving()),t.exports.default=c}),t("6mYMS",function(e,t){var i,s,n,r,o,a,c,l=((i={})[i.SELF=0]="SELF",i[i.RESTRICTED=1]="RESTRICTED",i[i.DEFAULT=2]="DEFAULT",i),h=((s={})[s.NONE=0]="NONE",s[s.SITE=1]="SITE",s[s.APPLICATION=2]="APPLICATION",s[s.CONTAINER=3]="CONTAINER",s),u=((n={})[n.DEFAULT=0]="DEFAULT",n[n.SPECIAL=1]="SPECIAL",n[n.APP=2]="APP",n[n.TEAM=3]="TEAM",n[n.SYSTEM=4]="SYSTEM",n),E=((r={}).SEARCH="searchUser",r.SEARCH_TEAM="searchTeam",r.INITIAL_STATE="initialState",r.SELECT="select",r.SELECT_TEAM="selectTeam",r),m=((o={}).TYPEAHEAD="mentionTypeahead",o.MENTION="mention",o),p=((a={}).VIEWED="viewed",a.CLICKED="clicked",a.CLOSED="closed",a.SUCCEEDED="succeeded",a.FAILED="failed",a),f=((c={})[c.UNKNOWN=0]="UNKNOWN",c[c.SERVICE_ERROR=1]="SERVICE_ERROR",c[c.OK=2]="OK",c);e.exports.MentionType=l,e.exports.UserAccessLevel=h,e.exports.UserType=u,e.exports.SliNames=E,e.exports.ComponentNames=m,e.exports.Actions=p,e.exports.MentionNameStatus=f,e.exports.isRestricted=function(e){return!!e&&e===h[0]},e.exports.isSpecialMention=function(e){return!!e.userType&&e.userType===u[1]},e.exports.isAppMention=function(e){return e.userType&&e.userType===u[2]},e.exports.isTeamMention=function(e){return e.userType&&e.userType===u[3]},e.exports.isSpecialMentionText=function(e){return e&&("@all"===e||"@here"===e)},e.exports.isPromise=e=>!!(e&&e.then)}),t("jaPjp",function(e,t){function i(e,...t){}Object.defineProperty(e.exports,"default",{get:()=>i,set:void 0,enumerable:!0,configurable:!0})}),t("3jsXx",function(t,i){var s=e("7TH2w");let n="platform-pkg",r="0.0.0-use.local",o=(t,i,o)=>({action:i,actionSubject:t,eventType:s.OPERATIONAL_EVENT_TYPE,attributes:{packageName:n,packageVersion:r,componentName:e("6mYMS").ComponentNames.MENTION,...o}});t.exports.SLI_EVENT_TYPE="sli",t.exports.SMART_EVENT_TYPE="smart",t.exports.fireAnalyticsMentionTypeaheadEvent=t=>(i,o,a=[],c)=>{if(t.createAnalyticsEvent){let l={action:i,actionSubject:e("6mYMS").ComponentNames.TYPEAHEAD,attributes:{packageName:n,packageVersion:r,componentName:e("6mYMS").ComponentNames.MENTION,duration:Math.round(o),userIds:a,queryLength:c?c.length:0},eventType:s.OPERATIONAL_EVENT_TYPE};t.createAnalyticsEvent(l).fire(e("ElsUb").ELEMENTS_CHANNEL)}},t.exports.fireAnalyticsMentionEvent=t=>(i,o,a,c,l)=>{let h=t({action:o,actionSubject:i,eventType:s.UI_EVENT_TYPE,attributes:{packageName:n,packageVersion:r,componentName:e("6mYMS").ComponentNames.MENTION,accessLevel:l,isSpecial:(0,e("6mYMS").isSpecialMentionText)(a),userId:c}});return h.fire(e("ElsUb").ELEMENTS_CHANNEL),h},t.exports.fireSliAnalyticsEvent=t=>(i,s)=>{if(t.createAnalyticsEvent){let n=o(i,s);t.createAnalyticsEvent(n).fire(e("ElsUb").ELEMENTS_CHANNEL)}},t.exports.fireAnalyticsMentionHydrationEvent=t=>(i,o,a,c)=>{if(t.createAnalyticsEvent){let l={action:i,actionSubject:e("6mYMS").ComponentNames.MENTION,actionSubjectId:"hydration",attributes:{packageName:n,packageVersion:r,componentName:e("6mYMS").ComponentNames.MENTION,userId:o,fromCache:a,duration:Math.round(c)},eventType:s.OPERATIONAL_EVENT_TYPE};t.createAnalyticsEvent(l).fire(e("ElsUb").ELEMENTS_CHANNEL)}}}),t("ElsUb",function(e,t){e.exports.ELEMENTS_CHANNEL="fabric-elements"});
//# sourceMappingURL=mention.acd49770.js.map
