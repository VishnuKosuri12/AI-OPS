function e(e){return e&&e.__esModule?e.default:e}var t=globalThis.parcelRequired477,n=t.register;n("d54uY",function(n,r){var a,o=t("42omo"),s=t("67O0h"),i=t("32x2E"),c=t("b8XTE");let d=(0,t("cgtv4").defineMessages)({dismiss:{id:"admin-announcement-banner.dismiss.button",defaultMessage:"Dismiss admin announcement banner"},dismissText:{id:"admin-announcement-banner.dismiss.button.text",defaultMessage:"Close"}});var l=((a={}).ANNOUNCEMENT="announcement",a.INFO="info",a.NOTE="note",a.SUCCESS="success",a.WARNING="warning",a.ERROR="error",a);let u={announcement:"var(--ds-background-neutral-bold, #292A2E)",info:"var(--ds-background-accent-blue-bolder, #1868DB)",note:"var(--ds-background-accent-purple-bolder, #964AC0)",success:"var(--ds-background-accent-green-bolder, #1F845A)",warning:"var(--ds-background-accent-yellow-subtle, #EED12B)",error:"var(--ds-background-accent-red-bolder, #C9372C)"},m={announcement:"var(--ds-text-inverse, #FFFFFF)",info:"var(--ds-text-inverse, #FFFFFF)",note:"var(--ds-text-inverse, #FFFFFF)",success:"var(--ds-text-inverse, #FFFFFF)",warning:"var(--ds-text, #292A2E)",error:"var(--ds-text-inverse, #FFFFFF)"},p={announcement:"var(--ds-icon-inverse, #FFFFFF)",info:"var(--ds-icon-inverse, #FFFFFF)",note:"var(--ds-icon-inverse, #FFFFFF)",success:"var(--ds-icon-inverse, #FFFFFF)",warning:"var(--ds-icon, #292A2E)",error:"var(--ds-icon-inverse, #FFFFFF)"},E=(0,o.forwardRef)(({as:n="p",style:r,...a},s)=>{let{maxHeight:i,...c}=a;return e(o).createElement(n,{...c,style:{...r,"--_18ugtm3":(0,t("7sObp").default)(a.maxHeight)},ref:s,className:(0,t("gMc0m").default)(["_c71l8a77 _4t3i1wug _18m91wug _155a1rr0 _aayn1f0r _motwz6vj _1atkglyw _1ke819bv",a.className])})}),g=(0,o.forwardRef)(({as:n="div",style:r,...a},s)=>{let{textColor:i,linkDisabled:c,...d}=a;return e(o).createElement(n,{...d,style:{...r,"--_1qrlcdp":(0,t("7sObp").default)(a.textColor)},ref:s,className:(0,t("gMc0m").default)(["_1reo15vq _18m915vq _16jlkb7n _1o9zkb7n _i0dlf1ug _18s8s8vo _59381r31 _yha28stv _1nmznqa1 _bpspmoej _125xijt0 _43dsijt0 _p03cijt0 _oavvijt0 _oxk4ijt0 _1cayijt0",a.linkDisabled&&"_ru7vglyw _5lhm73ad",a.className])})}),A=(0,o.forwardRef)(({as:n="div",style:r,...a},s)=>{let{background:i,...c}=a;return e(o).createElement(n,{...c,style:{...r,"--_8jvb0j":(0,t("7sObp").default)(a.height),"--_146l9hq":(0,t("7sObp").default)(a.background)},ref:s,className:(0,t("gMc0m").default)(["_11q71i36 _1yt4s8vo _1e0c1txw _4cvr1h6o _4t3i1474",a.className])})}),_=(0,o.forwardRef)(({as:n="span",style:r,...a},s)=>{let{textColor:i,...c}=a;return e(o).createElement(n,{...c,style:{...r,"--_1qrlcdp":(0,t("7sObp").default)(a.textColor)},ref:s,className:(0,t("gMc0m").default)(["_syazijt0",a.className])})}),N=()=>{(0,o.useEffect)(()=>{(0,t("5Abqh").checkSSRPartialSuccess)(t("5Abqh").SSR_PARTIAL_COMPONENT.AdminAnnouncementBanner)&&t("3nZRM").ADMIN_ANNOUNCEMENT_BANNER_METRIC.markFMP((0,t("9eE57").getMark)("CFP-63.ssr-ttr"))},[])},f=(e,t)=>{let{buttonStyles:n,spinnerStyles:r}=e(t);return{buttonStyles:{...n,backgroundColor:"var(--ds-background-inverse-subtle, #00000029)","&:hover":{backgroundColor:"var(--ds-background-inverse-subtle-hovered, #0000003D)"},"&:active":{backgroundColor:"var(--ds-background-inverse-subtle-pressed, #00000052)"}},spinnerStyles:r}};n.exports.Appearance=l,n.exports.bannerBackgroundColors=u,n.exports.bannerIconColors=p,n.exports.AdminAnnouncementBannerComponent=({onClick:n,content:r,appearance:a,isDismissible:l,onDismiss:C,userId:T,cloudId:b,onError:S,onComplete:v,interactive:F=!0,shouldRenderMigratorPrompt:h=!1,isPreview:R=!1})=>{let{formatMessage:I}=(0,t("8C5kA").default)(),M=(0,o.useMemo)(()=>{let e=(0,i.getEmojiProvider)(t("ibzAc").default,{cloudId:b,userId:T});return t("4FxUL").default.create({emojiProvider:e})},[T,b]);N();let x=(0,t("7whYF").useMigratorPromptContent)(),y=(0,t("luv00").useSSRPlaceholderReplaceIdProp)(),D=(0,o.useCallback)(e=>{(0,t("5Abqh").setSSRPartialSuccess)(t("5Abqh").SSR_PARTIAL_COMPONENT.AdminAnnouncementBanner),v&&v(e)},[v]),k=h?x:r;return e(o).createElement(e(o).Fragment,null,e(o).createElement(A,{onClick:n,background:u[a],height:`${(0,t("ggElv").isBannerContentSingleLineFromDocNode)(k)?t("b3o7x").BANNER_HEIGHT_SINGLE_LINE:t("b3o7x").BANNER_HEIGHT_MULTI_LINE}px`,"data-vc":"admin-announcement-banner","data-testid":"admin-announcement-banner-component",...y,...R?{}:{role:"banner"}},e(o).createElement(e(t("6fjxX")),{spacing:"spacious",label:"",color:p[a]}),e(o).createElement(g,{textColor:m[a],linkDisabled:!F},e(o).createElement(s.default,{document:k,appearance:"comment",adfStage:"stage0",dataProviders:M,nodeComponents:{paragraph:n=>e(o).createElement(E,{...n,maxHeight:`${(0,t("ggElv").isCharacterCountSingleLine)((0,t("aTfTn").getCharacterCount)(n.content))?24:48}px`})},onComplete:D,onError:S})),l&&e(o).createElement(e(o).Fragment,null,e(o).createElement(t("4KS7f").default,{spacing:"compact","data-id":"ssr-dismiss-admin-announcement-button",onClick:C,isDisabled:!F,"aria-label":I(d.dismiss),theme:f},e(o).createElement(_,{textColor:m[a],"data-vc":"dismiss-button-text"},I(d.dismissText))))),e(o).createElement(c.PageSegmentLoadEnd,{metric:t("3nZRM").ADMIN_ANNOUNCEMENT_BANNER_METRIC}))}}),n("aTfTn",function(e,n){let r=["media","embedCard","blockCard","caption"],a=e=>!!e.content,o=e=>"text"===e.type,s=e=>!a(e)&&!o(e)&&"media"!==e.type,i=e=>-1!==r.indexOf(e.type),c=e=>e.reduce((e,t)=>{if(i(t));else if(a(t))return e+c(t.content);else if(o(t))return e+t.text.length;else if(s(t)&&"hardBreak"!==t.type)return e+1;return e},0),d=(e,t)=>{let n=0,r=0,a=0;return!function e(o){if(r===t&&(a=n),"caption"===o.type.name)n+=(o.content?.size??0)+1;else if(o.isText&&o.nodeSize)for(let e=0;e<o.nodeSize;e++)r===t&&(a=n),n++,r++;else if(o.isInline)n++,"hardBreak"!==o.type.name&&r++;else{for(let t of("doc"!==o.type.name&&n++,o.content?.content))e(t);"doc"!==o.type.name&&n++}}(e),{characterCount:r,breakPointPosition:a}};class l{subscribe(e){return this.subscriptions.push(e),e(this.lastChange),()=>this.subscriptions.filter(t=>t===e)}change(e){for(let t of(this.lastChange=e,this.subscriptions))t(e)}constructor(){this.subscriptions=[],this.lastChange=void 0}}class u{update(e){let t=m.getState(e.state);this.subscription.change(t)}constructor(e,t){this.editorView=void 0,this.subscription=void 0,this.initialized=!1,this.editorView=e,this.subscription=t}}let m=new(0,t("ks2lK").PluginKey)("content-overflow");e.exports.getCharacterCount=c,e.exports.contentOverflowPlugin=e=>{let n=new l;return{plugin:new(0,t("ks2lK").Plugin)({key:m,state:{init:()=>({isActive:!1,positions:{characterCount:0,breakPointPosition:0}}),apply:t=>{let n=d(t.doc,e);return n.characterCount>e?{isActive:!0,positions:n}:{isActive:!1,positions:n}}},props:{decorations(e){let{doc:n}=e,{isActive:r,positions:a}=m.getState(e);return r&&a?t("ftzrq").DecorationSet.create(n,[t("ftzrq").Decoration.inline(a.breakPointPosition,n.nodeSize,{class:"editor-content-overflow","data-testId":"editor-content-overflow"})]):null}},view:e=>new u(e,n)}),subscription:n}}}),n("edve5",function(e,t){e.exports.parseBannerContent=e=>{if(!e)return{};try{return JSON.parse(e)}catch{return{}}}}),n("2F3Ut",function(e,n){var r,a,o=((r={}).INVALID_NODE="invalidNode",r.EMPTY="empty",r.CHARACTER_OVERFLOW="characterOverflow",r);(a={}).START_AFTER_END_DATE="startAfterEndDate",a.START_AFTER_END_TIME="startAfterEndTime",a.END_BEFORE_START_DATE="endBeforeStartDate",a.END_BEFORE_START_TIME="endBeforeStartTime",a.START_DATE_CONFLICT="startDateConflict",a.START_TIME_CONFLICT="startTimeConflict",a.END_DATE_CONFLICT="endDateConflict",a.END_TIME_CONFLICT="endTimeConflict",e.exports.MAX_CONTENT_CHARACTER_COUNT_SINGLE_LINE=180,e.exports.MAX_TOTAL_CONTENT_CHARACTER_COUNT=4e3,e.exports.MAX_TITLE_CHARACTER_COUNT=40,e.exports.ContentValidationError=o,e.exports.validateTitle=e=>{if(!e||0===e.length||!e.replace(/\s/g,"").length)return"empty"},e.exports.validateContent=e=>{if(!e?.content)return"empty";if(1!==e.content.length||"paragraph"!==e.content[0].type)return"invalidNode";if(!e.content[0].content)return"empty";let n=(0,t("aTfTn").getCharacterCount)(e.content);if(0==n)return"empty";let r=(0,t("lcuos").filter)(e,e=>"text"===e.type);return 1===r.length&&0===r[0].text.trim().length?"empty":n>4e3?"characterOverflow":null}}),n("3nZRM",function(e,n){let r=(0,t("lSOAM").createPageSegmentLoadMetric)({key:t("jX1qB").ADMIN_ANNOUNCEMENT_BANNER_SEGMENT_KEY,ssr:window.__SSR_RENDERED__?{doneAsFmp:!0}:void 0});(0,t("lSOAM").createPageLoadMetric)({key:t("1UCmC").ADMIN_ANNOUNCEMENT_BANNER_SETTING_PAGE_LOAD_KEY}),e.exports.ADMIN_ANNOUNCEMENT_BANNER_METRIC=r}),n("b3o7x",function(e,n){var r=t("42omo");let a=t("1UApO").PERSISTED_KEYS_ON_SERVER.PERSISTED_ADMIN_ANNOUNCEMENT_BANNER,o=({cachedUpdatedAt:e,updatedAt:t})=>!!t&&e===t,s=({isLicensed:e,id:n,updatedAt:s})=>{let{storage:i,dismissStateKey:c,initialUpdatedAt:d}=(0,r.useMemo)(()=>e?{storage:t("17wUi").confluenceLocalStorageInstance,dismissStateKey:a,initialUpdatedAt:t("17wUi").confluenceLocalStorageInstance?.getItem(a)?.updatedAt}:{storage:t("17wUi").confluenceSessionStorageInstance,dismissStateKey:"admin.announcement.banner"},[e]),[l,u]=(0,r.useState)(o({cachedUpdatedAt:d,updatedAt:s}));return(0,r.useEffect)(()=>{s&&u(o({cachedUpdatedAt:i.getItem(c)?.updatedAt,updatedAt:s}))},[c,i,s]),{isDismissed:l,onDismiss:()=>{i.setItem(c,{id:n,updatedAt:s}),u(o({cachedUpdatedAt:i.getItem(c)?.updatedAt,updatedAt:s}))}}},i=({skip:e=!1}={})=>{let{createAnalyticsEvent:n}=(0,t("inPa6").useAnalyticsEvents)(),{isSiteAdmin:a}=(0,r.useContext)(t("1ytiN").SPAViewContext),o=e||!a,{cloudId:s}=(0,t("bQm3c").useSessionData)(),{data:i,loading:c,error:d}=(0,t("xQxzY").useQuery)((0,t("eSUdr").default)`query useMigratorPromptEligibleAABMigratorPromptQuery{adminAnnouncementBannerSettingsByCriteria(first:1 orderBy:DEFAULT isAscending:false){nodes{id}}}`,{skip:o}),{attributes:l,loading:u,error:m}=(0,t("kAcNG").useSitePersonalizationQuery)({cloudId:s,skip:o}),p=l?.reduce((e,t)=>({...e,[t.name]:t.value}),{}),E=p?.confluence_site_migration_completion_date,g=E?(0,t("4TIFs").default)(new Date(E),6):void 0,A=!!g&&(0,t("cTaz1").default)(g),_=c||u,N=(0,r.useMemo)(()=>d||m,[d,m]);(0,r.useEffect)(()=>{N&&((0,t("5ZqQS").getMonitoringClient)().submitError(N,{attribution:t("3IBnw").Attribution.ADMIN_EXPERIENCE}),(0,t("7Sm4c").markErrorAsHandled)(N))},[n,N]);let f=!!i?.adminAnnouncementBannerSettingsByCriteria?.nodes?.length;return{isMigratorPromptEligible:!o&&!_&&!N&&A&&!f,loading:_}},c=()=>"true"===String(t("17wUi").confluenceLocalStorageInstance?.getItem(t("1UApO").PERSISTED_KEYS_ON_SERVER.PERSISTED_ADMIN_ANNOUNCEMENT_BANNER_MIGRATOR_PROMPT)),d=()=>{let[e,n]=(0,r.useState)(c);return{isDismissed:e,onDismiss:(0,r.useCallback)(()=>{t("17wUi").confluenceLocalStorageInstance.setItem(t("1UApO").PERSISTED_KEYS_ON_SERVER.PERSISTED_ADMIN_ANNOUNCEMENT_BANNER_MIGRATOR_PROMPT,"true"),n(!0)},[])}},l=t("iwZYw").default,u="AdminAnnouncementBanner";e.exports.BANNER_HEIGHT_SINGLE_LINE=48,e.exports.BANNER_HEIGHT_MULTI_LINE=72,e.exports.useRegisterAdminAnnouncementBanner=function(e=null){let{isLicensed:n}=(0,t("bQm3c").useSessionData)(),r=(0,t("lfcs7").useIsPageEligibleForAdminAnnouncementBanner)(),{data:a,loading:o,error:c}=(0,t("jMyy4").useQueryInterop)(l,{skip:!r}),m=r&&(e?.state?.banners?.some(e=>e.name!==u)||void 0),{isMigratorPromptEligible:p,loading:E}=i({skip:!r||m||o||!!a?.adminAnnouncementBanner}),g=d(),A=s({isLicensed:n,id:a?.adminAnnouncementBanner?.id,updatedAt:a?.adminAnnouncementBanner?.updatedAt}),{isDismissed:_,onDismiss:N}=p?g:A,f=o||E,C=!!a?.adminAnnouncementBanner||p,T=!f&&!m&&!_,b=C&&T;if(b){let n=(0,t("ggElv").isBannerContentSingleLineFromJSONString)(a?.adminAnnouncementBanner?.content||"")?48:72;e?.show(u,n),(0,t("cbc8g").addUFOCustomData)({isAdminAnnouncementBannerDisplayed:!0})}else e?.hide(u);return{shouldRender:b,hasOtherBanners:m,onDismiss:N,data:a,loading:f,error:c,shouldRenderMigratorPrompt:p&&T}}}),n("lfcs7",function(e,n){e.exports.useIsPageEligibleForAdminAnnouncementBanner=()=>{let{edition:e}=(0,t("bQm3c").useSessionData)();return"PREMIUM"===e||"STANDARD"===e}}),n("7whYF",function(e,n){let r=(0,t("cgtv4").defineMessages)({promptContentText:{id:"admin-announcement-banner.migrator-prompt.content",defaultMessage:"Guess what, admins? You can use an announcement banner like this one to communicate important messages to all of your users at once."},promptLinkText:{id:"admin-announcement-banner.migrator-prompt.link",defaultMessage:"Create announcement banner"}}),a={id:"migratorPrompt",isDismissible:!0,appearance:"note",title:"Migrator Prompt AAB",updatedAt:new Date().toUTCString(),content:""};e.exports.migratorPromptWithEmptyContent=a,e.exports.useMigratorPromptContent=()=>{let{formatMessage:e}=(0,t("8C5kA").default)();return{version:1,type:"doc",content:[{type:"paragraph",content:[{type:"text",text:e(r.promptContentText)},{type:"text",text:" "},{type:"text",text:e(r.promptLinkText),marks:[{type:"link",attrs:{href:"/wiki/admin/announcements"}}]},{type:"text",text:"."}]}]}}}),n("bf6dp",function(e,n){e.exports.getLinks=e=>(0,t("lcuos").filter)(e,e=>(e.marks||[]).some(e=>"link"===e.type))}),n("k4L5H",function(e,n){e.exports.getEmojis=e=>(0,t("lcuos").filter)(e,e=>"emoji"===e.type)}),n("b1yeC",function(e,n){e.exports.shouldMarkErrorAsHandled=e=>{if(!e)return!0;let n=(0,t("422HI").isApolloError)(e)?(0,t("aMcHK").getStatusCode)(e?.graphQLErrors?.[0]):(0,t("aMcHK").getStatusCode)(e);return!n||!!(parseInt(n)>=400&&500>parseInt(n))}}),n("ggElv",function(e,n){let r=e=>e<=t("2F3Ut").MAX_CONTENT_CHARACTER_COUNT_SINGLE_LINE,a=e=>{if(!e.content)return!0;let n=e.content;return r((0,t("aTfTn").getCharacterCount)(n))};e.exports.isCharacterCountSingleLine=r,e.exports.isBannerContentSingleLineFromDocNode=a,e.exports.isBannerContentSingleLineFromJSONString=e=>a((0,t("edve5").parseBannerContent)(e))});
//# sourceMappingURL=AdminAnnouncementBanner.4b26cd26.js.map
