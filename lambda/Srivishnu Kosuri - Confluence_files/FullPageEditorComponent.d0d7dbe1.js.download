function e(e){return e&&e.__esModule?e.default:e}var t=globalThis,o={},r={},n=t.parcelRequired477;null==n&&((n=function(e){var t=o[e];if(void 0!==t)return t.exports;var n=r[e];if(void 0!==n){delete r[e];var a={id:e,exports:{}};return o[e]=a,n.call(a.exports,a,a.exports),a.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){r[e]=t},t.parcelRequired477=n);var a=n.register;t.lb||(t.lb=new Set,t.bq=[],t.rlb=e=>{t.lb.add(e),t.pq()},t.rwr=(e,o,r)=>{t.bq.push({b:e,r:o,d:r}),t.pq()},t.pq=()=>{var e=t.bq.find(e=>e.d.every(e=>t.lb.has(e)));e&&(t.bq=t.bq.filter(t=>t.b!==e.b),e.r(),t.pq())}),a("e6Iiv",function(t,o){var r=n("42omo"),a=n("1PKpt"),i=n("6cQbn"),l=n("2NcJL"),s=n("b5IZN");t.exports.ComposableEditor=function(t){let o=(0,r.useMemo)(()=>(function(e){switch(e=e||"comment"){case"full-page":case"full-width":case"max":return l.FullPageEditor;case"chromeless":return a.default;case"comment":return i.CommentEditorWithIntl;default:throw Error(`Appearance '${e}' is not supported by the editor.`)}})(t.appearance),[t.appearance]);return e(r).createElement(s.CoreEditor,{...t,AppearanceComponent:o})}}),a("2NcJL",function(t,o){var r=n("42omo"),a=n("1oCLl"),i=n("iu6m9"),l=n("2daQU"),s=n("dZ8uq"),d=n("aeAfU"),c=n("axOCf");let p={name:"cui2x",styles:"min-width:340px;height:100%;display:flex;flex-direction:column;box-sizing:border-box"},u={name:"znpqtq",styles:"width:100%;container-type:inline-size;container-name:editor-area;contain:layout style inline-size"},f={name:"18di8tn",styles:"height:100%;box-sizing:border-box;align-self:flex-end;.extension-editable-area &{height:auto;position:sticky;top:0;align-self:flex-start;}"},h="cubic-bezier(0.15, 1, 0.3, 1)",m=`0.5s ${h}`,g=()=>2*(0,n("aFUXX").akEditorGutterPaddingDynamic)(),y=(0,n("9K4OG").css)({"& .ProseMirror":{flexGrow:1,boxSizing:"border-box","& > *":{clear:"both"},[`> p, > ul, > ol:not(${n("cXZ4C").taskListSelector}):not(${n("gClzS").decisionListSelector}), > h1, > h2, > h3, > h4, > h5, > h6`]:{clear:"none"},"> p:last-child":{marginBottom:"var(--ds-space-300, 24px)"}}}),P={name:"bywn89",styles:".fabric-editor--full-width-mode:not(:has(#chromeless-editor)){.fabric-editor-breakout-mark, .extension-container.block, .pm-table-container{width:100% !important;}.fabric-editor-breakout-mark{margin-left:unset !important;transform:none !important;}}"},b=(0,n("9K4OG").css)({marginTop:"calc(var(--ds-space-500, 40px) + 1px)"}),E={name:"1y04g5d",styles:"padding-top:var(--ds-space-400, 32px)"},_=(0,n("9K4OG").css)({lineHeight:"24px",paddingTop:"var(--ds-space-600, 48px)",".ak-editor-content-area-no-toolbar &":{paddingTop:"calc(var(--ds-space-600, 48px) + var(--ak-editor-fullpage-toolbar-height) + 1px)"},paddingBottom:"var(--ds-space-600, 48px)",height:"calc( 100% - 105px )",width:"100%",margin:"auto",flexDirection:"column",flexGrow:1,maxWidth:"var(--ak-editor-content-area-max-width)",transition:`max-width ${m}`}),T={name:"1h9cr7f",styles:".ProseMirror .pm-table-wrapper > table{margin-left:0;margin-right:-1px;width:100%;}"},S=(0,n("9K4OG").css)({".fabric-editor--full-width-mode":{"[data-layout-section]":{maxWidth:"calc(100% + 40px)"}}}),O=(0,n("9K4OG").css)({".fabric-editor--full-width-mode":{".extension-container, .multiBodiedExtension--container":{maxWidth:"calc(100% - 4px)"},".extension-container.inline":{maxWidth:"100%"},"td .extension-container.inline":{maxWidth:"inherit"},"[data-layout-section]":{maxWidth:"calc(100% + 24px)"}}}),x=(0,n("9K4OG").css)({".fabric-editor--full-width-mode":{".code-block, .extension-container, .multiBodiedExtension--container":{maxWidth:"calc(100% - 4px)"},".extension-container.inline":{maxWidth:"100%"},"td .extension-container.inline":{maxWidth:"inherit"},"[data-layout-section]":{maxWidth:"calc(100% + 24px)"}}}),C={name:"56lgh2",styles:"padding:0 72px"},k={name:"1h0el6e",styles:"box-sizing:border-box;padding:0 52px"},A=(0,n("9K4OG").css)({[`@container editor-area (max-width: ${n("aFUXX").akEditorFullPageNarrowBreakout}px)`]:{padding:`0 ${n("aFUXX").akEditorGutterPaddingReduced}px`}}),v=(0,n("9K4OG").css)({display:"flex",flexDirection:"row",height:"calc(100% - var(--ak-editor-fullpage-toolbar-height))","&.ak-editor-content-area-no-toolbar":{height:"calc(100% + 1px)"},boxSizing:"border-box",margin:0,padding:0,transition:`padding 0ms ${h}`}),N={name:"13udsys",styles:"height:100%"},w=e(r).forwardRef((t,o)=>{let p=(0,n("6dGgK").u)(),h="full-width"===t.appearance,m="max"===t.appearance,w=(0,r.useRef)(null),R=(0,r.useRef)(null),I=(0,r.useRef)(null),D=t.editorAPI?.base?.sharedState.currentState()?.allowScrollGutter;return(0,r.useImperativeHandle)(o,()=>({get scrollContainer(){return w.current},get contentArea(){return R.current},get containerArea(){return I.current}}),[]),(0,n("9K4OG").jsx)("div",{css:[v,t.isEditorToolbarHidden&&N],"data-testid":"ak-editor-fp-content-area",ref:I},(0,n("9K4OG").jsx)("div",{css:u,"data-testid":"ak-editor-container","data-editor-container":"true"},(0,n("9K4OG").jsx)(c.default,{className:"fabric-editor-popup-scroll-parent",featureFlags:t.featureFlags,ref:w,viewMode:t?.viewMode,isScrollable:!0,appearance:t.appearance,contentMode:t.contentMode},(0,n("9K4OG").jsx)(n("kXpLO").default,{editorView:t.editorView,editorDisabled:t.disabled},(0,n("9K4OG").jsx)("div",{css:[_,y,T,P,(0,s.expValEqualsNoExposure)("platform_editor_breakout_resizing","isEnabled",!0)?O:x,(0,n("dh538").fg)("platform_editor_nested_dnd_styles_changes")&&S,!(0,n("dh538").fg)("platform_editor_controls_no_toolbar_space")&&(0,i.editorExperiment)("platform_editor_controls","variant1")&&E,!(0,n("dh538").fg)("platform_editor_controls_no_toolbar_space")&&t.isEditorToolbarHidden&&(0,i.editorExperiment)("platform_editor_controls","variant1")&&b],style:{"--ak-editor-content-area-max-width":h?`${1800+g()}px`:m&&((0,a.expValEquals)("editor_tinymce_full_width_mode","isEnabled",!0)||(0,a.expValEquals)("confluence_max_width_content_appearance","isEnabled",!0))?`${4e3+g()}px`:`${p.layoutMaxWidth+g()}px`},className:"ak-editor-content-area-region","data-editor-editable-content":!0,role:"region","aria-label":t.intl.formatMessage(n("8aWkM").messages.editableContentLabel),ref:R},(0,n("9K4OG").jsx)("div",{css:[k,(0,n("dh538").fg)("platform_editor_controls_increase_full_page_gutter")&&(0,i.editorExperiment)("platform_editor_controls","variant1")&&C,(0,i.editorExperiment)("platform_editor_preview_panel_responsiveness",!0,{exposure:!0})&&A],className:e(l)("ak-editor-content-area","appearance-full-page",{"fabric-editor--full-width-mode":h}),ref:R},t.customContentComponents&&"before"in t.customContentComponents?(0,n("45E6y").contentComponentClickWrapper)(t.customContentComponents.before):(0,n("45E6y").contentComponentClickWrapper)(t.customContentComponents),(0,n("9K4OG").jsx)(n("3ae8F").default,{editorView:t.editorView,editorActions:t.editorActions,eventDispatcher:t.eventDispatcher,providerFactory:t.providerFactory,appearance:t.appearance,items:t.contentComponents,pluginHooks:t.pluginHooks,contentArea:R.current??void 0,popupsMountPoint:t.popupsMountPoint,popupsBoundariesElement:t.popupsBoundariesElement,popupsScrollableElement:t.popupsScrollableElement,disabled:!!t.disabled,containerElement:w.current,dispatchAnalyticsEvent:t.dispatchAnalyticsEvent,wrapperElement:t.wrapperElement}),t.editorDOMElement,t.customContentComponents&&"after"in t.customContentComponents?(0,n("45E6y").contentComponentClickWrapper)(t.customContentComponents.after):null,(0,d.expVal)("platform_editor_scroll_gutter_fix","isEnabled",!1)&&D&&(0,n("9K4OG").jsx)("div",{id:"editor-scroll-gutter",style:{paddingBottom:`${D.gutterSize??"120"}px`},"data-vc":"scroll-gutter"})))))),(0,n("9K4OG").jsx)("div",{css:f},t.contextPanel||(0,n("9K4OG").jsx)(n("auRzv").ContextPanel,{editorAPI:t.editorAPI,visible:!1})))}),R=(0,n("gmMgo").default)(w,{forwardRef:!0});var I=n("5Gwdo");let D={name:"ep0vx",styles:"display:flex;flex-grow:1;justify-content:flex-end;align-items:center"},M=e=>(0,n("9K4OG").jsx)("div",{css:D,"data-testid":"before-primary-toolbar-components-plugin"},e.beforePrimaryToolbarComponents);n("42omo");let L={name:"5thnkd",styles:"display:flex;flex-grow:1"},B={name:"125cgyn",styles:"@media (max-width: 868px){flex:1 1 100%;height:var(--ak-editor-fullpage-toolbar-height);justify-content:flex-end;min-width:fit-content;}"},K={name:"g8017n",styles:"min-width:fit-content"},U={name:"3psy",styles:"@media (max-width: 868px){display:flex;flex-grow:1;flex:1 1 100%;margin:auto;height:var(--ak-editor-fullpage-toolbar-height);min-width:0;}"},F=({twoLineEditorToolbar:e,children:t,role:o,"aria-label":r,"data-testid":a})=>(0,n("9K4OG").jsx)("div",{css:[L,e&&B],role:o,"aria-label":r,"data-testid":a},t),V=({twoLineEditorToolbar:e,children:t,role:o,"aria-label":r,"data-testid":a})=>(0,n("9K4OG").jsx)("div",{css:[K,e&&U],role:o,"aria-label":r,"data-testid":a},t),G=(0,n("9K4OG").css)({margin:"var(--ds-space-200, 16px)",height:"var(--ds-space-400, 32px)",width:"var(--ds-space-400, 32px)",[`@media (max-width: ${n("aFUXX").akEditorMobileMaxWidth}px)`]:{gridColumn:1,gridRow:1}});(0,n("9K4OG").css)({display:"flex",flexGrow:1,[`@media (max-width: ${n("aFUXX").akEditorMobileMaxWidth}px)`]:{gridColumn:1,gridRow:1}});let H={name:"t6ix9q",styles:"align-items:center;display:flex;flex-grow:1"},W={name:"1vr7vmn",styles:"align-items:center;display:flex"};n("42omo");let j=(0,n("9K4OG").css)({position:"relative",alignItems:"center",boxShadow:"none",borderBottom:"var(--ds-border-width, 1px) solid var(--ds-border, #0B120E24)",transition:`box-shadow 200ms ${n("aFUXX").akEditorSwoopCubicBezier}`,zIndex:n("aFUXX").akEditorFloatingDialogZIndex,display:"flex",height:"var(--ak-editor-fullpage-toolbar-height)",flexShrink:0,backgroundColor:"var(--ds-surface, #FFFFFF)","& object":{height:"0 !important"}}),z={name:"1ymvw5b",styles:"& span svg{max-width:100%;}"},$=(0,n("9K4OG").css)({boxShadow:"var(--ds-shadow-overflow, 0px 0px 8px #1E1F2128, 0px 0px 1px #1E1F211e)"}),q=(0,n("9K4OG").css)({"@media (max-width: 868px)":{flexWrap:"wrap",height:"calc(var(--ak-editor-fullpage-toolbar-height) * 2)"}}),X=({showKeyline:e,twoLineEditorToolbar:t,children:o,"data-testid":r})=>(0,n("9K4OG").jsx)("div",{css:[j,(0,n("dh538").fg)("platform-visual-refresh-icons")&&z,e&&$,t&&q],"data-testid":r},o),Y=e(r).memo(t=>{let[o,a]=(0,r.useState)(!1),{editorAPI:l}=t,s=(0,i.editorExperiment)("platform_editor_controls","variant1")?!!t.customPrimaryToolbarComponents&&t.primaryToolbarComponents?.length!==0:!!t.customPrimaryToolbarComponents,{Portal:d}=(0,n("9kMHa").useToolbarPortal)()??{Portal:e(r).Fragment},c=d!==e(r).Fragment?void 0:t.popupsMountPoint,p=(0,n("9K4OG").jsx)("div",{css:H},t.beforeIcon&&(0,n("9K4OG").jsx)("div",{css:G},t.beforeIcon),(0,n("9K4OG").jsx)(n("1xxAs").ToolbarWithSizeDetector,{editorView:t.editorView,editorActions:t.editorActions,eventDispatcher:t.eventDispatcher,providerFactory:t.providerFactory,appearance:t.appearance,items:t.primaryToolbarComponents,popupsMountPoint:c,popupsBoundariesElement:t.popupsBoundariesElement,popupsScrollableElement:t.popupsScrollableElement,disabled:t.disabled,dispatchAnalyticsEvent:t.dispatchAnalyticsEvent,containerElement:t.containerElement,hasMinWidth:t.hasMinWidth,twoLineEditorToolbar:s})),u=(0,n("9K4OG").jsx)("div",{css:W},t.customPrimaryToolbarComponents&&"before"in t.customPrimaryToolbarComponents?(0,n("9K4OG").jsx)(M,{beforePrimaryToolbarComponents:t.customPrimaryToolbarComponents?.before}):null,!(0,i.editorExperiment)("platform_editor_controls","variant1")&&l?.findReplace&&s?l?.findReplace.actions.registerToolbarButton({popupsBoundariesElement:t.popupsBoundariesElement,popupsMountPoint:c,popupsScrollableElement:t.popupsScrollableElement,editorView:t.editorView,containerElement:t.containerElement,dispatchAnalyticsEvent:t.dispatchAnalyticsEvent}):null,t.customPrimaryToolbarComponents&&"after"in t.customPrimaryToolbarComponents?t.customPrimaryToolbarComponents.after:t.customPrimaryToolbarComponents);(0,r.useEffect)(()=>{if(s){let e=()=>{a(window.innerWidth<=868)};return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)}});let f=(0,r.useCallback)(e=>e.altKey&&("F9"===e.key||120===e.keyCode),[]),h=(0,r.useCallback)(e=>{t.editorView?.hasFocus()||t.editorView?.focus(),e.preventDefault(),e.stopPropagation()},[t.editorView]);return(0,n("9K4OG").jsx)(n("3bEAg").ContextPanelConsumer,null,({width:e})=>(0,n("9K4OG").jsx)(I.ToolbarArrowKeyNavigationProvider,{editorView:t.editorView,childComponentSelector:"[data-testid='ak-editor-main-toolbar']",isShortcutToFocusToolbar:f,handleEscape:h,intl:t.intl},(0,n("9K4OG").jsx)(d,null,(0,n("9K4OG").jsx)(X,{showKeyline:t.showKeyline||e>0,twoLineEditorToolbar:s,"data-testid":"ak-editor-main-toolbar"},(0,n("9K4OG").jsx)(F,{twoLineEditorToolbar:s,role:"toolbar","aria-label":t.intl.formatMessage(n("8aWkM").messages.toolbarLabel)},o?u:p),(0,n("9K4OG").jsx)(V,{twoLineEditorToolbar:s,"data-testid":"avatar-group-outside-plugin",role:"region","aria-label":t.intl.formatMessage(n("8aWkM").messages.pageActionsLabel)},o?p:u),(0,n("9K4OG").jsx)(n("9kMHa").ToolbarPortalMountPoint,null)))))}),J=(0,n("gmMgo").default)(Y),Z={mainToolbarIconBefore:"_19pkpxbi _2hwxpxbi _otyrpxbi",mainToolbarIconBeforeNew:"_4cvr1h6o _1e0c1txw",mainToolbarWrapper:"_1rjc12x7 _18zrutpp _n7zlia51",mainToolbarNew:"_1e0c1txw _4t3izwfg",mainToolbarZIndex:"_1pby16oo _kqswh2mm",mainToolbarWithKeyline:"_16qs1nax",customToolbarWrapperStyle:"_4cvr1h6o _1e0c1txw",firstChildWrapperOneLine:"_1e0c1txw _16jlkb7n",firstChildWrapperContainerContext:"_7cca15wb _1f38ptqj",secondChildWrapperOneLine:"_1e0c1txw _1ul91ns9 _4cvr1h6o",beforePrimaryToolbarComponents:"_1e0c1txw _16jlkb7n _1bahesu3 _4cvr1h6o"},Q=({children:t,testId:o,showKeyline:i})=>e(r).createElement("div",{"data-testid":o,className:(0,n("gMc0m").default)([Z.mainToolbarWrapper,i&&Z.mainToolbarWithKeyline,(0,a.expValEquals)("platform_editor_toolbar_support_custom_components","isEnabled",!0)&&Z.mainToolbarNew,(0,a.expValEquals)("platform_editor_toolbar_aifc_patch_3","isEnabled",!0)&&Z.mainToolbarZIndex])},t),ee=({children:t})=>e(r).createElement("div",{"data-testid":"main-toolbar-first-child-wrapper",className:(0,n("gMc0m").default)([Z.firstChildWrapperOneLine,(0,a.expValEquals)("platform_editor_reduce_toolbar_vc_impact","isEnabled",!0)&&Z.firstChildWrapperContainerContext])},t),et=({children:t})=>e(r).createElement("div",{"data-testid":"main-toolbar-second-child-wrapper",className:(0,n("gMc0m").default)([Z.secondChildWrapperOneLine])},t),eo=({editorAPI:t,beforeIcon:o,toolbarDockingPosition:i,editorView:l,popupsMountPoint:s,showKeyline:d,customPrimaryToolbarComponents:c,disabled:p})=>{let u=t?.toolbar?.actions.getComponents(),f=(0,n("8C5kA").default)(),h=u?.find(e=>e.key===n("cPCP8").TOOLBARS.PRIMARY_TOOLBAR),{Portal:m}=(0,n("9kMHa").useToolbarPortal)()??{Portal:e(r).Fragment},g=m!==e(r).Fragment?void 0:s,y=(0,r.useCallback)(e=>e.altKey&&"F9"===e.key,[]),P=(0,r.useCallback)(e=>{l?.hasFocus()||l?.focus(),e.preventDefault(),e.stopPropagation()},[l]);return e(r).createElement(n("3bEAg").ContextPanelConsumer,null,({width:s})=>e(r).createElement(I.ToolbarArrowKeyNavigationProvider,{editorView:l,childComponentSelector:"[data-testid='ak-editor-main-toolbar']",isShortcutToFocusToolbar:y,handleEscape:P,intl:f},e(r).createElement(m,null,e(r).createElement(Q,{testId:"ak-editor-main-toolbar",showKeyline:d||s>0},o&&e(r).createElement("div",{className:(0,n("gMc0m").default)([Z.mainToolbarIconBefore,(0,a.expValEquals)("platform_editor_toolbar_support_custom_components","isEnabled",!0)&&Z.mainToolbarIconBeforeNew])},o),(0,a.expValEquals)("platform_editor_toolbar_support_custom_components","isEnabled",!0)?e(r).createElement(e(r).Fragment,null,e(r).createElement(ee,null,"none"!==i&&u&&(0,n("5ZzFz").isToolbar)(h)&&(!(0,a.expValEquals)("platform_editor_toolbar_aifc_patch_3","isEnabled",!0)||((0,a.expValEquals)("platform_editor_ssr_renderer","isEnabled",!0)&&(0,n("eTj7Y").isSSR)()||l)&&((0,a.expValEquals)("platform_editor_toolbar_delay_render_fix","isEnabled",!0)?!(0,n("eTj7Y").isSSR)():!(0,a.expValEquals)("platform_editor_hydratable_ui","isEnabled",!0)||!(0,n("eTj7Y").isSSR)()))&&e(r).createElement(n("eUp7e").ToolbarNext,{toolbar:h,components:u,editorView:l,editorAPI:t,popupsMountPoint:g,editorAppearance:"full-page",isDisabled:p})),e(r).createElement(et,null,e(r).createElement("div",{className:(0,n("gMc0m").default)([Z.customToolbarWrapperStyle])},!!c&&"before"in c&&e(r).createElement("div",{"data-testid":"before-primary-toolbar-components-plugin",className:(0,n("gMc0m").default)([Z.beforePrimaryToolbarComponents])},c.before),c&&"after"in c?c.after:c)),(0,n("dh538").fg)("platform_editor_toolbar_aifc_patch_7")&&e(r).createElement(n("9kMHa").ToolbarPortalMountPoint,null)):"none"!==i&&u&&(0,n("5ZzFz").isToolbar)(h)&&(!(0,a.expValEquals)("platform_editor_toolbar_aifc_patch_3","isEnabled",!0)||l&&((0,a.expValEquals)("platform_editor_toolbar_delay_render_fix","isEnabled",!0)?!(0,n("eTj7Y").isSSR)():!(0,a.expValEquals)("platform_editor_hydratable_ui","isEnabled",!0)||!(0,n("eTj7Y").isSSR)()))&&e(r).createElement(n("eUp7e").ToolbarNext,{toolbar:h,components:u,editorView:l,editorAPI:t,popupsMountPoint:g,editorAppearance:"full-page",isDisabled:p})))))},er=e=>{let[t,o]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{if(!e.current?.contentArea)return;let t=new IntersectionObserver(([e])=>{o(!e.isIntersecting&&e.boundingClientRect.top<e.intersectionRect.top)},{root:void 0,threshold:((0,a.expValEquals)("platform_editor_hydratable_ui","isEnabled",!0)?(0,n("d7ZU3").getBrowserInfo)():n("d7ZU3").browser).safari?.98:1});return t.observe(e.current.contentArea),()=>{t.disconnect()}},[e]),t},en=e=>!!e&&(!("before"in e)||Array.isArray(e.before)&&e.before.length>0||!!e.before||Array.isArray(e.after)&&e.after.length>0||!!e.after);t.exports.FullPageEditor=e=>{let t=(0,r.useMemo)(()=>e.innerRef,[e.innerRef]),o=(0,r.useRef)(null),l=er(o),s=e.editorAPI,d=(0,n("eiA8Z").useSharedPluginStateWithSelector)(s,["primaryToolbar","interaction","editorViewMode"],e=>({primaryToolbarComponents:e.primaryToolbarState?.components,interactionState:e.interactionState?.interactionState,editorViewMode:e.editorViewModeState?.mode})),c=d.interactionState,u=(0,n("4cy2V").getPrimaryToolbarComponents)(s,d.primaryToolbarComponents),f=(0,n("b3YrF").useSharedPluginStateSelector)(s,"selectionToolbar.toolbarDocking",{disabled:(0,n("dh538").fg)("platform_editor_use_preferences_plugin")});if(!(0,n("dh538").fg)("platform_editor_use_preferences_plugin")&&!f){let t=e.__livePage?"none":"top";f=s?.selectionToolbar?.sharedState.currentState()?.toolbarDocking??t}let{toolbarDockingPosition:h}=(0,n("b3YrF").useSharedPluginStateSelector)(s,"userPreferences.preferences",{disabled:!(0,n("dh538").fg)("platform_editor_use_preferences_plugin")})||{};if((0,n("dh538").fg)("platform_editor_use_preferences_plugin")&&!h){let t=e.__livePage?"none":"top";h=s?.userPreferences?.actions.getUserPreferences()?.toolbarDockingPosition??t}let m=e.primaryToolbarComponents;Array.isArray(u?.components)&&Array.isArray(m)&&(m=u.components.concat(m));let g="view"===d.editorViewMode,{customPrimaryToolbarComponents:y}=e;(0,i.editorExperiment)("platform_editor_controls","variant1",{exposure:!0})&&((0,n("dh538").fg)("platform_editor_use_preferences_plugin")?"none"===h&&(m=[],en(y)||(g=!0)):"none"===f&&(m=[],en(y)||(g=!0)));let P=!!s?.toolbar,b=e.popupsBoundariesElement||o?.current?.containerArea||void 0;return(0,n("9K4OG").jsx)(n("3bEAg").ContextPanelWidthProvider,null,(0,n("9K4OG").jsx)("div",{css:p,className:"akEditor",ref:t,style:{"--ak-editor-fullpage-toolbar-height":(0,n("aFUXX").FULL_PAGE_EDITOR_TOOLBAR_HEIGHT)(P)}},!g&&(P?(0,n("9K4OG").jsx)(eo,{disabled:(0,a.expValEquals)("platform_editor_toolbar_aifc_patch_4","isEnabled",!0)?!!e.disabled:void 0,toolbarDockingPosition:h??f,beforeIcon:e.primaryToolbarIconBefore,editorAPI:s,editorView:e.editorView,popupsMountPoint:e.popupsMountPoint,popupsBoundariesElement:e.popupsBoundariesElement,popupsScrollableElement:e.popupsScrollableElement,showKeyline:l,customPrimaryToolbarComponents:e.customPrimaryToolbarComponents}):(0,n("9K4OG").jsx)(J,{appearance:e.appearance,editorAPI:s,beforeIcon:e.primaryToolbarIconBefore,collabEdit:e.collabEdit,containerElement:o.current?.scrollContainer??null,customPrimaryToolbarComponents:e.customPrimaryToolbarComponents,disabled:!!e.disabled,dispatchAnalyticsEvent:e.dispatchAnalyticsEvent,editorActions:e.editorActions,editorDOMElement:e.editorDOMElement,editorView:e.editorView,eventDispatcher:e.eventDispatcher,hasMinWidth:e.enableToolbarMinWidth,popupsBoundariesElement:e.popupsBoundariesElement,popupsMountPoint:e.popupsMountPoint,popupsScrollableElement:e.popupsScrollableElement,primaryToolbarComponents:m,providerFactory:e.providerFactory,showKeyline:l,featureFlags:e.featureFlags})),(0,n("9K4OG").jsx)(R,{editorAPI:s,ref:o,appearance:e.appearance,contentComponents:e.contentComponents,contextPanel:e.contextPanel,customContentComponents:e.customContentComponents,disabled:e.disabled,dispatchAnalyticsEvent:e.dispatchAnalyticsEvent,editorActions:e.editorActions,editorDOMElement:e.editorDOMElement,editorView:e.editorView,eventDispatcher:e.eventDispatcher,popupsBoundariesElement:b,popupsMountPoint:e.popupsMountPoint,popupsScrollableElement:e.popupsScrollableElement,providerFactory:e.providerFactory,wrapperElement:t?.current??null,pluginHooks:e.pluginHooks,featureFlags:e.featureFlags,isEditorToolbarHidden:g,viewMode:d.editorViewMode,hasHadInteraction:"hasNotHadInteraction"!==c,contentMode:e.contentMode})))}}),a("auRzv",function(t,o){var r=n("42omo");let a={name:"k2uqvh",styles:"width:0"},i=(0,n("9K4OG").css)({width:`${n("aFUXX").akEditorContextPanelWidth}px`,height:"100%",transition:`width 500ms ${n("aFUXX").akEditorSwoopCubicBezier}`,overflow:"hidden",boxShadow:"inset 2px 0 0 0 var(--ds-border, #0B120E24)"}),l={name:"1wx2bp",styles:"transition:none"},s=(0,n("9K4OG").css)({transition:`width 600ms ${n("aFUXX").akEditorSwoopCubicBezier}`,boxSizing:"border-box",width:`${n("aFUXX").akEditorContextPanelWidth}px`,height:"100%",overflowY:"auto"}),d=(0,n("9K4OG").css)({padding:"var(--ds-space-200, 16px) var(--ds-space-200, 16px) 0px"});class c extends e(r).PureComponent{static getDerivedStateFromProps(e,t){return e.pluginContent!==t.currentPluginContent?{...t,currentPluginContent:e.pluginContent}:null}unsetPluginContent(){this.setState({currentPluginContent:void 0})}componentDidMount(){this.setState({mounted:!0})}render(){let e=this.props.customWidth??n("aFUXX").akEditorContextPanelWidth,t=!!this.props.visible,o=t||!!this.state.currentPluginContent,r=void 0===this.props.hasPadding||this.props.hasPadding,c=(0,n("9K4OG").css)({width:`${this.props.customWidth}px`,overflowX:"hidden"});return(0,n("9K4OG").jsx)(n("3bEAg").ContextPanelConsumer,null,({broadcastWidth:p})=>(p(o?e:0),(0,n("9K4OG").jsx)("div",{css:[i,this.props.customWidth&&c,!o&&a,(0,n("dh538").fg)("platform_editor_disable_context_panel_animation")&&l],"data-testid":"context-panel-panel","aria-label":this.props.intl?.formatMessage(n("kofef").contextPanelMessages.panelLabel)||"","aria-modal":"false",role:"dialog"},(0,n("9K4OG").jsx)("div",{"data-testid":"context-panel-content",tabIndex:(0,n("dh538").fg)("platform_editor_nov_a11y_fixes")?0:void 0,role:(0,n("dh538").fg)("platform_editor_nov_a11y_fixes")?"region":void 0,"aria-label":(0,n("dh538").fg)("platform_editor_nov_a11y_fixes")?this.props.intl?.formatMessage(n("kofef").contextPanelMessages.panelContentLabel):void 0,css:[s,r&&d,this.props.customWidth&&c,!o&&a,(0,n("dh538").fg)("platform_editor_disable_context_panel_animation")&&l]},this.showPluginContent()||this.showProvidedContent(t)))))}constructor(...e){super(...e),this.state={mounted:!1,currentPluginContent:void 0},this.focusEditor=()=>{let{editorAPI:e}=this.props;e?.core?.actions.focus({scrollIntoView:!1})},this.showPluginContent=()=>{let{pluginContent:e}=this.props,{currentPluginContent:t}=this.state;if(!t)return;let o=500*!(0,n("dh538").fg)("platform_editor_disable_context_panel_animation");return(0,n("9K4OG").jsx)(n("7uLCZ").default,{timeout:this.state.mounted?o:0,in:!!e,mountOnEnter:!0,unmountOnExit:!0,onExited:()=>this.unsetPluginContent()},t)},this.showProvidedContent=e=>{let{children:t}=this.props;if(!t)return;let o=500*!(0,n("dh538").fg)("platform_editor_disable_context_panel_animation");return(0,n("9K4OG").jsx)(n("7uLCZ").default,{timeout:this.state.mounted?o:0,in:e,mountOnEnter:!0,unmountOnExit:!0,onExiting:this.focusEditor},t)}}}let p=(0,n("gmMgo").default)(c);t.exports.ContextPanel=function(e){let t=(0,n("eiA8Z").useSharedPluginStateWithSelector)(e.editorAPI,["contextPanel"],e=>e?.contextPanelState?.contents),o=t&&t.find(Boolean);return(0,n("9K4OG").jsx)(p,{...e,editorAPI:e.editorAPI,pluginContent:o})}}),a("9kMHa",function(t,o){var r=n("42omo");let a=e(r).createContext(void 0),i=()=>e(r).useContext(a),l={portal:"_1r04ze3t _kqswstnw _fiawglyw"};t.exports.ToolbarPortalContextProvider=({children:t,portal:o,isActive:n})=>{let i=e(r).useMemo(()=>({Portal:o,isActive:n}),[o,n]);return e(r).createElement(a.Provider,{value:i},t)},t.exports.useToolbarPortal=i,t.exports.ToolbarPortalMountPoint=()=>i()?null:e(r).createElement("div",{className:(0,n("gMc0m").default)([l.portal,"ak-editor-toolbar-portal"])})}),a("hEicH",function(e,t){var o=n("42omo"),r=n("iu6m9");let a=new(0,n("ks2lK").PluginKey)("userPreferencesPlugin"),i=(e,t)=>{let{userPreferencesProvider:o,initialUserPreferences:i}=e,l=()=>i&&(0,r.editorExperiment)("platform_editor_controls","variant1")?i:{toolbarDockingPosition:"top"};return new(0,n("1S4f7").SafePlugin)({key:a,state:{init:()=>({preferences:o?.getPreferences()||l()}),apply:(e,t)=>{let o=e.getMeta(a);return o?.preferences?{...t,preferences:{...t.preferences,...o.preferences}}:t}}})},l=({key:e,value:t,userPreferencesProvider:o,editorAnalyticsApi:r})=>({tr:i})=>{try{o?.updatePreference(e,t)}catch(e){(0,n("hWRJP").logException)(e,{location:"editor-plugin-user-preferences/userPreferencesPlugin"})}return i.setMeta(a,{preferences:{[e]:t}}),"toolbarDockingPosition"===e&&r?.attachAnalyticsEvent({action:n("d925B").ACTION.UPDATED,actionSubject:n("d925B").ACTION_SUBJECT.USER_PREFERENCES,actionSubjectId:n("d925B").ACTION_SUBJECT_ID.SELECTION_TOOLBAR_PREFERENCES,attributes:{toolbarDocking:t},eventType:n("d925B").EVENT_TYPE.TRACK})(i),i},s=e=>{(0,o.useEffect)(()=>{if(e){let t=async()=>{if("visible"===document.visibilityState)try{await e.loadPreferences()}catch(e){(0,n("hWRJP").logException)(e,{location:"editor-plugin-user-preferences/userPreferencesPlugin"})}};return(0,n("fFa3V").bind)(document,{type:"visibilitychange",listener:t})}},[e])},d=(e,t,r)=>{let a=(0,o.useRef)(!1);(0,o.useEffect)(()=>{e&&t&&!a.current&&(a.current=!0,r?.analytics?.actions.fireAnalyticsEvent({action:n("d925B").ACTION.INITIALISED,actionSubject:n("d925B").ACTION_SUBJECT.USER_PREFERENCES,actionSubjectId:n("d925B").ACTION_SUBJECT_ID.SELECTION_TOOLBAR_PREFERENCES,attributes:{toolbarDocking:t.toolbarDockingPosition},eventType:n("d925B").EVENT_TYPE.OPERATIONAL}))},[r,e,t])},c=(e,t)=>{(0,o.useEffect)(()=>{t&&e.dispatch(e.state.tr.setMeta(a,{preferences:t}))},[t,e])};e.exports.userPreferencesPlugin=({config:e,api:t})=>{let r=e.userPreferencesProvider;return{name:"userPreferences",pmPlugins:()=>[{name:"userPreferencesPlugin",plugin:()=>i(e,t)}],actions:{updateUserPreference:(e,o)=>l({key:e,value:o,userPreferencesProvider:r,editorAnalyticsApi:t?.analytics?.actions}),getUserPreferences:()=>r?r.getPreferences():e.initialUserPreferences},getSharedState:e=>e?a.getState(e):null,usePluginHook({editorView:e}){let{resolvedUserPreferences:n}=function(e){let[t,r]=(0,o.useState)(e?.getPreferences()||null);return(0,o.useEffect)(()=>e?.onUpdate(()=>{r(e.getPreferences())}),[e]),{resolvedUserPreferences:t}}(r);c(e,n),s(r),d(!!r?.isInitialized,n,t)}}}}),a("jmHSv",function(e,t){var o,r,a=n("42omo"),i=((o={}).CURSOR="cursor",o.RANGED="ranged",o.TEXT="text",o.NODE="node",o.CELL="cell",o.GAP_CURSOR="gapCursor",o),l=((r={}).START="start",r.MIDDLE="middle",r.END="end",r.LEFT="left",r.RIGHT="right",r),s=n("8m4tT");function d(e,t,o){if(!t.attributes)return t;let{type:r,position:a}=function(e){let t,o;if(e?.constructor?.name==="GapCursorSelection")t=i.GAP_CURSOR,o=e.side;else if(e instanceof n("7XFGZ").CellSelection)t=i.CELL;else if(e instanceof n("ks2lK").NodeSelection)t=i.NODE;else if(e.from!==e.to)t=i.RANGED;else{t=i.CURSOR;let{from:r,$from:n}=e;o=r===n.start()?l.START:r===n.end()?l.END:l.MIDDLE}return{type:t,position:o}}(e);t.attributes.selectionType=r,a&&(t.attributes.selectionPosition=a);let d=(0,n("lWghV").findInsertLocation)(e);return o&&t.action===n("d925B").ACTION.INSERTED&&t.actionSubject!==n("d925B").ACTION_SUBJECT.ANNOTATION&&t.actionSubject!==n("d925B").ACTION_SUBJECT.EDITOR_PLUGIN_AI&&(t.attributes.insertedLocation=function(e,t){let{schema:o}=t.$from.doc.type,{nodes:{paragraph:r,table:a}}=o;if(e instanceof n("7XFGZ").CellSelection)return a.name;let i=(0,s.findParentNode)(e=>e.type!==r)(e),l=t.$from.doc.resolve(i?.start||0);for(;l.end()<t.$from.pos;)l=t.$from.doc.resolve(l.start(Math.max(l.depth-1,0)));return l.node().type.name}(e,o.selection)),t.action===n("d925B").ACTION.INSERTED&&t.actionSubject===n("d925B").ACTION_SUBJECT.DOCUMENT&&t.attributes?t.attributes.insertLocation=d:t.attributes.nodeLocation=d,t}let c=[n("d925B").ACTION.INVOKED,n("d925B").ACTION.OPENED],p=e=>({payload:t,tr:o,channel:r})=>u({payload:t,selection:e,tr:o,channel:r}),u=({payload:e,selection:t,tr:o,channel:r})=>{e=function(e){let t=e.action===n("d925B").ACTION.INSERTED&&e.actionSubject===n("d925B").ACTION_SUBJECT.DOCUMENT,o=e.action===n("d925B").ACTION.FORMATTED&&e.actionSubject===n("d925B").ACTION_SUBJECT.TEXT;return e.actionSubjectId&&(t||o)&&(e.attributes={...e.attributes,actionSubjectId:e.actionSubjectId}),e}(e=d(t,e,o));let{storedMarks:a}=o,i=o.mapping.map(t.$from.pos,-1);o.step(new(0,n("jy7VG").AnalyticsStep)([{payload:e,channel:r}],c,i)),a&&o.setStoredMarks(a)},f=n("k7eoe").FabricChannel.editor,h=new(0,n("ks2lK").PluginKey)("analyticsPlugin"),m=e=>e.getMeta("undoRedoPlugin$")??null,g=e=>{let t=m(e);return e=>t&&["undid","redid"].includes(e.action)?{...e,attributes:{...e.attributes,historyTriggerMethod:t}}:e};e.exports.analyticsPlugin=({config:e={},api:t})=>{let o=t?.featureFlags?.sharedState.currentState()||{},r=new Set;return{name:"analytics",getSharedState:e=>{if(!e)return{createAnalyticsEvent:null,attachAnalyticsEvent:null,performanceTracking:void 0};let{createAnalyticsEvent:t,performanceTracking:o}=h.getState(e)??{};return{createAnalyticsEvent:t,attachAnalyticsEvent:p(e.selection),performanceTracking:o}},actions:{attachAnalyticsEvent:(e,o=f)=>n=>{let{createAnalyticsEvent:a,attachAnalyticsEvent:i}=t?.analytics?.sharedState.currentState()??{};return n&&a&&i?(i({tr:n,payload:e,channel:o}),!0):(r.add({payload:e,channel:o}),!1)},fireAnalyticsEvent(e,o=f,a){let{createAnalyticsEvent:i}=t?.analytics?.sharedState.currentState()??{};if(a?.context&&(e=d(a.context.selection,e)),!i)return void r.add({payload:e,channel:o});let l=e;(0,n("ajtqX").fireAnalyticsEvent)(i,a)({payload:l,channel:o})}},usePluginHook({editorView:e}){let{createAnalyticsEvent:t}=(0,n("inPa6").useAnalyticsEvents)();(0,a.useLayoutEffect)(()=>{let{dispatch:o,state:{tr:n}}=e;n.setMeta(h,{createAnalyticsEvent:t}),o(n),r.forEach(({payload:e,channel:o})=>{t(e)?.fire(o??f)}),r.clear()},[t,e])},pmPlugins:()=>[{name:"analyticsPlugin",plugin:()=>(function(e,t){if(!e)return;let o=(0,n("aAn37").isPerformanceAPIAvailable)();return new(0,n("1S4f7").SafePlugin)({key:h,state:{init:()=>({...e,fireAnalytics:(0,n("ajtqX").fireAnalyticsEvent)(e.createAnalyticsEvent)}),apply:(r,a,i,l)=>{let{createAnalyticsEvent:s}=r.getMeta(h)??{};if(e.createAnalyticsEvent&&e.createAnalyticsEvent!==a.createAnalyticsEvent||a.createAnalyticsEvent!==s&&s)return{...a,createAnalyticsEvent:e.createAnalyticsEvent??s};if(t.catchAllTracking){let e=(0,n("4VpM8").getAnalyticsEventsFromTransaction)(r);if(e.length>0){for(let{payload:t,channel:i}of e)if(o&&r.docChanged&&t.action!==n("d925B").ACTION.INSERTED&&t.action!==n("d925B").ACTION.DELETED){let e=`${t.actionSubject}:${t.action}:${t.actionSubjectId}`;(0,n("jz9wK").measureRender)(e,({duration:e,distortedDuration:o})=>{(0,n("ajtqX").fireAnalyticsEvent)(a.createAnalyticsEvent)({payload:function({payload:e,duration:t,distortedDuration:o}){return{...e,attributes:{...e.attributes,duration:t,distortedDuration:o},eventType:n("d925B").EVENT_TYPE.OPERATIONAL}}({payload:t,duration:e,distortedDuration:o}),channel:i})})}}}return a}}})})(e,o)}],onEditorViewStateUpdated({originalTransaction:e,transactions:t,newEditorState:o}){let r=h.getState(o);if(!r||!r.createAnalyticsEvent)return;let a=t.reduce((e,t)=>{let o=t.steps.filter(e=>e instanceof n("jy7VG").AnalyticsStep).map(e=>e.analyticsEvents).reduce((e,t)=>e.concat(t),[]);return e.push(...o),e},[]);if(0===a.length)return;let{createAnalyticsEvent:i}=r,l=g(e);a.forEach(({payload:e,channel:t})=>{let o=l(e);(0,n("ajtqX").fireAnalyticsEvent)(i)({payload:o,channel:t})})}}}}),a("kXH7i",function(e,t){let o=new(0,n("ks2lK").PluginKey)("clearMarksOnChangeToEmptyDocumentPlugin");function r(){return new(0,n("1S4f7").SafePlugin)({key:o,appendTransaction:(e,t,o)=>{if(!(0,n("2pjJ5").isEmptyDocument)(t.doc)&&(0,n("2pjJ5").isEmptyDocument)(o.doc))return o.tr.setStoredMarks([])}})}e.exports.clearMarksOnEmptyDocPlugin=()=>({name:"clearMarksOnEmptyDoc",pmPlugins:()=>[{name:"clearMarksOnChange",plugin:r}]})}),a("acwPl",function(e,t){var o,r=n("8m4tT");let a=new(0,n("ks2lK").PluginKey)("clipboardPlugin");(o={}).CUT="CUT",o.COPY="COPY";let i=null,l=({dispatchAnalyticsEvent:e,schema:t})=>{let o;return new(0,n("1S4f7").SafePlugin)({key:a,view:e=>(o=e,{update:e=>{o=e}}),props:{handleDOMEvents:{cut:t=>(c("CUT"),d(t,e,n("d925B").ACTION.CUT)),copy:t=>(c("COPY"),d(t,e,n("d925B").ACTION.COPIED))},clipboardSerializer:s(t,()=>o)}})},s=(e,t)=>{let o=n("5SAOw").DOMSerializer.fromSchema(e),a=new(0,n("5SAOw").DOMSerializer)(o.nodes,o.marks),l=a.serializeFragment.bind(a);return a.serializeFragment=(o,a={},s)=>{let d=t().state.selection;if(!a.tableWrapperExists){let e=0;for(;e<o.childCount;){if(o.maybeChild(e)?.type.name==="table"){a.tableWrapperExists=!0;break}e++}}if(o.firstChild?.type.name==="tableRow"&&!a.tableWrapperExists){a.tableWrapperExists=!0;let t=(0,r.findParentNodeOfType)(e.nodes.table)(d),i=t?.node.attrs,c=e.nodes.table.createChecked({...i,localId:void 0},o);return l(n("5SAOw").Fragment.from(c),a,s)}if("COPY"===i&&o.firstChild?.type.name==="media"){let t=o.firstChild,r=e.nodes.media.createChecked(t.attrs,t.content,t.marks?.filter(e=>"annotation"!==e.type.name));if(!(0,n("dh538").fg)("platform_editor_fix_captions_on_copy"))return l(n("5SAOw").Fragment.from(r),a,s);{let e=[r];return o.forEach(t=>{"media"!==t.type.name&&(e=[...e,t])}),l(n("5SAOw").Fragment.fromArray(e),a,s)}}return l(o,a,s)},a},d=(e,t,o)=>{let r=(0,n("cMZNY").getAnalyticsPayload)(e.state,o);return r&&t(r),!1},c=e=>i=e;e.exports.default=()=>({name:"clipboard",pmPlugins:()=>[{name:"clipboard",plugin:e=>l(e)}]})}),a("kbe7k",function(e,t){let o=new(0,n("ks2lK").PluginKey)("contextIdentiferPlugin");async function r(e,t){let o=await e.contextIdentifierProvider;t?.core?.actions.execute(t?.contextIdentifier?.commands.setProvider({contextIdentifierProvider:o}))}let a=(e,t)=>()=>(e&&r(e,t),new(0,n("1S4f7").SafePlugin)({key:o,state:{init:()=>e,apply:(e,t)=>e.getMeta(o)||t}}));e.exports.contextIdentifierPlugin=({config:e,api:t})=>({name:"contextIdentifier",commands:{setProvider:e=>({tr:r})=>e?.contextIdentifierProvider===t?.contextIdentifier?.sharedState.currentState()?.contextIdentifierProvider?null:r.setMeta(o,{contextIdentifierProvider:e?.contextIdentifierProvider})},getSharedState(e){if(e)return{contextIdentifierProvider:o.getState(e)?.contextIdentifierProvider}},pmPlugins:()=>[{name:"contextIdentifier",plugin:a(e,t)}]})}),a("l7rln",function(e,t){let o=new(0,n("ks2lK").PluginKey)("featureFlags");e.exports.featureFlagsPlugin=({config:e={}})=>({name:"featureFlags",getSharedState:t=>t?o.getState(t)||e||{}:e||{},pmPlugins:()=>[{name:"featureFlags",plugin:()=>new(0,n("1S4f7").SafePlugin)({key:o,state:{init:()=>({...e}),apply:(e,t)=>t}})}]})}),a("jS0a0",function(e,t){let o=new(0,n("ks2lK").PluginKey)("focusPluginHandler"),r=()=>new(0,n("1S4f7").SafePlugin)({key:o,state:{init:()=>({hasFocus:!1}),apply(e,t){let r=e.getMeta(o);return"boolean"==typeof r&&r!==t.hasFocus?{hasFocus:r}:t}},props:{handleDOMEvents:{focus:e=>{let t=o.getState(e.state);return t?.hasFocus||e.dispatch(e.state.tr.setMeta(o,!0)),!1},blur:e=>{let t=o.getState(e.state);return t?.hasFocus&&e.dispatch(e.state.tr.setMeta(o,!1)),!1}}}});e.exports.focusPlugin=({api:e})=>({name:"focus",getSharedState:e=>e?{hasFocus:!!o.getState(e)?.hasFocus}:{hasFocus:!1},pmPlugins:()=>[{name:"focusHandlerPlugin",plugin:r}]})}),a("HYzBP",function(e,t){var o,r=((o={}).UPDATE="UPDATE",o);let a={key:n("l9G9n").pmHistoryPluginKey,getState:e=>e[n("l9G9n").pmHistoryPluginKey],get:e=>e.plugins.find(e=>e.key===n("l9G9n").pmHistoryPluginKey)},i=e=>a.getState(e),l=new(0,n("ks2lK").PluginKey)("historyPlugin"),s=()=>({canUndo:!1,canRedo:!1}),{createPluginState:d,getPluginState:c}=(0,n("lkJUe").pluginFactory)(l,(e,t)=>t.type===r.UPDATE?{canUndo:t.canUndo,canRedo:t.canRedo}:e),p=e=>new(0,n("1S4f7").SafePlugin)({state:d(e,s),key:l,appendTransaction:(e,t,o)=>{if(e.find(e=>e.docChanged&&!1!==e.getMeta("addToHistory")||e.getMeta("endHistorySlice"))){let e=i(o);if(!e)return;let t=e.done.eventCount>0,n=e.undone.eventCount>0,{canUndo:a,canRedo:s}=c(o);if(t!==a||n!==s){let e={type:r.UPDATE,canUndo:t,canRedo:n};return o.tr.setMeta(l,e)}}}});e.exports.default=({api:e})=>{let t=null;return{name:"history",pmPlugins:()=>[{name:"history",plugin:({dispatch:e})=>p(e)}],getSharedState:e=>{if(!e)return;let t=l.getState(e);if(!t)return;let{done:o,undone:r}=i(e)??{};return{canUndo:t.canUndo,canRedo:t.canRedo,done:{eventCount:o?.eventCount??0},undone:{eventCount:r?.eventCount??0}}},commands:{updatePluginState:({tr:t})=>{let{done:o,undone:n}=e?.history.sharedState.currentState()??{};if(void 0===o||void 0===n)return t;let a=o.eventCount>0,i=n.eventCount>0,s={type:r.UPDATE,canUndo:a,canRedo:i};return t.setMeta(l,s)},startHistorySlice:e=>({tr:o})=>t?null:(t=e,o.setMeta("startHistorySlice",!0)),endHistorySlice:e=>({tr:o})=>t!==e?null:(t=null,o.setMeta("endHistorySlice",!0))}}}}),a("6AqNX",function(e,t){let o=new(0,n("ks2lK").PluginKey)("interactionPluginHandler"),r=e=>{let t=o.getState(e.state);return t?.hasHadInteraction||e.dispatch(e.state.tr.setMeta(o,{hasHadInteraction:!0})),!1},a=()=>new(0,n("1S4f7").SafePlugin)({key:o,state:{init:()=>({hasHadInteraction:!1}),apply(e,t){let r=e.getMeta(o);return"object"==typeof r&&r.hasHadInteraction!==t.hasHadInteraction?{hasHadInteraction:r.hasHadInteraction}:t}},props:{handleDOMEvents:{mousedown:r,keyup:r,drop:r,focus:r}}});e.exports.interactionPlugin=()=>({name:"interaction",getSharedState:e=>e?{interactionState:o.getState(e)?.hasHadInteraction?null:"hasNotHadInteraction"}:{interactionState:"hasNotHadInteraction"},commands:{handleInteraction:({tr:e})=>e.setMeta(o,{hasHadInteraction:!0})},pmPlugins:()=>[{name:"interactionHandlerPlugin",plugin:a}]})}),a("kYgUn",function(e,t){let o=["expand","panel"],r=["tableCell","tableHeader"],a=["bodiedSyncBlock"];var i=n("iu6m9");let l=(e,t,o,r=0)=>{let n=0,a="",i=[],l=(e,t)=>{let o=setTimeout(e,t);return i.push(o),o},s=()=>{let t=e[n],r=0,i=()=>{r<t.length?(o.textContent=a=t.substring(0,r+1),r++,l(i,50)):l(d,2e3)},d=()=>{a.length>1?(o.textContent=a=a.substring(0,a.length-1),l(d,40)):(o.textContent=a=" ",n=(n+1)%e.length,l(s,500))};i()};t?.push(()=>{i.forEach(e=>clearTimeout(e)),i=[]}),r>0?(o.textContent=" ",l(s,r)):s()};var s=n("8m4tT");let d=({formatMessage:e})=>({version:1,type:"doc",content:[{type:"paragraph",content:[(0,n("iJQnc").code)(e(n("hdkJi").placeholderTextMessages.shortEmptyNodePlaceholderADFSlashShortcut)),(0,n("aoDcQ").text)(" "),(0,n("aoDcQ").text)(e(n("hdkJi").placeholderTextMessages.shortEmptyNodePlaceholderADFSuffix))]}]}),c=({formatMessage:e})=>({version:1,type:"doc",content:[{type:"paragraph",content:[(0,n("aoDcQ").text)(e(n("hdkJi").placeholderTextMessages.longEmptyNodePlaceholderADFPrefix)),(0,n("aoDcQ").text)(" "),(0,n("iJQnc").code)(e(n("hdkJi").placeholderTextMessages.longEmptyNodePlaceholderADFSlashShortcut)),(0,n("aoDcQ").text)(" "),(0,n("aoDcQ").text)(e(n("hdkJi").placeholderTextMessages.longEmptyNodePlaceholderADFSuffix))]}]});function p(e){return n("kYgUn").pluginKey.getState(e)}function u({placeholderText:e,pos:t,placeholderPrompts:o,typedAndDeleted:r,userHadTyped:n,canShowOnEmptyParagraph:a,showOnEmptyParagraph:i,contextPlaceholderADF:l}){return{hasPlaceholder:!0,placeholderText:e,placeholderPrompts:o,contextPlaceholderADF:l,pos:t||1,typedAndDeleted:r,userHadTyped:n,canShowOnEmptyParagraph:a,showOnEmptyParagraph:i}}let f=({placeholderText:e,placeholderPrompts:t,userHadTyped:o,pos:r,canShowOnEmptyParagraph:n,showOnEmptyParagraph:a})=>({hasPlaceholder:!1,placeholderText:e,placeholderPrompts:t,userHadTyped:o,typedAndDeleted:!1,canShowOnEmptyParagraph:n,showOnEmptyParagraph:a,pos:r});function h({isInitial:e,isEditorFocused:t,editorState:l,isTypeAheadOpen:p,defaultPlaceholderText:h,intl:m,bracketPlaceholderText:g,emptyLinePlaceholder:y,placeholderADF:P,placeholderPrompts:b,typedAndDeleted:E,userHadTyped:_,isPlaceholderHidden:T,withEmptyParagraph:S,showOnEmptyParagraph:O}){if((0,n("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?T:T&&S)return{...f({placeholderText:h,placeholderPrompts:b,userHadTyped:_}),isPlaceholderHidden:T};if(p?.(l))return f({placeholderText:h,placeholderPrompts:b,userHadTyped:_});if((h||b||P)&&(0,n("2pjJ5").isEmptyDocument)(l.doc))return u({placeholderText:h,pos:1,placeholderPrompts:b,typedAndDeleted:E,userHadTyped:_});if(S){let{from:o,to:r,$to:a}=l.selection;if((h||P)&&S&&t&&!e&&!(0,n("2pjJ5").isEmptyDocument)(l.doc)&&o===r&&(0,n("l9G9n").isEmptyParagraph)(a.parent)&&(0,n("l9G9n").hasDocAsParent)(a))return O?u({placeholderText:h,pos:r,placeholderPrompts:b,typedAndDeleted:E,userHadTyped:_,canShowOnEmptyParagraph:!0,showOnEmptyParagraph:!0}):f({placeholderText:h,placeholderPrompts:b,userHadTyped:_,canShowOnEmptyParagraph:!0,showOnEmptyParagraph:!1,pos:r})}if(t&&(0,i.editorExperiment)("platform_editor_controls","variant1")){let{$from:e,$to:t}=l.selection;if(e.pos!==t.pos)return f({placeholderText:h,placeholderPrompts:b,userHadTyped:_});let p=e.node(e.depth-1),g=p?.type.name;if(y&&"doc"===g&&(0,n("l9G9n").isEmptyParagraph)(e.parent))return u({placeholderText:y,pos:e.pos,placeholderPrompts:b,typedAndDeleted:E,userHadTyped:_});let P=p?.childCount===1&&p.firstChild?.content.size===0&&p.firstChild?.type.name==="paragraph";if(r.includes(g)&&P){let t=(0,s.findParentNode)(e=>e.type===l.schema.nodes.table)(l.selection);if(!t)return f({placeholderText:h,placeholderPrompts:b,userHadTyped:_});if(t?.node.firstChild?.content.firstChild===p)return u({placeholderText:(0,n("dh538").fg)("platform_editor_ai_aifc_patch_ga")?void 0:m.formatMessage(n("hdkJi").placeholderTextMessages.shortEmptyNodePlaceholderText),contextPlaceholderADF:(0,n("dh538").fg)("platform_editor_ai_aifc_patch_ga")?d(m):void 0,pos:e.pos,placeholderPrompts:b,typedAndDeleted:E,userHadTyped:_})}return o.includes(g)&&P?u({placeholderText:(0,n("dh538").fg)("platform_editor_ai_aifc_patch_ga")?void 0:m.formatMessage(n("hdkJi").placeholderTextMessages.longEmptyNodePlaceholderText),contextPlaceholderADF:(0,n("dh538").fg)("platform_editor_ai_aifc_patch_ga")?c(m):void 0,pos:e.pos,placeholderPrompts:b,typedAndDeleted:E,userHadTyped:_}):a.includes(g)&&P&&(0,i.editorExperiment)("platform_synced_block",!0)?u({placeholderText:m.formatMessage(n("hdkJi").placeholderTextMessages.syncBlockPlaceholderText),pos:e.pos,placeholderPrompts:b,typedAndDeleted:E,userHadTyped:_}):f({placeholderText:h,placeholderPrompts:b,userHadTyped:_})}if(g&&(0,n("2pjJ5").bracketTyped)(l)&&t){let{$from:e}=l.selection;return u({placeholderText:"  "+g,pos:e.pos-1,placeholderPrompts:b,typedAndDeleted:E,userHadTyped:_})}return f({placeholderText:h,placeholderPrompts:b,userHadTyped:_})}let m=new(0,n("ks2lK").PluginKey)("placeholderPlugin");function g(e){return m.getState(e)}let y=["expand","panel"],P=["tableCell","tableHeader"],b=["bodiedSyncBlock"],E=({formatMessage:e})=>({version:1,type:"doc",content:[{type:"paragraph",content:[(0,n("iJQnc").code)(e(n("hdkJi").placeholderTextMessages.shortEmptyNodePlaceholderADFSlashShortcut)),(0,n("aoDcQ").text)(" "),(0,n("aoDcQ").text)(e(n("hdkJi").placeholderTextMessages.shortEmptyNodePlaceholderADFSuffix))]}]}),_=({formatMessage:e})=>({version:1,type:"doc",content:[{type:"paragraph",content:[(0,n("aoDcQ").text)(e(n("hdkJi").placeholderTextMessages.longEmptyNodePlaceholderADFPrefix)),(0,n("aoDcQ").text)(" "),(0,n("iJQnc").code)(e(n("hdkJi").placeholderTextMessages.longEmptyNodePlaceholderADFSlashShortcut)),(0,n("aoDcQ").text)(" "),(0,n("aoDcQ").text)(e(n("hdkJi").placeholderTextMessages.longEmptyNodePlaceholderADFSuffix))]}]}),T=(e,t,o,r=0)=>{let n=0,a="",i=[],l=(e,t)=>{let o=setTimeout(e,t);return i.push(o),o},s=()=>{let t=e[n],r=0,i=()=>{r<t.length?(o.textContent=a=t.substring(0,r+1),r++,l(i,50)):l(d,2e3)},d=()=>{a.length>1?(o.textContent=a=a.substring(0,a.length-1),l(d,40)):(o.textContent=a=" ",n=(n+1)%e.length,l(s,500))};i()};t?.push(()=>{i.forEach(e=>clearTimeout(e)),i=[]}),r>0?(o.textContent=" ",l(s,r)):s()};function S({placeholderText:e,pos:t,placeholderPrompts:o,typedAndDeleted:r,userHadTyped:n,canShowOnEmptyParagraph:a,showOnEmptyParagraph:i,contextPlaceholderADF:l}){return{hasPlaceholder:!0,placeholderText:e,placeholderPrompts:o,contextPlaceholderADF:l,pos:t||1,typedAndDeleted:r,userHadTyped:n,canShowOnEmptyParagraph:a,showOnEmptyParagraph:i}}let O=({placeholderText:e,placeholderPrompts:t,userHadTyped:o,pos:r,canShowOnEmptyParagraph:n,showOnEmptyParagraph:a})=>({hasPlaceholder:!1,placeholderText:e,placeholderPrompts:t,userHadTyped:o,typedAndDeleted:!1,canShowOnEmptyParagraph:n,showOnEmptyParagraph:a,pos:r});function x({isInitial:e,isEditorFocused:t,editorState:o,isTypeAheadOpen:r,defaultPlaceholderText:a,intl:l,bracketPlaceholderText:d,emptyLinePlaceholder:c,placeholderADF:p,placeholderPrompts:u,typedAndDeleted:f,userHadTyped:h,isPlaceholderHidden:m,withEmptyParagraph:g,showOnEmptyParagraph:T}){if((0,n("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?m:m&&g)return{...O({placeholderText:a,placeholderPrompts:u,userHadTyped:h}),isPlaceholderHidden:m};if(r?.(o))return O({placeholderText:a,placeholderPrompts:u,userHadTyped:h});if((a||u||p)&&(0,n("2pjJ5").isEmptyDocument)(o.doc))return S({placeholderText:a,pos:1,placeholderPrompts:u,typedAndDeleted:f,userHadTyped:h});if(g){let{from:r,to:i,$to:l}=o.selection;if((a||p)&&g&&t&&!e&&!(0,n("2pjJ5").isEmptyDocument)(o.doc)&&r===i&&(0,n("l9G9n").isEmptyParagraph)(l.parent)&&(0,n("l9G9n").hasDocAsParent)(l))return T?S({placeholderText:a,pos:i,placeholderPrompts:u,typedAndDeleted:f,userHadTyped:h,canShowOnEmptyParagraph:!0,showOnEmptyParagraph:!0}):O({placeholderText:a,placeholderPrompts:u,userHadTyped:h,canShowOnEmptyParagraph:!0,showOnEmptyParagraph:!1,pos:i})}if(t&&(0,i.editorExperiment)("platform_editor_controls","variant1")){let{$from:e,$to:t}=o.selection;if(e.pos!==t.pos)return O({placeholderText:a,placeholderPrompts:u,userHadTyped:h});let r=e.node(e.depth-1),d=r?.type.name;if(c&&"doc"===d&&(0,n("l9G9n").isEmptyParagraph)(e.parent))return S({placeholderText:c,pos:e.pos,placeholderPrompts:u,typedAndDeleted:f,userHadTyped:h});let p=r?.childCount===1&&r.firstChild?.content.size===0&&r.firstChild?.type.name==="paragraph";if(P.includes(d)&&p){let t=(0,s.findParentNode)(e=>e.type===o.schema.nodes.table)(o.selection);if(!t)return O({placeholderText:a,placeholderPrompts:u,userHadTyped:h});if(t?.node.firstChild?.content.firstChild===r)return S({placeholderText:(0,n("dh538").fg)("platform_editor_ai_aifc_patch_ga")?void 0:l.formatMessage(n("hdkJi").placeholderTextMessages.shortEmptyNodePlaceholderText),contextPlaceholderADF:(0,n("dh538").fg)("platform_editor_ai_aifc_patch_ga")?E(l):void 0,pos:e.pos,placeholderPrompts:u,typedAndDeleted:f,userHadTyped:h})}return y.includes(d)&&p?S({placeholderText:(0,n("dh538").fg)("platform_editor_ai_aifc_patch_ga")?void 0:l.formatMessage(n("hdkJi").placeholderTextMessages.longEmptyNodePlaceholderText),contextPlaceholderADF:(0,n("dh538").fg)("platform_editor_ai_aifc_patch_ga")?_(l):void 0,pos:e.pos,placeholderPrompts:u,typedAndDeleted:f,userHadTyped:h}):b.includes(d)&&p&&(0,i.editorExperiment)("platform_synced_block",!0)?S({placeholderText:l.formatMessage(n("hdkJi").placeholderTextMessages.syncBlockPlaceholderText),pos:e.pos,placeholderPrompts:u,typedAndDeleted:f,userHadTyped:h}):O({placeholderText:a,placeholderPrompts:u,userHadTyped:h})}if(d&&(0,n("2pjJ5").bracketTyped)(o)&&t){let{$from:e}=o.selection;return S({placeholderText:"  "+d,pos:e.pos-1,placeholderPrompts:u,typedAndDeleted:f,userHadTyped:h})}return O({placeholderText:a,placeholderPrompts:u,userHadTyped:h})}let C=({config:e,api:t})=>{let o=e?.placeholder;return{name:"placeholder",commands:{setPlaceholder:e=>({tr:t})=>o!==e?(o=e,t.setMeta(m,{placeholderText:e})):null,setAnimatingPlaceholderPrompts:e=>({tr:t})=>t.setMeta(m,{placeholderPrompts:e}),setPlaceholderHidden:e=>({tr:t})=>t.setMeta(m,{isPlaceholderHidden:e})},pmPlugins:()=>[{name:"placeholder",plugin:({getIntl:o})=>(function(e,t,o,r,a,l,s,d){if(!t&&!a&&!o&&!s)return;let c=!1,p=[],u=()=>{p.forEach(e=>e()),p=[]};return new(0,n("1S4f7").SafePlugin)({key:m,state:{init:(n,i)=>x({isInitial:!0,isEditorFocused:!!d?.focus?.sharedState.currentState()?.hasFocus,editorState:i,isTypeAheadOpen:d?.typeAhead?.actions.isOpen,defaultPlaceholderText:t,bracketPlaceholderText:o,emptyLinePlaceholder:r,placeholderADF:s,placeholderPrompts:a,typedAndDeleted:!1,userHadTyped:!1,intl:e,withEmptyParagraph:l}),apply:(i,c,p,f)=>{let h=i.getMeta(m),g=!!d?.focus?.sharedState.currentState()?.hasFocus,{userHadTyped:y,typedAndDeleted:P}=function({placeholderState:e,oldEditorState:t,newEditorState:o}){let r=!t||(0,n("2pjJ5").isEmptyDocument)(t.doc),a=(0,n("2pjJ5").isEmptyDocument)(o.doc),i=!!e?.userHadTyped||!r||r&&!a,l=i&&a&&!r||!!e?.typedAndDeleted&&a;return{userHadTyped:!(a&&!l)&&i,typedAndDeleted:l}}({placeholderState:c,oldEditorState:p,newEditorState:f}),b=c?.isPlaceholderHidden??!1;((0,n("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?h?.isPlaceholderHidden!==void 0:h?.isPlaceholderHidden!==void 0&&l)&&(b=h.isPlaceholderHidden),h?.placeholderText!==void 0&&l&&!((0,n("dh538").fg)("platform_editor_ai_aifc_patch_ga")&&s)&&(t=h.placeholderText);let E=x({isEditorFocused:g,editorState:f,isTypeAheadOpen:d?.typeAhead?.actions.isOpen,defaultPlaceholderText:l?t:h?.placeholderText??c?.placeholderText??t,bracketPlaceholderText:o,emptyLinePlaceholder:r,placeholderADF:s,placeholderPrompts:h?.placeholderPrompts??c?.placeholderPrompts??a,typedAndDeleted:P,userHadTyped:y,intl:e,isPlaceholderHidden:b,withEmptyParagraph:l,showOnEmptyParagraph:h?.showOnEmptyParagraph??c?.showOnEmptyParagraph});return E.hasPlaceholder||u(),E}},props:{decorations(e){let{hasPlaceholder:t,placeholderText:o,pos:r,typedAndDeleted:l,contextPlaceholderADF:u,showOnEmptyParagraph:f}=g(e);if(c)return;let h=d?.composition?.sharedState.currentState(),m=!!d?.showDiff?.sharedState.currentState()?.isDisplayingChanges;if(t&&(o||a||s||u)&&void 0!==r&&!h?.isComposing&&!m)return function(e,t,o,r,a=1,l=0,s,d){let c=document.createElement("span"),p=c;if(c.setAttribute("data-testid","placeholder-test-id"),c.className=d&&(0,n("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?"placeholder-decoration placeholder-decoration-fade-in":"placeholder-decoration",c.setAttribute("aria-hidden","true"),n("d7ZU3").browser.gecko){let e=document.createElement("span");e.setAttribute("contenteditable","true"),c.appendChild(e),p=e}if(t)p.textContent=t||" ";else if(s){let t=n("5SAOw").DOMSerializer.fromSchema(e.schema),o=(0,n("6tl2G").processRawValue)(e.schema,s);o&&(o.children.forEach(e=>{if("paragraph"===e.type.name)e.content.forEach(e=>{let o=t.serializeNode(e);p.append(o)});else{let o=t.serializeNode(e);p.append(o)}}),p.querySelectorAll('[data-prosemirror-content-type="mark"]').forEach(e=>{e instanceof HTMLElement&&e.style.setProperty("color","var(--ds-text-subtlest, #6B6E76)")}),p.querySelectorAll("*").forEach(e=>{e instanceof HTMLElement&&(e.style.pointerEvents="none",e.style.userSelect="none")}))}else o&&T(o,r,p,l);if(n("d7ZU3").browser.android&&n("d7ZU3").browser.chrome){let e=document.createElement("span");e.setAttribute("class","placeholder-android"),e.setAttribute("contenteditable","true"),e.textContent=" ",c.appendChild(e)}return e.doc.resolve(a).depth>1&&(0,i.editorExperiment)("platform_editor_controls","variant1")&&c.classList.add("placeholder-decoration-hide-overflow"),n("ftzrq").DecorationSet.create(e.doc,[n("ftzrq").Decoration.widget(a,c,{side:0,key:`placeholder ${t}`})])}(e,o??"",a,p,r,1500*!!l,u||s,f)}},view(){let e;function t(t){e||(e=setTimeout(()=>{e=void 0,t.dispatch(t.state.tr.setMeta(m,{showOnEmptyParagraph:!0}))},2e3))}function o(){e&&(clearTimeout(e),e=void 0)}return{update(r,n){if(l){let a=g(n),i=g(r.state);!i.canShowOnEmptyParagraph&&e?o():a.canShowOnEmptyParagraph&&i.canShowOnEmptyParagraph&&i.pos!==a.pos?(r.dispatch(r.state.tr.setMeta(m,{showOnEmptyParagraph:!1})),o(),t(r)):a.canShowOnEmptyParagraph||!i.canShowOnEmptyParagraph||i.showOnEmptyParagraph||e||t(r)}},destroy(){u(),o(),c=!0}}}})})(o(),e&&e.placeholder,e&&e.placeholderBracketHint,e&&e.emptyLinePlaceholder,e&&e.placeholderPrompts,e?.withEmptyParagraph,e&&e.placeholderADF,t)}]}},k=new(0,n("ks2lK").PluginKey)("placeholderPlugin");e.exports.EMPTY_PARAGRAPH_TIMEOUT_DELAY=2e3,e.exports.pluginKey=k,e.exports.placeholderPlugin=({config:e,api:t})=>{if(!(0,n("dh538").fg)("platform_editor_placeholder_plugin_tidying"))return C({config:e,api:t});let o=e?.placeholder;return{name:"placeholder",commands:{setPlaceholder:e=>({tr:t})=>o!==e?(o=e,t.setMeta(k,{placeholderText:e})):null,setAnimatingPlaceholderPrompts:e=>({tr:t})=>t.setMeta(k,{placeholderPrompts:e}),setPlaceholderHidden:e=>({tr:t})=>t.setMeta(k,{isPlaceholderHidden:e})},pmPlugins:()=>[{name:"placeholder",plugin:({getIntl:o})=>(function(e,t,o,r,a,s,d,c){if(!t&&!a&&!o&&!d)return;let u=!1,f=[],m=()=>{f.forEach(e=>e()),f=[]};return new(0,n("1S4f7").SafePlugin)({key:n("kYgUn").pluginKey,state:{init:(n,i)=>h({isInitial:!0,isEditorFocused:!!c?.focus?.sharedState.currentState()?.hasFocus,editorState:i,isTypeAheadOpen:c?.typeAhead?.actions.isOpen,defaultPlaceholderText:t,bracketPlaceholderText:o,emptyLinePlaceholder:r,placeholderADF:d,placeholderPrompts:a,typedAndDeleted:!1,userHadTyped:!1,intl:e,withEmptyParagraph:s}),apply:(i,l,p,u)=>{let f=i.getMeta(n("kYgUn").pluginKey),g=!!c?.focus?.sharedState.currentState()?.hasFocus,{userHadTyped:y,typedAndDeleted:P}=function({placeholderState:e,oldEditorState:t,newEditorState:o}){let r=!t||(0,n("2pjJ5").isEmptyDocument)(t.doc),a=(0,n("2pjJ5").isEmptyDocument)(o.doc),i=!!e?.userHadTyped||!r||r&&!a,l=i&&a&&!r||!!e?.typedAndDeleted&&a;return{userHadTyped:!(a&&!l)&&i,typedAndDeleted:l}}({placeholderState:l,oldEditorState:p,newEditorState:u}),b=l?.isPlaceholderHidden??!1;((0,n("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?f?.isPlaceholderHidden!==void 0:f?.isPlaceholderHidden!==void 0&&s)&&(b=f.isPlaceholderHidden),f?.placeholderText!==void 0&&s&&!((0,n("dh538").fg)("platform_editor_ai_aifc_patch_ga")&&d)&&(t=f.placeholderText);let E=h({isEditorFocused:g,editorState:u,isTypeAheadOpen:c?.typeAhead?.actions.isOpen,defaultPlaceholderText:s?t:f?.placeholderText??l?.placeholderText??t,bracketPlaceholderText:o,emptyLinePlaceholder:r,placeholderADF:d,placeholderPrompts:f?.placeholderPrompts??l?.placeholderPrompts??a,typedAndDeleted:P,userHadTyped:y,intl:e,isPlaceholderHidden:b,withEmptyParagraph:s,showOnEmptyParagraph:f?.showOnEmptyParagraph??l?.showOnEmptyParagraph});return E.hasPlaceholder||m(),E}},props:{decorations(e){let{hasPlaceholder:t,placeholderText:o,pos:r,typedAndDeleted:s,contextPlaceholderADF:h,showOnEmptyParagraph:m}=p(e);if(u)return;let g=c?.composition?.sharedState.currentState(),y=!!c?.showDiff?.sharedState.currentState()?.isDisplayingChanges;if(t&&(o||a||d||h)&&void 0!==r&&!g?.isComposing&&!y)return function(e,t,o,r,a=1,s=0,d,c){let p=document.createElement("span"),u=p;if(p.setAttribute("data-testid","placeholder-test-id"),p.className=c&&(0,n("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?"placeholder-decoration placeholder-decoration-fade-in":"placeholder-decoration",p.setAttribute("aria-hidden","true"),n("d7ZU3").browser.gecko){let e=document.createElement("span");e.setAttribute("contenteditable","true"),p.appendChild(e),u=e}if(t)u.textContent=t||" ";else if(d){let t=n("5SAOw").DOMSerializer.fromSchema(e.schema),o=(0,n("6tl2G").processRawValue)(e.schema,d);o&&(o.children.forEach(e=>{if("paragraph"===e.type.name)e.content.forEach(e=>{let o=t.serializeNode(e);u.append(o)});else{let o=t.serializeNode(e);u.append(o)}}),u.querySelectorAll('[data-prosemirror-content-type="mark"]').forEach(e=>{e instanceof HTMLElement&&e.style.setProperty("color","var(--ds-text-subtlest, #6B6E76)")}),u.querySelectorAll("*").forEach(e=>{e instanceof HTMLElement&&(e.style.pointerEvents="none",e.style.userSelect="none")}))}else o&&l(o,r,u,s);if(n("d7ZU3").browser.android&&n("d7ZU3").browser.chrome){let e=document.createElement("span");e.setAttribute("class","placeholder-android"),e.setAttribute("contenteditable","true"),e.textContent=" ",p.appendChild(e)}return e.doc.resolve(a).depth>1&&(0,i.editorExperiment)("platform_editor_controls","variant1")&&p.classList.add("placeholder-decoration-hide-overflow"),n("ftzrq").DecorationSet.create(e.doc,[n("ftzrq").Decoration.widget(a,p,{side:0,key:`placeholder ${t}`})])}(e,o??"",a,f,r,1500*!!s,h||d,m)}},view(){let e;function t(t){e||(e=setTimeout(()=>{e=void 0,t.dispatch(t.state.tr.setMeta(n("kYgUn").pluginKey,{showOnEmptyParagraph:!0}))},n("kYgUn").EMPTY_PARAGRAPH_TIMEOUT_DELAY))}function o(){e&&(clearTimeout(e),e=void 0)}return{update(r,a){if(s){let i=p(a),l=p(r.state);!l.canShowOnEmptyParagraph&&e?o():i.canShowOnEmptyParagraph&&l.canShowOnEmptyParagraph&&l.pos!==i.pos?(r.dispatch(r.state.tr.setMeta(n("kYgUn").pluginKey,{showOnEmptyParagraph:!1})),o(),t(r)):i.canShowOnEmptyParagraph||!l.canShowOnEmptyParagraph||l.showOnEmptyParagraph||e||t(r)}},destroy(){m(),o(),u=!0}}}})})(o(),e&&e.placeholder,e&&e.placeholderBracketHint,e&&e.emptyLinePlaceholder,e&&e.placeholderPrompts,e?.withEmptyParagraph,e&&e.placeholderADF,t)}]}}}),a("iJQnc",function(e,t){e.exports.code=e=>(0,n("gKlAz").applyMark)({type:"code"},e)}),a("gKlAz",function(e,t){e.exports.applyMark=function(e,t){var o,r;let a="string"==typeof t?(0,n("aoDcQ").text)(t):t;return(o=e.type,a.marks&&a.marks.some(e=>e.type===o)||0)?(console.error((r=e.type,`Mark with the same name '${r}' already exists on a node: ${JSON.stringify(a)}`)),a):(a.marks=a.marks||[],a.marks.push(e),a)}}),a("itirX",function(e,t){let o=e=>({name:t,component:o})=>{e.set(t,o)};var r=n("iu6m9");let a=({componentRegistry:e,editorState:t,contextualFormattingEnabled:o})=>{let a;if(o&&(0,r.editorExperiment)("platform_editor_controls","variant1",{exposure:!0}))a=T(!0,(0,n("dh538").fg)("platform_editor_undo_redo_find_on_primary_toolbar"));else{let t=!!o;a=e.has("trackChanges")?b(t):E(t)}return a.filter(o=>void 0===o.enabled||o.enabled(e,t)).reduce((t,o)=>{if(e.has(o.name)){let r=e.get(o.name);r&&t.push(r)}return t},[])},i=[{name:"separator",enabled:e=>e.has("undoRedo")||e.has("trackChanges")},{name:"undoRedoPlugin",enabled:e=>e.has("undoRedoPlugin")},{name:"trackChanges",enabled:e=>e.has("trackChanges")}],l=[{name:"undoRedoPlugin"},{name:"separator",enabled:e=>e.has("undoRedoPlugin")}],s=[{name:"spellCheck"},{name:"separator",enabled:e=>e.has("spellCheck")}],d=[{name:"blockType"},{name:"separator",enabled:(e,t)=>e.has("blockType")&&!!t.schema.nodes.heading}],c=[{name:"textFormatting"},{name:"separator",enabled:e=>e.has("textFormatting")}],p=[{name:"alignment"},{name:"separator",enabled:e=>e.has("alignment")}],u=[{name:"textColor"},{name:"highlight"},{name:"separator",enabled:e=>e.has("textColor")||e.has("highlight")}],f=[{name:"toolbarListsIndentation"},{name:"separator",enabled:e=>e.has("toolbarListsIndentation")}],h=[{name:"hyperlink"},{name:"separator",enabled:e=>e.has("hyperlink")}],m=[{name:"insertBlock"}],g=[{name:"beforePrimaryToolbar"},{name:"avatarGroup"},{name:"findReplace"},{name:"aiExperience"},{name:"loom"}],y=[{name:"beforePrimaryToolbar"},{name:"avatarGroup"},{name:"aiExperience"},{name:"loom"}],P=[{name:"findReplace"}],b=e=>[...s,...d,...c,...p,...u,...f,...m,...e?g:y,...i],E=e=>[...l,...s,...d,...c,...p,...u,...f,...m,...e?g:y],_=[{name:"pinToolbar"}],T=(e,t,o=!1)=>[...t?l:[],...d,...c,...u,...p,...f,...h,...e?m:[],{name:"selectionExtension"},..._,{name:"beforePrimaryToolbar"},...o?P:[]],S=new(0,n("ks2lK").PluginKey)("primaryToolbar"),O=({componentRegistry:e,contextualFormattingEnabled:t})=>new(0,n("1S4f7").SafePlugin)({key:S,state:{init:(o,r)=>({components:a({componentRegistry:e,editorState:r,contextualFormattingEnabled:t})}),apply:(e,t)=>t}});var x=()=>(0,n("9K4OG").jsx)("span",{css:n("cORDs").wrapperStyle},(0,n("9K4OG").jsx)("span",{"data-vc":"primary-toolbar-separator",css:n("cORDs").separatorStyles}));e.exports.primaryToolbarPlugin=({config:e})=>{let t=new Map;return t.set("separator",x),{name:"primaryToolbar",actions:{registerComponent:o(t)},pmPlugins:()=>[{name:"primaryToolbar",plugin:()=>O({componentRegistry:t,contextualFormattingEnabled:e?.contextualFormattingEnabled})}],getSharedState(e){if(e)return S.getState(e)}}}}),a("bULcr",function(e,t){let o=(e,t)=>{if(e.depth>=3&&t.depth>=3&&e.depth===t.depth){let o=e.node(e.depth-1),r=e.node(e.depth-2),n=t.node(e.depth-1);if(t.node(e.depth-2).eq(r)&&["bulletList","orderedList"].includes(r.type.name)&&r.firstChild?.eq(o)&&r.lastChild?.eq(n))return!0}return!1},r=e=>{let{from:t,to:r}=e;if(t===r)return n("5SAOw").Fragment.empty;let a=n("5SAOw").Fragment.empty;for(let t of[...e.ranges.slice()].sort((e,t)=>e.$from.pos-t.$from.pos)){let{$from:r,$to:i}=t,l=i.pos,s=e instanceof n("ks2lK").TextSelection&&r.parent.eq(i.parent)?Math.max(0,r.sharedDepth(l)-1):r.sharedDepth(l);o(r,i)&&(s=r.depth-3);let d=r.start(s),c=r.node(s).content.cut(r.pos-d,i.pos-d);a=a.append(c)}return a},a=e=>()=>{let t=e?.selection.sharedState?.currentState()?.selection,o=e?.core.sharedState.currentState()?.schema;if(!t||!o||t.empty)return null;let a=r(t).content,i=[];return a.forEach(e=>{i.push((0,n("h9yJL").nodeToJSON)(e))}),i},i=e=>()=>{let t=e?.selection.sharedState?.currentState()?.selection;if(t?.empty&&e?.core.actions.execute(({tr:e})=>(t=e.selection,null)),!t)return null;if(t instanceof n("ks2lK").NodeSelection)return[t.node.attrs.localId];if(t.empty)return[t.$from.parent.attrs.localId];let o=r(t).content,a=[];return o.forEach(e=>{let t=e.attrs?.localId;t&&a.push(t)}),a},l=new(0,n("ks2lK").PluginKey)("autoExpandSelectionRangeOnInlineNodePlugin"),s=()=>{let e=null;return new(0,n("1S4f7").SafePlugin)({key:l,props:{handleDOMEvents:{mousedown:(t,o)=>{e=o.target},mouseup:(t,o)=>{let r=o.target;if(!e||e===r){e=null;return}if(e=null,!d(r))return;let{dispatch:a,state:i}=t,{selection:l}=i;if(!(l instanceof n("ks2lK").TextSelection))return;let s=t.posAtDOM(r,0),c=l.$anchor.pos<=s;a(i.tr.setSelection(n("ks2lK").TextSelection.create(i.doc,l.$anchor.pos,c?s+1:s)))}}}})},d=e=>{let t=["emoji","status","date","mention","inlineCard"].map(e=>`.${e}View-content-wrap`).join(", ");return!!e.closest(t)},c=new(0,n("ks2lK").PluginKey)("selection");var p,u,f,h,m=((p={})[p.Before=-1]="Before",p[p.After=1]="After",p),g=((u={}).SET_DECORATIONS="SET_DECORATIONS",u.SET_RELATIVE_SELECTION="SET_RELATIVE_SELECTION",u),y=n("8m4tT");let P=`
	position: absolute;
	pointer-events: none;
	width: 0;
	height: 0;
`,b=()=>{let e=document.createElement("span");return e.className="ProseMirror-hide-cursor",e.setAttribute("style",P),e},E=()=>n("ftzrq").Decoration.widget(0,b,{key:"hide-cursor-decoration",side:-1}),_=(e,t,o)=>{let r=e.selection,a=[];if(o&&(0,n("dh538").fg)("platform_editor_ai_generic_prep_for_aifc_2")&&a.push(E()),r instanceof n("ks2lK").NodeSelection)return a.push(n("ftzrq").Decoration.node(r.from,r.to,{class:n("aFUXX").akEditorSelectedNodeClassName})),n("ftzrq").DecorationSet.create(e.doc,a);if(r instanceof n("ks2lK").TextSelection||r instanceof n("ks2lK").AllSelection){t&&t.anchor>=0&&t.head>=0&&t.anchor<=e.doc.nodeSize&&t.head<=e.doc.nodeSize&&(r=n("ks2lK").TextSelection.create(e.doc,t.anchor,t.head));let o=S(r,e.doc).map(({node:e,pos:t})=>n("ftzrq").Decoration.node(t,t+e.nodeSize,{class:n("aFUXX").akEditorSelectedNodeClassName}));return a.push(...o),n("ftzrq").DecorationSet.create(e.doc,a)}return a.length>0?n("ftzrq").DecorationSet.create(e.doc,a):n("ftzrq").DecorationSet.empty},T=["table","panel","expand","layoutSection","decisionList","decisionItem","codeBlock"],S=(e,t)=>{let o=[];if(e.from!==e.to){let{from:r,to:n}=e;t.nodesBetween(r,n,(e,t)=>{let a=r<=t&&t+e.nodeSize<=n,i=T.includes(e.type.name);return e&&a&&i?(o.push({node:e,pos:t}),!1):(e&&a&&!e.isText&&o.push({node:e,pos:t}),!0)})}return o},O=e=>!!(e&&!e.isAtom&&n("ks2lK").NodeSelection.isSelectable(e)),x=e=>!!(e&&(e.isText||(0,n("l9G9n").isEmptyParagraph)(e)||n("ks2lK").NodeSelection.isSelectable(e))),C=e=>{let t=!1,o=(0,y.findParentNode)(e=>{let o=O(e);return o||(0,n("4Wd8f").isIgnored)(e)||(t=!0),o})(e);if(!t)return o},k=(e,t)=>{e.parent.inlineContent&&O(e.parent)&&(e=t.resolve(e.start()-1));let o=n("ks2lK").Selection.findFrom(e,-1);if(o){let r=t.resolve(o.from);for(let t=e.depth+1;t<=r.depth;t++){let o=r.node(t);if(O(o))return{node:o,pos:r.start(t)-1};if(t>e.depth+1&&!(0,n("4Wd8f").isIgnored)(o))return}if(o instanceof n("ks2lK").NodeSelection&&n("ks2lK").NodeSelection.isSelectable(o.node))return{node:o.node,pos:o.from}}},A=(e,t)=>{let o=n("ks2lK").Selection.findFrom(e,1);if(o){let r=t.resolve(o.from);for(let t=e.depth+1;t<=r.depth;t++){let o=r.node(t);if(O(o))return{node:o,pos:r.start(t)-1};if(t>e.depth+1&&!(0,n("4Wd8f").isIgnored)(o))return}}},v=e=>(0,y.flatten)(e).find(e=>x(e.node)||!(0,n("4Wd8f").isIgnored)(e.node)),N=e=>{let t;if(e.descendants((e,o)=>{if(x(e)||!(0,n("4Wd8f").isIgnored)(e))return t={node:e,pos:o},!1}),t)return t},w=(e,t)=>(0,n("l6okE").isSelectionAtStartOfNode)(e,C(t)?.node),R=(e,t)=>{let o=e.parent.content.size===e.parentOffset;if(!o)return!1;if(0===e.depth||n("ks2lK").NodeSelection.isSelectable(e.parent))return o;if((0,y.hasParentNode)(n("irKZA").isListItemNode)(t)&&I(e,t)||L(e))return!1;let r=e.doc.resolve(e.after());return r.parent.content.size===r.parentOffset},I=(e,t)=>{if(!(0,y.hasParentNode)(D)(t))return!1;let o=(0,y.findParentNodeClosestToPos)(e,n("irKZA").isListItemNode);if(!o)return!1;let r=e.doc.resolve(o.pos),a=M(e);if(!a)return!1;let i=e.doc.resolve(a.pos+a.node.nodeSize).nodeAfter,l=(0,y.findParentNodeClosestToPos)(e.doc.resolve(r.before()),n("irKZA").isListItemNode),s=l?e.doc.resolve(l.pos):void 0;return r.index()!==r.parent.childCount-1||!!l&&(!s||s.index()!==s.parent.childCount-1)||!!i},D=e=>{let{layoutColumn:t,panel:o,expand:r}=e?.type?.schema?.nodes||{};return!!(e&&e.type&&[o,r,t].includes(e.type))},M=e=>{let t,{bulletList:o,orderedList:r}=e.doc.type.schema.nodes,n=e.depth;for(;n>0;){let a=e.node(n);[o,r].includes(a.type)&&(t={node:a,pos:e.before(n)}),n--}return t},L=e=>{let t=(0,y.findParentNodeClosestToPos)(e,B);if(!t)return!1;let o=(0,y.findParentNodeClosestToPos)(e,K);if(o&&o.pos>t.pos&&(0,n("dh538").fg)("platform_editor_fix_list_item_nav_bug_in_layout"))return!1;let r=e.depth-1;if(r<0)return!1;let{layoutColumn:a}=e.doc.type.schema.nodes,i=e.node(r),l=t.pos+t.node.nodeSize,s=e.doc.resolve(l);return(0,n("dh538").fg)("platform_editor_fix_list_item_nav_bug_in_layout")?!!s.nodeAfter:!!s.nodeAfter&&i.type===a},B=e=>{let{layoutColumn:t}=e?.type?.schema?.nodes||{};return!!(e&&e.type&&e.type===t)},K=e=>{let{panel:t,expand:o}=e?.type?.schema?.nodes||{};return!!(e&&e.type&&(e.type===t||e.type===o))},{createCommand:U,getPluginState:F,createPluginState:V}=(0,n("lkJUe").pluginFactory)(c,function(e,t){switch(t.type){case g.SET_DECORATIONS:return{...e,decorationSet:t.decorationSet,selection:t.selection};case g.SET_RELATIVE_SELECTION:return{...e,selectionRelativeToNode:t.selectionRelativeToNode};default:return e}},{onDocChanged:(e,t)=>{try{if(0===t.decorationSet.find().length&&(!e.selectionSet||0===_(e).find().length))return t;let o=t.decorationSet.map(e.mapping,e.doc);return{...t,decorationSet:o}}catch(e){return{...t,decorationSet:n("ftzrq").DecorationSet.empty}}},onSelectionChanged:(e,t)=>(e.selection instanceof n("ks2lK").NodeSelection&&O(e.selection.node)||e.selection instanceof n("7XFGZ").CellSelection)&&!e.getMeta(c)?{...t,selectionRelativeToNode:void 0}:t}),G=(e,t)=>({tr:o})=>(o.setMeta(c,{type:g.SET_RELATIVE_SELECTION,selectionRelativeToNode:e}),t)?o.setSelection(t):o,H=(e,t)=>U({type:g.SET_RELATIVE_SELECTION,selectionRelativeToNode:e},o=>G(e,t)({tr:o})||o),W=(e,t)=>{let{selection:o}=e;return o instanceof n("adhil").GapCursorSelection?z(o)(e,t):o instanceof n("ks2lK").NodeSelection?q(o)(e,t):o instanceof n("ks2lK").TextSelection&&Y(o)(e,t)},j=(e,t)=>{let{selection:o}=e;return o instanceof n("adhil").GapCursorSelection?$(o)(e,t):o instanceof n("ks2lK").NodeSelection?X(o)(e,t):o instanceof n("ks2lK").TextSelection&&J(o)(e,t)},z=e=>(t,o)=>{let{$from:r,$to:a,side:i}=e;if(i===n("adhil").Side.LEFT){let e=A(a,t.doc);if(e)return H(n("cQ4aK").RelativeSelectionPos.Start,n("ks2lK").NodeSelection.create(t.doc,e.pos))(t,o)}else if(i===n("adhil").Side.RIGHT&&R(r,e)){let r=C(e);if(r)return H(n("cQ4aK").RelativeSelectionPos.End,n("ks2lK").NodeSelection.create(t.doc,r.pos))(t,o)}return!1},$=e=>(t,o)=>{let{$from:r,side:a}=e,{selectionRelativeToNode:i}=F(t);if(a===n("adhil").Side.RIGHT){let e=k(r,t.doc);if(e)return H(n("cQ4aK").RelativeSelectionPos.End,n("ks2lK").NodeSelection.create(t.doc,e.pos))(t,o)}else if(a===n("adhil").Side.LEFT&&w(r,e))if(i===n("cQ4aK").RelativeSelectionPos.Before){let r=t.doc.resolve(e.$from.before(e.$from.depth));if(r){let e=k(r,t.doc);if(e&&(0,n("4Wd8f").isIgnored)(e.node))return H(n("cQ4aK").RelativeSelectionPos.End,n("ks2lK").NodeSelection.create(t.doc,e.pos))(t,o)}H()(t,o)}else{let r=C(e);if(r)return H(n("cQ4aK").RelativeSelectionPos.Start,n("ks2lK").NodeSelection.create(t.doc,r.pos))(t,o)}return!1},q=e=>(t,o)=>{let{node:r,from:a,$to:i}=e,{selectionRelativeToNode:l}=F(t);if(r.isAtom){if(R(i,e)&&(r.isInline||(0,n("4Wd8f").isIgnored)(r)))return Z(n("cQ4aK").RelativeSelectionPos.End,t.doc.resolve(a+1),m.After)(t,o)}else if(l===n("cQ4aK").RelativeSelectionPos.Start)return Q(n("cQ4aK").RelativeSelectionPos.Inside,r,a)(t,o);else if((0,n("4Wd8f").isIgnored)(r)&&(!l||l===n("cQ4aK").RelativeSelectionPos.End)){let e=A(i,t.doc);if(e&&(0,n("4Wd8f").isIgnored)(e.node))return H(n("cQ4aK").RelativeSelectionPos.Start,n("ks2lK").NodeSelection.create(t.doc,e.pos))(t,o)}return!1},X=e=>(t,o)=>{let{node:r,from:a,to:i,$from:l}=e,{selectionRelativeToNode:s}=F(t);if(r.isAtom){if(w(l,e)&&(r.isInline||(0,n("4Wd8f").isIgnored)(r)))return Z(n("cQ4aK").RelativeSelectionPos.Start,t.doc.resolve(a),m.Before)(t,o)}else if(s===n("cQ4aK").RelativeSelectionPos.End)return ee(n("cQ4aK").RelativeSelectionPos.Inside,r,a,i)(t,o);else if(!s||s===n("cQ4aK").RelativeSelectionPos.Inside)return Q(n("cQ4aK").RelativeSelectionPos.Before,r,a)(t,o);else if((0,n("4Wd8f").isIgnored)(r)&&s===n("cQ4aK").RelativeSelectionPos.Start){let e=k(l,t.doc);if(e&&(0,n("4Wd8f").isIgnored)(e.node))return H(n("cQ4aK").RelativeSelectionPos.End,n("ks2lK").NodeSelection.create(t.doc,e.pos))(t,o)}return!1},Y=e=>(t,o)=>{if(R(e.$to,e)){let r=C(e);if(r)return H(n("cQ4aK").RelativeSelectionPos.End,n("ks2lK").NodeSelection.create(t.doc,r.pos))(t,o)}return!1},J=e=>(t,o)=>{let{selectionRelativeToNode:r}=F(t);if(r===n("cQ4aK").RelativeSelectionPos.Before){let r=k(e.$from,t.doc);if(r&&(0,n("4Wd8f").isIgnored)(r.node))return H(n("cQ4aK").RelativeSelectionPos.End,n("ks2lK").NodeSelection.create(t.doc,r.pos))(t,o);H(void 0)(t,o)}else if(w(e.$from,e)){let r=C(e);if(r)return H(n("cQ4aK").RelativeSelectionPos.Start,n("ks2lK").NodeSelection.create(t.doc,r.pos))(t,o)}return!1},Z=(e,t,o)=>(r,a)=>{let i=n("ks2lK").Selection.findFrom(t,o,!0);return!!i&&H(e,i)(r,a)},Q=(e,t,o)=>(r,a)=>{if((0,n("l9G9n").isNodeEmpty)(t))return Z(e,r.doc.resolve(o),m.After)(r,a);let i=v(t);if(i){let{node:l,pos:s}=i,d=o+s+1;if(l.isText||l.isAtom&&(0,n("4Wd8f").isIgnored)(l)||l.isInline)return Z(e,r.doc.resolve(d),m.Before)(r,a);if((0,n("l9G9n").isEmptyParagraph)(l))return Z(e,r.doc.resolve(d+1),m.Before)(r,a);if(!(0,n("4Wd8f").isIgnored)(t))return H(e,new(0,n("adhil").GapCursorSelection)(r.doc.resolve(d),n("adhil").Side.LEFT))(r,a);else if(O(t))return H(e,n("ks2lK").NodeSelection.create(r.doc,d))(r,a)}return!1},ee=(e,t,o,r)=>(a,i)=>{if((0,n("l9G9n").isNodeEmpty)(t))return Z(e,a.doc.resolve(r),m.Before)(a,i);let l=N(t);if(l){let{node:r,pos:s}=l,d=o+s+r.nodeSize;if(r.isText||r.isAtom&&(0,n("4Wd8f").isIgnored)(r)||r.isInline)return Z(e,a.doc.resolve(d+1),m.After)(a,i);if((0,n("l9G9n").isEmptyParagraph)(r))return Z(e,a.doc.resolve(d),m.After)(a,i);if(!(0,n("4Wd8f").isIgnored)(t))return H(e,new(0,n("adhil").GapCursorSelection)(a.doc.resolve(d+1),n("adhil").Side.RIGHT))(a,i);else if(O(t))return H(e,n("ks2lK").NodeSelection.create(a.doc,d))(a,i)}return!1},et=new(0,n("ks2lK").PluginKey)("gapCursorPlugin");var eo=((f={}).UP="up",f.RIGHT="right",f.DOWN="down",f.LEFT="left",f.BACKWARD="backward",f.FORWARD="forward",f);function er(e){return -1!==["up","left","backward"].indexOf(e)}function en(e){return -1!==["right","down","forward"].indexOf(e)}let ea={BLOCK_CONTAINER:"unsupportedBlockView-content-wrap"};var ei=n("iu6m9");let el=e=>e===n("adhil").Side.LEFT,es=(e,t,o,r)=>{let n=o,a=-1===r?n.nodeBefore:n.nodeAfter;if(a&&(a.isTextblock||a.isText))return!0;for(;n.depth>0;){if(!(n=e.resolve(-1===r?n.before():n.after()))||!(a=(-1===r?n.nodeBefore:n.nodeAfter)||n.parent)||a.type===t.nodes.doc)return!1;if(a.isTextblock)return!0}let i=a;for(;i&&i.firstChild;)if((i=i.firstChild)&&(i.isTextblock||i.isText))return!0;return!1};function ed(e){let t;return(e.attrs.layout&&(t=e.attrs.layout),e.marks&&e.marks.length&&(t=(e.marks.find(e=>"breakout"===e.type.name)||{attrs:{mode:""}}).attrs.mode),"table"===e.type.name&&e.attrs.width&&(t="fixed-width"),-1===["wide","full-width","fixed-width"].indexOf(t))?"":t}let ec=e=>{let t;if(e?.nodeName==="BUTTON"||e?.closest("button")||e?.closest(`[data-id="${n("gAARK").CAPTION_PLACEHOLDER_ID}"]`))return!0;let o=e;for(;o;){if(o.className&&(o.getAttribute("class")||"").indexOf(n("1zav4").TableSharedCssClassName.TABLE_CONTAINER)>-1){t=o;break}o=o.parentNode}if(t){let o=t.querySelector(`.${n("1zav4").TableSharedCssClassName.TABLE_ROW_CONTROLS_WRAPPER}`),r=e&&e.classList&&e.classList.contains(n("1zav4").TableSharedCssClassName.TABLE_COLUMN_CONTROLS_DECORATIONS);return o&&o.contains(e)||r}return!!e?.closest(`.${ea.BLOCK_CONTAINER}`)},ep=(e,t,o)=>{if(t&&"table"===t.type.name){let t=e.querySelector(".pm-table-container");if(t)return window.getComputedStyle(t)}if((0,ei.editorExperiment)("advanced_layouts",!0)&&t&&"layoutSection"===t.type.name){let t=e.querySelector(".layout-section-container");if(t)return window.getComputedStyle(t)}return o},eu=(e,t,o)=>{let{doc:r,schema:a}=t;switch(e){case eo.UP:if((0,n("l6okE").atTheBeginningOfDoc)(t))return!1;return(0,n("caYZ2").isPositionNearTableRow)(o,a,"before")||es(r,a,o,-1)||(0,n("7iE7T").isNodeBeforeMediaNode)(o,t);case eo.DOWN:return(0,n("l6okE").atTheEndOfDoc)(t)||es(r,a,o,1)||(0,n("caYZ2").isPositionNearTableRow)(o,a,"after")||o.nodeBefore?.type.name==="text"&&!o.nodeAfter;default:return!1}},ef=(e,t)=>(o,r,a)=>{let{doc:i,selection:l,tr:s}=o,d=er(e)?l.$from:l.$to,c=l.empty;if(l instanceof n("ks2lK").TextSelection){if(!t||!t(e.toString())||eu(e,o,d))return!1;d=i.resolve(er(e)?d.before():d.after()),c=!1}if(l instanceof n("ks2lK").NodeSelection&&(l.node.isInline||e===eo.UP&&!(0,n("l6okE").atTheBeginningOfDoc)(o)&&!(0,n("7iE7T").isNodeBeforeMediaNode)(d,o)||e===eo.DOWN))return!1;if(function(e,t){let{selection:o}=t,r=o instanceof n("adhil").GapCursorSelection&&e===eo.UP&&o.$from.nodeBefore&&(0,n("7iE7T").isMediaNode)(o.$from.nodeBefore),a=o instanceof n("adhil").GapCursorSelection&&e===eo.DOWN&&o.$from.nodeAfter?.type.name==="mediaGroup";return r||a}(e,o)){let t=function(e,t){let{selection:o,tr:r}=t,a=er(e)?o.$from:o.$to;if(e===eo.UP&&o.$from.nodeBefore&&(0,n("7iE7T").isMediaNode)(o.$from.nodeBefore)){let e=(0,y.findPositionOfNodeBefore)(r.selection);e&&"right"===o.side&&r.doc.nodeAt(e)?.type.name==="mediaSingle"?r.setSelection(new(0,n("ks2lK").NodeSelection)(r.doc.resolve(e))).scrollIntoView():(e||0===e)&&r.setSelection(new(0,n("adhil").GapCursorSelection)(r.doc.resolve(e),n("adhil").Side.LEFT)).scrollIntoView()}if(e===eo.DOWN&&o.$from.nodeAfter){let e="right"===o.side?a.pos:a.pos+o.$from.nodeAfter.nodeSize;e&&r.setSelection(new(0,n("adhil").GapCursorSelection)(r.doc.resolve(e),n("adhil").Side.LEFT)).scrollIntoView()}return r}(e,o);return r&&r(t),!0}if(l instanceof n("adhil").GapCursorSelection&&(0,n("1gpr6").isValidTargetNode)(er(e)?d.nodeBefore:d.nodeAfter)&&(er(e)&&l.side===n("adhil").Side.LEFT||en(e)&&l.side===n("adhil").Side.RIGHT))return r&&r(s.setSelection(new(0,n("adhil").GapCursorSelection)(d,l.side===n("adhil").Side.RIGHT?n("adhil").Side.LEFT:n("adhil").Side.RIGHT)).scrollIntoView()),!0;if(a){let e=a.domAtPos.bind(a),t=(0,y.findDomRefAtPos)(d.pos,e);if(t&&t.textContent===n("TfRUG").ZERO_WIDTH_SPACE)return!1}let p=n("adhil").GapCursorSelection.findFrom(d,er(e)?-1:1,c);return!!p&&((0,n("1gpr6").isValidTargetNode)(en(e)?p.$from.nodeBefore:p.$from.nodeAfter)?r&&r(s.setSelection(p).scrollIntoView()):r&&r(s.setSelection(new(0,n("adhil").GapCursorSelection)(p.$from,en(e)?n("adhil").Side.LEFT:n("adhil").Side.RIGHT)).scrollIntoView()),!0)},eh=e=>(t,o)=>{if(t.selection instanceof n("adhil").GapCursorSelection){let{$from:r,$anchor:a}=t.selection,{tr:i}=t;if(er(e)){if("left"===t.selection.side)return i.setSelection(new(0,n("adhil").GapCursorSelection)(a,n("adhil").Side.RIGHT)),o&&o(i),!0;i=(0,y.removeNodeBefore)(t.tr)}else r.nodeAfter&&(i=i.delete(r.pos,r.pos+r.nodeAfter.nodeSize));return o&&o(i.setSelection(n("ks2lK").Selection.near(i.doc.resolve(i.mapping.map(t.selection.$from.pos)))).scrollIntoView()),!0}return!1},em={"tableView-content-wrap":"table","mediaSingleView-content-wrap":".rich-media-item","bodiedExtensionView-content-wrap":".extension-container","multiBodiedExtensionView-content-wrap":".multiBodiedExtension--container","embedCardView-content-wrap":".rich-media-item","datasourceView-content-wrap":".datasourceView-content-inner-wrap"},eg=e=>{let t=Object.keys(em).find(t=>e.classList.contains(t)),o=t&&em[t];if(o){let t=e.querySelector(o);if(t)return window.getComputedStyle(t)}},ey=e=>eb(e,["height","padding-top","padding-bottom","border-top-width","border-bottom-width"]),eP=e=>eb(e,["width","padding-left","padding-right","border-left-width","border-right-width"]),eb=(e,t)=>{let[o,...r]=t,n=[e.getPropertyValue(o)];"content-box"===e.getPropertyValue("box-sizing")&&r.forEach(t=>{n.push(e.getPropertyValue(t))});let a=0;for(let e=0;e<n.length;e++)a+=parseFloat(n[e]);return a},eE=(e,t,o)=>{if(e.style.transform=t.getPropertyValue("transform"),el(o))e.style.width=t.getPropertyValue("width"),e.style.marginLeft=t.getPropertyValue("margin-left");else{let o=parseFloat(t.getPropertyValue("margin-right"));o>0?e.style.marginLeft=`-${Math.abs(o)}px`:e.style.paddingRight=`${Math.abs(o)}px`}},e_=(e,t)=>{let o=e.state.selection,{$from:r,side:a}=o,i=a===n("adhil").Side.RIGHT,l=i?r.nodeBefore:r.nodeAfter,s=t(),d=e.nodeDOM(s),c=document.createElement("span");if(c.className=`ProseMirror-gapcursor ${i?"-right":"-left"}`,c.appendChild(document.createElement("span")),d instanceof HTMLElement&&c.firstChild){let e=eg(d)||window.getComputedStyle(d),t=c.firstChild;t.style.height=`${ey(e)}px`;let r=l&&ed(l);(0!==s||r||l?.type.name==="table")&&(t.style.marginTop=e.getPropertyValue("margin-top"));let a=!!(0,n("dh538").fg)("platform_editor_nested_tables_gap_cursor")&&l?.type.name==="table"&&o.$to.depth>0;if(r&&!a){t.setAttribute("layout",r);let o=ep(d,l,e);t.style.width=`${eP(o)}px`}else eE(t,e,o.side)}return c},eT=new(0,n("1S4f7").SafePlugin)({key:et,state:{init:()=>({selectionIsGapCursor:!1,displayGapCursor:!0,hideCursor:!1}),apply:(e,t,o,r)=>{let a=e.getMeta(et),i=e.getMeta(c),l=r.selection instanceof n("adhil").GapCursorSelection;return{selectionIsGapCursor:l,displayGapCursor:!l||(a?.displayGapCursor??t.displayGapCursor),hideCursor:i?.hideCursor??t.hideCursor}}},view:e=>(0===e.state.selection.anchor&&e.state.selection instanceof n("ks2lK").NodeSelection&&window.requestAnimationFrame(()=>{e.dispatch(e.state.tr.setSelection(new(0,n("adhil").GapCursorSelection)(e.state.doc.resolve(0),n("adhil").Side.LEFT)))}),{update(e){let{selectionIsGapCursor:t}=et.getState(e.state);e.dom.classList.toggle(n("4AaC5").hideCaretModifier,t)}}),props:{decorations:e=>{let{doc:t,selection:o}=e,{displayGapCursor:r,hideCursor:a}=et.getState(e);if(o instanceof n("adhil").GapCursorSelection&&r&&!a){let{$from:e,side:r}=o,a=o.head,i=r===n("adhil").Side.RIGHT;if(i&&e.nodeBefore){let e=(0,y.findPositionOfNodeBefore)(o);"number"==typeof e&&(a=e)}let l=i?e.nodeBefore:e.nodeAfter,s=l&&ed(l);return n("ftzrq").DecorationSet.create(t,[n("ftzrq").Decoration.widget(a,e_,{key:`${n("adhil").JSON_ID}-${r}-${s}`,side:s?-1:0})])}return null},createSelectionBetween:(e,t,o)=>e&&e.state&&e.state.selection instanceof n("7XFGZ").CellSelection?null:t.pos===o.pos&&n("adhil").GapCursorSelection.valid(o)?new(0,n("adhil").GapCursorSelection)(o):null,handleClick(e,t,o){let r=e.posAtCoords({left:o.clientX,top:o.clientY});if(!r||ec(o.target instanceof HTMLElement?o.target:null)||r.pos===r.inside)return!1;let a=o.offsetX>20?n("adhil").Side.RIGHT:n("adhil").Side.LEFT,i=e.state.doc.resolve(t);if(i.parent?.type.name==="mediaSingle"){if(e.state.doc.resolve(Math.max(r.inside,0)).depth<=1)return!1;let t=i.nodeBefore?i.after():i.before();return(0,n("1zPzM").setGapCursorAtPos)(t,a)(e.state,e.dispatch)}let l=e.state.doc.content.size,s=r.inside<0||r.inside>l?null:e.state.doc.nodeAt(r.inside);return!s?.isAtom&&(0,n("1zPzM").setGapCursorAtPos)(t,a)(e.state,e.dispatch)},handleDOMEvents:{beforeinput:(e,t)=>"deleteContentBackward"===t.inputType&&e.state.selection instanceof n("adhil").GapCursorSelection&&(t.preventDefault(),eh(eo.BACKWARD)(e.state,e.dispatch))}}});var eS=function(){let e={};return(0,n("hgeg8").bindKeymapWithCommand)(n("hgeg8").moveRight.common,W,e),(0,n("hgeg8").bindKeymapWithCommand)(n("hgeg8").moveLeft.common,j,e),(0,n("dus6D").keymap)(e)};let eO=new(0,n("ks2lK").PluginKey)("markBoundaryCursorPlugin"),ex=`
	position: relative;
`,eC=`
	position: absolute;
	height: 100%;
	width: 1px;
	left: -0.5px;
	bottom: 0;
	background-color: var(--ds-text, #292A2E);
`,ek=()=>{let e=document.createElement("span");e.className="ProseMirror-mark-boundary-cursor",e.setAttribute("style",ex);let t=document.createElement("div");return t.setAttribute("style",eC),t.animate?.([{opacity:1},{opacity:1,offset:.5},{opacity:0,offset:.5},{opacity:0}],{duration:1e3,iterations:1/0}),e.appendChild(t),e},eA=(e,t)=>n("ftzrq").Decoration.widget(e,ek,{key:"mark-boundary-cursor",side:t});var ev=((h={})[h.None=0]="None",h[h.Left=-1]="Left",h[h.Right=1]="Right",h);let eN=()=>new(0,n("1S4f7").SafePlugin)({key:eO,state:{init:()=>({decorations:n("ftzrq").DecorationSet.empty}),apply(e,t){let{selection:o,storedMarks:r,doc:a,selectionSet:i,storedMarksSet:l,docChanged:s}=e;if(!i&&!l&&!s)return t;let d=function({selection:e,storedMarks:t}){if(!(0,n("kTbzR").isTextSelection)(e)||!e.empty)return ev.None;let{nodeBefore:o,nodeAfter:r}=e.$head,a=o?.marks??[],i=r?.marks??[];return n("5SAOw").Mark.sameSet(a,i)?ev.None:function({leftMarks:e,rightMarks:t,storedMarks:o}){let r=e.some(e=>"code"===e.type.name),n=t.some(e=>"code"===e.type.name),a=!!o&&o?.some(e=>"code"===e.type.name),i=!!o&&0===o.length;return n&&a||r&&i?ev.Right:ev.None}({leftMarks:a,rightMarks:i,storedMarks:t})}({selection:o,storedMarks:r});return d?{decorations:n("ftzrq").DecorationSet.create(a,[eA(o.head,d)])}:{decorations:n("ftzrq").DecorationSet.empty}}},props:{decorations:e=>eO.getState(e)?.decorations}});var ew=n("1oCLl");function eR(e){return e?.content.size===0||e?.textContent===""}let eI=e=>{if(0===e.pos)return!1;let t=e.pos-1,o=e.doc.resolve(t).nodeAfter;return!!o&&!!o.isBlock&&(!!o.isAtom||eR(o)&&n("ks2lK").NodeSelection.isSelectable(o))},eD=(e,t,o)=>{if(t.pos===o.pos||t.depth===o.depth&&t.sameParent(o)||1===o.depth&&o.parent?.type.name==="paragraph"||o.parent?.isTextblock&&!eR(o.parent)&&0===o.parentOffset)return null;let r=function({$targetHead:e,$anchor:t,doc:o}){let r=t.pos<e.pos?"down":"up",n=null;if(e.pos>=o.nodeSize)n=o.resolve(o.nodeSize-2).nodeBefore;else if(0!==e.pos){let t=e.pos-1;n=o.resolve(t).nodeAfter}if(null===n){if(null===(n=e.nodeAfter))return null;e=o.resolve(e.pos+1)}let a=function e(t){let{doc:o}=t;if(t.pos>o.content.size)return null;if(eI(t))return t;if(null!==t.nodeBefore)return null;if(0===t.depth&&0===t.pos)return t;let r=t.before();return e(o.resolve(r))}(e);if(a){let e=a.pos-1;if("up"===r)return o.resolve(Math.max(e,0));{let t=o.resolve(e).nodeAfter;if(t)return o.resolve(Math.min(e+t.nodeSize,o.content.size))}}return null}({$targetHead:o,$anchor:t,doc:e.state.doc});return r?n("ks2lK").TextSelection.create(e.state.doc,t.pos,r.pos):null};var eM=n("dZ8uq");let eL=(e,{__livePage:t})=>{let o;return o=t&&(0,n("dh538").fg)("platform-editor-single-player-expand")?e?!n("adayn").expandedState.get(e):void 0:t?e?.attrs.__expanded:!e?.attrs.__expanded,!!(e&&["expand","nestedExpand"].includes(e.type.name)&&o)},eB=e=>!!(e&&["bodiedExtension"].includes(e.type.name)),eK=e=>!!(e&&["table"].includes(e.type.name)),eU=(e,{__livePage:t})=>eL(e,{__livePage:t})||eB(e)||eK(e),eF=(e,t,o,{__livePage:r})=>{if(0===t.pos||0===t.depth)return null;if("up"===o){let e=t.before(),o=t.doc.resolve(e).nodeBefore;if(o&&eU(o,{__livePage:r})){let r=o.nodeSize,n=e-r;if(t.pos-1===n+r){let e=Math.max(n,0);return t.doc.resolve(Math.min(e,t.doc.content.size))}}}if("down"===o){let o=t.after(),n=e.nodeAt(o);if(n&&eU(n,{__livePage:r})&&t.pos+1===o){let e=Math.max(o+n.nodeSize,0);return t.doc.resolve(Math.min(e,t.doc.content.size))}}return null},eV=(e,t)=>{if(!t.shiftKey||!t.metaKey)return!1;let o=e.state.selection;if(!(o instanceof n("ks2lK").TextSelection)||!o.$cursor)return!1;let r="ArrowRight"===t.key&&!!o.$cursor.nodeAfter?.isInline,a="ArrowLeft"===t.key&&!!o.$cursor.nodeBefore?.isInline;return r||a},eG=(e,t)=>{if(t.shiftKey||t.metaKey)return!1;let o=e.state?.selection;if(!(o instanceof n("ks2lK").TextSelection)||!o.$cursor)return!1;let r="ArrowDown"===t.key&&!!o.$cursor.nodeBefore?.isInline&&!!o.$cursor.nodeAfter?.isInline;return!(r&&void 0!==(0,n("adayn").getNextNodeExpandPos)(e,o)&&(0,eM.expValEqualsNoExposure)("platform_editor_lovability_navigation_fixes","isEnabled",!0))&&r};function eH(e,t){if(0===t.buttons)return!1;if(e.state.selection instanceof n("ks2lK").TextSelection&&function(e){if(e.empty)return!1;let{$anchor:t,$head:o}=e;if(0!==o.parentOffset||o.depth<=1||0!==o.before(1)||0!==o.sharedDepth(t.pos))return!1;let r=!0;for(let e=o.depth-1;e>=0;e--)if(0!==o.index(e)){r=!1;break}return!!r}(e.state.selection)){let t=new(0,n("ks2lK").TextSelection)(e.state.doc.resolve(e.state.selection.$anchor.pos),e.state.doc.resolve(0));return e.dispatch(e.state.tr.setSelection(t)),!0}return!1}let eW=e=>({decorationSet:_(e.tr),selection:e.selection}),ej=(e,t,o,r={})=>{let a=!1;return new(0,n("1S4f7").SafePlugin)({key:c,state:V(t,eW),appendTransaction(e,t,o){let r,{tr:i}=o,l=!1,s=(0,n("dh538").fg)("platform_editor_ai_generic_prep_for_aifc_2"),d=(0,ei.editorExperiment)("platform_editor_element_drag_and_drop_multiselect",!0);if(s||d)for(let t=e.length-1;t>=0;t--){let o=e[t].getMeta(c);if(s&&o?.hideCursor!==void 0){let e=o.hideCursor;a!==e&&(a=e,l=!0)}if(d&&o?.manualSelection&&!r&&(r=o.manualSelection,!s))break}if(function({oldEditorState:e,newEditorState:t}){let o=e.selection,r=t.selection,a=c.getState(e),i=c.getState(t);if(!a||!i)return!1;if(o.eq(r)){if(o instanceof n("ks2lK").NodeSelection&&r instanceof n("ks2lK").NodeSelection){let e=a.decorationSet.find(),t=i.decorationSet.find();return e.length>0&&t.length>0?!e[0].eq(t[0]):0!==e.length||0!==t.length}return!1}return!(o instanceof n("ks2lK").TextSelection)||!(r instanceof n("ks2lK").TextSelection)||o.from!==o.to||r.from!==r.to}({oldEditorState:t,newEditorState:o})||r||l)return i.setMeta(c,{type:g.SET_DECORATIONS,selection:i.selection,decorationSet:_(i,r,a)}),i},filterTransaction:(e,t)=>(!r.useLongPressSelection||!e.selectionSet||!(e.selection instanceof n("ks2lK").NodeSelection)||!!e.getMeta(c))&&(!(t.selection instanceof n("ks2lK").NodeSelection)||!(e.selection instanceof n("ks2lK").TextSelection)||t.selection.from!==e.selection.from||t.selection.to!==e.selection.to),props:{createSelectionBetween:eD,decorations(t){let o=e?.interaction?.sharedState.currentState()?.interactionState;return(r.__livePage||(0,ew.expValEquals)("platform_editor_no_cursor_on_edit_page_init","isEnabled",!0))&&"hasNotHadInteraction"===o?n("ftzrq").DecorationSet.empty:F(t).decorationSet},handleDOMEvents:{keydown:function({__livePage:e=!1}){return function(t,o){if(!(o instanceof KeyboardEvent))return!1;if(o.shiftKey&&o.metaKey&&"ArrowUp"===o.key){let e=n("ks2lK").TextSelection.create(t.state.doc,t.state.selection.$anchor.pos,0);return t.dispatch(t.state.tr.setSelection(e)),o.preventDefault(),!0}if(eV(t,o)||eG(t,o))return!0;if(!o.shiftKey||o.ctrlKey||o.metaKey||!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft","Home","End"].includes(o.key))return!1;let{doc:r,selection:{$head:a,$anchor:i}}=t.state;if("ArrowRight"===o.key&&a.nodeAfter||"ArrowLeft"===o.key&&a.nodeBefore)return!1;let l=eF(r,a,["ArrowLeft","ArrowUp","Home"].includes(o.key)?"up":"down",{__livePage:e});if(l){let e="ArrowLeft"===o.key?-1:0,r=l.pos+e,a=n("ks2lK").TextSelection.create(t.state.doc,i.pos,r),s=t.state.tr;return s.setSelection(a),t.dispatch(s),o.preventDefault(),!0}return!1}}({__livePage:r.__livePage}),mouseout:eH}}})},ez=e=>({tr:t})=>t.setMeta(et,{displayGapCursor:e}),e$=()=>({tr:e})=>{let t=e.getMeta(c);return e.setMeta(c,{...t,manualSelection:{}})},eq=(e,t)=>({tr:o})=>{let r=o.getMeta(c);return o.setMeta(c,{...r,manualSelection:{anchor:e,head:t}})},eX=e=>({tr:t})=>{let o=t.getMeta(c);return t.setMeta(c,{...o,hideCursor:e})};e.exports.selectionPlugin=({api:e,config:t})=>({name:"selection",commands:{displayGapCursor:ez,clearManualSelection:e$,hideCursor:eX,setManualSelection:eq},actions:{selectNearNode:({selectionRelativeToNode:e,selection:t})=>o=>G(e,t)({tr:o.tr})||o.tr,getSelectionFragment:a(e),getSelectionLocalIds:i(e)},getSharedState(e){if(!e)return;let t=c.getState(e);return{selectionRelativeToNode:t?.selectionRelativeToNode,selection:t?.selection}},pmPlugins:()=>[{name:"selection",plugin:({dispatch:o,dispatchAnalyticsEvent:r})=>ej(e,o,r,t)},{name:"selectionKeymap",plugin:eS},{name:"gapCursorKeymap",plugin:()=>(function(){let e={};return(0,n("hgeg8").bindKeymapWithCommand)(n("hgeg8").insertNewLine.common,(e,t,o)=>e.selection instanceof n("adhil").GapCursorSelection&&(0,n("astHL").createParagraphNear)(e,t),e),(0,n("hgeg8").bindKeymapWithCommand)(n("hgeg8").moveLeft.common,(e,t,o)=>{let r=o?o.endOfTextblock.bind(o):void 0;return ef(eo.LEFT,r)(e,t,o)},e),(0,n("hgeg8").bindKeymapWithCommand)(n("hgeg8").moveRight.common,(e,t,o)=>{let r=o?o.endOfTextblock.bind(o):void 0;return ef(eo.RIGHT,r)(e,t)},e),(0,n("hgeg8").bindKeymapWithCommand)(n("hgeg8").moveUp.common,(e,t,o)=>{let r=o?o.endOfTextblock.bind(o):void 0;return ef(eo.UP,r)(e,t)},e),(0,n("hgeg8").bindKeymapWithCommand)(n("hgeg8").moveDown.common,(e,t,o)=>{let r=o?o.endOfTextblock.bind(o):void 0;return ef(eo.DOWN,r)(e,t)},e),(0,n("hgeg8").bindKeymapWithCommand)(n("hgeg8").backspace.common,eh(eo.BACKWARD),e),(0,n("hgeg8").bindKeymapWithCommand)(n("hgeg8").deleteKey.common,eh(eo.FORWARD),e),(0,n("dus6D").keymap)(e)})()},{name:"gapCursor",plugin:()=>eT},{name:"markBoundaryCursor",plugin:()=>eN()},{name:"autoExpandSelectionRangeOnInlineNode",plugin:()=>s()}]})}),a("adayn",function(e,t){var o=n("8m4tT");let r=new WeakMap;e.exports.expandedState=r,e.exports.isExpandCollapsed=e=>!r.get(e)??!1,e.exports.getNextNodeExpandPos=(e,t)=>{let r=(0,o.findParentNodeOfType)([e.state.schema.nodes.listItem,e.state.schema.nodes.heading,e.state.schema.nodes.blockquote,e.state.schema.nodes.taskItem,e.state.schema.nodes.mediaSingle])(t),n=(0,o.findParentNodeOfType)([e.state.schema.nodes.tableRow])(t);if(n&&(r=n),!r){let n=(0,o.findParentNodeOfType)([e.state.schema.nodes.paragraph])(t);if(!n)return;r=n}if(!r)return;let a=r&&["taskItem","listItem","tableRow"].includes(r.node.type.name)?1:0,i=r.start+r.node.content.size+a+1;if(i>e.state.doc.content.size)return;let l=e.state.doc.resolve(i);if(l?.nodeAfter&&["expand","nestedExpand"].includes(l.nodeAfter.type.name))return i+1}}),a("7nKrc",function(t,o){var r=n("l998X");n("42omo");var a=n("dZ8uq"),i=n("iu6m9");let l=new(0,n("ks2lK").PluginKey)("selectionToolbarPluginKey"),s=({hide:e})=>({tr:t})=>(t.setMeta(l,{hide:e}),t),d=({toolbarDocking:e})=>({tr:t})=>(t.setMeta(l,{toolbarDocking:e}),t),c=({toolbarDocking:e,userPreferencesProvider:t,editorAnalyticsApi:o})=>({tr:r})=>(t?.updatePreference("toolbarDockingInitialPosition",e),r.setMeta(l,{toolbarDocking:e}),"top"===e&&r.setSelection(n("ks2lK").TextSelection.create(r.doc,r.selection.head)),o?.attachAnalyticsEvent({action:n("d925B").ACTION.UPDATED,actionSubject:n("d925B").ACTION_SUBJECT.USER_PREFERENCES,actionSubjectId:n("d925B").ACTION_SUBJECT_ID.SELECTION_TOOLBAR_PREFERENCES,attributes:{toolbarDocking:e},eventType:n("d925B").EVENT_TYPE.TRACK})(r),r),p=({toolbarDocking:e,userPreferencesProvider:t})=>({tr:o})=>(t?.updatePreference("toolbarDockingInitialPosition",e),o.setMeta(l,{toolbarDocking:e}),o);var u=n("42omo");let f=({api:e,userPreferencesProvider:t})=>((0,u.useEffect)(()=>{if(!t||!e)return;let o=async()=>{if("visible"===document.visibilityState){try{await t.loadPreferences()}catch(e){(0,n("hWRJP").logException)(e,{location:"editor-plugin-selection-toolbar/PageVisibilityWatcher"})}e?.selectionToolbar?.actions?.refreshToolbarDocking?.()}};return(0,n("fFa3V").bind)(document,{type:"visibilitychange",listener:o})},[e,t]),null);n("42omo");let h=({api:t,toolbarDocking:o,intl:a})=>{let i=(0,n("91bcx").isOfflineMode)(t?.connectivity?.sharedState.currentState()?.mode),l={disabled:i,id:"editor.toolbar.unpined",icon:()=>(0,r.jsx)(e(n("6V1ly")),{label:""}),onClick:()=>(0,n("dh538").fg)("platform_editor_migrate_toolbar_docking")?t?.core.actions.execute(t?.userPreferences?.actions.updateUserPreference("toolbarDockingPosition","top"))??!1:t?.selectionToolbar.actions?.setToolbarDocking?.("top")??!1,title:a.formatMessage(n("5dODy").selectionToolbarMessages.toolbarPositionUnpined),type:"button"};return"top"===o&&(l={disabled:i,id:"editor.toolbar.pinedToTop",icon:()=>(0,r.jsx)(e(n("brxEJ")),{label:""}),onClick:()=>(0,n("dh538").fg)("platform_editor_migrate_toolbar_docking")?t?.core.actions.execute(t?.userPreferences?.actions.updateUserPreference("toolbarDockingPosition","none"))??!1:t?.selectionToolbar.actions?.setToolbarDocking?.("none")??!1,type:"button",title:a.formatMessage(n("5dODy").selectionToolbarMessages.toolbarPositionPinedAtTop)}),[{type:"separator",fullHeight:!0},l]};n("42omo");let m=({api:t,disabled:o})=>{let a=(0,n("8C5kA").default)(),i=(0,n("b3YrF").useSharedPluginStateSelector)(t,"connectivity.mode"),l=(0,n("91bcx").isOfflineMode)(i);return((0,n("dh538").fg)("platform_editor_use_preferences_plugin")?t?.userPreferences?.sharedState.currentState()?.preferences?.toolbarDockingPosition==="top":t?.selectionToolbar.sharedState.currentState()?.toolbarDocking==="top")?(0,r.jsx)(n("a4eZN").default,{"aria-label":a.formatMessage(n("5dODy").selectionToolbarMessages.toolbarPositionPinedAtTop),disabled:o||l,iconBefore:(0,r.jsx)(e(n("brxEJ")),{label:"",spacing:"spacious"}),onClick:()=>(0,n("dh538").fg)("platform_editor_migrate_toolbar_docking")?t?.core.actions.execute(t?.userPreferences?.actions.updateUserPreference("toolbarDockingPosition","none"))??!1:t?.selectionToolbar.actions?.setToolbarDocking?.("none")??!1,title:a.formatMessage(n("5dODy").selectionToolbarMessages.toolbarPositionPinedAtTop),className:(0,n("gMc0m").default)(["_ca0q12x7 _n3td12x7 _19bv12x7 _u5f312x7"])}):(0,r.jsx)(n("a4eZN").default,{"aria-label":a.formatMessage(n("5dODy").selectionToolbarMessages.toolbarPositionUnpined),disabled:o||l,iconBefore:(0,r.jsx)(e(n("6V1ly")),{label:"",spacing:"spacious"}),onClick:()=>(0,n("dh538").fg)("platform_editor_migrate_toolbar_docking")?t?.core.actions.execute(t?.userPreferences?.actions.updateUserPreference("toolbarDockingPosition","top"))??!1:t?.selectionToolbar.actions?.setToolbarDocking?.("top")??!1,title:a.formatMessage(n("5dODy").selectionToolbarMessages.toolbarPositionUnpined),className:(0,n("gMc0m").default)(["_ca0q12x7 _n3td12x7 _19bv12x7 _u5f312x7"])})};n("42omo");var g=n("1oCLl");n("42omo");let y=(0,n("dTb09").conditionalHooksFactory)(()=>(0,g.expValEquals)("platform_editor_toolbar_aifc_patch_3","isEnabled",!0),e=>{let{editorViewMode:t}=(0,n("gzUv9").useEditorToolbar)();return{editorViewMode:t}},e=>({editorViewMode:(0,n("b3YrF").useSharedPluginStateSelector)(e,"editorViewMode.mode")})),P=({children:e,api:t})=>{let{editorViewMode:o}=y(t),a="edit"===o;return a?(0,r.jsx)(n("6UWPx").ToolbarDropdownItemSection,{hasSeparator:a,children:e}):null};n("42omo");let b=({api:t})=>{let o=(0,n("8C5kA").default)().formatMessage(n("5dODy").selectionToolbarMessages.toolbarPositionPinedAtTop),{isOffline:a}=(0,n("gzUv9").useEditorToolbar)(),i=!!(0,n("dh538").fg)("platform_editor_toolbar_aifc_patch_7")&&a;return(0,r.jsx)(n("iIVVb").ToolbarTooltip,{content:o,children:(0,r.jsx)(n("7ERUE").ToolbarButton,{iconBefore:(0,r.jsx)(e(n("brxEJ")),{size:"small",label:""}),label:o,onClick:()=>{if(t&&!i){if((0,n("dh538").fg)("platform_editor_migrate_toolbar_docking"))return void t?.core.actions.execute(t?.userPreferences?.actions.updateUserPreference("toolbarDockingPosition","none"));t.selectionToolbar.actions?.setToolbarDocking?.("none")}},isDisabled:i})})};n("42omo");let E=e=>"view"!==e,_=(0,n("dTb09").conditionalHooksFactory)(()=>(0,g.expValEquals)("platform_editor_toolbar_aifc_patch_3","isEnabled",!0),e=>{let{editorViewMode:t,editorToolbarDockingPreference:o,isOffline:r}=(0,n("gzUv9").useEditorToolbar)();return{editorViewMode:t,editorToolbarDockingPreference:o,isOffline:r}},e=>{let t=(0,n("b3YrF").useSharedPluginStateSelector)(e,"editorViewMode.mode");return{editorViewMode:t,editorToolbarDockingPreference:(0,n("b3YrF").useSharedPluginStateSelector)(e,"userPreferences.preferences.toolbarDockingPosition"),isOffline:(0,n("91bcx").isOfflineMode)((0,n("b3YrF").useSharedPluginStateSelector)(e,"connectivity.mode"))}}),T=({api:t})=>{let o=(0,n("8C5kA").default)(),{editorViewMode:a,editorToolbarDockingPreference:i,isOffline:l}=_(t),s="top"===i,d=!!(0,n("dh538").fg)("platform_editor_toolbar_aifc_patch_7")&&l;if(!E(a))return null;let c=o.formatMessage(s?n("5dODy").selectionToolbarMessages.toolbarPositionPinedAtTop:n("5dODy").selectionToolbarMessages.toolbarPositionUnpinnedConcise);return(0,r.jsx)(n("2GVu1").ToolbarDropdownItem,{onClick:()=>{if(t&&!d){if((0,n("dh538").fg)("platform_editor_migrate_toolbar_docking"))return void t?.core.actions.execute(t?.userPreferences?.actions.updateUserPreference("toolbarDockingPosition",s?"none":"top"));s?t.selectionToolbar.actions?.setToolbarDocking?.("none"):t.selectionToolbar.actions?.setToolbarDocking?.("top")}},isDisabled:d,elemBefore:s?(0,r.jsx)(e(n("brxEJ")),{size:"small",label:""}):(0,r.jsx)(e(n("6V1ly")),{size:"small",label:""}),children:c})},S=(e,t)=>{let o=[{type:n("cPCP8").PIN_MENU_SECTION.type,key:n("cPCP8").PIN_MENU_SECTION.key,parents:[{type:n("cPCP8").OVERFLOW_MENU.type,key:n("cPCP8").OVERFLOW_MENU.key,rank:n("4Chin").OVERFLOW_MENU_RANK[n("cPCP8").PIN_MENU_SECTION.key]}],component:(0,g.expValEquals)("platform_editor_toolbar_aifc_patch_3","isEnabled",!0)?({children:t})=>(0,r.jsx)(P,{api:e,children:t}):void 0},{type:n("cPCP8").PIN_MENU_ITEM.type,key:n("cPCP8").PIN_MENU_ITEM.key,parents:[{type:n("cPCP8").PIN_MENU_SECTION.type,key:n("cPCP8").PIN_MENU_SECTION.key,rank:n("4Chin").PIN_MENU_SECTION_RANK[n("cPCP8").PIN_MENU_ITEM.key]}],component:()=>(0,r.jsx)(T,{api:e})}];if(t){let t=[{type:n("cPCP8").PIN_GROUP.type,key:n("cPCP8").PIN_GROUP.key,parents:[{type:n("cPCP8").PIN_SECTION.type,key:n("cPCP8").PIN_SECTION.key,rank:n("4Chin").PIN_SECTION_RANK[n("cPCP8").PIN_GROUP.key]}]},{type:n("cPCP8").PIN_BUTTON.type,key:n("cPCP8").PIN_BUTTON.key,parents:[{type:n("cPCP8").PIN_GROUP.type,key:n("cPCP8").PIN_GROUP.key,rank:n("4Chin").PIN_GROUP_RANK[n("cPCP8").PIN_BUTTON.key]}],component:()=>(0,r.jsx)(b,{api:e})}];o.push(...t)}return o},O=(e,t)=>e&&(0,i.editorExperiment)("platform_editor_controls","variant1")?t?.getPreference("toolbarDockingInitialPosition")??"none":"top",x=(e,t)=>e&&(0,i.editorExperiment)("platform_editor_controls","variant1")?t??"none":"top",C=(e,t)=>{if("SPAN"===e.tagName&&e.innerHTML===t)return!0;for(let o of Array.from(e.children))if(C(o,t))return!0;return!1};t.exports.selectionToolbarPlugin=({api:e,config:t})=>{let o,u=[],g=!!e?.toolbar,{userPreferencesProvider:y,contextualFormattingEnabled:P}=t;g?(0,n("dh538").fg)("platform_editor_toolbar_aifc_placement_config")?e?.toolbar?.actions.contextualFormattingMode()==="controlled"&&e?.toolbar?.actions.registerComponents(S(e,!0)):e?.toolbar?.actions.registerComponents(S(e,P)):(0,i.editorExperiment)("platform_editor_controls","variant1",{exposure:!0})&&(o=({disabled:t})=>(0,r.jsx)(m,{api:e,disabled:t}),e?.primaryToolbar?.actions.registerComponent({name:"pinToolbar",component:o}));let b=y?.getPreference("toolbarDockingInitialPosition")||null,E=!1;return{name:"selectionToolbar",actions:{suppressToolbar:()=>e?.core.actions.execute(s({hide:!0}))??!1,unsuppressToolbar:()=>e?.core.actions.execute(s({hide:!1}))??!1,setToolbarDocking:t=>(0,n("dh538").fg)("platform_editor_use_preferences_plugin")?e?.core.actions.execute(e?.userPreferences?.actions.updateUserPreference("toolbarDockingPosition",t))??!1:e?.core.actions.execute(c({toolbarDocking:t,userPreferencesProvider:y,editorAnalyticsApi:e?.analytics?.actions}))??!1,forceToolbarDockingWithoutAnalytics:t=>(0,n("dh538").fg)("platform_editor_use_preferences_plugin")&&(0,n("dh538").fg)("platform_editor_lcm_toolbar_docking_fix")?e?.core.actions.execute(e?.userPreferences?.actions.updateUserPreference("toolbarDockingPosition",t))??!1:e?.core.actions.execute(p({toolbarDocking:t,userPreferencesProvider:y}))??!1,refreshToolbarDocking:()=>{if(y){let t=O(P,y);return e?.core.actions.execute(d({toolbarDocking:t}))??!1}return!1}},getSharedState(e){if(e)return l.getState(e)},pmPlugins(t){t&&u.push(...t);let o=(0,n("dh538").fg)("platform_editor_use_preferences_plugin")?x(P,e?.userPreferences?.sharedState.currentState()?.preferences?.toolbarDockingPosition):O(P,y);return[{name:"selection-tracker",plugin:()=>new(0,n("1S4f7").SafePlugin)({key:l,state:{init:()=>({selectionStable:!1,hide:!1,toolbarDocking:o}),apply(t,o){let r=t.getMeta(l),n=o;if(r)return{...n,...r};if((0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)){let t=e?.userIntent?.sharedState.currentState()?.currentUserIntent==="blockMenuOpen";n={...n,isBlockMenuOpen:t}}if(!b){let e=y?.getPreference("toolbarDockingInitialPosition");if(e&&e!==b){b=e;let t=O(P,y);if(o.toolbarDocking!==t)return{...n,toolbarDocking:t}}}return n}},view(t){let o=(0,n("fFa3V").bind)(t.root,{type:"mouseup",listener:o=>{let r=e?.editorViewMode?.sharedState.currentState(),a=r?.mode==="view";if((0,n("dh538").fg)("platform_editor_ai_generic_prep_for_aifc")){let e=o.target;if(e&&e instanceof Element){let t="BUTTON"===e.tagName&&C(e,"Change tone")||"Change tone"===e.getAttribute("aria-label")||"Change tone"===e.innerHTML,o="BUTTON"===e.tagName&&C(e,"Translate options")||"Translate options"===e.getAttribute("aria-label")||"Translate options"===e.innerHTML;if(t||o)return null}}t.dispatch(t.state.tr.setMeta(l,{selectionStable:!!a||t.hasFocus()}))}}),r=(0,n("fFa3V").bind)(t.dom,{type:"focus",listener:()=>{t.dispatch(t.state.tr.setMeta(l,{selectionStable:!0}))}});return{destroy(){o(),r()}}},appendTransaction(t,o,r){if((0,n("dh538").fg)("platform_editor_use_preferences_plugin"))return null;if(!E&&(0,i.editorExperiment)("platform_editor_controls","variant1")&&void 0!==y?.getPreference("toolbarDockingInitialPosition")){E=!0;let t=O(P,y),o=r.tr;return e?.analytics?.actions.attachAnalyticsEvent({action:n("d925B").ACTION.INITIALISED,actionSubject:n("d925B").ACTION_SUBJECT.USER_PREFERENCES,actionSubjectId:n("d925B").ACTION_SUBJECT_ID.SELECTION_TOOLBAR_PREFERENCES,attributes:{toolbarDocking:t},eventType:n("d925B").EVENT_TYPE.OPERATIONAL})(o),o}return null},props:{handleDOMEvents:{mousedown:e=>(e.dispatch(e.state.tr.setMeta(l,{selectionStable:!1})),!1)}}})}]},pluginsOptions:g?{}:{floatingToolbar(o,r,s){let d,{selectionStable:c,hide:p,toolbarDocking:f,isBlockMenuOpen:m}=l.getState(o),g="$anchorCell"in o.selection,y=(0,i.editorExperiment)("platform_editor_controls","variant1");if(o.selection.empty||!c||p||o.selection instanceof n("ks2lK").NodeSelection||g&&!y||g&&y&&e?.blockControls?.sharedState.currentState()?.isSelectedViaDragHandle||m&&y&&(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0))return;let b=u.map(e=>e(o,r,s)).filter(e=>void 0!==e);b.sort(({rank:e=0},{rank:t=0})=>e<t?1:-1);let E=[];for(let e=0;e<b.length;e++)Array.isArray(b[e]?.items)&&E.push(...b[e].items),(0,i.editorExperiment)("platform_editor_controls","variant1")?b[e]&&b[e+1]&&b[e+1]?.pluginName==="annotation"&&E.push({type:"separator",fullHeight:!0}):e!==b.length-1&&E.push({type:"separator"});if(E.length>0&&P&&y){let t=e?.userPreferences&&(0,n("dh538").fg)("platform_editor_use_preferences_plugin")?e?.userPreferences?.sharedState.currentState()?.preferences?.toolbarDockingPosition:f;E.push(...h({api:e,toolbarDocking:t,intl:r}))}let _="Selection toolbar";return d=g&&y?(0,n("lNDSG").calculateToolbarPositionOnCellSelection)(_):(t.preferenceToolbarAboveSelection?n("lNDSG").calculateToolbarPositionAboveSelection:n("lNDSG").calculateToolbarPositionTrackHead)(_),{title:"Selection toolbar",nodeType:function(e){let t=[];return e.doc.nodesBetween(e.selection.from,e.selection.to,e=>{0!==t.indexOf(e.type)&&t.push(e.type)}),t}(o),items:E,...y&&{scrollable:!0},onPositionCalculated:d}}},contentComponent:(0,i.editorExperiment)("platform_editor_controls","variant1")&&!(0,n("dh538").fg)("platform_editor_use_preferences_plugin")&&(0,n("dh538").fg)("platform_editor_user_preferences_provider_update")?()=>(0,r.jsx)(f,{api:e,userPreferencesProvider:y}):void 0,primaryToolbarComponent:!e?.primaryToolbar&&(0,i.editorExperiment)("platform_editor_controls","variant1",{exposure:!0})?o:void 0}}}),a("6borH",function(e,t){let o=e=>({payload:{action:n("d925B").ACTION.STOPPED,actionSubject:n("d925B").ACTION_SUBJECT.EDITOR,actionSubjectId:n("d925B").ACTION_SUBJECT_ID.SAVE,attributes:{inputMethod:n("d925B").INPUT_METHOD.SHORTCUT,documentSize:e.doc.nodeSize},eventType:n("d925B").EVENT_TYPE.UI}});e.exports.submitEditorPlugin=({config:e,api:t})=>({name:"submitEditor",pmPlugins:()=>[{name:"submitEditor",plugin:({dispatch:r})=>(function(e,t,r){if(r)return(0,n("dus6D").keymap)({[`${n("hgeg8").submit.common}`]:(a,i,l)=>{let s=t?.media?.sharedState?.currentState();return!!s&&!!s.waitForMediaUpload&&!s.allUploadsFinished||!!l&&(e(n("lWghV").analyticsEventKey,o(a)),r(l),!0)}})})(r,t,e)}]})}),a("3JBsx",function(t,o){var r=n("l998X");n("42omo");var a=n("8m4tT");let i=()=>{let e=[];return{register:t=>{e.push(...t)},safeRegister:t=>{t.forEach(t=>{let o=e.findIndex(e=>e.type===t.type&&e.key===t.key);-1!==o?e[o]=t:e.push(t)})},components:e}};var l=n("1oCLl");let s=new(0,n("ks2lK").PluginKey)("selectionToolbarOpenExperience"),d={MOUSE_UP:"mouse-up",KEY_DOWN:"key-down"},c={SELECTION_CLEARED:"selection-cleared",BLOCK_MENU_OPENED:"block-menu-opened",EDITOR_DESTROYED:"editor-destroyed"},p=({refs:e,dispatchAnalyticsEvent:t})=>{let o,r,a,i=!1,l=()=>(r||(r=e.popupsMountPoint||(0,n("fWXWs").getPopupContainerFromEditorView)(o?.dom)),r),p=new(0,n("grmt9").Experience)("toolbar-open",{actionSubjectId:"selection-toolbar",dispatchAnalyticsEvent:t,checks:[new(0,n("fo9p3").ExperienceCheckTimeout)({durationMs:1e3,onTimeout:()=>h(l())?{status:"abort",reason:c.BLOCK_MENU_OPENED}:m(o?.state.selection)?{status:"abort",reason:c.SELECTION_CLEARED}:void 0}),new(0,n("SI3ya").ExperienceCheckDomMutation)({onDomMutation:({mutations:e})=>{if(e.some(u))return{status:"success"}},observeConfig:()=>({target:l(),options:{childList:!0}})})]});return new(0,n("1S4f7").SafePlugin)({key:s,state:{init:()=>({}),apply:(e,t,o,r)=>(!o.selection.empty&&m(r.selection)&&p.abort({reason:c.SELECTION_CLEARED}),!i||r.selection.eq(o.selection)||m(r.selection)||(p.start({method:d.KEY_DOWN}),i=!1),t)},props:{handleDOMEvents:{mousedown:(e,t)=>{a={x:t.clientX,y:t.clientY}},mouseup:(e,t)=>{!a||m(e.state.selection)||g(e.state.selection)||f(l())||(t.clientX!==a.x||t.clientY!==a.y)&&p.start({method:d.MOUSE_UP})},dblclick:(e,t)=>{m(e.state.selection)||g(e.state.selection)||f(l())||p.start({method:d.MOUSE_UP})},keydown:(e,{shiftKey:t,key:o})=>{i=t&&o.includes("Arrow")&&!f(l())},keyup:()=>{i=!1}}},view:e=>(o=e,{destroy:()=>{p.abort({reason:c.EDITOR_DESTROYED})}})})},u=({type:e,addedNodes:t})=>"childList"===e&&[...t].some(f),f=e=>(0,n("fWXWs").containsPopupWithNestedElement)(e,'[data-testid="editor-floating-toolbar"]'),h=e=>(0,n("fWXWs").containsPopupWithNestedElement)(e,'[data-testid="editor-block-menu"]'),m=e=>{if(!e||e.empty)return!0;let t=!1;return e.$from.doc.nodesBetween(e.from,e.to,e=>!t&&(!e.isText||!e.text||!(e.text.length>0)||(t=!0,!1))),!t},g=e=>{let{$from:t,$to:o}=e;return t.sameParent(o)&&"codeBlock"===t.parent.type.name},y=new(0,n("ks2lK").PluginKey)("editorToolbarPluginKey"),P="Selection toolbar";var b=n("42omo"),E=n("dZ8uq");let _=(e,t)=>{let o=e.target instanceof Element?e.target:null;return!!o&&!!o.closest(t)},T=e=>e.altKey&&"F10"===e.key,S=e=>e?Array.from(e.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, div[tabindex="-1"], div[tabindex="0"]')||[]).filter(e=>{let t=window.getComputedStyle(e);return"hidden"!==t.visibility&&"none"!==t.display}):[],O=(e,t,o)=>{if(!(e.dom instanceof HTMLElement))return;let r="[data-testid='editor-floating-toolbar']";return{childComponentSelector:r,dom:e.dom,isShortcutToFocusToolbar:T,handleFocus:e=>{try{let t=(0,n("hTKp4").getDocument)()?.querySelector(r);if(!(t instanceof HTMLElement))return;let o=S(t);o[0]?.focus(),o[0]?.tagName==="BUTTON"&&o[0].classList.add("first-floating-toolbar-button"),o[0]?.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),e.preventDefault(),e.stopPropagation()}catch(e){e instanceof Error&&(0,n("hWRJP").logException)(e,{location:"editor-plugin-toolbar/selectionToolbar"})}},handleEscape:e=>{try{if(document.querySelector('[data-toolbar-component="menu-section"]'))return;o?.core.actions.focus(),e.preventDefault(),e.stopPropagation()}catch(e){e instanceof Error&&(0,n("hWRJP").logException)(e,{location:"editor-plugin-toolbar/selectionToolbar"})}},ariaControls:n("f9zLy").EDIT_AREA_ID,ariaLabel:t.formatMessage(n("8aWkM").messages.toolbarLabel)}},x=(e,t)=>{try{let t=(0,a.findDomRefAtPos)(e.state.selection.from,e.domAtPos.bind(e));if(t instanceof HTMLElement)return t;throw Error("Invalid DOM reference")}catch(o){t&&t({action:n("d925B").ACTION.ERRORED,actionSubject:n("d925B").ACTION_SUBJECT.CONTENT_COMPONENT,eventType:n("d925B").EVENT_TYPE.OPERATIONAL,attributes:{component:n("d925B").CONTENT_COMPONENT.SELECTION_TOOLBAR,selection:e.state.selection.toJSON(),position:e.state.selection.from,docSize:e.state.doc.nodeSize,error:o instanceof Error?o.toString():String(o),errorStack:o instanceof Error?o.stack:void 0}}),o instanceof Error&&(0,n("hWRJP").logException)(o,{location:"editor-plugin-toolbar/selectionToolbar"})}},C=e=>"toolbar"===e.type&&"inline-text-toolbar"===e.key,k=(0,n("dTb09").conditionalHooksFactory)(()=>(0,l.expValEquals)("platform_editor_toolbar_aifc_patch_3","isEnabled",!0),e=>(0,n("eiA8Z").useSharedPluginStateWithSelector)(e,["connectivity","userPreferences","toolbar","selection","userIntent","editorViewMode"],e=>({connectivityStateMode:e.connectivityState?.mode,editorToolbarDockingPreference:e.userPreferencesState?.preferences?.toolbarDockingPosition,shouldShowToolbar:e.toolbarState?.shouldShowToolbar,selectedNode:e.toolbarState?.selectedNode,selection:e.selectionState?.selection,currentUserIntent:e.userIntentState?.currentUserIntent,editorViewMode:e.editorViewModeState?.mode})),e=>{let t=(0,n("b3YrF").useSharedPluginStateSelector)(e,"connectivity.mode"),o=(0,n("b3YrF").useSharedPluginStateSelector)(e,"userPreferences.preferences.toolbarDockingPosition"),r=(0,n("b3YrF").useSharedPluginStateSelector)(e,"userIntent.currentUserIntent"),a=(0,n("b3YrF").useSharedPluginStateSelector)(e,"selection.selection"),{shouldShowToolbar:i,selectedNode:l}=(0,n("eiA8Z").useSharedPluginStateWithSelector)(e,["toolbar"],e=>({shouldShowToolbar:e.toolbarState?.shouldShowToolbar,selectedNode:e.toolbarState?.selectedNode}));return{connectivityStateMode:t,editorToolbarDockingPreference:o,currentUserIntent:r,shouldShowToolbar:i,selection:a,editorViewMode:void 0,selectedNode:l}}),A=(0,n("dTb09").conditionalHooksFactory)(()=>(0,n("dh538").fg)("platform_editor_toolbar_aifc_patch_7"),e=>(0,b.useCallback)(t=>{try{let o=(0,l.expValEquals)("platform_editor_controls","cohort","variant1");if("$anchorCell"in e.state.selection&&o)return(0,n("lNDSG").calculateToolbarPositionOnCellSelection)(P)(e,t);return(0,n("lNDSG").calculateToolbarPositionTrackHead)(P)(e,t)}catch(e){return(0,n("hWRJP").logException)(e,{location:"editor-plugin-toolbar/selectionToolbar"}),t}},[e]),e=>(0,b.useCallback)(t=>{let o=(0,l.expValEquals)("platform_editor_controls","cohort","variant1");return"$anchorCell"in e.state.selection&&o?(0,n("lNDSG").calculateToolbarPositionOnCellSelection)(P)(e,t):(0,n("lNDSG").calculateToolbarPositionTrackHead)(P)(e,t)},[e])),v=({api:e,editorView:t,mountPoint:o,disableSelectionToolbarWhenPinned:a})=>{let{connectivityStateMode:i,editorToolbarDockingPreference:s,currentUserIntent:d,shouldShowToolbar:c,editorViewMode:p,selection:u}=k(e),f=(0,n("8C5kA").default)(),h=e?.toolbar?.actions.getComponents(),m=h?.find(e=>C(e)),g=(0,b.useMemo)(()=>O(t,f,e),[t,f,e]),{isDisabled:y}=(0,n("8hoW2").useToolbarUI)(),P=(0,l.expValEquals)("platform_editor_toolbar_aifc_patch_6","isEnabled",!0),_=(0,n("91bcx").isOfflineMode)(i),T=!t.state.selection.empty&&t.state.selection instanceof n("ks2lK").TextSelection,S=!t.state.selection.empty&&t.state.selection instanceof n("ks2lK").AllSelection,v=!t.state.selection.empty&&"$anchorCell"in t.state.selection,N=A(t);return(0,l.expValEquals)("platform_editor_toolbar_aifc_template_editor","isEnabled",!0)&&"top"===s&&a||!h||!m||!(T||v||S)||"dragging"===d||!c||"blockMenuOpen"===d&&(0,E.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)||((0,n("dh538").fg)("platform_editor_toolbar_aifc_user_intent_fix")?d&&"default"!==d&&!("dragHandleSelected"===d&&!v):d&&"default"!==d)||(0,n("eTj7Y").isSSR)()?null:(0,r.jsx)(n("jwWgu").default,{offset:[0,10],target:x(t),onPositionCalculated:N,mountTo:o,children:(0,r.jsx)(n("gzUv9").EditorToolbarProvider,{editorView:t,editorToolbarDockingPreference:s,editorViewMode:(0,l.expValEquals)("platform_editor_toolbar_aifc_patch_4","isEnabled",!0)?p??"edit":p,isOffline:_,children:(0,r.jsx)(n("biAkr").EditorToolbarUIProvider,{api:e,isDisabled:P?y:_,fireAnalyticsEvent:t=>{e?.analytics?.actions.fireAnalyticsEvent(t)},keyboardNavigation:(0,l.expValEquals)("platform_editor_toolbar_aifc_patch_5","isEnabled",!0)?g:void 0,children:(0,r.jsx)(n("cf8NL").ToolbarModelRenderer,{toolbar:m,components:h,fallbacks:{section:n("48SU7").ToolbarSection,menuSection:n("6UWPx").ToolbarDropdownItemSection,group:n("kDB94").ToolbarButtonGroup}})})})})},N=({api:e,editorView:t,mountPoint:o,disableSelectionToolbarWhenPinned:a})=>(0,r.jsx)(n("7fmpI").ErrorBoundary,{component:n("d925B").ACTION_SUBJECT.TOOLBAR,componentId:n("d925B").ACTION_SUBJECT_ID.SELECTION_TOOLBAR,dispatchAnalyticsEvent:e?.analytics?.actions.fireAnalyticsEvent,fallbackComponent:null,children:(0,r.jsx)(v,{api:e,editorView:t,mountPoint:o,disableSelectionToolbarWhenPinned:a})});n("42omo"),n("42omo"),n("42omo");let w=({label:t,testId:o,color:a,shouldRecommendSmallIcon:i,spacing:l})=>(0,r.jsx)(e(n("9VJDA")),{label:t,testId:o,color:a,shouldRecommendSmallIcon:i,spacing:l,size:"small"}),R=({children:e})=>{let t=(0,n("8C5kA").default)().formatMessage(n("2zaaI").toolbarMessages.selectionToolbarOverflowMenuTooltip);return(0,r.jsx)(n("iIVVb").ToolbarTooltip,{content:t,position:"top",children:(0,r.jsx)(n("bTiiT").ToolbarDropdownMenu,{label:t,iconBefore:(0,r.jsx)(w,{label:""}),children:e})})};n("42omo");let I=({children:e})=>{let{editorViewMode:t}=(0,n("gzUv9").useEditorToolbar)();return(0,r.jsx)(n("6UWPx").ToolbarDropdownItemSection,{hasSeparator:"edit"===t,children:e})};n("42omo");let D=({children:e,hasSeparator:t,testId:o})=>{let{editorAppearance:a}=(0,n("gzUv9").useEditorToolbar)();return"full-page"===a?null:(0,r.jsx)(n("48SU7").ToolbarSection,{hasSeparator:t,testId:o,children:e})};n("42omo");let M=e=>"full-page"===e||"full-width"===e,L=(e,t)=>e||(t&&M(t)?"fullpage":"reduced"),B=({children:e,breakpointPreset:t})=>{let{editorAppearance:o}=(0,n("gzUv9").useEditorToolbar)();return(0,r.jsx)(n("l7fKC").PrimaryToolbar,{label:"Primary Toolbar",reducedBreakpoints:"full-page"!==o,breakpointPreset:L(t,o),children:e})};n("42omo");let K=(e,t,o,r)=>"view"!==e&&(!(0,n("dh538").fg)("platform_editor_toolbar_aifc_placement_config")&&!!r||t?.key===n("cPCP8").TOOLBARS.INLINE_TEXT_TOOLBAR&&"top"!==o||t?.key===n("cPCP8").TOOLBARS.PRIMARY_TOOLBAR&&"none"!==o),U=(0,n("dTb09").conditionalHooksFactory)(()=>(0,l.expValEquals)("platform_editor_toolbar_aifc_patch_3","isEnabled",!0),e=>{let{editorViewMode:t,editorToolbarDockingPreference:o,editorAppearance:r}=(0,n("gzUv9").useEditorToolbar)();return{editorViewMode:t,editorToolbarDockingPreference:o,editorAppearance:r}},e=>{let t=(0,n("b3YrF").useSharedPluginStateSelector)(e,"editorViewMode.mode"),o=(0,n("b3YrF").useSharedPluginStateSelector)(e,"userPreferences.preferences.toolbarDockingPosition"),{editorAppearance:r}=(0,n("gzUv9").useEditorToolbar)();return{editorViewMode:t,editorToolbarDockingPreference:o,editorAppearance:r}}),F=({children:e,parents:t,api:o,testId:a,showSeparatorInFullPagePrimaryToolbar:i,isSharedSection:s=!0,disableSelectionToolbar:d})=>{let{editorViewMode:c,editorToolbarDockingPreference:p,editorAppearance:u}=U(o),f=t.find(e=>"toolbar"===e.type);if(s&&!K(c,f,p,d))return null;let h=i&&"full-page"===u;return(0,r.jsx)(n("48SU7").ToolbarSection,{testId:a,hasSeparator:(0,l.expValEquals)("platform_editor_toolbar_aifc_patch_6","isEnabled",!0)&&h?n("48SU7").SeparatorPosition.START:h,children:e})};n("42omo");let V=({children:t})=>{let{formatMessage:o}=(0,n("8C5kA").default)();return(0,r.jsx)(n("iIVVb").ToolbarTooltip,{content:o(n("2zaaI").toolbarMessages.textStylesTooltip),children:(0,r.jsx)(n("bTiiT").ToolbarDropdownMenu,{iconBefore:(0,r.jsx)(e(n("f8c3d")),{label:o(n("2zaaI").toolbarMessages.textStylesTooltip),size:"small"}),enableMaxHeight:!0,children:t})})},G=()=>[{type:"toolbar",key:n("cPCP8").TOOLBARS.INLINE_TEXT_TOOLBAR,component:({children:e})=>(0,r.jsx)(n("l7fKC").Toolbar,{label:P,actionSubjectId:n("d925B").ACTION_SUBJECT_ID.SELECTION_TOOLBAR,testId:(0,l.expValEquals)("platform_editor_toolbar_aifc_patch_5","isEnabled",!0)?"editor-floating-toolbar":void 0,children:e})}],H=e=>[{type:"toolbar",key:n("cPCP8").TOOLBARS.PRIMARY_TOOLBAR,component:(0,l.expValEquals)("platform_editor_toolbar_aifc_responsive","isEnabled",!0)?({children:t})=>(0,r.jsx)(B,{breakpointPreset:e,children:t}):({children:e})=>(0,r.jsx)(n("l7fKC").PrimaryToolbar,{label:"Primary Toolbar",testId:"primary-toolbar",children:e})}],W=(e,t,o,a)=>{let i=[{type:n("cPCP8").TEXT_SECTION.type,key:n("cPCP8").TEXT_SECTION.key,parents:[{type:"toolbar",key:n("cPCP8").TOOLBARS.INLINE_TEXT_TOOLBAR,rank:n("4Chin").TOOLBAR_RANK[n("cPCP8").TEXT_SECTION.key]}],component:({children:e,parents:a})=>(0,l.expValEquals)("platform_editor_toolbar_aifc_responsive","isEnabled",!0)?(0,r.jsx)(n("aro2m").Show,{above:"md",children:(0,r.jsx)(F,{parents:a,api:t,disableSelectionToolbar:o,testId:"text-section",children:e})}):(0,r.jsx)(F,{parents:a,api:t,disableSelectionToolbar:o,testId:"text-section",children:e})},{type:n("cPCP8").TEXT_SECTION_PRIMARY_TOOLBAR.type,key:n("cPCP8").TEXT_SECTION_PRIMARY_TOOLBAR.key,parents:[{type:"toolbar",key:n("cPCP8").TOOLBARS.PRIMARY_TOOLBAR,rank:n("4Chin").TOOLBAR_RANK[n("cPCP8").TEXT_SECTION.key]}],component:({children:e,parents:a})=>(0,l.expValEquals)("platform_editor_toolbar_aifc_responsive","isEnabled",!0)?(0,r.jsx)(n("aro2m").Show,{above:"md",children:(0,r.jsx)(F,{parents:a,api:t,disableSelectionToolbar:o,testId:"text-section",children:e})}):(0,r.jsx)(F,{parents:a,api:t,disableSelectionToolbar:o,testId:"text-section",children:e})},...(0,l.expValEquals)("platform_editor_toolbar_aifc_responsive","isEnabled",!0)?[{type:n("cPCP8").TEXT_SECTION_COLLAPSED.type,key:n("cPCP8").TEXT_SECTION_COLLAPSED.key,parents:[{type:"toolbar",key:n("cPCP8").TOOLBARS.PRIMARY_TOOLBAR,rank:n("4Chin").TOOLBAR_RANK[n("cPCP8").TEXT_SECTION_COLLAPSED.key]},(0,l.expValEquals)("platform_editor_toolbar_aifc_responsive","isEnabled",!0)&&{type:"toolbar",key:n("cPCP8").TOOLBARS.INLINE_TEXT_TOOLBAR,rank:n("4Chin").TOOLBAR_RANK[n("cPCP8").TEXT_SECTION_COLLAPSED.key]}],component:({children:e,parents:a})=>(0,r.jsx)(n("aro2m").Show,{below:"md",children:(0,r.jsx)(F,{parents:a,api:t,disableSelectionToolbar:o,testId:"text-section",children:e})})},{type:n("cPCP8").TEXT_COLLAPSED_GROUP.type,key:n("cPCP8").TEXT_COLLAPSED_GROUP.key,parents:[{type:n("cPCP8").TEXT_SECTION_COLLAPSED.type,key:n("cPCP8").TEXT_SECTION_COLLAPSED.key,rank:100}]},{type:n("cPCP8").TEXT_COLLAPSED_MENU.type,key:n("cPCP8").TEXT_COLLAPSED_MENU.key,parents:[{type:n("cPCP8").TEXT_COLLAPSED_GROUP.type,key:n("cPCP8").TEXT_COLLAPSED_GROUP.key,rank:100}],component:V}]:[],{type:n("cPCP8").INSERT_BLOCK_SECTION.type,key:n("cPCP8").INSERT_BLOCK_SECTION.key,parents:[{type:"toolbar",key:n("cPCP8").TOOLBARS.PRIMARY_TOOLBAR,rank:n("4Chin").TOOLBAR_RANK[n("cPCP8").INSERT_BLOCK_SECTION.key]}],component:({children:e,parents:o})=>(0,r.jsx)(F,{testId:"insert-block-section",parents:o,api:t,showSeparatorInFullPagePrimaryToolbar:!0,isSharedSection:!1,children:e})},{type:n("cPCP8").LINKING_SECTION.type,key:n("cPCP8").LINKING_SECTION.key,parents:[{type:"toolbar",key:n("cPCP8").TOOLBARS.INLINE_TEXT_TOOLBAR,rank:n("4Chin").TOOLBAR_RANK[n("cPCP8").LINKING_SECTION.key]},{type:"toolbar",key:n("cPCP8").TOOLBARS.PRIMARY_TOOLBAR,rank:n("4Chin").TOOLBAR_RANK[n("cPCP8").LINKING_SECTION.key]}],component:({children:e,parents:o})=>(0,r.jsx)(F,{testId:"link-section",parents:o,api:t,showSeparatorInFullPagePrimaryToolbar:!0,children:e})},{type:n("cPCP8").OVERFLOW_SECTION.type,key:n("cPCP8").OVERFLOW_SECTION.key,parents:[{type:"toolbar",key:n("cPCP8").TOOLBARS.INLINE_TEXT_TOOLBAR,rank:n("4Chin").TOOLBAR_RANK[n("cPCP8").OVERFLOW_SECTION.key]}]},{type:n("cPCP8").OVERFLOW_GROUP.type,key:n("cPCP8").OVERFLOW_GROUP.key,parents:[{type:n("cPCP8").OVERFLOW_SECTION.type,key:n("cPCP8").OVERFLOW_SECTION.key,rank:n("4Chin").OVERFLOW_SECTION_RANK[n("cPCP8").OVERFLOW_GROUP.key]}]},{type:n("cPCP8").OVERFLOW_MENU.type,key:n("cPCP8").OVERFLOW_MENU.key,parents:[{type:n("cPCP8").OVERFLOW_GROUP.type,key:n("cPCP8").OVERFLOW_GROUP.key,rank:n("4Chin").OVERFLOW_GROUP_RANK[n("cPCP8").OVERFLOW_MENU.key]}],component:({children:e})=>(0,r.jsx)(R,{children:e})},...(0,n("dh538").fg)("platform_editor_toolbar_aifc_overflow_menu_update")?[{type:n("cPCP8").OVERFLOW_EXTENSIONS_MENU_SECTION.type,key:n("cPCP8").OVERFLOW_EXTENSIONS_MENU_SECTION.key,parents:[{type:n("cPCP8").OVERFLOW_MENU.type,key:n("cPCP8").OVERFLOW_MENU.key,rank:n("4Chin").OVERFLOW_MENU_RANK[n("cPCP8").OVERFLOW_EXTENSIONS_MENU_SECTION.key]}],component:I}]:[],{type:n("cPCP8").PIN_SECTION.type,key:n("cPCP8").PIN_SECTION.key,parents:[{type:"toolbar",key:n("cPCP8").TOOLBARS.PRIMARY_TOOLBAR,rank:n("4Chin").TOOLBAR_RANK[n("cPCP8").PIN_SECTION.key]}],component:(0,n("dh538").fg)("platform_editor_toolbar_aifc_undo_redo_confluence")?({children:e,parents:o})=>(0,r.jsx)(F,{testId:"pin-section",parents:o,api:t,showSeparatorInFullPagePrimaryToolbar:!0,children:e}):void 0}];if((0,l.expValEquals)("platform_editor_toolbar_migrate_loom","isEnabled",!0)&&i.push({type:n("cPCP8").OVERFLOW_SECTION_PRIMARY_TOOLBAR.type,key:n("cPCP8").OVERFLOW_SECTION_PRIMARY_TOOLBAR.key,parents:[{type:"toolbar",key:n("cPCP8").TOOLBARS.PRIMARY_TOOLBAR,rank:n("4Chin").TOOLBAR_RANK[n("cPCP8").OVERFLOW_SECTION_PRIMARY_TOOLBAR.key]}],component:({children:e})=>(0,r.jsx)(D,{children:e})},{type:n("cPCP8").OVERFLOW_GROUP_PRIMARY_TOOLBAR.type,key:n("cPCP8").OVERFLOW_GROUP_PRIMARY_TOOLBAR.key,parents:[{type:n("cPCP8").OVERFLOW_SECTION_PRIMARY_TOOLBAR.type,key:n("cPCP8").OVERFLOW_SECTION_PRIMARY_TOOLBAR.key,rank:n("4Chin").OVERFLOW_SECTION_PRIMARY_TOOLBAR_RANK[n("cPCP8").OVERFLOW_GROUP_PRIMARY_TOOLBAR.key]}]},{type:n("cPCP8").OVERFLOW_MENU_PRIMARY_TOOLBAR.type,key:n("cPCP8").OVERFLOW_MENU_PRIMARY_TOOLBAR.key,parents:[{type:n("cPCP8").OVERFLOW_GROUP_PRIMARY_TOOLBAR.type,key:n("cPCP8").OVERFLOW_GROUP_PRIMARY_TOOLBAR.key,rank:n("4Chin").OVERFLOW_GROUP_PRIMARY_TOOLBAR_RANK[n("cPCP8").OVERFLOW_MENU_PRIMARY_TOOLBAR.key]}],component:({children:e})=>(0,r.jsx)(R,{children:e})}),(0,n("dh538").fg)("platform_editor_toolbar_aifc_placement_config"))switch(e){case"always-inline":i.unshift(...G());break;case"always-pinned":i.unshift(...H(a));break;case"controlled":i.unshift(...G()),i.unshift(...H(a))}else i.unshift(...G()),i.unshift(...H(a));return(0,n("dh538").fg)("platform_editor_toolbar_aifc_undo_redo_confluence")&&i.push({type:n("cPCP8").TRACK_CHANGES_SECTION.type,key:n("cPCP8").TRACK_CHANGES_SECTION.key,parents:[{type:"toolbar",key:n("cPCP8").TOOLBARS.PRIMARY_TOOLBAR,rank:n("4Chin").TOOLBAR_RANK[n("cPCP8").TRACK_CHANGES_SECTION.key]}],component:({children:e,parents:o})=>(0,r.jsx)(F,{testId:"track-changes-section",parents:o,api:t,showSeparatorInFullPagePrimaryToolbar:!0,children:e})}),i};function j(e){let{selection:t}=e;if(t instanceof n("ks2lK").NodeSelection)return{node:t.node,pos:t.from,nodeType:t.node.type.name,marks:t.node.marks.map(e=>`${e.type.name}:${JSON.stringify(e.attrs)}`)};let{nodes:o}=e.schema,r=(0,a.findSelectedNodeOfType)([o.paragraph,o.heading,o.blockquote,o.panel,o.codeBlock])(t);if(r)return{node:r.node,pos:r.pos,nodeType:r.node.type.name,marks:r.node.marks.map(e=>`${e.type.name}:${JSON.stringify(e.attrs)}`)};let i=(0,a.findParentNodeOfType)([o.paragraph,o.heading,o.blockquote,o.panel,o.listItem,o.taskItem])(t);if(i)return{node:i.node,pos:i.pos,nodeType:i.node.type.name,marks:i.node.marks.map(e=>`${e.type.name}:${JSON.stringify(e.attrs)}`)};let l=t.$from;return{node:l.parent,pos:l.pos,nodeType:l.parent.type.name,marks:l.marks().map(e=>`${e.type.name}:${JSON.stringify(e.attrs)}`)}}t.exports.toolbarPlugin=({api:e,config:t={disableSelectionToolbar:!1,disableSelectionToolbarWhenPinned:!1}})=>{let o={},{disableSelectionToolbar:a,disableSelectionToolbarWhenPinned:s,contextualFormattingEnabled:d="always-pinned",breakpointPreset:c}=t,u=i();return u.register(W(d,e,a,c)),{name:"toolbar",actions:{registerComponents:(e,t=!1)=>{t?u.safeRegister(e):u.register(e)},getComponents:()=>u.components,contextualFormattingMode:()=>d,getBreakpointPreset:()=>(0,n("dh538").fg)("platform_editor_toolbar_aifc_responsive_improve")?c:void 0},getSharedState(e){if(e)return y.getState(e)},pmPlugins:()=>[{name:"editor-toolbar-selection",plugin:()=>new(0,n("1S4f7").SafePlugin)({key:y,state:{init:(e,t)=>({shouldShowToolbar:!1,selectedNode:j(t)}),apply(e,t,o,r){let n=e.getMeta(y),a={...t};if((0,l.expValEquals)("platform_editor_toolbar_aifc_patch_5","isEnabled",!0)&&(e.docChanged||e.selectionSet)){let e=j(r),o=t.selectedNode;o&&e&&o.nodeType===e.nodeType&&o.pos===e.pos&&JSON.stringify(o.marks)===JSON.stringify(e.marks)||(a.selectedNode=e)}return n&&(a={...a,...n}),a}},view(t){let o=(0,n("fFa3V").bind)(t.root,{type:"mouseup",listener:function(o){let r=_(o,'[role="toolbar"]'),n=_(o,".atlaskit-portal"),a=e?.editorViewMode?.sharedState.currentState(),i=a?.mode==="view";t.dispatch(t.state.tr.setMeta(y,{shouldShowToolbar:!!i||t.hasFocus()||r||n}))}}),r=(0,n("fFa3V").bind)(t.dom,{type:"focus",listener:()=>{t.dispatch(t.state.tr.setMeta(y,{shouldShowToolbar:!0}))}});return{destroy(){o(),r()}}},props:{handleDOMEvents:{mousedown:e=>(e.dispatch(e.state.tr.setMeta(y,{shouldShowToolbar:!1})),!1)}}})},...!a&&(0,l.expValEquals)("platform_editor_experience_tracking","isEnabled",!0)?[{name:"selectionToolbarOpenExperience",plugin:()=>p({refs:o,dispatchAnalyticsEvent:t=>e?.analytics?.actions?.fireAnalyticsEvent(t)})}]:[]],contentComponent:a?void 0:({editorView:t,popupsMountPoint:a})=>(o.popupsMountPoint=a||void 0,t)?(0,n("dh538").fg)("platform_editor_toolbar_aifc_patch_7")?(0,r.jsx)(N,{api:e,editorView:t,mountPoint:a,disableSelectionToolbarWhenPinned:s??!1}):(0,r.jsx)(v,{api:e,editorView:t,mountPoint:a,disableSelectionToolbarWhenPinned:s??!1}):null}}}),a("kw2eg",function(t,o){var r,a=n("l998X");n("42omo");var i=n("iu6m9"),l=((r={})[r.TOOLBAR=n("d925B").INPUT_METHOD.TOOLBAR]="TOOLBAR",r[r.KEYBOARD=n("d925B").INPUT_METHOD.KEYBOARD]="KEYBOARD",r[r.EXTERNAL=n("d925B").INPUT_METHOD.EXTERNAL]="EXTERNAL",r);let s=new(0,n("ks2lK").PluginKey)("undoRedoPlugin"),d=e=>t=>(o,r)=>{let n=o.tr;return t(o,e=>{n=e}),!!n&&!!n.docChanged&&(n.setMeta(s,e),r&&r(n),!0)},c=e=>{switch(e){case l.EXTERNAL:return n("d925B").INPUT_METHOD.EXTERNAL;case l.KEYBOARD:return n("d925B").INPUT_METHOD.KEYBOARD;case l.TOOLBAR:return n("d925B").INPUT_METHOD.TOOLBAR;default:return n("d925B").INPUT_METHOD.EXTERNAL}},p=e=>(t,o)=>r=>d(t)((0,n("dAtrv").withAnalytics)(e,(0,n("dh538").fg)("platform_editor_add_undo_meta_analytics")?({doc:e},{currentDoc:r})=>({eventType:n("d925B").EVENT_TYPE.TRACK,action:o,actionSubject:n("d925B").ACTION_SUBJECT.EDITOR,attributes:{inputMethod:c(t),...function({before:e,after:t}){let o=!(0,n("2pjJ5").areNodesEqualIgnoreAttrs)(t,e),r=o?void 0:(function e({before:t,after:o}){let r=Object.keys({...t.attrs,...o.attrs}).filter(e=>t.attrs[e]!==o.attrs[e]),n=r.length?[{type:t.type.name,attributes:r}]:[];return t.children.reduce((t,r,n)=>[...t,...e({before:r,after:o.child(n)})],n)})({before:e,after:t}).slice(0,25);return{hasChanged:o,affectedNodes:r}}({before:e,after:r})}}):{eventType:n("d925B").EVENT_TYPE.TRACK,action:o,actionSubject:n("d925B").ACTION_SUBJECT.EDITOR,attributes:{inputMethod:c(t)}})(r));d(l.KEYBOARD)(n("ke2AI").undo),d(l.KEYBOARD)(n("ke2AI").redo),d(l.TOOLBAR)(n("ke2AI").undo),d(l.TOOLBAR)(n("ke2AI").redo);let u=e=>p(e)(l.KEYBOARD,n("d925B").ACTION.UNDO_PERFORMED)(n("ke2AI").undo),f=e=>p(e)(l.KEYBOARD,n("d925B").ACTION.REDO_PERFORMED)(n("ke2AI").redo),h=e=>p(e)(l.TOOLBAR,n("d925B").ACTION.UNDO_PERFORMED)(n("ke2AI").undo),m=e=>p(e)(l.TOOLBAR,n("d925B").ACTION.REDO_PERFORMED)(n("ke2AI").redo),g=({dispatch:e})=>new(0,n("1S4f7").SafePlugin)({key:s}),y=(e,t)=>o=>!!e&&(t?.typeAhead?.actions?.isOpen(e.state)?t?.typeAhead?.actions?.close({attachCommand:o,insertCurrentQueryAsRawText:!1}):o(e.state,e.dispatch),!0),P=(e,t)=>o=>{let r=y(e,t)(o);return r&&!e.hasFocus()&&e.focus(),r};var b=(0,n("gmMgo").default)(({disabled:t,isReducedSpacing:o,editorView:r,api:a,intl:{formatMessage:i}})=>{let{canRedo:l,canUndo:s}=(0,n("eiA8Z").useSharedPluginStateWithSelector)(a,["history"],e=>({canUndo:e.historyState?.canUndo,canRedo:e.historyState?.canRedo})),d=i(n("ocPnd").messages.undo),c=i(n("ocPnd").messages.redo);return(0,n("9K4OG").jsx)("span",{css:(0,n("dh538").fg)("platform-visual-refresh-icons")?n("cORDs").buttonGroupStyle:n("cORDs").buttonGroupStyleBeforeVisualRefresh},(0,n("9K4OG").jsx)(n("a4eZN").default,{buttonId:n("8TW6I").TOOLBAR_ACTION_SUBJECT_ID.UNDO,spacing:o?"none":"default",onClick:()=>{P(r,a)(h(a?.analytics?.actions))},disabled:!s||t,"aria-label":(0,n("hgeg8").tooltip)(n("hgeg8").undo,d),"aria-keyshortcuts":(0,n("hgeg8").getAriaKeyshortcuts)(n("hgeg8").undo),title:(0,n("9K4OG").jsx)(n("hgeg8").ToolTipContent,{description:d,keymap:n("hgeg8").undo}),iconBefore:(0,n("9K4OG").jsx)(e(n("h9Ymt")),{label:"",color:"currentColor",spacing:"spacious"}),testId:"ak-editor-toolbar-button-undo"}),(0,n("9K4OG").jsx)(n("a4eZN").default,{spacing:o?"none":"default",buttonId:n("8TW6I").TOOLBAR_ACTION_SUBJECT_ID.REDO,onClick:()=>{P(r,a)(m(a?.analytics?.actions))},disabled:!l||t,title:(0,n("9K4OG").jsx)(n("hgeg8").ToolTipContent,{description:c,keymap:n("hgeg8").redoAlt}),iconBefore:(0,n("9K4OG").jsx)(e(n("60Odx")),{label:"",color:"currentColor",spacing:"spacious"}),testId:"ak-editor-toolbar-button-redo","aria-label":(0,n("hgeg8").tooltip)(n("hgeg8").redoAlt,c),"aria-keyshortcuts":(0,n("hgeg8").getAriaKeyshortcuts)(n("hgeg8").redoAlt)}),!a?.primaryToolbar&&(0,n("9K4OG").jsx)("span",{css:n("cORDs").separatorStyles}))});n("42omo"),n("42omo");let E=({api:t})=>{let{formatMessage:o}=(0,n("8C5kA").default)(),{editorView:r}=(0,n("gzUv9").useEditorToolbar)(),{canRedo:i}=(0,n("eiA8Z").useSharedPluginStateWithSelector)(t,["history"],e=>({canRedo:e.historyState?.canRedo}));return(0,a.jsx)(n("iIVVb").ToolbarTooltip,{content:(0,a.jsx)(n("hgeg8").ToolTipContent,{description:o(n("ocPnd").messages.redo),keymap:n("hgeg8").redo}),children:(0,a.jsx)(n("7ERUE").ToolbarButton,{iconBefore:(0,a.jsx)(e(n("kFjZK")),{label:o(n("ocPnd").messages.redo),size:"small"}),onClick:()=>{r&&P(r,t)(m(t?.analytics?.actions))},isDisabled:!i,ariaKeyshortcuts:(0,n("hgeg8").getAriaKeyshortcuts)(n("hgeg8").redo),testId:"ak-editor-toolbar-button-redo"})})};n("42omo");let _=({api:t})=>{let{formatMessage:o}=(0,n("8C5kA").default)(),{editorView:r}=(0,n("gzUv9").useEditorToolbar)(),{canUndo:i}=(0,n("eiA8Z").useSharedPluginStateWithSelector)(t,["history"],e=>({canUndo:e.historyState?.canUndo}));return(0,a.jsx)(n("iIVVb").ToolbarTooltip,{content:(0,a.jsx)(n("hgeg8").ToolTipContent,{description:o(n("ocPnd").messages.undo),keymap:n("hgeg8").undo}),children:(0,a.jsx)(n("7ERUE").ToolbarButton,{iconBefore:(0,a.jsx)(e(n("fnaPh")),{label:o(n("ocPnd").messages.undo),size:"small"}),onClick:()=>{r&&P(r,t)(h(t?.analytics?.actions))},isDisabled:!i,ariaKeyshortcuts:(0,n("hgeg8").getAriaKeyshortcuts)(n("hgeg8").undo),testId:"ak-editor-toolbar-button-undo"})})},T=e=>{let t=e?.toolbar?.actions.getBreakpointPreset();return[{type:n("cPCP8").UNDO_CHANGES_GROUP.type,key:n("cPCP8").UNDO_CHANGES_GROUP.key,parents:[{type:n("cPCP8").TRACK_CHANGES_SECTION.type,key:n("cPCP8").TRACK_CHANGES_SECTION.key,rank:n("4Chin").TRACK_CHANGES_SECTION_RANK[n("cPCP8").UNDO_CHANGES_GROUP.key]}],component:({children:e})=>"jsm-comment"===t?(0,a.jsx)(n("aro2m").Show,{above:"lg",children:(0,a.jsx)(n("kDB94").ToolbarButtonGroup,{children:e})}):(0,a.jsx)(n("kDB94").ToolbarButtonGroup,{children:e})},{type:n("cPCP8").UNDO_BUTTON.type,key:n("cPCP8").UNDO_BUTTON.key,parents:[{type:n("cPCP8").UNDO_CHANGES_GROUP.type,key:n("cPCP8").UNDO_CHANGES_GROUP.key,rank:n("4Chin").UNDO_CHANGES_GROUP_RANK[n("cPCP8").UNDO_BUTTON.key]}],component:()=>(0,a.jsx)(_,{api:e})},{type:n("cPCP8").REDO_CHANGES_GROUP.type,key:n("cPCP8").REDO_CHANGES_GROUP.key,parents:[{type:n("cPCP8").TRACK_CHANGES_SECTION.type,key:n("cPCP8").TRACK_CHANGES_SECTION.key,rank:n("4Chin").TRACK_CHANGES_SECTION_RANK[n("cPCP8").REDO_CHANGES_GROUP.key]}],component:({children:e})=>"jsm-comment"===t?(0,a.jsx)(n("aro2m").Show,{above:"lg",children:(0,a.jsx)(n("kDB94").ToolbarButtonGroup,{children:e})}):(0,a.jsx)(n("kDB94").ToolbarButtonGroup,{children:e})},{type:n("cPCP8").REDO_BUTTON.type,key:n("cPCP8").REDO_BUTTON.key,parents:[{type:n("cPCP8").REDO_CHANGES_GROUP.type,key:n("cPCP8").REDO_CHANGES_GROUP.key,rank:n("4Chin").REDO_CHANGES_GROUP_RANK[n("cPCP8").REDO_BUTTON.key]}],component:()=>(0,a.jsx)(E,{api:e})}]};t.exports.undoRedoPlugin=({api:e})=>{let t={current:null},o=!!e?.toolbar,r=({editorView:t,disabled:o,isToolbarReducedSpacing:r})=>t?(0,a.jsx)(b,{isReducedSpacing:r,disabled:o,editorView:t,api:e}):null;return o?e?.toolbar?.actions.registerComponents(T(e)):e?.primaryToolbar?.actions.registerComponent({name:"undoRedoPlugin",component:r}),{name:"undoRedoPlugin",actions:{undo:o=>!!t.current&&P(t.current,e)(p(e?.analytics?.actions)(o||l.EXTERNAL,n("d925B").ACTION.UNDO_PERFORMED)(n("ke2AI").undo)),redo:o=>!!t.current&&P(t.current,e)(p(e?.analytics?.actions)(o||l.EXTERNAL,n("d925B").ACTION.REDO_PERFORMED)(n("ke2AI").redo))},pmPlugins(){let o=[{name:"undoRedoKeyMap",plugin:()=>(function(e){let t={};return(0,n("hgeg8").bindKeymapWithCommand)((0,n("hgeg8").findKeyMapForBrowser)(n("hgeg8").redo),f(e?.analytics?.actions),t),(0,n("hgeg8").bindKeymapWithCommand)((0,n("hgeg8").findKeyMapForBrowser)(n("hgeg8").redoAlt),f(e?.analytics?.actions),t),(0,n("hgeg8").bindKeymapWithCommand)(n("hgeg8").undo.common,u(e?.analytics?.actions),t),new(0,n("1S4f7").SafePlugin)({props:{handleKeyDown(e,o){let r=(0,n("hgeg8").isCapsLockOnAndModifyKeyboardEvent)(o);return(0,n("dus6D").keydownHandler)(t)(e,r)}}})})(e)},{name:"undoRedoPlugin",plugin:e=>g(e)}];return(0,i.editorExperiment)("platform_editor_controls","variant1",{exposure:!1})&&o.push({name:"undoRedoGetEditorViewReferencePlugin",plugin:()=>new(0,n("1S4f7").SafePlugin)({view:e=>(t.current=e,{destroy:()=>{t.current=null}})})}),o},primaryToolbarComponent:e?.primaryToolbar||o?void 0:r}}}),a("vxKdN",function(e,t){n("42omo");let o=e=>(0,n("9K4OG").jsx)(n("gndLe").default,e),r=new(0,n("ks2lK").PluginKey)("unsupportedContentPlugin"),a=e=>{let{portalProviderAPI:t,eventDispatcher:a,dispatchAnalyticsEvent:i}=e;return new(0,n("1S4f7").SafePlugin)({key:r,props:{nodeViews:{confluenceUnsupportedBlock:n("2gkmX").default.fromComponent(n("iq4lN").default,t,a,{dispatchAnalyticsEvent:i},void 0),confluenceUnsupportedInline:(0,n("bT1qC").getInlineNodeViewProducer)({pmPluginFactoryParams:e,Component:o,extraComponentProps:{dispatchAnalyticsEvent:i}}),unsupportedBlock:n("2gkmX").default.fromComponent(n("iq4lN").default,t,a,{dispatchAnalyticsEvent:i},void 0),unsupportedInline:(0,n("bT1qC").getInlineNodeViewProducer)({pmPluginFactoryParams:e,Component:o,extraComponentProps:{dispatchAnalyticsEvent:i}})}}})};e.exports.unsupportedContentPlugin=()=>({name:"unsupportedContent",marks:()=>[{name:"unsupportedMark",mark:n("6eIpX").unsupportedMark},{name:"unsupportedNodeAttribute",mark:n("8KqSY").unsupportedNodeAttribute}],nodes:()=>[{name:"confluenceUnsupportedBlock",node:n("aZa28").confluenceUnsupportedBlock},{name:"confluenceUnsupportedInline",node:n("fnSCn").confluenceUnsupportedInline},{name:"unsupportedBlock",node:n("iSXnW").unsupportedBlock},{name:"unsupportedInline",node:n("cre7m").unsupportedInline}],pmPlugins:()=>[{name:"unsupportedContent",plugin:a}]})}),a("3O0YV",function(e,t){let o=new(0,n("ks2lK").PluginKey)("userIntentPlugin"),r={currentUserIntent:"default"},a=()=>new(0,n("1S4f7").SafePlugin)({key:o,state:{init:()=>r,apply:(e,t)=>{let r=e.getMeta(o);return r?r.data.currentUserIntent===t.currentUserIntent?t:{currentUserIntent:r.data.currentUserIntent}:t}}}),i=e=>({tr:t})=>(t.setMeta(o,{type:"setCurrentUserIntent",data:{currentUserIntent:e}}),t);e.exports.userIntentPlugin=()=>({name:"userIntent",pmPlugins:()=>[{name:"userIntentPlugin",plugin:a}],getSharedState:e=>{if(!e)return;let t=o.getState(e);if(t)return{currentUserIntent:t.currentUserIntent}},commands:{setCurrentUserIntent:i}})}),a("fI6T7",function(e,t){var o=n("iu6m9");let r=new(0,n("ks2lK").PluginKey)("widthPlugin");var a=n("42omo");let i=["transitionend","oTransitionEnd","webkitTransitionEnd"],l=e=>{let[t,o]=(0,a.useState)();(0,a.useEffect)(()=>{if(!e)return;let t=e=>{e.propertyName.includes("width")&&o(e)};return(0,n("fFa3V").bindAll)(e,i.map(e=>({type:e,listener:t})))},[e])},s=e=>t=>{let{dispatch:o,state:{tr:n}}=t;n.setMeta(r,e),o(n)},d=(0,n("dTb09").conditionalHooksFactory)(()=>(0,o.editorExperiment)("platform_editor_stop_width_reflows",!0,{exposure:!0}),function({editorView:e,containerElement:t}){l(t),(0,a.useEffect)(()=>{let o=new ResizeObserver(o=>{if(o.length<1)return;let r=o.find(e=>e.target===t),n=o.find(t=>t.target===e.dom);s({width:r?.borderBoxSize[0]?.inlineSize,lineLength:n?.borderBoxSize[0]?.inlineSize})(e)});return t&&o.observe(t),e.dom&&o.observe(e.dom),()=>{o.disconnect()}},[t,e])},({editorView:e,containerElement:t})=>{l(t),(0,a.useEffect)(()=>{s({lineLength:e.dom.clientWidth,width:t?.offsetWidth})(e)},[e,e.dom.clientWidth,t]),(0,a.useEffect)(()=>{let o=new ResizeObserver(t=>{if(1!==t.length)return;let[o]=t;if(o&&Array.isArray(o.borderBoxSize))s({width:o.borderBoxSize[0].inlineSize,lineLength:e.dom.clientWidth})(e)});return t&&o.observe(t),()=>{o.disconnect()}},[t,e])});e.exports.widthPlugin=()=>({name:"width",pmPlugins:()=>[{name:"width",plugin:({dispatch:e})=>new(0,n("1S4f7").SafePlugin)({key:r,state:{init:()=>(0,o.editorExperiment)("platform_editor_stop_width_reflows",!0)?{width:n("aFUXX").VIEWPORT_SIZES.laptopMDPI.width,lineLength:n("aFUXX").akEditorDefaultLayoutWidth}:{width:document.body.offsetWidth},apply(t,n){let a=t.getMeta(r);if(!a)return n;let i=(0,o.editorExperiment)("platform_editor_stop_width_reflows",!0)?{width:a.width??n?.width,lineLength:a.lineLength??n?.lineLength}:{...n,...a};return i&&(n.width!==i.width||n.lineLength!==i.lineLength)?(e(r,i),i):n}}})}],getSharedState:e=>{if(e)return r.getState(e)},usePluginHook:d})}),a("3bEAg",function(t,o){Object.defineProperty(t.exports,"ContextPanelConsumer",{get:()=>s,set:void 0,enumerable:!0,configurable:!0});var r=n("42omo");let a=e(r).createContext({width:0,positionedOverEditor:!1,broadcastWidth:()=>{},broadcastPosition:()=>{}});class i extends e(r).Component{render(){let{width:t,positionedOverEditor:o}=this.state;return e(r).createElement(l,{value:{width:t,positionedOverEditor:o,broadcastWidth:this.broadcastSidebarWidth,broadcastPosition:this.broadcastPosition}},this.props.children)}constructor(e){super(e),this.state={width:0,positionedOverEditor:!1},this.broadcastSidebarWidth=e=>{e!==this.state.width&&this.setState({width:e})},this.broadcastPosition=e=>{e!==this.state.positionedOverEditor&&this.setState({positionedOverEditor:e})}}}let{Provider:l,Consumer:s}=a;t.exports.ContextPanelWidthProvider=i}),t.rlb("86sUJ");
//# sourceMappingURL=FullPageEditorComponent.d0d7dbe1.js.map
