function e(e){return e&&e.__esModule?e.default:e}function t(e,t,n,i){Object.defineProperty(e,t,{get:n,set:i,enumerable:!0,configurable:!0})}var n=globalThis,i=n.parcelRequired477,a=i.register;a("bRTjQ",function(t,n){var a=i("42omo"),r=i("3pfAb");let o=(e,t)=>{if(e&&"function"==typeof e){let n=performance.getEntriesByName("browser-metric.start").pop()?.startTime,a=(0,i("2SowE").getProseMirrorFMPTimestamp)(t?.startTime,t?.duration),r=void 0!==n&&void 0!==a?Math.round(a-n):a;e({...t,proseMirrorRenderedFMP:r,proseMirrorRenderedTimestamp:a})}};t.exports.EditorAnalyticsListener=t=>{let n=(0,i("3jwuS").useIsCurrentPageLive)(),s=(0,i("7QM6o").useSpaceId)(),{edition:l,environment:c}=(0,i("bQm3c").useSessionData)()||{},d=c||"DEVELOPMENT",{contentId:p,contentType:u,children:g,source:m,collabService:f,onProseMirrorRendered:h,isGuest:_,touchpointId:y}=t,I=(0,a.useCallback)(e=>{e?.payload?.action==="proseMirrorRendered"&&o(h,e?.payload?.attributes),e.update(t=>{let a=t.attributes&&"comment"===t.attributes.appearance,r=(0,i("2SowE").extendPayloadAttributes)(t,{objectId:a?t.attributes.objectId:p,editorSource:m});if(d&&(r=(0,i("2SowE").extendPayloadAttributes)(r,{instance:d})),r=(0,i("2SowE").extendPayloadAttributes)(r,{collabService:f??"none",isLivePage:n,edition:l,spaceId:s}),void 0!==_&&(r=(0,i("2SowE").extendPayloadAttributes)(r,{isGuest:_})),y&&(r=(0,i("2SowE").extendPayloadAttributes)(r,{touchpointId:y})),r.source=m||"unknown",e.context){let t=(0,i("2SowE").extractAttributesFromContext)(e.context);r.attributes={...r.attributes,...t}}return r})},[p,m,f,h,l,d,n,s,_,y]),E=(0,a.useCallback)(e=>{e.update(e=>(0,i("2SowE").extendPayloadAttributes)(e,{pageType:u,editorSource:m,objectId:p,objectType:u,spaceId:s,isLivePage:n}))},[p,u,m,n,s]);return e(a).createElement(i("kDuN4").default,{onEvent:I,channel:r.FabricChannel.editor},e(a).createElement(i("kDuN4").default,{onEvent:E,channel:r.FabricChannel.elements},e(a).createElement(i("kDuN4").default,{onEvent:E,channel:r.FabricChannel.media},g)))}}),a("2dIEg",function(t,n){var a=i("42omo");t.exports.EditorPluginAIWithFeedback=({editorPluginAIFeedbackHandlers:t})=>{let{cloudId:n}=(0,i("bQm3c").useSessionData)(),{FeedbackCollector:r,openFeedbackCollector:o}=(0,i("csex9").useEditorAIFeedbackCollector)();return(0,a.useEffect)(()=>{t.current&&(t.current.handleFeedbackClicked=o)},[t,n,o]),e(a).createElement(r,null)}}),a("csex9",function(t,n){var a=i("42omo");let r=(0,i("cgtv4").defineMessages)({feedbackTitle:{id:"editor-features.rovo-feedback-collector.title",defaultMessage:"Help us make Rovo even better"},flagTitle:{id:"editor-features.ai-feedback-collector.flag-title",defaultMessage:"Thanks!"},flagDescription:{id:"editor-features.ai-feedback-collector.flag-description",defaultMessage:"Your valuable feedback helps us continually improve our products."},summaryPlaceholder:{id:"editor-features.ai-feedback-collector.summary-placeholder",defaultMessage:"Let us know what you were trying to do and how it could be better"},userConsentCheckboxLabel:{id:"editor-features.ai-feedback-collector.user-consent-checkbox-label",defaultMessage:"Include my last prompt and response in the feedback."},canContactText:{id:"editor-features.ai-feedback-collector.can-contact.label",defaultMessage:"Atlassian can contact me about this feedback. See our {privacyPolicyLink}."},privacyPolicyLink:{id:"editor-features.ai-feedback-collector.privacy-policy.link",defaultMessage:"privacy policy"},improveAtlassianText:{id:"editor-features.ai-feedback-collector.improve-atlassian",defaultMessage:"I’d like to help improve Atlassian products by joining the {researchGroupLink}."},researchGroupLink:{id:"editor-features.ai-feedback-collector.research-group.link",defaultMessage:"Atlassian Research Group"}}),o=({link:t})=>(0,i("dh538").fg)("dst-a11y__replace-anchor-with-link__page-experienc")?e(a).createElement(i("2Nwuj").default,{target:"_blank",href:t},e(a).createElement(i("gtD4K").default,r.privacyPolicyLink)):e(a).createElement("a",{target:"_blank",href:t},e(a).createElement(i("gtD4K").default,r.privacyPolicyLink)),s=({link:t})=>(0,i("dh538").fg)("dst-a11y__replace-anchor-with-link__page-experienc")?e(a).createElement(i("2Nwuj").default,{target:"_blank",href:t},e(a).createElement(i("gtD4K").default,r.researchGroupLink)):e(a).createElement("a",{target:"_blank",href:t},e(a).createElement(i("gtD4K").default,r.researchGroupLink)),l=()=>e(a).createElement(i("gtD4K").default,{...r.canContactText,values:{privacyPolicyLink:e(a).createElement(o,{link:"https://www.atlassian.com/legal/privacy-policy"})}}),c=()=>e(a).createElement(i("gtD4K").default,{...r.improveAtlassianText,values:{researchGroupLink:e(a).createElement(s,{link:"https://www.atlassian.com/research-group"})}}),d=({feedbackContext:e,hasUserConsent:t})=>{if(!e)return;let n=e.getAIExperience?.(t)||{},i=`sentiment: ${e.sentiment}
`;return Object.entries({...n,...e.editorAttributes}).forEach(e=>{i+=`${e[0]}: ${e[1]}
`}),[{id:"customfield_10047",value:i}]},p=(0,i("7aRa9").withFlags)(({flags:t,feedbackTitle:n,feedbackContext:o,onClose:s})=>{let{formatMessage:p}=(0,i("8C5kA").default)(),{userIdForAnalytics:u,displayName:g}=(0,i("bQm3c").useSessionData)(),{loading:m,error:f,restrictions:h}=(0,i("jLw6A").usePageRestrictionsContext)(),[_,y]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(!m&&!f&&h)return y(!(h.hasRestrictions||h.hasViewRestrictions||h.hasInheritedRestrictions))},[m,f,h]);let I=(0,a.useCallback)(()=>{y(e=>!e)},[]),{showFlag:E}=t,S=o?.sentiment==="recommendation-feedback";return e(a).createElement(i("biiXa").default,{name:g??void 0,atlassianAccountId:u??void 0,onClose:s,onSubmit:()=>{E({type:"success-circle",title:p(r.flagTitle),description:p(r.flagDescription)})},customContent:S?e(a).createElement(e(a).Fragment,null):e(a).createElement(i("7gpC4").default,{label:p(r.userConsentCheckboxLabel),onChange:I,isChecked:_}),entrypointId:"73cf1eae-42a3-418a-a7ac-976ba0b5735d",showTypeField:!1,feedbackTitle:n||p(r.feedbackTitle),anonymousFeedback:!1,summaryPlaceholder:p(r.summaryPlaceholder),canBeContactedLabel:e(a).createElement(l,null),enrolInResearchLabel:e(a).createElement(c,null),additionalFields:d({feedbackContext:o,hasUserConsent:_})})});t.exports.useEditorAIFeedbackCollector=()=>{let[t,n]=(0,a.useState)(!1),[i,r]=(0,a.useState)(),o=(0,a.useCallback)(()=>{r(void 0),n(!1)},[]),s=(0,a.useCallback)(e=>{r(e),n(!0)},[]);return{FeedbackCollector:(0,a.useCallback)(()=>t?e(a).createElement(p,{feedbackContext:i,onClose:o}):null,[t,o,i]),openFeedbackCollector:s}}}),a("f6GmT",function(e,t){var n=i("42omo");e.exports.useEditorPluginAIFeedbackHandlers=()=>({editorPluginAIFeedbackHandlers:(0,n.useRef)({handleFeedbackClicked:()=>{},handleReviewStateEntered:()=>{},handleExperienceEnded:()=>{}})})}),a("bK3oZ",function(t,n){var a=i("42omo"),r=i("fD5Hh"),o=i("6VfGD");function s(e,...t){try{window.top?.__aifcDebuggerEnabled__&&console.log(`[editor-rovo-bridge]: ${e}`,...t)}catch(e){}}class l{updateProps(e){this.props=e}deregister(){}constructor(e){this.props=void 0,this.props=e}}class c extends l{execute(){s("handle rovo-stream-aborted-command");try{this.onAbort()}catch{}}constructor(e,t){super(e),this.onAbort=t}}class d extends l{clearInactivityTimeout(){null!==this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}startInactivityTimeout(){this.clearInactivityTimeout(),this.timeout=setTimeout(()=>{this.handleAbort(),this.props.onStreamTimeout?.({streamType:this.streamType})},1e4)}async execute(e){try{this.startInactivityTimeout(),this.isStreaming||(this.isStreaming=!0,this.isStreamFinished=!1,this.finalAdf=void 0,this.props.onStreamStart?.({streamType:this.streamType,payload:e})),await this.process(e),this.props.onStream?.({streamType:this.streamType,payload:e}),e.isStreamComplete&&(this.clearInactivityTimeout(),await this.finish(),this.isStreaming=!1,this.props.onStreamEnd?.({streamType:this.streamType,payload:e,adfDoc:this.finalAdf}))}catch(e){this.props.onStreamError?.({error:e,streamType:this.streamType}),this.handleAbort()}}async finish(){!this.isStreamFinished&&(this.isStreamFinished=!0,this.finalAdf=await this.finishAction(),this.finalAdf&&this.props.reuploadImages&&((0,i("dh538").fg)("confluence_frontend_aifc_reupload_image")?await this.props.reuploadImages():"update"!==this.streamType&&await this.props.reuploadImages(this.finalAdf)))}handleAbort(){s(`handle abort ${this.streamType} streaming command handler`),this.isStreaming=!1,this.isStreamFinished=!1,this.finalAdf=void 0,this.clearInactivityTimeout(),this.abort()}deregister(){s(`deregister ${this.streamType} streaming command handler`),this.isStreaming=!1,this.isStreamFinished=!1,this.finalAdf=void 0,this.clearInactivityTimeout()}constructor(e,t){super(e),this.streamType=t,this.isStreaming=!1,this.timeout=null,this.isStreamFinished=!1,this.finalAdf=void 0}}class p extends d{process(e){e.data.adf&&(!this.createCommandProcessor.isInitialized()&&e.data.previousAccumulatedData&&(this.props.editorAPI.core.actions.replaceDocument("",{addToHistory:!1,scrollIntoView:!1}),this.createCommandProcessor.stream(e.data.previousAccumulatedData,!1)),e.isStreamComplete||this.createCommandProcessor.stream(e.data.adf,this.isStreamFinished))}async finishAction(){let e=await this.createCommandProcessor.finish({onError:this.props.onStreamError,onRepair:this.props.onStreamRepair});return e&&(this.props.editorAPI.core.actions.replaceDocument(e,{addToHistory:!1,scrollIntoView:!1}),(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")&&this.props.editorAPI.core.actions.execute(this.props.editorAPI.expand?.commands.toggleExpandRange())),e}abort(){this.createCommandProcessor.abort()}constructor(e,t){super(e,"create"),this.createCommandProcessor=t}}let u=e=>new Promise(t=>{try{e.core.actions.requestDocument(e=>{t(e)},{alwaysFire:!0})}catch{t(void 0)}}),g=async({props:e,doc:t,selectionFragment:n,selectionLocalIds:a,selectionMarkdown:r})=>{let o=e.additionalContext||{isViewMode:!1};if("function"==typeof o)if((0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers"))try{o=await o()}catch(e){o={}}else o=await o();let{isViewMode:s=!1,...l}=o||{};return{contentId:e.contentId,contentType:e.contentType,pageBody:t,selectionFragment:n,selectionLocalIds:a,selectionMarkdown:r,isViewMode:s,useGenericEditorSkill:e.useGenericEditorSkill,additionalContext:Object.keys(l).length>0?l:void 0}};class m extends l{async execute(){let e=await g({props:this.props,doc:void 0,selectionFragment:"",selectionLocalIds:"",selectionMarkdown:""});try{let t=(0,i("dh538").fg)("platform_editor_aifc_rovo_bridge_partial_doc")?this.props.editorAPI?.aiExperience?.actions.getPartialDocumentFromSelection():(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?await this.props.editorAPI.core.actions.requestDocumentAsync():await u(this.props.editorAPI);if(!t)return e;let n=this.props.editorAPI.aiExperience?.actions.getAISelectionContext(),a=await g({props:this.props,doc:t,selectionFragment:n?.selectionFragment?JSON.stringify(n.selectionFragment):"",selectionLocalIds:n?.localIds?JSON.stringify(n.localIds):"",selectionMarkdown:n?.selectionMarkdown??""});return s("handle read-content-command result",{additionalContext:this.props.additionalContext,doc:t,selection:n,content:a}),a??e}catch{return e}}}class f extends l{execute(){}}class h extends d{async process(e){await this.updateCommandProcessor.streamChunk(e.data.toolCalls,e.isStreamComplete)}async finishAction(){await this.updateCommandProcessor.finish()}abort(){this.updateCommandProcessor.abort()}constructor(e,t){super(e,"update"),this.updateCommandProcessor=t}}class _{getPosition(){return this.position}reset(e,t=0){this.input=e,this.position=t,this.lastTokenType=null}isWhitespace(e){return[" ","\n","	","\r"].includes(e)}isExpectingKey(){return"LEFT_BRACE"===this.lastTokenType||"COMMA"===this.lastTokenType}isDigit(e){return e>="0"&&e<="9"}isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}isHexDigit(e){return e>="0"&&e<="9"||e>="a"&&e<="f"||e>="A"&&e<="F"}peek(){return this.position<this.input.length&&this.input[this.position]||"\0"}advance(){return this.position<this.input.length&&this.input[this.position++]||"\0"}skipWhitespace(){for(;this.position<this.input.length&&this.isWhitespace(this.peek());)this.advance()}isClosingQuote(e){let t=e+1;for(;t<this.input.length&&this.isWhitespace(this.input[t]||"");)t++;if(t<this.input.length){let e=this.input[t];return _.CLOSING_DELIMITERS.has(e||"")}return!0}readString(){let e=this.position;this.advance();let t="",n=!1;for(;this.position<this.input.length;)if("\\"===this.peek()){this.advance();let e=this.advance();switch(e){case'"':t+='"';break;case"\\":t+="\\";break;case"/":t+="/";break;case"b":t+="\b";break;case"f":t+="\f";break;case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="	";break;case"u":{let e="";for(let t=0;t<4;t++){let t=this.peek();if(this.isHexDigit(t))e+=this.advance();else break}if(e.length<4){t+="\\u"+e;break}let n=parseInt(e,16);if(n>=55296&&n<=56319){if(this.position+6<=this.input.length&&"\\"===this.input[this.position]&&"u"===this.input[this.position+1]){let e=this.input.substring(this.position+2,this.position+6);if(/^[0-9a-fA-F]{4}$/.test(e)){let i=parseInt(e,16);if(i>=56320&&i<=57343){this.advance(),this.advance();for(let e=0;e<4;e++)this.advance();t+=String.fromCodePoint((n-55296<<10)+(i-56320)+65536);break}}}t+=String.fromCharCode(n)}else t+=String.fromCharCode(n);break}default:t+=e}}else if('"'===this.peek())if(!this.lenientStringParsing||this.isExpectingKey()||this.isClosingQuote(this.position))break;else t+=this.advance(),n=!0;else t+=this.advance();return'"'===this.peek()&&this.advance(),n&&this.onRepair?.({type:"infer",from:"unescaped_quote",to:"escaped_quote",context:"tokenizer_string"}),{type:"STRING",value:t,position:e}}readNumber(){let e=this.position,t="";if("-"===this.peek()&&(t+=this.advance()),"0"===this.peek())t+=this.advance();else if(this.isDigit(this.peek()))for(;this.isDigit(this.peek());)t+=this.advance();else throw Error(`Invalid number at position ${this.position}`);if("."===this.peek()){if(t+=this.advance(),!this.isDigit(this.peek()))throw Error(`Invalid number at position ${this.position}`);for(;this.isDigit(this.peek());)t+=this.advance()}if("e"===this.peek()||"E"===this.peek()){if(t+=this.advance(),("+"===this.peek()||"-"===this.peek())&&(t+=this.advance()),!this.isDigit(this.peek()))throw Error(`Invalid number at position ${this.position}`);for(;this.isDigit(this.peek());)t+=this.advance()}return{type:"NUMBER",value:t,position:e}}readLiteral(){let e=this.position,t="";for(;this.position<this.input.length&&this.isAlpha(this.peek());)t+=this.advance();if(this.position>=this.input.length&&t.length>0&&t.length<5){let e=t;"true".startsWith(t)?t="true":"false".startsWith(t)?t="false":"null".startsWith(t)&&(t="null"),e!==t&&this.onRepair?.({type:"infer",from:e,to:t,context:"tokenizer_partial_literal"})}if("true"===t||"false"===t)return{type:"BOOLEAN",value:"true"===t?"true":"false",position:e};if("null"===t)return{type:"NULL",value:"null",position:e};if('"'===this.peek()){let e=this.position;this.advance(),this.skipWhitespace(),":"===this.peek()?this.onRepair?.({type:"skip",from:"misplaced_quote",to:"-",context:"tokenizer_key"}):this.position=e}return this.onRepair?.({type:"infer",from:t,to:`"${t}"`,context:"tokenizer_unquoted_string"}),{type:"STRING",value:t,position:e}}createSingleCharToken(e,t){let n=this.position;return this.advance(),{type:e,value:t,position:n}}nextToken(){let e;if(this.skipWhitespace(),this.position>=this.input.length){let e={type:"EOF",value:"",position:this.position};return this.lastTokenType=e.type,e}let t=this.peek();switch(t){case"{":e=this.createSingleCharToken("LEFT_BRACE","{");break;case"}":e=this.createSingleCharToken("RIGHT_BRACE","}");break;case"[":e=this.createSingleCharToken("LEFT_BRACKET","[");break;case"]":e=this.createSingleCharToken("RIGHT_BRACKET","]");break;case":":e=this.createSingleCharToken("COLON",":");break;case",":e=this.createSingleCharToken("COMMA",",");break;case'"':e=this.readString();break;case"-":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":e=this.readNumber();break;default:if(this.isAlpha(t))e=this.readLiteral();else throw Error(`Unexpected character '${t}' at position ${this.position}`)}return this.lastTokenType=e.type,e}constructor(e,t,n=!1){this.input=e,this.onRepair=t,this.lenientStringParsing=n,this.position=0,this.lastTokenType=null}}_.CLOSING_DELIMITERS=new Set([",","}","]",":","{","["]);class y{getRepairs(){return this.repairs}processChunk(e,t=!1){if(this.lastChunkReceived)throw Error("Cannot call processChunk() after isLastChunk=true was signaled. Create a new AdfParser instance or use parse() for multiple documents.");this.accumulatedInput+=e,this.resetParserState(this.accumulatedInput,!1),this.tokenizer.reset(this.accumulatedInput,0),this.currentToken=this.tokenizer.nextToken();let n=this.parseDocument();return t?(this.parseComplete=!0,this.lastChunkReceived=!0):this.parseComplete="EOF"===this.currentToken.type&&!this.hitEofDuringExpect,this.cachedDocument=n,n}getPartialDocument(){return this.cachedDocument}isComplete(){return this.parseComplete}countNodesInTree(e){let t=1;if(Array.isArray(e.marks)&&(t+=e.marks.length),Array.isArray(e.content))for(let n of e.content)t+=this.countNodesInTree(n);return t}recordRepair(e){this.repairs.push(e),this.callbacks.onRepair?.(e)}updateNodeHandle(e,t){e&&this.callbacks.onNodeUpdate&&this.callbacks.onNodeUpdate(e,t)}addRepairedNode(e,t,n,i){if(Array.isArray(e)&&0===e.length)return;let a=this.countNodesInTree(n),r=Array.isArray(e)?e.reduce((e,t)=>e+this.countNodesInTree(t),0):this.countNodesInTree(e),o=Array.isArray(e),s=o?"❌":e.type||"❌",l=o&&Array.isArray(e)&&1===e.length&&e[0]?.type===n.type,c={type:o?"unwrap":"wrap",from:n.type,to:s,context:i,expansion:r-a,nodePreserved:o?l:void 0};this.recordRepair(c),Array.isArray(e)?t.push(...e):t.push(e)}tryAppendNodeToContent(e,t,n,i,a){let r=a?.topNodeType||this.validator.getTopNodeType();if(!t?.type){let i=this.repairStrategy.tryRepair(t,e,n);if(t.type)this.recordRepair({type:"infer",from:"missing_type",to:t.type,context:`inferred_from_properties:${e||r}`});else if(i)return void this.addRepairedNode(i,n,t,e||r);else return}if("text"===t.type&&(!t.text||0===t.text.length)){if(this.recordRepair({type:"skip_empty_text",from:"text",to:"-",context:e||r}),Array.isArray(t.marks))for(let n of t.marks)n.type&&this.recordRepair({type:"skip_empty_text",from:n.type,to:"-",context:`${e||r}:text`});return}this.repairStrategy.applyNodeMutations(t);let o=i(t.type),s=this.repairStrategy.shouldAttemptStructuralFix(t,e);if(!o||s){let i=this.repairStrategy.tryRepair(t,e,n);return i?void this.addRepairedNode(i,n,t,e||r):void this.recordRepair({type:"skip",from:t.type,to:"-",context:e||r})}n.push(t)}advance(){this.currentToken=this.tokenizer.nextToken()}peekType(...e){return e.includes(this.currentToken.type)}isStartOfStructure(e){return"LEFT_BRACE"===e||"LEFT_BRACKET"===e}isPrimitiveToken(e){return"STRING"===e||"NUMBER"===e||"BOOLEAN"===e||"NULL"===e}isObjectPropertyValueStart(e){return"COLON"===e||this.isPrimitiveToken(e)||this.isStartOfStructure(e)}isObjectStart(){if("STRING"!==this.currentToken.type)return!1;let e=this.tokenizer.getPosition(),t=this.currentToken,n=this.tokenizer.nextToken(),i=this.isObjectPropertyValueStart(n.type);return this.tokenizer.reset(this.accumulatedInput,e),this.currentToken=t,i}consume(e){if(this.currentToken.type===e){let e=this.currentToken;return this.advance(),e}return null}expectAndAdvance(e){this.expect(e),this.currentToken.type===e&&this.advance()}getTryAppendOptions(){return{topNodeType:this.currentParentType||this.validator.getTopNodeType()}}withParentContext(e,t){let n=this.currentParentType;this.currentParentType=e;try{return t()}finally{this.currentParentType=n}}expectOptionalDelimiter(e,t){if(this.peekType(e))return this.advance(),!0;if(this.peekType("STRING"))return this.recordRepair({type:"skip",from:`missing_${e}`,to:"inferred",context:t}),!1;if(this.peekType("EOF"))return this.expect(e),!1;if(this.peekType("LEFT_BRACE")&&"LEFT_BRACKET"===e)return!1;throw Error(`Expected ${e} or STRING, got ${this.currentToken.type} at position ${this.currentToken.position}`)}expect(e){if(this.currentToken.type!==e)if("EOF"===this.currentToken.type){this.hitEofDuringExpect=!0,this.recordRepair({type:"skip",from:`expected_${e}`,to:"EOF",context:"streaming"});return}else throw Error(`Expected ${e}, got ${this.currentToken.type} at position ${this.currentToken.position}`)}parsePrimitiveValue(){if("STRING"===this.currentToken.type){let e=this.currentToken.value;return this.advance(),e}if("NUMBER"===this.currentToken.type){let e=Number(this.currentToken.value);return this.advance(),e}if("BOOLEAN"===this.currentToken.type){let e="true"===this.currentToken.value;return this.advance(),e}if("NULL"===this.currentToken.type)return this.advance(),null;this.skipValue()}parseObjectProperties(e,t="object"){if(!this.expectOptionalDelimiter("LEFT_BRACE",t)&&this.peekType("EOF"))return;let n=new Set;for(;!this.peekType("RIGHT_BRACE")&&!this.peekType("EOF");){if(!this.peekType("STRING")){this.skipValue();continue}let i=this.consume("STRING"),a=i?.value;if(this.consume("COMMA")){this.recordRepair({type:"skip",from:`key_${a}`,to:"-",context:t});continue}if(this.consume("COLON"));else{if(this.peekType("EOF"))continue;this.recordRepair({type:"skip",from:"missing_colon",to:"inferred",context:`${t}.${a}`})}if(n.has(a)&&this.recordRepair({type:"duplicate_key",from:a,to:"overwritten",context:t}),n.add(a),e(a),this.skipContainer&&(this.skipContainer=!1,this.peekType("LEFT_BRACE")))return;this.consume("COMMA")}this.expect("RIGHT_BRACE"),this.consume("RIGHT_BRACE")}skipValue(){switch(this.currentToken.type){case"STRING":case"NUMBER":case"BOOLEAN":case"NULL":this.advance();break;case"LEFT_BRACE":this.skipObject();break;case"LEFT_BRACKET":this.skipArray();break;case"RIGHT_BRACE":case"RIGHT_BRACKET":case"COMMA":case"COLON":this.recordRepair({type:"skip",from:this.currentToken.type,to:"-",context:"parser"}),this.advance();break;case"EOF":this.recordRepair({type:"skip",from:this.currentToken.type,to:"-",context:"parser"});break;default:{let e=this.currentToken;this.recordRepair({type:"skip",from:e.type,to:"-",context:"parser"}),this.advance()}}}skipDelimitedSequence(e,t,n){for(this.expectAndAdvance(e);this.currentToken.type!==t&&"EOF"!==this.currentToken.type;)n(),"COMMA"===this.currentToken.type&&this.advance();this.expectAndAdvance(t)}skipObject(){this.skipDelimitedSequence("LEFT_BRACE","RIGHT_BRACE",()=>{this.expect("STRING"),this.advance(),this.expect("COLON"),this.advance(),this.skipValue()})}skipArray(){this.skipDelimitedSequence("LEFT_BRACKET","RIGHT_BRACKET",()=>{this.skipValue()})}parseArray(e,t){for(this.expectAndAdvance("LEFT_BRACKET");!this.peekType("RIGHT_BRACKET")&&!this.peekType("EOF");){if(this.consume("COMMA"))continue;let n=e();null!==n&&t(n)}this.expectAndAdvance("RIGHT_BRACKET")}parseContentArray(e){let t=this.validator.isValidChild(e);if(this.peekType("LEFT_BRACE")){this.recordRepair({type:"skip",from:"missing_brackets",to:"inferred_array",context:e||"content"});let n=[];for(;this.peekType("LEFT_BRACE")||this.isObjectStart();){let i=this.parseContentNode();if(i&&this.tryAppendNodeToContent(e,i,n,t,this.getTryAppendOptions()),this.consume("COMMA"));else if(this.consume("RIGHT_BRACE")){if(!this.peekType("LEFT_BRACE"))break}else if(this.peekType("LEFT_BRACE"));else break}return n}if(this.consume("LEFT_BRACKET")){let n=[],i=!1;for(;!this.peekType("RIGHT_BRACKET")&&!this.peekType("EOF");)if(!(this.consume("COMMA")||this.consume("RIGHT_BRACE")))if(this.peekType("LEFT_BRACE")||this.isObjectStart()){let a=this.currentToken,r=this.parseContentNode();if(r){if(this.config.closeBrokenContent&&this.repairStrategy.shouldAttemptStructuralFix(r,e)&&e!==this.validator.getTopNodeType()){this.tokenizer.reset(this.accumulatedInput,a.position),this.currentToken=this.tokenizer.nextToken(),this.recordRepair({type:"unwrap",from:"implicit_container_end",to:"break_container",context:e||"unknown"}),i=!0;break}this.tryAppendNodeToContent(e,r,n,t,this.getTryAppendOptions())}}else this.skipValue();return i?this.skipContainer=!0:(this.expectAndAdvance("RIGHT_BRACKET"),this.skipContainer=!1),n}return this.peekType("EOF")?this.expect("LEFT_BRACKET"):(this.recordRepair({type:"skip",from:this.currentToken.type,to:"empty_array",context:e||"content"}),this.skipValue()),[]}parseMarks(){let e=[];return this.parseArray(()=>{if("LEFT_BRACE"!==this.currentToken.type)return this.skipValue(),null;let e={};return this.parseObjectProperties(t=>{"type"===t?"STRING"===this.currentToken.type?(e.type=this.currentToken.value,this.advance()):this.skipValue():"attrs"===t&&"LEFT_BRACE"===this.currentToken.type?e.attrs=this.parseAttrs():this.skipValue()},"marks"),e.type?e:null},t=>e.push(t)),e}parseAttrs(){let e={};return this.parseObjectProperties(t=>{e[t]=this.parsePrimitiveValue()},"attrs"),e}parseRootNode(){let e={};if(this.parseObjectProperties(t=>{if("version"===t)"NUMBER"===this.currentToken.type?(e.version=Number(this.currentToken.value),this.advance()):this.skipValue();else if("type"===t)"STRING"===this.currentToken.type?(e.type=this.currentToken.value,this.advance()):this.skipValue();else if("content"===t)e.content=this.withParentContext(e.type,()=>this.parseContentArray(e.type));else if("attrs"===t)"LEFT_BRACE"===this.currentToken.type?e.attrs=this.parseAttrs():this.skipValue();else if("text"===t)"STRING"===this.currentToken.type?(e.text=this.currentToken.value,this.advance()):this.skipValue();else if("marks"===t)"LEFT_BRACKET"===this.currentToken.type?e.marks=this.parseMarks():this.skipValue();else{let n=this.parsePrimitiveValue();e[t]=n}},e.type||"root"),!e.type){let t=this.validator.getTopNodeType();e.type=t,this.recordRepair({type:"infer",from:"missing_type",to:t,context:"root"})}return void 0!==e.content||this.validator.isLeafNode(e.type)||(e.content=[]),e}parseContentNode(){let e,t,n={};return this.parseObjectProperties(i=>{if("type"===i){this.expect("STRING"),t=this.currentToken.position,n.type=this.currentToken.value,this.advance();let i=this.nodeHandlesByPosition.get(t);i?e=i:this.callbacks.onNodeStart&&n.type&&void 0!==(e=this.callbacks.onNodeStart(n.type,this.currentParentType))&&this.nodeHandlesByPosition.set(t,e)}else if("content"===i)n.content=this.withParentContext(n.type,()=>this.parseContentArray(n.type)),this.updateNodeHandle(e,{content:n.content});else if("attrs"===i)"LEFT_BRACE"===this.currentToken.type?(n.attrs=this.parseAttrs(),this.updateNodeHandle(e,{attrs:n.attrs})):this.skipValue();else if("text"===i)"STRING"===this.currentToken.type?(n.text=this.currentToken.value,this.advance(),this.updateNodeHandle(e,{text:n.text})):this.skipValue();else if("marks"===i)"LEFT_BRACKET"===this.currentToken.type?(n.marks=this.parseMarks(),this.updateNodeHandle(e,{marks:n.marks})):this.skipValue();else{let t=this.parsePrimitiveValue();n[i]=t,void 0!==t&&this.updateNodeHandle(e,{[i]:t})}},"node"),n&&e&&(this.callbacks.onNodeComplete?.(e,n),this.nodeHandles.set(n,e)),n}resetParserState(e,t=!0){this.repairs=[],this.accumulatedInput=e,this.parseComplete=!1,this.cachedDocument=null,this.hitEofDuringExpect=!1,this.skipContainer=!1,t&&this.nodeHandles.clear()}parse(e){this.resetParserState(e),this.tokenizer.reset(e,0),this.currentToken=this.tokenizer.nextToken();let t=this.parseDocument();return this.parseComplete=!0,this.cachedDocument=t,t}parseDocument(){let e=this.parseRootNode();if(Array.isArray(e.content)){let t=this.validator.isValidChild(e.type);for(let n of e.content)n.type&&t(n.type)}let t=Array.isArray(e.content)?[...e.content]:[],n=this.validator.isValidChild(e.type);for(;"EOF"!==this.currentToken.type;){if("COMMA"===this.currentToken.type){this.advance();continue}if("LEFT_BRACE"===this.currentToken.type){let i=this.parseContentNode();i&&"object"==typeof i&&this.tryAppendNodeToContent(e.type,i,t,n,{topNodeType:e.type})}else this.advance()}return(t.length>0||Array.isArray(e.content))&&(e.content=t),e}constructor(e){this.tokenizer=void 0,this.currentToken=void 0,this.repairs=[],this.validator=void 0,this.repairStrategy=void 0,this.hitEofDuringExpect=!1,this.config=void 0,this.skipContainer=!1,this.callbacks=void 0,this.currentParentType=void 0,this.nodeHandles=new Map,this.nodeHandlesByPosition=new Map,this.accumulatedInput="",this.parseComplete=!1,this.cachedDocument=null,this.lastChunkReceived=!1,this.validator=e.schemaValidator,this.repairStrategy=e.repairStrategy,this.callbacks=e.callbacks??{},this.config=e.config??{closeBrokenContent:!1,lenientStringParsing:!1},this.tokenizer=new _("",e=>this.recordRepair(e),this.config.lenientStringParsing),this.currentToken=this.tokenizer.nextToken(),this.accumulatedInput=""}}class I{getNodeType(e){return this.schema.nodes[e]||null}wrapNodeWithType(e,t){let n=this.schema.nodeFromJSON(e),i=t.createAndFill(null,n);return i?.toJSON()??null}wrapNode(e,t,n,i){let a=this.findContentMatchAtPosition(n,i),r=a?.findWrapping(t);if(!r||0===r.length)return null;let o=this.schema.nodeFromJSON(e);for(let e=r.length-1;e>=0;e--){let t=r[e],n=t?.contentMatch?.matchType(o.type);if(!n||!n.validEnd)return null;let i=t?.createAndFill(null,o);if(!i)return null;o=i}return o.toJSON()}convertMarkNodeToMark(e,t){let n=e.text&&e.text.length>0?e.text:" ",i=this.schema.text(n,[this.schema.mark(e.type)]);if(t.isTextblock)return i.toJSON();let a=i.toJSON();return this.wrapNode(a,i.type,t,[])??a}isTableCellNode(e){return"tableCell"===e.type||"tableHeader"===e.type}isListNode(e){return I.LIST_NODE_TYPES.has(e.type)}appendToLastSibling(e,t,n){let i=t[t.length-1];return i&&i.type===n?(i.content||(i.content=[]),i.content.push(e),[]):null}wrapOrAppendNode(e,t,n){let i=t[t.length-1],a=Array.isArray(n.directParentTypes)?n.directParentTypes:[n.directParentTypes];if(i){if(a.includes(i.type))if(!n.nestedParentType)return i.content||(i.content=[]),i.content.push(e),[];else{if(i.content||(i.content=[]),i.content.length>0){let t=i.content[i.content.length-1];if(t&&t.type===n.nestedParentType)return t.content||(t.content=[]),t.content.push(e),[]}if(n.createNestedIfMissing)return i.content.push({type:n.nestedParentType,content:[e]}),[]}if(n.checkNestedParent&&i.content&&Array.isArray(i.content)&&i.content.length>0){let t=i.content[i.content.length-1];if(t&&a.includes(t.type))return t.content||(t.content=[]),t.content.push(e),[]}}return n.defaultWrapper}appendToLastTableRow(e,t){return this.appendToLastSibling(e,t,"tableRow")}wrapTableRow(e,t){return this.wrapOrAppendNode(e,t,{directParentTypes:"table",defaultWrapper:{type:"table",attrs:{isNumberColumnEnabled:!1},content:[e]}})}wrapListItem(e,t){return this.wrapOrAppendNode(e,t,{directParentTypes:["bulletList","orderedList"],checkNestedParent:!0,defaultWrapper:{type:"bulletList",content:[e]}})}wrapTaskItem(e,t){return this.wrapOrAppendNode(e,t,{directParentTypes:"taskList",checkNestedParent:!0,defaultWrapper:{type:"taskList",attrs:{localId:null},content:[e]}})}wrapTableCell(e,t){return this.wrapOrAppendNode(e,t,{directParentTypes:"table",nestedParentType:"tableRow",createNestedIfMissing:!0,defaultWrapper:{type:"table",attrs:{isNumberColumnEnabled:!1},content:[{type:"tableRow",content:[e]}]}})}shouldAttemptStructuralFix(e,t){return"table"===t?"tableRow"!==e.type&&!this.isTableCellNode(e):"doc"===t&&("tableRow"===e.type||this.isTableCellNode(e))}isMarkWithOutAttrs(e){let t=this.schema.marks[e];return!!t&&(!t.spec.attrs||0===Object.keys(t.spec.attrs).length)}findContentMatchAtPosition(e,t){let n=e.contentMatch;for(let e of t){if(!n)return null;let t=this.getNodeType(e.type);n=t?n.matchType(t):null}return n}isTypeAllowedAt(e,t){return n=>this.findContentMatchAtPosition(e,t)?.matchType(n)!==null}applyNodeMutations(e){let t=!1;if(e.type||void 0===e.text||(e.type="text",t=!0),!e.type)return t;if("date"===e.type){let t=new Date().getTime().toString();if(e.attrs=e.attrs||{},!e.attrs.timestamp)return e.attrs.timestamp=t,!0;if("string"==typeof e.attrs.timestamp&&!e.attrs.timestamp.match(/^\d+$/)){let n=new Date(e.attrs.timestamp);return e.attrs.timestamp=isNaN(n.getTime())?t:n.getTime().toString(),!0}}return t}tryRepair(e,t,n){let i,a=this.applyNodeMutations(e);if(!e.type)return null;if(t&&(i=this.schema.nodes[t]),this.isMarkWithOutAttrs(e.type))return this.convertMarkNodeToMark(e,i||this.schema.topNodeType);let r=this.schema.nodes[e.type];if(!r)return null;if(t&&i){if(r.isInline){let t=this.wrapNode(e,r,i,n);if(t)return t}if(i.isTextblock&&r.isTextblock)return e.content||null;let a=this.isTypeAllowedAt(i,n),o=this.schema.nodes.nestedExpand;if(o&&"expand"===e.type&&a(o))return{...e,type:"nestedExpand"};let s=this.schema.nodes.table;if(s&&this.isTableCellNode(e)&&a(s))return this.wrapTableCell(e,n);switch(t){case"doc":if("tableRow"===e.type)return this.wrapTableRow(e,n);if("listItem"===e.type)return this.wrapListItem(e,n);if("taskItem"===e.type)return this.wrapTaskItem(e,n);break;case"expand":case"nestedExpand":if("listItem"===e.type)return this.wrapListItem(e,n);if("taskItem"===e.type)return this.wrapTaskItem(e,n);break;case"table":if(this.isTableCellNode(e))return this.appendToLastTableRow(e,n);break;case"bulletList":case"orderedList":if(this.isListNode(e))return{type:"listItem",content:[e]};{let t=this.wrapNode(e,r,i,n);if(t)return t}break;case"paragraph":if(this.isListNode(e))return[e]}for(let[t,n]of this.wrappingMap){let i=this.schema.nodes[n];if(i&&e.type===t&&a(i))return this.wrapNodeWithType(e,i)}}return a?e:null}constructor(e){this.schema=e,this.wrappingMap=[["paragraph","blockTaskItem"],["listItem","bulletList"],["taskItem","taskList"]]}}I.LIST_NODE_TYPES=new Set(["bulletList","orderedList","taskList"]);class E{isValidChild(e){let t=e||this.getTopNodeType(),n=this.schema.nodes[t];if(!n||!n.contentMatch)return()=>!0;let i=n.contentMatch;return e=>{let t=this.schema.nodes[e];if(!t)return!1;let n=i.matchType(t);return!!n&&(i=n,!0)}}isLeafNode(e){let t=this.schema.nodes[e];return!!t&&t.isLeaf}getTopNodeType(){return this.schema.topNodeType?.name||"doc"}constructor(e){this.schema=e}}class S{init(){if(this.editorApi.aiStreamingOrchestrator?.actions.startSession(),this.actionId=this.editorApi.aiStreamingOrchestrator?.actions.initAction({type:"appendNode",streamingType:"create"},{hideLoadingScreen:"staging-area"===this.contentLocation}),!this.actionId)throw Error("Failed to initialize streaming action for create");let e=this.editorApi.core.sharedState.currentState()?.schema;e&&(this.parser=new y({schemaValidator:new E(e),repairStrategy:new I(e),config:{closeBrokenContent:(0,i("dh538").fg)("platform_editor_ai_improved_table_parsing"),lenientStringParsing:(0,i("dh538").fg)("platform_editor_ai_lenient_string_parsing")}})),s("Initialized editor streaming action",{streamType:"create",actionId:this.actionId})}isInitialized(){return!!this.actionId}stream(e,t=!1){this.actionId||this.init(),e&&this.actionId&&(this.parser?(this.parser.processChunk(e,t),this.editorApi.aiStreamingOrchestrator?.actions.streamValue(this.actionId,JSON.stringify(this.parser.getPartialDocument())??"")):this.editorApi.aiStreamingOrchestrator?.actions.streamValue(this.actionId,e),this.accumulated+=e,s("Streaming content",{actionId:this.actionId,adf:e}))}async finish({onError:e,onRepair:t}){if(this.actionId){let n;this.editorApi?.aiStreamingOrchestrator?.actions.finishAction(this.actionId),await this.editorApi?.aiStreamingOrchestrator?.actions.endSession(),s("Finished action",{actionId:this.actionId,fullAdf:this.accumulated});try{let e=this.editorApi.core.sharedState.currentState()?.schema;if(!e)throw Error("Schema is not available");let a=new y({schemaValidator:new E(e),repairStrategy:new I(e),config:{closeBrokenContent:(0,i("dh538").fg)("platform_editor_ai_improved_table_parsing"),lenientStringParsing:(0,i("dh538").fg)("platform_editor_ai_lenient_string_parsing")}}),r=a.parse(this.accumulated),o=new(0,i("4pSml").ADFStreamer)(e);o.processChunk(JSON.stringify(r||{})),n=o.getLastDoc();let s=a.getRepairs();s.length>0&&t?.({repairs:s,streamType:"create"})}catch(a){s("New ADF Parser failed, falling back to ADF Streamer",{error:a}),e?.({error:a,streamType:"create"});let t=this.editorApi.core.sharedState.currentState()?.schema;if(t){let e=new(0,i("4pSml").ADFStreamer)(t);e.processChunk(this.accumulated),n=e.getLastDoc()}}return this.accumulated="",this.actionId=void 0,n}}abort(){this.editorApi.aiStreamingOrchestrator?.actions.abortSession()}constructor(e,t){this.editorApi=void 0,this.contentLocation=void 0,this.actionId=void 0,this.accumulated="",this.parser=void 0,this.editorApi=e,this.contentLocation=t}}class b{constructor(){this.initialized=!1,this.name="",this.nameKeyIdx=null,this.arguments={localId:null,trueValue:"",value:"",valueStartIdx:null,wrapperAttrs:null,wrapperType:null,attrs:null}}}let T='"value"',C="replaceNode",A="insertNodeBefore",v="insertNodeAfter",P="wrap",k="wrapNode",x="setAttrs",w=new Set([C,A,v,"appendNode","appendNodeToEnd"]),M=new Set([C,A,v,"removeNode",P,k,x]);class N{constructor(e,t,n,i,a){this.name=void 0,this.localId=void 0,this.wrapperType=void 0,this.wrapperAttrs=void 0,this.attrs=void 0,this.name=e,this.localId=t,this.wrapperType=n,this.wrapperAttrs=i,this.attrs=a}}class O{constructor(e){this.partialValue=void 0,this.rawPartialValue=void 0,this.rawPartialValue=e,this.partialValue=e.replace(/\\/g,"")}}class R{constructor(){this.isFinished=void 0,this.isFinished=!0}}function D(e,t){let n=e.indexOf(t);if(-1===n);else{let i=n+t.length,a="";for(;i<e.length;){let t=e[i],r=i>0?e[i-1]:void 0;if((":"===t||" "===t||'"'===t)&&0===a.length)i++;else{if('"'===t&&"\\"!==r)return{value:a,keyIndex:n};a+=t,i++}}}return null}class L{reset(){this.toolCalls=[],this.accumulated=""}parse(e){this.accumulated+=e;let t=[];for(;;){var n,i,a;let e=this.toolCalls.at(-1);if(e||(e=new b,this.toolCalls.push(e)),!e.name){let t=this.toolCalls.at(-2),n=(t?.nameKeyIdx??-1)+1,i=D(this.accumulated.slice(n),'"name"');if(i)e.name=i.value,e.nameKeyIdx=n+i.keyIndex;else break}let r=e.nameKeyIdx;if(null===r)break;let o=this.accumulated.slice(r);if(n=e.name,M.has(n)&&!e.arguments.localId){let t=D(o,'"localId"');if(t)e.arguments.localId=t.value;else break}if((i=e.name)===P||i===k){if(!e.arguments.wrapperType){let n=D(o,'"wrapperType"');if(!n)return t;e.arguments.wrapperType=n.value}if(!e.arguments.wrapperAttrs){let t=D(o,'"wrapperAttrs"');if(t)e.arguments.wrapperAttrs=JSON.parse(t.value.replace(/\\/g,""));else break}}if(e.name===x&&!e.arguments.attrs){let t=D(o,'"attrs"');if(t)e.arguments.attrs=JSON.parse(t.value.replace(/\\/g,""));else break}if(e.initialized||(t.push(new N(e.name,e.arguments.localId,e.arguments.wrapperType,e.arguments.wrapperAttrs,e.arguments.attrs)),e.initialized=!0),a=e.name,!w.has(a)){t.push(new R),this.toolCalls.push(new b);continue}if(!e.arguments.valueStartIdx){let t=function(e){let t=e.indexOf(T);if(-1===t);else{let n=t+T.length;for(;n<e.length;){if('"'===e[n])return n+1;n++}}return null}(o);if(null!==t)e.arguments.valueStartIdx=r+t;else break}let s=function(e,t){let n="";for(let i=t;i<e.length;i++){let t=e[i],a=i>0?e[i-1]:void 0;if('"'===t&&"\\"!==a)return{partial:n,endIndex:i};n+=t}return{partial:n,endIndex:null}}(this.accumulated.slice(e.arguments.valueStartIdx),e.arguments.value.length);if(s.partial.length>0&&(e.arguments.value+=s.partial,t.push(new O(s.partial))),null===s.endIndex)break;t.push(new R),this.toolCalls.push(new b)}return t}constructor(){this.toolCalls=[],this.accumulated=""}}let F=["insertNodeAfter","insertNodeBefore"];class G{stream(e){e&&(this.accumulated+=e,this.editorApi?.aiStreamingOrchestrator?.actions.streamValue(this.actionId,e),s("Streaming content",{actionId:this.actionId,adf:e}))}finish(){this.editorApi?.aiStreamingOrchestrator?.actions.finishAction(this.actionId),s("Finished action",{actionId:this.actionId,fullAdf:this.accumulated}),this.accumulated=""}constructor(e,t,n){this.editorApi=e,this.contentLocation=t,this.actionId=void 0,this.accumulated="";let i=this.editorApi?.aiStreamingOrchestrator?.actions.initAction(n,{hideLoadingScreen:"staging-area"===this.contentLocation});if(!i)throw Error("Failed to initialize streaming action for update");this.actionId=i,s("Initialized editor streaming action",{streamType:"update",actionId:i,command:n})}}class B{reset(){this.accumulated="",this.lastAction=null,this.currentToolCall=void 0,this.hasDetectedInfiniteLoop=!1,this.parser.reset()}createToolCallProcessor(e){let t,n=e.name,i=e.localId;switch(n){case"replaceNode":case"insertNodeBefore":case"insertNodeAfter":case"removeNode":t={type:n,localId:i??""};break;case"appendNode":case"appendNodeToEnd":t={type:n};break;case"wrap":case"wrapNode":let a=e.wrapperType,r=e.wrapperAttrs;if(!a||!r)return;t={type:n,localId:i??"",wrapperType:a,wrapperAttrs:r};break;case"setAttrs":let o=e.attrs;if(!o)return;t={type:n,localId:i??"",attrs:o};break;default:return}return new G(this.editorApi,this.contentLocation,t)}streamChunk(e,t){if(!t)return 0===this.accumulated.length&&(this.reset(),this.editorApi.aiStreamingOrchestrator?.actions.startSession()),this.accumulated+=e,this.stream(e)}stream(e){if(!this.hasDetectedInfiniteLoop)for(let n of this.parser.parse(e))if(n instanceof N)if(n.localId){if(this.lastAction!==`${n.name}-${n.localId}`||F.includes(n.name))this.hasDetectedInfiniteLoop=!1,this.currentToolCall=this.createToolCallProcessor(n);else{var t;this.hasDetectedInfiniteLoop=!0,this.finish(),t=this.editorApi,t.analytics?.actions.fireAnalyticsEvent({action:"error",actionSubject:"editorPluginAI",actionSubjectId:"adfStreaming",eventType:i("d925B").EVENT_TYPE.OPERATIONAL,attributes:{errorMessage:"Infinite loop detected",errorData:{action:n.name,localId:n.localId},experienceName:null,selectionType:null,selectionCategory:null,streamId:null,source:{type:"orchestrator",isCreateAction:!1}}})}this.lastAction=`${n.name}-${n.localId}`}else this.lastAction=null,this.currentToolCall=this.createToolCallProcessor(n);else if(n instanceof O)this.currentToolCall?.stream(n.partialValue);else if(n instanceof R)this.currentToolCall?.finish();else throw Error("Unknown action type from partial stream parser")}async finish(){this.hasDetectedInfiniteLoop?(this.rovoBridgeAPI.send(o.InlineInputBoxAbortMessageCommand,{receiverId:o.ROVO_CHAT_CLIENT_ID,senderId:this.clientId}),this.reset(),await this.editorApi.aiStreamingOrchestrator?.actions.endSession()):(this.accumulated="",await this.editorApi.aiStreamingOrchestrator?.actions.endSession(),this.hasDetectedInfiniteLoop&&this.rovoBridgeAPI.send(o.InlineInputBoxAbortMessageCommand,{receiverId:o.ROVO_CHAT_CLIENT_ID,senderId:this.clientId}),this.lastAction=null,this.currentToolCall=void 0,this.parser.reset())}abort(){this.reset(),this.editorApi.aiStreamingOrchestrator?.actions.abortSession()}constructor(e,t,n,i){this.editorApi=e,this.contentLocation=t,this.clientId=n,this.rovoBridgeAPI=i,this.parser=void 0,this.currentToolCall=void 0,this.accumulated="",this.lastAction=void 0,this.hasDetectedInfiniteLoop=!1,this.parser=new L,this.lastAction=null}}class U{addCommandHandler(e,t){return this.commandHandlers.set(e,t),this}addDefaultCommandHandlers(){return this.addCreateCommandHandler(),this.addUpdateCommandHandler(),this.addReadCommandHandler(),this.addAbortCommandHandler(),this.addRovoStreamCompletedCommandHandler(),this}registerCommandsToRovoBridge(){this.commandHandlers.forEach((e,t)=>{this.rovoBridgeAPI.on(this.clientId,t,t=>e.execute(t))})}addAndRegisterCommands(){this.addCommandHandlers?this.addCommandHandlers({commandManager:this}):this.addDefaultCommandHandlers(),this.registerCommandsToRovoBridge()}deregisterCommandsFromRovoBridge(){this.commandHandlers.forEach((e,t)=>{this.rovoBridgeAPI.off(this.clientId,t),e.deregister()})}deregisterCommands(){s("deregister commands"),this.deregisterCommandsFromRovoBridge(),this.commandHandlers.clear()}updateClientId(e,t){(this.clientId!==e||this.rovoBridgeAPI!==t)&&(s("update clientId"),this.deregisterCommandsFromRovoBridge(),this.clientId=e,this.rovoBridgeAPI=t,this.registerCommandsToRovoBridge())}updateCommandProps(e){this.commandProps!==e&&(s("update commandProps"),this.commandProps=e,this.commandHandlers.forEach(t=>{t.updateProps(e)}))}updateAddCommandHandlers(e){this.addCommandHandlers!==e&&(s("update addCommandHandlers"),this.addCommandHandlers=e,this.deregisterCommands(),this.addAndRegisterCommands())}addCreateCommandHandler(){let e=new p(this.commandProps,this.createCommandProcessor);this.addCommandHandler(o.ConfluencePageCreateCommand,e)}addUpdateCommandHandler(){let e=new h(this.commandProps,this.updateCommandProcessor);this.addCommandHandler(o.ConfluenceUpdatePageCommand,e)}addReadCommandHandler(){let e=new m(this.commandProps);this.addCommandHandler(o.ReadContentCommand,e)}addAbortCommandHandler(){let e=new c(this.commandProps,()=>{this.commandHandlers.forEach(e=>{e instanceof d&&e.handleAbort()}),this.commandProps.onStreamAbort?.()});this.addCommandHandler(o.RovoStreamAbortedCommand,e)}addRovoStreamCompletedCommandHandler(){let e=new f(this.commandProps);this.addCommandHandler(o.RovoStreamCompletedCommand,e)}constructor(e,t,n,i){this.clientId=e,this.rovoBridgeAPI=t,this.commandProps=n,this.addCommandHandlers=i,this.commandHandlers=new Map,this.createCommandProcessor=void 0,this.updateCommandProcessor=void 0,this.createCommandProcessor=new S(this.commandProps.editorAPI,this.commandProps.contentLocation),this.updateCommandProcessor=new B(this.commandProps.editorAPI,this.commandProps.contentLocation,this.clientId,this.rovoBridgeAPI)}}let V=({mediaProvider:e,createMediaProvider:t,onUploadImageError:n})=>{let r=(0,a.useRef)(Promise.resolve()),o=(0,a.useRef)(new Map);(0,a.useEffect)(()=>{e&&(r.current=e)},[e]);let s=(0,a.useCallback)(async e=>{let n=o.current,a=n.get(e);if(a)return a;if(!t)throw Error("No createMediaProvider function provided");let r=await t({contentId:e}),s=(0,i("grxv4").getMediaClient)(r.viewMediaClientConfig);return n.set(e,s),s},[t]),l=(0,a.useCallback)(async(e,t,a,r)=>{let o=!1,s=new Map,l=async e=>{var c,d,p;if(!e||"object"!=typeof e)return e;if(c=e,c?.type&&(c?.attrs?.id||c?.attrs?.url)&&["media","mediaInline","mediaSingle"].includes(c?.type)&&(d=e,p=a,!d.attrs?.collection||d.attrs.collection!==p)){o=!0;try{let n=await H(e,t,a,r),o={...e,attrs:{...e.attrs,...n}};if((0,i("dh538").fg)("confluence_frontend_aifc_reupload_image")){let t=e.attrs?.localId;if(!t)throw Error("localId is required for image re-uploading");s.set(t,o)}return o}catch(t){return n?.({error:j(t,`Failed to reupload image to collection ${a}`)}),e}}let u={...e};return e.content&&Array.isArray(e.content)&&(u.content=await Promise.all(e.content.map(e=>e?l(e):e))),u};return{processedAdf:await l(e),hasChanges:o,changedNodesByLocalId:s}},[n]),c=(0,a.useCallback)(async e=>{try{let t,n,a=await r.current;if(!a?.uploadMediaClientConfig||!a.uploadParams?.collection)return{processedAdf:e,hasChanges:!1,error:Error("No media provider")};try{t=(0,i("grxv4").getMediaClient)(a.uploadMediaClientConfig),n=a.uploadParams.collection}catch(t){return{processedAdf:e,hasChanges:!1,error:j(t,"Error getting media client")}}try{return await l(e,t,n,s)}catch(t){return{processedAdf:e,hasChanges:!1,error:j(t,"Error processing ADF nodes")}}}catch(t){return{processedAdf:e,hasChanges:!1,error:j(t,"Error processing images in ADF")}}},[s,l]);return(0,a.useMemo)(()=>({processImagesInAdf:c}),[c])};function j(e,t){return Error(`${t}: ${e.message}`)}async function H(e,t,n,i){let a=e.attrs?.url;if(e.attrs?.id&&e.attrs?.collection&&!a)try{let t=function(e){let t=e.match(/^contentId-(\d+)$/);return t?t[1]:null}(e.attrs.collection);if(t){let n=await i(t);a=await n.getImageUrl(e.attrs.id,{collection:e.attrs.collection})}else throw Error(`Invalid collection format: ${e.attrs.collection}`)}catch(t){throw j(t,`Could not access source image: ${e.attrs.id}`)}if(!a)throw Error("No source URL available for image re-upload");let r=await t.file.uploadExternal(a,n);return{id:(await r).uploadableFileUpfrontIds.id,collection:n}}let z=e=>{let t=()=>{e(),n()},n=(0,i("fFa3V").bindAll)(window,[{type:"unload",listener:t,options:{once:!0}},{type:"pagehide",listener:t,options:{once:!0}}]);return n},K=({contentLocation:e,contentId:t,editorAPI:n,useGenericEditorSkill:l,additionalContext:c,mediaProvider:d,createMediaProvider:p,onUploadImageError:u,onStreamStart:g,onStream:m,onStreamEnd:f,onStreamAbort:h,onStreamTimeout:_,onStreamError:y,onStreamRepair:I,addCommandHandlers:E})=>{let S="page",b=(0,o.getConfluenceEditorClientId)(t);(0,a.useEffect)(()=>{n&&n.aiExperience?.actions.updateTargetId(t)},[n,t]);let T=(0,a.useMemo)(()=>n?(0,r.getBrowserBridgeAPI)():null,[n]),C=V({mediaProvider:d,createMediaProvider:p,onUploadImageError:u}),A=(0,a.useCallback)(async a=>{let r=async()=>{if(!C?.processImagesInAdf)throw Error("Image processor not available for image re-uploading in editor streaming");if(!n)throw Error("Editor API not available for image re-uploading in editor streaming");if((0,i("dh538").fg)("confluence_frontend_aifc_reupload_image")){let e=await n.core.actions.requestDocumentAsync();if(!e)throw Error("Could not get document from editor for image re-uploading");let{error:t,hasChanges:i,changedNodesByLocalId:r}=await C.processImagesInAdf(e);if(s("reuploadImages",{error:t,hasChanges:i,adfDoc:a,changedNodesByLocalId:r}),t)throw t;if(i&&r&&r.size>0){let e=n.core.sharedState.currentState()?.schema;if(!e)throw Error("Could not get editor schema for image re-uploading");r.forEach((t,i)=>{let a=e.nodeFromJSON(t);n?.localId?.actions.replaceNode({localId:i,value:a})})}}else{if(!a)throw Error("adfDoc is required for image re-uploading when feature flag is off");let{error:e,hasChanges:t,processedAdf:i}=await C.processImagesInAdf(a);if(s("reuploadImages",{error:e,hasChanges:t,processedAdf:i,adfDoc:a}),e)throw e;t&&n?.core.actions.replaceDocument(i,{scrollIntoView:!1})}};try{await r()}catch(n){(0,i("4B9iQ").sendAIFCExperienceTrackingToParent)({status:"fail",actionType:"page",actionId:t,contentContext:e,experienceName:i("16lEl").ExperienceName.AIFC_ALL_DATA_HANDLED,error:n.message}),u?.({error:n})}},[C,n,t,e,u]),v=(0,a.useMemo)(()=>n?{clientId:b,contentLocation:e,contentId:t,contentType:S,editorAPI:n,useGenericEditorSkill:l,additionalContext:c,onStreamStart:g,onStream:m,onStreamEnd:f,onStreamAbort:h,onStreamTimeout:_,onStreamError:y,onStreamRepair:I,reuploadImages:A}:null,[b,e,t,S,n,l,c,g,m,f,h,_,y,I,A]),P=(0,a.useRef)(null);(0,a.useEffect)(()=>{n&&T&&v&&(P.current||(P.current=new U(b,T,v,E),P.current.addAndRegisterCommands()))},[n,b,T,v,E]),(0,a.useEffect)(()=>{P.current&&T&&P.current.updateClientId(b,T)},[b,T]),(0,a.useEffect)(()=>{P.current&&v&&P.current.updateCommandProps(v)},[v]),(0,a.useEffect)(()=>{P.current&&P.current.updateAddCommandHandlers(E)},[E]),(0,a.useEffect)(()=>()=>{P.current?.deregisterCommands()},[]);let k="page",{clientId:x,contentLocation:w,contentId:M,rovoBridgeAPI:N}={contentLocation:e,contentId:t,editorAPI:n,onStreamStart:g,onStream:m,onStreamEnd:f,onStreamAbort:h,onStreamTimeout:_,onStreamError:y,onStreamRepair:I,addCommandHandlers:E,clientId:b,rovoBridgeAPI:T};(0,a.useEffect)(()=>{if(!N)return;function e(){N&&(N.send(o.ContentDestroyCommand,{senderId:x,receiverId:o.ROVO_CHAT_CLIENT_ID,contentId:M,contentType:k,contentContext:w}),N.teardown(x))}N.ready(x),N.send(o.ContentReadyCommand,{senderId:x,receiverId:o.ROVO_CHAT_CLIENT_ID,contentId:M,contentType:k,canProvideContext:!0,contentContext:w});let t=z(()=>e());return()=>{try{t(),e()}catch{}}},[x,w,M,k,N])};var W=i("9cZ1w");function q(e,...t){try{window.top?.__aifcDebuggerEnabled__&&console.log(`[AIFC]: ${e}`,...t)}catch(e){}}class Y extends d{async process(e){e.isStreamComplete?this.streamedMd=e.data.content:this.streamedMd+=e.data.content;let t=this.streamingAdfEncoder.encode(this.streamedMd);this.props.editorAPI.core.actions.replaceDocument(t,{scrollIntoView:!1})}async finishAction(){q("handle confluence-deep-research-page-create-command");let e=this.streamedMd?this.streamingAdfEncoder.encode(this.streamedMd):void 0;return this.streamedMd="",e}abort(){}constructor(e){super(e,"deep-research-create"),this.streamingAdfEncoder=void 0,this.streamedMd="";let t={linkify:{findFilepaths:i("b0F8r").findFilepaths,isLinkInMatches:i("b0F8r").isLinkInMatches},smartLinks:{regexStorage:globalThis.localStorage}};this.streamingAdfEncoder=new(0,i("b7FrM").ADFEncoder)(e=>new(0,i("lpRYt").AiMateMarkdownTransformer)(e,t,!0))}}class $ extends l{async execute(e){q("handle confluence-page-init-command");let t=await (0,i("9K5In").getDocument)(this.props.editorAPI);if(!t)return void q("PageInitCommand received but document is not available");let n=(0,i("9K5In").isEmptyDocument)(t);if(q(`Received ConfluencePageInitCommand with isEmpty: ${n}`,e?.data),!n)return;let a=this.props.editorAPI.core.sharedState.currentState()?.schema;if(!a)return void q("Editor schema is not available");q("Streaming initial ADF from ConfluencePageInitCommand",e?.data.adf),this.props.onStreamStart?.({streamType:"init",payload:e}),this.props.onStream?.({streamType:"init",payload:e});let r=new(0,i("4pSml").ADFStreamer)(a);for(let t of(0,i("9K5In").chunkSubstr)(e.data.adf,50))q("Processing chunk from ConfluencePageInitCommand",t),r.processChunk(t);let o=r.getLastDoc();q("Replacing document with ADF from ConfluencePageInitCommand",o),q("Replace document function - ",this.props.editorAPI.core.actions.replaceDocument),this.props.editorAPI.core.actions.replaceDocument(o,{scrollIntoView:!1}),(0,i("9wGTI").fg)("confluence_frontend_aifc_reupload_image")?await this.props.reuploadImages?.():o&&await this.props.reuploadImages?.(o),this.props.onStreamEnd?.({streamType:"init",payload:e})}}class J extends l{execute(){return q("handle prepare-content-for-finalization-command"),new Promise(async e=>{try{let t=await this.extraProps.forceDraftSync?.();e({success:!0,content:t})}catch{e({success:!1,content:void 0})}})}constructor(e,t){super(e),this.extraProps=t}}class Q extends l{execute(e){return(q("handle confluence-prompt-submit-on-page-create-command"),this.extraProps.generateAIHeaderImage&&(0,i("9wGTI").fg)("aifc_header_image_pseudo_title_enabled"))?this.extraProps.generateAIHeaderImage({adfContent:e.userPrompt}):Promise.resolve()}constructor(e,t){super(e),this.extraProps=t}}let X=({contentId:e,contentLocation:t,editorAPI:n,setEditorDisabled:r,setTitlePlaceholderState:s,onTitleChange:l,mediaProvider:c,fakeGenerateAIHeaderImage:d,generateAIHeaderImage:p,forceDraftSync:u,flags:g,useGenericEditorSkill:m,additionalContext:f})=>{let h="page",{sendAnalyticsEvent:_}=(0,i("kIvLT").useAnalytics)(),{createAnalyticsEvent:y}=(0,i("inPa6").useAnalyticsEvents)(),I=function(){let e=(0,i("aSsfA").useGetPageMode)(),[{isViewMode:t}]=(0,i("efvKr").useLivePageMode)();return e!==i("cD1qu").PageMode.EDIT&&(e!==i("cD1qu").PageMode.LIVE||t)}(),E=(0,i("8C5kA").default)(),{showModal:S}=(0,i("8aF6s").useDialogs)(),{cloudId:b}=(0,i("bQm3c").useSessionData)(),{showSmartCreationModal:T}=(0,i("jyA9t").useSmartCreationModalState)(),{stagingAreaMode:C}=(0,i("2O3ot").useStagingAreaState)(),A=(0,a.useCallback)(async({contentId:e})=>(0,i("4IoVL").createRendererMediaProvider)({contentId:e,isExternalShare:!1}),[]),v=(0,a.useCallback)(({error:e})=>{(0,i("5ZqQS").getMonitoringClient)().submitError(e,{attribution:i("3IBnw").Attribution.PAGE_MODES})},[]),P=(0,a.useCallback)(async()=>{try{let t;if(n){let e=await (0,i("9K5In").getDocument)(n);e&&(t=(0,i("e4JJO").extractContentFeatures)(e))}_({eventType:"track",actionSubject:"smartCreateContent",action:"initialContentCreated",attributes:{createdContentProduct:"confluence",createdContentType:h,createdContentFeatures:t,createdContentMetadata:{contentId:e}}})}catch(e){(0,i("5ZqQS").getMonitoringClient)().submitError(e,{attribution:i("3IBnw").Attribution.PAGE_MODES})}},[n,e,h,_]),k=(0,a.useCallback)(({streamType:n})=>{r?.(!0),("create"===n||"deep-research-create"===n)&&(s?.(!0),(0,i("6mKj3").isExperimentEnabled)("confluence_aifc_image_generation_experiment")&&!(0,i("9wGTI").fg)("aifc_header_image_pseudo_title_enabled")&&d?.()),(0,i("4B9iQ").sendAIFCExperienceTrackingToParent)({status:"success",actionType:h,actionId:e,contentContext:t,experienceName:i("16lEl").ExperienceName.AIFC_INITIAL_DATA_RECEIVED})},[r,d,s,e,h,t]),x=(0,a.useCallback)(({payload:e})=>{if("title"in e.data){let t=e?.data?.title;l?.(t),t&&s?.(!1)}},[l,s]),w=(0,W.useLazyShowFeedbackFlag)(g,E,S,y),M=(0,a.useCallback)(async({streamType:n,payload:a})=>{try{if("create"===n){let e="title"in a?.data?a.data.title:void 0;e&&(0,i("6mKj3").isExperimentEnabled)("confluence_aifc_image_generation_experiment")&&!(0,i("9wGTI").fg)("aifc_header_image_pseudo_title_enabled")&&p?.({adfContent:e})}(0,i("4B9iQ").sendAIFCExperienceTrackingToParent)({status:"success",actionType:h,actionId:e,contentContext:t,experienceName:i("16lEl").ExperienceName.AIFC_ALL_DATA_HANDLED}),"create"===n||"deep-research-create"===n?P():"update"!==n||T||"modal"===C||w(i("cJeDc").FeedbackVariant.AFTER_UPDATE_STREAM_COMPLETE,h,b)}finally{r?.(!1)}},[e,h,t,r,p,P,w,T,C,b]),N=(0,a.useCallback)(()=>{r?.(!1),_({eventType:"operational",action:"aborted",actionSubject:"smartCreateContent",attributes:{contentType:h,contentId:e}})},[r,e,h,_]),O=(0,a.useCallback)(({streamType:t})=>{r?.(!1),_({eventType:"operational",action:"timeout",actionSubject:"smartCreateContent",attributes:{contentType:h,contentId:e,streamType:t}})},[r,e,h,_]),R=(0,a.useCallback)(({error:n,streamType:a})=>{q("Error in command handler:",n),_({eventType:"operational",action:"error",actionSubject:"smartCreateContent",attributes:{contentType:h,error:n instanceof Error?n.message:String(n),stack:n instanceof Error&&n.stack?n.stack:void 0,streamType:a,contentId:e}}),(0,i("4B9iQ").sendAIFCExperienceTrackingToParent)({status:"fail",actionType:h,actionId:e,contentContext:t,experienceName:i("16lEl").ExperienceName.AIFC_ALL_DATA_HANDLED,error:n instanceof Error?n.message:String(n)}),(0,i("9wGTI").fg)("platform_editor_ai_aifc_streaming")&&r?.(!1)},[e,h,t,_,r]),D=(0,a.useCallback)(({streamType:t,repairs:n})=>{_({eventType:"operational",actionSubject:"smartCreateContent",action:"adfRepaired",attributes:{contentType:h,contentId:e,streamType:t,repairCount:n.length,repairs:n.map(e=>({type:e.type,from:e.from,to:e.to,context:e.context,expansion:e.expansion}))}})},[e,h,_]),L=(0,a.useMemo)(()=>(0,i("9wGTI").fg)("platform_editor_aifc_in_page_comment")?async()=>({..."function"==typeof f?await f():f,isViewMode:I}):{isViewMode:I},[I,f]);K({contentLocation:t,contentId:e,editorAPI:n,addCommandHandlers:(0,a.useCallback)(({commandManager:e})=>{e.addDefaultCommandHandlers().addCommandHandler(o.ConfluenceDeepResearchPageCreateCommand,new Y(e.commandProps)).addCommandHandler(o.ConfluencePageInitCommand,new $(e.commandProps)).addCommandHandler(o.PrepareContentForFinalizationCommand,new J(e.commandProps,{forceDraftSync:u})).addCommandHandler(o.ConfluenceSubmitPromptOnPageCreateCommand,new Q(e.commandProps,{generateAIHeaderImage:p}))},[u,p]),additionalContext:L,mediaProvider:c,createMediaProvider:A,onUploadImageError:v,onStreamStart:k,onStream:x,onStreamEnd:M,onStreamAbort:N,onStreamTimeout:O,onStreamError:R,onStreamRepair:D,useGenericEditorSkill:m})},Z=e=>(X(e),null),ee=(0,i("7aRa9").withFlags)(t=>(0,i("9wGTI").fg)("aifc_create_enabled")?e(a).createElement(Z,t):null);t.exports.RovoBridgeCommandListener=ee}),a("4B9iQ",function(e,t){var n=i("fD5Hh"),a=i("6VfGD");e.exports.sendAIFCExperienceTrackingToParent=e=>{let t,i=(0,n.getBrowserBridgeAPI)(),r=a.ROVO_EXPERIENCE_TRACKING_SENDER_CLIENT_ID,o=a.ROVO_CHAT_CLIENT_ID;switch(e.status){case"fail":t={...e,error:"string"==typeof e.error?e.error:"Unknown error",reason:void 0,senderId:r,receiverId:o};break;case"abort":t={...e,reason:"string"==typeof e.reason?e.reason:"Aborted",error:void 0,senderId:r,receiverId:o};break;default:t={...e,error:void 0,reason:void 0,senderId:r,receiverId:o}}i?.send(a.AifcExperienceTrackingCommand,t)}}),a("9K5In",function(e,t){let n=async e=>new Promise(t=>{try{e.core.actions.requestDocument(e=>{t(e)},{alwaysFire:!0})}catch{t(null)}});e.exports.getDocument=n,e.exports.isEmptyDocument=function(e){if(!e.content||0===e.content.length)return!0;if(1===e.content.length){let t=e.content[0];if("paragraph"===t.type||"heading"===t.type)return!t.content||0===t.content.length||function(e){for(let t of e)if("text"!==t.type)return!1;else if(t.text&&t.text.trim().length>0)return!1;return!0}(t.content)}return!1},e.exports.chunkSubstr=function(e,t){let n=Math.ceil(e.length/t),i=Array(n);for(let a=0,r=0;a<n;++a,r+=t)i[a]=e.substring(r,r+t);return i}}),a("foVrt",function(t,n){var a=i("42omo"),r=i("l998X"),o=i("e6Iiv"),s=(0,i("cgtv4").defineMessages)({label:{id:"fabric.editor.ai.screens.prompt.addButton.label",defaultMessage:"Add"},insertMenuTriggerLabel:{id:"fabric.editor.ai.screens.prompt.streaming.insertMenu.triggerLabel",defaultMessage:"Insert rich content"},insertMenuUpload:{id:"fabric.editor.ai.screens.prompt.streaming.insertMenu.upload",defaultMessage:"Upload file"},insertMenuAddLink:{id:"fabric.editor.ai.screens.prompt.streaming.insertMenu.addLink",defaultMessage:"Add link"},insertMenuMention:{id:"fabric.editor.ai.screens.prompt.streaming.insertMenu.mention",defaultMessage:"Mention user"},promptRecord:{id:"fabric.editor.ai.screens.prompt.streaming.record",defaultMessage:"Record"},promptSubmit:{id:"fabric.editor.ai.screens.prompt.streaming.submit",defaultMessage:"Submit"},promptPlaceholder:{id:"fabric.editor.ai.screens.prompt.streaming.placeholder",defaultMessage:"Describe what you want to do"}});function l(){let{createAnalyticsEvent:e}=(0,i("inPa6").useAnalyticsEvents)();return(0,a.useMemo)(()=>(0,i("ajtqX").fireAnalyticsEvent)(e),[e])}let c={rotated:"_v564f4ca _t9eczk8b",base:"_v564f4ca _t9ec1ul7"},d=({editorApi:t,promptType:n})=>{let{formatMessage:o}=(0,i("8C5kA").default)(),d=l(),p=!!t?.toolbar,u=(0,a.useCallback)(()=>{if(t){let e=t.hyperlink?.commands.showLinkToolbar(i("d925B").INPUT_METHOD.QUICK_INSERT);e&&t.core.actions.execute(e)}d({payload:{action:i("d925B").ACTION.CLICKED,actionSubject:i("d925B").ACTION_SUBJECT.BUTTON,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.AI_PROMPT_LINK_PICKER_BUTTON,attributes:{promptType:n},eventType:i("d925B").EVENT_TYPE.UI}})},[t,d,n]),g=(0,a.useCallback)(()=>{t&&t.mention?.actions.openTypeAhead(i("d925B").INPUT_METHOD.QUICK_INSERT),d({payload:{action:i("d925B").ACTION.CLICKED,actionSubject:i("d925B").ACTION_SUBJECT.BUTTON,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.AI_PROMPT_MENTION_BUTTON,attributes:{promptType:n},eventType:i("d925B").EVENT_TYPE.UI}})},[t,d,n]),m=[{Icon:e(i("1bY7o")),message:"insertMenuAddLink",onClick:()=>u()},{Icon:e(i("6767u")),message:"insertMenuMention",shortcut:"@",onClick:()=>g()}];return(0,r.jsx)(i("52EPl").default,{placement:"bottom-end",shouldRenderToParent:!0,trigger:({triggerRef:t,...n})=>(0,r.jsx)(i("1qfLF").default,{isSelected:n.isSelected,onClick:n.onClick,onFocus:n.onFocus,onBlur:n.onBlur,testId:n.testId,"aria-controls":n["aria-controls"],"aria-expanded":n["aria-expanded"],"aria-haspopup":n["aria-haspopup"],"data-ds--level":n["data-ds--level"],ref:t,appearance:"subtle",icon:t=>(0,r.jsx)(i("gdv5Z").default,{xcss:n["aria-expanded"]?c.rotated:c.base,children:(0,r.jsx)(e(i("g5gZt")),{label:t.label})}),label:o(s.label),shape:"circle",isTooltipDisabled:!1,tooltip:{position:"top"}}),children:(0,r.jsx)(i("gdv5Z").default,{xcss:"_1ul9gx0z",children:(0,r.jsx)(i("ahaN7").default,{children:m.map(({Icon:e,message:t,shortcut:n,onClick:a})=>(0,r.jsx)(i("dAYOx").default,{onClick:()=>{a()},children:(0,r.jsxs)(i("u9agA").default,{alignBlock:"center",space:"space.200",children:[(0,r.jsx)(e,{label:""}),(0,r.jsx)(i("gdv5Z").default,{xcss:"_16jlkb7n _1o9zkb7n _i0dlf1ug",children:o(s[t])}),n&&(p?(0,r.jsx)(i("c4sKh").default,{children:n}):(0,r.jsx)("div",{className:(0,i("gMc0m").default)(["_vwz4utpp"]),children:(0,r.jsx)(i("807Mc").Shortcut,{children:n})}))]})},t))})})})};var p=(0,i("cgtv4").defineMessages)({label:{id:"fabric.editor.ai.screens.prompt.linkPickerButton.label",defaultMessage:"Add link"}});let u=({editorApi:t,promptType:n})=>{let{formatMessage:o}=(0,i("8C5kA").default)(),{activeLinkMark:s}=(0,i("eiA8Z").useSharedPluginStateWithSelector)(t,["hyperlink"],e=>({activeLinkMark:e.hyperlinkState?.activeLinkMark})),c=l(),d=(0,a.useCallback)(()=>{if(t){let e=t.hyperlink?.commands.showLinkToolbar(i("d925B").INPUT_METHOD.QUICK_INSERT);e&&t.core.actions.execute(e)}c({payload:{action:i("d925B").ACTION.CLICKED,actionSubject:i("d925B").ACTION_SUBJECT.BUTTON,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.AI_PROMPT_LINK_PICKER_BUTTON,attributes:{promptType:n},eventType:i("d925B").EVENT_TYPE.UI}})},[t,c,n]),u=(0,a.useCallback)(e=>{["Enter"," ","Tab"].includes(e.key)&&e.stopPropagation()},[]);return(0,r.jsx)(i("1qfLF").default,{isTooltipDisabled:!1,label:o(p.label),testId:"link-picker-button",icon:e(i("1bY7o")),isSelected:!!s,spacing:"compact",appearance:"subtle",onClick:d,onKeyDown:u,onKeyUp:u})};var g=(0,i("cgtv4").defineMessages)({label:{id:"fabric.editor.ai.screens.prompt.mentionButton.label",defaultMessage:"Mention someone or a team"}});let m=({editorApi:t,promptType:n})=>{let{formatMessage:o}=(0,i("8C5kA").default)(),{currentHandler:s,typeAheadHandler:c}=(0,i("eiA8Z").useSharedPluginStateWithSelector)(t,["typeAhead","mention"],e=>({currentHandler:e.typeAheadState?.currentHandler,typeAheadHandler:e.mentionState?.typeAheadHandler})),d=l(),p=(0,a.useCallback)(()=>{t&&t.mention?.actions.openTypeAhead(i("d925B").INPUT_METHOD.QUICK_INSERT),d({payload:{action:i("d925B").ACTION.CLICKED,actionSubject:i("d925B").ACTION_SUBJECT.BUTTON,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.AI_PROMPT_MENTION_BUTTON,attributes:{promptType:n},eventType:i("d925B").EVENT_TYPE.UI}})},[t,d,n]),u=(0,a.useCallback)(e=>{["Enter"," ","Tab"].includes(e.key)&&e.stopPropagation()},[]);return(0,r.jsx)(i("1qfLF").default,{isTooltipDisabled:!1,label:o(g.label),testId:"mention-button",icon:e(i("b4wUN")),isSelected:s?.id&&c?.id&&s.id===c.id,spacing:"compact",appearance:"subtle",onClick:p,onKeyDown:u,onKeyUp:u})};var f=i("jL0bJ"),h=i("2P8JV"),_=i("stVm3"),y=i("cNucV"),I=i("j5BTD"),E=i("d2gjm"),S=i("1mT7b"),b=i("jiT42"),T=i("7aKg5"),C=i("8exqI"),A=i("12MPQ"),v=i("4S3gx"),P=i("1AOco"),k=i("h6Mwq"),x=i("bn2AM"),w=i("eKfhS"),M=i("ebElI"),N=i("dhgPE"),O=i("3HEm4"),R=i("lSIzP"),D=i("kPcbV"),L=i("cW0VI"),F=i("1hEK8"),G=i("7oMzO"),B=i("iZg1u"),U=i("8C4KP"),V=i("dZ8uq");let j=e=>{let t=e.content?.[0];return t?.type==="paragraph"&&!!t.content&&t.content.some(e=>e?.type==="hardBreak")},H={insertMenuContainer:"_ahbq1wug _1pfh1wug",editorBase:"_1pfh1b66 _1nmz1hna _16jlkb7n _1o9zkb7n _o5721jtm _slp31hna _1bsb1wug",editorMultiline:"_1pfh1b66 _1nmz1hna _16jlkb7n _1o9zkb7n _o5721jtm _slp31hna _1bsb1osq"},z=t=>{let{editorProps:n,options:l}=t,{type:c="user-input",onChange:p,onInputChange:g,onADFChange:z,defaultValue:K,enableLinks:W,setFocusHandlers:q,setClearHandler:Y,ariaLabel:$,submit:J,isAIFC:Q}=n,{onSubmit:X}=l,Z=(0,a.useRef)(void 0),ee=(0,a.useRef)(void 0),{formatMessage:et}=(0,i("8C5kA").default)(),[en,ei]=(0,a.useState)(!0),[ea,er]=(0,a.useState)(!1),eo=(0,a.useCallback)(e=>{let t=i("kw19Z").default.fromSchema(e.state.schema).serializeFragment(e.state.doc.content),n=(0,i("7iE7T").toJSON)(e.state.doc);p?.({text:t,adf:n}),z?.(n),g?.(t),Z.current=n,ee.current=t,er(j(n)),t?ei(!1):ei(!0)},[p,z,g]),es=(0,a.useCallback)(e=>{eo(e)},[eo]),el=(0,a.useCallback)(()=>{X?X?.({adf:Z.current,text:ee.current}):J?.()},[J,X]),{preset:ec,editorApi:ed}=(0,i("1JdaQ").usePreset)(()=>(function(e){let t={...e.linking?.smartLinks,linkPicker:e.linking?.linkPicker,lpLinkPicker:e.featureFlags?.lpLinkPicker??!1,disableFloatingToolbar:!0,showUpgradeDiscoverability:!1,allowBlockCards:!1,allowEmbeds:!1};return new(0,i("bupcf").EditorPresetBuilder)().add([v.featureFlagsPlugin,e.featureFlags]).maybeAdd([f.analyticsPlugin,{createAnalyticsEvent:e.createAnalyticsEvent}],!!e.allowAnalyticsGASV3).add(_.betterTypeHistoryPlugin).add([O.pastePlugin,{}]).add(S.clipboardPlugin).add(k.focusPlugin).add(b.compositionPlugin).add([h.basePlugin,{}]).add(C.decorationsPlugin).add(F.typeAheadPlugin).maybeAdd(w.historyPlugin,!0).maybeAdd(G.undoRedoPlugin,!0).add(E.clearMarksOnEmptyDocPlugin).maybeAdd([M.hyperlinkPlugin,{disableFloatingToolbar:!e.linkPicker,linkPicker:e.linkPicker}],!!e.enableLinks).maybeAdd([N.mentionsPlugin],!!e.mentionProvider).add(U.widthPlugin).add([R.placeholderPlugin,e.placeholder]).add(A.editorDisabledPlugin).add(T.copyButtonPlugin).add(P.floatingToolbarPlugin).add([L.selectionPlugin,{}]).maybeAdd([D.saveOnEnterPlugin,e.onSave],!!e.onSave).maybeAdd([x.gridPlugin,{}],!0).maybeAdd([I.cardPlugin,t],!!e.enableLinks).add([y.blockTypePlugin,{allowBlockType:{exclude:["heading","blockquote"]}}]).maybeAdd(B.userIntentPlugin,(0,V.expValEqualsNoExposure)("platform_editor_lovability_user_intent","isEnabled",!0))})({...l,placeholder:{placeholder:n.placeholder},onSave:n.isAIFC?el:es,enableLinks:W}),[l,n.placeholder,n.isAIFC]),ep=(0,a.useRef)(null),eu=(0,a.useCallback)(e=>{Y&&Y(()=>e.clear());let t=e._privateGetEditorView();t&&(ep.current=t,e.isDocumentEmpty()||t.dispatch(t.state.tr.setSelection(new(0,i("ks2lK").AllSelection)(t.state.doc))))},[Y]);(0,a.useEffect)(()=>{q&&q(ed?.core?.actions.blur,ed?.core?.actions.focus)},[ed,q]);let eg=(0,a.useCallback)(e=>{let t=e.target instanceof HTMLElement?e.target.closest('[data-testid="editor-floating-toolbar"]'):null;t&&e.currentTarget.contains(t)&&e.stopPropagation()},[]),em=(0,r.jsx)(d,{editorApi:ed,promptType:c}),ef=(0,r.jsx)(i("1qfLF").default,{testId:"submit-icon-button",shape:"circle",appearance:"primary",icon:e(i("euUgw")),isDisabled:en,onClick:Q?el:J,isTooltipDisabled:en,label:et(s.promptSubmit),tooltip:{position:"top"}}),eh=(0,r.jsx)(o.ComposableEditor,{mentionProvider:l.mentionProvider,appearance:"chromeless",minHeight:20,maxHeight:200,preset:ec,assistiveLabel:$??et(i("7ShCl").aiMessages.promptbuilderAriaLabel),shouldFocus:n.autoFocus??!0,defaultValue:K,onChange:eo,onEditorReady:eu});return(0,r.jsx)("div",{onKeyDown:eg,onKeyUp:eg,children:(0,r.jsxs)(i("1s5hv").default,{gap:"space.050",wrap:Q?"wrap":void 0,direction:Q?"row":void 0,children:[Q?(0,r.jsx)(i("gdv5Z").default,{xcss:ea?H.editorMultiline:H.editorBase,children:eh}):eh,Q?(0,r.jsx)(i("u9agA").default,{xcss:H.insertMenuContainer,space:"space.050",children:[em,ef]}):("user-input"===c||"interrogate"===c)&&(0,r.jsxs)(r.Fragment,{children:[l.enableLinks&&l.linkPicker&&(0,r.jsx)(u,{editorApi:ed,promptType:c}),l.mentionProvider&&(0,r.jsx)(m,{editorApi:ed,promptType:c})]})]})})},K={allowDatasource:!0},W={appearance:"full-page",onFeedbackClicked:()=>{},onReviewStateEntered:()=>{},onExperienceComplete:()=>{},aiGlobalOptIn:{status:"disabled",triggerOptInFlow:()=>{}}};t.exports.useEditorPluginAIOptions=e=>{let t=e||W,n=(0,a.useMemo)(()=>"page-comment"===t.appearance?i("9Tkc6").createPageCommentEditorPluginAIOptions:i("9Tkc6").createPageEditorPluginAIOptions,[t.appearance]),o=(0,a.useRef)(t);o.current=t;let{cloudId:s,userId:l}=(0,i("bQm3c").useSessionData)(),c=(0,a.useMemo)(()=>l&&s?{userId:l,cloudId:s}:void 0,[l,s]),d=(0,i("2Yc46").useAutoApplyState)((0,i("9wGTI").fg)("enable_auto_apply_toggling")?c:void 0),p=!!(0,i("9wGTI").fg)("enable_auto_apply_toggling")&&(d?.enabled??!1),u=d?.refresh;(0,a.useEffect)(()=>{if(!(0,i("9wGTI").fg)("enable_auto_apply_toggling")||!u)return;let e=()=>{u()};return window.addEventListener("autoApplyChanged",e),()=>window.removeEventListener("autoApplyChanged",e)},[u]);let g=(0,a.useRef)(p);g.current=p;let m=(0,a.useMemo)(()=>({product:"confluence",cloudId:s}),[s]),f=(0,i("jhcFr").useLinkPickerEditorProps)(void 0,m),h=(0,i("7QM6o").useSpaceId)(),_=(0,i("hfIjM").useMentionProvider)(h),y=(0,i("lmEhP").useLinkingFeatures)(K),I=(0,a.useMemo)(()=>{var e;return e={linkPicker:f,enableLinks:!0,linking:y.linking,mentionProvider:_,featureFlags:{}},t=>(0,r.jsx)(i("auTg8").default,{children:(0,r.jsx)(z,{editorProps:t,options:e})})},[y.linking,f,_]),E=(0,i("8L9Ex").useEditorPluginAIProactiveEnabled)({aiGlobalOptInStatus:t.aiGlobalOptIn.status}),S=(0,i("02cx8").useEditorRovoButtonActions)(),b=(0,a.useMemo)(()=>"page-comment"!==t.appearance&&"enabled"===t.aiGlobalOptIn.status,[t.appearance,t.aiGlobalOptIn.status]),{setNudges:T}=(0,i("4acD6").useAISmartButtonActions)(),C=(0,a.useMemo)(()=>b?{actions:{...S,setNudges:T}}:void 0,[b,S,T]);return(0,a.useMemo)(()=>n({aiGlobalOptIn:o.current.aiGlobalOptIn,hidePrimaryToolbarButton:E||"full-page"===t.appearance&&"enabled"===t.aiGlobalOptIn.status,generativeAIApiUrl:`${window.location.origin}/gateway/api/editor-ai/v1/generative/ai`,handleFeedbackSubmission:async e=>{try{return o.current.onFeedbackClicked?.(e),{status:"submitted"}}catch(e){return{status:"failed"}}},onAnnotationsRemoved:(0,i("9wGTI").fg)("platform_editor_ai_aifc_streaming")?o.current.onAnnotationsRemoved:void 0,onExperienceEvent:{THUMBS_UP:()=>{},THUMBS_DOWN:()=>{},REVIEW_STATE_ENTERED:()=>{o.current.onReviewStateEntered?.()},EXPERIENCE_COMPLETE:()=>{o.current.onExperienceComplete?.()}},onDocChangeByAgent:e=>{},onAIProviderChanged:(e,t)=>{o.current.onAIProviderChanged&&o.current.onAIProviderChanged(e,t)},getUserPreferences:()=>(0,i("9wGTI").fg)("enable_auto_apply_toggling")?{isInDocumentStreamingAllowed:g.current}:{},getChannelVariables:o.current.getChannelVariables,product:"CONFLUENCE",objectId:o.current.contentId,PromptEditor:I,AIButtonWrapper:e?.AIButtonWrapper,providers:e?.providers,auditLogSettings:"page-comment"!==t.appearance&&t.contentId?{enabled:!0,eventData:{type:"page",pageId:t.contentId}}:{enabled:!1},...b&&{aiSmartButtonOptions:C},...t.usePlatformPrompt&&{onSubmit:()=>{}}}),[n,E,t.appearance,t.contentId,I,e?.AIButtonWrapper,e?.providers,b,C,t.aiGlobalOptIn.status,t.usePlatformPrompt])}}),a("9Tkc6",function(t,n){var a=i("42omo");let r=({size:t="medium"}={})=>e(a).createElement(e(i("3HOqx")),{label:"",spacing:"spacious",size:t}),o=t=>({key:i("bwpRs").CONFIG_ITEM_KEYS.CONVERT_TO_BULLETED_LIST,title:i("AMCQl").aiConfigItemMessages.convertToBulletListTitle,description:i("AMCQl").aiConfigItemMessages.convertToBulletListDescription,icon:()=>e(a).createElement(e(i("cUQMr")),{label:"",spacing:"spacious"}),statusLozengeType:"beta",intentSchemaId:"convert_to_bullet_points.json",actions:{selection:[(0,i("jc4DP").createInsertBelow)({appearance:"secondary",factoryOptions:t}),(0,i("jc4DP").createReplace)({appearance:"primary"})]}}),s=e=>({config:o(e),triggers:{empty:{enabled:!1},selection:{enabled:!0}}}),l=t=>({key:i("bwpRs").CONFIG_ITEM_KEYS.CONVERT_TO_TABLE,title:i("AMCQl").aiConfigItemMessages.convertToTableTitle,description:i("AMCQl").aiConfigItemMessages.convertToTableDescription,icon:()=>e(a).createElement(e(i("4ymSL")),{label:"",spacing:"spacious"}),statusLozengeType:"beta",intentSchemaId:"convert_to_table.json",actions:{selection:[(0,i("jc4DP").createInsertBelow)({appearance:"secondary",factoryOptions:t}),(0,i("jc4DP").createReplace)({appearance:"primary"})]}}),c=e=>({config:l(e),triggers:{empty:{enabled:!1},selection:{enabled:!0}}}),d=()=>{let e=i("c6GJD").default.getExperimentValue,t=e("platform_editor_ai-prompts-placeholder","cohort","not-enrolled");if("control"!==t&&"not-enrolled"!==t){let t=e("platform_editor_ai-prompts-placeholder","label",""),n=e("platform_editor_ai-prompts-placeholder","description",""),i=e("platform_editor_ai-prompts-placeholder","intent",""),a=e("platform_editor_ai-prompts-placeholder","list_order",0),r=e("platform_editor_ai-prompts-placeholder","analytics_experience_name",""),o=e("platform_editor_ai-prompts-placeholder","show_on_empty_page",!0),s=e("platform_editor_ai-prompts-placeholder","prompt_status_type","");if(t&&n&&i&&r)return{label:{id:t,description:t,defaultMessage:t},description:{id:n,description:n,defaultMessage:n},intent:i,listOrder:a,analyticsExperienceName:r,showOnEmpty:o,statusType:s}}},p=()=>{let t=d();if(t){let n="new"===t.statusType.toLowerCase()||"beta"===t.statusType.toLowerCase()?t.statusType.toLowerCase():void 0;return{...t,configItem:{key:i("bwpRs").CONFIG_ITEM_KEYS.EXPERIMENTAL_PROMPT_PLACEHOLDER,title:t.label,description:t.description,icon:()=>e(a).createElement(r,null),statusLozengeType:n,intentSchemaId:t.intent,actions:{empty:[(0,i("jc4DP").createInsertAtCurrentPosition)({appearance:"secondary"}),(0,i("jc4DP").createInsertAtTop)({appearance:"primary"})],selection:[(0,i("jc4DP").createInsertBelow)({appearance:"secondary"}),(0,i("jc4DP").createReplace)({appearance:"primary"})]},getBackendModel:()=>"assistance-service"}}}},u=()=>{let e=p();if(e){let{configItem:t,...n}=e;return{configItemWithOptions:{config:t,triggers:{empty:{enabled:!0,docMinSize:1},selection:{enabled:!0}}},...n}}},g=()=>e(a).createElement(e(i("54tpX")),{label:"",color:"currentColor",spacing:"spacious"}),m=t=>({key:i("bwpRs").CONFIG_ITEM_KEYS.FIND_ACTION_ITEMS,title:i("AMCQl").aiConfigItemMessages.findActionItemsTitle,description:i("AMCQl").aiConfigItemMessages.findActionItemsDescription,icon:()=>e(a).createElement(g,null),intentSchemaId:"action_items_intent_schema.json",featureId:"find_action_items",actions:{empty:[(0,i("jc4DP").createInsertAtTop)({appearance:"secondary"}),(0,i("jc4DP").createInsertAtCurrentPosition)({appearance:"primary"})],selection:[(0,i("jc4DP").createInsertAtTop)({appearance:"secondary"}),(0,i("jc4DP").createInsertBelow)({appearance:"primary",factoryOptions:t})]},getBackendModel:()=>"assistance-service"}),f=e=>({config:m(e),triggers:{empty:{enabled:!0,docMinSize:1},selection:{enabled:!0}}}),h=t=>({key:i("bwpRs").CONFIG_ITEM_KEYS.FREE_GENERATE,title:i("SFzFl").default.rovoButtonTitle,description:i("SFzFl").default.rovoUniversalLongCallToAction,promptHint:i("AMCQl").aiConfigItemMessages.freeGenerateRovoPromptHint,icon:()=>e(a).createElement(i("3ZqD0").default,{label:"",size:"small"}),doNotHighlightDocWhenSelectionIsEmpty:!0,insertOnEmptySelection:!0,agentId:"editor_agent",canTogglePageKnowledge:!0,quickInsertPriority:Number.NEGATIVE_INFINITY,intentSchemaId:"custom_free_generate_intent_schema.json",featureId:"free_generate",actions:{empty:[(0,i("jc4DP").createInsertAtCurrentPosition)({appearance:"primary"})],selection:[(0,i("jc4DP").createInsertBelow)({appearance:"secondary",factoryOptions:t}),(0,i("jc4DP").createReplace)({appearance:"primary"})]},getBackendModel:()=>"assistance-service",withContextMutation:(e,{latestPromptResponse:t})=>t?{...e,intentSchemaId:"custom_with_interrogation_intent_schema.json",featureId:"interrogation"}:e}),_=()=>e(a).createElement(e(i("a6IPc")),{label:"",color:"currentColor",spacing:"spacious"}),y=t=>({key:i("bwpRs").CONFIG_ITEM_KEYS.SUMMARISE_WRITING,title:i("AMCQl").aiConfigItemMessages.summarizeWritingtitle,description:i("AMCQl").aiConfigItemMessages.summarizeWritingDescription,icon:()=>e(a).createElement(_,null),showInRefineDropdown:!0,intentSchemaId:"summarize_intent_schema.json",featureId:"summarize_writing",actions:{empty:[(0,i("jc4DP").createInsertAtCurrentPosition)({appearance:"primary"})],selection:[(0,i("jc4DP").createInsertBelow)({appearance:"secondary",factoryOptions:t}),(0,i("jc4DP").createReplace)({appearance:"primary"})]},getBackendModel:()=>"assistance-service"}),I=e=>({config:y(e),triggers:{empty:{enabled:!0,docMinSize:1},selection:{enabled:!0}}}),E={brainstormConfigItem:{key:i("bwpRs").CONFIG_ITEM_KEYS.BRAINSTORM,title:i("AMCQl").aiConfigItemMessages.brainstormTitle,description:i("AMCQl").aiConfigItemMessages.brainstormDescription,icon:()=>e(a).createElement(r,null),promptLabel:i("AMCQl").aiConfigItemMessages.brainstormPromptLabel,promptHint:i("AMCQl").aiConfigItemMessages.brainstormPromptHint,doNotHighlightDocWhenSelectionIsEmpty:!0,agentId:"editor_agent",intentSchemaId:"brainstorm_intent_schema.json",featureId:"brainstorm",alwaysNoDocAndSelection:!0,actions:{empty:[(0,i("jc4DP").createInsertAtCurrentPosition)({appearance:"primary"})]},getBackendModel:()=>"assistance-service"},freeGenerateAifcConfigItem:{key:i("bwpRs").CONFIG_ITEM_KEYS.FREE_GENERATE_AIFC,title:{id:"free-generate-aifc-title",defaultMessage:"Free Generate AIFC"},description:i("SFzFl").default.aiUniversalLongCallToAction,promptHint:i("AMCQl").aiConfigItemMessages.freeGeneratePromptHint,adfPrompt:!0,doNotHighlightDocWhenSelectionIsEmpty:!0,insertOnEmptySelection:!0,intentSchemaId:"custom_free_generate_intent_schema.json",actions:{},getBackendModel:()=>"aifc-bridge"}};t.exports.UNSTABLE_configItems=E,t.exports.createPageCommentEditorPluginAIOptions=function(e){let t=e.onExperienceEvent||{THUMBS_UP:()=>{},THUMBS_DOWN:()=>{},REVIEW_STATE_ENTERED:()=>{},EXPERIENCE_COMPLETE:()=>{}},n=e.product?e.product:"CONFLUENCE",a=e.isInDocumentStreamingEnabled??(0,i("dh538").fg)("platform_editor_ai_aifc_streaming");return{aiGlobalOptIn:e.aiGlobalOptIn,baseGenerate:h(),configItemWithOptions:function(e){let t=[(0,i("l5nYy").changeToneToProfessionalWithOptions)(e),I(e),(0,i("iBSwI").improveWritingWithOptions)(e),(0,i("iBSwI").fixSpellingAndGrammarWithOptions)(e),(0,i("96Uu5").makeShorterWithOptions)(e),(0,i("2KJU8").makeLongerWithOptions)(e),s(e),c(e),(0,i("70Lwl").suggestTitleWithOptions)(e),(0,i("l5nYy").changeToneToEmpatheticWithOptions)(e),(0,i("l5nYy").changeToneToCasualWithOptions)(e),(0,i("l5nYy").changeToneToEducationalWithOptions)(e),...(0,i("6PN31").translationConfigItemWithOptions)(e)],n=u();if(n){let{listOrder:e,configItemWithOptions:i}=n;t.splice(e,0,i)}return t}({product:n,isInDocumentStreamingEnabled:a}),disableAISelectionToolbar:!0,product:n,objectId:e.objectId,getFetchCustomHeaders:e.getFetchCustomHeaders||i("klIiV")._getFetchCustomHeaders,onExperienceEvent:t,handleFeedbackSubmission:e.handleFeedbackSubmission,AIButtonWrapper:e.AIButtonWrapper,PromptEditor:e.PromptEditor,providers:e.providers,auditLogSettings:e.auditLogSettings,getChannelVariables:e.getChannelVariables,isRovoEnabled:e.isRovoEnabled??!0,showRovoAgentsInCommandPalette:e.showRovoAgentsInCommandPalette??!1,useFreeGenerateEditorAgent:e.useFreeGenerateEditorAgent??!0,onSubmit:e.onSubmit,onAnnotationsRemoved:e.onAnnotationsRemoved,getUserPreferences:e.getUserPreferences,isInDocumentStreamingEnabled:a}},t.exports.createPageEditorPluginAIOptions=e=>{let t=e.onExperienceEvent||{THUMBS_UP:()=>{},THUMBS_DOWN:()=>{},REVIEW_STATE_ENTERED:()=>{},EXPERIENCE_COMPLETE:()=>{}},n=e.product?e.product:"CONFLUENCE",a=e.isInDocumentStreamingEnabled??(0,i("dh538").fg)("platform_editor_ai_aifc_streaming"),r={product:n,isInDocumentStreamingEnabled:a};return{aiGlobalOptIn:e.aiGlobalOptIn,baseGenerate:h(r),configItemWithOptions:function(e){let t=[(0,i("l5nYy").changeToneToProfessionalWithOptions)(e),I(e),(0,i("iBSwI").improveWritingWithOptions)(e),(0,i("iBSwI").fixSpellingAndGrammarWithOptions)(e),(0,i("96Uu5").makeShorterWithOptions)(e),(0,i("2KJU8").makeLongerWithOptions)(e),s(e),c(e),f(e),(0,i("70Lwl").suggestTitleWithOptions)(e),(0,i("l5nYy").changeToneToEmpatheticWithOptions)(e),(0,i("l5nYy").changeToneToCasualWithOptions)(e),(0,i("l5nYy").changeToneToEducationalWithOptions)(e),(0,i("kOMDA").addPolishWithOptions)(e),...(0,i("6PN31").translationConfigItemWithOptions)(e)],n=[(0,i("iBSwI").fixSpellingAndGrammarWithOptions)(e),(0,i("l5nYy").changeToneToProfessionalWithOptions)(e),(0,i("96Uu5").makeShorterWithOptions)(e),I(e),(0,i("iBSwI").improveWritingWithOptions)(e),(0,i("2KJU8").makeLongerWithOptions)(e),s(e),c(e),f(e),(0,i("70Lwl").suggestTitleWithOptions)(e),(0,i("l5nYy").changeToneToEmpatheticWithOptions)(e),(0,i("l5nYy").changeToneToCasualWithOptions)(e),(0,i("l5nYy").changeToneToEducationalWithOptions)(e),(0,i("kOMDA").addPolishWithOptions)(e),...(0,i("6PN31").translationConfigItemWithOptions)(e)],a=u();if(a&&!e.isInDocumentStreamingEnabled){let{listOrder:e,configItemWithOptions:n}=a;t.splice(e,0,n)}return e.isInDocumentStreamingEnabled?n:t}(r),getSelectionToolbarDropdowns(){let e=[{id:"change-tone",label:i("7ShCl").aiMessages.confluenceChangeToneSelectionToolbarDropdownMenuTitle,options:[{label:i("AMCQl").aiConfigItemMessages.changeToneProfessionalToneSelectionToolbarDropdownItemTitle,configItem:(0,i("l5nYy").changeToneToProfessional)(r)},{label:i("AMCQl").aiConfigItemMessages.changeToneEmpatheticToneSelectionToolbarDropdownItemTitle,configItem:(0,i("l5nYy").changeToneToEmpathetic)(r)},{label:i("AMCQl").aiConfigItemMessages.changeToneCasualToneSelectionToolbarDropdownItemTitle,configItem:(0,i("l5nYy").changeToneToCasual)(r)},{label:i("AMCQl").aiConfigItemMessages.changeToneNeutralToneSelectionToolbarDropdownItemTitle,configItem:(0,i("l5nYy").changeToneToNeutral)(r)},{label:i("AMCQl").aiConfigItemMessages.changeToneEducationalToneSelectionToolbarDropdownItemTitle,configItem:(0,i("l5nYy").changeToneToEducational)(r)}]},{id:"rewrite",label:i("7ShCl").aiMessages.confluenceRewriteSelectionToolbarDropdownMenuTitle,options:[{label:i("AMCQl").aiConfigItemMessages.improveWritingSelectionToolbarDropdownItemTitle,configItem:(0,i("iBSwI").improveWriting)(r)},{label:i("AMCQl").aiConfigItemMessages.fixSpellingGrammarSelectionToolbarDropdownItemTitle,configItem:(0,i("iBSwI").fixSpellingAndGrammar)(r)},{label:i("AMCQl").aiConfigItemMessages.summarizeWritingSelectionToolbarDropdownItemTitle,configItem:y(r)},{label:i("AMCQl").aiConfigItemMessages.makeShorterSelectionToolbarDropdownItemTitle,configItem:(0,i("96Uu5").makeShorter)(r)}]}],t=(0,i("6PN31").createTranslationConfigItems)(r),n=(0,i("8vIZB").getSortedSupportedTranslationLanguages)().map(e=>({label:i("bpQiY").aiLanguageMessages[e],configItem:t[e]}));return e.push({id:"translate",label:i("7ShCl").aiMessages.confluenceTranslateSelectionToolbarDropdownMenuTitle,options:n}),e},disableAISelectionToolbar:!1,hidePrimaryToolbarButton:!a&&e.hidePrimaryToolbarButton,product:n,objectId:e.objectId,getFetchCustomHeaders:e.getFetchCustomHeaders||i("klIiV")._getFetchCustomHeaders,getChannelVariables:e.getChannelVariables,onDocChangeByAgent:e.onDocChangeByAgent,onAIProviderChanged:e.onAIProviderChanged,onExperienceEvent:t,handleFeedbackSubmission:e.handleFeedbackSubmission,AIButtonWrapper:e.AIButtonWrapper,PromptEditor:e.PromptEditor,disableInterrogation:e.disableInterrogation??!1,aiUsageDisclaimer:e.aiUsageDisclaimer,isRovoEnabled:e.isRovoEnabled??!0,showRovoAgentsInCommandPalette:e.showRovoAgentsInCommandPalette??!0,providers:e.providers,auditLogSettings:e.auditLogSettings,aiSmartButtonOptions:e.aiSmartButtonOptions,heroConfigItem:a?(0,i("iBSwI").improveWritingWithOptions)(r):void 0,..."enabled"===e.aiGlobalOptIn.status&&(0,i("dh538").fg)("ai-smart-button-team-25")&&{dynamicSurfaceConfigItems:function(e){let t=[{config:(0,i("iBSwI").improveWriting)(e),triggers:{empty:{enabled:!1},selection:{enabled:!0}}},{config:(0,i("iBSwI").fixSpellingAndGrammar)(e),triggers:{empty:{enabled:!1},selection:{enabled:!0}}},{config:(0,i("l5nYy").changeToneToProfessional)(e),triggers:{empty:{enabled:!1},selection:{enabled:!0}}},{config:(0,i("l5nYy").changeToneToEmpathetic)(e),triggers:{empty:{enabled:!1},selection:{enabled:!0}}},{config:(0,i("l5nYy").changeToneToCasual)(e),triggers:{empty:{enabled:!1},selection:{enabled:!0}}},{config:(0,i("l5nYy").changeToneToEducational)(e),triggers:{empty:{enabled:!1},selection:{enabled:!0}}},{config:(0,i("96Uu5").makeShorter)(e),triggers:{empty:{enabled:!1},selection:{enabled:!0}}},{config:(0,i("2KJU8").makeLonger)(e),triggers:{empty:{enabled:!1},selection:{enabled:!0}}},(0,i("kOMDA").addPolishWithOptions)(e),s(e),c(e),f(e),(0,i("70Lwl").suggestTitleForConfluenceTitleToolbarWithOptions)(e),{config:y(e),triggers:{empty:{enabled:!1},selection:{enabled:!0}}},...(0,i("6PN31").translationConfigItemWithOptionsEnabledForSelectionOnly)(e)],n=[{config:(0,i("iBSwI").improveWriting)(e),triggers:{empty:{enabled:!1},selection:{enabled:!0}}},...(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")?[(0,i("kOMDA").addPolishWithOptions)(e)]:[],{config:(0,i("iBSwI").fixSpellingAndGrammar)(e),triggers:{empty:{enabled:!0,docMinSize:1},selection:{enabled:!0}}},{config:(0,i("l5nYy").changeToneToCasual)(e),triggers:{empty:{enabled:!0,docMinSize:1},selection:{enabled:!0}}},{config:(0,i("l5nYy").changeToneToEmpathetic)(e),triggers:{empty:{enabled:!0,docMinSize:1},selection:{enabled:!0}}},{config:(0,i("l5nYy").changeToneToProfessional)(e),triggers:{empty:{enabled:!0,docMinSize:1},selection:{enabled:!0}}},{config:(0,i("96Uu5").makeShorter)(e),triggers:{empty:{enabled:!0,docMinSize:1},selection:{enabled:!0}}},{config:(0,i("2KJU8").makeLonger)(e),triggers:{empty:{enabled:!0,docMinSize:1},selection:{enabled:!0}}},...(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")?[]:[(0,i("kOMDA").addPolishWithOptions)(e)],...(0,i("6PN31").translationConfigItemWithOptionsEnabledForSelectionOnly)(e)];return e.isInDocumentStreamingEnabled?n:t}(r)},onAnnotationsRemoved:e.onAnnotationsRemoved,getUserPreferences:e.getUserPreferences,onSubmit:e.onSubmit,isInDocumentStreamingEnabled:a}},t.exports.getEditorActionsForObjectSidebar=t=>{let n=e=>()=>{t.aiExperience?.actions.openAIModal({invokedFrom:"objectSidebar",configItem:e})},a={product:"CONFLUENCE",isInDocumentStreamingEnabled:(0,i("dh538").fg)("platform_editor_ai_aifc_streaming")},r=[{title:i("7ShCl").aiMessages.moreProfessionalToneToolbarDropdownIconTitle,icon:e(i("oeZjt")),onClick:n((0,i("l5nYy").changeToneToProfessional)(a))},{title:i("7ShCl").aiMessages.moreCasualToneToolbarDropdownIconTitle,icon:e(i("j398X")),onClick:n((0,i("l5nYy").changeToneToCasual)(a))},{title:i("7ShCl").aiMessages.moreEmpatheticToneToolbarDropdownIconTitle,icon:e(i("j8LwF")),onClick:n((0,i("l5nYy").changeToneToEmpathetic)(a))}],o=[{title:i("7ShCl").aiMessages.makeShorterToolbarDropdownIconTitle,icon:e(i("cH4SO")),onClick:n((0,i("96Uu5").makeShorter)(a))},{title:i("7ShCl").aiMessages.makeLongerToolbarDropdownIconTitle,icon:e(i("eugUs")),onClick:n((0,i("2KJU8").makeLonger)(a))}];return[{title:i("7ShCl").aiMessages.spellingAndGrammarToolbarDropdownIconTitle,icon:e(i("dLjaJ")),onClick:n((0,i("iBSwI").fixSpellingAndGrammar)(a))},{title:i("7ShCl").aiMessages.changeToneToolbarDropdownIconTitle,icon:e(i("iulqN")),subItems:r},{title:i("7ShCl").aiMessages.adjustLengthToolbarDropdownIconTitle,icon:e(i("drPNW")),subItems:o},{title:i("AMCQl").aiConfigItemMessages.addPolishTitle,icon:e(i("cbtR4")),onClick:n((0,i("kOMDA").addPolish)(a))}]}}),a("5SuLc",function(t,n){var a=i("cUcZ5"),r=i("8m4tT");function o(e,t){if(Intl.Segmenter)return Array.from(new Intl.Segmenter(t,{granularity:"word"}).segment(e)).filter(e=>e.isWordLike).map(e=>({text:e.segment,index:e.index}));let n=[];for(let t of e.matchAll(/\S+/gu))n.push({text:t[0],index:t.index});return n}let s=(e,{locale:t})=>{let n,i,a,r,s=e.startPos.pos,l=e.endPos.pos,c=e.startPos.doc,d=s,p=l;if(c.nodesBetween(s,l,(e,t)=>{!n&&e.isText&&(n=e,a=t),e.isText&&(i=e,r=t)}),n&&n.isText&&n.text&&a){let e=o(n.text,t),i=s-a,r=e.find(e=>e.index<i&&e.index+e.text.length>i);d=r?r.index+a:s}if(i&&i.isText&&i.text&&r){let e=o(i.text,t),n=l-r,a=e.find(e=>e.index<n&&e.index+e.text.length>n);p=a?a.index+a.text.length+r:l}return{startPos:c.resolve(d),endPos:c.resolve(p)}},l=e=>{let{startPos:t,endPos:n}=e,i=t.doc;return"caption"===t.parent.type.name?{startPos:i.resolve(t.start(Math.max(t.depth-1,1))),endPos:i.resolve(n.end(Math.max(n.depth,1)))}:e},c=e=>{let{startPos:t,endPos:n}=e,i=t.doc;if(t.parent!==n.parent){let e=!1;if(i.nodesBetween(t.pos,n.pos,t=>(t.isInline||"paragraph"===t.type.name||(e=!0),!e)),e){let e=t.blockRange(n);if(e)return{startPos:i.resolve(e.start),endPos:i.resolve(e.end)}}}return e},d=e=>{let{startPos:t,endPos:n}=e,a=t.doc,{paragraph:r,tableRow:o}=a.type.schema.nodes;if(t.parent!==n.parent){if((0,i("cVxBN").isWithinSameCell)({$from:t,$to:n,schema:a.type.schema})){if((0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers"))return{startPos:a.resolve(t.start()),endPos:a.resolve(n.end())};let e=t.sharedDepth(n.pos);return{startPos:a.resolve(t.start(e)),endPos:a.resolve(n.end(e))}}let e=!1;if(a.nodesBetween(t.pos,n.pos,t=>(t.isInline||t.type===r||(e=!0),!e)),e){let e=a.resolve(t.start(Math.max(t.depth-1,1))),r=a.resolve(n.end()),s=(0,i("cVxBN").getPositionNodeTypeDepth)({resolvedPos:e,nodeType:o});s&&(e=a.resolve(e.start(s)-!!(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")));let l=(0,i("cVxBN").getPositionNodeTypeDepth)({resolvedPos:r,nodeType:o});return l&&(r=a.resolve(r.end(l)+ +!!(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers"))),{startPos:e,endPos:r}}}return e},p=(e,t)=>{for(let n=t;n>0;n--){let t=e[n-1],i=e[n];if(t.every((e,t)=>e!==i[t]))return n}return 0},u=(e,t)=>{for(let n=t;n<e.length-1;n++){let t=e[n],i=e[n+1];if(t.every((e,t)=>e!==i[t]))return n}return e.length-1},g=(e,t)=>{let{tableCell:n,tableHeader:i}=e.nodes;for(let e=t.depth;e>0;e--)if([n,i].includes(t.node(e).type))return t.start(e-1)},m=(e,t)=>{let n=t.selection,{startPos:a,endPos:r}=e,{doc:o}=a,{table:s,tableRow:l}=o.type.schema.nodes;if(!(n instanceof i("7XFGZ").CellSelection)&&[s,l].includes(a.node(a.sharedDepth(r.pos)).type)){let e=g(o.type.schema,a),t=g(o.type.schema,r);e&&t&&(n=i("7XFGZ").CellSelection.create(o,e,t))}if(n instanceof i("7XFGZ").CellSelection){let{$anchorCell:t,$headCell:a}=n;if(a.pos===t.pos)return{startPos:o.resolve(t.pos+1),endPos:o.resolve(t.pos+(t.nodeAfter?.nodeSize||0)-1)};let r=t.node(-1),s=t.start(-1),l=i("LmqWp").TableMap.get(r),{mapByRow:c}=l,d=c.findIndex(e=>e.includes(t.pos-s)),g=c.findIndex(e=>e.includes(a.pos-s)),m=Math.min(d,g),f=Math.max(d,g);if(-1===m||-1===f)return e;m=p(c,m),f=u(c,f);let h=Math.min(...c[m]),_=Math.max(...c[f]);if((0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")){let{map:e}=l,t=e[0],n=e[e.length-1];if(h===t&&_===n){let e=o.resolve(s-1);return{startPos:e,endPos:o.resolve(e.pos+r.nodeSize)}}}let y=o.resolve(s+h),I=o.resolve(s+_);return{startPos:o.resolve(y.start(y.depth+1)),endPos:o.resolve(I.end(I.depth))}}return e},f=e=>{let{startPos:t,endPos:n}=e,a=t.doc,{layoutColumn:r}=a.type.schema.nodes,o=(0,i("cVxBN").getPositionNodeTypeDepth)({resolvedPos:t,nodeType:r}),s=(0,i("cVxBN").getPositionNodeTypeDepth)({resolvedPos:n,nodeType:r});if(o&&s&&t.start(o)===n.start(s))return e;let l=t,c=n;return o&&t.node(o-1).childCount>1&&(l=a.resolve(t.start(o-1))),s&&n.node(s-1).childCount>1&&(c=a.resolve(n.end(s-1))),{startPos:l,endPos:c}},h=e=>(t,n)=>e.reduce((e,t)=>t(e,n),t);function _({selectionPositions:e,context:t,options:n}){if(e.startPos.pos===e.endPos.pos)return[e.startPos.pos,e.endPos.pos];let{startPos:a,endPos:r}=h([(!n||n.shouldTransformCellSelectionToTextRange)&&m,(!n||n.shouldExpandSelectionToCompleteWords)&&s,(!n||n.shouldExpandSelectionToMediaIfInCaption)&&l,(!n||n.shouldExpandSelectionToNearestBlockNode)&&d,(!n||n.shouldExpandSelectionToCommonBlockAncestor)&&c,(!n||n.shouldExpandSelectionToEntireLayout)&&f].filter(e=>!!e))(e,t),[o,p]=(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")?[0,a.doc.content.size]:[1,a.doc.content.size-1];return[Math.max(o,a.pos),Math.min(p,r.pos)]}let y=e=>(t,n,a)=>{let r=document.createElement("span");return e||r.appendChild(document.createTextNode("​")),r.setAttribute("data-testid",`ai-modal-${n}-widget`),r.className=`ai-modal-${n}-widget`,r.contentEditable="false",i("ftzrq").Decoration.widget(t,r,{side:"start"===n?1:-1,key:a??`${n}WidgetDecoration`})},I=e=>{let t=document.createElement("span");return t.setAttribute("data-testid","ai-modal-mount-point-widget"),t.className="ai-modal-mount-point-widget",t.contentEditable="false",i("ftzrq").Decoration.widget(e,t,{side:1,key:"modalMountPointDecoration"})},E=(e,t)=>i("ftzrq").Decoration.inline(e,t,{class:"ai-selection-highlight","data-testid":"ai-selection-highlight"},{key:"inlineDecoration"}),S=(e,t)=>i("ftzrq").Decoration.node(e,t,{class:"ai-selection-node","data-testid":"ai-selection-node"},{key:"ai-nodeDecoration"}),b=({state:e})=>{let t,n,{selection:a}=e;if(a instanceof i("ks2lK").NodeSelection)t=a.from,n=a.to;else if((0,i("jdR93").isCellSelection)(e)){let i=(0,r.findParentNodeOfType)(e.schema.nodes.table)(a);if(i){let{depth:e}=i;t=a.$from.before(e),n=a.$from.after(e)}}else{let{selection:a}=e,o=(0,i("jdR93").getSupportedNodesForAIModal)(e),s=(0,r.findParentNode)(e=>o.has(e.type))(a);if(s){let{depth:e}=s;t=a.$from.before(e),n=a.$from.after(e)}}return void 0!==t&&void 0!==n?[S(t,n)]:[]},T=({state:e,configItem:t,lastTriggeredFrom:n,initialPositions:a})=>{var r;let o=!0;a[0]===a[1]&&0!==e.doc.content.size&&(o=!!t.doNotHighlightDocWhenSelectionIsEmpty),(0,i("hX9je").isConfluenceTitleToolbarSuggestTitle)({configItem:t,lastTriggeredFrom:n})&&(o=!1);let{startPos:s,endPos:l}=o?{startPos:a[0],endPos:a[1]}:!0==(r=new(0,i("ks2lK").AllSelection)(e.doc))instanceof i("ks2lK").AllSelection?{startPos:r.from+1,endPos:r.to-1}:{startPos:r.from,endPos:r.to},c=[],{isInDocumentStreamingEnabled:d}=(0,i("kqrrC").getPluginState)(e),p=y(d)(a[0],"start"),u=y(d)(a[1],"end");return(c=a[0]===a[1]?[u]:[p,u]).push(E(s,l)),c},C=({state:e,configItem:t,initialPositions:n})=>{let a=n[0],r=n[1],o=a===r,s=(0,i("hX9je").isSuggestTitleForConfluence)(t),l=[];if(!s)if(o)l.push(function(e){let t=document.createElement("span");return t.setAttribute("data-testid","ai-pre-stream-empty-selection-caret"),t.className="ai-pre-stream-empty-selection-caret",t.contentEditable="false",i("ftzrq").Decoration.widget(e,t,{side:1,key:"ai-pre-stream-empty-selection-caret"})}(a));else{let e=i("ftzrq").Decoration.inline(a,r,{class:"ai-pre-stream-range-selection","data-testid":"ai-pre-stream-range-selection"},{key:"ai-pre-stream-range-selection"}),t=i("ftzrq").Decoration.inline(a,r,{},{key:"modalMountPointRangeDecoration"});l.push(e,t)}let c=I(s?1:o&&!t.insertOnEmptySelection?e.doc.content.size:Math.min(r,e.doc.content.size));return l.push(c),l};t.exports.createWidgetDecoration=y,t.exports.createModalMountPointDecoration=I,t.exports.createInlineDecoration=E,t.exports.createGeneratedContentDecorations=(e,t,n)=>{let a=y(n)(e,"start","generatedStartWidget");return[a,i("ftzrq").Decoration.inline(e,t,{class:"ai-generated-content-highlight","data-testid":"ai-generated-content-highlight"},{key:"generatedInlineDecoration"}),y(n)(t,"end","generatedEndWidget")]},t.exports.createGeneratedNodeDecorations=(e,t)=>i("ftzrq").Decoration.node(e,t,{class:"ai-generated-node-highlight","data-testid":"ai-generated-node-highlight"},{key:"generatedNodeDecoration"}),t.exports.createOpenAIModalCommand=({state:t,configItem:n,lastTriggeredFrom:r,triggerMethod:o,aiGlobalOptIn:s,initialPrompt:l,triggeredFor:c,nudgeMetrics:d,locale:p,isExternal:u=!1,withAcceptReject:g=!0,withStreamingHighlight:m=!0,hideLoadingScreen:f=!1})=>{if("disabled"===s.status||(0,i("lzcvT").isFedRamp)())return()=>!1;if("disabled-opt-in"===s.status)return s.triggerOptInFlow(),(0,i("kqrrC").createCommand)({},e=>((0,i("4SGh1").addAnalytics)({editorState:t,tr:e,payload:{action:"triggerOptInFlow",actionSubject:"editorPluginAI",actionSubjectId:"aiGlobalOptIn",attributes:{experienceType:(0,i("6gJll").convertExperienceName)(n.key),lastTriggeredFrom:r,selectionType:t.selection.empty?"empty":"range"},eventType:i("d925B").EVENT_TYPE.UI}}),e));let{from:h,to:y}=t.selection,I=(0,i("kqrrC").getPluginState)(t),E=I.initialPositions,S=u&&I.isInDocumentStreamingEnabled?[h,y]:E||[h,y],A=n.adfPrompt&&(0,i("4F0gv").isAdfStreamingEnabled)();if(!c?.isBlock&&(A||I.isInDocumentStreamingEnabled))if(u){let[e,n]=_({selectionPositions:{startPos:t.selection.$from,endPos:t.selection.$to},context:{locale:p??"en-GB",selection:t.selection},options:{shouldExpandSelectionToCompleteWords:!0,shouldExpandSelectionToMediaIfInCaption:!0,shouldExpandSelectionToNearestBlockNode:!0,shouldTransformCellSelectionToTextRange:!0}});S=[e,n]}else{let[e,n]=_({selectionPositions:E?{startPos:t.doc.resolve(E[0]),endPos:t.doc.resolve(E[1])}:{startPos:t.selection.$from,endPos:t.selection.$to},context:{locale:p??"en-GB",selection:t.selection},options:{shouldExpandSelectionToCompleteWords:!0,shouldExpandSelectionToMediaIfInCaption:!0,shouldExpandSelectionToNearestBlockNode:!0,shouldTransformCellSelectionToTextRange:!0,shouldExpandSelectionToEntireLayout:I.isInDocumentStreamingEnabled}});S=[e,n]}let v=i("ftzrq").DecorationSet.empty;if(c?.isBlock){let e=b({state:t});e.length&&(v=v.add(t.doc,e))}else{let e=I.isInDocumentStreamingEnabled?C({state:t,configItem:n,initialPositions:S}):T({state:t,configItem:n,lastTriggeredFrom:r,initialPositions:S});e.length&&(v=v.add(t.doc,e))}let P={type:"SHOW_MODAL",data:{interactionSessionId:e(a)(),lastTriggeredFrom:r,triggerMethod:o,modalDecorationSet:v,configItem:n,modalMountedTimeStamp:Date.now(),initialPrompt:l,triggeredFor:c,initialPositions:S,initialSelection:I.initialSelection||t.selection,nudgeMetrics:d,withAcceptReject:g,withStreamingHighlight:m,hideLoadingScreen:f}};return I.isInDocumentStreamingEnabled?(0,i("kqrrC").createCommand)(P,e=>{let t=e.selection,{to:n,from:a}=t;if(!c?.isBlock&&n!==a){e.setSelection(i("ks2lK").TextSelection.create(e.doc,n));let t=window.getSelection();t&&t.removeAllRanges()}return(0,i("eyHC2").endStream)(e).setMeta("useSelectionBookmarkForRemote",i("ks2lK").TextSelection.between(e.doc.resolve(S[0]),e.doc.resolve(S[1])).getBookmark()).setMeta(i("fXyZM").selectionPluginKey,{action:"lastSelectionContext",selection:t}).setMeta("scrollIntoView",!1)}):(0,i("kqrrC").createCommand)(P,e=>{let{to:t,from:n}=e.selection;return c?.isBlock||t===n||e.setSelection(i("ks2lK").TextSelection.create(e.doc,t)),e})},t.exports.createEndAIExperienceCommand=(e,t,n)=>(0,i("kqrrC").createCommand)({type:"END_EXPERIENCE",data:e&&!t?{modalDecorationSet:e}:{}},(a,r)=>{if(t){let t=e?.find(void 0,void 0,e=>"inlineDecoration"===e.key)?.[0];t&&a.setSelection(i("ks2lK").TextSelection.create(a.doc,t.from,Math.min(t.to,a.doc.content.size)))}return(0,i("kqrrC").getPluginState)(r).isInDocumentStreamingEnabled?(!1===n?a.setMeta(i("fXyZM").selectionPluginKey,{action:"lastSelectionContextPending"}):a.setMeta(i("fXyZM").selectionPluginKey,{action:"lastSelectionContext",selection:void 0}),(0,i("eyHC2").endStream)((0,i("kTCUV").endWatchingAnnotationChanges)(a))):a}),t.exports.clearSelectionDecorations=e=>{let t=(0,i("kqrrC").getPluginState)(e).modalDecorationSet,n=t.find(void 0,void 0,e=>"ai-pre-stream-range-selection"===e.key||"ai-pre-stream-empty-selection-caret"===e.key);return(0,i("kqrrC").createCommand)({type:"UPDATE_MODAL_DECORATION_SET",data:{modalDecorationSet:t.remove(n)}})},t.exports.createStartAISessionCommand=e=>(0,i("kqrrC").createCommand)({type:"START_SESSION",data:{sessionId:e}}),t.exports.createUpdateTargetIdCommand=e=>(0,i("kqrrC").createCommand)({type:"UPDATE_TARGET_ID",data:{targetId:e}})}),a("8L9Ex",function(e,t){var n=i("5spQU");e.exports.useEditorPluginAIProactiveEnabled=function({aiGlobalOptInStatus:e}){let t=(0,i("dh538").fg)("use_frontend_feature_encoding_sdk")?(0,n.isFeatureEnabled)("confluence","confluence-ai"):!(0,i("lzcvT").isFedRamp)(),a=(0,i("3jwuS").useIsCurrentPageLive)(),{locale:r}=(0,i("8C5kA").default)(),o=["en-US","en-GB"].includes(r);return t&&"enabled"===e&&o&&!!(0,i("dh538").fg)("platform_editor_ai_proactive_visual_formatting")&&!a},e.exports.useEditorPluginAIProactiveConfig=function({aiGlobalOptIn:e,editorPluginAIFeedbackHandlers:t}){return{product:"CONFLUENCE",aiGlobalOptIn:e,handleFeedbackSubmission:async({sentiment:e,getAIExperience:n,editorAttributes:i})=>{try{return t.current?.handleFeedbackClicked({sentiment:e,getAIExperience:n,editorAttributes:i}),{status:"submitted"}}catch(e){return{status:"failed"}}}}}}),a("a37Yb",function(t,n){var a=i("42omo");let r=(0,i("cgtv4").defineMessages)({AIStreamingSpotlightTitle:{id:"onboarding-ai-first-create.ai-streaming.spotlight.title",defaultMessage:"View changes or undo"},AIStreamingSpotlightDescription:{id:"onboarding-ai-first-create.ai-streamin.spotlight.description",defaultMessage:"Compare your edits and Rovo’s to a prior version and undo if needed."},AIStreamingSpotlightCTA:{id:"onboarding-ai-first-create.ai-streamin.spotlight.cta",defaultMessage:"OK"}}),o=({children:t,editorAPIRef:n})=>{let{createAnalyticsEvent:o}=(0,i("inPa6").useAnalyticsEvents)(),{formatMessage:s}=(0,i("8C5kA").default)(),[l,c]=(0,a.useState)(!1),[d,p]=(0,a.useState)("initial"),{isStreaming:u,isShowDiffAvailable:g}=(0,i("eiA8Z").useSharedPluginStateWithSelector)(n?.current,["aiExperience","trackChanges"],e=>({isStreaming:e?.aiExperienceState?.isStreaming,isShowDiffAvailable:e?.trackChangesState?.isShowDiffAvailable}));(0,a.useEffect)(()=>{u?"initial"===d&&p("streaming"):"streaming"===d&&g?p("completed"):p("initial")},[u,g,d]);let{setOnboardingState:m}=(0,i("ivb8S").useSetOnboardingState)(),{data:f,loading:h,error:_}=(0,i("ivb8S").useGetOnboardingState)([...Object.values(i("bPDOf").AIFC_ONBOARDING_STATE_KEYS)],!(0,i("9wGTI").fg)("cc_aifc_ai_streaming_spotlight")||!(0,i("9wGTI").fg)("aifc_create_enabled")),{hasSeenTrackChangesStreamingSpotlight:y}=(0,i("ivb8S").deserializeState)(f),I=(0,a.useCallback)(()=>{m({key:i("bPDOf").AIFC_ONBOARDING_STATE_KEYS.hasSeenTrackChangesStreamingSpotlight,value:"true"}),c(!0),o({type:"sendScreenEvent",data:{name:"AIStreamingSpotlight",attributes:{source:"onboarding-ai-first-create"}}}).fire()},[o,m]),E=(0,a.useCallback)(()=>{c(!1)},[]),{useChoreographer:S}=(0,i("lsxnT").useChoreographerAssets)(),b=S("AIStreamingSpotlight",{start:I,stop:E}),T=(0,a.useCallback)((e,t,n)=>{c(!1),b.stopMessage(),o({type:"sendUIEvent",data:{action:e,actionSubject:t,actionSubjectId:`AIStreamingSpotlight${n??""}`,source:"onboarding-ai-first-create"}}).fire()},[o,b]),C=(0,a.useCallback)(()=>{T("clicked","button","CTA")},[T]),A=(0,a.useCallback)(()=>{T("clicked","button","Dismiss")},[T]);return((0,a.useEffect)(()=>{!h&&!_&&!y&&!u&&g&&"completed"===d&&(0,i("9wGTI").fg)("cc_aifc_ai_streaming_spotlight")&&b.startMessage()},[h,_,y,b,u,g,d]),l)?e(a).createElement(i("k7Tf7").PopoverProvider,null,e(a).createElement(i("8tIbq").UNSAFE_UpdateOnChange,null),e(a).createElement(i("a90ar").PopoverTarget,null,t),e(a).createElement(i("bqAtB").PopoverContent,{dismiss:A,isVisible:l,placement:"bottom-start"},e(a).createElement(i("fT2ta").default,{entranceDirection:"left"},t=>e(a).createElement("div",t,e(a).createElement(i("71521").SpotlightCard,{testId:"ai-streaming-spotlight"},e(a).createElement(i("aZQ5F").SpotlightHeader,null,e(a).createElement(i("bUJpY").SpotlightHeadline,null,e(a).createElement(i("7hXDW").default,{as:"span",size:"small"},s(r.AIStreamingSpotlightTitle))),e(a).createElement(i("aVS0S").SpotlightControls,null,e(a).createElement(i("2owmo").SpotlightDismissControl,null))),e(a).createElement(i("f1UQW").SpotlightBody,null,e(a).createElement(i("iXCQx").default,null,s(r.AIStreamingSpotlightDescription))),e(a).createElement(i("eopLP").SpotlightFooter,null,e(a).createElement(i("3chlW").SpotlightActions,null,e(a).createElement(i("fNcP1").SpotlightPrimaryAction,{onClick:C},s(r.AIStreamingSpotlightCTA))))))))):e(a).createElement(e(a).Fragment,null,t)};t.exports.useTrackChangesPlugin=({editorAPIRef:t})=>({pluginOptions:(0,a.useMemo)(()=>(0,i("9wGTI").fg)("cc_aifc_ai_streaming_spotlight")?{ButtonWrapper:({children:n})=>e(a).createElement(o,{editorAPIRef:t},n)}:{},[])})}),a("84Iqc",function(t,n){var a=i("a4TK8");let r=e=>!!e,o=["id","collection","url"],s=(e,t)=>t.map(t=>{if(t instanceof i("aXG5V").AttrStep&&o.includes(t.attr)||t instanceof i("9YoeD").SetAttrsStep&&t.attrs&&[...Object.keys(t.attrs)].some(e=>o.includes(e))){let n=e.resolve(t.pos);if(n.parent.type===e.type.schema.nodes.mediaSingle){let e=n.pos+n.parentOffset;return{fromB:e,toB:e+n.parent.nodeSize-1}}}}).filter(r),l=(e,t,n)=>{try{if(e instanceof i("aXG5V").AttrStep||e instanceof i("9YoeD").SetAttrsStep){let i=n.nodeAt(e.pos),a=t.nodeAt(e.pos);if(i&&a&&!i.eq(a))return!0}return!1}catch(e){return!1}},c=(0,i("24P9d").convertToInlineCss)({borderLeft:"2px solid var(--ds-border-accent-gray, #7D818A)"}),d=(0,i("24P9d").convertToInlineCss)({marginTop:"var(--ds-space-150, 12px)",paddingTop:"var(--ds-space-025, 2px)",paddingBottom:"var(--ds-space-025, 2px)",paddingLeft:"var(--ds-space-025, 2px)",boxShadow:"0 0 0 1px var(--ds-border-accent-gray, #7D818A)",borderRadius:"var(--ds-radius-small, 4px)"}),p=(0,i("24P9d").convertToInlineCss)({marginTop:"var(--ds-space-150, 12px)",paddingTop:"var(--ds-space-025, 2px)",paddingBottom:"var(--ds-space-025, 2px)",paddingLeft:"var(--ds-space-025, 2px)",boxShadow:"0 0 0 1px var(--ds-border-accent-red, #E2483D)",borderRadius:"var(--ds-radius-small, 4px)"}),u=(0,i("24P9d").convertToInlineCss)({boxShadow:"0 0 0 1px var(--ds-border-accent-gray, #7D818A)",borderRadius:"var(--ds-radius-small, 4px)"}),g=(0,i("24P9d").convertToInlineCss)({boxShadow:"0 0 0 1px var(--ds-border-accent-red, #E2483D)",borderRadius:"var(--ds-radius-small, 4px)"}),m=(0,i("24P9d").convertToInlineCss)({boxShadow:"0 0 0 1px var(--ds-border-accent-gray, #7D818A)",borderRadius:"calc(var(--ds-radius-xsmall, 2px) + 1px)"}),f=(0,i("24P9d").convertToInlineCss)({boxShadow:"0 0 0 1px var(--ds-border-accent-red, #E2483D)",borderRadius:"calc(var(--ds-radius-xsmall, 2px) + 1px)"}),h=(0,i("24P9d").convertToInlineCss)({display:"inline-flex",boxSizing:"border-box",position:"static",blockSize:"min-content",borderRadius:"var(--ds-radius-small, 4px)",overflow:"hidden",paddingInlineStart:"var(--ds-space-050, 4px)",paddingInlineEnd:"var(--ds-space-050, 4px)",backgroundColor:"var(--ds-background-accent-gray-subtler, #DDDEE1)",font:'var(--ds-font-body-small, normal 400 11px/16px ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Ubuntu, "Helvetica Neue", sans-serif)',fontWeight:"var(--ds-font-weight-bold, 700)",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"var(--ds-text-warning-inverse, #292A2E)"}),_=(e,t)=>{let n="traditional"===t;switch(e){case"blockquote":return(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?n?p:d:c;case"expand":case"decisionList":return n&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?g:u;case"panel":case"codeBlock":return n&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?f:m;default:return}},y=e=>{switch(e){case"expand":case"codeBlock":case"mediaSingle":case"panel":case"decisionList":return!0;case"embedCard":case"blockquote":return(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers");default:return!1}},I=e=>{switch(e){case"mediaSingle":case"embedCard":return!0;case"blockquote":return(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers");default:return!1}},E=e=>"heading"===e||"blockquote"===e&&!(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers"),S=(e,t)=>{let n,a=document.createElement("span");["expand","decisionList"].includes(t||"")?n="var(--ds-radius-small, 4px)":["panel","codeBlock","mediaSingle"].includes(t||"")&&(n="calc(var(--ds-radius-xsmall, 2px) + 1px)");let r=(0,i("24P9d").convertToInlineCss)({position:"absolute",top:(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?"var(--ds-space-075, 6px)":"var(--ds-space-0, 0px)",right:(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?"var(--ds-space-075, 6px)":"var(--ds-space-0, 0px)",zIndex:2,pointerEvents:"none",display:"flex",...!(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?{overflow:"hidden",borderTopRightRadius:n}:{}});a.setAttribute("style",r),a.setAttribute("data-testid","show-diff-removed-lozenge");let o=document.createElement("span");return o.setAttribute("style",h),o.textContent=e.formatMessage(i("808tb").trackChangesMessages.removed).toUpperCase(),a.appendChild(o),a},b=()=>{let e=document.createElement("div"),t=(0,i("24P9d").convertToInlineCss)({position:"relative",display:"block",opacity:1});return e.setAttribute("style",t),e},T=e=>{let t=document.createElement("span");return t.setAttribute("style",ei(e)),t},C=(e,t,n)=>{let i=e.getAttribute("style")||"",a=ei(n),r=_(t.type.name,n)||"";e.setAttribute("style",`${i}${a}${r}`)},A=(e,t,n)=>{let i=document.createElement("div"),a=_(t.type.name,n);return i.setAttribute("style",`${ei(n)}${a||""}`),i.append(e),i},v=(e,t,n,i,a)=>{if("embedCard"!==n.type.name||!(t instanceof HTMLElement))return!1;let r=t.querySelector(".rich-media-item");return r instanceof HTMLElement?r.appendChild(i):new MutationObserver((e,n)=>{let a=t.querySelector(".rich-media-item");a instanceof HTMLElement&&(a.appendChild(i),n.disconnect())}).observe(t,{childList:!0,subtree:!0}),I(n.type.name)&&t.classList.add("traditional"===a?"show-diff-deleted-node-traditional":"show-diff-deleted-node"),e.append(t),!0},P=(e,t,n,a,r)=>{if("mediaSingle"!==n.type.name||!(t instanceof HTMLElement))return!1;let o=t.querySelector('[data-prosemirror-node-name="media"]');if(!o||!(o instanceof HTMLElement))return!1;let s=o.getAttribute("style")||"",l=(0,i("24P9d").convertToInlineCss)({position:"relative"});if(o.setAttribute("style",`${s}${l}`),o.append(a),I(n.type.name)){let e="traditional"===r&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?"show-diff-deleted-node-traditional":"show-diff-deleted-node";t.classList.add(e)}return e.append(t),!0},k=(e,t,n,a,r)=>{let o=b();if(y(n.type.name)){let s=S(r);if(v(e,t,n,s,a)&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")||P(e,t,n,s,a))return;o.append(s)}let s=A(t,n,a);if(o.append(s),t instanceof HTMLElement&&I(n.type.name)){let e="traditional"===a&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?"show-diff-deleted-node-traditional":"show-diff-deleted-node";t.classList.add(e)}e.append(o)},x=(e,t,n,i,a)=>{E(n.type.name)&&t instanceof HTMLElement?(C(t,n,i),e.append(t)):k(e,t,n,i,a)};var w=i("8m4tT");function M(e,t,n){if(t>e.content.size)return e.content.size;let i=e.resolve(t);for(;!(0,w.canInsert)(i,n.content)&&n.content.firstChild?.type.name!=="paragraph"&&!(i.pos+1>e.content.size);)i=e.resolve(i.pos+1);return i.pos}let N=(0,i("24P9d").convertToInlineCss)({color:"var(--ds-text-accent-gray, #505258)",textDecoration:"line-through",opacity:.6,display:"table-row"}),O=(0,i("24P9d").convertToInlineCss)({textDecorationColor:"var(--ds-border-accent-red, #E2483D)",textDecoration:"line-through",opacity:.6,display:"table-row"}),R=(e,t,n)=>{let a=[],r=t.resolve(e.fromA),o=(0,w.findParentNodeClosestToPos)(r,e=>"table"===e.type.name);if(!o)return a;let s=i("LmqWp").TableMap.get(o.node),l=n.resolve(e.fromB),c=(0,w.findParentNodeClosestToPos)(l,e=>"table"===e.type.name);if(!c)return a;let d=i("LmqWp").TableMap.get(c.node);if(s.height<=d.height||s.width!==d.width)return a;let p=e.fromA-o.pos-1,u=e.toA-o.pos-1,g=0,m=0;return o.node.content.forEach((t,n)=>{let i=g,r=g+t.nodeSize;if((i>=p&&i<u||r>p&&r<=u||i<p&&r>u)&&"tableRow"===t.type.name&&!D(t)){let n=d.mapByRow.slice().reverse().find(t=>t[0]+c.pos<e.fromB&&e.fromB<t[t.length-1]+c.pos);a.push({rowIndex:m,rowNode:t,fromA:o.pos+1+i,toA:o.pos+1+r,fromB:n?n[0]+c.start:e.fromB})}g+=t.nodeSize,"tableRow"===t.type.name&&m++}),a.filter(e=>!c.node.children.some(t=>(0,i("2pjJ5").areNodesEqualIgnoreAttrs)(t,e.rowNode)))},D=e=>{let t=!0;return e.descendants(e=>!!t&&((!e.isInline||!(e.nodeSize>0))&&(!e.isText||!e.text||""===e.text.trim())||(t=!1,!1))),t},L=(e,t,n)=>{let i=document.createElement("tr");return i.setAttribute("style","traditional"===n?O:N),i.setAttribute("data-testid","show-diff-deleted-row"),e.content.forEach(e=>{if("tableCell"===e.type.name||"tableHeader"===e.type.name){let n=t.tryCreateNodeView(e);if(n)i.appendChild(n);else{let n=t.serializeFragment(e.content);n&&i.appendChild(n)}}}),i},F=(e,t,n)=>{let i=[];for(let a of e){let e=R(a,t,n);e.length>0&&i.push(...e)}return i},G=({deletedRows:e,originalDoc:t,newDoc:n,nodeViewSerializer:a,colourScheme:r})=>e.map(e=>{let o=L(e.rowNode,a,r),s=M(n,e.fromB-1,t.slice(e.fromA,e.toA));return i("ftzrq").Decoration.widget(s,o,{})}),B=(e,t,n,i,a)=>({decorations:G({deletedRows:F(e.filter(e=>e.deleted.length>0),t,n),originalDoc:t,newDoc:n,nodeViewSerializer:i,colourScheme:a})}),U=(0,i("24P9d").convertToInlineCss)({background:"var(--ds-background-accent-purple-subtlest, #F8EEFE)",textDecoration:"underline",textDecorationStyle:"dotted",textDecorationThickness:"var(--ds-space-025, 2px)",textDecorationColor:"var(--ds-border-accent-purple, #AF59E1)"}),V=(0,i("24P9d").convertToInlineCss)({background:"var(--ds-background-accent-green-subtlest, #DCFFF1)",textDecoration:"underline",textDecorationStyle:"solid",textDecorationThickness:"var(--ds-space-025, 2px)",textDecorationColor:"var(--ds-border-accent-green, #22A06B)"}),j=(e,t)=>i("ftzrq").Decoration.inline(e.fromB,e.toB,{style:"traditional"===t?V:U,"data-testid":"show-diff-changed-decoration"},{}),H=(e,t)=>{switch(e){case"blockquote":return"traditional"===t?K:z;case"mediaSingle":case"mediaGroup":case"table":case"tableRow":case"tableCell":case"tableHeader":case"paragraph":case"heading":case"hardBreak":case"decisionList":case"taskList":case"taskItem":case"bulletList":case"orderedList":case"layoutSection":return;case"extension":case"embedCard":case"listItem":return(0,i("24P9d").convertToInlineCss)({"--diff-decoration-marker-color":"traditional"===t?"var(--ds-border-accent-green, #22A06B)":"var(--ds-border-accent-purple, #AF59E1)"});case"rule":return"traditional"===t?q:W;case"blockCard":return"traditional"===t?Q:J;default:return"traditional"===t?$:Y}},z=(0,i("24P9d").convertToInlineCss)({borderLeft:"2px solid var(--ds-border-accent-purple, #AF59E1)"}),K=(0,i("24P9d").convertToInlineCss)({borderLeft:"2px solid var(--ds-border-accent-green, #22A06B)"}),W=(0,i("24P9d").convertToInlineCss)({backgroundColor:"var(--ds-border-accent-purple, #AF59E1)"}),q=(0,i("24P9d").convertToInlineCss)({backgroundColor:"var(--ds-border-accent-green, #22A06B)"}),Y=(0,i("24P9d").convertToInlineCss)({boxShadow:"0 0 0 1px var(--ds-border-accent-purple, #AF59E1)",borderRadius:"var(--ds-radius-small, 4px)"}),$=(0,i("24P9d").convertToInlineCss)({boxShadow:"0 0 0 1px var(--ds-border-accent-green, #22A06B)",borderRadius:"var(--ds-radius-small, 4px)"}),J=(0,i("24P9d").convertToInlineCss)({boxShadow:"0 0 0 1px var(--ds-border-accent-purple, #AF59E1)",borderRadius:"var(--ds-radius-medium, 6px)"}),Q=(0,i("24P9d").convertToInlineCss)({boxShadow:"0 0 0 1px var(--ds-border-accent-green, #22A06B)",borderRadius:"var(--ds-radius-medium, 6px)"}),X=(0,i("24P9d").convertToInlineCss)({color:"var(--ds-text-accent-gray, #505258)",textDecoration:"line-through",position:"relative",opacity:.6}),Z=(0,i("24P9d").convertToInlineCss)({position:"absolute",top:"50%",width:"100%",display:"inline-block",borderTop:"1px solid var(--ds-text-accent-gray, #505258)",pointerEvents:"none",zIndex:1}),ee=(0,i("24P9d").convertToInlineCss)({textDecorationColor:"var(--ds-border-accent-red, #E2483D)",textDecoration:"line-through",position:"relative",opacity:1}),et=(0,i("24P9d").convertToInlineCss)({position:"absolute",top:"50%",width:"100%",display:"inline-block",borderTop:"1px solid var(--ds-border-accent-red, #E2483D)",pointerEvents:"none",zIndex:1}),en=e=>"traditional"===e?et:Z,ei=e=>"traditional"===e?ee:X,ea=e=>"extension"===e?"show-diff-changed-decoration-node":void 0,er=(e,t)=>i("ftzrq").Decoration.node(e.from,e.to,{style:H(e.name,t),"data-testid":"show-diff-changed-decoration-node",class:ea(e.name)},{}),eo=({change:e,doc:t,nodeViewSerializer:n,colourScheme:a,newDoc:r,intl:o})=>{let s=t.slice(e.fromA,e.toA);if(0===s.content.content.length)return;let l=s.content.content.some(()=>s.content.content.some(e=>["tableHeader","tableCell"].includes(e.type.name))),c=s.content.content.some(()=>s.content.content.some(e=>["tableRow"].includes(e.type.name)));if(l)return;if(c){if(!(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga"))return;let{decorations:o}=B([e],t,r,n,a);return o}let d=document.createElement("span");s.content.forEach(e=>{let t,r,l=()=>{let e=document.createElement("span"),t=(0,i("24P9d").convertToInlineCss)({position:"relative",width:"fit-content"});e.setAttribute("style",`${t}${ei(a)}`);let n=document.createElement("span");return n.setAttribute("style",en(a)),e.append(n),e},c=e=>e.content.childCount>1&&!!e.type.inlineContent&&(e.content.forEach(i=>{let a=n.tryCreateNodeView(i);if(a){let n=document.createElement("br");t=e,d.append(n);let i=l();i.append(a),d.append(i)}else{let e=n.serializeNode(i);if(e){let t=l();t.append(e),d.append(t)}}}),!0),p=s.content.firstChild===e,u=s.content.lastChild===e,g=e.content.childCount>0&&!0===e.type.inlineContent;if((p||u&&s.content.childCount>2)&&g){if(c(e))return;t=e,r=()=>n.serializeFragment(e.content)}else if(u&&2===s.content.childCount){if(c(e))return;t=e,r=()=>{if("text"===e.type.name)return document.createTextNode(e.text||"");if("paragraph"===e.type.name){let e=document.createElement("br");d.append(e)}return n.serializeFragment(e.content)}}else{if(c(e))return;t=e,r=()=>n.serializeNode(e)}let m=n.tryCreateNodeView(t);if(m)if(t.isInline){let e=l();e.append(m),d.append(e)}else x(d,m,t,a,o);else{if(n.getFilteredNodeViewBlocklist(["paragraph","tableRow"]).has(t.type.name))return;let e=r();if(e){let t=T(a);t.append(e),d.append(t)}}}),d.setAttribute("data-testid","show-diff-deleted-decoration");let p=M(r,e.fromB,s);return[i("ftzrq").Decoration.widget(p,d)]},es=e=>!!e,el=e=>e.map(e=>{if(e instanceof i("aXG5V").AddMarkStep||e instanceof i("aXG5V").RemoveMarkStep)return{fromB:e.from,toB:e.to}}).filter(es),ec=(e,t,n,i)=>{let a=[];return e.nodesBetween(t,n,(e,t)=>{e.isBlock&&a.push(er({from:t,to:t+e.nodeSize,name:e.type.name},i))}),a},ed=(0,i("2XqLN").default)(({state:e,pluginState:t,nodeViewSerializer:n,colourScheme:a,intl:r})=>{let{originalDoc:o,steps:c}=t;if(!o||!t.isDisplayingChanges)return i("ftzrq").DecorationSet.empty;let{tr:d}=e,p=o,u=[],g=((0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")?function(e,t){let n=[],a=t;for(let t of e){let e=t.apply(a);null===e.failed&&e.doc&&!(0,i("2pjJ5").areNodesEqualIgnoreAttrs)(a,e.doc,["localId"])&&(n.push(t),a=e.doc)}return n}(c,o):c).filter(e=>!(e instanceof i("jy7VG").AnalyticsStep)).reduce((e,t)=>{let n=e[e.length-1],a=(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")?n?.merge?.(t)??function(e,t){if(!(e instanceof i("aXG5V").ReplaceStep)||!(t instanceof i("aXG5V").ReplaceStep))return null;let n=t.to-t.from;return e.from===t.from&&t.to>=e.to&&t.slice.size>=n&&n===e.slice.size&&t.slice.size>=e.slice.size&&e.slice.openEnd===t.slice.openEnd&&e.slice.openStart===t.slice.openStart?new(0,i("aXG5V").ReplaceStep)(e.from,e.to,t.slice):null}(n,t):n?.merge?.(t);return a?e[e.length-1]=a:e.push(t),e},[]),m=[];for(let e of g){let t=e.apply(p);null===t.failed&&t.doc&&(l(e,p,t.doc)&&u.push(e),m.push(e.getMap()),p=t.doc)}if(!(0,i("2pjJ5").areNodesEqualIgnoreAttrs)(p,d.doc))return i("ftzrq").DecorationSet.empty;let f=i("6rMOj").ChangeSet.create(o).addSteps(p,m,d.doc),h=function(e){if(e.length<=1)return e;let t=[],n={...e[0]};for(let i=1;i<e.length;i++){let a=e[i];a.fromB<=n.toB+2?n={fromA:n.fromA,toA:Math.max(n.toA,a.toA),fromB:n.fromB,toB:Math.max(n.toB,a.toB),deleted:[...n.deleted,...a.deleted],inserted:[...n.inserted,...a.inserted]}:(t.push(n),n={...a})}return t.push(n),t}((0,i("6rMOj").simplifyChanges)(f.changes,d.doc)),_=[];return h.forEach(e=>{if(e.inserted.length>0&&(_.push(j(e,a)),_.push(...ec(d.doc,e.fromB,e.toB,a))),e.deleted.length>0){let t=eo({change:e,doc:o,nodeViewSerializer:n,colourScheme:a,newDoc:d.doc,intl:r});t&&_.push(...t)}}),el(c).forEach(e=>{_.push(j(e,a))}),s(d.doc,u).forEach(e=>{_.push(...ec(d.doc,e.fromB,e.toB,a))}),i("ftzrq").DecorationSet.empty.add(d.doc,_)},([{pluginState:t,state:n,colourScheme:i,intl:r}],[{pluginState:o,state:s,colourScheme:l,intl:c}])=>(o.originalDoc&&t.originalDoc&&t.originalDoc.eq(o.originalDoc)&&e(a)(t.steps,o.steps)&&n.doc.eq(s.doc)&&i===l&&r.locale===c.locale)??!1);class ep{init(e){this.serializer=i("5SAOw").DOMSerializer.fromSchema(e.editorView.state.schema),void 0!==e.editorView.nodeViews&&(this.editorView=e.editorView);let t=e.editorView?.nodeViews||{};this.nodeViews=t??this.editorView?.nodeViews??{}}appendChildNodes(e,t){e.forEach(e=>{let n=this.tryCreateNodeView(e)||this.serializeNode(e);n&&t?.append(n)})}tryCreateNodeView(e){if(!this.editorView)return null;let t=this.nodeViews?.[e.type.name];if(this.nodeViewBlocklist.has(e.type.name))return null;try{if(!t){if(e.isInline)return null;let t=e.type.spec.toDOM?.(e);if(!t)return null;let{dom:n,contentDOM:a}=i("5SAOw").DOMSerializer.renderSpec(document,t);if(n instanceof HTMLElement){if("paragraph"===e.type.name&&1===e.children.length)return this.serializeFragment(e.content);this.appendChildNodes(e.children,a)}return n}let{dom:n,contentDOM:a}=t(e,this.editorView,()=>0,[],{});return this.appendChildNodes(e.children,a),n}catch(e){return null}}serializeNode(e){if(!this.serializer)throw Error("NodeViewSerializer must be initialized with init() before use");try{return this.serializer.serializeNode(e)}catch(e){return null}}serializeFragment(e){if(!this.serializer)throw Error("NodeViewSerializer must be initialized with init() before use");try{return this.serializer.serializeFragment(e)}catch(e){return null}}getNodeViewBlocklist(){return new Set(this.nodeViewBlocklist)}getFilteredNodeViewBlocklist(e){let t=new Set(this.nodeViewBlocklist);return e.forEach(e=>t.delete(e)),t}constructor(e){this.editorView=void 0,this.serializer=void 0,this.nodeViews=void 0,this.nodeViewBlocklist=void 0,e?.editorView&&this.init({editorView:e.editorView}),this.nodeViewBlocklist=new Set(e.blocklist??["paragraph"])}}let eu=new(0,i("ks2lK").PluginKey)("showDiffPlugin"),eg=(e,t)=>{let n=new ep({}),a=e=>{n.init({editorView:e})};return new(0,i("1S4f7").SafePlugin)({key:eu,state:{init:(e,t)=>({steps:[],originalDoc:void 0,decorations:i("ftzrq").DecorationSet.empty,isDisplayingChanges:!1}),apply:(a,r,o,s)=>{let l=a.getMeta(eu),c=r;if(l)if(l?.action==="SHOW_DIFF"){let i=ed({state:s,pluginState:c={...r,...l,isDisplayingChanges:!0},nodeViewSerializer:n,colourScheme:e?.colourScheme,intl:t()});c.decorations=i}else c=l?.action==="HIDE_DIFF"?{...r,...l,decorations:i("ftzrq").DecorationSet.empty,isDisplayingChanges:!1}:{...r,...l};return{...c,decorations:c.decorations.map(a.mapping,a.doc)}}},view(t){a(t);let n=!0;return{update(t){e?.originalDoc&&e?.steps&&e.steps.length>0&&n&&(n=!1,t.dispatch(t.state.tr.setMeta(eu,{action:"SHOW_DIFF",steps:e.steps.map(e=>i("cO9ey").Step.fromJSON(t.state.schema,e)),originalDoc:(0,i("6tl2G").processRawValue)(t.state.schema,e.originalDoc)})))}}},props:{decorations:e=>{let t=eu.getState(e);return t?.decorations}}})};t.exports.showDiffPlugin=({api:e,config:t})=>({name:"showDiff",commands:{showDiff:e=>({tr:t})=>t.setMeta(eu,{...e,action:"SHOW_DIFF"}),hideDiff:({tr:e})=>e.setMeta(eu,{steps:[],action:"HIDE_DIFF"})},pmPlugins:()=>[{name:"showDiffPlugin",plugin:({getIntl:e})=>eg(t,e)}],getSharedState:e=>{if(!e)return{isDisplayingChanges:!1};let t=eu.getState(e);return{isDisplayingChanges:(t?.decorations?.find()||[]).length>0}}})}),a("aB4bz",function(t,n){var a,r=i("l998X");i("42omo");class o{constructor(e,t,n){this.step=e,this.inverted=t,this.allocation=n}}var s=((a={}).TOGGLE_TRACK_CHANGES="TOGGLE_TRACK_CHANGES",a.RESET_BASELINE="RESET_BASELINE",a);let l=new(0,i("ks2lK").PluginKey)("trackChangesPlugin"),c=(e,t)=>{try{for(let n of t.filter(e=>!(e.step instanceof i("aXG5V").AttrStep)).slice().reverse()){let t=n.inverted.apply(e);null===t.failed&&t.doc&&(e=t.doc)}return e}catch(e){return}},d=e=>{let t=!1;return new(0,i("1S4f7").SafePlugin)({key:l,state:{init:()=>({steps:[],shouldChangesBeDisplayed:!1,isShowDiffAvailable:!1,allocations:new Set}),apply(n,a){let r=n.getMeta(l);if(r&&r.action===s.RESET_BASELINE)return{...a,steps:[],isShowDiffAvailable:!1};if(r&&r.action===s.TOGGLE_TRACK_CHANGES)return t=!0,{...a,shouldChangesBeDisplayed:!a.shouldChangesBeDisplayed};if(!(n.docChanged&&n.steps.some(e=>e instanceof i("aXG5V").ReplaceStep||e instanceof i("aXG5V").ReplaceAroundStep||e instanceof i("aXG5V").AddMarkStep||e instanceof i("aXG5V").RemoveMarkStep||e instanceof i("aXG5V").AttrStep))||n.getMeta("isRemote")||n.getMeta("replaceDocument")||n.steps.some(e=>e instanceof i("aXG5V").AddMarkStep&&"annotation"===e.mark.type.name))return{...a,steps:a.steps.map(e=>{let t=e.step.map(n.mapping),i=e.inverted.map(n.mapping);if(t&&i)return new o(t,i,e.allocation)}).filter(e=>!!e)};let d=e?.history?.sharedState.currentState(),p=d?d.done.eventCount+d.undone.eventCount:(a.steps.at(-1)?.allocation??0)+1,u=n.steps.map((e,t)=>new o(e,e.invert(n.docs[t]),p)),g=t?u:[...a.steps,...u];t=!1;let{allocations:m,steps:f}=function(e,t){if(t.size<=10)return{steps:e,allocations:t};let n=new Set(Array.from(t).slice(-10)),i=[],a=!1;for(let t of e)n.has(t.allocation)&&(a=!0),a&&i.push(t);return{steps:i,allocations:n}}(g,a.allocations.add(p)),h=c(n.doc,f),_=!!h&&!n.doc.eq(h);return{...a,allocations:m,steps:f,shouldChangesBeDisplayed:!1,isShowDiffAvailable:_}}},view:()=>({update(t,n){let i=l.getState(n)?.shouldChangesBeDisplayed,a=l.getState(t.state),r=a?.shouldChangesBeDisplayed;if(!1===i&&!0===r){let n=a?.steps??[],i=c(t.state.doc,n);i&&e?.core?.actions.execute(e?.showDiff?.commands?.showDiff({originalDoc:i,steps:n.map(e=>e.step)}))}else!1===r&&!0===i&&e?.core?.actions.execute(e?.showDiff?.commands?.hideDiff)}})})};i("42omo");var p=i("42omo");let u=({api:t,wrapper:n})=>{let a=!!t?.toolbar,{isDisplayingChanges:o,isShowDiffAvailable:s}=(0,i("eiA8Z").useSharedPluginStateWithSelector)(t,["trackChanges"],e=>({isDisplayingChanges:e.trackChangesState?.isDisplayingChanges,isShowDiffAvailable:e.trackChangesState?.isShowDiffAvailable})),{formatMessage:l}=(0,i("8C5kA").default)(),c=e(p).useCallback(()=>{t?.core.actions.execute(t?.trackChanges?.commands.toggleChanges)&&o&&t?.core.actions.focus()},[t,o]);if(!a)return(0,r.jsx)(i("iIVVb").ToolbarTooltip,{content:l(i("808tb").trackChangesMessages.toolbarIconLabel),children:(0,r.jsx)(i("1qfLF").default,{icon:e(i("fi2El")),label:l(i("808tb").trackChangesMessages.toolbarIconLabel),appearance:"subtle",isDisabled:!s,isSelected:o,onClick:c})});let d=(0,r.jsx)(i("iIVVb").ToolbarTooltip,{content:l(i("808tb").trackChangesMessages.toolbarIconLabel),children:(0,r.jsx)(i("7ERUE").ToolbarButton,{iconBefore:(0,r.jsx)(e(i("fi2El")),{label:l(i("808tb").trackChangesMessages.toolbarIconLabel),size:"small"}),onClick:c,isDisabled:!s,isSelected:o})});return n?(0,r.jsx)(n,{children:d}):d},g=(e,t)=>[...(0,i("dh538").fg)("platform_editor_toolbar_aifc_undo_redo_confluence")?[]:[{type:i("cPCP8").TRACK_CHANGES_SECTION.type,key:i("cPCP8").TRACK_CHANGES_SECTION.key,parents:[{type:"toolbar",key:i("cPCP8").TOOLBARS.PRIMARY_TOOLBAR,rank:i("4Chin").TOOLBAR_RANK[i("cPCP8").TRACK_CHANGES_SECTION.key]}]}],{type:i("cPCP8").TRACK_CHANGES_GROUP.type,key:i("cPCP8").TRACK_CHANGES_GROUP.key,parents:[{type:i("cPCP8").TRACK_CHANGES_SECTION.type,key:i("cPCP8").TRACK_CHANGES_SECTION.key,rank:i("4Chin").TRACK_CHANGES_SECTION_RANK[i("cPCP8").TRACK_CHANGES_GROUP.key]}]},{type:i("cPCP8").TRACK_CHANGES_BUTTON.type,key:i("cPCP8").TRACK_CHANGES_BUTTON.key,parents:[{type:i("cPCP8").TRACK_CHANGES_GROUP.type,key:i("cPCP8").TRACK_CHANGES_GROUP.key,rank:i("4Chin").TRACK_CHANGES_GROUP_RANK[i("cPCP8").TRACK_CHANGES_BUTTON.key]}],component:()=>(0,r.jsx)(u,{api:e,wrapper:t?.ButtonWrapper})}];t.exports.trackChangesPlugin=({api:e,config:t})=>{let n=!!e?.toolbar;return t?.showOnToolbar===!0&&(n?e?.toolbar?.actions.registerComponents(g(e,t)):e?.primaryToolbar?.actions?.registerComponent({name:"trackChanges",component:()=>(0,r.jsx)(u,{api:e})})),{name:"trackChanges",pmPlugins:()=>[{name:"trackChangesPlugin",plugin:()=>d(e)}],commands:{toggleChanges:({tr:e})=>e.setMeta(l,{action:s.TOGGLE_TRACK_CHANGES}),resetBaseline:({tr:t})=>e?.trackChanges?.sharedState.currentState()?.isShowDiffAvailable?t.setMeta(l,{action:s.RESET_BASELINE}):null},getSharedState:e=>e?{isDisplayingChanges:!!l.getState(e)?.shouldChangesBeDisplayed,isShowDiffAvailable:!!l.getState(e)?.isShowDiffAvailable}:{isDisplayingChanges:!1,isShowDiffAvailable:!1}}}}),a("4DEL1",function(t,n){var a,r,o,s,l,c,d,p,u,g=i("42omo"),m=i("iu6m9");let f=new(0,i("ks2lK").PluginKey)("aiSessionContext"),h=({invokedFrom:e,aiOptIn:t,configItem:n,editorView:a,triggeredFor:r,isExternal:o=!1,withAcceptReject:s=!0,withStreamingHighlight:l=!0,hideLoadingScreen:c=!1})=>{a&&(0,i("5SuLc").createOpenAIModalCommand)({state:a.state,configItem:n,lastTriggeredFrom:e,aiGlobalOptIn:t,triggeredFor:r,isExternal:o,withAcceptReject:s,withStreamingHighlight:l,hideLoadingScreen:c})(a.state,a.dispatch)},_=({editorView:e})=>{e&&(0,i("5SuLc").createEndAIExperienceCommand)()(e.state,e.dispatch)},y=({editorView:e,sessionId:t})=>{if(e)return(0,i("5SuLc").createStartAISessionCommand)(t)(e.state,e.dispatch)},I=({editorView:e,sessionId:t})=>{if(e)return(0,i("kqrrC").createCommand)(e=>t===(0,i("kqrrC").getPluginState)(e).nextSessionId&&{type:"END_SESSION",data:{sessionId:void 0}},e=>((0,i("dh538").fg)("platform_editor_ai_migrate_from_xstate")&&e.setMeta(f,{type:"RESET"}),e))(e.state,e.dispatch)},E=({editorView:e,targetId:t})=>{if(e)return(0,i("5SuLc").createUpdateTargetIdCommand)(t)(e.state,e.dispatch)},S=({selection:e,maxSize:t=1e4})=>{if(!e)return;let{$from:n,$to:i}=e,a=n.doc,r=0;for(;!isNaN(n.start(r))&&!isNaN(i.end(r));){let e=n.start(r);if(i.end(r)-e<t)break;r++}if(0===r)return a;let o=r-1,s=n.index(o),l=n.start(r),c=i.end(r),d=1,p=n.node(o).childCount;for(;s-d>=0||s+d<=p;){let e=n.posAtIndex(Math.max(s-d,0),o),a=i.posAtIndex(Math.min(s+d+1,p),o),r=!1;if(c-e<t&&(l=e,r=!0),a-l<t&&(c=a,r=!0),!r)break;d++}return a.cut(l,c)},b=e=>{let t=new(0,i("h9yJL").JSONTransformer),n=S(e);if(n)return t.encode(n)},T=e=>{let t=S(e);if(t)return(0,i("6eZqW").convertProsemirrorNodeToMarkdown)({node:t})?.markdown??""},C={isWatching:!1,watchFrom:void 0,watchTo:void 0,startingAnnotationIds:void 0},A=e=>new(0,i("1S4f7").SafePlugin)({key:i("3tFte").aiAnnotationWatchmenPluginKey,state:{init:()=>C,apply:(t,n,a,r)=>{if(!e.onAnnotationsAdded&&!e.onAnnotationsRemoved&&!e.onAnnotationsChanged)return n;let o=t.getMeta(i("3tFte").aiAnnotationWatchmenPluginKey),{isWatching:s,watchFrom:l,watchTo:c,startingAnnotationIds:d}=n;switch(o?.action){case i("9OCYt").ACTIONS.START_WATCHING_REGION:{let{from:e,to:a}=o;if(void 0===e||void 0===a)return n;let s=t.mapping.map(e,-1),l=t.mapping.map(a,1),c=(0,i("bYZ53").getAnnotationIdsFromRange)({from:s,to:l},t.doc,r.schema);return{isWatching:!0,watchFrom:s,watchTo:l,startingAnnotationIds:c}}case i("9OCYt").ACTIONS.END_WATCHING_REGION:{if(void 0===l||void 0===c)return n;let a=(0,i("bYZ53").getAnnotationIdsFromRange)({from:t.mapping.map(l,-1),to:t.mapping.map(c,1)},t.doc,r.schema),o=d?.filter(e=>!a.includes(e))??[],s=a.filter(e=>!d?.includes(e))??[];if(e.onAnnotationsRemoved&&o?.length&&e.onAnnotationsRemoved(o),e.onAnnotationsAdded&&s?.length&&e.onAnnotationsAdded(s),e.onAnnotationsChanged&&(o?.length||s?.length)){let t=o.map(e=>({annotationId:e,type:"REMOVED"})).concat(s.map(e=>({annotationId:e,type:"ADDED"})));e.onAnnotationsChanged(t)}return{isWatching:!1,watchFrom:void 0,watchTo:void 0,startingAnnotationIds:void 0}}}return{isWatching:s,startingAnnotationIds:d,watchFrom:void 0!==l?t.mapping.map(l,-1):void 0,watchTo:void 0!==c?t.mapping.map(c,1):void 0}}}}),v=new(0,i("ks2lK").PluginKey)("aiAuditLogs"),P=e=>t=>({"ai-generated-content-inserted":{eventStatus:"not-sent",retries:0},"aup-violation":{eventStatus:"not-sent",retries:0},maxRetries:2,retryDelay:2e3,eventData:e}),{createPluginState:k,createCommand:x,getPluginState:w}=(0,i("lkJUe").pluginFactory)(v,function(e,t){return"UPDATE_PLUGIN_STATE"===t.type?{...e,"ai-generated-content-inserted":{...e["ai-generated-content-inserted"],...t.data["ai-generated-content-inserted"]},"aup-violation":{...e["aup-violation"],...t.data["aup-violation"]}}:e},{onDocChanged:function(e,t){let n=t["ai-generated-content-inserted"];return"not-sent"===n.eventStatus&&e.getMeta("isAiContentTransformation")?{...t,"ai-generated-content-inserted":{...n,eventStatus:"send-event"}}:t}});async function M(e,t){let n=w(t.state),{eventData:a,retryDelay:r}=n,o=n[e],s="page"===a.type?a.pageId:a.issueId;function l(){o.retries<n.maxRetries&&setTimeout(()=>{M(e,t)},r)}N({[e]:{retries:o.retries+1}})(t.state,t.dispatch);try{(await fetch(i("klIiV").convoAIAuditLogApiURL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:e,ai_feature_input:{entityId:s}})})).ok?N({[e]:{eventStatus:"event-sent"}})(t.state,t.dispatch):l()}catch(e){l()}}let N=e=>x(t=>({type:"UPDATE_PLUGIN_STATE",data:e}),e=>e.setMeta("addToHistory",!1)),O=["ai-generated-content-inserted","aup-violation"],R=e=>{let{dispatch:t,eventData:n}=e;return new(0,i("1S4f7").SafePlugin)({key:v,state:k(t,P(n)),view:e=>({update:e=>{let t=w(e.state);O.forEach(n=>{"send-event"===t[n].eventStatus&&(N({[n]:{eventStatus:"event-in-progress"}})(e.state,e.dispatch),M(n,e))})}})})};var D=i("8m4tT");let L=new(0,i("ks2lK").PluginKey)("aiExperienceAIButton"),F=()=>new(0,i("1S4f7").SafePlugin)({key:L,state:{init:(e,t)=>({isSelectionValidForAIExperience:!0}),apply:(e,t,n,a)=>{if(e.selectionSet){let t=e.selection,{$from:n}=t,r=n.parent,{codeBlock:o,tableHeader:s,tableCell:l,tabeRow:c,table:d}=a.schema.nodes,p=t instanceof i("ks2lK").NodeSelection,u=r.type===o,g=[s,l,c,d].includes(r.type),m=!0;(u||p||g)&&(m=!1);let f={isSelectionValidForAIExperience:m},h=(()=>{let e=(0,i("jdR93").getSupportedNodesForAIModal)(a);if(p)return e.has(t.node.type)?t.node:void 0;{let n=(0,D.findParentNode)(t=>e.has(t.type))(t);return n?.node}})(),{from:_,to:y}=t;if((_===y||p||g)&&h){let e=t instanceof i("ks2lK").TextSelection;f={isSelectionValidForAIExperience:!u&&(e||!!h),triggeredFor:h?.type}}return f}return t}}}),G=new(0,i("ks2lK").PluginKey)("aiEventHub"),B={SuggestTitleConfluenceTitleToolbar:"suggest title in confluence title toolbar",SuggestTitle:"suggest title",DraftReply:"draft reply",GenerateEscalationNotes:"generate escalation notes",IncidentSmartComments:"incident smart comments",CustomPrompt:"custom prompt",IssueReformatter:"issue reformatter",DescriptionCompleter:"description completer",Summarize:"summarize",ImproveWriting:"improve writing",MakeShorter:"make shorter",FixSpellingGrammar:"fix spelling and grammar",ChangeToneToProfessional:"change tone to professional",ChangeToneToNeutral:"change tone to neutral",ChangeToneToEmpathetic:"change tone to empathetic",ChangeToneToCasual:"change tone to casual",ChangeToneToEducational:"change tone to educational",DraftReplyPill:"draft reply pill"},U=({editorView:e,dispatch:t,prompt:n,adjustSelection:a,promptText:r})=>{t((0,i("4SGh1").addAnalytics)({editorState:e.state,tr:e.state.tr,payload:{action:"error",actionSubject:"editorPluginAI",actionSubjectId:"eventHubPlugin",attributes:{errorType:"promptConfigItemNotFound",prompt:n,promptText:r,adjustSelection:a},eventType:i("d925B").EVENT_TYPE.OPERATIONAL}}))};function V({api:e,analyticSourceId:t,additionalAttributes:n}){e?.analytics?.actions.fireAnalyticsEvent({action:"streamingCompleted",actionSubject:"editorPluginAI",actionSubjectId:"eventHubPlugin",attributes:{promptType:i("bwpRs").CONFIG_ITEM_KEYS.SUGGEST_A_TITLE,modalHidden:!0,analyticSourceId:t,...n},eventType:i("d925B").EVENT_TYPE.TRACK})}let j=({api:e,analyticSourceId:t,isDateTimeFormat:n})=>{V({api:e,analyticSourceId:t,additionalAttributes:{fallbackSuggestedTitleReturned:!0,isDateTimeFormat:n}})};async function H(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}let z=e=>e.key===i("bwpRs").CONFIG_ITEM_KEYS.SUGGEST_A_TITLE,K=async({api:e,analyticSourceId:t,suggestedTitle:n})=>{V({api:e,analyticSourceId:t,additionalAttributes:{fallbackSuggestedTitleReturned:!1,suggestedTitleFingerprint:await H(n)}})};function W({isEmpty:e,configItem:t}){return t?(e?t.actions.empty:t.actions.selection)??[]:[]}function q({configItemWithOptions:e,editorView:t,positions:n,isEmpty:i}){let a=[];return e.forEach(e=>{e&&function({editorView:e,positions:t,isEmpty:n,item:i}){let{triggers:a}=i,r=e.state.doc.nodeSize-4,o=t[1]-t[0];if(a.canShow&&!a.canShow({editorView:e,docSize:r,selectionSize:o}))return!1;let s=a.empty,l=s.enabled,c=s.docMinSize??0,d=s.docMaxSize??Number.MAX_SAFE_INTEGER,p=a.selection,u=p.enabled,g=p.selectionMinSize??1,m=p.selectionMaxSize??Number.MAX_SAFE_INTEGER;if(n){if(!l||r<c||r>d)return!1}else if(!u||o<g||o>m)return!1;return!0}({editorView:t,positions:n,isEmpty:i,item:e})&&a.push(e.config)}),a}function Y({configItemWithOptions:e}){let t=[];return e.forEach(e=>{e&&t.push(e.config)}),t}function $(e,t){return e.agent?`@${e.agent.name}`||t(e.title):(e.key.startsWith("Translate to"),t(e.title))}function J(e,t){return!e.silentAgentPrompt&&e.agent?`@${e.agent.name}`:e.promptLabel?t(e.promptLabel):void 0}let Q=(e,t,n)=>n===i("bwpRs").CONFIG_ITEM_KEYS.FREE_GENERATE?e.baseGenerate:Y({configItemWithOptions:e.configItemWithOptions}).find(e=>e.key===n),X=e=>{switch(e){case"fullDocument":case"keepCurrent":return"rangeConfig";default:return"emptyConfig"}},Z=(e,t,n,a)=>{switch(e){case B.SuggestTitleConfluenceTitleToolbar:return(0,i("70Lwl").suggestTitleForConfluenceTitleToolbar)();case B.SuggestTitle:return Q(t,X(n),i("bwpRs").CONFIG_ITEM_KEYS.SUGGEST_A_TITLE);case B.DraftReply:return Q(t,X(n),i("bwpRs").CONFIG_ITEM_KEYS.SUGGEST_RESPONSE);case B.GenerateEscalationNotes:return Q(t,X(n),i("bwpRs").CONFIG_ITEM_KEYS.GENERATE_ESCALATION_NOTES);case B.IncidentSmartComments:return ea(Q(t,X(n),i("bwpRs").CONFIG_ITEM_KEYS.INCIDENT_SMART_COMMENTS),a);case B.CustomPrompt:return Q(t,X(n),i("bwpRs").CONFIG_ITEM_KEYS.FREE_GENERATE);case B.IssueReformatter:return et(Q(t,"rangeConfig",i("bwpRs").CONFIG_ITEM_KEYS.ADD_STRUCTURE),a);case B.DescriptionCompleter:return en(Q(t,"rangeConfig",i("bwpRs").CONFIG_ITEM_KEYS.ADD_STRUCTURE),a);case B.DraftReplyPill:return ei(Q(t,"rangeConfig",i("bwpRs").CONFIG_ITEM_KEYS.SUGGEST_RESPONSE),a);case B.Summarize:return Q(t,X(n),i("bwpRs").CONFIG_ITEM_KEYS.SUMMARISE_WRITING);case B.ImproveWriting:return Q(t,X(n),i("bwpRs").CONFIG_ITEM_KEYS.IMPROVE_WRITING);case B.MakeShorter:return Q(t,X(n),i("bwpRs").CONFIG_ITEM_KEYS.MAKE_SHORTER);case B.FixSpellingGrammar:return Q(t,X(n),i("bwpRs").CONFIG_ITEM_KEYS.FIX_SPELLING_AND_GRAMMAR);case B.ChangeToneToProfessional:return Q(t,X(n),i("bwpRs").CONFIG_ITEM_KEYS.CHANGE_TONE_TO_PROFESSIONAL);case B.ChangeToneToNeutral:return Q(t,X(n),i("bwpRs").CONFIG_ITEM_KEYS.CHANGE_TONE_TO_NEUTRAL);case B.ChangeToneToEmpathetic:return Q(t,X(n),i("bwpRs").CONFIG_ITEM_KEYS.CHANGE_TONE_TO_EMPATHETIC);case B.ChangeToneToCasual:return Q(t,X(n),i("bwpRs").CONFIG_ITEM_KEYS.CHANGE_TONE_TO_CASUAL);case B.ChangeToneToEducational:return Q(t,X(n),i("bwpRs").CONFIG_ITEM_KEYS.CHANGE_TONE_TO_EDUCATIONAL);default:return}},ee=(e,t)=>e?.key===i("bwpRs").CONFIG_ITEM_KEYS.SUGGEST_A_TITLE&&""===t.state.doc.textContent.trim(),et=(e,t)=>e?.getRequestPayload&&t?.feature==="proactive-improve-description"?{...e,experienceId:"jira-work-completer",getRequestPayload:(...n)=>{let i=e.getRequestPayload?.(...n)||{};if(i.agent_input_context){let e={...i?.agent_input_context,...t};return{...i,agent_input_context:e}}return i}}:e?.getRequestPayload&&t?.feature==="issue-reformatter"&&(0,i("dh538").fg)("jira-work-sync-desc-comment-summary-ga")?{...e,getRequestPayload:(...n)=>{let i=e.getRequestPayload?.(...n)||{},a=i?.ai_feature_input,r=a?.context;return{ai_feature_input:{...a,context:{...r,description:t?.additionalInfo}}}}}:e,en=(e,t)=>{if(e?.getRequestPayload){let{source:n}=t||{};return{...e,endpoint:"/gateway/api/assist/ai/v2/ai-feature/jira/issue/source-type/link/suggestions/stream",experienceId:"GOOGLE_DOC_LINK"===n?"ai-issue-create-google-doc-single":"jira-work-completer",getRequestPayload:n=>{let{context:i,source:a}=t||{},{ai_feature_input:r}=e.getRequestPayload?.(n)??{},{context:o,...s}=r??{},{summary:l,description:c}=o;return{ai_feature_input:{...s,source:a,context:{...i,additional_context:{issue_summary:l,issue_description:c}}}}}}}},ei=(e,t)=>{if(e?.getRequestPayload)return{...e,featureId:"brainstorm",endpoint:"/gateway/api/firebolt/1/agent-response/generate",getRequestPayload:n=>{let i=t||{},{userText:a}=e.getRequestPayload?.(n)??{userText:n?.selection||n?.doc};return{...i,...t?.category==="ENHANCE_REPLY"?{userText:a}:{}}}}},ea=(e,t)=>e?.getRequestPayload?{...e,getRequestPayload:n=>({...e.getRequestPayload?.(n)||{},intent:t?.replyIntent||"REQUEST_MORE_INFO",isExternal:t?.isExternal})}:e;var er=i("cUcZ5"),eo=i("jSnXV");let es={},el=e=>{for(let[t,n]of Object.entries(e))void 0===es[t]?es[t]=n:es[t]=Math.max(es[t],n)},ec=e(eo)((e,t)=>{let n=(0,i("4SGh1").addAnalytics)({editorState:e.state,tr:e.state.tr,payload:{action:"nonErrorFallback",actionSubject:"editorPluginAI",actionSubjectId:"markdownSerializer",attributes:{aiSessionId:t,nonErrorFallbackState:es},eventType:i("d925B").EVENT_TYPE.OPERATIONAL}});n.setMeta("addToHistory",!1),e.dispatch(n),es={}},500),ed=()=>!!(0,i("dh538").fg)("platform_editor_ai_markdown_plus_add_complex_nodes")&&!!(0,i("dh538").fg)("platform_editor_ai_proactive_ai_nudge");function ep({markdown:e,schema:t,source:n,fireAIAnalyticsEvent:a,idMap:r}){try{let{pmFragment:n,htmlConvertedToFallbackNodes:o,htmlConvertedToNodes:s,unclosedTokens:l,markdownPlusAttributeStatus:c}=(0,i("hAuc5").convertMarkdownToProsemirror)({schema:t,markdown:e,idMap:r,featureToggles:{markdownPlus:!0,markdownPlusExtensions:!0,markdownPlusPanels:!0,markdownPlusDecisions:!0,markdownPlusAttributeTest:(0,i("dh538").fg)("platform_editor_ai_markdown_plus_attr_test"),markdownPlusMentions:(0,i("dh538").fg)("platform_editor_ai_draft_reply_mentions"),markdownPlusAddComplexNodes:ed(),markdownPlusRemoveUnclosedTokens:(0,i("dh538").fg)("platform_editor_ai_remove_unclosed_tokens"),markdownPlusUseNextMediaPlugin:(0,i("dh538").fg)("platform_editor_ai_next_media_plugin"),allowAttributesMatchDefault:!0}});return c.length>0&&(0,i("dh538").fg)("platform_editor_ai_markdown_plus_attr_test")&&c.forEach(e=>{a({payload:{action:"validateAttributes",actionSubject:"editorPluginAI",actionSubjectId:"markdownPlusAttributes",attributes:{attributesMatch:e[1],nodeType:e[0]},eventType:i("d925B").EVENT_TYPE.OPERATIONAL}})}),{pmFragment:n,unclosedTokens:l,htmlConvertedToFallbackNodes:o,htmlConvertedToNodes:s,isTextFallbackUsed:!1}}catch(r){return a({payload:{action:"failed",actionSubject:"editorPluginAI",actionSubjectId:"markdownParser",attributes:{source:n,errorType:"markdownParser",errorMessage:i("2QlXt").ErrorUtils.extractErrorMessage(r)},eventType:i("d925B").EVENT_TYPE.OPERATIONAL}}),{pmFragment:i("5SAOw").Fragment.from(t.nodes.paragraph.create(null,t.text(e))),unclosedTokens:{},htmlConvertedToFallbackNodes:0,htmlConvertedToNodes:0,isTextFallbackUsed:!0}}}let eu=({editorView:e,slice:t,node:n})=>{if(n?(n.content?.size||0)>2:!!t&&t.size>=1)if(t?.content?.eq?.(e.state.doc.content)||n?.eq?.(e.state.doc))return"fullDocument";else return"partialSelection";return"none"};function eg({slice:e,node:t,editorView:n,convertTo:a,existingIdMap:r,updateIdMap:o,mentionMap:s,aiSessionId:l}){let c=(e||t).content;try{let d=eu({editorView:n,slice:e,node:t});if("markdown-plus"===a){let{markdown:e,idMap:t,contentStatistics:a,fallbackState:p,nonErrorFallbackState:u}=(0,i("6eZqW").convertProsemirrorToMarkdown)({editorView:n,fragment:c,featureToggles:{markdownPlus:!0,markdownPlusExtensions:!0,markdownPlusPanels:!0,markdownPlusDecisions:!0,markdownPlusAttributeTest:(0,i("dh538").fg)("platform_editor_ai_markdown_plus_attr_test"),markdownPlusMentions:(0,i("dh538").fg)("platform_editor_ai_draft_reply_mentions"),markdownPlusAddComplexNodes:ed(),markdownPlusUseNextMediaPlugin:(0,i("dh538").fg)("platform_editor_ai_next_media_plugin"),allowAttributesMatchDefault:!0},mentionMap:s,idMap:r});if(Object.keys(u).length&&l&&(el(u),ec(n,l)),Object.keys(p).length){let e=(0,i("4SGh1").addAnalytics)({editorState:n.state,tr:n.state.tr,payload:{action:"fallback",actionSubject:"editorPluginAI",actionSubjectId:"markdownSerializer",attributes:{fallbackState:p},eventType:i("d925B").EVENT_TYPE.OPERATIONAL}});e.setMeta("addToHistory",!1),n.dispatch(e)}return o({idMap:t}),{idMap:t,markdown:e,contentStatistics:{...a,contextSelectionScope:d}}}let{markdown:p,idMap:u,contentStatistics:g}=(0,i("6eZqW").convertProsemirrorToMarkdown)({editorView:n,fragment:c,featureToggles:{},mentionMap:s,idMap:r});return{idMap:u,markdown:p,contentStatistics:{...g,contextSelectionScope:d}}}catch(t){let e=(0,i("4SGh1").addAnalytics)({editorState:n.state,tr:n.state.tr,payload:{action:"failed",actionSubject:"editorPluginAI",actionSubjectId:"markdownSerializer",attributes:{errorType:"markdownSerializer",errorMessage:i("2QlXt").ErrorUtils.extractErrorMessage(t)},eventType:i("d925B").EVENT_TYPE.OPERATIONAL}});return n.dispatch(e),{idMap:{},markdown:"",contentStatistics:void 0}}}let em={blockquote:"BLOCKQUOTES",paragraph:"PARAGRAPH",rule:"HORIZONTAL_RULE",heading:"HEADING",hardbreak:"HARD_LINE_BREAK",codeBlock:"CODEBLOCKS",bulletList:"BULLET_LISTS",orderedList:"NUMBERED_LISTS",media:"IMAGES",table:"TABLE",taskList:"TASK_LIST",code:"CODE_SPAN",em:"ITALICS",strong:"BOLD",link:"LINK",strike:"STRIKETHROUGH"},ef=e=>e?.nodes||e?.marks?[...Object.keys(e.nodes),...Object.keys(e.marks)].map(e=>em[e]).filter(Boolean):[],eh=({product:e,objectId:t,cloudId:n})=>`ari:cloud:${e.toLowerCase()}:${n}:content/${t}`,e_=({context:e,configItem:t,mentionMap:n,updateIdMap:a,callback:r})=>{let o,s,l,c,{aiProvider:d,userInput:p,editorView:u,positions:g,intl:m,latestPromptResponse:f}=e,h=u.state.schema,{product:_,objectId:y,getChannelVariables:I}=d,E=I?.("rovo-agent")?.cloudId;void 0!==y&&void 0!==E&&(o=eh({product:_,objectId:y,cloudId:E}));let S=t.featureId;if(!S)return{error:`Unknown feature id: ${t.intentSchemaId}`,endpoint:t.endpoint||i("klIiV").convoAIApiUrl};let{experienceId:b,endpoint:T}=t,C=e.analyticsContext?.aiSessionId,A=e.isEmpty,v=!e.isEmpty;t.alwaysNoDocAndSelection?(A=!1,v=!1):t.alwaysNeedDoc?(A=!0,v=!1):t.canTogglePageKnowledge&&(A=e.usePageKnowledge);let P=(0,i("4F0gv").isAdfStreamingEnabled)(!0)&&t.adfPrompt;if(P){let e=new(0,i("h9yJL").JSONTransformer)(h,n);s=A?JSON.stringify(e.encode(u.state.doc,{keepNestedTables:!0})):void 0;let t="fullDocument",a=null;if(v){let n=h.nodes.doc,i=u.state.doc,o=i.slice(g[0],g[1]),s=o.content;if(r({type:"update selectionMetaData",context:{selectionMetaData:{sliceOpenStart:o.openStart,sliceOpenEnd:o.openEnd}}}),n.validContent(s))l=(a=n.createAndFill(null,o.content))?JSON.stringify(e.encode(a,{keepNestedTables:!0})):void 0;else{let s=i.resolve(g[0]),c=i.resolve(g[1]),d=[],p=s.sharedDepth(c.pos),u=o.content;for(;p>0;){let t=s.node(p).type;if(u=t.createAndFill(null,u)){if(d.push(t.name),a=n.createAndFill(null,u)){l=JSON.stringify(e.encode(a,{keepNestedTables:!0}));break}p--}else break}t="partialSelection",r({type:"update adfResponseNodeWrappers",context:{adfResponseNodeWrappers:d}})}}let o=A?u.state.doc:a;o&&(c={...c=new(0,i("8nxxM").ProseMirrorContentStatistics)(o).collectStatistics(),contextSelectionScope:t})}else{let e=A?eg({node:u.state.doc,editorView:u,convertTo:"markdown-plus",existingIdMap:{},updateIdMap:a,mentionMap:n,aiSessionId:C}):void 0;s=e?.markdown;let t=v?eg({slice:u.state.doc.slice(g[0],g[1]),editorView:u,convertTo:"markdown-plus",existingIdMap:e?.idMap,updateIdMap:a,mentionMap:n,aiSessionId:C}):void 0;s=e?.markdown,l=t?.markdown,c=e?.contentStatistics||t?.contentStatistics}let k=d.getAdditionalProps&&d.getAdditionalProps?.(),x=t.getRequestPayload?.({aiSessionId:C,locale:m.locale,isEmpty:e.isEmpty,doc:s,selection:l});return{doc:s,selection:l,contentStatistics:c,isConvoAI:!0,experienceId:b||"editor",endpoint:T||i("klIiV").convoAIApiUrl,payload:JSON.stringify(x||{ai_feature_input:{feature_args:{user_input:p||void 0,document_title:k?.issue_summary,selected_context:f||l||void 0,document_context:s||void 0,supported_markdown_nodes:ef(h),output_mime_type:P?"text/adf":"text/markdown",transformation_subtype:t.lang},feature:S,content_ari:o,ai_session_id:C,locale:m.locale}})}},ey=({context:e,configItem:t,mentionMap:n,updateIdMap:a})=>{let{editorView:r,positions:o,userInput:s,userADFInput:l}=e,{agent:c}=t,d=e.usePageKnowledge?eg({node:r.state.doc,editorView:r,convertTo:"markdown-plus",existingIdMap:{},updateIdMap:a,mentionMap:n}):void 0,p=eg({slice:r.state.doc.slice(o[0],o[1]),editorView:r,convertTo:"markdown-plus",existingIdMap:d?.idMap,updateIdMap:a,mentionMap:n});return{doc:d?.markdown,selection:p?.markdown,contentStatistics:d?.contentStatistics||p?.contentStatistics,isConvoAI:!0,experienceId:"ai-mate",endpoint:i("klIiV").convoAIRovoApiURL,payload:JSON.stringify({agent_id:c?.namedId,internal_data_sharing_opt_in:!0,mimeType:"text/adf",content:function({userInput:e="",userADFInput:t}){return t||(0,i("caRYB").doc)((0,i("2FFuS").paragraph)(e))}({userInput:s,userADFInput:l}),context:{browser_url:window.location.origin+window.location.pathname,editor:{document:{type:"text/markdown",content:d?.markdown||""},selection:{type:"text/markdown",content:p?.markdown||""}}}})}};var eI=i("dQl1W");let eE=[".","!","?"],eS=(e,t)=>{let n=0;try{(0,i("6jPem").traverse)(e,{text:e=>{if((n+=(e.text||"").length)>t)throw Error("SIZE_EXCEEDED")},hardBreak:()=>{if((n+=1)>t)throw Error("SIZE_EXCEEDED")}})}catch(e){if(e instanceof Error&&"SIZE_EXCEEDED"===e.message)return n;return t+1}return n},eb=e=>{let t=[];return(0,i("6jPem").traverse)(e,{text:e=>{t.push(e.text||"")},hardBreak:()=>{t.push("\n")}}),t.join("")},eT=(e,t)=>{if(0===t)return!0;let n=e.slice(0,t);return!!(0===n.trim().length||/\n\s*$/.test(n)||/[.!?]\s*$/.test(n))},eC=(e,t)=>0===e.slice(t).trim().length,eA=(e,t,n,i,a)=>{if(i===a)return{shouldCorrectFirst:!1,shouldCorrectLast:!1};let r=e.trim(),o=t.trim();if(!r||!o||r===o)return{shouldCorrectFirst:!1,shouldCorrectLast:!1};let s=r.length>0?ev(r):"",l=o.length>0?ev(o):"",c=r.length>0?eP(r):"",d=o.length>0?eP(o):"";return{shouldCorrectFirst:!!(s&&l&&s===s.toLowerCase()&&l===l.toUpperCase()&&!eT(n,i)),shouldCorrectLast:!!(d&&eE.includes(d)&&(!c||!eE.includes(c))&&!eC(n,a))}},ev=e=>{let t=Array.from(e);return t.length>0?t[0]:""},eP=e=>{let t=Array.from(e);return t.length>0?t[t.length-1]:""},ek=(e,t)=>{let n=Array.from(e);return n.length>0?(n[0]=t,n.join("")):e},ex=(e,t)=>{let n=eb(e).trimEnd(),i=t.trimEnd();return i.length>0&&n.endsWith(i)},ew=(e,t,n)=>{let a=!1,r=e;return(0,i("6jPem").traverse)(r,{text:i=>{if(!i.text)return i;let r=i.text;if(!a&&t&&r.trim().length>0){let e=r.search(/\S/);if(-1!==e){let t=r.slice(0,e),n=r.slice(e),i=ev(n);i&&i.toUpperCase()!==i.toLowerCase()&&(r=t+ek(n,i.toLowerCase()))}a=!0}if(n&&ex(e,i.text)){let e=r.trimEnd();if(e.length>0){let t=eP(e);if(eE.includes(t)){let t=Array.from(e).slice(0,-1).join("");r=t+r.slice(e.length)}}}return 0!==r.trim().length&&(r!==i.text?{...i,text:r}:i)}})},eM=(e,t)=>{try{if(eS(e,1e5)>1e5)return e;let n=eb(e),{originalText:i,fullDocumentText:a,selectionStart:r,selectionEnd:o}=t,{shouldCorrectFirst:s,shouldCorrectLast:l}=eA(i,n,a,r,o);if(s||l)return ew(e,s,l);return e}catch(t){return e}};var eN=((r={}).API_FAIL="api fail",r.AUP_VIOLATION="aup violation detected",r.UNKNOWN="unknown fail",r.TOKEN_LIMIT="token limit fail",r.INSERT_FAILURE="insert failure",r.INPUT_TOO_SHORT="input too short fail",r.HIPAA_CONTENT="hipaa content fail",r.RATE_LIMITED="rate limited",r.INTERNAL_SERVER_ERROR="internal server error",r.ELEVATE_DISABLED_GENERATE="elevate disabled generate",r.ADF_STREAMING_ERROR="adf streaming error",r.NO_TEXTUAL_CONTENT="no textual content",r.INVALID_JSON="invalid json",r),eO=i("3FxV8"),eR=((o={}).EMPTY="empty",o.FULL_DOCUMENT="fullDocument",o.FULL_SINGLE_BLOCK="fullSingleBlock",o.PARTIAL_SINGLE_BLOCK="partialSingleBlock",o.FULL_MULTIPLE_BLOCKS="fullMultipleBlocks",o.PARTIAL_MULTIPLE_BLOCKS="partialMultipleBlocks",o);function eD(e,t){let n=e.find(void 0,void 0,e=>e.key===t);return n.length>0?n[0]:void 0}function eL({modalDecorationSet:e}){if(!e)return;let t=eD(e,"inlineDecoration");if(t)return[t.from,t.to];let n=eD(e,"generatedStartWidget"),i=eD(e,"generatedEndWidget");if(n&&i)return[n.from,i.to]}function eF(t,n){let{state:a}=t;return function(t,n){let[a,r]=n,{isInDocumentStreamingEnabled:o}=(0,i("kqrrC").getPluginState)(t),s=a===r,l=o?t.doc.resolve(e(eO)(a,1,t.doc.content.size)):t.doc.resolve(a),c=o?t.doc.resolve(e(eO)(r,1,t.doc.content.size)):t.doc.resolve(r),d=l.sameParent(c),p=l.pos===l.depth,u=t.doc.nodeSize-c.pos-2===c.depth,g=(0,i("l6okE").isSelectionAtStartOfNode)(l,l.parent),m=(0,i("l6okE").isSelectionAtEndOfNode)(c,c.parent);return s?eR.EMPTY:p&&u?eR.FULL_DOCUMENT:d?g&&m?eR.FULL_SINGLE_BLOCK:eR.PARTIAL_SINGLE_BLOCK:g&&m?eR.FULL_MULTIPLE_BLOCKS:eR.PARTIAL_MULTIPLE_BLOCKS}(a,n)}let eG=({fireAIAnalyticsEvent:e,experienceName:t,featureId:n,aiSessionId:a,aiInteractionID:r,selectionType:o,selectionCategory:s,contentStatistics:l,streamId:c,retryAttemptNumber:d})=>p=>{"error"===p.type?e({payload:{action:"error",actionSubject:"editorPluginAI",actionSubjectId:"adfStreaming",eventType:i("d925B").EVENT_TYPE.OPERATIONAL,attributes:{errorMessage:p.message,errorData:p.data,experienceName:t,featureId:n,aiSessionId:a,aiInteractionID:r,selectionType:o,selectionCategory:s,contentStatistics:l,streamId:c,retryAttemptNumber:d,source:{type:"plugin"}}}}):e({payload:{action:"info",actionSubject:"editorPluginAI",actionSubjectId:"adfStreaming",eventType:i("d925B").EVENT_TYPE.OPERATIONAL,attributes:{message:p.message,data:p.data,experienceName:t,featureId:n,aiSessionId:a,aiInteractionID:r,selectionType:o,selectionCategory:s,contentStatistics:l,streamId:c,retryAttemptNumber:d,source:{type:"plugin"}}}})},eB=(e,t)=>{let n=i("5SAOw").Node.fromJSON(t,e);return(0,i("6eZqW").convertProsemirrorNodeToMarkdown)({node:n}).markdown};class eU{startErrorCheckTimer(){this.clearErrorCheckTimer(),this.errorCheckTimerId=setTimeout(()=>{this.attemptRetry()},this.options.delayMs)}attemptRetry(){this.retries<this.options.maxRetries&&(this.options.errorChecker()?(this.callBeforeRetryCallback(),this.startFetchingWithRetry()):(this.currentRetryCheck<this.maxRetryChecks&&this.startErrorCheckTimer(),this.currentRetryCheck++))}callBeforeRetryCallback(){this.abortController?.abort(),this.retries++,this.options.beforeRetryCallback()}retryOnStreamingEnd(){this.clearErrorCheckTimer(),this.options.errorChecker()&&!this.hasMaxRetryReached()&&(this.callBeforeRetryCallback(),this.fetch())}getRetryCount(){return this.retries}hasMaxRetryReached(){return this.retries>=this.options.maxRetries}fetch(){this.abortController=new AbortController,this.options.fetcher(this.abortController,this)}startFetchingWithRetry(){this.currentRetryCheck=0,this.fetch(),this.startErrorCheckTimer()}clearErrorCheckTimer(){this.errorCheckTimerId&&(clearTimeout(this.errorCheckTimerId),this.errorCheckTimerId=null)}reset(){this.clearErrorCheckTimer(),this.retries=0}constructor(e){this.options=e,this.errorCheckTimerId=null,this.retries=0,this.abortController=null,this.maxRetryChecks=10,this.currentRetryCheck=0,this.maxRetryChecks=e.maxRetryChecks??10}}let eV=!1,ej=null;function eH(){ej&&(clearInterval(ej),ej=null)}function ez(e){let{editorView:t,positions:n}=e;if(!n||n.length<2)return;let i=Number(n[0]),a=Number(n[1]);if(Number.isFinite(i)&&Number.isFinite(a))try{return t.state.doc.slice(i,a)}catch{return}}function eK(e,t){return"object"==typeof t&&null!==t&&e in t}function eW(e){return"string"==typeof e?e:e instanceof Error?e.message:`Unknown error: ${null===e?"null":e?.toString()}`}async function eq({requestOptions:e,cacheKey:t,response:n}){if(400===n.status)try{let{error:t}=await n.json();if(t){if("object"==typeof t&&"key"in t&&["INPUT_TOO_SHORT_TO_SUMMARIZE","INPUT_TOO_SHORT_TO_PROCESS","INPUT_EXCEEDS_TOKEN_LIMIT"].includes(t.key)){if("INPUT_EXCEEDS_TOKEN_LIMIT"===t.key)return{type:"error",errorInfo:{apiName:(0,i("klIiV").getAPIName)(e.endpoint),failureReason:eN.TOKEN_LIMIT,statusCode:n.status,errorKey:t.key}};if("INPUT_TOO_SHORT_TO_SUMMARIZE"===t.key||"INPUT_TOO_SHORT_TO_PROCESS"===t.key)return{type:"error",errorInfo:{apiName:(0,i("klIiV").getAPIName)(e.endpoint),failureReason:eN.INPUT_TOO_SHORT,statusCode:n.status,errorKey:t.key}}}return{type:"error",errorInfo:{apiName:(0,i("klIiV").getAPIName)(e.endpoint),failureReason:eN.API_FAIL,statusCode:n.status,errorContent:"Unhandled error response received"}}}}catch(t){return{type:"error",errorInfo:{apiName:(0,i("klIiV").getAPIName)(e.endpoint),failureReason:eN.API_FAIL,statusCode:n.status,errorContent:eW(t)}}}return 429===n.status?{type:"error",retryAfter:Number(n.headers.get("Retry-After")||"60"),errorInfo:{apiName:(0,i("klIiV").getAPIName)(e.endpoint),failureReason:eN.RATE_LIMITED,statusCode:n.status}}:451===n.status?{type:"error",cacheKey:t,modelInput:{selection:e.selection,doc:e.doc},errorInfo:{apiName:(0,i("klIiV").getAPIName)(e.endpoint),failureReason:eN.AUP_VIOLATION,statusCode:451}}:9001===n.status?{type:"error",errorInfo:{apiName:(0,i("klIiV").getAPIName)(e.endpoint),failureReason:eN.ELEVATE_DISABLED_GENERATE,statusCode:9001}}:{type:"error",errorInfo:{apiName:(0,i("klIiV").getAPIName)(e.endpoint),failureReason:eN.API_FAIL,statusCode:n.status,errorContent:`unexpected response status: ${n.status}`}}}function eY({content:e,adfStreamer:t,partial:n,context:a}){t.reset(),t.setAnalyticsEventMetaData({isFinalResponse:!0});let r=t.processChunk(e).getLastDoc();n.adfResponse=n.initialSelectionContext&&(0,i("dh538").fg)("platform_editor_ai_iw_capitalisation_fix")?eM(r,n.initialSelectionContext):r;let o=ez(a);t.setInputDocumentTree(o),t.endStreamingSession({hasProcessedFinalResponse:!0}),n.content=""}async function*e$({requestOptions:e,cacheKey:t,context:n,selectionType:a,streamContentProcessor:r,isComplete:o,response:s,body:l,adfStreamer:c,abortController:d}){try{let d=l.getReader(),p=new TextDecoder("utf-8"),u="",g=!1,m=n?.configItem?.adfPrompt&&(0,i("4F0gv").isAdfStreamingEnabled)(),f=m&&(0,i("dh538").fg)("platform_editor_ai_iw_capitalisation_fix")?function(e){let t,n,i=e.editorView.state.doc,a=i.textBetween(0,i.content.size,"\n"," "),r=i.textBetween(Math.max(0,e.positions[0]),Math.min(e.positions[1],i.content.size),"\n"," "),o=(t=e.positions[0],i.textBetween(0,Math.min(t,i.content.size),"\n"," ").length);return{fullDocumentText:a,originalText:r,selectionEnd:(n=e.positions[1],i.textBetween(0,Math.min(n,i.content.size),"\n"," ").length),selectionStart:o}}(n):void 0,h={type:"markdown",content:"",meta:{inputOutputDiffRatio:""},rovoActions:[],initialSelectionContext:f};for(;!g;){let{value:o,done:l}=await d.read();g=l;let f=p.decode(o),_=(u+=f).split("\n");for(;_.length>1;){let o,l=_.shift();try{o=JSON.parse(l)}catch(t){return yield{type:"error",errorInfo:{apiName:(0,i("klIiV").getAPIName)(e.endpoint),failureReason:eN.INVALID_JSON,statusCode:s.status,errorContent:`Received invalid json: ${t instanceof Error?t.message:String(t)}`}}}if(null===o.generatedContent)return yield function({requestOptions:e,cacheKey:t,data:n}){let{selection:a,doc:r}=e;return n.error?.statusCode===429?{type:"error",retryAfter:60,errorInfo:{apiName:(0,i("klIiV").getAPIName)(e.endpoint),failureReason:eN.RATE_LIMITED,statusCode:429}}:n.error?.key==="RESPONSE_TOO_SIMILAR"?{type:"response too similar",cacheKey:t,modelInput:{selection:a,doc:r},inputOutputDiffRatio:eK("meta",n)&&eK("inputOutputDiffRatio",n.meta)?n.meta.inputOutputDiffRatio:""}:{type:"error",errorInfo:{apiName:(0,i("klIiV").getAPIName)(e.endpoint),failureReason:eN.API_FAIL,statusCode:n.error?.statusCode??9002}}}({requestOptions:e,cacheKey:t,context:n,streamContentProcessor:r,partial:h,data:o,adfStreamer:c,selectionType:a,schema:n.editorView?.state?.schema,isAdfPrompt:!!m});yield function(e){if(eK("generatedContent",e.data))return function({streamContentProcessor:e,partial:t,data:n}){return t.content+=n.generatedContent,eK("meta",n)&&eK("inputOutputDiffRatio",n.meta)&&(t.meta={inputOutputDiffRatio:n.meta.inputOutputDiffRatio,loadingStatus:""}),{type:"stream",loadingStatus:t.meta.loadingStatus,markdown:t.content,...e?.(t.content)}}(e);if(!e.requestOptions.isConvoAI)return{type:"error",errorInfo:{failureReason:eN.API_FAIL,apiName:(0,i("klIiV").getAPIName)(e.requestOptions.endpoint),statusCode:9003}};let{data:t,adfStreamer:n,partial:a}=e;if(eK("type",t))switch(t.type){case"TRACE":!function({partial:e,data:t}){e.meta={inputOutputDiffRatio:"",loadingStatus:eK("message",t)&&eK("message_template",t.message)?t.message.message_template:""}}(e);break;case"ANSWER_PART":!function({partial:e,data:t,adfStreamer:n}){n&&(0,i("4F0gv").isAdfStreamingEnabled)()?(eV?(n.processChunk(t.message.content),eV=!1):n.appendChunk(t.message.content),e.adfResponse=n.getLastDocWithoutLastLeafNode(),e.content=""):e.content+=t.message.content,e.meta={inputOutputDiffRatio:"",loadingStatus:""}}(e);break;case"FINAL_RESPONSE":eH();let r=ez(e.context);n?.setInputDocumentTree(r),n?.endStreamingSession();let o=function({requestOptions:e,cacheKey:t,data:n,partial:a,adfStreamer:r,context:o}){let{message:s}=n,{selection:l,doc:c}=e,d=(0,i("4F0gv").isAdfStreamingEnabled)();function p(e){return r&&d&&eY({content:s.content,adfStreamer:r,partial:a,context:o}),{type:"response too similar",cacheKey:t,modelInput:{selection:l,doc:c},inputOutputDiffRatio:e,adfResponse:a.adfResponse}}if(eK("message_metadata",s.message)&&eK("response_too_similar",s.message.message_metadata)&&s.message.message_metadata.response_too_similar)return p(s.message?.message_metadata?.diff_ratio||"");if(eK("response_too_similar",n)&&n.response_too_similar)return p(eK("similarity_ratio",n)?`${n.similarity_ratio}`:"");if(eK("content",s)){r&&d?eY({content:s.content,adfStreamer:r,partial:a,context:o}):a.content=s.content,eK("actions",s)&&Array.isArray(s.actions)&&(a.rovoActions=s.actions||[]),a.meta={inputOutputDiffRatio:eK("similarity_ratio",n)?`${n.similarity_ratio}`:"",loadingStatus:""};return}r&&d?eY({content:s.content,adfStreamer:r,partial:a,context:o}):a.content=s.message.content,a.rovoActions=s.message.actions||[],a.meta={inputOutputDiffRatio:s.message?.message_metadata?.diff_ratio||"",loadingStatus:""}}(e);if(o)return o;break;case"ERROR":return eH(),function({requestOptions:e,cacheKey:t,data:n}){let a,r,o,s="UNHANDLED_ERROR";eK("message",n)&&(eK("status_code",n.message)&&"number"==typeof n.message.status_code&&(a=n.message.status_code),eK("message_template",n.message)&&(s=n.message.message_template),eK("content",n.message)&&(r=n.message.content),eK("headers",n)&&eK("Retry-After",n.headers)&&(o=Number(n.headers["Retry-After"])));let l=eN.API_FAIL;["RATE_LIMIT","OPENAI_RATE_LIMIT_USER_ABUSE"].includes(s)&&o?l=eN.RATE_LIMITED:o=void 0,"HIPAA_CONTENT_DETECTED"===s&&(l=eN.HIPAA_CONTENT),"EXCEEDING_CONTEXT_LENGTH_ERROR"===s&&(l=eN.TOKEN_LIMIT);let c=(0,i("klIiV").getAPIName)(e.endpoint);return"ACCEPTABLE_USE_VIOLATIONS"===s?{type:"error",cacheKey:t,modelInput:{selection:e.selection,doc:e.doc},errorInfo:{failureReason:eN.AUP_VIOLATION,statusCode:a,errorKey:s,apiName:c,errorContent:eW(r)}}:o?{type:"error",retryAfter:o,errorInfo:{apiName:c,failureReason:l,statusCode:a,errorKey:s,errorContent:eW(r)}}:{type:"error",errorInfo:{apiName:c,failureReason:l,statusCode:a,errorKey:s,errorContent:eW(r)}}}(e)}return n&&(0,i("4F0gv").isAdfStreamingEnabled)()?{type:"stream",loadingStatus:a.meta.loadingStatus,markdown:a.content,adfResponse:a.adfResponse}:{type:"stream",loadingStatus:a.meta.loadingStatus,markdown:a.content}}({requestOptions:e,cacheKey:t,context:n,streamContentProcessor:r,partial:h,data:o,adfStreamer:c,selectionType:a,schema:n.editorView?.state?.schema,isAdfPrompt:!!m})}u=_[0]}return yield function({requestOptions:e,cacheKey:t,selectionType:n,streamContentProcessor:a,isComplete:r,partial:o,schema:s,isAdfPrompt:l}){let c,d,p=o.rovoActions||[];l&&(0,i("4F0gv").isAdfStreamingEnabled)()?(c=eB(o.adfResponse||{type:"doc",version:1,content:[]},s),d=o.adfResponse):c=o.content;let u={markdown:c};if(p.length>0){let e="range"===n?"replace":"insert",t=p.find(t=>t.data.suggestion===e)??p[0];"empty"===n&&"replace"===t.data.suggestion?t.data.suggestion="insert":"range"===n&&"insert"===t.data.suggestion&&(t.data.suggestion="replace"),c+=`

---

${t.data.content}`}else a&&(u=a(o.content));return r&&!r()?{type:"stream",...u,loadingStatus:o.meta?.loadingStatus}:{type:"complete",...u,...d&&{adfResponse:d},cacheKey:t,modelInput:{selection:e.selection,doc:e.doc},inputOutputDiffRatio:o.meta?.inputOutputDiffRatio,rovoActions:p}}({requestOptions:e,cacheKey:t,context:n,selectionType:a,streamContentProcessor:r,isComplete:o,partial:h,schema:n.editorView?.state?.schema,isAdfPrompt:!!m})}catch(t){if(!(d.signal.aborted&&t instanceof Error&&"AbortError"===t.name))return yield{type:"error",errorInfo:{apiName:(0,i("klIiV").getAPIName)(e.endpoint),failureReason:eN.API_FAIL,statusCode:s.status,errorContent:eW(t)}}}}async function eJ(e){let{abortController:t,cacheKey:n,selectionType:a,product:r,getFetchCustomHeaders:o,channelId:s,callback:l,streamFlowPacer:c,streamContentProcessor:d,isComplete:p,requestOptions:u,context:g,fireAIAnalyticsEvent:m,aiInteractionID:f}=e;if("response"in u)return void l(u.response);if("error"in u){console.error("Editor AI: startStreamingResponse()",u.error),l({type:"error",errorInfo:{apiName:(0,i("klIiV").getAPIName)(u.endpoint),failureReason:eN.API_FAIL,statusCode:400,errorContent:u.error}});return}let{experienceId:h,endpoint:_,payload:y}=u,I=l,E=null;function S(){var e;return e={state:g.editorView.state,fireAIAnalyticsEvent:m??(()=>{}),experienceName:g.configItem.key,featureId:g.configItem.featureId,aiSessionId:g.analyticsContext.aiSessionId,aiInteractionID:f,selectionType:a,contentStatistics:u.contentStatistics,selectionCategory:eF(g.editorView,g.positions),streamId:(0,eI.v4)(),retryAttemptNumber:E?.getRetryCount()??0},new(0,i("4pSml").ADFStreamer)(e.state.schema,eG({fireAIAnalyticsEvent:e.fireAIAnalyticsEvent,experienceName:e.experienceName,featureId:e.featureId,aiSessionId:e.aiSessionId,aiInteractionID:e.aiInteractionID,selectionType:e.selectionType,contentStatistics:e.contentStatistics,selectionCategory:e.selectionCategory,streamId:e.streamId,retryAttemptNumber:e.retryAttemptNumber}))}let b=g?.configItem?.adfPrompt&&(0,i("4F0gv").isAdfStreamingEnabled)(),T=b?S():void 0;async function C(e,t){try{c&&(b||g.aiProvider.isInDocumentStreamingEnabled)&&(c.reset(),c.setEmit(l),b&&!g.aiProvider.isInDocumentStreamingEnabled&&(c.setTickMs(250),c.setCharsPerTick(5e3),c.setMaxCharsPerTick(1e4)),c.start(),I=c.push),b&&(eH(),ej=setInterval(()=>{eV=!0},250));let m=function({endpoint:e,channelId:t}){let n=e;return t&&(n=`${e}/${t}/message/stream`),n}({endpoint:_,channelId:s}),f={method:"POST",headers:function({product:e,experienceId:t}){return{"Content-Type":"application/json;charset=UTF-8","X-Experience-Id":t,...(0,i("3MD1q").getXChannelIdHeader)(t),...(0,i("3MD1q").getXProductHeader)(e)}}({product:r,experienceId:h}),body:y,credentials:"include",signal:e.signal,mode:"cors"},E=o?.(_,f)||{},S=await fetch(m,{...f,headers:{...f.headers,...E}}),C=S.headers.get("X-Trace-Id")||S.headers.get("Atl-Traceid");if(C&&l({type:"update traceIds",context:{traceIds:[C]}}),!S.ok)return l(await eq({requestOptions:u,cacheKey:n,response:S}));if(!S.body)return void l(function({response:e,requestOptions:t}){return{type:"error",errorInfo:{apiName:(0,i("klIiV").getAPIName)(t.endpoint),failureReason:eN.API_FAIL,statusCode:e.status,errorContent:"response.body missing"}}}({requestOptions:u,response:S}));if(g?.configItem?.handleFetchResponse){let e=await S.json();g.configItem.handleFetchResponse(e,u,l,n);return}for await(let r of e$({requestOptions:u,cacheKey:n,selectionType:a,streamContentProcessor:d,isComplete:p,response:S,body:S.body,context:g,adfStreamer:T,abortController:e}))if(I(r),"stream"!==r.type){t&&(T?.isInErrorState()?t.hasMaxRetryReached()?l({type:"error",errorInfo:{apiName:(0,i("klIiV").getAPIName)(_),failureReason:eN.ADF_STREAMING_ERROR}}):t.retryOnStreamingEnd():t.reset());return}}catch(e){E?.reset(),eH(),I((eK("name",e)&&"AbortError"===e.name||eK("cause",e)&&"ConvoAIChannelCreationError"===e.cause||console.error("Editor AI: startStreamingResponse()",e),{type:"error",errorInfo:{apiName:(0,i("klIiV").getAPIName)(_),failureReason:eN.API_FAIL,statusCode:eK("status",e)?Number(e.status):9e3,errorContent:eW(e)}}))}}b&&!g.aiProvider.isInDocumentStreamingEnabled?(E=new eU({maxRetries:1,delayMs:1e4,beforeRetryCallback:()=>{l({type:"retry on adf stream errors",adfResponse:(0,i("b4emg").getEmptyADF)()}),T?.endStreamingSession(),T?.reset(),T=S()},fetcher:C,errorChecker:()=>T?.isInErrorState()??!1}),E?.startFetchingWithRetry()):await C(t)}async function eQ({context:e}){let t={};return e.getMentionNameDetails&&(t=await (0,i("iSJi5").getMentionMap)({node:e.editorView.state.doc,getMentionNameDetails:e.getMentionNameDetails})),t}function eX({fireAIAnalyticsEvent:e,aiInteractionID:t,streamFlowPacer:n}){return async function(i,a){let r=new AbortController,{userInput:o,configItem:{agent:s}}=i,l=function({context:e}){return e.configItem.withContextMutation?.(e.configItem,e)??e.configItem}({context:i}),c=await eQ({context:i}),d=function({callback:e,context:t,configItem:n,mentionMap:i}){let a;if(n.response)return{response:n.response};let r=({idMap:t})=>{e({type:"update idMap",context:{idMap:t}})};return"contentStatistics"in(a=n.agent?ey({context:t,configItem:n,mentionMap:i,updateIdMap:r}):e_({context:t,configItem:n,mentionMap:i,updateIdMap:r,callback:e}))&&a.contentStatistics&&e({type:"storeContextStatistics",contextStatistics:{inputDocument:a.contentStatistics}}),a}({callback:a,context:i,configItem:l,mentionMap:c}),p=JSON.stringify({userInput:o,agent:s,requestOptions:d});if(function({context:e,cacheKey:t}){let{entries:n}=e.responseHistory,i=n[n.length-1];return i&&t===i.cacheKey&&"interrogate"!==e.promptTrigger}({context:i,cacheKey:p}))return void a({type:"same cache key"});let u=l.getCustomHeaders?l.getCustomHeaders:i.aiProvider.getFetchCustomHeaders;return await eJ({abortController:r,cacheKey:p,selectionType:i.selectionType,product:i.aiProvider.product,getFetchCustomHeaders:u,channelId:i.channelId,callback:a,requestOptions:d,context:i,fireAIAnalyticsEvent:e,aiInteractionID:t,streamFlowPacer:n}),()=>{r.abort()}}}let eZ=(e,t,n,i,a)=>{e({type:"complete",result:i}),j({api:t,analyticSourceId:n,isDateTimeFormat:a})},e0=({getIntl:t,editorPluginAIProvider:n,currentEditorView:a,configItem:r,streamingCallback:o,api:s,analyticSourceId:l})=>{let c=t(),d=e(er)();if(o({type:"initialising"}),ee(r,a)){let e,t=c.formatMessage(i("7ShCl").aiMessages.eventHubfallbackSuggestedTitle);if((0,i("dh538").fg)("platform_editor_ai_date_time_format_title_fallback")){e=!0;let n=c.formatMessage(i("7ShCl").aiMessages.eventHubfallbackSuggestedTitlePrefix),a=new Date,r=(0,i("dWCFT").default)(a,"yyyy-MM-dd HH:mm");t=`${n} ${r}`}eZ(o,s,l,t,e);return}eX({fireAIAnalyticsEvent:()=>{},streamFlowPacer:null})({aiProvider:n,editorView:a,configItem:r,intl:c,positions:[0,0],isEmpty:!0,selectionType:"empty",usePageKnowledge:!0,analyticsContext:{aiSessionId:d,aiGroupId:d},responseHistory:{positionFromEnd:0,entries:[],totalSize:0,traversals:0}},e=>{if(e)switch(e.type){case"stream":"ANALYSING_QUERY"===e.loadingStatus?o({type:"analysingQuery"}):o({type:"streaming",result:e.markdown});break;case"complete":o({type:"complete",result:e.markdown}),z(r)&&K({api:s,analyticSourceId:l,suggestedTitle:e.markdown});break;case"error":o({type:e.type,errorInfo:e.errorInfo});break;case"response too similar":o({type:e.type})}})},e1=e=>{let{aiGlobalOptIn:t}=e;return new(0,i("1S4f7").SafePlugin)({key:G,view:n=>{let a=n,{unsubscribe:r}=i("jOIil").eventHub.subscribe({event:"start prompt",callback:n=>{if((0,i("2e7rb").findEditorIdFromView)(a)===n.targetEditorId){let r,{state:o,dispatch:s}=a;n.prompt===B.IssueReformatter?r=n.additionalPayloadDataIssueReformatter:n.prompt===B.DraftReplyPill&&(0,i("dh538").fg)("draft_reply_contextual_pills_gate")||n.prompt===B.DescriptionCompleter?r=n.additionalPayloadData:n.prompt===B.IncidentSmartComments&&(r=n.additionalPayloadData);let l=Z(n.prompt,e.editorPluginAIProvider,n.adjustSelection,r);if(!l)return void U({dispatch:s,editorView:a,prompt:n.prompt,promptText:n.prompt===B.CustomPrompt?n.promptText:void 0,adjustSelection:n.adjustSelection});let c={state:o,configItem:l,lastTriggeredFrom:n.analyticSourceId,aiGlobalOptIn:t,adjustSelection:n.adjustSelection,initialPrompt:n.prompt===B.CustomPrompt?n.promptText:void 0,locale:e.getIntl().locale};n.hideModal?e0({getIntl:e.getIntl,currentEditorView:a,editorPluginAIProvider:e.editorPluginAIProvider,configItem:l,streamingCallback:n.streamingCallback,api:e.api,analyticSourceId:n.analyticSourceId}):(0,i("5SuLc").createOpenAIModalCommand)(c)(o,s)}}});return{update:e=>{a=e},destroy:()=>{r()}}}})};var e5=i("5qzNs");let e2=new(0,i("ks2lK").PluginKey)("aiMonitorWatchmen"),e8=e=>{if(!e.length)return e;let t=[...e].sort((e,t)=>e.from-t.from),n=[],i={...t[0]};for(let e=1;e<t.length;e++){let a=t[e];a.from<=i.to?i.to=Math.max(i.to,a.to):(n.push(i),i={...a})}return n.push(i),n},e4=(e,t,n)=>e.textBetween(t,n," "," "),e3="undefined"!=typeof Intl&&Intl.Segmenter?new Intl.Segmenter(void 0,{granularity:"word"}):null,e9=e=>{let t=e.trim();if(!t)return 0;try{if(e3){let e=0;for(let{isWordLike:n}of e3.segment(t))n&&e++;return e}}catch{}return t.split(/\s+/u).filter(Boolean).length},e6=(e,t)=>{let n=0,i=0;for(let a of t){let t=e4(e,a.from,a.to);n+=t.length,i+=e9(t)}return{chars:n,words:i}},e7=e=>{let t=[];for(let n of e)n.forEach((e,n,i,a)=>{(e!==n||i!==a)&&t.push({oldStart:e,oldEnd:n,newStart:i,newEnd:a})});return t},te=(e,t)=>{if(!t.length)return!1;let n=(e,t,n,i)=>`${e}:${t}:${n}:${i}`,i=new Set(t.map(e=>n(e.newStart,e.newEnd,e.oldStart,e.oldEnd)));for(let t of e)t.forEach((e,t,a,r)=>i.delete(n(e,t,a,r)));return 0===i.size},tt=(e,t)=>{if(!t.length)return!1;let n=(e,t,n,i)=>`${e}:${t}:${n}:${i}`,i=new Set(t.map(e=>n(e.oldStart,e.oldEnd,e.newStart,e.newEnd)));for(let t of e)t.forEach((e,t,a,r)=>i.delete(n(e,t,a,r)));return 0===i.size},tn=(e,t,n,a)=>{let r=n,o=a.map(e=>({...e})),s=0,l=0,c=new Set;for(let n=0;n<e.length;n++){let a=e[n],d=null,p=null;if(a instanceof i("aXG5V").ReplaceStep)"number"==typeof a.from&&"number"==typeof a.to&&a.from<a.to&&(d=a.from,p=a.to);else if(a instanceof i("aXG5V").ReplaceAroundStep)for(let e of[{from:a.from,to:a.gapFrom},{from:a.gapTo,to:a.to}].filter(e=>e.from<e.to))for(let t=0;t<o.length;t++){let n=o[t],i=Math.max(n.from,e.from),a=Math.min(n.to,e.to);if(i<a){c.add(t);let e=e4(r,i,a);s+=e.length,l+=e9(e)}}if(null!=d&&null!=p)for(let e=0;e<o.length;e++){let t=o[e],n=Math.max(t.from,d),i=Math.min(t.to,p);if(n<i){c.add(e);let t=e4(r,n,i);s+=t.length,l+=e9(t)}}let u=a.apply(r);u.doc&&(r=u.doc);let g=t[n];g&&(o=o.map(({from:e,to:t})=>({from:g.map(e,-1),to:g.map(t,1)})))}return{deletedChars:s,deletedWords:l,touched:c.size}},ti=(e,t,n,i={})=>{let a=performance.now(),{removedChars:r,removedWords:o,touched:s}=i;return{...e,currentSession:null,pendingAnalytics:{aiSessionId:t.id,nextActionType:n,aiOutputChars:t.aiOutputChars,aiOutputWords:t.aiOutputWords,nextActionRemovedAiChars:r,nextActionRemovedAiWords:o,nextActionTouchedAiRanges:s,nextActionLatencyMs:Math.round(Math.max(0,a-t.startedAt))}}},ta=(e,t)=>{let n=e7(e);for(let e=0;e<n.length;e++){let i=n[e];for(let e=0;e<t.length;e++){let n=t[e];if(i.oldEnd>n.from&&i.oldStart<n.to)return!0}}return!1},tr="AIMonitorWatchmenFlushAnalytics",to="AIMonitorWatchmenDeferredAnalytics",ts="AIMonitorWatchmenCommonAttributes",tl={currentSession:null,pendingAnalytics:null,lastUndoneSession:null,deferredAnalytics:{deferred:{},sessionState:"notStarted"},commonAttributes:{}},tc=(t,n)=>new(0,i("1S4f7").SafePlugin)({key:e2,state:{init:()=>tl,apply:(a,r,o,s)=>{let l,c,d=!1;if((0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")){let e=i("3yUTv").aiExperienceDecorationPluginKey.getState(s);d=e?.sessionStarted??!1;let{deferredAnalytics:t}=r;if(d&&"inProgress"!==t.sessionState)return{...r,deferredAnalytics:{...t,sessionState:"inProgress"}};if(e?.sessionEnded&&"inProgress"===t.sessionState)return{...r,deferredAnalytics:{...t,sessionState:"justEnded"}};let n=a.getMeta(to);if(n)return{...r,deferredAnalytics:n};let o=a.getMeta(ts);if(o)return{...r,commonAttributes:o}}if(a.getMeta(tr))return{...r,pendingAnalytics:null};let p=!!a.getMeta("isRemote"),u=!!a.getMeta("isAIFinalStreamingTransformation"),g=a.getMeta("appendedTransaction"),m=!!(a.getMeta("isAIStreamingTransformation")||g&&g.getMeta("isAIStreamingTransformation")&&!u);if((0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")){let e=t?.aiExperience.sharedState.currentState()?.aiDecorationExperiencePluginState,n=e?.configItem?.key||"";l=e?.lastTriggeredFrom,c=(0,i("6gJll").convertExperienceName)(n,l)}if(!a.docChanged||a.getMeta("metricsPlugin$"))return r;if(u){let t=e7(a.mapping.maps),o=e8(t.map(e=>({from:e.newStart,to:e.newEnd})).filter(e=>e.from<e.to)),{chars:d,words:p}=e6(s.doc,o),u={id:e(er)(),startedAt:Math.round(performance.now()),ranges:t,mergedNewRanges:o,baselineDoc:s.doc,aiOutputChars:d,aiOutputWords:p,awaitingNextAction:!0},g=r.deferredAnalytics;if(n()&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")){let e=(0,i("ilIeg").createUnifiedAnalyticsPayload)({...r.commonAttributes,action:i("d925B").ACTION.ACTIONED,attributes:{aiResultAction:"accepted",aiActionedType:"automaticallyInserted"},interactionID:u.id,experienceName:c,invokedFrom:l});g={...r.deferredAnalytics,toDefer:{aiSessionId:u.id,payload:e,waitForSessionEnd:"inProgress"===r.deferredAnalytics.sessionState}}}return{...r,currentSession:u,pendingAnalytics:null,deferredAnalytics:g}}if(r.currentSession&&r.currentSession.awaitingNextAction&&!p&&a.docChanged){let e=r.currentSession;if(m)return ti(r,e,"regen");if(te(a.mapping.maps,e.ranges)){let t={aiSessionId:e.id,undoneRanges:e.ranges,aiOutputChars:e.aiOutputChars,aiOutputWords:e.aiOutputWords,undoneAt:Math.round(performance.now())},n=r.deferredAnalytics;return(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")&&(n={...r.deferredAnalytics,toCancel:e.id}),{...ti(r,e,"undo",{removedChars:e.aiOutputChars,removedWords:e.aiOutputWords,touched:e.mergedNewRanges.length}),deferredAnalytics:n,lastUndoneSession:t}}if(!ta(a.mapping.maps,e.mergedNewRanges))return ti(r,e,"other");let{deletedChars:t,deletedWords:n,touched:o}=tn(a.steps,a.mapping.maps,e.baselineDoc,e.mergedNewRanges),s=t>0||n>0,l=t>=e.aiOutputChars/2,c=r.deferredAnalytics;return l&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")&&(c={...r.deferredAnalytics,toCancel:e.id}),{...ti(r,e,s?"delete":"other",{removedChars:t,removedWords:n,touched:o}),deferredAnalytics:c}}if(r.lastUndoneSession&&!p&&a.docChanged&&!m){let e=r.lastUndoneSession;if(!(Math.round(performance.now())-e.undoneAt<=2e3))return{...r,lastUndoneSession:null};if(tt(a.mapping.maps,e.undoneRanges)){let t={id:e.aiSessionId,startedAt:e.undoneAt,ranges:e.undoneRanges,mergedNewRanges:e.undoneRanges.map(e=>({from:e.newStart,to:e.newEnd})),baselineDoc:s.doc,aiOutputChars:e.aiOutputChars,aiOutputWords:e.aiOutputWords,awaitingNextAction:!1},a=r.deferredAnalytics;if(n()&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")){let t=(0,i("ilIeg").createUnifiedAnalyticsPayload)({...r.commonAttributes,action:i("d925B").ACTION.ACTIONED,attributes:{aiResultAction:"accepted",aiActionedType:"automaticallyInserted"},interactionID:e.aiSessionId,experienceName:c,invokedFrom:l});a={...r.deferredAnalytics,toDefer:{aiSessionId:e.aiSessionId,payload:t,waitForSessionEnd:"inProgress"===r.deferredAnalytics.sessionState}}}return{...ti(r,t,"redo",{removedChars:e.aiOutputChars,removedWords:e.aiOutputWords,touched:e.undoneRanges.length}),lastUndoneSession:null,deferredAnalytics:a}}}return r}},appendTransaction:(n,a,r)=>{let o=e2.getState(r);if((0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")){let n=o?.deferredAnalytics||tl.deferredAnalytics,{toDefer:i,toCancel:a,sessionState:s}=n,l=i?.waitForSessionEnd;if(i&&(!l||"justEnded"===s)){let e=setTimeout(()=>t?.analytics?.actions.fireAnalyticsEvent(i.payload),1e4),a={...n,deferred:{...n?.deferred,[i.aiSessionId]:e},toDefer:void 0,sessionState:"notStarted"};return r.tr.setMeta(to,a)}if(a){window.clearTimeout(n.deferred[a]);let t={...n,pending:e(e5)(n.deferred,a),toCancel:void 0};return r.tr.setMeta(to,t)}}if(!o?.pendingAnalytics)return null;let{aiSessionId:s,nextActionType:l,aiOutputChars:c,aiOutputWords:d,nextActionRemovedAiChars:p,nextActionRemovedAiWords:u,nextActionTouchedAiRanges:g,nextActionLatencyMs:m}=o.pendingAnalytics,f=r.tr.setMeta(tr,!0);return(0,i("4SGh1").addAnalytics)({editorState:r,tr:f,payload:{action:"updated",actionSubject:"editorPluginAI",actionSubjectId:"aiImmediateReaction",attributes:{aiSessionId:s,nextActionType:l,aiOutputChars:c,aiOutputWords:d,nextActionRemovedAiChars:p,nextActionRemovedAiWords:u,nextActionTouchedAiRanges:g,nextActionLatencyMs:m},eventType:i("d925B").EVENT_TYPE.TRACK},addToHistory:!1})}});var td=i("1oCLl");let tp=new(0,i("ks2lK").PluginKey)("aiQucikstartCommand"),tu=e=>new(0,i("1S4f7").SafePlugin)({key:tp,state:{init:(e,t)=>({}),apply:()=>{}},props:{handleDOMEvents:{keydown(t,n){if((((0,td.expValEquals)("platform_editor_hydratable_ui","isEnabled",!0)?(0,i("d7ZU3").getBrowserInfo)():i("d7ZU3").browser).mac?n.metaKey:n.ctrlKey)&&"'"===n.key){let{editorPluginAIProvider:n,aiGlobalOptIn:a}=e,{state:r,dispatch:o}=t,s=n.baseGenerate;return(0,i("5SuLc").createOpenAIModalCommand)({state:r,configItem:s,lastTriggeredFrom:"shortcut",triggerMethod:"shortcut",aiGlobalOptIn:a,locale:e.getIntl().locale})(r,o),!0}return!1}}}}),tg={adfResponse:void 0,status:"idle"},tm=e=>{let{dispatch:t}=e;return new(0,i("1S4f7").SafePlugin)({key:f,state:{init:()=>tg,apply:(e,n)=>{let i=e.getMeta(f);if(i){let e=function({state:e,action:t}){switch(t.type){case"RESET":return tg;case"STREAM":return{...e,adfResponse:t.adfResponse,status:"streaming"};case"COMPLETE":return{...e,adfResponse:t.adfResponse,status:"complete"};case"ERROR":return{...e,errorInfo:t.errorInfo,status:"error"};default:return e}}({state:n,action:i});return e!==n&&t(f,e),e}return n}}})},tf=e=>({tr:t})=>t.setMeta(f,e),th=({adfResponse:e})=>tf({type:"STREAM",adfResponse:e}),t_=({adfResponse:e})=>tf({type:"COMPLETE",adfResponse:e}),ty=({errorInfo:e})=>tf({type:"ERROR",errorInfo:e}),tI=e=>{switch(e.type){case"stream":return th(e);case"complete":return t_(e);case"error":return ty(e);default:return}},tE=new(0,i("ks2lK").PluginKey)("aiSmartButtonAPI"),tS=()=>Object.fromEntries(Object.entries(i("2htg1").nodes).map(([e,t])=>[e,t.support])),tb=e=>e.replace(/[^\w\-/.:%?=]+/g,"");async function tT({editorState:e,getMentionNameDetails:t}){let n,{doc:a,schema:r}=e;return t&&(n=await (0,i("iSJi5").getMentionMap)({node:a,getMentionNameDetails:t})),{version:1,...new(0,i("h9yJL").JSONTransformer)(r,n).encodeNode(a)}}async function*tC({endpoint:t,product:n,context:a}){let{view:r,locale:o,getMentionNameDetails:s}=a,l=new AbortController;try{let a=await tT({editorState:r.state,getMentionNameDetails:s}),c={ai_feature_input:{triggers:[{trigger_id:e(er)(),content_url:tb(document.location.href),trigger_type:"PARAGRAPH_COMPLETE",paragraph_content:a}]}},d=performance.now(),p=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json;charset=UTF-8","X-Experience-Id":"proactive-paragraph-complete","Accept-Language":o,...(0,i("3MD1q").getXProductHeader)(n)},body:JSON.stringify(c),credentials:"include",signal:l.signal,mode:"cors"});yield{state:"trackedDuration",duration:performance.now()-d};let u=await tA(p);if("failed"===u.state){yield u,yield{state:"done"};return}let{triggers:g}=u.body.ai_feature_output,m=g.reduce((e,t)=>("errors"in t&&e.push(t.errors.error_type),e),[]),f=new(0,i("h9yJL").JSONTransformer)(r.state.schema),h=g.reduce((e,t)=>"recommendations"in t?e.concat(t.recommendations.map(e=>({chunkId:t.trigger_id,rid:e.recommendation_id,id:`${t.trigger_id}_${e.recommendation_id}`,transformContent:e.transformation_details?function(e){let t="doc"!==e.type?{version:1,type:"doc",content:[e]}:e;return{document:t,getContent:()=>f.parse(t).content}}(e.transformation_details.replacement_adf):void 0,transformType:e.transformation_type,transformAction:e.recommendation_name,details:e.recommendation_details,type:e.recommendation_type,score:e.recommendation_score??0,isViewed:!1,filtered:!1}))):e,[]);yield{state:"parsed",recommendations:h},m.length&&(yield{state:"failed",reason:"backend",errors:m,statusCode:p.status})}catch(e){"AbortError"===e.name?yield{state:"failed",reason:"aborted",errors:["Streaming aborted"],statusCode:e.status}:yield{state:"failed",reason:"unhandled",errors:e instanceof Error&&["RangeError","TypeError","TransformError"].includes(e.name)?[e.message]:["unhandled"],statusCode:e.status}}yield{state:"done"}}async function tA(e){if(429===e.status){let t=parseInt(e.headers.get("Retry-After")??"");return{state:"failed",reason:"rate-limited",retryAfter:isNaN(t)?void 0:1e3*t,statusCode:e.status,errors:["tooManyRequests"]}}try{let t=await e.json();if("object"==typeof t&&null!==t&&"ai_feature_output"in t)return{state:"success",body:t};if("object"==typeof t&&null!==t&&"errorMessage"in t&&"errors"in t&&"statusCode"in t)return{state:"failed",reason:"backend",errors:[t.errorMessage,...t.errors],statusCode:t.statusCode}}catch(t){return{state:"failed",reason:"parsing",errors:["parsingError"],statusCode:e.status}}return e.body?{state:"failed",reason:"backend",errors:["Invalid response"],statusCode:e.status}:{state:"failed",reason:"network",errors:["response.body missing"],statusCode:e.status}}async function tv({proactiveAIApiUrl:e,product:t,context:n}){let i=tC({endpoint:e,product:t,context:n}),a=!1,r={finalConfidence:void 0,alternativeConfidence:void 0,lengthPercentageDifference:void 0,inputReadabilityScore:void 0,outputReadabilityScore:void 0};if(!i)return{canNudge:a,nudgeMetrics:r};for await(let e of i)switch(e.state){case"cached":case"parsed":{let t=e.recommendations.find(e=>"REPLACE_PAGE"===e.transformType&&"IMPROVE_WRITING"===e.type);if(!t||!t.details||"IMPROVE_WRITING"!==t.type)break;a=tP(t.details),r={finalConfidence:t.details.final_confidence,alternativeConfidence:t.details.alternative_confidence,lengthPercentageDifference:t.details.length_percentage_difference,inputReadabilityScore:t.details.input_readability_score,outputReadabilityScore:t.details.output_readability_score}}}return{canNudge:a,nudgeMetrics:r}}let tP=e=>{let t=(0,m.unstable_editorExperimentParam)("platform_editor_ai_proactive_ai_nudge_parameters","min_final_confidence",{defaultValue:-1/0,typeGuard:e=>"number"==typeof e}),n=(0,m.unstable_editorExperimentParam)("platform_editor_ai_proactive_ai_nudge_parameters","min_length_percentage_difference",{defaultValue:-1/0,typeGuard:e=>"number"==typeof e}),i=(0,m.unstable_editorExperimentParam)("platform_editor_ai_proactive_ai_nudge_parameters","max_length_percentage_difference",{defaultValue:1/0,typeGuard:e=>"number"==typeof e}),a=(0,m.unstable_editorExperimentParam)("platform_editor_ai_proactive_ai_nudge_parameters","min_input_readability_score",{defaultValue:-1/0,typeGuard:e=>"number"==typeof e}),r=(0,m.unstable_editorExperimentParam)("platform_editor_ai_proactive_ai_nudge_parameters","min_output_readability_score",{defaultValue:-1/0,typeGuard:e=>"number"==typeof e}),o=(0,m.unstable_editorExperimentParam)("platform_editor_ai_proactive_ai_nudge_parameters","max_readability_score_delta",{defaultValue:1/0,typeGuard:e=>"number"==typeof e}),s=(0,m.unstable_editorExperimentParam)("platform_editor_ai_proactive_ai_nudge_parameters","min_readability_score_delta",{defaultValue:-1/0,typeGuard:e=>"number"==typeof e}),l=(0,m.unstable_editorExperimentParam)("platform_editor_ai_proactive_ai_nudge_parameters","min_alternative_confidence",{defaultValue:-1/0,typeGuard:e=>"number"==typeof e}),c=void 0===e.final_confidence||e.final_confidence>=t,d=void 0===e.length_percentage_difference||e.length_percentage_difference>=n,p=void 0===e.length_percentage_difference||e.length_percentage_difference<=i,u=void 0===e.input_readability_score||e.input_readability_score>=a,g=void 0===e.output_readability_score||e.output_readability_score>=r,f=void 0===e.output_readability_score||void 0===e.input_readability_score||e.output_readability_score-e.input_readability_score<=o,h=void 0===e.output_readability_score||void 0===e.input_readability_score||e.output_readability_score-e.input_readability_score>=s,_=void 0===e.alternative_confidence||e.alternative_confidence>=l;return c&&d&&p&&u&&g&&f&&h&&_};class tk{setLastDocChangeTime(e){this.lastDocChangeTime=e}isActive(){return this.active}async checkForNudge(){if(!this.active||!this.aiSmartButtonOptions||!this.nudgerOptions)return;let e=Date.now();if(e<this.lastDocChangeTime+3e3)return void this.next(this.lastDocChangeTime+3e3-e);if(this.nudgerOptions.api?.annotation?.actions.hasAnyUnResolvedAnnotationInPage(this.nudgerOptions.view.state))return void this.next();let t=new Set(Object.entries(tS()).filter(([,e])=>"full"===e||"custom"===e).map(([e])=>e));if(t.add("doc"),!this.hasOnlySupportedNodes(this.nudgerOptions.view.state.doc,t))return void this.next();let{canNudge:n,nudgeMetrics:i}=await tv({proactiveAIApiUrl:this.nudgerOptions.proactiveAIApiUrl,product:this.nudgerOptions.product,context:{view:this.nudgerOptions.view,getMentionNameDetails:this.nudgerOptions.getMentionNameDetails,locale:this.nudgerOptions.locale}});if(this.nudgerOptions.onCollectMetrics(i),n){let e=this.nudgerOptions.getNudge(i);this.aiSmartButtonOptions.actions.setNudges([e]),this.stop()}else this.next()}next(e=12e4){this.timerId&&clearTimeout(this.timerId),this.timerId=setTimeout(this.checkForNudge.bind(this),e)}start(){this.active||(this.active=!0,this.next(8e3))}stop(){this.active=!1,clearTimeout(this.timerId),this.timerId=void 0}hasOnlySupportedNodes(e,t){if(!t.has(e.type.name)&&e.attrs){let t=!1;switch(e.type.name){case"table":t="default"===e.attrs.layout&&this.areRemainingAttrsFalsey(e.attrs,["layout","localId","width"]);break;case"tableHeader":case"tableRow":case"tableCell":let n=void 0===e.attrs.colspan||1===e.attrs.colspan,i=void 0===e.attrs.rowspan||1===e.attrs.rowspan;t=n&&i&&this.areRemainingAttrsFalsey(e.attrs,["colspan","rowspan"]);break;case"mediaSingle":let a="center"===e.attrs.layout,r=!e.attrs.widthType||"pixel"===e.attrs.widthType;t=a&&r&&this.areRemainingAttrsFalsey(e.attrs,["layout","widthType","width"]);break;default:return!1}if(!t)return!1}for(let n=0;n<e.childCount;n++)if(!this.hasOnlySupportedNodes(e.child(n),t))return!1;return!0}areRemainingAttrsFalsey(e,t){return Object.keys(e).filter(e=>!t.includes(e)).every(t=>!e[t])}constructor(e,t){this.aiSmartButtonOptions=e,this.nudgerOptions=t,this.timerId=void 0,this.active=!1,this.lastDocChangeTime=0,this.lastDocChangeTime=Date.now()}}let tx=()=>({}),{createPluginState:tw,createCommand:tM,getPluginState:tN}=(0,i("lkJUe").pluginFactory)(tE,e=>e,{}),tO=({editorView:t,configItem:n,aiGlobalOptIn:a,intl:r})=>o=>({id:n.config.key,title:r.formatMessage(n.config.title),description:r.formatMessage(n.config.description),icon:()=>n.config.icon?.({formatMessage:r.formatMessage})||e(g).createElement(e(i("3Mg7y")),{label:"",spacing:"spacious"}),onClick:()=>{t.focus(),(0,i("5SuLc").createOpenAIModalCommand)({state:t.state,configItem:n.config,lastTriggeredFrom:"rovoButtonNudge",nudgeMetrics:o,aiGlobalOptIn:a,locale:r.locale})(t.state,t.dispatch)},handleType:i("6Htct").HandleActionType.Base,type:"ai-action"});function tR({config:t,aiGlobalOptIn:n,intl:a,view:r,isChild:o}){return{id:t.key.toString(),title:a.formatMessage(t.title),description:a.formatMessage(t.description),icon:()=>t.icon?.({formatMessage:a.formatMessage})||e(g).createElement(e(i("3Mg7y")),{label:"",spacing:"spacious"}),onClick:()=>{r.focus(),(0,i("5SuLc").createOpenAIModalCommand)({state:r.state,configItem:t,lastTriggeredFrom:"rovoButton",aiGlobalOptIn:n,locale:a.locale})(r.state,r.dispatch)},closePanelOnSelection:!0,handleType:i("6Htct").HandleActionType.Base,type:"ai-action",isChild:o}}let tD=({intl:t,dynamicSurfaceConfigItems:n,aiGlobalOptIn:a})=>r=>{let o=n.reduce((e,t)=>{let n=t.config.nestingConfig;return n&&(e[n.id]||(e[n.id]=[]),e[n.id].push(t)),e},{}),s=[],l=[];return n.forEach(({config:n})=>{if(n.nestingConfig){if(!s.includes(n.nestingConfig.id)){s.push(n.nestingConfig.id);let c=o[n.nestingConfig.id].map(e=>tR({config:e.config,aiGlobalOptIn:a,intl:t,view:r,isChild:!0}));l.push({id:n.nestingConfig.id,title:t.formatMessage(n.nestingConfig.parentTitle),description:t.formatMessage(n.nestingConfig.parentTitle),icon:()=>n.nestingConfig?.icon?.({formatMessage:t.formatMessage})||e(g).createElement(e(i("3Mg7y")),{label:"",spacing:"spacious"}),actionHeading:t.formatMessage(n.nestingConfig.parentTitle),children:c,handleType:i("6Htct").HandleActionType.Nested,type:"ai-action"})}}else l.push(tR({config:n,aiGlobalOptIn:a,intl:t,view:r}))}),l};function tL({isEmptyDoc:e,isEmptySelection:t},{emptyDocActions:n,nonEmptyDocActions:i,selectionActions:a}){return e?n:t?i:a}let tF=({aiGlobalOptIn:e,aiSmartButtonOptions:t,dispatch:n,dynamicSurfaceConfigItems:a,getIntl:r,proactiveAIApiUrl:o,product:s,api:l,getMentionNameDetails:c})=>{let d=r(),p=a.find(e=>e.config.key===i("bwpRs").CONFIG_ITEM_KEYS.IMPROVE_WRITING),{removeActions:u,removeContext:g,setActions:m,setContext:f}=t.actions;function h(){let e=l?.editorViewMode?.sharedState.currentState(),t=e?.mode;return!!(t&&"edit"===t)}return new(0,i("1S4f7").SafePlugin)({state:tw(n,tx()),key:tE,view:n=>{let r,{emptyDocActions:_,nonEmptyDocActions:y,selectionActions:I}=function({intl:e,dynamicSurfaceConfigItems:t,aiGlobalOptIn:n,view:i}){let{emptyDocConfigItems:a,nonEmptyDocConfigItems:r,selectionConfigItems:o}=function(e){let t=e.filter(e=>{let t=e.triggers.empty;return t&&t.enabled&&0===t.docMinSize});return{emptyDocConfigItems:t,nonEmptyDocConfigItems:e.filter(e=>{let t=e.triggers.empty;return t.enabled&&(!t.docMinSize||t.docMinSize>=0)}),selectionConfigItems:e.filter(e=>{let t=e.triggers.selection;return t.enabled&&(!t.selectionMinSize||t.selectionMinSize>=0)})}}(t),s=tD({aiGlobalOptIn:n,dynamicSurfaceConfigItems:a,intl:e})(i);return{emptyDocActions:s,nonEmptyDocActions:tD({aiGlobalOptIn:n,dynamicSurfaceConfigItems:r,intl:e})(i),selectionActions:tD({aiGlobalOptIn:n,dynamicSurfaceConfigItems:o,intl:e})(i)}}({aiGlobalOptIn:e,dynamicSurfaceConfigItems:a,intl:d,view:n}),E=h(),S=(0,i("2pjJ5").isEmptyDocument)(n.state.doc),b=n.state.selection.empty,T=!1;E&&m(function({isEmptyDoc:e,isEmptySelection:t},{emptyDocActions:n,nonEmptyDocActions:i,selectionActions:a}){return e?n:t?i:a}({isEmptyDoc:(0,i("2pjJ5").isEmptyDocument)(n.state.doc),isEmptySelection:n.state.selection.empty},{emptyDocActions:_,nonEmptyDocActions:y,selectionActions:I}));let C=d.formatMessage(i("7ShCl").aiMessages.aiSmartButtonDynamicSurfaceSelectedContent),A=()=>{n.focus()};if((0,i("dh538").fg)("platform_editor_ai_proactive_ai_nudge")){let a=p&&tO({configItem:p,intl:d,aiGlobalOptIn:e,editorView:n});r=a&&new tk(t,{locale:d.locale,getNudge:a,onCollectMetrics:e=>{let t=(0,i("4SGh1").addAnalytics)({editorState:n.state,tr:n.state.tr,payload:{action:"collected",actionSubject:"editorPluginAI",actionSubjectId:"nudgeMetrics",attributes:{nudgeMetrics:e},eventType:i("d925B").EVENT_TYPE.OPERATIONAL}});n.dispatch(t)},proactiveAIApiUrl:o,product:s,view:n,api:l,getMentionNameDetails:c}),r?.start()}function v(){u(),g(),r?.stop(),T=!0}return{update:(e,t)=>{let n=e.state,a=h(),o=!E&&a;if(E&&!a&&v(),E=a,!a||n.doc.eq(t.doc)&&n.selection.empty===t.selection.empty&&!o)return;let s=n.selection.empty,l=(0,i("2pjJ5").isEmptyDocument)(n.doc);(T||s!==b||l!==S)&&(m(function({isEmptyDoc:e,isEmptySelection:t},{emptyDocActions:n,nonEmptyDocActions:i,selectionActions:a}){return e?n:t?i:a}({isEmptyDoc:l,isEmptySelection:s},{emptyDocActions:_,nonEmptyDocActions:y,selectionActions:I})),b=s,S=l,T=!1),n.selection.empty?g():f({reference:C,onRemove:A,sourceId:"editor"}),r&&!e.state.doc.eq(t.doc)&&r.setLastDocChangeTime(Date.now())},destroy:()=>{v()}}}})},tG=(e,t)=>{let n=(0,i("kqrrC").getPluginState)(e.state);return!!(0,i("56Rej").hasGeneratedContentDecorations)(n)&&((0,i("5SuLc").createEndAIExperienceCommand)()(e.state,e.dispatch),!0)},tB=(e,t)=>()=>{let n;return t?.selectionMarker?{update:a=>{let r=e(a.state).modalDecorationSet!==i("ftzrq").DecorationSet.empty;r&&!n?n=t?.selectionMarker?.actions.hideDecoration():!r&&n&&(n(),n=void 0)},destroy:()=>{n?.()}}:{}},tU=e=>{let{dispatch:t,api:n,dispatchAnalyticsEvent:a,isInDocumentStreamingEnabled:r}=e;return new(0,i("1S4f7").SafePlugin)({key:i("3yUTv").aiExperienceDecorationPluginKey,state:(0,i("kqrrC").createPluginState)(t,(0,i("kqrrC").createInitialState)(a,r)),props:{handleDOMEvents:{click:tG},decorations:e=>(0,i("kqrrC").getPluginState)(e).modalDecorationSet},view:tB(i("kqrrC").getPluginState,n)})},tV=new(0,i("ks2lK").PluginKey)("ai-document-content-state"),tj=()=>new(0,i("1S4f7").SafePlugin)({key:tV,state:{init:(e,t)=>({hasVisibleContent:(0,i("2pjJ5").hasVisibleContent)(t.doc)}),apply(e,t,n,a){if(!e.docChanged)return t;let r=(0,i("2pjJ5").hasVisibleContent)(a.doc);return t.hasVisibleContent!==r?{hasVisibleContent:r}:t}}}),tH=new(0,i("ks2lK").PluginKey)("aiExperienceGetEditorView"),tz=({setEditorView:e})=>new(0,i("1S4f7").SafePlugin)({key:tH,view:t=>(e(t),{})}),tK=e=>{let t=document.createElement("span");t.setAttribute("data-testid","ai-in-editor-telepointer-widget"),t.className="ai-in-editor-telepointer";let n=document.createElement("span");return n.setAttribute("data-testid","ai-in-editor-telepointer-widget-label"),n.className="ai-in-editor-telepointer-label",n.append(e),t.appendChild(n),t},tW=(e,t)=>i("ftzrq").Decoration.widget(e,t,{side:0,key:"inEditorAIContentDecoration"});function tq({invokeAttributes:t,canInlineStreamChanges:n,onCommonAttributesUpdated:a,isInDocumentStreamingEnabled:r}){let o=(0,i("4SGh1").useFireAIAnalyticsEvent)(),s=e(g).useRef();return s.current||(s.current=(0,i("6gJll").createAnalyticsFlow)({fireAIAnalyticsEvent:o,invokeAttributes:t,canInlineStreamChanges:n,onCommonAttributesUpdated:a,isInDocumentStreamingEnabled:r})),s.current}let tY=e(g).createContext(void 0),t$=tY.Provider,tJ=()=>{let t=e(g).useContext(tY);if(!t)throw Error("No analyticsFlowInstance available in the context, make sure to have container wrapped with AnalyticsFlowContextProvider");return t};function tQ({stepName:t,attributes:n,needUpdatedArgs:i}){let a=tJ(),r=(0,g.useRef)({stepName:void 0,attributes:void 0});return(0,g.useEffect)(()=>{r.current={stepName:t,attributes:n}}),e(g).useEffect(()=>(a.fireQueuedStep(t),()=>{i&&r.current.stepName?a.enqueueStep({stepName:r.current.stepName,attributes:r.current.attributes}):a.enqueueStep({stepName:t,attributes:n})}),[]),a}let tX=({nodeType:e,schema:t})=>{let{table:n,tableRow:i,tableHeader:a,tableCell:r}=t.nodes;return[n,i,a,r].includes(e)},tZ=(e,t)=>{let n=0,i=e;for(;i&&i!==t;)n+=i.offsetTop,i=i.offsetParent;return n};function t0({pos:t,tr:n}){let i=n.mapping.map(t,-1);return n.getMeta("isAIStreamingTransformation")&&i>t&&n.mapping.map(t-1,-1)+1===t&&(i=t),e(eO)(i,0,n.doc.content.size)}function t1({pos:t,tr:n}){let i=n.mapping.map(t,1);if(n.getMeta("isAIStreamingTransformation")&&i===t){let e=n.mapping.map(t+1,1)-1;e!==t&&(i=e)}return e(eO)(i,0,n.doc.content.size)}let t5=e=>{let t=!0;return e.forEach(e=>{if(t)try{e.check()}catch(e){t=!1}}),t},t2=({api:t,configItem:n,isProgrammaticScroll:a,view:r,positions:o,modalRef:s,aiSessionId:l})=>{let c=(0,i("hX9je").isSuggestTitleForConfluence)(n),d=!c,[p,u]=(0,g.useState)(!0),[m,f]=(0,g.useState)(),h=(0,g.useRef)(null),_=(0,g.useRef)(),y=(0,g.useRef)(),I=(0,g.useRef)(!1),E=tJ().getUnifiedEventData();(0,g.useEffect)(()=>{let e=r.dom,t=(0,i("7YjFd").findOverflowScrollParent)(e);t&&(h.current=t)},[r]),(0,g.useEffect)(()=>{if(void 0!==m&&h.current){let e=r.coordsAtPos(m),t=r.coordsAtPos(0).top,n=s?.current?.offsetHeight||0,i=tZ(r.dom,h.current),o=i+e.top-t-32,l=i+e.bottom-t+n+32-h.current.offsetHeight;a.current=!0,h.current.scrollTop>o?h.current.scroll({top:o,behavior:"instant"}):h.current.scrollTop<l&&h.current.scroll({top:l,behavior:"instant"})}},[r,m,s,a]);let S=o[0]===o[1],b=o[0],T=S&&!n.insertOnEmptySelection,[C,A]=T?[1,r.state.doc.content.size-1]:o,v=!c,P=!T;(0,g.useEffect)(()=>{if(S&&n.insertOnEmptySelection||!v)return;let e=setInterval(()=>{p||(void 0!==(i("5vNOi").inEditorDirectStreamingPluginKey.getState(r.state)||{}).aiContentEndPos?clearInterval(e):r.dispatch((0,i("eyHC2").updateLoadingPositions)(r.state.tr)))},160*Math.random()+80);return()=>{clearInterval(e)}},[r,p,n.insertOnEmptySelection,S,v]);let k=(0,g.useCallback)(()=>{if(void 0===(i("5vNOi").inEditorDirectStreamingPluginKey.getState(r.state)||{chunkNumber:0}).startPos){t?.trackChanges?.sharedState.currentState()?.isDisplayingChanges&&t?.core.actions.execute(t?.trackChanges?.commands.toggleChanges),(0,i("5SuLc").clearSelectionDecorations)(r.state)(r.state,r.dispatch),u(!1),_.current=r.state.doc.slice(C,A);let e=r.state.doc.resolve(C),n=e.pos,a=e.node()?.firstChild;for(;a&&a.firstChild&&!a.isLeaf;)n+=1,a=a.firstChild;let o=i("3yUTv").aiExperienceDecorationPluginKey.getState(r.state);return r.dispatch((0,i("ke2AI").closeHistory)((0,i("eyHC2").initPositions)({start:C,end:A,showHighlight:v&&o?.withStreamingHighlight!==!1,showAIContentHighlight:P,showTelepointer:d,telepointerPos:n})((0,i("kTCUV").startWatchingAnnotationChanges)({from:C,to:A})(r.state.tr)))),f(C),()=>{u(!0)}}},[t,r,C,A,v,P,d]),x=(0,g.useCallback)(e=>{let{startPos:t,userContentEndPos:n,streamTimeStamp:a}=i("5vNOi").inEditorDirectStreamingPluginKey.getState(r.state)||{};return void 0!==t&&void 0!==n&&_.current?(e=-1===_.current.size?e.delete(t,n):e.replaceRange(t,n,_.current),e=(0,i("eyHC2").metaTransaction)({tr:e,isFinalStream:!1,stackTime:a})):e},[r]),w=(0,g.useCallback)(({tr:e,slice:t})=>{let{startPos:n,userContentEndPos:a,streamTimeStamp:o}=i("5vNOi").inEditorDirectStreamingPluginKey.getState(r.state)||{};if(void 0===n||void 0===a||!_.current)return e;if((0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")){let{paragraph:r}=e.doc.type.schema.nodes;e=t.content.firstChild===t.content.lastChild&&t.content.firstChild?.type===r&&e.selection.$from===e.selection.$to&&(0,i("l9G9n").isEmptyParagraph)(e.selection.$from.parent)?e.replaceRangeWith(n,a<n?n:a,t.content.firstChild):e.replaceRange(n,a<n?n:a,t)}else e=e.replaceRange(n,a<n?n:a,t);return(e=(e=(0,i("eyHC2").metaTransaction)({tr:e,isFinalStream:!0,stackTime:o})).setSelection(i("ks2lK").TextSelection.create(e.doc,Math.min(e.selection.to,e.doc.content.size)))).doc.slice(t0({pos:n,tr:e}),t1({pos:a,tr:e})).eq(_.current)&&(e=e.setMeta("addToHistory",!1)),e},[r]),M=(0,g.useRef)(!1);return{mountDecorations:k,updateStream:(0,g.useCallback)(({fragment:n,isFinalStream:o=!1,hasUserScrolled:d=!0})=>{try{if(o){if(I.current)return;I.current=!0}let p=h.current?.scrollTop;if(c)return void function({editorView:e,pmFragment:t}){let n="";t.forEach(e=>{n+=e.textContent});let a=document.querySelector('textarea[data-ai-suggest-title-target="true"]');if(a){let t=(0,i("2e7rb").findEditorIdFromView)(e);t&&(i("jOIil").eventHub.publishFromEditor({event:"replace title in confluence",data:{analyticSourceId:"confluenceTitleToolbar",sourceEditorId:t,title:n}}),a.scrollIntoView({block:"nearest"}))}}({editorView:r,pmFragment:n});let u=i("5vNOi").inEditorDirectStreamingPluginKey.getState(r.state),{startPos:g,userContentEndPos:m}=u||{},{aiContentEndPos:f,streamTimeStamp:b}=u||{};if(void 0===g||void 0===m)return;let{expand:T,nestedExpand:C}=r.state.schema.nodes,A=i("5SAOw").Slice.maxOpen(n);if(A.size<=0&&!o)return;A.content.firstChild||(A=i("5SAOw").Slice.empty),t5(n)||r.dispatch((0,i("eyHC2").updateStreamPositions)({aiContentEndPos:u?.aiContentEndPos,telepointerPos:u?.telepointerPos,isFinalStream:o})(r.state.tr)),M.current||(M.current=!0,S?{startPos:g,userContentEndPos:m}=function({view:e,fragment:t,startPos:n,userContentEndPos:a}){let{paragraph:r,listItem:o,taskItem:s,decisionItem:l}=e.state.schema.nodes,c={startPos:n,userContentEndPos:a},d=e.state.doc.resolve(n),p=d.parent,u=p.type===r&&d.node(d.depth-1)?.type===o,g=p.type===s,m=p.type===l;if(!(u||g||m))return c;let f=e.state.doc.resolve(a),h=f.parent,_=t.firstChild,y=1===t.childCount&&_&&_.isBlock,I=y&&_.type.name!==p.type.name,E=y&&_.type.name!==h.type.name,S=n,b=a;if(I)for(let e=d.depth,t=1;e>0&&!d.node(e).type.contentMatch.matchType(_.type)&&d.before(e)+t===n;e--,t++,S--);if(E)for(let e=f.depth,t=1;e>0&&!f.node(e).type.contentMatch.matchType(_.type)&&f.after(e)-t===a;e--,t++,b++);if(S!==c.startPos||b!==c.userContentEndPos){let t=b-a>=n-S?b:S;return e.dispatch((0,i("eyHC2").adjustInitPositions)({start:t,end:t})(e.state.tr)),{startPos:t,userContentEndPos:t}}return c}({view:r,fragment:n,startPos:g,userContentEndPos:m}):{startPos:g}=function({view:e,fragment:t,startPos:n,userContentEndPos:a}){let{paragraph:r}=e.state.schema.nodes,o={startPos:n,userContentEndPos:a},s=e.state.doc.resolve(n);if(s.depth>0&&s.before()!==n-1)return o;let l=[],c=t.firstChild;for(;c&&c.firstChild;)l.push(c.type),c=c.firstChild;if(l.reverse(),1===l.length&&l[0]===r)return o;let d=n;for(c=s.parent.firstChild;c&&c.firstChild;)d++,c=c.firstChild;s=e.state.doc.resolve(d);for(let e=0,t=s.depth;t>0&&s.node(t).type===l[e]&&s.before(t)+1===d;e++,t--,d--);return d<o.startPos?(e.dispatch((0,i("eyHC2").adjustInitPositions)({start:d,end:o.userContentEndPos})(e.state.tr)),{startPos:d,userContentEndPos:o.userContentEndPos}):o}({view:r,fragment:n,startPos:g,userContentEndPos:m}));let v=o?m:Math.min(Math.max(f||0,g+A.size+1),m);({startPos:g,toPos:v}=function({view:e,startPos:t,toPos:n,userContentEndPos:a}){let r=e.state.doc.resolve(t),o=e.state.doc.resolve(n),s=(0,i("cVxBN").isWithinSameCell)({$from:r,$to:o,schema:e.state.schema}),l=s?void 0:function({schema:e,resolvedPos:t}){for(let n=t.depth;n>0;n--)if(t.node(n).type===e.nodes.tableRow)return t.start(n)}({schema:e.state.schema,resolvedPos:r}),c=s?void 0:function({schema:e,resolvedPos:t}){for(let n=t.depth;n>0;n--)if(t.node(n).type===e.nodes.tableRow){let e=t.node(n-1),a=t.start(n-1),r=i("LmqWp").TableMap.get(e),{mapByRow:o}=r,s=o.findIndex(e=>e.includes(t.start(n)-a));if(-1===s)return;if(s+1===r.height){let e=t.doc.resolve(a+o[s][0]);return e.end(e.depth)}for(let e=s+1;e<r.height;e++){let n=o[e-1],i=o[e];if(n.every((e,t)=>e!==i[t])){let e=t.doc.resolve(a+n[0]);return e.end(e.depth)}if(e===r.height-1){let e=t.doc.resolve(a+i[0]);return e.end(e.depth)}}}}({schema:e.state.schema,resolvedPos:o});return void 0!==l&&(t=l),void 0!==c&&(n=Math.min(c,a)),{startPos:t,toPos:n}}({view:r,fragment:n,startPos:g,toPos:v,userContentEndPos:m})),y.current=A=function({slice:e,startPos:t,toPos:n,view:a}){let r=e.content,o=r.firstChild;if(o){let n=tX({nodeType:o.type,schema:a.state.schema}),s=(0,i("cVxBN").getPositionNodeTypeDepth)({resolvedPos:a.state.doc.resolve(t),nodeType:a.state.schema.nodes.table});if(!(n&&s)){let n=a.state.doc.resolve(t).node(1);n&&o.type===n.type||(e=new(0,i("5SAOw").Slice)(r,0,e.openEnd))}}let s=r.lastChild;if(s){let t=tX({nodeType:s.type,schema:a.state.schema}),o=(0,i("cVxBN").getPositionNodeTypeDepth)({resolvedPos:a.state.doc.resolve(n),nodeType:a.state.schema.nodes.table});if(!(t&&o)){let t=a.state.doc.resolve(n).node(1);t&&s.type===t.type||(e=new(0,i("5SAOw").Slice)(r,e.openStart,0))}}return e}({slice:A,startPos:g,toPos:v,view:r});let P=r.state.tr;if(o&&_.current){r.dispatch(x(r.state.tr));let e=i("5vNOi").inEditorDirectStreamingPluginKey.getState(r.state);g=e?.startPos||g,v=e?.userContentEndPos||v,P=w({tr:r.state.tr,slice:A}),"streamingApi"!==E.invokedFrom&&t?.analytics?.actions.fireAnalyticsEvent((0,i("ilIeg").createUnifiedAnalyticsPayload)({action:i("d925B").ACTION.VIEWED,...E,interactionID:l}))}else P=r.state.tr.replaceRange(g,v<g?g:v,A).setMeta("ignoreLocalIdUpdate",!0),P=(0,i("eyHC2").metaTransaction)({tr:P,isFinalStream:!1,stackTime:b});let k=t0({pos:g,tr:P}),N=t1({pos:v,tr:P}),O=N;if(P.doc.nodesBetween(k,N,(e,t)=>{e.isLeaf&&(O=t+e.nodeSize)}),O=Math.min(O,N),r.dispatch((0,i("eyHC2").updateStreamPositions)({aiContentEndPos:v,telepointerPos:O,isFinalStream:o})(P)),(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")?t?.core.actions.execute(t?.expand?.commands.toggleExpandRange(k,Math.min(N,r.state.doc.content.size))):r.state.doc.nodesBetween(k,Math.min(N,r.state.doc.content.size),e=>{[T,C].includes(e.type)&&i("adayn").expandedState.set(e,!0)}),a.current=!0,!d&&h.current){let t=s?.current?.offsetHeight||0;N=e(eO)(N,0,r.state.doc.content.size);let n=r.coordsAtPos(N).bottom;0===n&&(n=r.coordsAtPos(N-1).bottom);let i=tZ(r.dom,h.current)+r.coordsAtPos(N).bottom-r.coordsAtPos(0).top+t+32-h.current.offsetHeight;h.current.scrollTop<i&&h.current?.scroll({top:i,behavior:"instant"})}else h.current&&h.current.scrollTop!==p&&h.current.scroll({top:p,behavior:"instant"})}catch(s){let e=i("2QlXt").ErrorUtils.extractErrorMessage(s),a="";if(s instanceof Error&&(a=s.stack||"",(0,i("hWRJP").logException)(s,{location:"editor-ai-streaming-update-stream",isFinalStream:o,docSize:r.state.doc.content.size,fragmentSize:n.size})),t?.analytics?.actions.fireAnalyticsEvent({action:i("d925B").ACTION.ERRORED,actionSubject:i("d925B").ACTION_SUBJECT.AI_STREAMING,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.UPDATE_STREAM,eventType:i("d925B").EVENT_TYPE.OPERATIONAL,attributes:{errorMessage:e,errorStack:a,isFinalStream:o,docSize:r.state.doc.content.size,fragmentSize:n.size}}),o)throw s}},[t,r,s,c,x,w,S,a,E,l]),discardStream:(0,g.useCallback)(({restoreSelection:e=!0}={})=>{let{startPos:n,userContentEndPos:a}=i("5vNOi").inEditorDirectStreamingPluginKey.getState(r.state)||{};if(void 0!==n&&void 0!==a&&_.current)try{if(!(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")||y.current){(0,i("ke2AI").undo)(r.state,r.dispatch);let e=i("5vNOi").inEditorDirectStreamingPluginKey.getState(r.state);n=e?.startPos||n,a=e?.userContentEndPos||a}let t=r.state.tr;(0,i("ke2AI").closeHistory)(t);let o=i("3yUTv").aiExperienceDecorationPluginKey.getState(r.state);if(e&&!o?.sessionEnded){let e=1,r=1;S?r=e=b:(e=t0({pos:n,tr:t}),r=t1({pos:a,tr:t}),o&&o.initialSelection&&o.initialSelection.head<o.initialSelection.anchor&&([e,r]=[r,e])),t.setSelection(i("ks2lK").TextSelection.create(t.doc,e,r))}t=(0,i("eyHC2").endStream)(t),r.dispatch(t)}catch(a){let e=i("2QlXt").ErrorUtils.extractErrorMessage(a),n="";a instanceof Error&&(n=a.stack||"",(0,i("hWRJP").logException)(a,{location:"editor-ai-streaming-discard-stream"})),t?.analytics?.actions.fireAnalyticsEvent({action:i("d925B").ACTION.ERRORED,actionSubject:i("d925B").ACTION_SUBJECT.AI_STREAMING,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.DISCARD_STREAM,eventType:i("d925B").EVENT_TYPE.OPERATIONAL,attributes:{errorMessage:e,errorStack:n}})}finally{_.current=void 0,y.current=void 0}},[t,r,S,b]),resetHasFinalStreamRef:()=>I.current=!1}},t8={showHighlight:!1,showAIContentHighlight:!1,showTelepointer:!1,isStreaming:!1,isStreamingFinished:!1,startPos:void 0,loadingPos:void 0,userContentEndPos:void 0,aiContentEndPos:void 0,telepointerPos:void 0,isFinalStream:!1,chunkNumber:0,streamTimeStamp:void 0},t4=e=>{let t=tK(e.getIntl().formatMessage(i("7ShCl").aiMessages.aiRovoTelepointer));return new(0,i("1S4f7").SafePlugin)({key:i("5vNOi").inEditorDirectStreamingPluginKey,state:{init:()=>t8,apply:(e,t)=>{let n=e.getMeta(i("5vNOi").inEditorDirectStreamingPluginKey),a=t;if(n?.action)switch(n.action){case i("9F9dO").ACTIONS.INIT_POSITIONS:{let{positions:e,showHighlight:t,showAIContentHighlight:i,showTelepointer:r}=n,{startPos:o,userContentEndPos:s,telepointerPos:l}=e;a={...a,showHighlight:t,showAIContentHighlight:i,showTelepointer:r,isStreaming:!0,isStreamingFinished:!1,startPos:o,loadingPos:o,userContentEndPos:s,telepointerPos:l,aiContentEndPos:void 0,streamTimeStamp:Date.now()};break}case i("9F9dO").ACTIONS.ADJUST_INIT_POSITIONS:{let{positions:e}=n,{startPos:t,userContentEndPos:i}=e;a={...a,startPos:t,userContentEndPos:i};break}case i("9F9dO").ACTIONS.UPDATE_LOADING_POSITIONS:{let{startPos:n,userContentEndPos:i,loadingPos:r}=t;if(void 0===n||void 0===i)break;let o=r||n,s=(i-o)/8,l=Math.floor(o+s),c=Math.ceil(Math.random()*(Math.ceil(o+3*s)-l)+l);a={...a,loadingPos:e.mapping.map(c,-1)};break}case i("9F9dO").ACTIONS.UPDATE_STREAM_POSITIONS:{let{positions:e,isFinalStream:t}=n,{aiContentEndPos:i,telepointerPos:r}=e;a={...a,...t?{showHighlight:!1,showAIContentHighlight:!1,showTelepointer:!1}:{},loadingPos:void 0,aiContentEndPos:i,telepointerPos:r,isFinalStream:t,isStreaming:!t,isStreamingFinished:t,chunkNumber:a.chunkNumber+1,streamTimeStamp:a.streamTimeStamp?a.streamTimeStamp+1:void 0};break}case i("9F9dO").ACTIONS.END_STREAM:return{...t8,telepointerPos:a.telepointerPos}}else a={...a,...void 0!==a.loadingPos&&{loadingPos:e.mapping.map(a.loadingPos,-1)},...void 0!==a.telepointerPos&&{telepointerPos:e.mapping.map(a.telepointerPos,-1)}};return{...a,...void 0!==a.startPos&&{startPos:t0({pos:a.startPos,tr:e})},...void 0!==a.userContentEndPos&&{userContentEndPos:t1({pos:a.userContentEndPos,tr:e})},...void 0!==a.aiContentEndPos&&{aiContentEndPos:t1({pos:a.aiContentEndPos,tr:e})}}}},props:{decorations:e=>{let{showHighlight:n,showAIContentHighlight:a,showTelepointer:r,startPos:o,userContentEndPos:s,aiContentEndPos:l,telepointerPos:c,loadingPos:d,isFinalStream:p,isStreaming:u}=i("5vNOi").inEditorDirectStreamingPluginKey.getState(e)||{},g=[];if(!u||void 0===o){let{nextSessionId:n}=i("3yUTv").aiExperienceDecorationPluginKey.getState(e)||{};return n&&void 0!==c?i("ftzrq").DecorationSet.create(e.doc,[tW(c,t)]):i("ftzrq").DecorationSet.empty}if(n&&(void 0!==d?g.push(i("ftzrq").Decoration.inline(o,d,{class:"ai-in-editor-user-content","data-testid":"ai-in-editor-user-content"})):void 0!==s&&g.push(i("ftzrq").Decoration.inline(l||o,s,{class:"ai-in-editor-user-content","data-testid":"ai-in-editor-user-content"})),a&&void 0!==l&&g.push(i("ftzrq").Decoration.inline(o,l,{class:"ai-in-editor-ai-content","data-testid":"ai-in-editor-ai-content"}))),!1===p&&r)g.push(tW(c||l||o,t));else{let{nextSessionId:n}=i("3yUTv").aiExperienceDecorationPluginKey.getState(e)||{};n&&void 0!==c&&g.push(tW(c,t))}return g.length?i("ftzrq").DecorationSet.create(e.doc,g):i("ftzrq").DecorationSet.empty}},view(){let t,n,a,r=!1,o=!1,s=!1;return{update(l){let{currentSessionId:c}=i("3yUTv").aiExperienceDecorationPluginKey.getState(l.state)||{},{isStreaming:d=!1,isStreamingFinished:p=!1}=i("5vNOi").inEditorDirectStreamingPluginKey.getState(l.state)||{},u=!!c||d||p,g=l?.dom.closest(".ak-editor-content-area");void 0===t&&g&&(t=g.tabIndex,n=g.style.outlineColor,a=g.style.outline),u!==o&&(u&&!s?(s=!0,e.api?.core.actions.execute(e.api?.selection?.commands.hideCursor(!0))):!u&&s&&(s=!1,e.api?.core.actions.execute(e.api?.selection?.commands.hideCursor(!1)))),u&&!r&&(r=!0,e.api?.core?.actions.execute(({tr:t})=>(e.api?.trackChanges?.commands.resetBaseline({tr:t}),e.api?.userIntent?.commands.setCurrentUserIntent("aiStreaming")({tr:t}),e.api?.editorDisabled?.commands.toggleDisabled(!0)({tr:t}),t)),g&&(g.tabIndex=-1,(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")?g.style.outline="none":g.style.outlineColor="transparent",g.focus())),!u&&r&&(r=!1,e.api?.core?.actions.execute(({tr:t})=>(e.api?.userIntent?.commands.setCurrentUserIntent("default")({tr:t}),e.api?.editorDisabled?.commands.toggleDisabled(!1)({tr:t}),t)),g&&(void 0!==t&&(-1===t?g.removeAttribute("tabindex"):g.tabIndex=t),void 0!==n&&(g.style.outlineColor=n,""===g.getAttribute("style")&&g.removeAttribute("style")),void 0!==a&&(g.style.outline=a,""===g.getAttribute("style")&&g.removeAttribute("style")))),o=u}}}})};var t3=((s={}).ENTER_BUTTON="enterKeydown",s.TAB_BUTTON="tabKeydown",s.ESCAPE_BUTTON="escapeKeydown",s.TOOLBAR="toolbar",s);let t9=new(0,i("ks2lK").PluginKey)("aiInlineSuggestion");var t6=((l={}).CLEAR_INLINE_SUGGESTION="CLEAR_INLINE_SUGGESTION",l.UPDATE_INLINE_SUGGESTION="UPDATE_INLINE_SUGGESTION",l.UPDATE_LOCALE="UPDATE_LOCALE",l);let t7=({locale:e})=>({inlineSuggestion:null,locale:e,decorationSet:i("ftzrq").DecorationSet.empty,inlineSuggestionSessionId:null}),{createPluginState:ne,createCommand:nt,getPluginState:nn}=(0,i("lkJUe").pluginFactory)(t9,(t,n)=>{switch(n.type){case t6.CLEAR_INLINE_SUGGESTION:return{...t,inlineSuggestion:null,decorationSet:i("ftzrq").DecorationSet.empty,inlineSuggestionSessionId:null};case t6.UPDATE_INLINE_SUGGESTION:{let i=null;return n.payload.inlineSuggestion&&(i=t.inlineSuggestion?t.inlineSuggestionSessionId:e(er)()),{...t,inlineSuggestion:n.payload.inlineSuggestion,decorationSet:n.payload.decorationSet,inlineSuggestionSessionId:i}}case t6.UPDATE_LOCALE:return{...t,locale:n.payload.locale};default:return t}},{onSelectionChanged:function(e,t){let{inlineSuggestion:n}=t;if(!n)return t;let{from:a,to:r}=n,{from:o,to:s}=e.selection;return!function({selectionFrom:e,selectionTo:t,suggestionFrom:n,suggestionTo:i}){return t<n||e>i}({selectionFrom:o,selectionTo:s,suggestionFrom:a,suggestionTo:r})?t:{...t,inlineSuggestion:null,decorationSet:i("ftzrq").DecorationSet.empty,inlineSuggestionSessionId:null}},mapping:function(e,t,n){let{inlineSuggestion:i}=t;return i?{...t,inlineSuggestion:{...i,from:e.mapping.map(i.from),to:e.mapping.map(i.to)},decorationSet:t.decorationSet.map(e.mapping,e.doc)}:t}});function ni(){return nt(()=>({type:t6.CLEAR_INLINE_SUGGESTION}))}var na=i("8Yfbq");class nr{static getTextPhrasesAroundCursor(e){let{selection:t}=e;if(!t||t.from!==t.to)return[];let{$from:n}=t,i=n.parent,a=n.start(n.depth),r=n.parentOffset,o=this.extractPlainTextSegments(i),s=this.findSegmentForCursor(o,r);if(!s)return[];let l=r-s.from,c=this.extractWordsFromSegment(s);if(!c.length||!this.isCursorTouchingWord(c,l))return[];let d=this.findCentralWordIndex(c,l),{nearbyWords:p,centralWordPos:u}=this.extractNearbyWords(c,d,a,s.from);return this.generateTextPhrases(p,u)}static extractPlainTextSegments(e){let t=[],n=null,i=()=>{n&&(t.push(n),n=null)},a=e=>e.isText&&!e.marks?.some(e=>"link"===e.type.name);return e.forEach((e,t)=>{if(a(e)){let a=e.text||"";n&&t===n.to?(n.text+=a,n.to+=a.length):(i(),n={text:a,from:t,to:t+a.length})}else i()}),i(),t}static findSegmentForCursor(e,t){return e.find(e=>t>=e.from&&t<=e.to)||null}static isCursorTouchingWord(e,t){return e.some(e=>t>=e.start&&t<=e.end)}static extractWordsFromSegment(e){let t=[];for(let n of e.text.matchAll(this.WORD_REGEX))t.push({text:n[0],start:n.index,end:n.index+n[0].length});return t}static findCentralWordIndex(e,t){if(0===e.length)return 0;let n=e.length-1;if(t>e[n].end)return n;let i=e.findIndex(e=>e.start<=t&&e.end>=t);return -1===i&&(i=e.findIndex(e=>e.end===t)),-1===i?n:i}static extractNearbyWords(e,t,n,i){let a=e=>({word:e.text,from:n+i+e.start,to:n+i+e.end}),r=Math.max(0,t-this.WORDS_BEFORE_CENTRAL),o=e.slice(r,t+1).map(a),s=e.slice(t+1,t+1+this.WORDS_AFTER_CENTRAL).map(a);return{nearbyWords:o.concat(s),centralWordPos:o.length-1}}static generateTextPhrases(e,t){let n=[];for(let i=0;i<=t;i++)for(let a=t;a<e.length;a++){let t=e.slice(i,a+1).map(e=>e.word).join(" ");n.push({phrase:t,from:e[i].from,to:e[a].to})}return n}}nr.WORD_REGEX=/\S+/gu,nr.WORDS_BEFORE_CENTRAL=4,nr.WORDS_AFTER_CENTRAL=2;let no=["en-US","en-GB"],ns=e=>no.includes(e),nl=["d MMM yyyy","d MMMM yyyy","MMMM d', 'yyyy","MMMM d yyyy","MMM d', 'yyyy","MMM d yyyy","do 'of' MMMM yyyy","d MMMM","d MMM","MMMM d","MMM d","do MMMM","do MMM","MMMM do","MMM do","do 'of' MMMM","do 'of' MMM"],nc={"en-US":["M/d/yyyy","M-d-yyyy","yyyy-MM-dd","yyyy/MM/dd","M/d",...nl],"en-GB":["d/M/yyyy","d-M-yyyy","yyyy-MM-dd","yyyy/MM/dd","d/M",...nl]},nd={"en-US":i("9gbhg").default,"en-GB":i("e6KrE").default};class np{static getSelectedLocale(e){let t=nn(e);return t?.locale||"en-US"}}np.LOCALES=nd;class nu{static isPotentialDateString(e){return this.REGEXES.DIGITS.test(e)&&e.length>=this.MIN_DATE_LENGTH&&e.length<=this.MAX_DATE_LENGTH}static containsAmbiguousMonth(e){let t=e.match(this.REGEXES.ALL_ALPHABET_CHARS);return!!t&&2>=t.reduce((e,t)=>Math.max(e,t.length),0)}static containsYear(e){return e.includes("y")}static isEnteredDateAfterToday(e){let t=new Date,n=t.getDate(),i=t.getMonth()+1;return i===e.getMonth()+1&&n===e.getDate()||i<e.getMonth()+1||i===e.getMonth()+1&&n<e.getDate()}static normaliseYear(e,t){let n=e.getFullYear(),a=this.isEnteredDateAfterToday(e);return n<100?e=(0,i("2wblJ").default)(e,n<this.SHORT_YEAR_CUTOFF?2e3:1900):n<1e3?e=(0,i("2wblJ").default)(e,2e3):!this.containsYear(t)&&(0,td.expValEquals)("platform_editor_ai_exp_inline_date_year_refresh","isEnabled",!0)&&(e=(0,i("2wblJ").default)(e,+!a)),e}static analyzeDelimiters(e){let t=new Set(e.match((0,td.expValEquals)("platform_editor_ai_exp_suggestion_date_comma_delim","isEnabled",!0)?this.REGEXES.ALL_DATE_DELIMITERS_COMMA:this.REGEXES.ALL_DATE_DELIMITERS)||[]).size>1,n=e.match((0,td.expValEquals)("platform_editor_ai_exp_suggestion_date_comma_delim","isEnabled",!0)?this.REGEXES.TRAILING_DATE_DELIMITER_COMMA:this.REGEXES.TRAILING_DATE_DELIMITER),i=null,a=e;return n&&(i=n[0],a=e.slice(0,-1)),{hasMixedDelimiters:t,trailingDelimiter:i,strippedInput:a}}static tryAllFormats(e,t,n){if(!ns(n))return null;let a=np.LOCALES[n];for(let r of this.DATE_FORMATS_BY_LOCALE[n]){let n=(0,i("bJbIe").default)(e,r,new Date,{locale:a});if((0,i("cFEpk").default)(n))return{date:this.normaliseYear(n,r),matchedFormat:r,trailingDelimiter:t}}return null}static parse(e,t){if(!this.isPotentialDateString(e)||this.containsAmbiguousMonth(e))return null;let{hasMixedDelimiters:n,trailingDelimiter:i,strippedInput:a}=this.analyzeDelimiters(e);return n?null:this.cache.get(`${t}:${e}`,()=>this.tryAllFormats(a,i,t))}static extractDelimiterFromFormat(e){return e.match(this.REGEXES.NON_ALPHABET_CHARS)?.[0]??" "}}nu.MIN_DATE_LENGTH=3,nu.MAX_DATE_LENGTH=20,nu.SHORT_YEAR_CUTOFF=60,nu.DATE_FORMATS_BY_LOCALE=nc,nu.REGEXES={TRAILING_DATE_DELIMITER_COMMA:/[-/.,]$/u,ALL_DATE_DELIMITERS_COMMA:/[-/.,]/gu,TRAILING_DATE_DELIMITER:/[-/.]$/u,ALL_DATE_DELIMITERS:/[-/.]/gu,NON_ALPHABET_CHARS:/[^A-Za-z]/u,ALL_ALPHABET_CHARS:/[A-Za-z]+/gu,DIGITS:/\d/u},nu.cache=new class{get(e,t){if(this.store.has(e)){let t=this.store.get(e);if(t)return t}let n=t();return n&&this.set(e,n),n}set(e,t){if(this.store.size>=this.maxSize){let e=this.store.keys().next().value;e&&this.store.delete(e)}this.store.set(e,t)}constructor(e=1e4){this.maxSize=e,this.store=new Map,this.maxSize=e}};class ng{static getDateOnlyUtcTimestamp(e){return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}static canInsertDateNode(e,t){let n=e?.schema?.nodes?.date;if(!n)return!1;let i=e.doc.resolve(t);return i.parent.canReplaceWith(i.index(),i.index(),n)}}class nm{static sortByDescendingRangeLength(e){return e.slice().sort((e,t)=>{let n=e.to-e.from;return t.to-t.from-n})}static findFirstValidDatePhrase(e,t){for(let n of e){let e=nu.parse(n.phrase,t);if(e)return{phrase:n,result:e}}return null}}let nf={type:"date",detect(e,t){let n=np.getSelectedLocale(e),i=nm.sortByDescendingRangeLength(t),a=nm.findFirstValidDatePhrase(i,n);return a&&ng.canInsertDateNode(e,a.phrase.from)?{id:(0,eI.v4)(),type:"date",from:a.phrase.from,to:a.phrase.to,metadata:{date:a.result.date,matchedFormat:a.result.matchedFormat,trailingDelimiter:a.result.trailingDelimiter},isPartial:!a.result.matchedFormat.includes("y")}:null},createMarkers(e){let{from:t,to:n}=e;return[{style:"highlight",from:t,to:n},{style:"underline",from:t,to:n}]},createCompletionHint(e){if(!e.isPartial)return null;let{date:t,matchedFormat:n,trailingDelimiter:i}=e.metadata,a=nu.extractDelimiterFromFormat(n);return i&&i===a?{hintText:`${t.getFullYear()}`}:{hintText:`${a}${t.getFullYear()}`}},createReplacement(e,t){let{date:n}=e.metadata,i=ng.getDateOnlyUtcTimestamp(n);return t.nodes.date.create({timestamp:String(i)})}};class nh{detectFirstSuggestion(e,t){for(let n of this.handlers){let i=n.detect(e,t);if(i){let t=n.createReplacement(i,e.schema);return{...i,suggestedNode:t}}}return null}scheduleScanForSuggestions(e){this.throttledDetection(e)}cancelSuggestionScans(){this.throttledDetection.cancel()}createMarkerDecoration(e){let t=nh.INLINE_SUGGESTION_DECORATION_CLASSES[e.style],n=[e.cssClass,t].filter(Boolean).join(" ");return i("ftzrq").Decoration.inline(e.from,e.to,{class:n.trim()})}createToolbarDecoration(e,t){return i("ftzrq").Decoration.inline(e,t,{class:nh.INLINE_SUGGESTION_DECORATION_CLASSES.toolbarAnchor})}createCompletionHintDecorations(e,t){let n=this.handlers.find(t=>t.type===e.type);if(n&&n.createCompletionHint){let a=n.createCompletionHint(e,t);if(a)return[i("ftzrq").Decoration.widget(e.to,()=>{let e=document.createElement("span");e.className=[nh.INLINE_SUGGESTION_DECORATION_CLASSES.completionHint,nh.INLINE_SUGGESTION_DECORATION_CLASSES.underline,nh.INLINE_SUGGESTION_DECORATION_CLASSES.highlight].join(" ");let t=document.createElement("span");return t.textContent=a.hintText,e.appendChild(t),e},{side:1,type:nh.DECORATION_TYPES.completionHint})]}return[]}rebuildSuggestionDecorations(e,t,n){if(!e)return i("ftzrq").DecorationSet.empty;let a=n.find(e.from,e.to),r=n.remove(a),o=this.handlers.find(t=>t.type===e.type);if(!o)return r;let s=[...o.createMarkers(e,t).map(e=>this.createMarkerDecoration(e)),this.createToolbarDecoration(e.from,e.to)],l=this.createCompletionHintDecorations(e,t);return s.push(...l),r.add(t.doc,s)}constructor(){this.THROTTLE_MS=100,this.handlers=[nf],this.throttledDetection=e(na)(e=>{try{let{state:t,dispatch:n}=e,i=nn(t),a=i.inlineSuggestion,r=i.decorationSet,o=nr.getTextPhrasesAroundCursor(t),s=this.detectFirstSuggestion(t,o);if(null===a&&null===s)return;let l=this.rebuildSuggestionDecorations(s,t,r);nt(()=>({type:t6.UPDATE_INLINE_SUGGESTION,payload:{inlineSuggestion:s,decorationSet:l}}))(t,n)}catch(e){}},this.THROTTLE_MS,{leading:!1,trailing:!0})}}nh.INLINE_SUGGESTION_DECORATION_CLASSES={underline:"proactive-ai-inline-suggestion-underline",highlight:"proactive-ai-inline-suggestion-highlight",toolbarAnchor:"proactive-ai-inline-suggestion-floating-toolbar-anchor",completionHint:"proactive-ai-inline-suggestion-completion-hint"},nh.DECORATION_TYPES={completionHint:"completionHint"};let n_=new nh,ny=e=>{let{inlineSuggestion:t,locale:n,inlineSuggestionSessionId:i}=nn(e);return{matchedFormat:t?.type==="date"?t?.metadata.matchedFormat:void 0,suggestionType:t?.type,locale:n,inlineSuggestionSessionId:i}},nI=({state:e,triggeredFrom:t})=>{let{matchedFormat:n,suggestionType:a,locale:r,inlineSuggestionSessionId:o}=ny(e);return{eventType:i("d925B").EVENT_TYPE.TRACK,action:i("d925B").ACTION.SUGGESTION_INSERTED,actionSubject:i("d925B").ACTION_SUBJECT.EDITOR_PLUGIN_AI,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.AI_INLINE_SUGGESTION,attributes:{locale:r,suggestionType:a,triggeredFrom:t,matchedFormat:n,inlineSuggestionSessionId:o}}},nE=e=>t=>{let n=(0,i("dAtrv").withAnalytics)(e,e=>nI({state:e,triggeredFrom:t}))(nt(()=>({type:t6.CLEAR_INLINE_SUGGESTION}),(e,t)=>{let{inlineSuggestion:n}=nn(t);return n&&(e.replaceWith(n.from,n.to,n.suggestedNode),e.setSelection(i("ks2lK").Selection.near(e.doc.resolve(n.from+n.suggestedNode.nodeSize)))),e}));return(0,i("dAtrv").withAnalytics)(e,()=>({action:i("d925B").ACTION.INSERTED,actionSubject:i("d925B").ACTION_SUBJECT.DOCUMENT,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.DATE,eventType:i("d925B").EVENT_TYPE.TRACK,attributes:{inputMethod:i("d925B").INPUT_METHOD.INLINE_SUGGESTION_FLOATING_TB}}))(n)},nS=e=>t=>(0,i("dAtrv").withAnalytics)(e,e=>{let{matchedFormat:n,suggestionType:a,locale:r,inlineSuggestionSessionId:o}=ny(e);return{eventType:i("d925B").EVENT_TYPE.TRACK,action:i("d925B").ACTION.SUGGESTION_DISMISSED,actionSubject:i("d925B").ACTION_SUBJECT.EDITOR_PLUGIN_AI,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.AI_INLINE_SUGGESTION,attributes:{locale:r,suggestionType:a,triggeredFrom:t,matchedFormat:n,inlineSuggestionSessionId:o}}})(ni()),nb=({analyticsApi:e,state:t})=>{let{matchedFormat:n,suggestionType:a,locale:r,inlineSuggestionSessionId:o}=ny(t);e?.fireAnalyticsEvent({eventType:i("d925B").EVENT_TYPE.TRACK,action:i("d925B").ACTION.SUGGESTION_VIEWED,actionSubject:i("d925B").ACTION_SUBJECT.EDITOR_PLUGIN_AI,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.AI_INLINE_SUGGESTION,attributes:{matchedFormat:n,suggestionType:a,locale:r,inlineSuggestionSessionId:o}})};var nT=((c={}).INSERT="INSERT",c.DISMISS="DISMISS",c);let nC=(e,t,n)=>(i,a)=>{if(nn(i).inlineSuggestion){if("INSERT"===e)return nE(n?.analytics?.actions)(t)(i,a),!0;if("DISMISS"===e)return nS(n?.analytics?.actions)(t)(i,a),!0}return!1},nA=(e,t,n)=>{let{inlineSuggestion:i}=nn(e),{inlineSuggestion:a}=nn(t);return i?.metadata!==a?.metadata&&null!==a&&nb({analyticsApi:n?.analytics?.actions,state:t}),null};function nv(e){let{selection:t}=e;if(!t.empty||e.selection.from!==e.doc.nodeSize-3)return!1;let{inlineSuggestion:n,decorationSet:i}=nn(e);return i.find().some(e=>e?.spec?.type===nh.DECORATION_TYPES.completionHint)&&t.from===n?.to}let nP=e=>{let{dispatch:t,getIntl:n,api:a}=e,{locale:r}=n();return new(0,i("1S4f7").SafePlugin)({key:t9,state:ne(t,t7({locale:r})),props:{decorations:e=>{let{decorationSet:t}=nn(e);return t},handleKeyDown:(0,i("dus6D").keydownHandler)({Enter:nC(nT.INSERT,t3.ENTER_BUTTON,a),Tab:nC(nT.INSERT,t3.TAB_BUTTON,a),Escape:nC(nT.DISMISS,t3.ESCAPE_BUTTON,a),ArrowRight:nv}),handleDOMEvents:{blur:(e,t)=>{if(function(e){let{inlineSuggestion:t}=nn(e);return!!t}(e.state)&&!function(e){let t=e.relatedTarget||document.activeElement;return t instanceof Element&&!!t.closest('[data-editor-popup="true"]')}(t))return ni()(e.state,e.dispatch),!1}}},view:()=>({update:(e,t)=>{try{let i=e.state;t.doc.eq(i.doc)||n_.scheduleScanForSuggestions(e);let a=n().locale;nn(i).locale!==a&&nt(()=>({type:t6.UPDATE_LOCALE,payload:{locale:a}}))(i,e.dispatch)}catch(e){}},destroy:()=>{n_.cancelSuggestionScans()}}),appendTransaction:(e,t,n)=>nA(t,n,a)})},nk=e=>{let{api:t}=e;return new(0,i("1S4f7").SafePlugin)({view(){let n=!1;return{update(a){if(!t?.placeholder||!t?.core)return;let r=a.state,o=i("3yUTv").aiExperienceDecorationPluginKey.getState(r),s=o?.isRunning??!1;s!==n&&(n=s,e.editorPluginAIProvider.isInDocumentStreamingEnabled?t.core.actions.execute(t.placeholder.commands.setPlaceholderHidden(s)):(0,i("2pjJ5").isEmptyDocument)(r.doc)&&t.core.actions.execute(t.placeholder.commands.setPlaceholderHidden(s)))}}}})},nx=new(0,i("ks2lK").PluginKey)("aiExperienceSelectionPreview"),nw=()=>new(0,i("1S4f7").SafePlugin)({key:nx,state:{init:(e,t)=>({selectionPreview:!1}),apply:(e,t,n)=>e.getMeta("showSelectionPreview")?{selectionPreview:!0}:e.getMeta("hideSelectionPreview")?{selectionPreview:!1}:t},props:{decorations:e=>{if(nx.getState(e).selectionPreview){let{modalDecorationSet:t}=(0,i("kqrrC").getPluginState)(e),n=t.find(0,e.doc.content.size),a=n.filter(e=>e?.spec?.key==="inlineDecoration")[0];if(!n.filter(e=>e?.spec?.key==="ai-nodeDecoration")[0]&&!a){let t=(0,i("5SuLc").createInlineDecoration)(0,e.doc.content.size);return i("ftzrq").DecorationSet.create(e.doc,[t])}}return i("ftzrq").DecorationSet.empty}}}),nM=e=>{if(i("fXyZM").selectionPluginKey.getState(e.state)?.isPendingSelectionContextClear){let{dispatch:t,state:n}=e;t(n.tr.setMeta(i("fXyZM").selectionPluginKey,{action:"clearPendingSelectionContext"}))}},nN=({api:e,editorPluginAIProvider:t})=>{let n=!1,a=!1;return new(0,i("1S4f7").SafePlugin)({key:i("fXyZM").selectionPluginKey,state:{init:()=>({nonCursorSelectionChangeCount:0,lastSelectionContext:void 0,isPendingSelectionContextClear:!1}),apply:(t,n)=>{let a=t.getMeta(i("fXyZM").selectionPluginKey);if(a?.action==="incrementNonCursorSelectionChangeCount")return{...n,nonCursorSelectionChangeCount:n.nonCursorSelectionChangeCount+1};if(a?.action==="lastSelectionContextPending")return{...n,isPendingSelectionContextClear:!0};if(a?.action==="lastSelectionContext"){let t=a.selection;return{...n,isPendingSelectionContextClear:!1,lastSelectionContext:t?{selectionFragment:e?.selection?.actions?.getSelectionFragment({selection:t})??null,localIds:e?.selection?.actions?.getSelectionLocalIds({selection:t})??null,selectionMarkdown:(0,i("6eZqW").convertProsemirrorNodeToMarkdown)({node:t.content().content}).markdown??null}:void 0}}return n?.isPendingSelectionContextClear&&a?.action==="clearPendingSelectionContext"?{...n,lastSelectionContext:void 0,isPendingSelectionContextClear:!1}:n}},appendTransaction:(e,t,r)=>{let o=t.selection,s=r.selection;return function(e,t){let n=(0,i("kqrrC").getPluginState)(e)?.modalDecorationSet,a=(0,i("kqrrC").getPluginState)(t)?.modalDecorationSet,r=n?eL({modalDecorationSet:n}):void 0,o=a?eL({modalDecorationSet:a}):void 0;return!!r&&!o||!r&&!!o||!!r&&!!o&&(r[0]!==o[0]||r[1]!==o[1])}(t,r)?n?(a=!0,null):r.tr.setMeta(i("fXyZM").selectionPluginKey,{action:"incrementNonCursorSelectionChangeCount"}):o.eq(s)||o.empty&&s.empty?null:n?(a=!0,null):r.tr.setMeta(i("fXyZM").selectionPluginKey,{action:"incrementNonCursorSelectionChangeCount"})},props:{handleDOMEvents:{paste:t.isInDocumentStreamingEnabled?e=>(nM(e),!1):void 0,compositionstart:t.isInDocumentStreamingEnabled?e=>(nM(e),!1):void 0,keydown:t.isInDocumentStreamingEnabled?e=>(nM(e),!1):void 0,mousedown:e=>(t.isInDocumentStreamingEnabled&&nM(e),n=!0,a=!1,!1),mouseup:e=>{if(n=!1,a){let{state:t,dispatch:n}=e;n(t.tr.setMeta(i("fXyZM").selectionPluginKey,{action:"incrementNonCursorSelectionChangeCount"})),a=!1}return!1}}}})},nO=e(g).createContext(void 0),nR=nO.Provider,nD=()=>{let e=(0,g.useContext)(nO);if(!e)throw Error("No Editor view or API available in the context, make sure to have container wrapped with ContentComponentContextProvider");return e},nL={date:(e,t)=>{let n=(0,i("dIxHZ").timestampToString)(e.attrs.timestamp,t);return g.createElement(i("b4zhJ").Date,{value:e.attrs.timestamp},n)}},nF=({node:e})=>{let t=(0,i("8C5kA").default)(),n=nL[e.type.name];return n?n(e,t):g.createElement("span",null,e.type.name)},nG={pressable:"_bfhksm61 _ca0qze3t _u5f3ze3t _n3tdze3t _19bvze3t"};class nB{static shouldShow(e,t){return e.from<=t.from&&e.to>=t.to}static createToolbarItem(e,t){return{type:"custom",render:n=>n&&e.suggestedNode?g.createElement(i("fVUfS").default,{xcss:nG.pressable,onClick:()=>{nE(t?.analytics?.actions)(t3.TOOLBAR)(n.state,n.dispatch),n.focus()}},g.createElement(nF,{node:e.suggestedNode})):null,fallback:[]}}static buildToolbarConfig(e,t,n){let{paragraph:i,heading:a,taskItem:r,decisionItem:o,caption:s}=t.schema.nodes;return{title:"Inline suggestions",getDomRef:()=>{let e=document.querySelector(`.${nh.INLINE_SUGGESTION_DECORATION_CLASSES.toolbarAnchor}`);return e instanceof HTMLElement?e:void 0},nodeType:[i,a,r,o,s].filter(e=>!!e),items:[this.createToolbarItem(e,n)],align:"left",className:this.INLINE_SUGGESTION_FLOATING_TOOLBAR_CLASS}}static maybeBuild(e,t){let{inlineSuggestion:n}=nn(e);if(n&&this.shouldShow(n,e.selection))return this.buildToolbarConfig(n,e,t)}}p="proactive-ai-inline-suggestion-floating-toolbar",(d="symbol"==typeof(a=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(d="INLINE_SUGGESTION_FLOATING_TOOLBAR_CLASS","string"))?a:a+"")in nB?Object.defineProperty(nB,d,{value:p,enumerable:!0,configurable:!0,writable:!0}):nB[d]=p;let nU={name:"1hbjkx0",styles:"background-color:var(--ds-background-accent-blue-subtlest, #E9F2FF);border-bottom:var(--ds-border-width-selected, 2px) solid var(--ds-background-accent-blue-subtler, #cce0ff)"},nV=(0,i("9K4OG").css)({name:"mcqy92",styles:"border:var(--ds-border-width, 1px) solid var(--ds-background-accent-blue-subtle, #579DFF);box-shadow:0 0 2px 1px var(--ds-background-accent-blue-subtler, #cce0ff)"}," ::after{border-left:var(--ds-border-width, 1px) solid var(--ds-background-accent-blue-subtle, #579DFF);border-bottom:var(--ds-border-width, 1px) solid var(--ds-background-accent-blue-subtle, #579DFF);}"),nj={name:"735ejv",styles:"[aria-label='Annotation toolbar'],[aria-label='Selection toolbar']{[data-role='droplistContent']{max-height:400px;overflow-x:hidden;[data-testid^='ak-editor-ai-selection-toolbar-translate-button'] [data-item-elem-before]>span{padding:0;}}[data-testid='ak-editor-ai-selection-toolbar-ai-dropdown']>span>span{margin:0;}}"},nH=(0,i("9K4OG").css)("[aria-label='Selection toolbar']{[data-testid^='ak-editor-ai-selection-toolbar-dropdown-heading']{cursor:default;>span{gap:initial;}[data-item-elem-before]>span{padding:0;}[data-item-title]{text-transform:uppercase;font-size:0.75rem;font-weight:var(--ds-font-weight-bold, 700);color:",`var(--ds-text, ${i("6fnsQ").N200})`,";}}[data-testid^='ak-editor-ai-selection-toolbar-dropdown-heading']:hover{color:",`var(--ds-text, ${i("6fnsQ").N700})`,";}}"),nz={name:"aisf00",styles:"[aria-label='Annotation toolbar'],[aria-label='Selection toolbar']{[data-role='droplistContent']{[data-testid='ak-editor-ai-selection-toolbar-dropdown-view-all-agents']:not(:only-child){border-block-start:var(--ds-border-width-selected, 2px) solid var(--ds-menu-seperator-color, var(--ds-border, #e1e3e7));>span{gap:4px;}}button[data-testid^='ak-editor-ai-selection-toolbar-dropdown-agent'] [data-item-title='true']>span{white-space:normal;}}}"};var nK={name:"1pr32me",styles:"button[data-testid='ak-editor-ai-selection-toolbar-ai-button'],button[data-testid='ak-editor-ai-selection-toolbar-ai-button']:disabled,button[data-testid='ak-editor-ai-selection-toolbar-ai-button']:hover,button[data-testid='ak-editor-ai-selection-toolbar-ai-button']:focus,button[data-testid='ak-editor-annotation-toolbar-create-button'],button[data-testid='ak-editor-annotation-toolbar-create-button']:disabled,button[data-testid='ak-editor-annotation-toolbar-create-button']:hover,button[data-testid='ak-editor-annotation-toolbar-create-button']:focus{padding:0px var(--ds-space-100, 8px);}button[data-testid='ak-editor-ai-selection-toolbar-ai-button'] svg{padding-right:var(--ds-space-050, 4px);}button[data-testid='ak-editor-ai-selection-toolbar-ai-button']>span:only-child{svg{padding:0px var(--ds-space-100, 8px);}}"},nW={name:"2wdbgh",styles:"button[data-testid='ak-editor-ai-selection-toolbar-ai-button'],button[data-testid='ak-editor-ai-selection-toolbar-ai-button']:disabled,button[data-testid='ak-editor-ai-selection-toolbar-ai-button']:hover,button[data-testid='ak-editor-ai-selection-toolbar-ai-button']:focus{padding:0px var(--ds-space-075, 6px);}button[data-testid='ak-editor-annotation-toolbar-create-button'],button[data-testid='ak-editor-annotation-toolbar-create-button']:disabled,button[data-testid='ak-editor-annotation-toolbar-create-button']:hover,button[data-testid='ak-editor-annotation-toolbar-create-button']:focus{padding:0px var(--ds-space-075, 6px);span:first-child{margin:0;}span[role='img'],svg{padding:0;}}"};let nq=()=>(0,m.editorExperiment)("platform_editor_controls","variant1")?nW:nK,nY=()=>(0,i("9K4OG").css)(".ak-editor-content-area .",nB.INLINE_SUGGESTION_FLOATING_TOOLBAR_CLASS,"{padding:var(--ds-space-100, 8px);border-radius:var(--ds-space-075, 6px);[class$='-DateLozenge']{margin:0;}}.",nh.INLINE_SUGGESTION_DECORATION_CLASSES.underline,"{text-decoration-line:underline;text-decoration-style:dashed;text-decoration-color:var(--ds-border-accent-blue, #1D7AFC);}.",nh.INLINE_SUGGESTION_DECORATION_CLASSES.highlight,"{background-color:var(--ds-background-selected, #E9F2FF);}.",nh.INLINE_SUGGESTION_DECORATION_CLASSES.completionHint,"{color:",`var(--ds-text, ${i("6fnsQ").N800})`,";opacity:var(--ds-opacity-disabled, 0.5);pointer-events:none;user-select:none;}"),n$={name:"2h87e8",styles:".akEditor div.ProseMirror{.ai-pre-stream-range-selection{background-color:Highlight;&.ak-editor-annotation-draft, &.ak-editor-annotation-focus, &.ak-editor-annotation-blur{all:unset;background-color:Highlight;}}.annotationView-content-wrap{.ak-editor-annotation-draft, .ak-editor-annotation-focus, .ak-editor-annotation-blur{&:has(.ai-pre-stream-selection-highlight){all:unset;background-color:Highlight;}}}}"},nJ={name:"1ghkk0h",styles:".akEditor div.ProseMirror{.ai-modal-mount-point-widget{bottom:0;}tr>.ai-modal-mount-point-widget{display:table-cell;}.ai-pre-stream-empty-selection-caret{content:'';position:relative;border-left:var(--ds-border-width, 1px) solid var(--ds-text, #292A2E);margin-left:-1px;left:0.5px;}.ai-inline-streaming-hidden{display:none;}.ai-in-editor-user-content{opacity:0.2;}.ai-in-editor-ai-content:not(\n			.ak-editor-annotation-draft,\n			.ak-editor-annotation-focus,\n			.ak-editor-annotation-blur\n		){background-color:var(--ds-background-accent-purple-subtlest, #F8EEFE);border-bottom:var(--ds-border-width, 1px) dashed var(--ds-border-accent-purple, #AF59E1);}.ai-in-editor-telepointer{position:relative;z-index:1;&>.ai-in-editor-telepointer-label{position:absolute;box-sizing:border-box;display:flex;flex-direction:row;justify-content:center;align-items:center;padding:var(--ds-space-025, 2px);gap:var(--ds-space-075, 6px);height:16px;top:var(--ds-space-0, 0px);left:var(--ds-space-0, 0px);border-radius:0px var(--ds-space-050, 4px) var(--ds-space-050, 4px) 0px;border:solid var(--ds-border-width, 1px) transparent;background:linear-gradient(var(--ds-text, #292A2E), var(--ds-text, #292A2E)) padding-box,conic-gradient(\n							from 270deg at 50% 50%,\n							#1868db 0deg,\n							#1868db 115deg,\n							#fca700 115deg,\n							#fca700 180deg,\n							#bf63f3 180deg,\n							#bf63f3 310deg,\n							#82b536 310deg,\n							#82b536 359.96deg,\n							#1868db 360deg\n						) border-box;font-family:var(--ds-font-family-body, ui-sans-serif, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Ubuntu, \"Helvetica Neue\", sans-serif);font-weight:var(--ds-font-weight-semibold, 600);font-size:10px;line-height:9px;text-align:center;white-space:pre;color:var(--ds-text-inverse, #FFFFFF);}&::after{content:'';position:absolute;width:1px;height:24px;top:var(--ds-space-0, 0px);left:var(--ds-space-0, 0px);background:var(--ds-border-brand, #1868DB);}}}"},nQ={name:"pxemtm",styles:".akEditor div.ProseMirror{tbody>.ai-modal-mount-point-widget{height:0;display:table-row;border-top-style:solid;border-top-width:var(--ds-border-width, 1px);}}"},nX=()=>(0,i("9K4OG").css)(".akEditor div.ProseMirror{.ai-modal-start-widget,.ai-modal-end-widget{position:relative;&::before{content:'';background-image:url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMyIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDMgMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMSAxSDBMMSAxLjg1NzE0VjE4LjE0MzNMMCAxOS4wMDA0SDNMMiAxOC4xNDMzVjEuODU3MTRMMyAxSDJIMVoiIGZpbGw9IiM1NzlERkYiLz4KPHJlY3QgeT0iMTkiIHdpZHRoPSIzIiBoZWlnaHQ9IjEiIGZpbGw9IiM1NzlERkYiLz4KPHJlY3Qgd2lkdGg9IjMiIGhlaWdodD0iMSIgZmlsbD0iIzU3OURGRiIvPgo8L3N2Zz4K');z-index:1;display:block;position:absolute;top:0;bottom:var(--ds-space-negative-025, -2px);background-repeat:no-repeat;background-position-x:center;background-position-y:center;background-size:contain;aspect-ratio:3/20;}}.ai-modal-start-widget::before{left:0px;margin-left:-0.1em;}.ai-modal-end-widget::before{right:0px;margin-right:-0.1em;}.ai-generated-content-highlight{",nU,";}.ai-selection-highlight{",nU,"&.ak-editor-annotation-draft,&.ak-editor-annotation-focus,&.ak-editor-annotation-blur{all:unset;",nU,";}}.ai-selection-node .pm-table-wrapper{table tr td,table tr th{",(0,i("ieXGd").getSelectionStyles)([i("b38UX").SelectionStyle.Border,i("b38UX").SelectionStyle.Blanket]),";}}.ai-generated-node-highlight .pm-table-wrapper{table tr td,table tr th{",nV,";}}.annotationView-content-wrap{.ak-editor-annotation-draft,.ak-editor-annotation-focus,.ak-editor-annotation-blur{&:has(.ai-selection-highlight){all:unset;",nU,";}}}}"),nZ={name:"1w40d4h",styles:".ak-editor-plugin-ai-modal .ak-editor-content-area .ProseMirror{min-height:auto;> p:last-of-type{margin-bottom:0;}}"},n0=({children:t})=>(0,i("9K4OG").jsx)(e(g).Fragment,null,(0,i("9K4OG").jsx)(i("9K4OG").Global,{styles:[nj,nz,nY(),nH,nX(),nJ,n$,nq(),(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")&&nZ,(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")&&nQ]}),t),n1=(0,i("cgtv4").defineMessages)({dialogAriaLabel:{id:"fabric.editor.ai.experience.dialogAriaLabel",defaultMessage:"Atlassian Intelligence Dialog"},responseTooSimilarMessage:{id:"fabric.editor.ai.experience.responseTooSimilarMessage",defaultMessage:"Atlassian Intelligence has no suggestions at this time. Feel free to try a different prompt or content."},generatingAiResponse:{id:"fabric.editor.ai.experience.generatingAiResponse",defaultMessage:"Generating"},discardMessagePrompt:{id:"fabric.editor.ai.experience.discardMessagePrompt",defaultMessage:"Do you want to discard your prompt?"},discardMessageResponse:{id:"fabric.editor.ai.experience.discardMessageResponse",defaultMessage:"Do you want to discard your response?"},discardStreamingInDocumennt:{id:"fabric.editor.ai.experience.discardStreamingInDocumennt",defaultMessage:"Cancel request and discard response?"},loadingTitle:{id:"fabric.editor.ai.experience.loadingTitle",defaultMessage:"Generating"},messageTemplateAnalysingQuery:{id:"fabric.editor.ai.experience.messageTemplateAnalysingQuery",defaultMessage:"Analyzing: Reviewing your question."},messageTemplateContentSearch:{id:"fabric.editor.ai.experience.messageTemplateContentSearch",defaultMessage:"Searching: One moment while we search for information."},messageTemplatePageHydration:{id:"fabric.editor.ai.experience.messageTemplatePageHydration",defaultMessage:"Searching: One moment while we search the page."},messageTemplateNextBestTask:{id:"fabric.editor.ai.experience.messageTemplateNextBestTask",defaultMessage:"Searching: One moment while we search Jira."},convoAIBeta:{id:"fabric.editor.ai.screens.preview.convoAIBeta",defaultMessage:"Content generation requests that reference URLs is in beta."},useRovoOrganisationKnowledgeRightText:{id:"fabric.editor.ai.experience.labelRight.rovo",defaultMessage:"Rovo"},useGeneralAiKnowledgeRightText:{id:"fabric.editor.ai.experience.labelRight.atlassianIntelligence",defaultMessage:"Atlassian Intelligence"},actionsGroupHeading:{id:"fabric.editor.ai.experience.suggestionGroupHeading.actions",defaultMessage:"Actions"},atlassianIntelligenceGroupHeading:{id:"fabric.editor.ai.experience.suggestionGroupHeading.atlassianIntelligence",defaultMessage:"Atlassian intelligence"},knowledgeSourceGroupHeading:{id:"fabric.editor.ai.experience.suggestionGroupHeading.knowledgeSource",defaultMessage:"Knowledge source"},agentsSuggestionGroupHeading:{id:"fabric.editor.ai.experience.suggestionGroupHeading.agents",defaultMessage:"Agents"},rovoAgentsCountSuggestionGroupHeading:{id:"fabric.editor.ai.experience.suggestionGroupHeading.rovoAgentsCount",defaultMessage:"Rovo agents ({numberOfAgents})"},useRovoAgentsCountSuggestionGroupHeading:{id:"fabric.editor.ai.experience.suggestionGroupHeading.useRovoAgentsCount",defaultMessage:"Use a Rovo agent ({numberOfAgents})"},rovoAgentsSuggestionGroupHeading:{id:"fabric.editor.ai.experience.suggestionGroupHeading.rovoAgents",defaultMessage:"Rovo agents"},useGeneralAiKnowledgeLabel:{id:"fabric.editor.ai.experience.useGeneralAiKnowledgeLabel",defaultMessage:"Use general knowledge"},useRovoOrganisationKnowledgeLabel:{id:"fabric.editor.ai.experience.useRovoOrganisationKnowledgeLabel",defaultMessage:"Use knowledge from your organization"},agentsFooterRightText:{id:"fabric.editor.ai.experience.footerRightText.agents",defaultMessage:"Powered by Rovo"},agentsBrowseMore:{id:"fabric.editor.ai.experience.browseMore.agents",defaultMessage:"Browse Agents"},showMoreButton:{id:"fabric.editor.ai.experience.showMoreButton",defaultMessage:"Show more"},noResultsSuggestion:{id:"fabric.editor.ai.experience.noResultsSuggestion",defaultMessage:"No results"},engagementBannerLinksText:{id:"fabric.editor.ai.experience.engagementBannerLinksText",defaultMessage:"\uD83D\uDE80 You can now paste links \uD83D\uDD17 to Jira and Confluence content in your prompts."}});var n5=i("l998X"),n2=(0,i("cgtv4").defineMessages)({cancelLabel:{id:"fabric.editor.ai.screens.discard.cancelLabel",defaultMessage:"Back"},discardLabel:{id:"fabric.editor.ai.screens.discard.discardLabel",defaultMessage:"Discard"},warningIconLabel:{id:"fabric.editor.ai.screens.discard.warningIconLabel",defaultMessage:"Warning"},yesLabel:{id:"fabric.editor.ai.screens.discard.yesLabel",defaultMessage:"Yes"},noLabel:{id:"fabric.editor.ai.screens.discard.noLabel",defaultMessage:"No"}});let n8={buttonContainer:"_zulp1b66 _1e0c1txw _1n261g80 _2lx2vrvc _1bahesu3 _4cvr1h6o _zs121b66 _d4lfzwfg _10gv1ex1 _xlob1h6o"},n4=({children:e,isAIFC:t})=>t?(0,n5.jsx)(i("u9agA").default,{xcss:n8.buttonContainer,children:e}):(0,n5.jsx)("div",{className:(0,i("gMc0m").default)(["_zulpu2gc _1e0c1txw _1n261g80 _2lx2vrvc _1bahesu3 _4cvr1h6o"]),children:e}),n3=({onCancel:t,onDiscard:n,text:a,appearance:r,isAIFC:o})=>{let{formatMessage:s}=(0,i("8C5kA").default)(),[l,c]=(0,g.useState)(null),[d,{breakpoint:p}]=(0,i("imfiV").useElementBreakpoints)();return(0,g.useEffect)(()=>{l&&l.scrollIntoView({block:"nearest"})},[l]),(0,n5.jsxs)(i("40sdH").FloatingContainer,{ref:e=>{c(e),d(e)},"data-testid":"discard-screen",className:(0,i("gMc0m").default)(["_zulpu2gc _1e0c1txw _2lx2vrvc _j4orxy5q",p<=i("imfiV").Breakpoint.Small&&"_zulppxbi _2lx21bp4",o&&"_10fp1h6o _1bsb1ns9",`discard-screen ${i("kuYGt").AI_MODAL_SCREEN_CLASS}`]),paddingAdjustments:o?{right:4,left:4}:{top:1,bottom:1},rainbowBorder:!1,appearance:r,isAIFC:o,children:[(0,n5.jsx)(i("6F6hl").default,{children:s(n2.warningIconLabel)}),(0,n5.jsxs)("div",{className:(0,i("gMc0m").default)(["_16jlkb7n _1o9zkb7n _i0dlf1ug _zulpu2gc _1e0c1txw _2lx2vrvc _1bah1y6m _4cvr1h6o",p<=i("imfiV").Breakpoint.Small&&!o&&"_4cvr1y6m"]),children:[(0,n5.jsx)("span",{className:(0,i("gMc0m").default)(["_2hwxv77o _1e0c116y _4cvr1h6o _1bah1h6o _kqswh2mm _1o9zidpf",o&&"_19bv1b66 _u5f31b66 _n3td1b66 _ca0q1b66",p<=i("imfiV").Breakpoint.Small&&!o&&"_154i1i6y"]),children:(0,n5.jsx)(e(i("ebrpi")),{label:s(n2.warningIconLabel),color:"var(--ds-icon-warning, #E06C00)"})}),(0,n5.jsx)(i("iXCQx").default,{as:"p",children:a})]}),(0,n5.jsxs)(n4,{isAIFC:o,children:[(0,n5.jsx)(i("ccHMk").default,{testId:"cancel-button",spacing:"compact",onClick:t,type:"button",appearance:"subtle",children:s(o?n2.noLabel:n2.cancelLabel)}),(0,n5.jsx)(i("ccHMk").default,{autoFocus:!0,testId:"discard-button",spacing:"compact",onClick:n,type:"button",appearance:"warning",children:s(o?n2.yesLabel:n2.discardLabel)})]})]})};var n9=i("6VfGD"),n6=i("9XexZ");let n7=()=>{let{send:e}=(0,n6.useRovoContentBridgeAPI)(n9.ROVO_INLINE_INPUT_BOX_CLIENT_ID);return{abort:()=>{e(n9.InlineInputBoxAbortMessageCommand,{receiverId:n9.ROVO_CHAT_CLIENT_ID})}}},ie=e(g).forwardRef(({children:t},n)=>e(g).createElement("div",{ref:n,className:(0,i("gMc0m").default)(["_2lx21bp4 _kqsw1n9t _94n5pxbi _18u0mgjw _2hwxmgjw _19pkpxbi _1pby1nn1 _1bsb1ht8 _j7hq1w10 _5sagfnf5 _1pgl6ui8 _1o51q7pw _ta6yglyw"])},t));function it({api:t,appearance:n,dispatch:a}){let{abort:r}=n7(),{formatMessage:o}=(0,i("8C5kA").default)(),s=(0,i("4SGh1").useFireAIAnalyticsEvent)(),{isInDocumentStreamingEnabled:l}=nD(),c=(0,g.useCallback)(()=>{t?.aiExperience.actions.getAiExperienceActor()?.send({type:"disable discard"}),a({type:"cancel"})},[t,a]),d=(0,g.useCallback)(()=>{let e=t?.aiExperience.actions.getAiExperienceActor().getSnapshot().context;s({payload:(0,i("ilIeg").createUnifiedAnalyticsPayload)({action:i("d925B").ACTION.DISMISSED,interactionID:e?.channelId,experienceName:(0,i("6gJll").convertExperienceName)(e?.configItem.key.toString()??""),isProactive:!1,invokedFrom:"streamingApi"})}),t?.aiExperience.actions.endAIExperience(),r(),a({type:"terminate"})},[t,a,r,s]);return e(g).createElement(ie,null,e(g).createElement(n3,{onCancel:c,onDiscard:d,text:o(n1.discardStreamingInDocumennt),appearance:n,isAIFC:l}))}i("42omo");var ii=()=>(0,n5.jsxs)("svg",{width:"10",height:"2",viewBox:"0 0 10 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:(0,i("gMc0m").default)(["_1tfpidpf"]),children:[(0,n5.jsx)("path",{className:(0,i("gMc0m").default)(["_y44v1gpk","dot"]),d:"M0.0800781 2V0.414062H1.67969V2H0.0800781Z",fill:"#1868DB"}),(0,n5.jsx)("path",{className:(0,i("gMc0m").default)(["_y44v18gg","dot"]),d:"M3.83984 2V0.414062H5.43945V2H3.83984Z",fill:"#BF63F3"}),(0,n5.jsx)("path",{className:(0,i("gMc0m").default)(["_y44voqx9","dot"]),d:"M7.59961 2V0.414062H9.19922V2H7.59961Z",fill:"#FCA700"})]});i("42omo");var ia=(0,i("cgtv4").defineMessages)({labelCancel:{id:"fabric.editor.ai.components.cancelEscButton.cancelLabel",defaultMessage:"Cancel"},labelEsc:{id:"fabric.editor.ai.components.cancelEscButton.escLabel",defaultMessage:"Esc"}});let ir={container:"_stfgia51",escapeLabel:"_2rko12b0 _11c81o8v _19bv1b66 _u5f31b66 _ca0qv77o _n3tdv77o _bfhkysee _syaz1rpy",codeMd:"_2rko12b0 _11c81o8v _bfhkplhp _4t3igktf _1bsbd4y9 _y3gn1h6o _syaz1rpy _1e0c1o8l _ae4v1h6o"},io=({onCancel:t,autoFocus:n,shape:a="default",isAIFC:r})=>{let{formatMessage:o}=(0,i("8C5kA").default)();return r?(0,n5.jsxs)(i("u9agA").default,{space:"space.100",alignBlock:"center",xcss:ir.container,children:[(0,n5.jsx)(i("gdv5Z").default,{as:"span",xcss:r?ir.escapeLabel:ir.codeMd,children:o(ia.labelEsc)},"escape-command-text"),(0,n5.jsx)(i("1qfLF").default,{label:r?o(ia.labelCancel):"video stop overlay icon",icon:()=>(0,n5.jsx)(e(i("5lVpa")),{label:r?"":"video-stop-overlay-icon",color:"var(--ds-icon-danger, #C9372C)"}),shape:a,onClick:t,autoFocus:n,appearance:"subtle"})]}):(0,n5.jsxs)(i("ccHMk").default,{autoFocus:n,testId:"cancel-esc-button",type:"button",onClick:t,children:[o(ia.labelCancel),(0,n5.jsx)("span",{className:(0,i("gMc0m").default)(["_2rko12b0 _syazazsu _bfhki8nm _k48pi7a9","_ca0q1l7b _u5f31l7b _n3td1l7b _19bv1l7b _18u014y2"]),children:o(ia.labelEsc)})]})};var is=i("8PgnR"),il=(0,i("cgtv4").defineMessages)({iconAltText:{id:"fabric.editor.ai.screens.loading.iconAltText",defaultMessage:"Generating icon"},liveRegionDescription:{id:"fabric.editor.ai.screens.loading.adfContentAriaLiveRegionDescription",defaultMessage:"Live updating content:"},loadingAriaTitle:{id:"fabric.editor.ai.experience.loadingAriaTitle",defaultMessage:"Generating"},loadingAriaNewTitle:{id:"fabric.editor.ai.experience.loadingAriaNewTitle",defaultMessage:"Rovo is working"},loadingAnalyzing:{id:"fabric.editor.ai.experience.loadingAnalyzing",defaultMessage:"Rovo is analyzing"},inlineCommentLoadingAnalyzing:{id:"fabric.editor.ai.experience.inlineCommentLoadingAnalyzing",defaultMessage:"Analyzing"},loadingEditingTitle:{id:"fabric.editor.ai.experience.loadingEditingTitle",defaultMessage:"Rovo is editing"},inlineCommentLoadingEditingTitle:{id:"fabric.editor.ai.experience.inlineCommentLoadingEditingTitle",defaultMessage:"Editing"},loadingShortening:{id:"fabric.editor.ai.experience.loadingShortening",defaultMessage:"Rovo is shortening"},loadingLengthening:{id:"fabric.editor.ai.experience.loadingLengthening",defaultMessage:"Rovo is lengthening"},loadingChangingTone:{id:"fabric.editor.ai.experience.loadingChangingTone",defaultMessage:"Rovo is changing the tone"},loadingFixingSpellingAndGrammar:{id:"fabric.editor.ai.experience.loadingFixingSpellingAndGrammar",defaultMessage:"Rovo is fixing spelling and grammar"},loadingTranslating:{id:"fabric.editor.ai.experience.loadingTranslating",defaultMessage:"Rovo is translating"},loadingPolishing:{id:"fabric.editor.ai.experience.loadingPolishing",defaultMessage:"Rovo is polishing"},loadingSummarizing:{id:"fabric.editor.ai.experience.loadingSummarizing",defaultMessage:"Rovo is summarizing"}});let ic=(e,t)=>{if(!e)return t(il.loadingEditingTitle);if(e.includes("Translate"))return t(il.loadingTranslating);if(e.includes("Change tone"))return t(il.loadingChangingTone);switch(e){case"Make shorter":return t(il.loadingShortening);case"Make longer":return t(il.loadingLengthening);case"Fix spelling & grammar":return t(il.loadingFixingSpellingAndGrammar);case"Add polish":return t(il.loadingPolishing);case"Summarize":return t(il.loadingSummarizing);default:return t(il.loadingEditingTitle)}},id=({parentPresetPromptLabel:t,childShortTitle:n,title:a,latestPrompt:r,preview:o,providerFactory:s,schema:l,onCancel:c,agent:d,disclaimer:p,isStreaming:u,canInlineStreamChanges:m,hideLoadingScreen:f,appearance:h,isAIFC:_})=>{let{formatMessage:y}=(0,i("8C5kA").default)(),[I,{breakpoint:E}]=(0,i("imfiV").useElementBreakpoints)(i("imfiV").Breakpoint.SmallChromeless),S=({agent:e,disclaimer:t})=>(0,n5.jsx)(i("jHWjW").Footer,{brand:e?"rovo":"atlassian-intelligence",disclaimer:t,showDisclaimer:!0,isAIFC:_}),b=e(g).useMemo(()=>(0,n5.jsx)("div",{"data-testid":"rovo-icon",className:(0,i("gMc0m").default)(["_zulpftgi","_2hwxv77o _1e0c1txw _4cvr1h6o",(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")&&"_1bsb1tcg _4t3i1tcg"]),children:(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")?(0,n5.jsx)(i("jO3S6").LazyAnimatedRovoIcon,{alt:"Rovo",testId:"rovo-loading-animation"}):_?(0,n5.jsx)(i("lAFHW").RovoIcon,{label:"",shouldUseHexLogo:!0,size:"small"}):(0,n5.jsx)(i("3ZqD0").default,{label:"RovoIcon"})}),[_]),T=e(g).useMemo(()=>(0,n5.jsx)("div",{className:(0,i("gMc0m").default)([_?"_ca0qutpp _n3tdutpp _19bvpxbi _u5f3pxbi":"_ca0qutpp _n3tdutpp _19bvutpp _u5f3utpp","_1e0c1txw _2lx2vrvc _1bah1e5h _4cvr1h6o _1n261g80",(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")&&"_1bah1yb4"]),children:_?(0,n5.jsxs)(e(g).Fragment,{children:[b,(0,n5.jsxs)("div",{className:(0,i("gMc0m").default)(["_16jlkb7n _1o9zkb7n _i0dlf1ug","_11c82smr _1nmz1hna"]),children:[u?E<=i("imfiV").Breakpoint.SmallChromeless?y(il.inlineCommentLoadingEditingTitle):ic(r?.presetTitle,y):y(E<=i("imfiV").Breakpoint.SmallChromeless?il.inlineCommentLoadingAnalyzing:il.loadingAnalyzing),(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")&&(0,n5.jsx)("span",{className:(0,i("gMc0m").default)(["_18u01b66"]),children:(0,n5.jsx)(ii,{})})]}),!(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")&&(0,n5.jsx)("div",{className:(0,i("gMc0m").default)(["_16jlkb7n _1o9zkb7n _i0dlf1ug"]),children:(0,n5.jsx)(ii,{})}),(0,n5.jsx)(io,{onCancel:c,shape:"circle",isAIFC:!0})]}):(0,n5.jsxs)(e(g).Fragment,{children:[(0,n5.jsx)("div",{"data-testid":"loading-icon",className:(0,i("gMc0m").default)(["_2hwxv77o _1e0c1txw _4cvr1h6o"]),children:(0,n5.jsx)(i("d7r2R").default,{alt:y(il.iconAltText)})}),(0,n5.jsx)("div",{className:(0,i("gMc0m").default)(["_16jlkb7n _1o9zkb7n _i0dlf1ug","_11c82smr _1nmz1hna"]),children:a}),(0,n5.jsx)(io,{autoFocus:!0,onCancel:c,isAIFC:_})]})}),[b,u,E,y,r?.presetTitle,c,a,_]),C=({preview:t})=>(0,n5.jsxs)(e(g).Fragment,{children:[(0,n5.jsx)(i("6F6hl").default,{children:y(il.loadingAriaTitle)}),t&&(_?(0,n5.jsxs)("div",{"data-testid":"adf-content-live-region","aria-atomic":"false","aria-live":"polite",className:(0,i("gMc0m").default)(["_ca0qutpp _19bvutpp _u5f3utpp"]),children:[(0,n5.jsx)(i("6F6hl").default,{testId:"description",children:y(il.liveRegionDescription)}),(0,n5.jsx)("div",{className:(0,i("gMc0m").default)(["_ca0q12x7"]),children:t})]}):(0,n5.jsxs)("div",{"data-testid":"adf-content-live-region","aria-atomic":"false","aria-live":"polite",className:(0,i("gMc0m").default)(["_x3doia51 _n7zlia51","_ca0qutpp _n3tdutpp _19bvutpp _u5f3utpp"]),children:[(0,n5.jsx)(i("6F6hl").default,{testId:"description",children:y(il.liveRegionDescription)}),(0,n5.jsx)("div",{children:t})]}))]});return f&&m&&_?null:(0,n5.jsx)(i("40sdH").FloatingContainer,{ref:e=>{I(e)},"data-testid":"loading-screen",className:`loading-screen ${i("kuYGt").AI_MODAL_SCREEN_CLASS}`,rainbowBorderAnimation:!_,rainbowBorder:!_,disablePadding:!0,enableMaxWidth:_&&m,appearance:h,isAIFC:_,children:_?m?!f&&T:(0,n5.jsxs)("div",{children:[(0,n5.jsx)(C,{preview:o}),T,(0,n5.jsx)(S,{agent:d,disclaimer:p})]}):(0,n5.jsxs)("div",{children:[(0,n5.jsx)(i("6F6hl").default,{children:y(il.loadingAriaTitle)}),(0,n5.jsx)(is.LatestPromptHeader,{parentPresetPromptLabel:t,childShortTitle:n,prompt:r?.userInput,promptADF:r?.userADFInput,presetTitle:r?.presetTitle,providerFactory:s,schema:l,agent:d,showBack:!0}),(0,n5.jsx)(C,{preview:o}),T,(0,n5.jsx)(S,{agent:d,disclaimer:p})]})})},ip=e(g).memo(id),iu=({ref:e,onDiscard:t})=>{let n=(0,g.useCallback)(e=>{"Escape"===e.key&&(e.preventDefault(),e.stopPropagation(),t?.())},[t]),a=(0,g.useCallback)(e=>{"Escape"===e.key&&(e.preventDefault(),e.stopPropagation())},[]),r=(0,g.useCallback)(n=>{e.current?.contains(n.target)||t?.()},[e,t]);(0,g.useEffect)(()=>{let e=document.querySelector(".ak-editor-content-area");if(e)return e.focus({preventScroll:!0}),(0,i("fFa3V").bindAll)(e,[{type:"keydown",listener:n},{type:"keyup",listener:a},{type:"click",listener:r}])},[e,n,a,r])};function ig({api:t,providerFactory:n,appearance:a,dispatch:r}){let{isInDocumentStreamingEnabled:o}=nD(),s=(0,g.useMemo)(()=>t?.core.sharedState.currentState()?.schema,[t]),{formatMessage:l}=(0,i("8C5kA").default)(),{mounted:c,streaming:d}=(0,i("5gEqE").useUIStore)(),p=(0,g.useCallback)(()=>{t?.aiExperience.actions.getAiExperienceActor()?.send({type:"enable discard"}),r({type:"discard"})},[t,r]),u=e(g).useRef(null);iu({onDiscard:p,ref:u});let m=(0,i("eiA8Z").useSharedPluginStateWithSelector)(t,["aiExperience"],({aiExperienceState:e})=>e?.aiDecorationExperiencePluginState.hideLoadingScreen);return e(g).createElement(ie,{ref:u},s&&e(g).createElement(ip,{onCancel:p,preview:void 0,title:l(n1.loadingTitle),providerFactory:n,schema:s,isStreaming:!0,canInlineStreamChanges:!0,hideLoadingScreen:c&&d||m,appearance:a,isAIFC:o}))}let im={discard:!1,terminated:!1};function ih(e,t){switch(t.type){case"discard":return{...e,discard:!0};case"cancel":return{...e,discard:!1};case"terminate":return{...e,terminated:!0};case"reset":return{discard:!1,terminated:!1};default:return e}}let i_=e=>{let[t,n]=(0,g.useReducer)(ih,im),a=(0,i("eiA8Z").useSharedPluginStateWithSelector)(e,["aiExperience"],({aiExperienceState:e})=>e?.aiDecorationExperiencePluginState.nextSessionId);return((0,g.useEffect)(()=>{a||n({type:"reset"})},[a]),a&&!t.terminated)?t.discard?["discard",n]:["loading",n]:["idle",()=>{}]};function iy({api:e,providerFactory:t,appearance:n}){let[i,a]=i_(e);switch(i){case"discard":return g.createElement(it,{api:e,dispatch:a,appearance:n});case"loading":return g.createElement(ig,{api:e,providerFactory:t,appearance:n,dispatch:a});default:return null}}var iI=i("i0iqW"),iE=i("3Ev1M");i("2gWl9");let iS=new WeakMap;function ib(e,t,n){let i=iS.get(e);return i?t in i||(i[t]=n()):(i={[t]:n()},iS.set(e,i)),i[t]}let iT={},iC=e=>"string"==typeof e?{type:e}:"function"==typeof e?"resolve"in e?{type:e.type}:{type:e.name}:e;class iA{_initialize(){this.transitions=(0,i("d0N4G").f)(this),this.config.always&&(this.always=(0,i("d0N4G").a)(this.config.always).map(e=>(0,i("d0N4G").b)(this,i("d0N4G").N,e))),Object.keys(this.states).forEach(e=>{this.states[e]._initialize()})}get definition(){return{id:this.id,key:this.key,version:this.machine.version,type:this.type,initial:this.initial?{target:this.initial.target,source:this,actions:this.initial.actions.map(iC),eventType:null,reenter:!1,toJSON:()=>({target:this.initial.target.map(e=>`#${e.id}`),source:`#${this.id}`,actions:this.initial.actions.map(iC),eventType:null})}:void 0,history:this.history,states:(0,i("d0N4G").m)(this.states,e=>e.definition),on:this.on,transitions:[...this.transitions.values()].flat().map(e=>({...e,actions:e.actions.map(iC)})),entry:this.entry.map(iC),exit:this.exit.map(iC),meta:this.meta,order:this.order||-1,output:this.output,invoke:this.invoke,description:this.description,tags:this.tags}}toJSON(){return this.definition}get invoke(){return ib(this,"invoke",()=>(0,i("d0N4G").t)(this.config.invoke).map((e,t)=>{let{src:n,systemId:a}=e,r=e.id??(0,i("d0N4G").c)(this.id,t),o="string"==typeof n?n:`xstate.invoke.${(0,i("d0N4G").c)(this.id,t)}`;return{...e,src:o,id:r,systemId:a,toJSON(){let{onDone:t,onError:n,...i}=e;return{...i,type:"xstate.invoke",src:o,id:r}}}}))}get on(){return ib(this,"on",()=>[...this.transitions].flatMap(([e,t])=>t.map(t=>[e,t])).reduce((e,[t,n])=>(e[t]=e[t]||[],e[t].push(n),e),{}))}get after(){return ib(this,"delayedTransitions",()=>(0,i("d0N4G").g)(this))}get initial(){return ib(this,"initial",()=>(0,i("d0N4G").d)(this,this.config.initial))}next(e,t){let n,a=t.type,r=[];for(let o of ib(this,`candidates-${a}`,()=>(0,i("d0N4G").h)(this,a))){let{guard:s}=o,l=e.context,c=!1;try{c=!s||(0,i("d0N4G").e)(s,l,t,e)}catch(t){let e="string"==typeof s?s:"object"==typeof s?s.type:void 0;throw Error(`Unable to evaluate guard ${e?`'${e}' `:""}in transition for event '${a}' in state node '${this.id}':
${t.message}`)}if(c){r.push(...o.actions),n=o;break}}return n?[n]:void 0}get events(){return ib(this,"events",()=>{let{states:e}=this,t=new Set(this.ownEvents);if(e)for(let n of Object.keys(e)){let i=e[n];if(i.states)for(let e of i.events)t.add(`${e}`)}return Array.from(t)})}get ownEvents(){return Array.from(new Set([...this.transitions.keys()].filter(e=>this.transitions.get(e).some(e=>!(!e.target&&!e.actions.length&&!e.reenter)))))}constructor(e,t){if(this.config=e,this.key=void 0,this.id=void 0,this.type=void 0,this.path=void 0,this.states=void 0,this.history=void 0,this.entry=void 0,this.exit=void 0,this.parent=void 0,this.machine=void 0,this.meta=void 0,this.output=void 0,this.order=-1,this.description=void 0,this.tags=[],this.transitions=void 0,this.always=void 0,this.parent=t._parent,this.key=t._key,this.machine=t._machine,this.path=this.parent?this.parent.path.concat(this.key):[],this.id=this.config.id||[this.machine.id,...this.path].join(i("d0N4G").S),this.type=this.config.type||(this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.description=this.config.description,this.order=this.machine.idMap.size,this.machine.idMap.set(this.id,this),this.states=this.config.states?(0,i("d0N4G").m)(this.config.states,(e,t)=>new iA(e,{_parent:this,_key:t,_machine:this.machine})):iT,"compound"===this.type&&!this.config.initial)throw Error(`No initial state specified for compound state node "#${this.id}". Try adding { initial: "${Object.keys(this.states)[0]}" } to the state config.`);this.history=!0===this.config.history?"shallow":this.config.history||!1,this.entry=(0,i("d0N4G").t)(this.config.entry).slice(),this.exit=(0,i("d0N4G").t)(this.config.exit).slice(),this.meta=this.config.meta,this.output="final"!==this.type&&this.parent?void 0:this.config.output,this.tags=(0,i("d0N4G").t)(e.tags).slice()}}class iv{provide(e){let{actions:t,guards:n,actors:i,delays:a}=this.implementations;return new iv(this.config,{actions:{...t,...e.actions},guards:{...n,...e.guards},actors:{...i,...e.actors},delays:{...a,...e.delays}})}resolveState(e){let t=(0,i("d0N4G").r)(this.root,e.value),n=(0,i("d0N4G").i)((0,i("d0N4G").j)(this.root,t));return(0,i("d0N4G").k)({_nodes:[...n],context:e.context||{},children:{},status:(0,i("d0N4G").l)(n,this.root)?"done":e.status||"active",output:e.output,error:e.error,historyValue:e.historyValue},this)}transition(e,t,n){return(0,i("d0N4G").n)(e,t,n,[]).snapshot}microstep(e,t,n){return(0,i("d0N4G").n)(e,t,n,[]).microstates}getTransitionData(e,t){return(0,i("d0N4G").o)(this.root,e.value,e,t)||[]}getPreInitialState(e,t,n){let{context:a}=this.config,r=(0,i("d0N4G").k)({context:"function"!=typeof a&&a?a:{},_nodes:[this.root],children:{},status:"active"},this);return"function"==typeof a?(0,i("d0N4G").p)(r,t,e,[(0,i("cPMXw").a)(({spawn:e,event:t,self:n})=>a({spawn:e,input:t.input,self:n}))],n,void 0):r}getInitialSnapshot(e,t){let n=(0,i("d0N4G").q)(t),a=[],r=this.getPreInitialState(e,n,a),o=(0,i("d0N4G").s)([{target:[...(0,i("d0N4G").u)(this.root)],source:this.root,reenter:!0,actions:[],eventType:null,toJSON:null}],r,e,n,!0,a),{snapshot:s}=(0,i("d0N4G").n)(o,n,e,a);return s}start(e){Object.values(e.children).forEach(e=>{"active"===e.getSnapshot().status&&e.start()})}getStateNodeById(e){let t=(0,i("d0N4G").v)(e),n=t.slice(1),a=(0,i("d0N4G").w)(t[0])?t[0].slice(1):t[0],r=this.idMap.get(a);if(!r)throw Error(`Child state node '#${a}' does not exist on machine '${this.id}'`);return(0,i("d0N4G").x)(r,n)}get definition(){return this.root.definition}toJSON(){return this.definition}getPersistedSnapshot(e,t){return(0,i("d0N4G").y)(e,t)}restoreSnapshot(e,t){let n={},a=e.children;Object.keys(a).forEach(e=>{let r=a[e],o=r.snapshot,s=r.src,l="string"==typeof s?(0,i("d0N4G").z)(this,s):s;if(!l)return;let c=(0,i("d0N4G").A)(l,{id:e,parent:t.self,syncSnapshot:r.syncSnapshot,snapshot:o,src:s,systemId:r.systemId});n[e]=c});let r=(0,i("d0N4G").k)({...e,children:n,_nodes:Array.from((0,i("d0N4G").i)((0,i("d0N4G").j)(this.root,e.value)))},this),o=new Set;return!function e(t,n){if(!o.has(t))for(let a in o.add(t),t){let r=t[a];if(r&&"object"==typeof r){if("xstate$$type"in r&&r.xstate$$type===i("d0N4G").$){t[a]=n[r.id];continue}e(r,n)}}}(r.context,n),r}constructor(e,t){this.config=e,this.version=void 0,this.schemas=void 0,this.implementations=void 0,this.__xstatenode=!0,this.idMap=new Map,this.root=void 0,this.id=void 0,this.states=void 0,this.events=void 0,this.id=e.id||"(machine)",this.implementations={actors:t?.actors??{},actions:t?.actions??{},delays:t?.delays??{},guards:t?.guards??{}},this.version=this.config.version,this.schemas=this.config.schemas,this.transition=this.transition.bind(this),this.getInitialSnapshot=this.getInitialSnapshot.bind(this),this.getPersistedSnapshot=this.getPersistedSnapshot.bind(this),this.restoreSnapshot=this.restoreSnapshot.bind(this),this.start=this.start.bind(this),this.root=new iA(e,{_key:this.id,_machine:this}),this.root._initialize(),this.states=this.root.states,this.events=this.root.events}}i("hpRUx");var iP=i("hxT4C");let ik=(e,t)=>{t(e);let n=e.getSnapshot().children;n&&Object.values(n).forEach(e=>{ik(e,t)})};function ix(e,...[t]){return function(e,...[t]){let n=function(e,...[t]){let[[n,a],r]=(0,g.useState)(()=>{let n=(0,i("d0N4G").A)(e,t);return[e.config,n]});if(e.config!==n){let n=(0,i("d0N4G").A)(e,{...t,snapshot:a.getPersistedSnapshot({__unsafeAllowInlineActors:!0})});r([e.config,n]),a=n}return(0,iI.default)(()=>{a.logic.implementations=e.implementations}),a}(e,t),a=(0,g.useCallback)(()=>n.getSnapshot(),[n]),r=(0,g.useCallback)(e=>{let{unsubscribe:t}=n.subscribe(e);return t},[n]),o=(0,iP.useSyncExternalStore)(r,a,a);return(0,g.useEffect)(()=>(n.start(),()=>{let e=[];ik(n,t=>{e.push([t,t.getSnapshot()]),t.observers=new Set});let t=n.system.getSnapshot?.();n.stop(),n.system._snapshot=t,e.forEach(([e,t])=>{e._processingStatus=0,e._snapshot=t})}),[n]),[o,n.send,n]}(e,t)}let iw=()=>e(er)();class iM extends WeakMap{getActor(e){return this.has(e)?this.get(e):null}setActor(e,t){this.set(e,t)}}let iN=new iM,iO={analyticsContext:{aiSessionId:"",aiGroupId:""},positions:[0,0],isEmpty:!0,selectionType:"empty",markdown:"",adfResponse:void 0,latestPromptResponse:void 0,editCount:0,refinementCount:0,retryPromptCount:0,latestPromptRetried:!1,userInput:"",apiErrorInfo:{},responseHistory:{positionFromEnd:0,entries:[],totalSize:0,traversals:0},channelId:void 0,usePageKnowledge:!0,baseGenerate:void 0,userADFInput:void 0,parentPresetPromptLabel:void 0,latestPrompt:void 0,promptTrigger:void 0,idMap:void 0,contextStatistics:void 0,loadingStatus:void 0,rovoActions:void 0,previousAgentId:void 0,getMentionNameDetails:void 0,onceDiscard:void 0,triggeredFor:void 0,aiLifeCycleDynamicAttributesGetter:void 0,feedbackSubmitted:void 0,streamingHandler:void 0,traceIds:void 0,selectionMetaData:void 0,adfResponseNodeWrappers:void 0};function iR(t){let n=e(g).useRef(null);null===n.current&&(n.current=new iv({id:"AI Experience Machine",initial:"started state",types:{context:{},events:{}},states:{"started state":{on:{"kick off":[{target:"modal active state.experience.error state.active",guard:"no textual content but prompt requires it",actions:["updateFailureContextForNoTextualContent"]},{target:"modal active state.experience.loading state",guard:"neither base generate nor custom prompt"},"#AI Experience Machine.modal active state.experience.command palette state"],"initialise context":{actions:["initialiseContext"]}}},"modal active state":{type:"parallel",initial:"experience",on:{escape:{target:"#AI Experience Machine.modal active state.discard.active"},storeContextStatistics:{actions:"storeContextStatistics"}},states:{experience:{initial:"command palette state",states:{"loading state":{on:{complete:{target:"review state",actions:["pushToHistory","updateMarkdown","updateADFResponse","clearUserInput","updateRovoActions"]},error:{target:"#error state.active"},"same cache key":{target:"review state",actions:["restoreResponseFromHistory","clearUserInput"]}},states:{loading:{invoke:{src:(0,iE.fromCallback)(({input:e,sendBack:t})=>{e.configItem.key!==i("bwpRs").CONFIG_ITEM_KEYS.FREE_GENERATE_AIFC&&e.streamingHandler&&e.streamingHandler(e,t)}),input:({context:e})=>e},on:{stream:{target:"loading",actions:["updateMarkdown","updateADFResponse","updateLoadingStatus"]},"update idMap":{target:"loading",actions:"updateIdMap"},"update traceIds":{target:"loading",actions:"updateTraceIds"},error:{target:"#error state.active"},"response too similar":{target:"#AI Experience Machine.modal active state.experience.review state",actions:["pushToHistory","clearUserInput","updateADFResponse"]},"update selectionMetaData":{target:"loading",actions:"updateSelectionMetaData"},"update adfResponseNodeWrappers":{target:"loading",actions:"updateAdfResponseNodeWrappers"},"retry on adf stream errors":{target:"loading",actions:"retryOnAdfStreamErrors"}}}},initial:"loading",entry:["setLatestPrompt","updateChannelId"],exit:"clearLoadingStatus"},"review state":{on:{interrogate:{target:"loading state",actions:["clearFromHistory","updatePromptContextBasedOnTrigger","interrogate"]},refine:{target:"loading state",actions:["clearFromHistory","updatePromptContextBasedOnTrigger","incrementRefinementCount","refine"]},error:{target:"#error state.active"},"retry prompt":{target:"loading state",actions:["updatePromptContextBasedOnTrigger","updateUserInput","updateUserInputADF","clearMarkdown","incrementRetryPromptCount","clearFromHistory"]},"edit prompt":{target:"command palette state",actions:["editPrompt","clearFromHistory"]},"feedback submitted":{target:"review state",actions:["feedbackSubmitted"]}},states:{preview:{on:{"start refinement":"refinement"}},refinement:{on:{"cancel refinement":{target:"#AI Experience Machine.modal active state.discard.active",actions:["clearUserInput","clearFocus"]},"update user input":{actions:"updateUserInput"},"update user input adf":{actions:"updateUserInputADF"}}}},initial:"preview"},"command palette state":{on:{"kickoff with command palette input":[{target:"error state.active",guard:"no textual content but prompt requires it",actions:["updateFailureContextForNoTextualContent"]},{target:"loading state",actions:["updatePromptContextBasedOnTrigger","updateContext","resetRefinementCount"]}],"update context":{target:"command palette state",actions:["updateContext"],description:"This must be called before 'cancel' transition to make sure the context is updated before the 'if command input is empty' guard is evaluated."},"toggle use page knowledge":{target:"command palette state",actions:"toggleUsePageKnowledge"},"update baseGenerate and configItem":{target:"command palette state",actions:["updateBaseGenerateAndConfigItem"],description:"This must be called when agents are loaded and default baseGenerate and configItem needs to be reset"}},description:`This state creates a nested state machine that handles all the state of the command palette.

  It needs to know the 'userInput', 'baseGenerate' and 'configItem' from the AI Experience State Machine.

  Whenever we exit this state we need to update the AI Experience State Machine's context with the 'updateContext' action.`},"error state":{id:"error state",initial:"inactive",states:{inactive:{},active:{entry:["updateContext","storeFailureContext","clearLoadingStatus"],exit:["clearFailureContext"],on:{retry:{target:"#AI Experience Machine.modal active state.experience.loading state.loading"}}}}}}},discard:{initial:"inactive",states:{inactive:{on:{"enable discard":{target:"active",actions:"updateContext"}}},active:{on:{"disable discard":{target:"inactive",actions:"updateContext"},escape:"inactive"}}}}}}},context:t.context,on:{"update positions":{actions:"updatePositions"},reset:{target:".started state",actions:"resetContext"}}},{actions:{updatePositions:(0,i("cPMXw").a)(({event:e})=>{if("update positions"!==e.type)return{};let t=e.positions[0]===e.positions[1];return{positions:e.positions,isEmpty:t,selectionType:t?"empty":"range"}}),resetContext:(0,i("cPMXw").a)(({event:e})=>"reset"!==e.type?{}:iO),initialiseContext:(0,i("cPMXw").a)(({event:e})=>"initialise context"!==e.type?{}:e.context),storeFailureContext:(0,i("cPMXw").a)(({event:e})=>["error"].includes(e.type)&&"errorInfo"in e?{apiErrorInfo:e.errorInfo}:{}),updateFailureContextForNoTextualContent:(0,i("cPMXw").a)(()=>({apiErrorInfo:{failureReason:eN.NO_TEXTUAL_CONTENT}})),clearFailureContext:(0,i("cPMXw").a)(()=>({apiErrorInfo:{}})),updateMarkdown:(0,i("cPMXw").a)(({event:e})=>"stream"!==e.type&&"complete"!==e.type?{}:{markdown:e.markdown,feedbackSubmitted:void 0}),updateADFResponse:(0,i("cPMXw").a)(({event:e})=>"stream"!==e.type&&"complete"!==e.type&&"response too similar"!==e.type?{}:{adfResponse:e.adfResponse}),updateLoadingStatus:(0,i("cPMXw").a)(({event:e})=>"stream"!==e.type?{}:""===e.loadingStatus?{loadingStatus:void 0}:{loadingStatus:e.loadingStatus}),clearLoadingStatus:(0,i("cPMXw").a)(()=>({loadingStatus:void 0})),storeContextStatistics:(0,i("cPMXw").a)(({event:e})=>"storeContextStatistics"===e.type?{contextStatistics:e.contextStatistics}:{}),clearMarkdown:(0,i("cPMXw").a)(({event:e})=>"retry prompt"!==e.type?{}:{markdown:void 0,idMap:void 0,selectionMetaData:void 0,adfResponseNodeWrappers:void 0}),interrogate:(0,i("cPMXw").a)(({context:e,event:t})=>"interrogate"!==t.type?{}:{markdown:"",adfResponse:void 0,configItem:e.configItem.key!==i("bwpRs").CONFIG_ITEM_KEYS.ROVO_AGENT?e.baseGenerate:e.configItem,userInput:t.userInput,userADFInput:t.userADFInput,latestPromptResponse:t.latestPromptResponse}),refine:(0,i("cPMXw").a)(({event:e})=>"refine"!==e.type?{}:{markdown:"",configItem:e.configItem,latestPromptResponse:e.latestPromptResponse}),clearUserInput:(0,i("cPMXw").a)(()=>({userInput:"",userADFInput:void 0})),updateUserInput:(0,i("cPMXw").a)(({event:e})=>"update user input"!==e.type&&"retry prompt"!==e.type?{}:{userInput:e.input}),updateUserInputADF:(0,i("cPMXw").a)(({event:e})=>"update user input adf"!==e.type&&"retry prompt"!==e.type?{}:{userADFInput:e.adf}),updateRovoActions:(0,i("cPMXw").a)(({context:e,event:t})=>"complete"!==t.type?{}:t.rovoActions?.length&&e.configItem.agent?{rovoActions:t.rovoActions.reduce((e,t)=>(e["insert"===t.data.suggestion?"empty":"range"]=t.data,e),{})}:{rovoActions:{}}),feedbackSubmitted:(0,i("cPMXw").a)(({event:e})=>"feedback submitted"!==e.type?{}:{feedbackSubmitted:e.sentiment}),pushToHistory:(0,i("cPMXw").a)(({context:e,event:t})=>{let n;if("complete"!==t.type&&"response too similar"!==t.type)return{};let{cacheKey:i}=t,a=e.responseHistory.entries;if(a.length>0&&a[a.length-1].cacheKey===i||("complete"===t.type&&(n={userInput:e.userInput||"",userADFInput:e.userADFInput,configItem:e.configItem,markdown:t.markdown,cacheKey:i,modelInput:t.modelInput,inputOutputDiffRatio:t.inputOutputDiffRatio,latestPrompt:e.latestPrompt}),"response too similar"===t.type&&(n={userInput:e.userInput||"",userADFInput:e.userADFInput,configItem:e.configItem,markdown:"",responseTooSimilar:!0,cacheKey:i,modelInput:t.modelInput,inputOutputDiffRatio:t.inputOutputDiffRatio,latestPrompt:e.latestPrompt}),!n))return{};let r=new Blob([JSON.stringify(n)]).size,o=e.responseHistory.totalSize+r,s=[...a,n];return s.length>5&&s.shift(),{responseHistory:{entries:s,positionFromEnd:0,totalSize:o,traversals:e.responseHistory.traversals}}}),restoreResponseFromHistory:(0,i("cPMXw").a)(({context:e,event:t})=>{if("same cache key"!==t.type)return{};let{entries:n}=e.responseHistory,i=n[n.length-1];return i?{userInput:i.userInput,userADFInput:i.userADFInput,markdown:i.markdown,configItem:i.configItem,latestPromptResponse:i.markdown}:{}}),clearFromHistory:(0,i("cPMXw").a)(({event:e})=>"retry prompt"!==e.type?{}:{responseHistory:{entries:[],positionFromEnd:0,totalSize:0,traversals:0}}),setLatestPrompt:(0,i("cPMXw").b)(({enqueue:e,check:t})=>{e(t({type:"is base generate"})?(0,i("cPMXw").a)(({context:e})=>({latestPrompt:{userInput:e?.userInput||"",userADFInput:e?.userADFInput}})):t({type:"has custom prompt"})?(0,i("cPMXw").a)(({context:e,event:t})=>({latestPrompt:{..."interrogate"!==t.type&&"refine"!==t.type&&{presetTitle:e.configItem},userInput:e?.userInput||"",userADFInput:e?.userADFInput}})):(0,i("cPMXw").a)(({context:e})=>e?.userInput?{latestPrompt:{userInput:e?.userInput||"",userADFInput:e?.userADFInput}}:{latestPrompt:{presetTitle:e.configItem}}))}),clearFocus:()=>{document.activeElement?.blur()},updateContext:(0,i("cPMXw").a)(({event:e})=>"kickoff with command palette input"===e.type||"update context"===e.type||"enable discard"===e.type?{...e.context}:"disable discard"===e.type?{onceDiscard:void 0}:{}),updateBaseGenerateAndConfigItem:(0,i("cPMXw").a)(({event:e,context:t})=>{if("update baseGenerate and configItem"===e.type)if(t.configItem.key===i("bwpRs").CONFIG_ITEM_KEYS.FREE_GENERATE)return{baseGenerate:e.baseGenerate,configItem:e.configItem};else return{baseGenerate:e.baseGenerate};return{}}),updateChannelId:(0,i("cPMXw").a)(({context:e})=>{let{aiProvider:t,configItem:n}=e;return t.getChannelVariables&&n.agent?n.agent.id===e.previousAgentId?{}:{channelId:iw(),previousAgentId:n.agent.id}:{channelId:void 0,previousAgentId:void 0}}),updateIdMap:(0,i("cPMXw").a)(({event:e})=>"update idMap"===e.type?{idMap:{...e.context.idMap}}:{}),updateTraceIds:(0,i("cPMXw").a)(({event:e})=>"update traceIds"===e.type?{traceIds:e.context.traceIds}:{}),updateSelectionMetaData:(0,i("cPMXw").a)(({event:e})=>"update selectionMetaData"===e.type?{selectionMetaData:e.context.selectionMetaData}:{}),updateAdfResponseNodeWrappers:(0,i("cPMXw").a)(({event:e})=>"update adfResponseNodeWrappers"===e.type?{adfResponseNodeWrappers:e.context.adfResponseNodeWrappers}:{}),retryOnAdfStreamErrors:(0,i("cPMXw").a)(({event:e})=>"retry on adf stream errors"===e.type?{adfResponse:e.adfResponse,markdown:""}:{}),editPrompt:(0,i("cPMXw").a)(({context:e,event:t})=>{if("edit prompt"!==t.type)return{};let n=e.configItem.title===e.baseGenerate?.title,i=void 0!==e.configItem.promptLabel,a=!n&&!i,r=e.configItem,o=!!e.parentPresetPromptLabel,s=!!e.configItem.agent?.isDefault,l=(a||o)&&!s;return(a||s)&&!o&&e.baseGenerate&&(r=e.baseGenerate),{markdown:void 0,userInput:l?void 0:t.userInput,userADFInput:l?void 0:t.userADFInput,presetTitle:l?void 0:t.presetTitle,configItem:r,latestPromptResponse:void 0,editCount:e.editCount+1,idMap:void 0,selectionMetaData:void 0,adfResponseNodeWrappers:void 0}}),incrementRetryPromptCount:(0,i("cPMXw").a)(({context:e})=>({retryPromptCount:e.retryPromptCount+1})),incrementRefinementCount:(0,i("cPMXw").a)(({context:e})=>({refinementCount:e.refinementCount+1})),resetRefinementCount:(0,i("cPMXw").a)(()=>({refinementCount:0})),updatePromptContextBasedOnTrigger:(0,i("cPMXw").a)(({event:e})=>"interrogate"===e.type?{promptTrigger:"interrogate",latestPromptRetried:!1}:"refine"===e.type?{promptTrigger:"refinementButton",latestPromptRetried:!1}:"retry prompt"===e.type?{latestPromptRetried:!0}:"kickoff with command palette input"===e.type?{promptTrigger:"generate",latestPromptRetried:!1}:{}),toggleUsePageKnowledge:(0,i("cPMXw").a)(({context:e,event:t})=>"toggle use page knowledge"!==t.type?{}:{usePageKnowledge:!e.usePageKnowledge})},guards:{"has custom prompt":({context:e})=>!e.configItem.agent?.isDefault&&void 0!==e.configItem.promptLabel,"is base generate":({context:e})=>e.configItem.title===e.baseGenerate?.title,"neither base generate nor custom prompt":({context:e})=>{let t=e.configItem.title===e.baseGenerate?.title,n=void 0!==e.configItem.promptLabel;return!t&&!n},"if command input is empty":({context:e})=>e.userInput?.trim?.()?.length===0,"no textual content but prompt requires it":({context:e,event:t})=>{if(!(0,i("dh538").fg)("platform_editor_ai_handle_invalid_input"))return!1;let n=e.configItem;"kickoff with command palette input"===t.type&&(n=t.context.configItem);let a=n.requiresTextualContent,r=n.title===e.baseGenerate?.title,o=void 0!==n.promptLabel;if(a&&!r&&!o){let t=e.editorView.state;return!function(e,t){let[n,i]=t;return e.doc.textBetween(n,i).trim().length>0}(t,e.isEmpty?[0,t.doc.content.size]:e.positions)}return!1}}}));let[a,r,o]=ix(n.current);return iN.setActor(t.context.editorView,o),{state:a.value,context:a.context,send:r}}let iD=()=>!1;function iL({editorState:e}){return(0,g.useMemo)(()=>(0,i("6bKwm").getRovoAgentsPluginState)(e),[e])}let iF=`
	query editorPluginAIFavouriteAgents($cloudId: String!, $first: Int, $input: AgentStudioAgentQueryInput) {
		agentStudio_getAgents(
			cloudId: $cloudId
			first: $first
			input: $input
		) @optIn(to: "AgentStudio") {
			edges {
				node {
					...editorPluginAI_getAgentsFragment
				}
			}
		}
	}

	fragment editorPluginAI_getAgentsFragment on AgentStudioAssistant {
		id
		name
		description
		creator {
			id
		}
		creatorType
		# icon
		conversationStarters
		identityAccountId
		externalConfigReference
	}
`,iG=e=>({named_id:"",creator_type:"SYSTEM",available_plugins:{},favourite:!0,actor_type:"AGENT",user_defined_conversation_starters:[],deactivated:!1,is_default:!1,...e,creator:e.creator.id}),iB=async({cloudId:e})=>{try{let t=await fetch("/gateway/api/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:iF,variables:{cloudId:e,first:10,input:{onlyFavouriteAgents:!0}}})}),n=await t.json();if(n.errors)throw Error(n.errors[0].message);return n.data.agentStudio_getAgents.edges.map(e=>iG(e.node))}catch{return[]}},iU=async({limit:e})=>{try{if(iD())return Promise.resolve([i("9uNdP").CommsCrafterAgent,i("9uNdP").JobWriterAgent,i("9uNdP").A11yMateAgent]);let t=await fetch(`/gateway/api/assist/rovo/v1/agents/recommend/v2?limit=${e}`,{method:"GET",headers:{"Content-Type":"application/json","X-Product":"confluence","X-Experience-Id":"ai-mate"}});return(await t.json()).agents}catch{return[]}},iV=({cloudId:e,editorState:t})=>{let[n,a]=(0,g.useState)({data:[],loading:!0,error:null}),r=iL({editorState:t}),o=(0,g.useRef)(r?.initialised),s=(0,g.useRef)(r?.agents);return o.current=r?.initialised,s.current=r?.agents,(0,g.useEffect)(()=>{(async()=>{if(o.current&&s.current)return a({data:s.current,loading:!1,error:null});let t=await iB({cloudId:e});if(t.length>=3)return a({data:t.map(e=>(0,i("8zG4S").getEditorAgent)(e)),loading:!1,error:null});let n=await iU({limit:3-t.length});a({data:[...t??[],...n??[]].map(e=>(0,i("8zG4S").getEditorAgent)(e)),loading:!1,error:null})})()},[e]),n},ij=t=>{let{editorPluginAIProvider:n,editorView:a}=t,r=(0,g.useMemo)(()=>n?.getChannelVariables?.("rovo-agent")?.cloudId||"",[n]),o=(0,i("6Vqkv").useAgentsList)({filter:"favourites",assistanceServiceParams:{product:(0,i("8klLr").mapToAssistanceServiceProduct)(n.product),experienceId:"ai-mate",touchpointSource:"editor-agent-favourites-fetcher",siteId:r}}),s=(0,i("6Vqkv").useAgentsList)({assistanceServiceParams:{product:(0,i("8klLr").mapToAssistanceServiceProduct)(n.product),experienceId:"ai-mate",touchpointSource:"editor-agent-all-fetcher",siteId:r}}),l=iD();return e(g).useEffect(()=>{if(!n.getChannelVariables)return;let e=l?[i("9uNdP").CommsCrafterAgent,i("9uNdP").JobWriterAgent,i("9uNdP").A11yMateAgent].map(i("8zG4S").getEditorAgent):o.map(i("8zG4S").getEditorAgent);(0,i("eIhC8").updateAgents)({agents:e,defaultAgent:l?(0,i("8zG4S").getEditorAgent)(i("9uNdP").ChatAgent):s.filter(e=>e.is_default).map(i("8zG4S").getEditorAgent)[0]})(a.state,a.dispatch)},[n,o,s,l,a.state,a.dispatch]),null},iH=t=>{let{editorPluginAIProvider:n,editorView:a}=t,r=iV({cloudId:(0,g.useMemo)(()=>n?.getChannelVariables?.("rovo-agent")?.cloudId||"",[n]),editorState:a.state});return e(g).useEffect(()=>{if(!n.getChannelVariables)return;let e=r?.data;r.data&&!r.loading&&(0,i("eIhC8").updateAgents)({agents:e,defaultAgent:void 0})(a.state,a.dispatch)},[n,r,a.state,a.dispatch]),null},iz=({editorPluginAIProvider:t,editorView:n})=>(0,i("dh538").fg)("platform_editor_ai_remove_agents_list")?e(g).createElement(iH,{editorPluginAIProvider:t,editorView:n}):e(g).createElement(ij,{editorPluginAIProvider:t,editorView:n}),iK=e(i("4wH3g"))({__loadable_id__:"ZPhfu",name:"LoadableBrowseRovoAgentsModal",loader:()=>i("04nhu").then(e=>e.default),loading:()=>null}),iW=()=>(e(g).useEffect(()=>{iK.preload()},[]),null),iq=({dispatch:e,state:t})=>({syncCommonAttributes:n=>e(t.tr.setMeta(ts,n))}),iY=e(g).createContext(null),i$=()=>{let t=e(g).useContext(iY);if(!t)throw Error("Attempted to access AIExperienceCommonDataContext before its value is set");return t},iJ=t=>({key:i("bwpRs").CONFIG_ITEM_KEYS.FREE_GENERATE_EDITOR_AGENT,title:i("SFzFl").default.aiButtonTitle,description:i("SFzFl").default.aiUniversalLongCallToAction,promptHint:i("AMCQl").aiConfigItemMessages.freeGeneratePromptHint,icon:()=>e(g).createElement(e(i("3Mg7y")),{label:"",spacing:"spacious"}),doNotHighlightDocWhenSelectionIsEmpty:!0,insertOnEmptySelection:!0,quickInsertPriority:Number.NEGATIVE_INFINITY,canTogglePageKnowledge:!1,disableInterrogation:()=>!1,silentAgentPrompt:!0,agent:t.agent,intentSchemaId:"DISABLED",actions:{empty:[(0,i("jc4DP").createInsertAtCurrentPosition)({appearance:"primary"})],selection:[(0,i("jc4DP").createInsertBelow)({appearance:"secondary",factoryOptions:t}),(0,i("jc4DP").createReplace)({appearance:"primary"})]},getBackendModel:()=>"assistance-service"}),iQ=(e,t)=>t.type===e.nodes.doc,iX=({schema:e,adfResponse:t,adfResponseNodeWrappers:n})=>{let a=i("5SAOw").Node.fromJSON(e,t),r=!iQ(e,a)&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")?i("5SAOw").Fragment.from(a):a.content,o=n?[...n]:[];for(;o.length>0;){let e=o.pop();if(e&&1===r.content.length&&r.content[0].type.name===e)r=r.content[0].content;else break}return r},iZ=e=>{switch(e){case"ANALYSING_QUERY":return n1.messageTemplateAnalysingQuery;case"CONTENT_SEARCH":return n1.messageTemplateContentSearch;case"PAGE_HYDRATION":return n1.messageTemplatePageHydration;case"NEXT_BEST_TASK":return n1.messageTemplateNextBestTask;case"WRITING":return n1.loadingTitle;default:return(0,i("dh538").fg)("editor_ai_loading_text_fallback_to_generating")?n1.generatingAiResponse:void 0}},i0=({status:e,formatMessage:t})=>{if((0,i("dh538").fg)("editor_ai_loading_text_fallback_to_generating")){let n=iZ(e);return t(n?n:n1.generatingAiResponse)}{if(!e||!["ANALYSING_QUERY","CONTENT_SEARCH","PAGE_HYDRATION","NEXT_BEST_TASK","WRITING"].includes(e))return e;let n=iZ(e);return n?t(n):e}};function i1(e){let t=(0,g.useRef)(null);return!t.current&&((0,i("4F0gv").isAdfStreamingEnabled)()||e)&&(t.current=new(0,i("e83av").StreamFlowPacer)({tickMs:41,initialCharsPerTick:8,maxCharsPerTick:1e3,backlogRampThreshold:100,ramp:{initialDelaySec:6,stepDelaySec:3,flushDelaySec:.5,growthFactor:1.5}})),(0,g.useEffect)(()=>{t.current?.destroy()},[]),t}let i5="MarkdownConversionError";class i2 extends Error{constructor({message:e,type:t}){super(e),this.type=void 0,this.name=i5,this.type=t}}let i8=e=>e.name===i5?i("7ShCl").aiMessages.markdownErrorMessage:i("7ShCl").aiMessages.cmdPaletteUnhandledErrorMessage,i4=t=>{let n=(0,i("4SGh1").useFireAIAnalyticsEvent)(),{formatMessage:a}=(0,i("8C5kA").default)(),[r,o]=(0,g.useState)(!1);return e(g).createElement(i("lAJUP").ErrorBoundary,{onError:(e,t)=>{if((0,i("hWRJP").logException)(e,{location:"editor-plugin-ai-error-boundary"}),e.name===i5){let a="type"in e?e.type:void 0;n({payload:{action:"unhandledErrorCaught",actionSubject:"editorPluginAI",actionSubjectId:"experienceApplication",attributes:{componentStack:t.componentStack||"",errorType:"markdownToProseMirrorError",errorSubType:a,errorMessage:i("2QlXt").ErrorUtils.extractErrorMessage(e)},eventType:i("d925B").EVENT_TYPE.OPERATIONAL}})}else n({payload:{action:"unhandledErrorCaught",actionSubject:"editorPluginAI",actionSubjectId:"experienceApplication",attributes:{componentStack:t.componentStack||"",errorMessage:i("2QlXt").ErrorUtils.extractErrorMessage(e)},eventType:i("d925B").EVENT_TYPE.OPERATIONAL}})},fallbackRender:({error:n,resetErrorBoundary:r})=>e(g).createElement(i("f02sP").UnhandledErrorScreen,{inContentComponent:t.inContentComponent,text:a(i8(n)),onCancel:()=>{t.onCloseFallback(),r(),o(!0)},isAIFC:!0})},r?null:t.children)};var i3=e=>{let t=(0,g.useRef)(null);return((0,g.useEffect)(()=>{e&&(t.current=e)},[e]),e)?e:t.current?"RENDERING":"PENDING"};let i9=({loadingStatus:t})=>{let n=i3(t);return n?e(g).createElement(i("fwDOR").default,{name:`loadingStatus_${n}`,key:`loadingStatus_${n}`}):e(g).createElement(e(g).Fragment,null)},i6=e=>{let t=(e=e.trim()).charAt(0),n=e.charAt(e.length-1);return'"'===t&&'"'===n||"'"===t&&"'"===n?e.substring(1,e.length-1):e};i("42omo");var i7=(0,i("cgtv4").defineMessages)({acceptLabel:{id:"fabric.editor.ai.screens.acceptReject.acceptLabel",defaultMessage:"Accept"},rejectLabel:{id:"fabric.editor.ai.screens.acceptReject.rejectLabel",defaultMessage:"Discard"}});let ae={toggleChangesButtonWrapper:"_12o5glyw"},at=({onAccept:t,onReject:n,onBadResponseButtonClick:a,onGoodResponseButtonClick:r,isDisplayingChanges:o,onToggleChanges:s})=>{let{formatMessage:l}=(0,i("8C5kA").default)();return(0,n5.jsx)(i("40sdH").FloatingContainer,{"data-testid":"accept-reject-screen",rainbowBorderAnimation:!1,rainbowBorder:!1,disablePadding:!0,enableMaxWidth:!0,isAIFC:!0,children:(0,n5.jsxs)(i("1s5hv").default,{justifyContent:"space-between",alignItems:"center",xcss:"_ca0qutpp _n3tdutpp _19bvpxbi _u5f3pxbi",children:[(0,n5.jsxs)(i("1s5hv").default,{gap:"space.050",children:[(0,i("dh538").fg)("platform_editor_ai_aifc_no_default_diff")&&(0,n5.jsx)(i("1s5hv").default,{alignItems:"center",justifyContent:"center",xcss:ae.toggleChangesButtonWrapper,children:(0,n5.jsx)(i("1qfLF").default,{testId:"toggle-changes-button",type:"button",icon:e(i("fi2El")),label:l(i("808tb").trackChangesMessages.toolbarIconLabel),appearance:"subtle",isTooltipDisabled:!1,tooltip:{position:"top",content:l(i("808tb").trackChangesMessages.toolbarIconLabel)},isSelected:o,onClick:s})}),(0,n5.jsx)(i("9zowQ").FeedbackForm,{onBadResponseButtonClick:a,onGoodResponseButtonClick:r,flexIconWrapper:(0,i("dh538").fg)("platform_editor_ai_aifc_no_default_diff"),largeIconButton:(0,i("dh538").fg)("platform_editor_ai_aifc_no_default_diff")})]}),(0,n5.jsxs)(i("1s5hv").default,{gap:(0,i("dh538").fg)("platform_editor_ai_aifc_no_default_diff")?"space.050":"space.100",children:[(0,n5.jsx)(i("ccHMk").default,{appearance:"subtle",onClick:n,children:l(i7.rejectLabel)}),(0,n5.jsx)(i("ccHMk").default,{appearance:"primary",onClick:t,autoFocus:!0,children:l(i7.acceptLabel)})]})]})})};function an(e){let{formatMessage:t}=(0,i("8C5kA").default)();return(0,g.useMemo)(()=>e?.presetTitle?{presetTitle:$(e.presetTitle,t),userInput:e?.userInput,userADFInput:e?.userADFInput}:{userInput:e?.userInput||"",userADFInput:e?.userADFInput},[e,t])}let ai=({input:e,output:t})=>{if(e=e.trim(),t=t.trim(),e=e.replace(/\u200C/gu,""),t=t.replace(/\u200C/gu,""),e=e.replace(/\n+$/u,""),t=t.replace(/\n+$/u,""),""===e&&""===t)return 0;if(""===e||""===t||Math.max(e.length,t.length)>1.02020202020202*Math.min(e.length,t.length))return 1;if(e===t)return 0;let n=.495*(e.length+t.length),i=!0,a=((e,t)=>{let a=Array.from({length:e.length+1},()=>Array(t.length+1).fill(0));for(let r=1;r<=e.length;r++){let o=0;for(let n=1;n<=t.length;n++)e[r-1]===t[n-1]?a[r][n]=a[r-1][n-1]+1:a[r][n]=Math.max(a[r-1][n],a[r][n-1]),o=Math.max(o,a[r][n]);if(o+Math.min(e.length-r,t.length)<n)return i=!1,0}return a[e.length][t.length]})(e,t);return i?Math.max(0,Math.min(1,1-2*a/(e.length+t.length))):1},aa=t=>{let{aiExperienceMachineContext:n,backendModel:a,discardStream:r}=t,{configItem:o,channelId:s,responseHistory:l,latestPrompt:c,markdown:d,retryPromptCount:p,endExperience:u}=n,{api:m,isDisplayingChanges:f}=nD(),{appearance:h,editorPluginAIProvider:_,lastTriggeredFrom:y,sendToAIExperienceMachine:I}=i$(),E=_.product,S=an(c),b=(0,i("4SGh1").useFireAIAnalyticsEvent)(),T=tJ(),C=l.entries[l.positionFromEnd],A=(C.modelInput.selection||C.modelInput.doc)&&d&&(0,i("dh538").fg)("editor_ai_no_improvement_deadend_fix")?ai({input:C.modelInput.selection||C.modelInput.doc||"",output:d}):1,v=C.responseTooSimilar||A<.01,P=C.inputOutputDiffRatio,k=(0,g.useMemo)(()=>({configItemTitle:o.agent?.name||(0,i("6gJll").convertExperienceName)(o.key.toString()),...o.experienceId&&(0,i("dh538").fg)("thor_support_google_docs_in_description_improver")?{experienceId:o.experienceId}:{},lastTriggeredFrom:y,inputOutputDiffRatio:P,backendModel:a}),[o,y,P,a]),x=d||"";x&&(0,i("hX9je").isConfluenceTitleToolbarSuggestTitle)({configItem:o,lastTriggeredFrom:y})&&(x=i6(x)),(0,g.useEffect)(()=>{(0,i("dh538").fg)("platform_editor_ai_aifc_no_default_diff")||m?.trackChanges?.sharedState.currentState()?.isDisplayingChanges||m?.core.actions.execute(m?.trackChanges?.commands.toggleChanges)},[m]);let w=(0,g.useCallback)(()=>{m?.core.actions.execute(m?.trackChanges?.commands.toggleChanges)},[m]),M=(0,g.useCallback)(()=>{m?.analytics?.actions.fireAnalyticsEvent({action:i("d925B").ACTION.CLICKED,actionSubject:i("d925B").ACTION_SUBJECT.BUTTON,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.AI_CHANGES_ACCEPT_BUTTON,eventType:i("d925B").EVENT_TYPE.UI,attributes:{appearance:h,configItemTitle:o.agent?.name||o.key,lastTriggeredFrom:y,product:E}}),m?.analytics?.actions.fireAnalyticsEvent((0,i("ilIeg").createUnifiedAnalyticsPayload)({action:i("d925B").ACTION.ACTIONED,interactionID:s??T.getLastAiInteractionId(),experienceName:(0,i("6gJll").convertExperienceName)(o.key.toString()),isProactive:!1,attributes:{...T.getAiLifeCycleDynamicAttributes({init:!1}),aiResultAction:"accepted",aiActionedType:(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")?"manuallyAccepted":void 0},invokedFrom:y})),u()},[m,h,o,y,E,u,s,T]),N=(0,g.useCallback)(()=>{m?.analytics?.actions.fireAnalyticsEvent({action:i("d925B").ACTION.CLICKED,actionSubject:i("d925B").ACTION_SUBJECT.BUTTON,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.AI_CHANGES_REJECT_BUTTON,eventType:i("d925B").EVENT_TYPE.UI,attributes:{appearance:h,configItemTitle:o.agent?.name||o.key,lastTriggeredFrom:y,product:E}}),m?.analytics?.actions.fireAnalyticsEvent((0,i("ilIeg").createUnifiedAnalyticsPayload)({action:i("d925B").ACTION.DISMISSED,interactionID:s??T.getLastAiInteractionId(),experienceName:(0,i("6gJll").convertExperienceName)(o.key.toString()),isProactive:!1,attributes:T.getAiLifeCycleDynamicAttributes({init:!1}),invokedFrom:y})),r?.(),u()},[m,h,o,y,E,r,u,s,T]),O=(0,g.useCallback)((e,t)=>{b({payload:{action:"click",actionSubject:"editorPluginAI",actionSubjectId:"responseFeedbackButton",attributes:{sentiment:e,appearance:h,product:E,configItemTitle:o.agent?.name||o.key,lastTriggeredFrom:y,productSuccessStatus:t,inputOutputDiffRatio:P,retryPromptCount:p,responseTooSimilar:v,aiInteractionID:T.getLastAiInteractionId()},eventType:i("d925B").EVENT_TYPE.UI}}),b({payload:(0,i("ilIeg").createUnifiedAnalyticsPayload)({action:i("d925B").ACTION.SUBMITTED,interactionID:s??T.getLastAiInteractionId(),experienceName:(0,i("6gJll").convertExperienceName)(o.key.toString(),y),isProactive:!1,invokedFrom:y,attributes:{aiFeedbackResult:"good"===e?"up":"down",...T.getAiLifeCycleDynamicAttributes({init:!1})}})})},[o,b,T,s,y,P,p,v,h,E]),R=(0,g.useCallback)(async e=>{if(T.addAttributes({userFeedbackSentiment:e.sentiment}),I({type:"feedback submitted",sentiment:e.sentiment}),!_.handleFeedbackSubmission)return void O(e.sentiment,"unknown");try{let t=await _.handleFeedbackSubmission(e);O(e.sentiment,t.status)}catch{O(e.sentiment,"failed")}},[O,_,I,T]),D=(0,g.useCallback)(e=>({...k,...e&&{userPrompt:S.userInput,markdownResponse:x}}),[k,S,x]),L=(0,g.useCallback)(()=>{_.onExperienceEvent&&_.onExperienceEvent.THUMBS_DOWN(),R({sentiment:"bad",getAIExperience:D,editorAttributes:{appearance:h,product:E}})},[D,_.onExperienceEvent,R,h,E]),F=(0,g.useCallback)(()=>{_.onExperienceEvent&&_.onExperienceEvent.THUMBS_UP(),R({sentiment:"good",getAIExperience:D,editorAttributes:{appearance:h,product:E}})},[D,_.onExperienceEvent,R,h,E]);return e(g).createElement(at,{onAccept:M,onReject:N,onBadResponseButtonClick:L,onGoodResponseButtonClick:F,isDisplayingChanges:f,onToggleChanges:w})},ar=({formatMessage:e,experienceState:t})=>{let n=e(n1.discardMessagePrompt),i=e(n1.discardMessageResponse),a=e(n1.discardStreamingInDocumennt);return"object"==typeof t&&"user input state"in t?n:"review state"===t||"object"==typeof t&&"loading state"in t?a:i};function ao({state:t,editCount:n,retryPromptCount:a,history:r,onceDiscard:o,channelId:s,streamFlowPacer:l,discardStream:c,api:d}){let p=i$(),u=(0,i("eiA8Z").useSharedPluginStateWithSelector)(d,["aiExperience"],({aiExperienceState:e})=>e?.aiDecorationExperiencePluginState.nextSessionId),{endExperience:m,sendToAIExperienceMachine:f,configItem:h,includeKnowledgeFromCurrentPage:_,appearance:y}=p,I=(0,g.useMemo)(()=>{let e=r.entries[r.positionFromEnd];return 0===r.entries.length?"":e.inputOutputDiffRatio},[r]),{formatMessage:E}=(0,i("8C5kA").default)(),S=(0,i("4SGh1").useFireAIAnalyticsEvent)(),b=tQ({stepName:"discard",attributes:{editCount:n,retryPromptCount:a,inputOutputDiffRatio:I,includeKnowledgeFromCurrentPage:_}});(0,g.useEffect)(()=>(l?.pause(),()=>{l?.resume()}),[l]);let{abort:T}=n7();return u?null:e(g).createElement(n3,{text:ar({formatMessage:E,experienceState:t}),onCancel:function(){f({type:"disable discard"})},onDiscard:function(){S({payload:(0,i("ilIeg").createUnifiedAnalyticsPayload)({action:i("d925B").ACTION.DISMISSED,interactionID:s??b.getLastAiInteractionId(),experienceName:(0,i("6gJll").convertExperienceName)(h.key.toString()),isProactive:!1,attributes:b.getAiLifeCycleDynamicAttributes({init:!1}),invokedFrom:p.lastTriggeredFrom})}),T(),o?(f({type:"disable discard"}),o()):(c?.(),m())},appearance:y,isAIFC:!0})}i("42omo");let as=({onCancel:e,onRetry:t,text:n,showRetryButton:a=!0,appearance:r,isAIFC:o})=>{let{formatMessage:s}=(0,i("8C5kA").default)(),[l,{breakpoint:c}]=(0,i("imfiV").useElementBreakpoints)();return(0,n5.jsxs)(i("BPkYg").ErrorFloatingContainer,{ref:l,breakpoint:c,appearance:r,isAIFC:o,children:[(0,n5.jsx)(i("6F6hl").default,{children:s(i("4pXOZ").default.ariaErrorTitle)}),(0,n5.jsx)(i("BPkYg").ErrorMessage,{breakpoint:c,isAIFC:o,children:n}),(0,n5.jsxs)(i("BPkYg").ErrorButtonContainer,{isAIFC:o,children:[(0,n5.jsx)(i("BPkYg").ErrorButton,{autoFocus:!0,testId:"cancel-button",onClick:e,appearance:t&&a?"subtle":"primary",isAIFC:o,children:s(o?i("4pXOZ").default.closeLabel:i("4pXOZ").default.cancelLabel)}),t&&a&&(0,n5.jsx)(i("BPkYg").ErrorButton,{testId:"retry",onClick:t,appearance:"primary",isAIFC:o,children:s(i("4pXOZ").default.retryLabel)})]})]})},al={[eN.UNKNOWN]:i("ls2Fy").aiFailedStateMessages.documentInsertError,[eN.TOKEN_LIMIT]:i("ls2Fy").aiFailedStateMessages.tokenLimitExceeded,[eN.INSERT_FAILURE]:i("ls2Fy").aiFailedStateMessages.documentInsertError,[eN.INPUT_TOO_SHORT]:i("ls2Fy").aiFailedStateMessages.inputTooShortError,[eN.HIPAA_CONTENT]:i("ls2Fy").aiFailedStateMessages.hipaaContentError,[eN.RATE_LIMITED]:i("ls2Fy").aiFailedStateMessages.rateLimitEnforced,[eN.AUP_VIOLATION]:i("ls2Fy").aiFailedStateMessages.aupViolationMessage,[eN.ELEVATE_DISABLED_GENERATE]:i("ls2Fy").aiFailedStateMessages.elevateDisabledGenerateError,[eN.INTERNAL_SERVER_ERROR]:i("ls2Fy").aiFailedStateMessages.internalServerError,[eN.API_FAIL]:i("ls2Fy").aiFailedStateMessages.apiError,[eN.ADF_STREAMING_ERROR]:i("ls2Fy").aiFailedStateMessages.adfStreamingError,[eN.NO_TEXTUAL_CONTENT]:i("ls2Fy").aiFailedStateMessages.noTextualContentError,[eN.INVALID_JSON]:i("ls2Fy").aiFailedStateMessages.apiError},ac={[eN.UNKNOWN]:i("ls2Fy").aiFailedStateMessages.documentInsertError,[eN.TOKEN_LIMIT]:i("ls2Fy").aiFailedStateMessages.aifcTokenLimitExceeded,[eN.INSERT_FAILURE]:i("ls2Fy").aiFailedStateMessages.documentInsertError,[eN.INPUT_TOO_SHORT]:i("ls2Fy").aiFailedStateMessages.aifcInputTooShortError,[eN.HIPAA_CONTENT]:i("ls2Fy").aiFailedStateMessages.aifcHipaaContentError,[eN.RATE_LIMITED]:i("ls2Fy").aiFailedStateMessages.aifcRateLimitEnforced,[eN.AUP_VIOLATION]:i("ls2Fy").aiFailedStateMessages.aifcAupViolationMessage,[eN.ELEVATE_DISABLED_GENERATE]:i("ls2Fy").aiFailedStateMessages.elevateDisabledGenerateError,[eN.INTERNAL_SERVER_ERROR]:i("ls2Fy").aiFailedStateMessages.aifcInternalServerError,[eN.API_FAIL]:i("ls2Fy").aiFailedStateMessages.aifcApiErrorRetry,[eN.ADF_STREAMING_ERROR]:i("ls2Fy").aiFailedStateMessages.aifcAdfStreamingError,[eN.NO_TEXTUAL_CONTENT]:i("ls2Fy").aiFailedStateMessages.noTextualContentError,[eN.INVALID_JSON]:i("ls2Fy").aiFailedStateMessages.aifcApiErrorRetry},ad={[eN.INTERNAL_SERVER_ERROR]:"https://status.atlassian.com/",[eN.AUP_VIOLATION]:"https://www.atlassian.com/legal/acceptable-use-policy",[eN.RATE_LIMITED]:"https://support.atlassian.com/organization-administration/docs/excessive-use-in-atlassian-intelligence/"},ap={[eN.INTERNAL_SERVER_ERROR]:"https://rovo.status.atlassian.com/",[eN.AUP_VIOLATION]:"https://www.atlassian.com/legal/acceptable-use-policy",[eN.RATE_LIMITED]:"https://support.atlassian.com/organization-administration/docs/excessive-use-in-atlassian-intelligence/"},au=(e,t)=>t?ac[e]:al[e],ag=({error:t,documentationUrl:n})=>{let{isInDocumentStreamingEnabled:a}=nD(),r=au(t,a);return e(g).createElement(i("gtD4K").default,{...r,values:{link:t=>e(g).createElement("a",{href:n,target:"_blank",rel:"noopener noreferrer"},t)}})},am=e=>e>=500&&e<600,af=({failureReason:e,statusCode:t=500})=>e===eN.ADF_STREAMING_ERROR||e===eN.INVALID_JSON||e===eN.API_FAIL&&!am(t),ah=({apiName:e,failureReason:t})=>"assistance-service"===e||t===eN.AUP_VIOLATION||t===eN.API_FAIL?"apiError":"failed",a_=({errorKey:t,failureReason:n,statusCode:a})=>{let{formatMessage:r}=(0,i("8C5kA").default)(),{isInDocumentStreamingEnabled:o}=nD(),s=["FEATURE_DISABLED","FEATURE_DISABLED_ON_SITE","NO_AGENT"].includes(t||"");return 9001===a?e(g).createElement(i("iXCQx").default,null,r(al["elevate disabled generate"])):a&&am(a)||s||n===eN.INTERNAL_SERVER_ERROR?e(g).createElement(ag,{error:eN.INTERNAL_SERVER_ERROR,documentationUrl:(o?ap:ad)[eN.INTERNAL_SERVER_ERROR]}):n?n===eN.AUP_VIOLATION?e(g).createElement(ag,{error:eN.AUP_VIOLATION,documentationUrl:(o?ap:ad)[eN.AUP_VIOLATION]}):n===eN.RATE_LIMITED?e(g).createElement(ag,{error:eN.RATE_LIMITED,documentationUrl:(o?ap:ad)[eN.RATE_LIMITED]}):e(g).createElement(i("iXCQx").default,null,r(au(n,o))):e(g).createElement(i("iXCQx").default,null,r(al["unknown fail"]))};function ay({errorInfo:t}){let{endExperience:n,sendToAIExperienceMachine:a,editorView:r,appearance:o}=i$(),{isInDocumentStreamingEnabled:s}=nD();return tQ({stepName:ah(t),attributes:{errorType:t.failureReason??eN.UNKNOWN,sawAupViolation:t.failureReason===eN.AUP_VIOLATION,...t}}),e(g).useEffect(()=>{(0,i("dh538").fg)("platform_editor_ai_audit_logs_events")&&t.failureReason===eN.AUP_VIOLATION&&N({"aup-violation":{eventStatus:"send-event"}})(r.state,r.dispatch)},[t.failureReason,r]),e(g).createElement(as,{text:a_(t),onCancel:()=>{n()},onRetry:()=>a({type:"retry"}),showRetryButton:af(t),appearance:o,isAIFC:s})}function aI({errorInfo:t,contextStatistics:n}){let{endExperience:i}=i$(),{isInDocumentStreamingEnabled:a}=nD();return tQ({stepName:"invalidInput",attributes:{reason:t.failureReason??eN.UNKNOWN,modelIO:{contextStatistics:n}}}),e(g).createElement(as,{text:a_(t),onCancel:()=>{i()},isAIFC:a})}let aE=e=>!!e.match(/<(c(u(s(t(o(m(?!.*<\/custom>|.*\/>).*?)?)?)?)?)?)?$/g),aS=({editorPluginAIProvider:e})=>{let t,{formatMessage:n}=(0,i("8C5kA").default)(),{aiUsageDisclaimer:a}=e;return a&&(t={text:n(a.text),tooltip:n(a.tooltip),url:a.url}),t};function ab({userADFInput:e}){return(0,g.useMemo)(()=>{let t=new(0,i("h9yJL").JSONTransformer),n=e?new(0,i("8nxxM").ProseMirrorContentStatistics)(t.parse(e)):void 0;return n?.collectStatistics()},[e])}let aT="use-general-ai-knowledge",aC="use-rovo-organisation-knowledge",aA="tell-ai",av="tell-agent",aP="agent:browse-more-agents";var ak=i("67O0h");let ax=({jsonDocument:e,showTelepointer:t,providerFactory:n,schema:a})=>{let r=tJ(),o=(0,i("4SGh1").useFireAIAnalyticsEvent)(),s=i$(),l=(0,i("6gJll").convertExperienceName)(s.configItem.key.toString()),c=s.lastTriggeredFrom,d=(0,g.useRef)(null),p=(0,g.useRef)(!1),u=(0,g.useRef)(new(0,i("4FxUL").default)),m=(0,i("4F0gv").isAdfStreamingEnabled)();(0,g.useEffect)(()=>{let e=(e,t)=>{u.current.setProvider(e,t)},t=(e,t)=>{u.current.setProvider(e,t)},i=(e,t)=>{u.current.setProvider(e,t)},a=(e,t)=>{u.current.setProvider(e,t)};return n.subscribe("mentionProvider",e),n.subscribe("emojiProvider",t),n.subscribe("mediaProvider",i),m&&n.subscribe("extensionProvider",a),()=>{n.unsubscribe("mentionProvider",e),n.unsubscribe("emojiProvider",t),n.unsubscribe("mediaProvider",i),m&&n.unsubscribe("extensionProvider",a)}},[n,m]);let f=(0,g.useCallback)(async()=>{let e=d.current;r&&e&&function(e){let t=window.getSelection();if(!t?.rangeCount||!t.toString())return!1;let{anchorNode:n,focusNode:i}=t;if(!n||!i)return!1;if([n,i].some(t=>e.contains(t)))return!0;let a=n.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_FOLLOWING,r=a?t.anchorNode:t.focusNode,o=a?t.focusNode:t.anchorNode;return!!r&&!!o&&!!(r.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_FOLLOWING&&o.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_PRECEDING||r.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_PRECEDING&&o.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_FOLLOWING)}(e)&&(function(e){let t=window.getSelection(),n=t?.toString();if(!n)return!1;let i=e.innerText.replace(/\n/g,"").trim(),a=n.replace(/\n/g,"").trim(),r=!1,o=!1;if(t){let{anchorNode:n,focusNode:i}=t,a=!e.contains(n),s=!e.contains(i);r=a&&s;let l=0===t.anchorOffset,c=t.focusOffset===i?.textContent?.length;(a&&c||s&&l)&&(o=!0)}return!r&&!o&&i!==a}(d.current)&&r.addAttributes({contentCopiedPartially:!0}),o&&l&&o({payload:(0,i("ilIeg").createUnifiedAnalyticsPayload)({action:i("d925B").ACTION.ACTIONED,interactionID:r.getLastAiInteractionId(),experienceName:l,isProactive:!1,attributes:{...r.getAiLifeCycleDynamicAttributes({init:!1}),aiResultAction:"copied"},invokedFrom:c})}),p.current||(r.addAttributes({contentCopied:!0}),p.current=!0))},[r,o,l,c]);return(0,g.useEffect)(()=>(0,i("fFa3V").bind)(document,{type:"copy",listener:f}),[f,r]),g.createElement("div",{"data-testid":"preview-renderer",ref:d,className:(0,i("gMc0m").default)(["_1gxu4jg8 _1u11i7a9 _1ddwi7uo",m&&"_r98naq80 _1m04aq80 _17megrf3"])},g.createElement(i("lspPP").RendererActionsContext,null,g.createElement(ak.default,{appearance:void 0,document:e,media:m?{allowLinking:!0,allowCaptions:!0}:{allowLinking:!1},useSpecBasedValidator:!0,addTelepointer:t,allowCustomPanels:m,allowAnnotations:m,allowWrapCodeBlock:m,schema:m?a:void 0,dataProviders:u.current,allowPlaceholderText:!0,UNSTABLE_allowTableAlignment:m,UNSTABLE_allowTableResizing:m})))},aw=new(0,i("h9yJL").JSONTransformer);function aM({schema:t,pmFragment:n,showTelepointer:i,providerFactory:a}){let r,o=t.nodes.doc.createAndFill({},n);if(!o)throw new i2({message:"Unable to transform markdown into a valid prosemirror document",type:"noProseMirrorDoc"});if(0===o.content.size)throw new i2({message:"Transforming markdown returns an empty prosemirror document",type:"emptyProseMirrorDoc"});try{r=aw.encode(o)}catch{throw new i2({message:"Unable to transform markdown into a valid prosemirror document",type:"invalidProseMirrorDoc"})}return e(g).createElement(ax,{jsonDocument:r,showTelepointer:i,providerFactory:a})}function aN({adfResponse:t,showTelepointer:n,providerFactory:i,schema:a}){return e(g).createElement(ax,{schema:a,jsonDocument:t,showTelepointer:n,providerFactory:i})}function aO({mountDecorations:t,updateStream:n,parentPresetPromptLabel:a,childShortTitle:r,title:o,latestPrompt:s,promptTrigger:l,refinementCount:c,latestPromptRetried:d,markdown:p,adfResponse:u,adfResponseNodeWrappers:m,idMap:f,contextStatistics:h,hideLoadingScreen:_,api:y}){let{configItem:I,editorView:E,providerFactory:S,sendToAIExperienceMachine:b,editorPluginAIProvider:T,includeKnowledgeFromCurrentPage:C,isUserScroll:A,isProgrammaticScroll:v,appearance:P}=i$(),k=E.state.schema,x=(0,i("eiA8Z").useSharedPluginStateWithSelector)(y,["aiExperience"],({aiExperienceState:e})=>e?.aiDecorationExperiencePluginState.nextSessionId);(0,g.useEffect)(()=>t?t():()=>{},[t]);let{mounted:w,streaming:M}=(0,i("5gEqE").useUIStore)(),{formatMessage:N}=(0,i("8C5kA").default)(),O=aS({editorPluginAIProvider:T}),R=J(I,N),D=(0,i("4SGh1").useFireAIAnalyticsEvent)(),[L,F]=(0,g.useState)(),[G,B]=(0,g.useState)(!1),U=(0,g.useRef)(null),V=(0,g.useRef)(),j=(0,g.useRef)(!1),H=(0,g.useRef)(null),z=(0,g.useRef)(0),K=(0,g.useRef)(0),W=(0,g.useRef)(!1),q=(0,g.useCallback)((e,t)=>{v.current=!0,t.scroll({top:z.current+K.current+e.scrollHeight-t.offsetHeight,behavior:"instant"})},[v]),Y=(0,g.useCallback)(e=>{v.current=!0,e.scroll({top:z.current+K.current-32,behavior:"instant"})},[v]);(0,g.useEffect)(()=>{let e=E.dom.closest(".ak-editor-content-area");if(!e)return;let t=new ResizeObserver(()=>{v.current=!0});return t.observe(e),()=>t.unobserve(e)},[E,v]),(0,g.useEffect)(()=>{if(!(0,i("dh538").fg)("platform_editor_ai_scroll_into_view_fix"))return;let t=U.current;if(!t)return;let n=(0,i("7YjFd").findOverflowScrollParent)(t);if(!n)return;let a=e(eo)(()=>{r()},250),r=(0,i("fFa3V").bind)(n,{type:"scroll",listener:a})},[]);let $=(0,g.useRef)(u);$.current=u;let Q=(0,g.useRef)(void 0);(0,g.useEffect)(()=>{if($.current&&(0,i("4F0gv").isAdfStreamingEnabled)()&&n&&(0,i("dh538").fg)("platform_editor_ai_aifc_background")){let e=iX({schema:k,adfResponse:$.current,adfResponseNodeWrappers:m});Q.current&&Q.current.eq(e)||(Q.current=e,v.current=!0,n({fragment:e,isFinalStream:!1,hasUserScrolled:A.current}));return}void 0===V.current&&(V.current=window.requestAnimationFrame(()=>{let e;if(V.current=void 0,$.current&&(0,i("4F0gv").isAdfStreamingEnabled)())if(n){let e=iX({schema:k,adfResponse:$.current,adfResponseNodeWrappers:m});(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")?Q.current&&Q.current.eq(e)||(Q.current=e,v.current=!0,n({fragment:e,isFinalStream:!1,hasUserScrolled:A.current})):(v.current=!0,n({fragment:e,isFinalStream:!1,hasUserScrolled:A.current}))}else e=aN({adfResponse:$.current,showTelepointer:!0,providerFactory:S});else if(p&&""!==p){let{pmFragment:t}=ep({markdown:p,schema:k,source:"loading",fireAIAnalyticsEvent:e=>{j.current||(j.current=!0,D(e))},idMap:f});if(aE(p))return;n?(v.current=!0,n({fragment:t,isFinalStream:!1,hasUserScrolled:A.current})):e=aM({schema:k,pmFragment:t,showTelepointer:!0,providerFactory:S})}else e=void 0;e&&(F(e),B(!0),window.requestAnimationFrame(()=>{!function(){if(A.current||W.current)return;let e=U.current;if(!e)return;let t=H.current;if(!t)return;let n=t.offsetHeight>K.current+e.scrollHeight,i=t.offsetHeight-32<e.scrollHeight;if(!n){if(i){Y(t),W.current=!0;return}q(e,t)}}()}))}))},[p,n,u]),(0,g.useEffect)(()=>()=>{V.current&&window.cancelAnimationFrame(V.current)},[]);let X=an(s),Z=ab(X),ee=tQ({needUpdatedArgs:!0,stepName:"loading",attributes:{promptType:l,latestPromptRetried:d,refinementCount:c,modelIO:{contextStatistics:h,userInputCharacterCount:Z?.totalCharacterCount,userInputNodeCounts:Z?.nodeCounts,userInputLinksCount:Z?.linksCount,userInputMentionsCount:Z?.mentionsCount},includeKnowledgeFromCurrentPage:C}}),et=(0,g.useRef)();!et.current&&G&&(et.current=performance.now()),(0,g.useEffect)(()=>{let e=performance.now();return()=>{et.current&&ee.addAttributes({durations:{timeSpentWithoutPartialPreview:et.current-e,timeSpentWithPartialPreview:performance.now()-et.current}})}},[]);let en=(0,g.useCallback)(()=>{b({type:"enable discard"})},[b]);return x?null:g.createElement("div",{ref:U,className:(0,i("gMc0m").default)(["_j4orxy5q","_1e0c11p5"])},g.createElement(ip,{parentPresetPromptLabel:a,childShortTitle:r,presetPromptLabel:R,latestPrompt:X,agent:I?.agent,title:o,preview:L,providerFactory:S,disclaimer:O,onCancel:en,schema:k,isStreaming:!!u||!!p,canInlineStreamChanges:!0,hideLoadingScreen:w&&M||!!_,appearance:P,isAIFC:!0}))}var aR=(0,i("cgtv4").defineMessages)({noImprovementMessage:{id:"fabric.editor.ai.screens.noImprovement.noImprovementMessage",defaultMessage:"No improvements, nice work."},successIconLabel:{id:"fabric.editor.ai.screens.noImprovement.successIconLabel",defaultMessage:"Success"}});let aD=({isHidden:t,onceFade:n,appearance:a})=>{let{formatMessage:r}=(0,i("8C5kA").default)(),[o,s]=(0,g.useState)(null);return(0,g.useEffect)(()=>{o&&o.scrollIntoView({block:"nearest"})},[o]),(0,g.useEffect)(()=>{if(t&&n&&o)return(0,i("fFa3V").bind)(o,{type:"transitionend",listener:e=>{"opacity"===e.propertyName&&n()}})},[t,n,o]),(0,n5.jsx)(i("40sdH").FloatingContainer,{ref:e=>{s(e)},"data-testid":"no-improvement-screen",className:(0,i("gMc0m").default)(["_v564168n _j4orxy5q _10fp1h6o _1bsb1ns9",t&&"_tzy4idpf",i("kuYGt").AI_MODAL_SCREEN_CLASS]),rainbowBorder:!1,appearance:a,isAIFC:!0,children:(0,n5.jsxs)(i("u9agA").default,{xcss:"_zulpu2gc _1e0c1txw _2lx2vrvc _u5f31b66 _19bv1b66",children:[(0,n5.jsx)(i("6F6hl").default,{children:r(aR.successIconLabel)}),(0,n5.jsxs)(i("u9agA").default,{xcss:"_16jlkb7n _1o9zkb7n _i0dlf1ug _zulpu2gc _1e0c1txw _2lx2vrvc _1bah1y6m _4cvr1h6o _ca0q12x7 _u5f31b66 _n3td12x7 _19bv1b66",children:[(0,n5.jsx)(i("iXCQx").default,{children:(0,n5.jsx)(e(i("3sFtD")),{label:r(aR.successIconLabel),color:"var(--ds-icon-success, #6A9A23)"})}),(0,n5.jsx)(i("iXCQx").default,{children:r(aR.noImprovementMessage)})]})]})})};function aL({discardStream:t}){let{endExperience:n,editorView:i,appearance:a}=i$(),[r,o]=(0,g.useState)(!1);return(0,g.useEffect)(()=>{t?.({restoreSelection:!1});let e=setTimeout(()=>{o(!0)},1e3);return()=>clearTimeout(e)},[i,t]),e(g).createElement(aD,{isHidden:r,onceFade:n,appearance:a})}var aF=i("6dSQX");let aG=({disabled:t,userInput:n,onCancel:a,onDiscard:r,modalRef:o})=>{e(g).useEffect(()=>{if(!t&&o)return(0,i("fFa3V").bind)(document,{type:"mousedown",listener:e=>{!function(e){if(!e)return!1;let t=e.closest(".atlaskit-portal");if(!t)return!!document.querySelector('[data-focus-guard="true"]');let n=t.nextElementSibling;for(;n;){if(n.querySelector('[data-focus-guard="true"]'))return!0;n=n.nextElementSibling}return!1}(o.current)&&o.current&&!o.current.contains(e.target)&&(n?r():a())}})},[t,n,a,r,o])};var aB=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32};aB.Diff=function(e,t){this[0]=e,this[1]=t},aB.Diff.prototype.length=2,aB.Diff.prototype.toString=function(){return this[0]+","+this[1]},aB.prototype.diff_main=function(e,t,n,i){void 0===i&&(i=this.Diff_Timeout<=0?Number.MAX_VALUE:new Date().getTime()+1e3*this.Diff_Timeout);var a=i;if(null==e||null==t)throw Error("Null input. (diff_main)");if(e==t)return e?[new aB.Diff(0,e)]:[];void 0===n&&(n=!0);var r=n,o=this.diff_commonPrefix(e,t),s=e.substring(0,o);e=e.substring(o),t=t.substring(o),o=this.diff_commonSuffix(e,t);var l=e.substring(e.length-o);e=e.substring(0,e.length-o),t=t.substring(0,t.length-o);var c=this.diff_compute_(e,t,r,a);return s&&c.unshift(new aB.Diff(0,s)),l&&c.push(new aB.Diff(0,l)),this.diff_cleanupMerge(c),c},aB.prototype.diff_compute_=function(e,t,n,i){if(!e)return[new aB.Diff(1,t)];if(!t)return[new aB.Diff(-1,e)];var a,r=e.length>t.length?e:t,o=e.length>t.length?t:e,s=r.indexOf(o);if(-1!=s)return a=[new aB.Diff(1,r.substring(0,s)),new aB.Diff(0,o),new aB.Diff(1,r.substring(s+o.length))],e.length>t.length&&(a[0][0]=a[2][0]=-1),a;if(1==o.length)return[new aB.Diff(-1,e),new aB.Diff(1,t)];var l=this.diff_halfMatch_(e,t);if(l){var c=l[0],d=l[1],p=l[2],u=l[3],g=l[4],m=this.diff_main(c,p,n,i),f=this.diff_main(d,u,n,i);return m.concat([new aB.Diff(0,g)],f)}return n&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,i):this.diff_bisect_(e,t,i)},aB.prototype.diff_lineMode_=function(e,t,n){var i=this.diff_linesToChars_(e,t);e=i.chars1,t=i.chars2;var a=i.lineArray,r=this.diff_main(e,t,!1,n);this.diff_charsToLines_(r,a),this.diff_cleanupSemantic(r),r.push(new aB.Diff(0,""));for(var o=0,s=0,l=0,c="",d="";o<r.length;){switch(r[o][0]){case 1:l++,d+=r[o][1];break;case -1:s++,c+=r[o][1];break;case 0:if(s>=1&&l>=1){r.splice(o-s-l,s+l),o=o-s-l;for(var p=this.diff_main(c,d,!1,n),u=p.length-1;u>=0;u--)r.splice(o,0,p[u]);o+=p.length}l=0,s=0,c="",d=""}o++}return r.pop(),r},aB.prototype.diff_bisect_=function(e,t,n){for(var i=e.length,a=t.length,r=Math.ceil((i+a)/2),o=2*r,s=Array(o),l=Array(o),c=0;c<o;c++)s[c]=-1,l[c]=-1;s[r+1]=0,l[r+1]=0;for(var d=i-a,p=d%2!=0,u=0,g=0,m=0,f=0,h=0;h<r&&!(new Date().getTime()>n);h++){for(var _=-h+u;_<=h-g;_+=2){for(var y,I=r+_,E=(y=_==-h||_!=h&&s[I-1]<s[I+1]?s[I+1]:s[I-1]+1)-_;y<i&&E<a&&e.charAt(y)==t.charAt(E);)y++,E++;if(s[I]=y,y>i)g+=2;else if(E>a)u+=2;else if(p){var S=r+d-_;if(S>=0&&S<o&&-1!=l[S]){var b=i-l[S];if(y>=b)return this.diff_bisectSplit_(e,t,y,E,n)}}}for(var T=-h+m;T<=h-f;T+=2){for(var b,S=r+T,C=(b=T==-h||T!=h&&l[S-1]<l[S+1]?l[S+1]:l[S-1]+1)-T;b<i&&C<a&&e.charAt(i-b-1)==t.charAt(a-C-1);)b++,C++;if(l[S]=b,b>i)f+=2;else if(C>a)m+=2;else if(!p){var I=r+d-T;if(I>=0&&I<o&&-1!=s[I]){var y=s[I],E=r+y-I;if(y>=(b=i-b))return this.diff_bisectSplit_(e,t,y,E,n)}}}}return[new aB.Diff(-1,e),new aB.Diff(1,t)]},aB.prototype.diff_bisectSplit_=function(e,t,n,i,a){var r=e.substring(0,n),o=t.substring(0,i),s=e.substring(n),l=t.substring(i),c=this.diff_main(r,o,!1,a),d=this.diff_main(s,l,!1,a);return c.concat(d)},aB.prototype.diff_linesToChars_=function(e,t){var n=[],i={};function a(e){for(var t="",a=0,o=-1,s=n.length;o<e.length-1;){-1==(o=e.indexOf("\n",a))&&(o=e.length-1);var l=e.substring(a,o+1);(i.hasOwnProperty?i.hasOwnProperty(l):void 0!==i[l])?t+=String.fromCharCode(i[l]):(s==r&&(l=e.substring(a),o=e.length),t+=String.fromCharCode(s),i[l]=s,n[s++]=l),a=o+1}return t}n[0]="";var r=4e4,o=a(e);return r=65535,{chars1:o,chars2:a(t),lineArray:n}},aB.prototype.diff_linesToWords_=function(e,t){var n=[],i={};function a(e){var t="",a=0,o=-1;let s=[".",",","?","!",":",";"," ","￻","￹"];for(var l=n.length;e?.length&&o<e.length-1;){o=s.reduce((t,n)=>{let i=e.indexOf(n,a);return -1!==i&&i<t?i:t},e.length-1);let d=s.includes(e.charAt(o));if(-1==o&&(o=e.length-1),d){let t=e.charAt(o),n=1;for(let i=o+1;i<e.length&&e.charAt(i)===t;i++)n++;o+=n-1}var c=e.substring(a,o+1);(i.hasOwnProperty?i.hasOwnProperty(c):void 0!==i[c])?t+=String.fromCharCode(i[c]):(l==r&&(c=e.substring(a),o=e.length),t+=String.fromCharCode(l),i[c]=l,n[l++]=c),a=o+1}return t}n[0]="";var r=4e4,o=a(e);return r=65535,{chars1:o,chars2:a(t),lineArray:n}},aB.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var i=e[n][1],a=[],r=0;r<i.length;r++)a[r]=t[i.charCodeAt(r)];e[n][1]=a.join("")}},aB.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,i=Math.min(e.length,t.length),a=i,r=0;n<a;)e.substring(r,a)==t.substring(r,a)?r=n=a:i=a,a=Math.floor((i-n)/2+n);return a},aB.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,i=Math.min(e.length,t.length),a=i,r=0;n<a;)e.substring(e.length-a,e.length-r)==t.substring(t.length-a,t.length-r)?r=n=a:i=a,a=Math.floor((i-n)/2+n);return a},aB.prototype.diff_commonOverlap_=function(e,t){var n=e.length,i=t.length;if(0==n||0==i)return 0;n>i?e=e.substring(n-i):n<i&&(t=t.substring(0,n));var a=Math.min(n,i);if(e==t)return a;for(var r=0,o=1;;){var s=e.substring(a-o),l=t.indexOf(s);if(-1==l)return r;o+=l,(0==l||e.substring(a-o)==t.substring(0,o))&&(r=o,o++)}},aB.prototype.diff_halfMatch_=function(e,t){if(this.Diff_Timeout<=0)return null;var n,i,a,r,o,s=e.length>t.length?e:t,l=e.length>t.length?t:e;if(s.length<4||2*l.length<s.length)return null;var c=this;function d(e,t,n){for(var i,a,r,o,s=e.substring(n,n+Math.floor(e.length/4)),l=-1,d="";-1!=(l=t.indexOf(s,l+1));){var p=c.diff_commonPrefix(e.substring(n),t.substring(l)),u=c.diff_commonSuffix(e.substring(0,n),t.substring(0,l));d.length<u+p&&(d=t.substring(l-u,l)+t.substring(l,l+p),i=e.substring(0,n-u),a=e.substring(n+p),r=t.substring(0,l-u),o=t.substring(l+p))}return 2*d.length>=e.length?[i,a,r,o,d]:null}var p=d(s,l,Math.ceil(s.length/4)),u=d(s,l,Math.ceil(s.length/2));return p||u?(n=u?p&&p[4].length>u[4].length?p:u:p,e.length>t.length?(i=n[0],a=n[1],r=n[2],o=n[3]):(r=n[0],o=n[1],i=n[2],a=n[3]),[i,a,r,o,n[4]]):null},aB.prototype.diff_cleanupSemantic=function(e){for(var t=!1,n=[],i=0,a=null,r=0,o=0,s=0,l=0,c=0;r<e.length;)0==e[r][0]?(n[i++]=r,o=l,s=c,l=0,c=0,a=e[r][1]):(1==e[r][0]?l+=e[r][1].length:c+=e[r][1].length,a&&a.length<=Math.max(o,s)&&a.length<=Math.max(l,c)&&(e.splice(n[i-1],0,new aB.Diff(-1,a)),e[n[i-1]+1][0]=1,i--,r=--i>0?n[i-1]:-1,o=0,s=0,l=0,c=0,a=null,t=!0)),r++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),r=1;r<e.length;){if(-1==e[r-1][0]&&1==e[r][0]){var d=e[r-1][1],p=e[r][1],u=this.diff_commonOverlap_(d,p),g=this.diff_commonOverlap_(p,d);u>=g?(u>=d.length/2||u>=p.length/2)&&(e.splice(r,0,new aB.Diff(0,p.substring(0,u))),e[r-1][1]=d.substring(0,d.length-u),e[r+1][1]=p.substring(u),r++):(g>=d.length/2||g>=p.length/2)&&(e.splice(r,0,new aB.Diff(0,d.substring(0,g))),e[r-1][0]=1,e[r-1][1]=p.substring(0,p.length-g),e[r+1][0]=-1,e[r+1][1]=d.substring(g),r++),r++}r++}},aB.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var n=e.charAt(e.length-1),i=t.charAt(0),a=n.match(aB.nonAlphaNumericRegex_),r=i.match(aB.nonAlphaNumericRegex_),o=a&&n.match(aB.whitespaceRegex_),s=r&&i.match(aB.whitespaceRegex_),l=o&&n.match(aB.linebreakRegex_),c=s&&i.match(aB.linebreakRegex_),d=l&&e.match(aB.blanklineEndRegex_),p=c&&t.match(aB.blanklineStartRegex_);if(d||p)return 5;if(l||c)return 4;if(a&&!o&&s)return 3;if(o||s)return 2;if(a||r)return 1;return 0}for(var n=1;n<e.length-1;){if(0==e[n-1][0]&&0==e[n+1][0]){var i=e[n-1][1],a=e[n][1],r=e[n+1][1],o=this.diff_commonSuffix(i,a);if(o){var s=a.substring(a.length-o);i=i.substring(0,i.length-o),a=s+a.substring(0,a.length-o),r=s+r}for(var l=i,c=a,d=r,p=t(i,a)+t(a,r);a.charAt(0)===r.charAt(0);){i+=a.charAt(0),a=a.substring(1)+r.charAt(0),r=r.substring(1);var u=t(i,a)+t(a,r);u>=p&&(p=u,l=i,c=a,d=r)}e[n-1][1]!=l&&(l?e[n-1][1]=l:(e.splice(n-1,1),n--),e[n][1]=c,d?e[n+1][1]=d:(e.splice(n+1,1),n--))}n++}},aB.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,aB.whitespaceRegex_=/\s/,aB.linebreakRegex_=/[\r\n]/,aB.blanklineEndRegex_=/\n\r?\n$/,aB.blanklineStartRegex_=/^\r?\n\r?\n/,aB.prototype.diff_cleanupMerge=function(e){e.push(new aB.Diff(0,""));for(var t,n=0,i=0,a=0,r="",o="";n<e.length;)switch(e[n][0]){case 1:a++,o+=e[n][1],n++;break;case -1:i++,r+=e[n][1],n++;break;case 0:i+a>1?(0!==i&&0!==a&&(0!==(t=this.diff_commonPrefix(o,r))&&(n-i-a>0&&0==e[n-i-a-1][0]?e[n-i-a-1][1]+=o.substring(0,t):(e.splice(0,0,new aB.Diff(0,o.substring(0,t))),n++),o=o.substring(t),r=r.substring(t)),0!==(t=this.diff_commonSuffix(o,r))&&(e[n][1]=o.substring(o.length-t)+e[n][1],o=o.substring(0,o.length-t),r=r.substring(0,r.length-t))),n-=i+a,e.splice(n,i+a),r.length&&(e.splice(n,0,new aB.Diff(-1,r)),n++),o.length&&(e.splice(n,0,new aB.Diff(1,o)),n++),n++):0!==n&&0==e[n-1][0]?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,a=0,i=0,r="",o=""}""===e[e.length-1][1]&&e.pop();var s=!1;for(n=1;n<e.length-1;)0==e[n-1][0]&&0==e[n+1][0]&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),s=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),s=!0)),n++;s&&this.diff_cleanupMerge(e)};let aU=new aB,aV=(e,t,n=[])=>{let i=aU.diff_linesToWords_(e,t),a=aU.diff_main(i.chars1,i.chars2,!1);aU.diff_charsToLines_(a,i.lineArray);let r=a.map(e=>({type:e[0],text:e[1],length:e[1].length}));return n.reduce((e,t)=>t(e),r)},aj=(e,t)=>-1===e.type&&t?.type===1?"REPLACEMENT":-1===e.type?"DELETION":1===e.type&&(!t||t&&-1!==t.type)?"ADDITION":void 0,aH=(e,t,n)=>{let a=[],r=[];if(e.descendants((e,t)=>!e.isTextblock||(a.push([e,n+t]),!1)),0===a.length)return r.map(([e,t])=>({original:i("5SAOw").Fragment.empty,corrected:e.content,offset:n+t}));if(t.descendants((e,t)=>!e.isTextblock||(r.push([e,n+t]),!1)),0===r.length)return a.map(([e,t])=>({original:e.content,corrected:i("5SAOw").Fragment.empty,offset:t}));let o=[];for(let e=0;e<a.length;e++){o[e]=[];for(let t=0;t<r.length;t++)o[e][t]=aK(a[e][0].textContent,r[t][0].textContent)}let s=Array(a.length+1).fill(0).map(()=>Array(r.length+1).fill(0)),l=Array(a.length+1).fill(0).map(()=>Array(r.length+1).fill(""));for(let e=1;e<=a.length;e++)for(let t=1;t<=r.length;t++){let n=s[e-1][t],i=s[e][t-1],a=o[e-1][t-1],r=s[e-1][t-1]+a;r>=n&&r>=i?(s[e][t]=r,l[e][t]="match"):n>=i?(s[e][t]=n,l[e][t]="skip-original"):(s[e][t]=i,l[e][t]="skip-corrected")}let c=[],d=new Set,p=new Set,u=a.length,g=r.length;for(;u>0&&g>0;)"match"===l[u][g]?(c.push([u-1,g-1]),d.add(u-1),p.add(g-1),u--,g--):"skip-original"===l[u][g]?u--:g--;c.reverse();let m=[];for(let[e,t]of c)m.push({original:a[e][0].content,corrected:r[t][0].content,offset:a[e][1]});for(let e=0;e<a.length;e++)d.has(e)||m.push({original:a[e][0].content,corrected:i("5SAOw").Fragment.empty,offset:a[e][1]});for(let e=0;e<r.length;e++)if(!p.has(e)){let t=n;for(let n=0;n<e;n++)if(p.has(n)){let e=c.find(([e,t])=>t===n)?.[0];if(void 0===e)continue;t=Math.max(t,a[e][1]+a[e][0].nodeSize)}m.push({original:i("5SAOw").Fragment.empty,corrected:r[e][0].content,offset:t})}return m.sort((e,t)=>e.offset-t.offset),m},az=(e,t)=>{let n,i=Array(e.length+1).fill(0),a=0;for(let r=0;r<=t.length;r++)for(let o=0;o<=e.length;o++)n=r&&o?e.charAt(o-1)===t.charAt(r-1)?a:Math.min(i[o],i[o-1],a)+1:r+o,a=i[o],i[o]=n;return i[e.length]},aK=(e,t)=>e===t?1:0===e.length||0===t.length?0:1-az(e,t)/Math.max(e.length,t.length),aW=({original:e,corrected:t,schema:n,offset:i=0,ignoredRanges:a,postProcessors:r})=>aH(e,t,i).reduce((e,{original:t,corrected:i,offset:o})=>e.concat(aq({original:t,corrected:i,schema:n,offset:o,ignoredRanges:a,postProcessors:r})),[]),aq=({original:e,corrected:t,schema:n,offset:a=0,ignoredRanges:r,postProcessors:o})=>{let s=[],l=[],{mention:c}=n.nodes,d=e=>{let t=l.findIndex(t=>t.type===c?t.attrs.id===e.attrs.id:t.eq(e));return t<0&&(l.push(e),t=l.length-1),`\uFFF9${t}\uFFFB`},p=aV(e.textBetween(0,e.size,"",d),t.textBetween(0,t.size,"",d),o).map(e=>{let t=!1,a=e.text.split("￹").reduce((e,i)=>{let a=i.split("￻");if(a.length>1){t=!0;let n=a.shift();e=e.addToEnd(l[parseInt(n)])}let r=a.join("");return r.length>0?e.addToEnd(n.text(r)):e},i("5SAOw").Fragment.empty);return{type:e.type,text:e.text,length:e.length,fragment:a,hasInlineNodes:t}}),u=a,g=p.length;for(let e=0;e<g;e++){let t=p[e],{type:n,text:o,fragment:l,hasInlineNodes:c}=t,d=aj(p[e],p?.[e+1]),g=0===o.trim().length;if("DELETION"===d)s.push({from:a,to:a+l.size,type:d,original:l,replacement:i("5SAOw").Fragment.empty,isWhiteSpace:g,hasInlineNodes:c});else if("REPLACEMENT"===d||"ADDITION"===d){let n={from:a,to:a,type:d,original:i("5SAOw").Fragment.empty,replacement:l,hasInlineNodes:c,isWhiteSpace:g};if("REPLACEMENT"===d){let i=p?.[e+1]??t,a=o.endsWith(" ")&&i.text.endsWith(" "),r=Math.min(a?o.length-o.trimEnd().length:0,a?i.text.length-i.text.trimEnd().length:0);n.to+=l.size-r,n.original=a?l.cut(0,l.size-r):l,n.replacement=a?i.fragment.cut(0,i.fragment.size-r):i.fragment,n.isWhiteSpace=n.isWhiteSpace||0===n.replacement.size,e++}r?!function(e,t,n){return t.some(({pos:t,size:i})=>!(e.to<n+t)&&!(e.from>n+t+i))}(n,r,u)&&s.push(n):s.push(n)}(0===n||-1===n)&&(a+=l.size)}return s},aY=(e,t,n)=>{let a=new(0,i("aXG5V").Transform)(e),{onAddition:r,onDeletion:o,onReplacement:s}=n;return t.forEach(e=>{let t=a.mapping.map(e.to),n=Math.min(a.mapping.map(e.from),a.doc.content.size,t),i={...e,transform:a,from:n,to:t};switch(e.type){case"ADDITION":r(i);break;case"DELETION":o(i);break;case"REPLACEMENT":s(i)}}),a},a$=e=>{let t=[];for(let n=0;n<e.length;n++)if(-1!==e[n].type||e?.[n+1]?.type!==1||e[n+1].text.includes("￹")||e[n+1].text.includes("￻"))t.push(e[n]);else{let i=[];for(let t=n+2;t<e.length;t++)if(e?.[t]?.type!==0||e?.[t]?.text.trim().length!==0||e?.[t+1]?.type!==-1||e?.[t+2]?.type!==1||e[t+1].text.includes("￹")||e[t+1].text.includes("￻"))break;else i.push(e?.[t],e?.[t+1],e?.[t+2]),t+=3;if(i.length){let a=i.reduce((e,t)=>e+(t.type<=0?t.text:""),e[n].text);t.push({type:-1,text:a,length:a.length});let r=i.reduce((e,t)=>e+(t.type>=0?t.text:""),e[n+1].text);t.push({type:1,text:r,length:r.length}),n+=i.length+1}else t.push(e[n])}return t},aJ=new Set(["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","=","?","@","[","\\","]","^","_","`"].map(e=>e.charCodeAt(0))),aQ=new Set(["！","ǃ","ⵑ","‼","ꝸ","՚","ʾ","〃","ˊ","᾽","“","ˮ","”","˴",'"',"ʼ","‴","΄","ˋ","῾","ʻ","‶","״","᾿","ʺ","‷","⁗","˶","’","ᛌ","‛","ߴ","᳓","ᑊ","ײ","ߵ","˝","´","＇","″","`","′","ʹ","ˈ","‘","`","ʹ","՝","׳","｀","‵","＂","‟","´","י","ꞌ","ʽ","〔","❲","［","❨","⸨","﴾","❳","〕","❩","﴿","］","⸩"]),aX=(e,t)=>{let n=String.fromCharCode(e),i=String.fromCharCode(t);return!(e===t&&aQ.has(n)||e!==t&&(aJ.has(e)&&aQ.has(i)||aJ.has(t)&&aQ.has(n)))&&(e!==t||!aJ.has(e))},aZ=(e,t,n)=>{let i=Math.min(e.length,t.length);for(let a=0;a<i;a++){let i=n>0?0:1;if(aX(e.charCodeAt(i*(e.length-1)+a*n),t.charCodeAt(i*(t.length-1)+a*n)))return a}return -1},a0=e=>{let t=[];for(let n=0;n<e.length;n++){if(-1===e[n].type&&e?.[n+1]?.type===1){let i=e[n].text,a=e[n+1].text;if(aX(i.charCodeAt(0),a.charCodeAt(0))&&aX(i.charCodeAt(i.length-1),a.charCodeAt(a.length-1))){t.push(e[n]);continue}let r=aZ(i,a,1),o=aZ(i,a,-1);if(r<=0&&o<=0){t.push(e[n]);continue}if(i.substring(r,i.length-o)===a.substring(r,a.length-o)){t.push({type:0,text:i,length:i.length}),n+=1;continue}if(r>0){let e=i.substring(0,r);t.push({type:0,text:e,length:e.length})}if((r>0||o>0)&&(t.push({type:-1,text:i.substring(r,i.length-o),length:i.length-r-o}),t.push({type:1,text:a.substring(r,a.length-o),length:a.length-r-o})),o>0){let e=i.substring(i.length-o);t.push({type:0,text:e,length:e.length})}n+=1;continue}t.push(e[n])}return t},a1=({editorView:e,pmFragment:t,positions:n,providerFactory:a,colorMode:r})=>{let o,s;if(t===i("5SAOw").Fragment.empty)return;let{schema:l}=e.state;if(!l.marks?.backgroundColor||(o=n[0]===n[1]?e.state.doc.slice(0,e.state.doc.content.size):e.state.doc.slice(n[0],n[1],!0)).openStart!==o.openEnd)return;let c=o.content.firstChild?.isInline&&o.content.lastChild?.isInline?i("5SAOw").Fragment.from(l.nodes.paragraph.create({},o.content)):o.content;if(!c)return;let d=aW({original:t,corrected:c,schema:l,offset:1,postProcessors:[a0,a$]});if(!d.length)return;let p=l.nodes.doc.createAndFill({},t);if(!p)return;let u=aY(p,d,{onAddition:({transform:e,from:t,to:n,replacement:i})=>{i&&(e.insert(t,i),e.addMark(t,n+i.size,l.marks.backgroundColor.create({color:"#FF8F73"})))},onDeletion:({transform:e,from:t,to:n})=>{e.addMark(t,n,l.marks.backgroundColor.create({color:"#79F2C0"}))},onReplacement:({transform:e,from:t,to:n})=>{e.addMark(t,n,l.marks.backgroundColor.create({color:"#FFE380"}))}}),m=new(0,i("h9yJL").JSONTransformer)(l);try{s=m.encode(u.doc)}catch(e){return}if(s)return g.createElement("div",{"data-testid":"diff-preview-renderer",className:(0,i("gMc0m").default)(["_f3ge1911 _1lop1ihb _11atv77o","light"===r?"_4hbpo6gu _4853o6gu _2hapo6gu":"_4hbpal15 _4853al15 _2hapal15"])},g.createElement(ax,{jsonDocument:s,providerFactory:a,showTelepointer:!1}))};function a5(e,t){let n=t?.entries?.length===1;return"generate"!==e&&n}function a2({aiExperienceMachineContext:t,isInputActive:n,backendModel:a,rovoAction:r,rovoPublish:o}){let s,l,{formatMessage:c}=(0,i("8C5kA").default)(),{isEmpty:d,parentPresetPromptLabel:p,latestPrompt:u,markdown:m,adfResponse:f,configItem:h,userInput:_,userADFInput:y,editCount:I,retryPromptCount:E,refinementCount:S,idMap:b,responseHistory:T,contextStatistics:C,promptTrigger:A,channelId:v,selectionMetaData:P}=t,k=i$(),{appearance:x,editorPluginAIProvider:w,editorView:M,endExperience:N,positions:O,providerFactory:R,sendToAIExperienceMachine:D,lastTriggeredFrom:L,modalRef:F,triggeredFor:G,includeKnowledgeFromCurrentPage:B,canInlineStreamChanges:U}=k,V=aS({editorPluginAIProvider:w}),j=p&&h.nestingConfig?c(h.nestingConfig.shortTitle):"",H=_||"",z=M.state.schema,K=w.product,q=(0,i("4F0gv").isAdfStreamingEnabled)();(0,g.useEffect)(()=>{w.onExperienceEvent?.REVIEW_STATE_ENTERED()},[w]);let $=(0,g.useRef)(),J=T.entries[T.positionFromEnd],Q=(J.modelInput.selection||J.modelInput.doc)&&m&&(0,i("dh538").fg)("editor_ai_no_improvement_deadend_fix")?ai({input:J.modelInput.selection||J.modelInput.doc||"",output:m}):1,X=J.responseTooSimilar||Q<.01,Z=J.inputOutputDiffRatio,ee=m||"",et=(0,i("4SGh1").useFireAIAnalyticsEvent)(),en=tJ(),ei=(0,g.useRef)(!1),ea=e(g).useRef(!1);ee&&(0,i("hX9je").isConfluenceTitleToolbarSuggestTitle)({configItem:h,lastTriggeredFrom:L})&&(ee=i6(ee));let er=i("5SAOw").Fragment.empty;f&&q?(er=i("5SAOw").Node.fromJSON(z,f).content,s=aN({adfResponse:f,showTelepointer:!1,providerFactory:R,schema:z})):(l=ep({markdown:ee,schema:z,source:"preview",fireAIAnalyticsEvent:e=>{ea.current||(ea.current=!0,et(e))},idMap:b}),s=function(t){if(X){let t=c(n1.responseTooSimilarMessage);return e(g).createElement(i("iXCQx").default,{as:"p"},t)}return aM({schema:z,pmFragment:t,showTelepointer:!1,providerFactory:R})}(er=l?.pmFragment||i("5SAOw").Fragment.empty));let eo=s;aG({modalRef:F,userInput:H,onCancel:()=>D({type:"enable discard"}),onDiscard:()=>D({type:"enable discard"})});let es=an(u),el=ab(es);(0,g.useEffect)(()=>{let e;en.fireQueuedStep("preview");let t=new(0,i("8nxxM").ProseMirrorContentStatistics)(er).collectStatistics();return f&&q?e={selectionSize:J.modelInput.selection?.length,outputUnclosedTokens:{},outputHTMLConvertedToNodes:0,outputHTMLConvertedToFallbackNodes:0,isTextFallbackUsed:!1,previewNodeCounts:t.nodeCounts,previewMarkCounts:t.markCounts,previewTotalCharacterCounts:t.totalCharacterCount,userInputCharacterCount:el?.totalCharacterCount,userInputNodeCounts:el?.nodeCounts,userInputLinksCount:el?.linksCount,userInputMentionsCount:el?.mentionsCount}:l&&(e={selectionSize:J.modelInput.selection?.length,nodesConvertedToHTMLInput:b?Object.keys(b).length:void 0,outputUnclosedTokens:l.unclosedTokens,outputHTMLConvertedToNodes:l.htmlConvertedToNodes,outputHTMLConvertedToFallbackNodes:l.htmlConvertedToFallbackNodes,isTextFallbackUsed:l.isTextFallbackUsed,previewNodeCounts:t.nodeCounts,previewMarkCounts:t.markCounts,previewTotalCharacterCounts:t.totalCharacterCount,userInputCharacterCount:el?.totalCharacterCount,userInputNodeCounts:el?.nodeCounts,userInputLinksCount:el?.linksCount,userInputMentionsCount:el?.mentionsCount}),en.addAttributes({editCount:I,responseTooSimilar:X,modelIO:{contextStatistics:C,...e},inputOutputDiffRatio:Z}),(0,i("dh538").fg)("platform_editor_ai_streaming_ended_analytics_attr")&&en.updateCommonAttributes({isStreamingEnded:!0}),()=>{!1===ei.current&&en.enqueueStep({stepName:"preview",attributes:void 0})}},[]);let{colorMode:ec="light"}=(0,i("cOrQJ").default)(),[ed,eu]=(0,g.useState)(null),eg=h.canToggleDiffPreview&&"backgroundColor"in z.marks&&(0,i("dh538").fg)("platform_editor_ai_visual_diff_preview");(0,g.useEffect)(()=>{if(eg&&!X&&er){let e=a1({editorView:M,pmFragment:er,positions:O,providerFactory:R,colorMode:ec});e&&eu(e)}},[eg]);let em=(0,g.useCallback)(()=>{et({payload:(0,i("ilIeg").createUnifiedAnalyticsPayload)({action:i("d925B").ACTION.DISMISSED,attributes:en.getAiLifeCycleDynamicAttributes({init:!1}),experienceName:(0,i("6gJll").convertExperienceName)(h.key.toString(),L),interactionID:v??en.getLastAiInteractionId(),invokedFrom:k.lastTriggeredFrom,isProactive:!1,isStreamingEnded:(0,i("dh538").fg)("platform_editor_ai_streaming_ended_analytics_attr")?en.getCommonAttributes().isStreamingEnded:void 0})})},[en,k.lastTriggeredFrom,v,h.key,et,L]),ef=(e,t)=>{et({payload:{action:"click",actionSubject:"editorPluginAI",actionSubjectId:"responseFeedbackButton",attributes:{sentiment:e,appearance:x,product:K,configItemTitle:h.agent?.name||h.key,lastTriggeredFrom:L,productSuccessStatus:t,inputOutputDiffRatio:Z,retryPromptCount:E,responseTooSimilar:X,aiInteractionID:en.getLastAiInteractionId()},eventType:i("d925B").EVENT_TYPE.UI}}),et({payload:(0,i("ilIeg").createUnifiedAnalyticsPayload)({action:i("d925B").ACTION.SUBMITTED,interactionID:v??en.getLastAiInteractionId(),experienceName:(0,i("6gJll").convertExperienceName)(h.key.toString(),L),isProactive:!1,invokedFrom:k.lastTriggeredFrom,attributes:{aiFeedbackResult:"good"===e?"up":"down",...en.getAiLifeCycleDynamicAttributes({init:!1})}})})},eh=async e=>{if(en.addAttributes({userFeedbackSentiment:e.sentiment}),D({type:"feedback submitted",sentiment:e.sentiment}),!w.handleFeedbackSubmission)return void ef(e.sentiment,"unknown");try{let t=await w.handleFeedbackSubmission(e);ef(e.sentiment,t.status)}catch{ef(e.sentiment,"failed")}},e_=(0,g.useCallback)(()=>{let{userInput:e,userADFInput:t,presetTitle:n}=es;en.addAttributes({actionTaken:"edit-prompt"}),et({payload:{action:"click",actionSubject:"editorPluginAI",actionSubjectId:"editPromptButton",attributes:{experienceType:(0,i("6gJll").convertExperienceName)(h.key.toString()),editCount:I},eventType:i("d925B").EVENT_TYPE.UI}}),em(),D({type:"edit prompt",userInput:e,userADFInput:t,presetTitle:n})},[h.key,es,en,et,I,em,D]),ey=(0,g.useCallback)(()=>{if(a5(A,T))return void N();let{presetTitle:e}=es;D({type:"edit prompt",userInput:"",userADFInput:void 0,presetTitle:e})},[N,T,es,A,D]),eI=(0,g.useCallback)(()=>{D({type:"enable discard",context:{onceDiscard:ey}})},[D,ey]),eE={configItemTitle:h.agent?.name||(0,i("6gJll").convertExperienceName)(h.key.toString()),...h.experienceId&&(0,i("dh538").fg)("thor_support_google_docs_in_description_improver")?{experienceId:h.experienceId}:{},lastTriggeredFrom:L,inputOutputDiffRatio:Z,backendModel:a},eS=e=>({...eE,...e&&{userPrompt:es.userInput,markdownResponse:ee}});e(g).useEffect(()=>{H||$.current?.()},[H]);let eb=e(g).useCallback(e=>{D({type:"update user input",input:e})},[D]),eT=e(g).useCallback(e=>{D({type:"update user input adf",adf:e})},[D]),eC=h.disableInterrogation?.()||w.disableInterrogation||T.positionFromEnd>0,eA=(0,g.useCallback)(()=>{H?(em(),D({type:"cancel refinement"})):(em(),ey())},[H,ey,em,D]),ev=(0,g.useCallback)(()=>{et({payload:{action:"click",actionSubject:"editorPluginAI",actionSubjectId:"retryPromptButton",attributes:{experienceType:(0,i("6gJll").convertExperienceName)(h.key.toString())},eventType:i("d925B").EVENT_TYPE.UI}}),em(),D({type:"retry prompt",input:es.userInput,adf:es.userADFInput})},[h.key,et,em,es.userADFInput,es.userInput,D]),[eP,ek]=e(g).useState(!1),ex=(0,g.useCallback)(({runFn:e,analyticsTitle:t,preserveEditorSelectionOnComplete:n})=>{if(!eP)try{ek(!0),en.addAttributes({actionTaken:t}),en.enqueueStep({stepName:"preview"}),ei.current=!0,en.fireQueuedStep("complete");let i=performance.now();e(),en.enqueueStep({stepName:"complete",attributes:{actionTaken:t,duration:Math.round(performance.now()-i),editCount:I,retryPromptCount:E,promptType:A,refinementCount:S,inputOutputDiffRatio:Z,includeKnowledgeFromCurrentPage:B}}),w.onExperienceEvent?.EXPERIENCE_COMPLETE(),N({preserveEditorSelectionOnComplete:n})}catch(e){ek(!1),et({payload:{action:"unhandledErrorCaught",actionSubject:"editorPluginAI",actionSubjectId:"experienceApplication",attributes:{errorType:"actionRunError",actionTitle:t,errorMessage:i("2QlXt").ErrorUtils.extractErrorMessage(e)},eventType:i("d925B").EVENT_TYPE.OPERATIONAL}}),D({type:"error",errorInfo:{failureReason:eN.UNKNOWN}})}},[eP,en,I,E,A,S,Z,B,w.onExperienceEvent,N,et,D]),ew=(0,g.useCallback)(e=>{let t=e.isRovoAgentAction&&r?ep({markdown:r.content||"",schema:z,source:"rovo-action",fireAIAnalyticsEvent:()=>{},idMap:{}}).pmFragment:er,{isDisabled:n,tooltip:i}=e.getDisabledState?.({markdown:ee,formatMessage:c})??{};return{label:c(e.title),appearance:e.appearance,onClick:()=>{ex({runFn:()=>{e.run({editorView:M,positions:O,markdown:ee,pmFragment:t,triggeredFor:G,selectionMetaData:q?P:void 0}),h.agent&&w.onDocChangeByAgent&&w.onDocChangeByAgent(h.agent)},analyticsTitle:"string"==typeof e.title.defaultMessage?e.title.defaultMessage:""})},isDisabled:n||eP,tooltip:i,icon:e.icon}},[q,r,z,er,ee,c,eP,ex,M,O,G,h.agent,w,P]),eM=(0,g.useCallback)(e=>({label:c(e.title),appearance:e.appearance,icon:e.icon,shortcut:e.shortcut,onClick:()=>{ex({runFn:()=>e.run({channelId:v,publish:o}),analyticsTitle:"string"==typeof e.title.defaultMessage?e.title.defaultMessage:"",preserveEditorSelectionOnComplete:e.preserveEditorSelectionOnComplete})}}),[v,c,ex,o]),eO=function(){let{formatMessage:e}=(0,i("8C5kA").default)();return(0,g.useCallback)(t=>{let n=t.entries[0].configItem.title;return{name:n?e(n):"",dialogues:t.entries.map((t,n)=>{let i=e(t.configItem.title),a=t.userInput;return 0===n&&(a=`${i}

${a}`),a=a.trim()||i,{agent_message:{content:t.markdown},human_message:{content:a}}})}},[e])}(),eR=(0,g.useCallback)(({title:e,appearance:t,icon:n,shortcut:i,run:a,preserveEditorSelectionOnComplete:r})=>({label:c(e),appearance:t,icon:n,shortcut:i,onClick:()=>{ex({runFn:()=>a({publish:o,...eO(T)}),analyticsTitle:"string"==typeof e.defaultMessage?e.defaultMessage:"",preserveEditorSelectionOnComplete:r})}}),[eO,c,T,ex,o]),eD=W({isEmpty:d,configItem:T.entries[0]?.configItem}),eL=(0,g.useMemo)(()=>{let e=W({isEmpty:d,configItem:h});return(e=eD||e).map(e=>"agent"===e.type?eM(e):"generic-chat"===e.type?eR(e):ew(e))},[d,h,eD,ew,eM,eR]),eF=(0,g.useMemo)(()=>{let t=Y({configItemWithOptions:w.configItemWithOptions}).filter(e=>e.showInRefineDropdown),n=[],a={},r=({newConfigItem:e})=>{et({payload:{action:"click",actionSubject:"editorPluginAI",actionSubjectId:"refinementOption",attributes:{experienceType:(0,i("6gJll").convertExperienceName)(h.key.toString()),refinementType:(0,i("6gJll").convertExperienceName)(e.key.toString())},eventType:i("d925B").EVENT_TYPE.UI}})},o=e=>()=>{r({newConfigItem:e});let t=ee;if(e.adfPrompt&&q)if(f)t=JSON.stringify(f);else{let{pmFragment:e}=ep({markdown:ee,schema:z,source:"markdown-to-adf-conversion-for-refinement",fireAIAnalyticsEvent:e=>{ea.current||(ea.current=!0,et(e))},idMap:b}),n=z.nodes.doc.createAndFill({},e);n&&(t=JSON.stringify(new(0,i("h9yJL").JSONTransformer)(z).encode(n,{keepNestedTables:!0})))}D({type:"refine",configItem:e,latestPromptResponse:t})};for(let i of t){let{nestingConfig:t}=i;if(t){let r=t.parentTitle.id??JSON.stringify(t.parentTitle);if(!a[r]){let o=t.icon||i.icon,s={icon:e(g).createElement(e(g).Fragment,null," ",o?.({formatMessage:c})," "),title:t.parentTitle,children:[]};n.push(s),a[r]=s}a[r].children?.push({title:i.nestingConfig?.shortTitle??i.title,onClick:o(i)})}else n.push({title:i.title,icon:e(g).createElement(e(g).Fragment,null,i.icon?.({formatMessage:c})),onClick:o(i)})}return n},[q,f,b,z,h.key,w.configItemWithOptions,et,c,ee,D]),eG=(0,g.useCallback)(()=>{et({payload:{action:"click",actionSubject:"editorPluginAI",actionSubjectId:"refinementButton",attributes:{experienceType:(0,i("6gJll").convertExperienceName)(h.key.toString())},eventType:i("d925B").EVENT_TYPE.UI}})},[h.key,et]);return e(g).createElement(aF.PreviewScreen,{key:h.key,parentPresetPromptLabel:p,childShortTitle:j,latestPrompt:es,diffPreview:ed,canShowVisualDiffPreview:eg,preview:eo,disableActions:!!X,inputValue:H,inputADFValue:y,isInputActive:n,onCancel:eA,onInputChange:eb,onADFChange:eT,onInputFocus:()=>{D({type:"start refinement"})},onInputBlur:()=>{H||D({type:"cancel refinement"})},onSubmit:()=>{D({type:"interrogate",userInput:H,userADFInput:y,latestPromptResponse:ee})},onCopy:()=>{et({payload:{action:"click",actionSubject:"editorPluginAI",actionSubjectId:"copyButton",attributes:{experienceType:(0,i("6gJll").convertExperienceName)(h.key.toString()),editCount:I},eventType:i("d925B").EVENT_TYPE.UI}}),et({payload:(0,i("ilIeg").createUnifiedAnalyticsPayload)({action:i("d925B").ACTION.ACTIONED,interactionID:v??en.getLastAiInteractionId(),experienceName:(0,i("6gJll").convertExperienceName)(h.key.toString()),isProactive:!1,attributes:{...en.getAiLifeCycleDynamicAttributes({init:!1}),aiResultAction:"copied"},invokedFrom:L})}),en.addAttributes({contentCopied:!0}),(0,i("3gD8G").copyPMFragmentToClipboard)({editorView:M,pmFragment:er})},onRetry:h.agent?void 0:ev,onGoodResponseButtonClick:()=>{w.onExperienceEvent&&w.onExperienceEvent.THUMBS_UP(),eh({sentiment:"good",getAIExperience:eS,editorAttributes:{appearance:x,product:K}})},onBadResponseButtonClick:()=>{w.onExperienceEvent&&w.onExperienceEvent.THUMBS_DOWN(),eh({sentiment:"bad",getAIExperience:eS,editorAttributes:{appearance:x,product:K}})},onEditPromptClick:e_,onBack:eI,applications:eL,PromptEditor:w.PromptEditor,clearInputRef:$,disclaimer:V,providerFactory:R,schema:z,disableInterrogation:eC,agent:h.agent,onRefinementClick:eG,refineDropdownItems:eF,canInlineStreamChanges:U()})}let a8=(e,t)=>{(0,g.useLayoutEffect)(()=>{let n=e.current;if(n)return(0,i("dh538").fg)("platform_editor_ai_scroll_into_view_fix")||n.scrollIntoView({block:"nearest",behavior:"auto"}),(0,i("fFa3V").bindAll)(n,[{type:"keydown",listener:e=>{"Escape"===e.key&&(e.preventDefault(),e.stopPropagation(),t())}},{type:"keyup",listener:e=>{"Escape"===e.key&&(e.preventDefault(),e.stopPropagation())}}])},[e,t])},a4=(e,t)=>{let n=t?.trim().length===0,i=(0,g.useCallback)(t=>{"Enter"!==t.key||t.shiftKey||n||(t.preventDefault(),e())},[n,e]);return{isDisabled:n,onKeyDown:i}};var a3=(0,i("cgtv4").defineMessages)({insertMenuTriggerLabel:{id:"fabric.editor.ai.screens.prompt.streaming.insertMenu.triggerLabel",defaultMessage:"Insert rich content"},insertMenuAddLink:{id:"fabric.editor.ai.screens.prompt.streaming.insertMenu.addLink",defaultMessage:"Add link"},insertMenuMention:{id:"fabric.editor.ai.screens.prompt.streaming.insertMenu.mention",defaultMessage:"Mention user"},promptRecord:{id:"fabric.editor.ai.screens.prompt.streaming.record",defaultMessage:"Record"},promptSubmit:{id:"fabric.editor.ai.screens.prompt.streaming.submit",defaultMessage:"Submit"},promptPlaceholder:{id:"fabric.editor.ai.screens.prompt.streaming.placeholder",defaultMessage:"Describe what you want to do"},inlineCommentPromptPlaceholder:{id:"fabric.editor.ai.screens.prompt.streaming.inlineCommentPlaceholder",defaultMessage:"Describe what to do"}});let a9=({textInput:e,adfInput:t,onTextChange:n,onADFChange:a,submit:r,cancel:o,PromptEditor:s,appearance:l,isAIFC:c})=>{let d=(0,i("8C5kA").default)(),p=(0,g.useRef)(null);a8(p,o);let{onKeyDown:u}=a4(r,e),[m,{breakpoint:f}]=(0,i("imfiV").useElementBreakpoints)(i("imfiV").Breakpoint.SmallChromeless),h=f<=i("imfiV").Breakpoint.SmallChromeless?`${d.formatMessage(a3.inlineCommentPromptPlaceholder)}...`:`${d.formatMessage(a3.promptPlaceholder)}...`;return(0,n5.jsx)(i("40sdH").FloatingContainer,{ref:e=>{p.current=e,m(e)},"data-testid":"prompt-form-screen",disablePadding:!0,rainbowBorder:!1,enableMaxHeight:!0,appearance:l,isAIFC:c,children:(0,n5.jsx)(i("u9agA").default,{xcss:"_18zrpxbi _1rjcutpp",children:(0,n5.jsx)(i("7PdHP").PromptEditorWrapper,{autoFocus:!0,PromptEditor:s,type:"user-input",defaultValue:t,onInputChange:n,onADFChange:a,placeholder:h,enableLinks:!0,onKeyDown:c?void 0:u,submit:r,isAIFC:c})})})},a6=({context:e})=>new iv({states:{"partial preset selection and command options list state":{states:{"no partial preset selected full options list":{description:`If no partial preset is selected and there is no text input:
- Show the full options list`,on:{onPartialPresetSelected:{target:"partial preset selected no options list",actions:["removeInputText","partialPresetSelected"]}}},"no partial preset selected related options list":{description:`If no partial preset is selected and the user has entered text:
- Show the related options list`,on:{onPartialPresetSelected:{target:"partial preset selected no options list",actions:["removeInputText","partialPresetSelected"]}}},"partial preset selected no options list":{on:{onPartialPresetRemoved:[{target:"no partial preset selected related options list",guard:"hasInputText",actions:"partialPresetRemoved"},{target:"no partial preset selected full options list",actions:"partialPresetRemoved"}]},description:`If a partial preset is already selected:
- Don't show the options list
- Show the selected preset`},initialisation:{always:[{target:"partial preset selected no options list",guard:"hasInitialPreset"},"no partial preset selected full options list"]}},initial:"initialisation"}},context:e,types:{events:{}},type:"parallel",id:"command palette state machine",on:{onTextEntered:{actions:"updateTextInput"},onADFEntered:{actions:"updateADFInput"},updateBaseGenerateAndConfigItem:{actions:"updateBaseGenerateAndConfigItem"}}},{guards:{hasInputText:({context:e})=>!!e.textInput,hasInitialPreset:({context:e})=>void 0!==e.presetPromptLabel},actions:{updateTextInput:(0,i("cPMXw").a)(({event:e})=>"onTextEntered"===e.type?"input"in e?{textInput:e.input}:{textInput:""}:{}),updateADFInput:(0,i("cPMXw").a)(({event:e})=>"onADFEntered"===e.type?"adf"in e?{adfInput:e.adf}:{adfInput:void 0}:{}),partialPresetSelected:(0,i("cPMXw").a)(({event:e})=>"onPartialPresetSelected"===e.type?{configItem:e.configItem,presetPromptLabel:e.presetPromptLabel}:{}),partialPresetRemoved:(0,i("cPMXw").a)(({context:e,event:t})=>"onPartialPresetRemoved"===t.type?{configItem:e.baseGenerate,presetPromptLabel:void 0}:{presetPromptLabel:void 0}),removeInputText:(0,i("cPMXw").a)(()=>({textInput:"",adfInput:void 0})),updateBaseGenerateAndConfigItem:(0,i("cPMXw").a)(({event:e})=>"updateBaseGenerateAndConfigItem"===e.type?{configItem:e.configItem,baseGenerate:e.baseGenerate}:{})}});function a7({startingConfig:t,startingPresetPromptLabel:n,baseGenerate:i,startingUserInput:a,startingUserADFInput:r}){let o=e(g).useRef(null);null===o.current&&(o.current=a6({context:{textInput:a,adfInput:r,configItem:t,presetPromptLabel:n,baseGenerate:i}}));let[s,l]=ix(o.current);return e(g).useEffect(()=>{i&&l({type:"updateBaseGenerateAndConfigItem",baseGenerate:i,configItem:t})},[i,t,l]),{state:s.value,context:s.context,send:l}}let re={mode:"editing",latestTrace:null,isCancelling:!1,error:null,agent:null},rt=(e,t)=>{switch(t.type){case"submit":return{...e,mode:"thinking",latestTrace:null,error:null};case"trace":return{...e,latestTrace:t.latestTrace};case"cancel":return{...e,isCancelling:!0};case"keep":return{...e,isCancelling:!1};case"abort":return{...e,mode:"editing",isCancelling:!1,latestTrace:null,error:null};case"complete":return{...e,mode:"editing",latestTrace:null,error:null};case"error":return{...e,mode:"error",latestTrace:null,error:t.error};case"success":return{...e,mode:"success",latestTrace:null,error:null};case"set-agent":return{...e,agent:t.agent}}},rn=({source:e,productKey:t,onAbort:n,onSubmit:a,onComplete:r,onCancel:o,autoClose:s,objectId:l,onBeforeComplete:c})=>{(0,i("fBMbo").di)(i("i25hX").usePublish,n6.useRovoContentBridgeAPI);let d=(0,i("i25hX").usePublish)("ai-mate"),[{mode:p,isCancelling:u,latestTrace:m,error:f,agent:h},_]=(0,g.useReducer)(rt,re),{mounted:y}=(0,i("5gEqE").useUIStore)(),{ready:I,send:E}=(0,n6.useRovoContentBridgeAPI)(n9.ROVO_INLINE_INPUT_BOX_CLIENT_ID,e=>{e(n9.InlineInputBoxTraceMessageCommand,e=>{_({type:"trace",latestTrace:e})}),e(n9.InlineInputBoxFinalResponseMessageCommand,()=>{let e=()=>{_({type:"complete"}),r()};c?c(e):e()}),e(n9.InlineInputBoxErrorMessageCommand,({error:e})=>{_({type:"error",error:e.message})})}),S=(0,g.useRef)();(0,g.useEffect)(()=>{I()},[I]);let b=(0,g.useCallback)((e=!1)=>{e&&"thinking"===p&&E(n9.InlineInputBoxAbortMessageCommand,{receiverId:n9.ROVO_CHAT_CLIENT_ID}),_({type:"abort"}),n({streamEnded:e})},[p,E,n]);(0,g.useEffect)(()=>{y&&"editing"!==p&&(0,i("dh538").fg)("platform_inline_rovo_auto_close")&&b()},[y,p,b]);let T=(0,g.useCallback)(e=>{o&&"editing"!==p?e?.skipWarning&&"thinking"===p&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?b(!0):(_({type:"cancel"}),o()):b(!0)},[p,b,_,o]),C=(0,g.useRef)(T);return(0,g.useEffect)(()=>{C.current=T},[T]),{mode:p,isCancelling:u,latestTrace:m,error:f,submit:n=>{if(h?.id){d({type:"chat-new",source:"ai-mate",data:{dialogues:[],prompt:n.prompt,agentId:h.id}}),b();return}let r={...n,prompt:n.prompt,productKey:t,source:e,receiverId:n9.ROVO_CHAT_CLIENT_ID,contentId:l,agentId:h?.id};S.current=r,E(n9.InlineInputBoxSendMessageCommand,r),y&&(0,i("dh538").fg)("platform_inline_rovo_auto_close")?b():(_({type:"submit"}),a?.(()=>{C.current((0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?{skipWarning:!0}:void 0)}))},resubmit:()=>{S.current&&(E(n9.InlineInputBoxSendMessageCommand,S.current),_({type:"submit"}))},cancel:T,keep:()=>{_({type:"keep"})},abort:b,autoClose:s??!0,agent:h,setAgent:e=>{_({type:"set-agent",agent:e})}}};i("42omo");var ri=(0,i("cgtv4").defineMessages)({removeAgentLabel:{id:"ai-mate.inline-chat-input.remove-agent",defaultMessage:"Remove agent"}});let ra={agentHeader:"_11c8140y _18zrpxbi _1rjcu2gc _1bsb1osq _kqswstnw _154iidpf _1ltvidpf _4t3ickbl _bfhkysee _13li1tm3 _qrwq1tm3",compact:"_18zrutpp"},rr=({agent:t,removeAgent:n,compact:a})=>{let{formatMessage:r}=(0,i("8C5kA").default)();return(0,n5.jsxs)(i("u9agA").default,{xcss:(0,i("1Whri").cx)(ra.agentHeader,a&&ra.compact),spread:"space-between",alignBlock:"center",children:[(0,n5.jsxs)(i("u9agA").default,{space:"space.100",alignBlock:"center",children:[(0,n5.jsx)(i("kPjga").PromptAgentAvatar,{agent:t}),(0,n5.jsx)("span",{children:t.name})]}),(0,n5.jsx)(i("1qfLF").default,{icon:e(i("hmuev")),label:r(ri.removeAgentLabel),appearance:"subtle",onClick:n})]})};i("42omo");var ro=(0,i("cgtv4").defineMessages)({closeButtonLabel:{id:"ai-mate.inline-chat-input.error-view.close-button.label",defaultMessage:"Close"},retryButtonLabel:{id:"ai-mate.inline-chat-input.error-view.retry-button.label",defaultMessage:"Try again"},rateLimited:{id:"ai-mate.inline-chat-input.error-view.message.rate-limited",defaultMessage:"You’ve reached the maximum number of requests. Try again later. <a>Excessive use of AI</a>."},aupViolation:{id:"ai-mate.inline-chat-input.error-view.message.aup-violation",defaultMessage:"Content does not comply with our <a>Acceptable Use Policy</a>."},tokenLimitExceeded:{id:"ai-mate.inline-chat-input.error-view.message.token-limit-exceeded",defaultMessage:"There’s too much content to process. Select less content and try again."},unknownError:{id:"ai-mate.inline-chat-input.error-view.message.unknown-error",defaultMessage:"An unknown error occurred."}});let rs=({error:t,onClose:n,onTryAgain:a})=>{let{formatMessage:r}=(0,i("8C5kA").default)();return(0,n5.jsxs)(i("u9agA").default,{spread:"space-between",alignBlock:"center",space:"space.100",children:[(0,n5.jsxs)(i("u9agA").default,{space:"space.100",alignBlock:"center",xcss:"_syazi7uo",children:[(0,n5.jsx)(e(i("a3fRD")),{color:"var(--ds-icon-danger, #C9372C)",spacing:"spacious",size:"medium",label:""}),(0,n5.jsx)("span",{children:(()=>{switch(t?.message_template){case"RATE_LIMIT":return r(ro.rateLimited,{a:e=>(0,n5.jsx)(i("auNCB").default,{href:"https://support.atlassian.com/organization-administration/docs/excessive-use-in-atlassian-intelligence/",target:"_blank",children:e})});case"ACCEPTABLE_USE_VIOLATIONS":return r(ro.aupViolation,{a:e=>(0,n5.jsx)(i("auNCB").default,{href:"https://www.atlassian.com/legal/acceptable-use-policy",target:"_blank",children:e})});case"TOKEN_LIMIT_EXCEEDED":return r(ro.tokenLimitExceeded)}return r(ro.unknownError)})()})]}),(0,n5.jsxs)(i("u9agA").default,{space:"space.100",children:[(0,n5.jsx)(i("ccHMk").default,{appearance:"subtle",onClick:n,children:r(ro.closeButtonLabel)}),rl(t)&&(0,n5.jsx)(i("ccHMk").default,{appearance:"default",onClick:a,children:r(ro.retryButtonLabel)})]})]})},rl=e=>e?.message_template!=="RATE_LIMIT"&&e?.message_template!=="ACCEPTABLE_USE_VIOLATIONS";var rc=i("e6Iiv"),rd=i("euw6P"),rp=i("fbZF8"),ru=i("f2la9");i("42omo");let rg=({darkMode:e=!1})=>e?(0,n5.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"8",viewBox:"0 0 10 8",fill:"none","data-testid":"confluence-labs-icon-dark",children:[(0,n5.jsx)("g",{clipPath:"url(#clip0_1466_13761)",children:(0,n5.jsx)("path",{d:"M8.66319 5.51003C6.1943 4.31624 5.47305 4.13786 4.43279 4.13786C3.21221 4.13786 2.17195 4.64556 1.24264 6.07262L1.09007 6.30589C0.96524 6.498 0.9375 6.5666 0.9375 6.64893C0.9375 6.73127 0.979111 6.79987 1.13168 6.89593L2.69901 7.87017C2.78223 7.92506 2.85159 7.9525 2.92094 7.9525C3.00416 7.9525 3.05964 7.91133 3.14286 7.78784L3.39252 7.40363C3.78089 6.8136 4.12764 6.62149 4.57149 6.62149C4.95985 6.62149 5.41757 6.73127 5.98625 7.0057L7.62293 7.77412C7.78937 7.85645 7.96968 7.81528 8.0529 7.62318L8.82963 5.92168C8.91286 5.72958 8.85737 5.60608 8.66319 5.51003ZM1.46457 2.50497C3.93346 3.69876 4.65471 3.87714 5.69497 3.87714C6.91555 3.87714 7.95581 3.36944 8.88512 1.94238L9.03769 1.70911C9.16252 1.517 9.19026 1.4484 9.19026 1.36607C9.19026 1.28373 9.14865 1.21513 8.99608 1.11907L7.42875 0.14483C7.34552 0.0899435 7.27617 0.0625 7.20682 0.0625C7.1236 0.0625 7.06812 0.103665 6.9849 0.227161L6.73524 0.61137C6.34687 1.2014 6.00012 1.39351 5.55627 1.39351C5.16791 1.39351 4.71019 1.28373 4.14151 1.0093L2.50483 0.240883C2.33839 0.158552 2.15808 0.199717 2.07486 0.391822L1.29812 2.09332C1.2149 2.28542 1.27038 2.40892 1.46457 2.50497Z",fill:"white"})}),(0,n5.jsx)("defs",{children:(0,n5.jsx)("clipPath",{id:"clip0_1466_13761",children:(0,n5.jsx)("rect",{width:"8.25276",height:"7.89",fill:"white",transform:"translate(0.9375 0.0625)"})})})]}):(0,n5.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"8",viewBox:"0 0 10 8",fill:"none","data-testid":"confluence-labs-icon",children:[(0,n5.jsx)("g",{clipPath:"url(#clip0_1352_45568)",children:(0,n5.jsx)("path",{d:"M8.66319 5.51003C6.1943 4.31624 5.47305 4.13786 4.43279 4.13786C3.21221 4.13786 2.17195 4.64556 1.24264 6.07262L1.09007 6.30589C0.96524 6.498 0.9375 6.5666 0.9375 6.64893C0.9375 6.73127 0.979111 6.79987 1.13168 6.89593L2.69901 7.87017C2.78223 7.92506 2.85159 7.9525 2.92094 7.9525C3.00416 7.9525 3.05964 7.91133 3.14286 7.78784L3.39252 7.40363C3.78089 6.8136 4.12764 6.62149 4.57149 6.62149C4.95985 6.62149 5.41757 6.73127 5.98625 7.0057L7.62293 7.77412C7.78937 7.85645 7.96968 7.81528 8.0529 7.62318L8.82963 5.92168C8.91286 5.72958 8.85737 5.60608 8.66319 5.51003ZM1.46457 2.50497C3.93346 3.69876 4.65471 3.87714 5.69497 3.87714C6.91555 3.87714 7.95581 3.36944 8.88512 1.94238L9.03769 1.70911C9.16252 1.517 9.19026 1.4484 9.19026 1.36607C9.19026 1.28373 9.14865 1.21513 8.99608 1.11907L7.42875 0.14483C7.34552 0.0899435 7.27617 0.0625 7.20682 0.0625C7.1236 0.0625 7.06812 0.103665 6.9849 0.227161L6.73524 0.61137C6.34687 1.2014 6.00012 1.39351 5.55627 1.39351C5.16791 1.39351 4.71019 1.28373 4.14151 1.0093L2.50483 0.240883C2.33839 0.158552 2.15808 0.199717 2.07486 0.391822L1.29812 2.09332C1.2149 2.28542 1.27038 2.40892 1.46457 2.50497Z",fill:"#1E1F21"})}),(0,n5.jsx)("defs",{children:(0,n5.jsx)("clipPath",{id:"clip0_1352_45568",children:(0,n5.jsx)("rect",{width:"8.25276",height:"7.89",fill:"white",transform:"translate(0.9375 0.0625)"})})})]}),rm=(0,i("cgtv4").defineMessages)({tooltip:{id:"ai-common.confluence-labs-lozenge.tooltip",defaultMessage:"Beta: This feature is still in development."}}),rf=(0,g.forwardRef)(function({children:e,...t},n){return(0,n5.jsx)(i("afneb").default,{...t,ref:n,className:(0,i("gMc0m").default)(["_2rko12b0 _11c81o8v _vchhusvi _p12f7l9q _bfhk1aqn _syaz15cr _152tze3t _1e02ze3t _1i4q1hna _85i5v77o _1q51v77o _y4ti12x7 _bozg12x7 _slp31hna"]),children:e})}),rh=()=>{let{formatMessage:e}=(0,i("8C5kA").default)(),{colorMode:t}=(0,i("cOrQJ").default)();return(0,n5.jsx)(i("3gadb").default,{component:rf,content:e(rm.tooltip),children:(0,n5.jsx)("div",{"data-testid":"labs-lozenge",className:(0,i("gMc0m").default)(["_2rko12b0 _18zr1b66 _1e0c1txw _4cvr1h6o _1bah1h6o","_2rko12b0 _18zr1b66 _kqswh2mm _bfhksm61 _1e0c1txw _4cvr1h6o _1bah1h6o _1pbyidpf _1tesidpf _rfx312b0 _1414t94y _p7f0t94y _7gpxt94y _syayt94y _1s6kyrfl _16qq1ajn _1kt9b3bt _1cs8stnw _1ankm4tz _12a1epuu _x5brkvto _13sb1p67 _dsq4glyw _1g0v1mrw"]),children:(0,n5.jsxs)(i("u9agA").default,{grow:"hug",space:"space.025",alignBlock:"center",children:[(0,n5.jsx)(rg,{darkMode:"dark"===t}),(0,n5.jsx)("div",{className:(0,i("gMc0m").default)(["_vwz4f6fq _1p1dangw"]),children:(0,n5.jsx)(i("iXCQx").default,{size:"small",weight:"semibold",color:"color.text",children:"Labs"})})]})})})};var r_=(0,i("cgtv4").defineMessages)({sendButtonLabel:{id:"ai-mate.inline-chat-input.send-button.label",defaultMessage:"Submit"},chatInputAssistiveLabel:{id:"ai-mate.inline-chat-input.chat-input-assistive-label",defaultMessage:"Describe what you want to do..."}});let ry="inline_prompt_view",rI={stack:"_1bsb1osq _otyrxmi2",stackWithoutContexts:"_1e0c1bgi",editorWrapper:"_p12f1osq _1e0c1txw _4cvr1h6o _ca0q1b66 _otyrr5cr _16jlhac1",actions:"_zulpu2gc _1bahh9n0 _16jlkb7n",labsLozenge:"_1wpz1h6o"},rE=({productKey:t,siteId:n,orgId:a,source:r,onSubmit:o,actions:s,onAgentSelect:l,isBrowseAgentsModalOpen:c,setIsBrowseAgentsModalOpen:d,enableAgents:p=!1,showLabsLozenge:u=!1,agent:m})=>{(0,i("fBMbo").di)(rc.ComposableEditor,i("aY6zh").default,i("2e6ow").useEditorPlaceholder,rd.useEditorPreset,i("V9Rzh").useChatModeStoreActions);let f=(0,g.useRef)(),[h,_]=(0,g.useState)(""),[y,I]=(0,g.useState)(!1),E=(0,g.useRef)(null),{value:S}=(0,i("5fzJo").useRovoMentionProvider)(),{placeholder:b,clearPlaceholder:T}=(0,i("2e6ow").useEditorPlaceholder)(),{highlightActionsEditorPlaceholder:C,clearHighlightActionsEditorPlaceholder:A}=(0,i("gjr93").useHighlightActionsEditorPlaceholder)(),{formatMessage:v}=(0,i("8C5kA").default)(),P={siteId:n,experienceId:"ai-mate",product:t,touchpointSource:r},{files:k,clearAttachments:x,anyFilesUploading:w}=(0,i("6Y7nw").useConversationFiles)({assistanceServiceParams:P,key:ry}),{handleTranscriptUpdate:M,rejectTranscriptedText:N,disposeTranscriptedText:O}=(0,i("gALmy").useTranscriptionToEditorText)(),{getChatMode:R,resetReasoningMode:D,setWebSearchEnabled:L}=(0,i("V9Rzh").useChatModeStoreActions)(),F=(0,g.useMemo)(()=>Promise.resolve(S||new(0,i("aY6zh").default)({productKey:t,siteId:n,includeTeams:!0,includeUsers:!0,orgId:a,searchQueryFilter:'account_status:"active" AND (NOT email_domain:"connect.atlassian.com") AND (NOT account_type:app)'})),[t,n,a,S]),G=h.length>rd.MAX_CHARACTERS_INPUT,B=0===h.trim().length,U=G||w||B&&!y,V=(0,g.useCallback)(async()=>{let e=await s.getValue();if(U)return;let{deepResearchEnabled:t,thinkDeeperEnabled:n,webSearchEnabled:i,appFilters:a}=R(ry);o({prompt:e,deepResearchEnabled:t,thinkDeeperEnabled:n,webSearchEnabled:i,appFilters:a,files:k.filter(e=>!e.error),addCurrentPageAsContextUserPreference:!0}),s.clear(),x(ry),D(ry),L(ry,!1)},[s,x,k,R,U,o,D,L]);(0,g.useEffect)(()=>()=>{x(ry)},[x]),f.current=V;let{editorApi:j,preset:H}=(0,rd.useEditorPreset)({onSave:()=>f.current?.(),arrowKeyPluginConfig:{userMessages:[]},productKey:t,siteId:n}),z=(0,g.useCallback)(e=>{switch(e.state){case i("6VMxF").VoiceDictationState.Recording:if(!j?.core?.actions?.execute)return;j.core.actions.execute(({tr:t})=>M(e.transcription,t));break;case i("6VMxF").VoiceDictationState.Stopped:e.stopReason===i("6VMxF").VoiceDictationStopReason.TimeoutAccepted&&O()}},[M,j,O]),[K,{startRecording:W,stopRecording:q}]=(0,i("bEPY6").useVoiceDictation)(z,n),Y=(0,g.useCallback)(()=>{W()},[W]),$=(0,g.useCallback)(()=>{O(),q(i("6VMxF").VoiceDictationStopReason.StoppedAccepted)},[q,O]),J=(0,g.useCallback)(()=>{q(i("6VMxF").VoiceDictationStopReason.StoppedRejected),j?.core.actions.execute(({tr:e})=>N(e))},[q,j?.core.actions,N]),Q=(0,g.useCallback)(()=>{j?.typeAhead?.actions.close({insertCurrentQueryAsRawText:!1})},[j?.typeAhead?.actions]),X=(0,g.useCallback)(()=>{Q(),requestAnimationFrame(()=>{j?.core.actions.focus(),j?.mention?.actions.openTypeAhead(i("d925B").INPUT_METHOD.QUICK_INSERT)})},[Q,j?.core.actions,j?.mention?.actions]),Z=(0,g.useCallback)(()=>{Q();let e=j?.hyperlink?.commands.showLinkToolbar(i("d925B").INPUT_METHOD.QUICK_INSERT);j?.core.actions.execute(e)},[Q,j?.core.actions,j?.hyperlink?.commands]),ee=(0,g.useCallback)(()=>{Q(),requestAnimationFrame(()=>{j?.core.actions.focus(),j?.quickInsert?.actions.openTypeAhead(i("d925B").INPUT_METHOD.QUICK_INSERT)})},[Q,j?.core.actions,j?.quickInsert?.actions]);(0,g.useEffect)(()=>{if(b&&j){switch(s.clear(),s.focus(),Q(),s.appendText(b.prompt),j?.core.actions.execute(({tr:e})=>e.setSelection(i("ks2lK").TextSelection.between(e.doc.resolve(b.selectionStartIndex),e.doc.resolve(b.selectionEndIndex)))),b.type){case"person":X();break;case"link":Z()}T()}},[j,s,T,Q,j?.core.actions,Z,X,b]),(0,g.useEffect)(()=>{C&&j&&(s.clear(),s.focus(),Q(),j.core.actions.replaceDocument(C),j?.core.actions.execute(({tr:e})=>{let t=e.doc.lastChild;if(t){let n=e.doc.resolve(e.doc.content.size-t.nodeSize),a=e.doc.resolve(e.doc.content.size);return e.setSelection(i("ks2lK").TextSelection.between(n,a))}return null}),"jira"===t&&requestAnimationFrame(()=>{setTimeout(()=>{s.focus()},1500)}),A())},[j,s,A,Q,C,t]);let et=p&&!!m&&(0,i("dh538").fg)("platform_inline_rovo_agents"),en=(0,ru.useSkillsManifest)({skills:ru.TEMP_SKILLS_LIST,isConversationAgentic:et,promptHasSkill:!1});return(0,n5.jsxs)(n5.Fragment,{children:[(0,n5.jsxs)(i("eyWa4").default,{xcss:(0,i("1Whri").cx)(rI.stack,0===k.length&&rI.stackWithoutContexts),children:[(0,n5.jsx)(i("gdv5Z").default,{xcss:rI.editorWrapper,children:(0,n5.jsx)(rc.ComposableEditor,{extensionProviders:en,assistiveLabel:v(r_.chatInputAssistiveLabel),minHeight:20,shouldFocus:!0,preset:H,mentionProvider:F,maxHeight:200,appearance:"chromeless",onSave:()=>f.current?.(),onChange:(e,t)=>{if(!t.isDirtyChange){let t=!1;e.state.doc.descendants(e=>"mention"!==e.type.name&&"inlineCard"!==e.type.name||(t=!0,!1)),I(t)}_(e.state.doc.textContent)}})}),(0,n5.jsx)(i("ZsUvD").InputContextListDisplay,{attachtmentsStoreKey:ry})]}),(0,n5.jsxs)(i("u9agA").default,{xcss:rI.actions,children:[u&&(0,n5.jsx)(i("u9agA").default,{xcss:rI.labsLozenge,children:(0,n5.jsx)(rh,{})}),(0,n5.jsx)(i("u9agA").default,{alignBlock:"center",space:"space.050",children:(0,n5.jsx)(i("4zqRX").VoiceRecordingPanel,{state:K.state,children:(0,n5.jsx)(rp.ChatInputActionButtons,{siteId:n,attachmentsAndCurrentPageAsContextStoreKey:ry,isDisabled:!1,useCurrentPageContext:!1,onLinkTypeAheadClick:Z,onMentionTypeAheadClick:X,onAddTypeAheadClick:ee,assistanceServiceParams:P,placement:"bottom-end",onMenuOpen:Q,onAgentSelect:p&&(0,i("dh538").fg)("platform_inline_rovo_agents")?l:void 0,isBrowseAgentsModalOpen:c,setIsBrowseAgentsModalOpen:d})})}),(0,n5.jsx)(i("hnap0").VoiceActionsPanel,{state:K.state,onStartRecording:Y,onRejectRecording:J,onAcceptRecording:$,children:(0,n5.jsx)(i("1qfLF").default,{isTooltipDisabled:!1,appearance:"primary",shape:"circle",ref:E,onClick:()=>f.current?.(),type:"submit",isDisabled:U,interactionName:"ai-mate.send-message-button",icon:t=>(0,n5.jsx)(e(i("euUgw")),{...t,label:""}),label:v(r_.sendButtonLabel)})})]})]})},rS=e=>(0,n5.jsx)(i("auTg8").default,{children:(0,n5.jsx)(i("5AtW0").default,{render:t=>(0,n5.jsx)(rE,{...e,actions:t})})});i("42omo");var rb=(0,i("cgtv4").defineMessages)({successMessage:{id:"ai-mate.inline-chat-input.success-view.message",defaultMessage:"No improvements, nice work."}});let rT=()=>{let{formatMessage:t}=(0,i("8C5kA").default)();return(0,n5.jsx)(i("gdv5Z").default,{xcss:"_1rjc1b66",children:(0,n5.jsxs)(i("u9agA").default,{space:"space.100",alignBlock:"center",xcss:"_syazi7uo",children:[(0,n5.jsx)(e(i("3sFtD")),{color:"var(--ds-icon-success, #6A9A23)",spacing:"spacious",size:"medium",label:""}),t(rb.successMessage)]})})};i("42omo");var rC=(0,i("cgtv4").defineMessages)({followAiMateButton:{id:"ai-mate.inline-chat-input.follow-button.label",defaultMessage:"Follow"},stopGeneratingButtonLabel:{id:"ai-mate.inline-chat-input.stop-generating-button.label",defaultMessage:"Stop generating"},thinkingText:{id:"ai-mate.inline-chat-input.thinking",defaultMessage:"Rovo is analyzing"},editingText:{id:"ai-mate.inline-chat-input.editing",defaultMessage:"Rovo is editing"}});let rA={escape:"_2rko12b0 _11c81o8v _18zr1b66 _1rjcv77o _bfhkysee _syaz1rpy",thinkingContainer:"_zulpu2gc _4t3i1tcg _1e0c1txw _4cvr1h6o"},rv=({latestTrace:t,onCancel:n,onFollow:a})=>{(0,i("fBMbo").di)(i("PRMv4").usePageContextType);let{formatMessage:r}=(0,i("8C5kA").default)(),o=(0,i("PRMv4").usePageContextType)()!==i("PRMv4").PageContextType.CONFLUENCE_WHITEBOARD;return(0,n5.jsxs)(n5.Fragment,{children:[(0,n5.jsx)(i("gdv5Z").default,{xcss:rA.thinkingContainer,children:(0,n5.jsx)(i("gmO0J").RovoThinkingIndicator,{title:r(rP(t))})}),(0,n5.jsxs)(i("u9agA").default,{alignBlock:"center",space:"space.100",children:[a&&(0,n5.jsx)(i("ccHMk").default,{appearance:"subtle",onClick:a,children:r(rC.followAiMateButton)}),o&&(0,n5.jsx)(i("gdv5Z").default,{xcss:rA.escape,children:"Esc"}),(0,n5.jsx)(i("1qfLF").default,{isTooltipDisabled:!1,shape:"circle",onClick:()=>n((0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?{skipWarning:!0}:void 0),icon:t=>(0,n5.jsx)(e(i("5lVpa")),{...t,color:"var(--ds-icon-danger, #C9372C)",label:""}),label:r(rC.stopGeneratingButtonLabel)})]})]})},rP=e=>e?.message_template==="ACTION_CLASSIFICATION"&&(e?.action_key==="aifc-adf-update"||e?.action_key==="aifc-confluence-whiteboard-update")?rC.editingText:rC.thinkingText;i("42omo");var rk=(0,i("cgtv4").defineMessages)({discardMessage:{id:"ai-mate.inline-chat-input.warning-view.discard.message",defaultMessage:"Cancel request and discard response?"},deleteMessage:{id:"ai-mate.inline-chat-input.warning-view.message",defaultMessage:"Delete response?"},deleteButtonLabel:{id:"ai-mate.inline-chat-input.warning-view.delete-button.label",defaultMessage:"Delete"},keepButtonLabel:{id:"ai-mate.inline-chat-input.warning-view.keep-button.label",defaultMessage:"Keep"},stopMessage:{id:"ai-mate.inline-chat-input.warning-view.stop-message",defaultMessage:"Stop request?"},yesButtonLabel:{id:"ai-mate.inline-chat-input.warning-view.yes-button.label",defaultMessage:"Yes"},noButtonLabel:{id:"ai-mate.inline-chat-input.warning-view.no-button.label",defaultMessage:"No"}});let rx=({onKeep:t,onDelete:n,willDeleteAfterAbort:a})=>{let{formatMessage:r}=(0,i("8C5kA").default)();return(0,n5.jsxs)(i("u9agA").default,{spread:"space-between",alignBlock:"center",space:"space.100",children:[(0,n5.jsxs)(i("u9agA").default,{space:"space.100",alignBlock:"center",xcss:"_syazi7uo",children:[(0,n5.jsx)(e(i("ebrpi")),{color:"var(--ds-icon-warning, #E06C00)",spacing:"spacious",size:"medium",label:""}),r(a?(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?rk.discardMessage:rk.deleteMessage:rk.stopMessage)]}),(0,n5.jsxs)(i("u9agA").default,{space:"space.100",children:[(0,n5.jsx)(i("ccHMk").default,{appearance:"subtle",onClick:t,children:r(a?rk.keepButtonLabel:rk.noButtonLabel)}),(0,n5.jsx)(i("ccHMk").default,{appearance:a?"warning":"default",onClick:n,children:r(a?rk.deleteButtonLabel:rk.yesButtonLabel)})]})]})},rw={wrapper:"_2rko1tm3 _18zrpxbi _1rjcutpp _1bsb1ns9 _bfhk1j9a _16qs130s _kqswh2mm _1e0c1txw _2lx21bp4",fadeIn:"_j7hq1w10 _5sagfnf5 _1pgl6ui8 _1o51q7pw _1bumglyw _sedtglyw",wrapperFlex:"_zulpu2gc _1bsb1osq _1e0c1txw _1n261g80 _1bah1yb4 _4cvr1h6o",agentHeaderSpacer:"_19pk1a70 _n3tdv77o",compact:"_18zrutpp _1rjcu2gc",fullWidth:"_1bsb1osq",thinking:"_19pkidpf _2hwx1wug _otyridpf _18u01wug _1bsb1ssb",thinkingIsCancelling:"_19pkidpf _2hwx1wug _otyridpf _18u01wug"},rM=e=>{(0,i("fBMbo").di)(rn);let{mode:t,isCancelling:n,latestTrace:a,error:r,submit:o,resubmit:s,cancel:l,keep:c,abort:d,autoClose:p,agent:u,setAgent:m}=rn(e),f=(0,g.useRef)(null),[h,_]=(0,g.useState)(!1);(0,g.useEffect)(()=>(0,i("fFa3V").bind)(document,{type:"mousedown",listener:e=>{f.current&&!f.current.contains(e.target)&&!h&&p&&l()}}),[t,l,p,h]);let y=e.willDeleteAfterAbort??!0;return(0,n5.jsxs)(i("gdv5Z").default,{role:"dialog",ref:f,onKeyDown:e=>{"Escape"===e.key&&l((0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?{skipWarning:!0}:void 0)},xcss:(0,i("1Whri").cx)(rw.wrapper,e.compact&&rw.compact,"editing"===t&&rw.fullWidth,"thinking"===t&&!n&&rw.thinking,"thinking"===t&&rw.thinkingIsCancelling,"thinking"===t&&rw.fadeIn),children:[u&&(0,n5.jsx)(rr,{agent:u,removeAgent:()=>m(null),compact:e.compact}),(0,n5.jsx)(i("gdv5Z").default,{xcss:(0,i("1Whri").cx)(rw.wrapperFlex,u&&rw.agentHeaderSpacer),children:(()=>{if(n)return(0,n5.jsx)(rx,{onKeep:c,onDelete:()=>d(!0),willDeleteAfterAbort:y});switch(t){case"thinking":return(0,n5.jsx)(rv,{latestTrace:a,onCancel:l,onFollow:e.onFollow});case"editing":return(0,n5.jsx)(rS,{...e,showLabsLozenge:e._showLabsLozenge,onSubmit:o,onAgentSelect:e=>m(e),isBrowseAgentsModalOpen:h,setIsBrowseAgentsModalOpen:_,agent:u});case"error":return(0,n5.jsx)(rs,{error:r,onClose:d,onTryAgain:s});case"success":return(0,n5.jsx)(rT,{});default:return null}})()})]})},rN=e=>{switch(e){case"CONFLUENCE":return"confluence";case"JSW":case"JSM":case"JWM":case"JPD":return"jira";case"ATLAS":case"TOWNSQUARE":return"atlas";case"BITBUCKET":return"bitbucket";default:return"unknown"}},rO={cloudId:"",orgId:void 0};function rR({cancel:t}){let n=i$(),{appearance:a,editorPluginAIProvider:r,setCancelRovoPrompt:o}=n,{setIsRovoLoading:s,api:l,targetId:c}=nD(),{cloudId:d,orgId:p}=(0,g.useMemo)(()=>n.editorPluginAIProvider?.getChannelVariables?.("rovo-agent")||rO,[n.editorPluginAIProvider]),u=rN(n.editorPluginAIProvider.product),m="confluence"===u&&("full-page"===a||"full-width"===a||"max"===a)?"CONFLUENCE_INLINE_EDITOR":"INLINE_EDITOR",f=(0,i("eiA8Z").useSharedPluginStateWithSelector)(l,["aiExperience"],({aiExperienceState:e})=>e?.aiDecorationExperiencePluginState.nextSessionId),h=(0,g.useMemo)(()=>!((0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")&&("confluence"!==u||(0,i("dh538").fg)("aifc_onboarding_ga_enabled")&&i("c6GJD").default.getExperimentValue("cc-aifc-databases-experiment","isEnabled",!1)))||!1,[u]);(0,g.useEffect)(()=>(o(void 0),()=>{s(!1)}),[o,s]);let _=(0,g.useCallback)(({streamEnded:e})=>{t({shouldClearSelectionContext:e}),s(!1)},[t,s]),y=(0,g.useCallback)(e=>{r.onSubmit?.(),s(!0);let t=()=>{e()};setTimeout(()=>{o(()=>t)},100)},[r,o,s]);return f?null:e(g).createElement(i("dpPtd").FlagsProvider,null,e(g).createElement(rM,{source:(0,i("dh538").fg)("platform_editor_aifc_in_page_comment")?m:"confluence"===u?"CONFLUENCE_INLINE_EDITOR":"INLINE_EDITOR",productKey:u,siteId:d,orgId:p,objectId:c,onAbort:_,onCancel:()=>{},onComplete:()=>{s(!1)},onSubmit:y,enableAgents:r.isRovoEnabled&&(0,i("dh538").fg)("platform_inline_rovo_agents"),_showLabsLozenge:h}))}let rD=(e,t)=>{let{context:{textInput:n,adfInput:i},send:a}=a7({baseGenerate:e.baseGenerate,startingUserInput:e.userInput,startingUserADFInput:e.userADFInput,startingConfig:e.configItem}),r=(0,g.useRef)(void 0),o=(0,g.useRef)(void 0),s=(0,g.useCallback)(e=>{a({type:"onTextEntered",input:e}),o.current=e},[a]),l=(0,g.useCallback)(e=>{a({type:"onADFEntered",adf:e}),r.current=e},[a]),c=(0,g.useCallback)(()=>{let n=r.current,i=o.current;i?.trim()&&t.sendToAIExperienceMachine({type:"kickoff with command palette input",context:{configItem:e.configItem,userInput:i,userADFInput:n}})},[e.configItem,t]),d=(0,g.useCallback)(e=>{t.endExperience({shouldClearSelectionContext:e?.shouldClearSelectionContext})},[t]),p=(0,g.useCallback)(()=>{t.sendToAIExperienceMachine({type:"update context",context:{configItem:e.configItem,userInput:n||"",userADFInput:i}}),t.sendToAIExperienceMachine({type:"enable discard"})},[i,t,e.configItem,n]);return{textInput:n,adfInput:i,onTextChange:s,onADFChange:l,submit:c,cancel:d,discard:p}},rL=e=>{let t=(0,i("8C5kA").default)();tQ({stepName:"prompt",attributes:{experienceName:e.configItem.key,featureId:e.configItem.featureId,promptTitle:e.configItem.promptLabel?t.formatMessage(e.configItem.promptLabel):void 0,promptType:"generate",usingCommandPalette:!0,retryPromptCount:e.retryPromptCount,editCount:e.editCount}})},rF=({context:t})=>{let n=i$(),{isInDocumentStreamingEnabled:i}=nD(),{textInput:a,adfInput:r,onTextChange:o,onADFChange:s,submit:l,cancel:c}=rD(t,n);return(rL(t),aG({modalRef:n.modalRef,onCancel:()=>{n.editorPluginAIProvider.onSubmit||c()},onDiscard:()=>{}}),n.editorPluginAIProvider.onSubmit)?e(g).createElement(rR,{cancel:c}):e(g).createElement(a9,{textInput:a,adfInput:r,onTextChange:o,onADFChange:s,submit:l,cancel:c,PromptEditor:n.editorPluginAIProvider.PromptEditor,appearance:n.appearance,isAIFC:i})};function rG(t){let{api:n}=t,a=t.state,r=t.context,o=i$(),{formatMessage:s}=(0,i("8C5kA").default)(),l=(0,i("i25hX").usePublish)("ai-mate"),{mountDecorations:c,updateStream:d,discardStream:p}=t2({api:n,configItem:t.context.configItem,isProgrammaticScroll:o.isProgrammaticScroll,positions:t.context.positions,view:t.context.editorView,modalRef:t.modalRef,aiSessionId:o.aiSessionId}),u=o.canInlineStreamChanges();e(g).useEffect(()=>{let e=o.sendToAIExperienceMachine;e&&"started state"===a&&e({type:"kick off"})},[a,o.sendToAIExperienceMachine]);let m=r?.configItem?.getBackendModel?.(!!r?.latestPromptResponse),f=tJ();e(g).useEffect(()=>{f.updateCommonAttributes({backendModel:m,channelId:r.channelId,...f.getUserFlowCommonAttributes(r.configItem),autoAcceptAIChanges:u,inlineStreamingAvailable:!0})},[f,m,r.channelId,r.configItem,u]);let h=r.aiLifeCycleDynamicAttributesGetter;if(e(g).useEffect(()=>{h&&f.registerAiLifeCycleDynamicAttributesGetter(h)},[f,h]),"started state"===a)return null;if(!("string"!=typeof a&&a["modal active state"]))throw Error("AI machine state is not: modal active state or modal error state");let _=a["modal active state"].experience;if(r.responseHistory.entries[r.responseHistory.entries.length-1]?.responseTooSimilar)return e(g).createElement(aL,{discardStream:p});if((0,i("dh538").fg)("platform_editor_ai_handle_invalid_input")){if("object"==typeof _&&"error state"in _&&"active"===_["error state"]||"string"!=typeof _&&"error state"in _)return r.apiErrorInfo.failureReason===eN.NO_TEXTUAL_CONTENT?e(g).createElement(aI,{errorInfo:r.apiErrorInfo,contextStatistics:r.contextStatistics}):e(g).createElement(ay,{errorInfo:r.apiErrorInfo})}else if("object"==typeof _&&"error state"in _&&"active"===_["error state"])return e(g).createElement(ay,{errorInfo:r.apiErrorInfo});if("object"==typeof a["modal active state"]&&"active"===a["modal active state"].discard)return e(g).createElement(ao,{state:_,channelId:r.channelId,editCount:r.editCount,retryPromptCount:r.retryPromptCount,history:r.responseHistory,latestPrompt:r.latestPrompt,onceDiscard:r.onceDiscard,streamFlowPacer:t.streamFlowPacer,discardStream:p,api:n});if("string"==typeof _&&"command palette state"===_)return e(g).createElement(rF,{context:r});if("object"==typeof _&&"loading state"in _&&"loading"===_["loading state"]){let t=r.parentPresetPromptLabel&&r.configItem.nestingConfig?s(r.configItem.nestingConfig.shortTitle):"",i=i0({status:r?.loadingStatus,formatMessage:s});return e(g).createElement(e(g).Fragment,null,e(g).createElement(aO,{mountDecorations:c,updateStream:d,parentPresetPromptLabel:r.parentPresetPromptLabel,childShortTitle:t,title:i||s(n1.loadingTitle),markdown:r.markdown,adfResponse:r.adfResponse,adfResponseNodeWrappers:r.adfResponseNodeWrappers,latestPrompt:r.latestPrompt,promptTrigger:r.promptTrigger,refinementCount:r.refinementCount,latestPromptRetried:r.latestPromptRetried,idMap:r.idMap,contextStatistics:r.contextStatistics,hideLoadingScreen:o.hideLoadingScreen,api:n}),e(g).createElement(i9,{loadingStatus:r.loadingStatus}))}if("string"!=typeof _&&"review state"in _)if(d){let t;(t=r.adfResponse&&(0,i("4F0gv").isAdfStreamingEnabled)()?iX({schema:r.editorView.state.schema,adfResponse:r.adfResponse,adfResponseNodeWrappers:r.adfResponseNodeWrappers}):ep({markdown:r.markdown||"",schema:r.editorView.state.schema,source:"preview",fireAIAnalyticsEvent:()=>{},idMap:r.idMap}).pmFragment)&&d?.({fragment:t,hasUserScrolled:o.isUserScroll.current,isFinalStream:!0});let n=i("3yUTv").aiExperienceDecorationPluginKey.getState(r.editorView.state),a=new(0,i("8nxxM").ProseMirrorContentStatistics)(t).collectStatistics();return u||!n?.withAcceptReject||r.configItem.key===i("bwpRs").CONFIG_ITEM_KEYS.SUGGEST_A_TITLE&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?((0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")&&f.addAttributes({modelIO:{contextStatistics:r.contextStatistics,previewMarkCounts:a.markCounts,previewNodeCounts:a.nodeCounts,previewTotalCharacterCounts:a.totalCharacterCount}}),r.endExperience(),null):n?.nextSessionId?null:e(g).createElement(aa,{aiExperienceMachineContext:r,backendModel:m,discardStream:p})}else{let t=r.rovoActions?r.rovoActions[r.selectionType]:void 0;return e(g).createElement(a2,{aiExperienceMachineContext:r,isInputActive:"refinement"===_["review state"],backendModel:m,rovoAction:t,rovoPublish:l})}if(!(0,i("dh538").fg)("platform_editor_ai_handle_invalid_input")&&"string"!=typeof _&&"error state"in _)return e(g).createElement(ay,{errorInfo:r.apiErrorInfo});throw Error("unhandled state")}function rB(e){return e.isRovoEnabled&&e.useFreeGenerateEditorAgent}function rU(e,{focusEditorContentArea:t}={focusEditorContentArea:!1}){e.hasFocus()||e.focus();let n=e?.dom.closest(".ak-editor-content-area");n&&!n.contains(document.activeElement)&&t&&n.focus()}function rV(t){let{api:n,editorView:a,endExperience:r}=t,o=(0,i("8C5kA").default)(),s=e(g).useRef(null),[l,c]=(0,g.useState)(),d=t.positions,p=d[0]===d[1],u=p?"empty":"range",m=t.configItem,f=t.editorPluginAIProvider.baseGenerate;t.defaultAgent&&rB(t.editorPluginAIProvider)&&(f=iJ({agent:t.defaultAgent,product:t.editorPluginAIProvider.product,isInDocumentStreamingEnabled:t.editorPluginAIProvider.isInDocumentStreamingEnabled}),t.configItem.key===i("bwpRs").CONFIG_ITEM_KEYS.FREE_GENERATE&&(m=f));let{isUserScroll:h,isProgrammaticScroll:_}=function({modalRef:e}){let t=(0,g.useRef)(!1),n=(0,g.useRef)(!0);return(0,g.useEffect)(()=>{let a=e.current;if(!a)return;let r=(0,i("7YjFd").findOverflowScrollParent)(a);if(!r)return;t.current=!1;let o=(0,i("fFa3V").bind)(r,{type:"scroll",listener:()=>{n.current||(t.current=!0,o()),n.current=!1}});return()=>{o()}},[e]),{isUserScroll:t,isProgrammaticScroll:n}}({modalRef:s}),y=i1(!0),I=tJ(),E=eX({fireAIAnalyticsEvent:(0,i("4SGh1").useFireAIAnalyticsEvent)(),aiInteractionID:I.getLastAiInteractionId(),streamFlowPacer:y.current}),{send:S,state:b,context:T}=t;(0,g.useLayoutEffect)(()=>(S({type:"initialise context",context:{analyticsContext:t.analyticsContext,aiProvider:t.editorPluginAIProvider,intl:o,editorView:t.editorView,positions:d,isEmpty:p,selectionType:u,baseGenerate:f,configItem:m,aiLifeCycleDynamicAttributesGetter:t.editorPluginAIProvider?.aiLifeCycleDynamicAttributesGetter,markdown:"",latestPromptResponse:void 0,editCount:0,refinementCount:0,retryPromptCount:0,latestPromptRetried:!1,userInput:"",apiErrorInfo:{},responseHistory:{positionFromEnd:0,entries:[],totalSize:0,traversals:0},channelId:void 0,getMentionNameDetails:t.getMentionNameDetails,triggeredFor:t.triggeredFor,usePageKnowledge:!0,endExperience:t.endExperience,streamingHandler:E}}),()=>{S({type:"reset"})}),[]),e(g).useEffect(()=>{if(t.defaultAgent&&rB(t.editorPluginAIProvider)){let e=iJ({agent:t.defaultAgent,product:t.editorPluginAIProvider.product,isInDocumentStreamingEnabled:t.editorPluginAIProvider.isInDocumentStreamingEnabled});S({type:"update baseGenerate and configItem",baseGenerate:e,configItem:e})}},[t.defaultAgent,t.editorPluginAIProvider,S]);let[C,A]=t.positions;e(g).useEffect(()=>{S({type:"update positions",positions:[C,A]})},[S,C,A]),function({modalRef:e,editorView:t,state:n,cancelRovoPrompt:i}){let a=JSON.stringify(n);(0,g.useEffect)(()=>{e.current&&(e.current.contains(document.activeElement)||-1===a.indexOf("modal active state")||rU(t,{focusEditorContentArea:!0}))},[e,t,a]),(0,g.useEffect)(()=>{i&&rU(t,{focusEditorContentArea:!0})},[i,t])}({modalRef:s,editorView:a,state:b,cancelRovoPrompt:l});let{lastTriggeredFrom:v}=t,P=e(g).useRef(!1),k=e(g).useRef(!1);e(g).useEffect(()=>{if(!s.current)return;let e=a.dom.closest(".ak-editor-content-area");if(e)return(0,i("fFa3V").bindAll)(e,[{type:"keydown",listener:function(e){let t=["-","*","•"];if((0,i("dh538").fg)("platform_editor_ai_aifc_space_shortcut")){if(!k.current||t.includes(e.key)||["Shift","Alt"].includes(e.key)||(P.current=!0),k.current||" "!==e.key||(k.current=!0),!("Escape"===e.key||t.includes(e.key)&&"spaceShortcut"===v&&!P.current))return}else if("Escape"!==e.key)return;if("string"==typeof b||!("modal active state"in b)||n?.aiExperience.sharedState.currentState()?.aiDecorationExperiencePluginState.nextSessionId)return;e.preventDefault(),e.stopPropagation();let o=b?.["modal active state"],s=o?.experience;if("command palette state"===s){l?l():r(),t.includes(e.key)&&(0,i("dh538").fg)("platform_editor_ai_aifc_space_shortcut")&&a.dispatch(a.state.tr.insertText(` ${e.key}`));return}let c="loading state"in s&&"loading"===s["loading state"],d="review state"in s&&"preview"===s["review state"];(c||d)&&(o?.discard==="active"?S({type:"disable discard"}):S({type:"enable discard"}))}},{type:"keyup",listener:function(e){"Escape"===e.key&&"string"!=typeof b&&"modal active state"in b&&(n?.aiExperience.sharedState.currentState()?.aiDecorationExperiencePluginState.nextSessionId||(e.preventDefault(),e.stopPropagation()))}},{type:"click",listener:function(e){if("string"==typeof b||!("modal active state"in b)||n?.aiExperience.sharedState.currentState()?.aiDecorationExperiencePluginState.nextSessionId)return;let t=b?.["modal active state"],i=t?.experience;"object"==typeof i&&"review state"in i&&"preview"===i["review state"]&&s.current&&e.target&&!s.current.contains(e.target)&&t?.discard==="inactive"&&S({type:"enable discard"})}}])},[s,b,S,T.promptTrigger,T.responseHistory,r,a,l,n,v]);let[x,w]=e(g).useState(!1);e(g).useEffect(()=>{(0,i("dh538").fg)("platform_editor_ai_scroll_into_view_fix")&&s.current&&(0,g.startTransition)(()=>{w(!0)})},[s]),e(g).useEffect(()=>{(0,i("dh538").fg)("platform_editor_ai_scroll_into_view_fix")&&s.current&&x&&s.current?.scrollIntoView({block:"nearest",behavior:"auto"})},[x,s]);let M=e(g).useMemo(()=>({appearance:t.appearance,configItem:T.configItem,editorPluginAIProvider:t.editorPluginAIProvider,endExperience:t.endExperience,lastTriggeredFrom:t.lastTriggeredFrom,providerFactory:t.providerFactory,editorView:t.editorView,positions:t.positions,triggerMethod:t.triggerMethod,triggeredFor:t.triggeredFor,sendToAIExperienceMachine:S,modalRef:s,isUserScroll:h,isProgrammaticScroll:_,engagementPlatformApi:t.engagementPlatformApi,includeKnowledgeFromCurrentPage:T.usePageKnowledge,canInlineStreamChanges:t.canInlineStreamChanges,hideLoadingScreen:t.hideLoadingScreen,setCancelRovoPrompt:c,aiSessionId:t.interactionSessionId}),[T.configItem,T.usePageKnowledge,t.editorView,t.editorPluginAIProvider,t.appearance,t.endExperience,t.lastTriggeredFrom,t.providerFactory,t.positions,t.triggerMethod,t.triggeredFor,t.engagementPlatformApi,t.canInlineStreamChanges,S,s,h,_,t.hideLoadingScreen,t.interactionSessionId]);return e(g).useEffect(()=>{I.updateCommonAttributes({traceIds:T.traceIds})},[I,T.traceIds]),e(g).createElement("div",{role:"dialog","aria-label":o.formatMessage(n1.dialogAriaLabel),ref:s},e(g).createElement(iY.Provider,{value:M},e(g).createElement(rG,{api:n,state:b,context:T,initialPrompt:t.initialPrompt,modalRef:s,streamFlowPacer:y.current})))}function rj(t){let{api:n,editorView:a,canInlineStreamChanges:r}=t,o=(0,g.useMemo)(()=>(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")?iq(a):void 0,[a]),s=tq({invokeAttributes:{invokedFrom:t.lastTriggeredFrom,invokedFor:t.triggeredFor?t.triggeredFor.name:"text",triggerMethod:t.triggerMethod,experienceName:t.configItem.key,featureId:t.configItem.featureId,aiGroupId:t.aiGroupId,aiSessionId:t.interactionSessionId},canInlineStreamChanges:t.canInlineStreamChanges,isInDocumentStreamingEnabled:!0,onCommonAttributesUpdated:o?.syncCommonAttributes}),l=(0,g.useRef)(!1);return e(g).useEffect(()=>{if(l.current)return;l.current=!0;let e=(0,i("2pjJ5").isEmptyDocument)(t.editorView.state.doc);if(s.updateCommonAttributes({isInvokedFromEmptyPage:e,nudgeMetrics:t.nudgeMetrics}),t.initialPositions){let n=eF(t.editorView,t.initialPositions),{charCount:a,wordCount:r}=(0,i("4SGh1").rangeCharWordCount)(t.editorView.state.doc,t.initialPositions[0],t.initialPositions[1]);s.updateCommonAttributes({selectionCharCount:a,selectionWordCount:r}),s.updateCommonAttributes({isInvokedFromEmptyPage:e,selectionCategory:n})}},[s,t.editorView,t.initialPositions,t.nudgeMetrics]),e(g).useEffect(()=>()=>{window.requestAnimationFrame(()=>{s.fireQueuedStep()})},[s]),e(g).useEffect(()=>()=>{let e=t.editorView.state.tr;e.setMeta("hideSelectionPreview",!0),t.editorView.dispatch(e)},[t.editorView]),(0,g.useEffect)(()=>()=>{if(rU(a),a.state.selection instanceof i("ks2lK").TextSelection&&a.state.selection.empty&&a.state.selection.$to.parent.isTextblock&&a.state.selection.$to.parent.childCount>0){let e=a.state.selection.to,t=a.state.tr;t.setSelection(i("ks2lK").TextSelection.create(t.doc,0)),t.setMeta("addToHistory",!1).setMeta("scrollIntoView",!1),a.dispatch(t),(t=a.state.tr).setSelection(i("ks2lK").TextSelection.create(t.doc,e)),t.setMeta("addToHistory",!1).setMeta("scrollIntoView",!1),a.dispatch(t)}},[a]),(0,g.useEffect)(()=>()=>{!r()&&n?.trackChanges?.sharedState.currentState()?.isDisplayingChanges&&n?.core.actions.execute(n?.trackChanges?.commands.toggleChanges)},[n,r]),e(g).createElement(i4,{onCloseFallback:()=>{t.endExperience()}},e(g).createElement(t$,{value:s},e(g).createElement(i("hnvzE").default,{name:"EditorAICommandPalette"},e(g).createElement(rV,{...t,analyticsContext:{aiSessionId:s.aiSessionId,aiGroupId:t.aiGroupId??s.aiSessionId}}))))}function rH({modalElement:e,editorViewElement:t,isInDocumentStreamingEnabled:n}){let a=(0,g.useRef)(null);(0,g.useEffect)(()=>{if(!e)return;let n=new ResizeObserver(n=>{if(!a.current||!e)return;let i=n.find(t=>t.target===e);if(!i)return;let r=Math.max(i.target.offsetTop+i.contentRect.height-(t.offsetTop+t.offsetHeight),0);a.current.style.height=`${r}px`});return n.observe(e),()=>{n.disconnect()}},[e,t]),(0,g.useEffect)(()=>{if(a.current)return;let e=(0,i("hTKp4").getDocument)();if(!e)return;let r=e.createElement("div");if(r.className="ai-height-div",r.style.height="0px",n){let e=t.parentNode.querySelector("#ak-editor-textarea");e?e.after(r):t.parentNode.appendChild(r)}else t.parentNode.appendChild(r);return a.current=r,()=>{t.parentNode?.removeChild(r)}},[t,n])}function rz(e){let t=e.offsetParent;if(t)return t;let n=e.parentElement;for(;n;){if("static"!==getComputedStyle(n).position)return n;n=n.parentElement}return document.body}function rK({from:e,modalElement:t,direction:n}){let i="top"===n?"offsetTop":"offsetLeft",a=e[i],r=e.offsetParent,o=rz(t);for(;r&&r instanceof HTMLElement&&r!==o;)a+=r[i],r=r.offsetParent;return a}function rW({relativePositionElement:e,modalElement:t}){return rK({from:e,modalElement:t,direction:"left"})}function rq({appearance:e,modalElement:t,editorRelativeWrapper:n,modalDecorationElement:i,lastTriggeredFrom:a,editorView:r}){if("confluenceTitleToolbar"===a)return n?.querySelector(".ProseMirror")?.offsetTop||0;let o=function({modalDecorationElement:e,modalElement:t}){return rK({from:e,modalElement:t,direction:"top"})+e.offsetHeight}({modalDecorationElement:i,modalElement:t});if("chromeless"===e){let e=r?.dom.closest(".ak-editor-content-area");if(e){let n=rz(t),i=e.getBoundingClientRect(),a=n.getBoundingClientRect(),r=i.bottom-a.top;if(o>r)return r}}return o}function rY(e,t){let n=e.state.doc.resolve(Math.min(t,e.state.doc.content.size)),{nodes:a,marks:r}=e.state.schema,o=e.domAtPos.bind(e),s=(0,D.findParentNodeClosestToPos)(n,e=>e.type===a.table);if(s){let e=(0,D.findDomRefAtPos)(s.start,o);if(e instanceof HTMLElement){let t=e.closest(`.${i("1zav4").TableSharedCssClassName.TABLE_RESIZER_CONTAINER}`);if(t instanceof HTMLElement)return t}}let l=(0,D.findParentNodeClosestToPos)(n,e=>e.type===a.table&&"default"!==e.attrs.layout||e.marks.some(e=>e.type===r.breakout));if(!l)return;let c=(0,D.findDomRefAtPos)(l.start,o);if(c instanceof HTMLElement&&c){if([a.layoutSection,a.expand].includes(l.node.type))return c.parentElement||void 0;if(l.node.type===a.table){let e=c.closest(`.${i("1zav4").TableSharedCssClassName.TABLE_CONTAINER}`);return e instanceof HTMLElement?e:void 0}}}let r$=Math.min(500,Math.max(402,i("aFUXX").akEditorFloatingPanelZIndex+2));var rJ=((u=rJ||{})[u.TOP=1]="TOP",u[u.NONE=0]="NONE",u[u.BOTTOM=-1]="BOTTOM",u);let rQ=e=>e?.dom.querySelector(".ai-modal-mount-point-widget")||e?.dom.querySelector(".ai-selection-node"),rX=({isDirectionalPinningEnabled:t,children:n,decoration:a,editorView:r,editorRelativeWrapper:o,appearance:s,endExperience:l,lastTriggeredFrom:c,decorationSet:d})=>{let p=r.dom,u=(0,g.useRef)(null),[m,f]=(0,g.useState)(0),[h,_]=(0,g.useState)(0),[y,I]=(0,g.useState)(0),[E,S]=(0,g.useState)(""),b=(0,g.useRef)(null),[T,C]=(0,g.useState)(0),[A,v]=(0,g.useState)(0),P=(0,g.useMemo)(()=>rY(r,a.to),[r,a]),k=rQ(r),x=["full-page","full-width"].includes(s);if((0,g.useEffect)(()=>{if("comment"===s){let e=null;if(o?e=o.querySelector(".ak-editor-content-area"):k&&(e=k.closest(".ak-editor-content-area")),e){let t=getComputedStyle(e),n="none"!==t.maxHeight,i=t.position;return n&&(e.style.position="relative"),()=>{n&&e&&(e.style.position=i)}}}},[k,s,o]),(0,g.useEffect)(()=>{let t=()=>{if(!u.current||!k||!k.offsetParent)return;let e=rq({appearance:s,modalElement:u.current,editorRelativeWrapper:o,modalDecorationElement:k,lastTriggeredFrom:c,editorView:r});f(rW({relativePositionElement:p,modalElement:u.current})),_(e),I(p.offsetWidth),E||S("left 0.1s ease-in, left 0.1s ease-in")};t();let n=e(eo)(()=>{t()},20),i=new ResizeObserver(n);i.observe(p);let a=p.offsetParent;return a&&i.observe(a),()=>{i.disconnect(),n.cancel()}},[p,k,o,P]),(0,g.useEffect)(()=>{if(!u.current)return;if(!b.current){let e=(0,i("7YjFd").findOverflowScrollParent)(u.current)||null;if(!e)return;b.current=e}let e=new ResizeObserver(()=>{u.current&&v(u.current.offsetHeight)});return e.observe(u.current),()=>{e.disconnect()}},[]),(0,g.useEffect)(()=>{if(A&&b.current&&k&&x&&t){let e=b.current,t=new IntersectionObserver(t=>{for(let n of t)if(n.isIntersecting)C(0);else{let t=rQ(r);if(n.target!==t)return;if(n.rootBounds&&0!==n.rootBounds.height)C(n.boundingClientRect.bottom<n.rootBounds.top?1:-1);else{let t=k.getBoundingClientRect(),n=e.getBoundingClientRect();C(t.bottom<n.top?1:-1)}}},{root:b.current,rootMargin:`0px 0px -${A+16+16+k.getBoundingClientRect().height}px 0px`,threshold:0});return t.observe(k),()=>{t.disconnect()}}},[A,r,k,x,t]),rH({modalElement:u.current,editorViewElement:p,isInDocumentStreamingEnabled:!0}),d===i("ftzrq").DecorationSet.empty)return l(),null;let w={...(!x||t&&0===T)&&{top:h,transition:E},left:m,"--content-width":`${y}px`,display:y?"block":"none"};return g.createElement("div",{className:(0,i("gMc0m").default)(["_19pkpxbi _kqswstnw _1pby1kbs _2hwxmgjw _18u0mgjw _1bsbxj84 _j7hq1w10 _5sagfnf5 _1pgl6ui8 _1o51q7pw _ta6yglyw",x&&t&&1===T&&"_kqsw1n9t _154iidpf",x&&(t&&-1===T||!t)&&"_kqsw1n9t _94n57vkz _154in7od","ak-editor-plugin-ai-modal"]),"data-testid":"ai-plugin-modal",ref:u,"data-editor-popup":!0,style:{...w,"--_1dsp0pi":(0,i("7sObp").default)(r$)}},n)},rZ=({modalDecorationSet:e,doc:t})=>{let n=eL({modalDecorationSet:e});return n?t.slice(n[0],n[1],!0).content:void 0},r0=({editorView:t,getMentionNameDetails:n,editorPluginAIProvider:a,editorApi:r})=>{let o=(0,i("i25hX").usePublish)("ai-mate"),{product:s}=a,l=e(g).useCallback(async({doc:e,selection:a})=>{let r=window.requestIdleCallback||window.requestAnimationFrame;if(!e||!a)return void r(()=>{o({type:"editor-context-payload",source:"editor",product:s,data:void 0})});let{modalDecorationSet:l}=(0,i("kqrrC").getPluginState)(t.state),c=a.content().content,d=rZ({modalDecorationSet:l,doc:e});d&&(c=d);let p={};n&&(p=await (0,i("iSJi5").getMentionMap)({node:e,getMentionNameDetails:n}));let{markdown:u}=(0,i("6eZqW").convertProsemirrorNodeToMarkdown)({node:i("5SAOw").Fragment.from(c),featureToggles:{markdownPlus:!1},mentionMap:p});r(()=>{o({type:"editor-context-payload",source:"editor",product:s,data:{document:{type:"text/adf",content:e.toJSON()},selection:{type:"text/markdown",content:u}}})})},[t,n,s,o]);return(0,i("6qdjm").usePluginStateEffect)(r,["focus"],({focusState:e})=>{e?.hasFocus||l({doc:t.state.doc,selection:t.state.selection})}),(0,i("6qdjm").usePluginStateEffect)(r,["aiExperience"],({aiExperienceState:e})=>{(e?.nonCursorSelectionChangeCount??0)>=1&&l({doc:t.state.doc,selection:t.state.selection})}),(0,g.useEffect)(()=>()=>{o({type:"editor-context-payload",source:"editor",product:s,data:void 0})},[o,s]),(0,i("eIhC8").updatePublish)(o)(t.state,t.dispatch),e(g).createElement(e(g).Fragment,null)},r1=({editorPluginAIProvider:e})=>{let{isRovoEnabled:t}=(0,i("aMqwg").useRovoEntitlement)();return!!e.isRovoEnabled&&t&&"function"==typeof e?.getChannelVariables},r5=({editorPluginAIProvider:e})=>r1({editorPluginAIProvider:e})&&!!e.showRovoAgentsInCommandPalette,r2=t=>{let{editorView:n,children:a}=t,r=r1({editorPluginAIProvider:t.editorPluginAIProvider});return e(g).useEffect(()=>{(0,i("eIhC8").updateEnabled)(r)(n.state,n.dispatch)},[n.dispatch,n.state,r]),r?e(g).createElement(e(g).Fragment,null,a):null},r8=null,r4=e=>{r8=e},r3=e=>e===r8,r9=e=>{(0,g.useEffect)(()=>{let t=()=>r4(e),n=e.dom;return n.addEventListener("focus",t),()=>{n.removeEventListener("focus",t)}},[e])},r6={topic:"ai-mate"},r7=({editorView:t,product:n,onDocChangeByAgent:a,onAIProviderChanged:r,editorPluginAIProvider:o,positions:s,editorApi:l})=>{let c=(0,g.useMemo)(()=>o?.getChannelVariables?.("rovo-agent")?.cloudId||"",[o]),d=(0,i("6Vqkv").useAgentsList)({assistanceServiceParams:{product:(0,i("8klLr").mapToAssistanceServiceProduct)(n),experienceId:"ai-mate",touchpointSource:"editor-agent-subscribe-to-rovo",siteId:c}});r9(t);let p=(0,g.useCallback)(e=>{if("agent-changed"===e.type&&r&&r("rovo-chat",e.data.agent?{type:"rovo",agent:e.data.agent}:void 0),"editor-suggestion"===e.type&&r3(t)){let{state:n}=t;switch(e.data.mode){case"insert":{let{pmFragment:a}=(0,i("hAuc5").convertMarkdownToProsemirror)({markdown:e.data.content,schema:n.schema,idMap:{}}),r=(0,i("ieno2").insertAIContentAtCurrentPosition)({editorView:t,positions:s??[n.selection.from,n.selection.to],pmFragment:a});l?.card?.actions.queueCardsFromChangedTr&&(0,i("dh538").fg)("rovo_chat_editor_suggestion_smartlinks")&&(r=l.card.actions.queueCardsFromChangedTr(n,r,i("d925B").INPUT_METHOD.MANUAL)),(0,i("ieno2").beforeDispatchAIRovoAgentTransaction)(r),t.dispatch(r),t.focus();break}case"replace":{let{pmFragment:a}=(0,i("hAuc5").convertMarkdownToProsemirror)({markdown:e.data.content,schema:n.schema,idMap:{}}),r=(0,i("ieno2").replaceWithAIContent)({editorView:t,positions:s??[n.selection.from,n.selection.to],pmFragment:a,options:{replaceDocOnEmptySelection:!1}});l?.card?.actions.queueCardsFromChangedTr&&(0,i("dh538").fg)("rovo_chat_editor_suggestion_smartlinks")&&(r=l.card.actions.queueCardsFromChangedTr(n,r,i("d925B").INPUT_METHOD.MANUAL)),(0,i("ieno2").beforeDispatchAIRovoAgentTransaction)(r),t.dispatch(r),t.focus()}}let r=d.find(t=>t.id===e.data.agentId);r&&a&&a((0,i("8zG4S").getEditorAgent)(r))}},[r,t,d,a,s,l]);return(0,i("i25hX").useSubscribe)(r6,p),e(g).createElement(e(g).Fragment,null)},oe=({editorView:t,onDocChangeByAgent:n,onAIProviderChanged:a,editorPluginAIProvider:r,positions:o,editorApi:s})=>{let l=iV({cloudId:(0,g.useMemo)(()=>r?.getChannelVariables?.("rovo-agent")?.cloudId||"",[r]),editorState:t.state});r9(t);let c=(0,g.useCallback)(e=>{if("agent-changed"===e.type&&a&&a("rovo-chat",e.data.agent?{type:"rovo",agent:e.data.agent}:void 0),"editor-suggestion"===e.type&&r3(t)){let{state:a}=t;switch(e.data.mode){case"insert":{let{pmFragment:n}=(0,i("hAuc5").convertMarkdownToProsemirror)({markdown:e.data.content,schema:a.schema,idMap:{}}),r=(0,i("ieno2").insertAIContentAtCurrentPosition)({editorView:t,positions:o??[a.selection.from,a.selection.to],pmFragment:n});s?.card?.actions.queueCardsFromChangedTr&&(0,i("dh538").fg)("rovo_chat_editor_suggestion_smartlinks")&&(r=s.card.actions.queueCardsFromChangedTr(a,r,i("d925B").INPUT_METHOD.MANUAL)),(0,i("ieno2").beforeDispatchAIRovoAgentTransaction)(r),t.dispatch(r),t.focus();break}case"replace":{let{pmFragment:n}=(0,i("hAuc5").convertMarkdownToProsemirror)({markdown:e.data.content,schema:a.schema,idMap:{}}),r=(0,i("ieno2").replaceWithAIContent)({editorView:t,positions:o??[a.selection.from,a.selection.to],pmFragment:n,options:{replaceDocOnEmptySelection:!1}});s?.card?.actions.queueCardsFromChangedTr&&(0,i("dh538").fg)("rovo_chat_editor_suggestion_smartlinks")&&(r=s.card.actions.queueCardsFromChangedTr(a,r,i("d925B").INPUT_METHOD.MANUAL)),(0,i("ieno2").beforeDispatchAIRovoAgentTransaction)(r),t.dispatch(r),t.focus()}}let r=l.data.find(t=>t.id===e.data.agentId);r&&n&&n(r)}},[a,t,l,n,o,s]);return(0,i("i25hX").useSubscribe)(r6,c),e(g).createElement(e(g).Fragment,null)},ot=({editorView:t,product:n,onDocChangeByAgent:a,onAIProviderChanged:r,editorPluginAIProvider:o,positions:s,editorApi:l})=>(0,i("dh538").fg)("platform_editor_ai_remove_agents_list")?e(g).createElement(oe,{editorPluginAIProvider:o,editorView:t,onDocChangeByAgent:a,product:n,onAIProviderChanged:r,positions:s,editorApi:l}):e(g).createElement(r7,{editorPluginAIProvider:o,editorView:t,onDocChangeByAgent:a,product:n,onAIProviderChanged:r,positions:s,editorApi:l}),on=()=>{let{aiOptIn:t,editorPluginAIProvider:n,editorView:a,api:r,wrapperElement:o,appearance:s,providerFactory:l,getMentionNameDetails:c,canInlineStreamChanges:d,isRovoLoading:p}=nD(),u=(0,i("b3YrF").useSharedPluginStateSelector)(r,"aiExperience.aiDecorationExperiencePluginState"),{isRunning:m}=u||{},f=!u||u.modalDecorationSet===i("ftzrq").DecorationSet.empty,h=(0,i("b3YrF").useSharedPluginStateSelector)(r,"aiExperience.rovoAgentsPluginState"),_=i("3yUTv").aiExperienceDecorationPluginKey.getState(a.state),y=(0,i("8C5kA").default)(),I=(0,g.useCallback)(e=>{if(!m)return;n.onAIProviderChanged&&n.onAIProviderChanged("command-palette");let t=(0,i("kqrrC").getPluginState)(a.state),r=(0,i("56Rej").hasGeneratedContentDecorations)(t)||e?.preserveEditorSelectionOnComplete?t.modalDecorationSet:void 0;(0,i("5SuLc").createEndAIExperienceCommand)(r,e?.preserveEditorSelectionOnComplete,e?.shouldClearSelectionContext)(a.state,a.dispatch)},[a,m,n]);(0,g.useEffect)(()=>{f&&I()},[f,I]);let{send:E,state:S,context:b}=iR({context:{analyticsContext:{aiSessionId:"",aiGroupId:""},aiProvider:n,intl:y,editorView:a,positions:[0,0],isEmpty:!0,selectionType:"empty",configItem:n?.baseGenerate,markdown:"",latestPromptResponse:void 0,editCount:0,refinementCount:0,retryPromptCount:0,latestPromptRetried:!1,userInput:"",apiErrorInfo:{},responseHistory:{positionFromEnd:0,entries:[],totalSize:0,traversals:0},channelId:void 0,usePageKnowledge:!0,endExperience:I}}),T=!p&&"object"==typeof S&&"command palette state"===S["modal active state"].experience,C=e(g).createElement(ot,{editorApi:r,positions:eL({modalDecorationSet:u?.modalDecorationSet}),editorView:a,product:n.product,onDocChangeByAgent:n.onDocChangeByAgent,onAIProviderChanged:n.onAIProviderChanged,editorPluginAIProvider:n});return e(g).createElement(e(g).Fragment,null,(0,i("dh538").fg)("platform_editor_ai_remove_agents_list")?null:e(g).createElement(r2,{editorView:a,editorPluginAIProvider:n},e(g).createElement(r0,{editorView:a,getMentionNameDetails:c,editorPluginAIProvider:n,editorApi:r}),e(g).createElement(iz,{editorPluginAIProvider:n,editorView:a}),C),e(g).createElement(i4,{inContentComponent:!0,onCloseFallback:I},(()=>{let t,p;if(f||(0,i("56Rej").hasGeneratedContentDecorations)(u))return null;if((0,i("dh538").fg)("platform_editor_ai_migrate_from_xstate")){if(!(t=u?.positions))return null;(p=u.modalDecorationSet.find(void 0,void 0,e=>"modalMountPointDecoration"===e.key||"modalMountPointRangeDecoration"===e.key).shift())||(p=u.modalDecorationSet.find(void 0,void 0,e=>"ai-nodeDecoration"===e.key).shift())}else if(p=u.modalDecorationSet.find(void 0,void 0,e=>"modalMountPointDecoration"===e.key||"modalMountPointRangeDecoration"===e.key).shift()){if(!u?.initialPositions)return null;t=u?.initialPositions}else{let e=u.modalDecorationSet.find(void 0,void 0,e=>"ai-nodeDecoration"===e.key);e.length>0&&(t=[Math.min(...e.map(e=>e.from)),Math.max(...e.map(e=>e.to))]),p=e.shift()}return p?e(g).createElement(rX,{isDirectionalPinningEnabled:T,lastTriggeredFrom:u.lastTriggeredFrom,key:u.modalMountedTimeStamp,decoration:p,editorView:a,editorRelativeWrapper:o?.offsetParent,endExperience:I,appearance:s,decorationSet:u.modalDecorationSet},u.configItem&&a&&e(g).createElement(rj,{api:r,context:b,send:E,state:S,configItem:u.configItem,editorPluginAIProvider:n,endExperience:I,positions:t,editorView:a,providerFactory:l,lastTriggeredFrom:u.lastTriggeredFrom,triggerMethod:u.triggerMethod,appearance:s,initialPrompt:u?.initialPrompt,getMentionNameDetails:c,triggeredFor:u.triggeredFor,engagementPlatformApi:r?.engagementPlatform?.actions,initialPositions:u?.initialPositions,nudgeMetrics:u.nudgeMetrics,defaultAgent:h?.defaultAgent,canInlineStreamChanges:d,hideLoadingScreen:_?.hideLoadingScreen,aiGroupId:u?.currentSessionId,interactionSessionId:u?.interactionSessionId})):null})(),h?.isBrowseModalOpen&&!(0,i("dh538").fg)("platform_editor_ai_remove_agents_list")&&e(g).createElement(iK,{editorView:a,aiGlobalOptIn:t,editorPluginAIProvider:n,startingConfig:u?.configItem,positions:h?.positions})))},oi=e=>{let[t,n]=(0,g.useState)(e?.aiExperience?.sharedState.currentState()?.aiDecorationExperiencePluginState.modalMountedTimeStamp);return(0,g.useLayoutEffect)(()=>{let t=e?.aiExperience?.sharedState.onChange(({prevSharedState:e,nextSharedState:t})=>{e?.aiDecorationExperiencePluginState.modalMountedTimeStamp!==t?.aiDecorationExperiencePluginState.modalMountedTimeStamp&&n(t?.aiDecorationExperiencePluginState.modalMountedTimeStamp)});return()=>{t?.()}},[e]),t},oa=e=>{let t=oi(e.api),{targetId:n,isDisplayingChanges:a}=(0,i("eiA8Z").useSharedPluginStateWithSelector)(e.api,["aiExperience","trackChanges"],e=>({targetId:e.aiExperienceState?.aiDecorationExperiencePluginState.targetId,isDisplayingChanges:e.trackChangesState?.isDisplayingChanges})),[r,o]=(0,g.useState)(!1);return g.createElement(n0,null,g.createElement(nR,{value:{...e,isRovoLoading:r,setIsRovoLoading:o,targetId:n,isDisplayingChanges:a}},g.createElement(on,{key:t}),g.createElement(iy,{api:e.api,providerFactory:e.providerFactory,appearance:e.appearance})))},or={name:"1hbjkx0",styles:"background-color:var(--ds-background-accent-blue-subtlest, #E9F2FF);border-bottom:var(--ds-border-width-selected, 2px) solid var(--ds-background-accent-blue-subtler, #cce0ff)"},oo=(0,i("9K4OG").css)({name:"mcqy92",styles:"border:var(--ds-border-width, 1px) solid var(--ds-background-accent-blue-subtle, #579DFF);box-shadow:0 0 2px 1px var(--ds-background-accent-blue-subtler, #cce0ff)"}," ::after{border-left:var(--ds-border-width, 1px) solid var(--ds-background-accent-blue-subtle, #579DFF);border-bottom:var(--ds-border-width, 1px) solid var(--ds-background-accent-blue-subtle, #579DFF);}"),os={name:"735ejv",styles:"[aria-label='Annotation toolbar'],[aria-label='Selection toolbar']{[data-role='droplistContent']{max-height:400px;overflow-x:hidden;[data-testid^='ak-editor-ai-selection-toolbar-translate-button'] [data-item-elem-before]>span{padding:0;}}[data-testid='ak-editor-ai-selection-toolbar-ai-dropdown']>span>span{margin:0;}}"},ol=(0,i("9K4OG").css)("[aria-label='Selection toolbar']{[data-testid^='ak-editor-ai-selection-toolbar-dropdown-heading']{cursor:default;>span{gap:initial;}[data-item-elem-before]>span{padding:0;}[data-item-title]{text-transform:uppercase;font-size:0.75rem;font-weight:var(--ds-font-weight-bold, 700);color:",`var(--ds-text, ${i("6fnsQ").N200})`,";}}[data-testid^='ak-editor-ai-selection-toolbar-dropdown-heading']:hover{color:",`var(--ds-text, ${i("6fnsQ").N700})`,";}}"),oc={name:"aisf00",styles:"[aria-label='Annotation toolbar'],[aria-label='Selection toolbar']{[data-role='droplistContent']{[data-testid='ak-editor-ai-selection-toolbar-dropdown-view-all-agents']:not(:only-child){border-block-start:var(--ds-border-width-selected, 2px) solid var(--ds-menu-seperator-color, var(--ds-border, #e1e3e7));>span{gap:4px;}}button[data-testid^='ak-editor-ai-selection-toolbar-dropdown-agent'] [data-item-title='true']>span{white-space:normal;}}}"};var od={name:"1pr32me",styles:"button[data-testid='ak-editor-ai-selection-toolbar-ai-button'],button[data-testid='ak-editor-ai-selection-toolbar-ai-button']:disabled,button[data-testid='ak-editor-ai-selection-toolbar-ai-button']:hover,button[data-testid='ak-editor-ai-selection-toolbar-ai-button']:focus,button[data-testid='ak-editor-annotation-toolbar-create-button'],button[data-testid='ak-editor-annotation-toolbar-create-button']:disabled,button[data-testid='ak-editor-annotation-toolbar-create-button']:hover,button[data-testid='ak-editor-annotation-toolbar-create-button']:focus{padding:0px var(--ds-space-100, 8px);}button[data-testid='ak-editor-ai-selection-toolbar-ai-button'] svg{padding-right:var(--ds-space-050, 4px);}button[data-testid='ak-editor-ai-selection-toolbar-ai-button']>span:only-child{svg{padding:0px var(--ds-space-100, 8px);}}"},op={name:"2wdbgh",styles:"button[data-testid='ak-editor-ai-selection-toolbar-ai-button'],button[data-testid='ak-editor-ai-selection-toolbar-ai-button']:disabled,button[data-testid='ak-editor-ai-selection-toolbar-ai-button']:hover,button[data-testid='ak-editor-ai-selection-toolbar-ai-button']:focus{padding:0px var(--ds-space-075, 6px);}button[data-testid='ak-editor-annotation-toolbar-create-button'],button[data-testid='ak-editor-annotation-toolbar-create-button']:disabled,button[data-testid='ak-editor-annotation-toolbar-create-button']:hover,button[data-testid='ak-editor-annotation-toolbar-create-button']:focus{padding:0px var(--ds-space-075, 6px);span:first-child{margin:0;}span[role='img'],svg{padding:0;}}"};let ou=()=>(0,m.editorExperiment)("platform_editor_controls","variant1")?op:od,og=()=>(0,i("9K4OG").css)(".ak-editor-content-area .",nB.INLINE_SUGGESTION_FLOATING_TOOLBAR_CLASS,"{padding:var(--ds-space-100, 8px);border-radius:var(--ds-space-075, 6px);[class$='-DateLozenge']{margin:0;}}.",nh.INLINE_SUGGESTION_DECORATION_CLASSES.underline,"{text-decoration-line:underline;text-decoration-style:dashed;text-decoration-color:var(--ds-border-accent-blue, #1D7AFC);}.",nh.INLINE_SUGGESTION_DECORATION_CLASSES.highlight,"{background-color:var(--ds-background-selected, #E9F2FF);}.",nh.INLINE_SUGGESTION_DECORATION_CLASSES.completionHint,"{color:",`var(--ds-text, ${i("6fnsQ").N800})`,";opacity:var(--ds-opacity-disabled, 0.5);pointer-events:none;user-select:none;}"),om=(0,i("9K4OG").css)({".akEditor div.ProseMirror":{".ai-pre-stream-range-selection":{backgroundColor:"rgb(from var(--ds-background-accent-blue-subtlest-pressed, #ADCBFB) r g b / 0.5)","&.ak-editor-annotation-draft, &.ak-editor-annotation-focus, &.ak-editor-annotation-blur":{all:"unset",backgroundColor:"rgb(from var(--ds-background-accent-blue-subtlest-pressed, #ADCBFB) r g b / 0.5)"}},".annotationView-content-wrap":{".ak-editor-annotation-draft, .ak-editor-annotation-focus, .ak-editor-annotation-blur":{"&:has(.ai-pre-stream-selection-highlight)":{all:"unset",backgroundColor:"rgb(from var(--ds-background-accent-blue-subtlest-pressed, #ADCBFB) r g b / 0.5)"}}}}}),of=()=>(0,i("9K4OG").css)(".akEditor div.ProseMirror{.ai-modal-start-widget,.ai-modal-end-widget{position:relative;&::before{content:'';background-image:url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMyIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDMgMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMSAxSDBMMSAxLjg1NzE0VjE4LjE0MzNMMCAxOS4wMDA0SDNMMiAxOC4xNDMzVjEuODU3MTRMMyAxSDJIMVoiIGZpbGw9IiM1NzlERkYiLz4KPHJlY3QgeT0iMTkiIHdpZHRoPSIzIiBoZWlnaHQ9IjEiIGZpbGw9IiM1NzlERkYiLz4KPHJlY3Qgd2lkdGg9IjMiIGhlaWdodD0iMSIgZmlsbD0iIzU3OURGRiIvPgo8L3N2Zz4K');z-index:1;display:block;position:absolute;top:0;bottom:var(--ds-space-negative-025, -2px);background-repeat:no-repeat;background-position-x:center;background-position-y:center;background-size:contain;aspect-ratio:3/20;}}.ai-modal-start-widget::before{left:0px;margin-left:-0.1em;}.ai-modal-end-widget::before{right:0px;margin-right:-0.1em;}.ai-generated-content-highlight{",or,";}.ai-selection-highlight{",or,"&.ak-editor-annotation-draft,&.ak-editor-annotation-focus,&.ak-editor-annotation-blur{all:unset;",or,";}}.ai-selection-node .pm-table-wrapper{table tr td,table tr th{",(0,i("ieXGd").getSelectionStyles)([i("b38UX").SelectionStyle.Border,i("b38UX").SelectionStyle.Blanket]),";}}.ai-generated-node-highlight .pm-table-wrapper{table tr td,table tr th{",oo,";}}.annotationView-content-wrap{.ak-editor-annotation-draft,.ak-editor-annotation-focus,.ak-editor-annotation-blur{&:has(.ai-selection-highlight){all:unset;",or,";}}}}"),oh=({children:t})=>(0,i("9K4OG").jsx)(e(g).Fragment,null,(0,i("9K4OG").jsx)(i("9K4OG").Global,{styles:[os,oc,og(),ol,of(),om,ou()]}),t),o_=({formatMessage:e,experienceState:t})=>{let n=e(n1.discardMessagePrompt),i=e(n1.discardMessageResponse);return"object"==typeof t&&"user input state"in t?n:("review state"===t||"object"==typeof t&&"loading state"in t,i)};function oy({state:t,editCount:n,retryPromptCount:a,history:r,onceDiscard:o,channelId:s,streamFlowPacer:l}){let c=i$(),{endExperience:d,sendToAIExperienceMachine:p,configItem:u,includeKnowledgeFromCurrentPage:m,appearance:f}=c,h=(0,g.useMemo)(()=>{let e=r.entries[r.positionFromEnd];return 0===r.entries.length?"":e.inputOutputDiffRatio},[r]),{formatMessage:_}=(0,i("8C5kA").default)(),y=(0,i("4SGh1").useFireAIAnalyticsEvent)(),I=tQ({stepName:"discard",attributes:{editCount:n,retryPromptCount:a,inputOutputDiffRatio:h,includeKnowledgeFromCurrentPage:m}});return(0,g.useEffect)(()=>(l?.pause(),()=>{l?.resume()}),[l]),e(g).createElement(n3,{text:o_({formatMessage:_,experienceState:t}),onCancel:function(){p({type:"disable discard"})},onDiscard:function(){y({payload:(0,i("ilIeg").createUnifiedAnalyticsPayload)({action:i("d925B").ACTION.DISMISSED,interactionID:s??I.getLastAiInteractionId(),experienceName:(0,i("6gJll").convertExperienceName)(u.key.toString()),isProactive:!1,attributes:I.getAiLifeCycleDynamicAttributes({init:!1}),invokedFrom:c.lastTriggeredFrom,isStreamingEnded:(0,i("dh538").fg)("platform_editor_ai_streaming_ended_analytics_attr")?!!I.getCommonAttributes().isStreamingEnded:void 0})}),o?(p({type:"disable discard"}),o()):d()},appearance:f})}function oI({updateStream:t,parentPresetPromptLabel:n,childShortTitle:a,title:r,latestPrompt:o,promptTrigger:s,refinementCount:l,latestPromptRetried:c,markdown:d,adfResponse:p,idMap:u,contextStatistics:m,hideLoadingScreen:f}){let{configItem:h,editorView:_,providerFactory:y,sendToAIExperienceMachine:I,editorPluginAIProvider:E,includeKnowledgeFromCurrentPage:S,isUserScroll:b,isProgrammaticScroll:T,appearance:C}=i$(),A=_.state.schema,{formatMessage:v}=(0,i("8C5kA").default)(),P=aS({editorPluginAIProvider:E}),k=J(h,v),x=(0,i("4SGh1").useFireAIAnalyticsEvent)(),[w,M]=(0,g.useState)(),[N,O]=(0,g.useState)(!1),R=(0,g.useRef)(null),D=(0,g.useRef)(),L=(0,g.useRef)(!1),F=(0,g.useRef)(null),G=(0,g.useRef)(0),B=(0,g.useRef)(0),U=(0,g.useRef)(!1),V=(0,g.useCallback)((e,t)=>{T.current=!0,t.scroll({top:G.current+B.current+e.scrollHeight-t.offsetHeight,behavior:"instant"})},[T]),j=(0,g.useCallback)(e=>{T.current=!0,e.scroll({top:G.current+B.current-32,behavior:"instant"})},[T]);(0,g.useEffect)(()=>{let e=_.dom.closest(".ak-editor-content-area");if(!e)return;let t=new ResizeObserver(()=>{T.current=!0});return t.observe(e),()=>t.unobserve(e)},[_,T]);let[H,z]=(0,g.useState)(!1);(0,g.useEffect)(()=>{if(!(0,i("dh538").fg)("platform_editor_ai_scroll_into_view_fix"))return;let t=R.current;if(!t)return;let n=(0,i("7YjFd").findOverflowScrollParent)(t);if(!n)return;let a=e(eo)(()=>{z(!0),r()},250),r=(0,i("fFa3V").bind)(n,{type:"scroll",listener:a})},[]),(0,g.useEffect)(()=>{let e=R.current;if(!e)return;let t=(0,i("7YjFd").findOverflowScrollParent)(e);if(!t)return;F.current=t,B.current=e.getBoundingClientRect().top-t.getBoundingClientRect().top,G.current=t.scrollTop,B.current+e.scrollHeight<0?j(t):B.current>t.offsetHeight&&V(e,t);let n=(0,i("fFa3V").bind)(t,{type:"scroll",listener:()=>{(0,i("dh538").fg)("platform_editor_ai_scroll_into_view_fix")?H&&!T.current&&(b.current=!0,n()):T.current||(b.current=!0,n()),T.current=!1}});return()=>{n()}},[j,V,H,T,b]);let K=(0,g.useRef)(p);K.current=p,(0,g.useEffect)(()=>{void 0===D.current&&(D.current=window.requestAnimationFrame(()=>{let e;if(D.current=void 0,K.current&&(0,i("4F0gv").isAdfStreamingEnabled)())e=aN({adfResponse:K.current,showTelepointer:!0,providerFactory:y});else if(d&&""!==d){let{pmFragment:t}=ep({markdown:d,schema:A,source:"loading",fireAIAnalyticsEvent:e=>{L.current||(L.current=!0,x(e))},idMap:u});if(aE(d))return;e=aM({schema:A,pmFragment:t,showTelepointer:!0,providerFactory:y})}else e=void 0;e&&(M(e),O(!0),window.requestAnimationFrame(()=>{!function(){if(b.current||U.current)return;let e=R.current;if(!e)return;let t=F.current;if(!t)return;let n=t.offsetHeight>B.current+e.scrollHeight,i=t.offsetHeight-32<e.scrollHeight;if(!n){if(i){j(t),U.current=!0;return}V(e,t)}}()}))}))},[d,t,p]),(0,g.useEffect)(()=>()=>{D.current&&window.cancelAnimationFrame(D.current)},[]);let W=an(o),q=ab(W),Y=tQ({needUpdatedArgs:!0,stepName:"loading",attributes:{promptType:s,latestPromptRetried:c,refinementCount:l,modelIO:{contextStatistics:m,userInputCharacterCount:q?.totalCharacterCount,userInputNodeCounts:q?.nodeCounts,userInputLinksCount:q?.linksCount,userInputMentionsCount:q?.mentionsCount},includeKnowledgeFromCurrentPage:S,isStreamingEnded:!(0,i("dh538").fg)("platform_editor_ai_streaming_ended_analytics_attr")&&void 0}}),$=(0,g.useRef)();return!$.current&&N&&($.current=performance.now()),(0,g.useEffect)(()=>{let e=performance.now();return()=>{$.current&&Y.addAttributes({durations:{timeSpentWithoutPartialPreview:$.current-e,timeSpentWithPartialPreview:performance.now()-$.current}})}},[]),g.createElement("div",{ref:R,className:(0,i("gMc0m").default)(["_j4orxy5q"])},g.createElement(id,{parentPresetPromptLabel:n,childShortTitle:a,presetPromptLabel:k,latestPrompt:W,agent:h?.agent,title:r,preview:w,providerFactory:y,disclaimer:P,onCancel:()=>{I({type:"enable discard"})},schema:A,isStreaming:!!p||!!d,canInlineStreamChanges:!0,hideLoadingScreen:!!f,appearance:C}))}i("42omo");let oE=({onFormSubmit:t,inputValue:n,suggestions:a,setSuggestion:r,showButton:o})=>{let s=a.find(e=>"Brainstorm"===e.value),[l,{breakpoint:c}]=(0,i("imfiV").useElementBreakpoints)();return(0,n5.jsxs)(i("u9agA").default,{ref:l,spread:"space-between",xcss:"_zulpu2gc _1e0c1txw _u5f3utpp _n3tdutpp _19bvutpp _4cvr1h6o",children:[(0,n5.jsx)(i("u9agA").default,{xcss:"_zulpu2gc _1e0c1txw _4cvr1h6o",children:!n&&a.filter(e=>"tell-ai"!==e.value&&"show-more"!==e.value).slice(0,(e=>{if(!e.length)return 0;let t=c<=i("imfiV").Breakpoint.Small,n=e[0];return"Brainstorm"===n.value?1:n.nestingConfig&&n.label!==n.nestingConfig.parentTitle?t?1:e.length:t?1:3})(a)).map(e=>(0,n5.jsx)(i("ccHMk").default,{spacing:"compact",onClick:()=>e.onSelect(),onMouseEnter:()=>e.onSuggestionFocused(),onMouseLeave:()=>r(s||e),children:e.label},`${e.value}-button`))}),o&&(0,n5.jsx)(i("1qfLF").default,{icon:e(i("4fdTR")),spacing:"compact",label:"send-icon-command-palette-lozenge",isDisabled:""===n,onClick:()=>{t(n)}})]})};i("42omo");function oS({onChange:e,isChecked:t}){let{formatMessage:n}=(0,i("8C5kA").default)(),a="page-knowledge-toggle";return(0,n5.jsxs)(i("gdv5Z").default,{xcss:"_zulp1b66 _1e0c1txw _ca0q12x7 _19bv12x7 _u5f312x7 _n3td12x7 _uwhke4h9 _15a5nqa1 _1i531l7x _4cvr1h6o",backgroundColor:"elevation.surface",children:[(0,n5.jsx)(i("82gXq").default,{id:a,testId:a,onChange:e,isChecked:t}),(0,n5.jsx)("label",{htmlFor:a,className:(0,i("gMc0m").default)(["_syazazsu"]),children:n(i("giv7U").default.usePageKnowledgeToggleLabel)})]})}var ob=i("kB2tR");i("42omo");let oT=({id:e,heading:t})=>(0,n5.jsx)("h3",{id:e,"data-testid":e,className:(0,i("gMc0m").default)([(0,i("dh538").fg)("ai-smart-button-team-25")?"_fqox2smr _1bg4usvi _rcujze3t _o81cze3t _1l6uze3t _149mze3t _if291txw _1dltutpp _1yxxpxbi _w8sqpxbi _fjwr1b66 _12r21wq8 _1w901rpy":"_fqox1o8v _1bg4usvi _if291txw _rcujze3t _o81cze3t _1l6uze3t _149mze3t _1dltutpp _w8squtpp _fjwr1b66 _1yxxutpp _1y2cmoej _nmk4angw _1w90azsu","_kqsw1if8 _1bsb1kw7 _154iidpf _bfhkvuon _1pbykb7n"]),children:t}),oC=({alt:t,isDisabled:n=!1,isSelected:i=!1,className:a,size:r=24,isPadded:o=!0,style:s={}})=>{let l=n?"var(--ds-icon-disabled, #080F214A)":i?"var(--ds-icon-selected, #1868DB)":"var(--ds-icon, #292A2E)";return(0,n5.jsxs)("svg",{...{width:r,height:r,className:a,role:""===t?"presentation":void 0,xmlns:"http://www.w3.org/2000/svg",style:s},viewBox:o?"0 0 24 24":"0 0 16 16",children:[t&&(0,n5.jsx)("title",{children:t}),o?(0,n5.jsxs)(e(g).Fragment,{children:[(0,n5.jsx)("path",{d:"M14.5 14.5L17.5 17.5",stroke:l,strokeWidth:"1.5",strokeLinecap:"square"}),(0,n5.jsx)("path",{d:"M9.5 14.5L6.5 17.5",stroke:l,strokeWidth:"1.5",strokeLinecap:"square"}),(0,n5.jsx)("path",{d:"M9.5 9.5L6.5 6.5",stroke:l,strokeWidth:"1.5",strokeLinecap:"square"}),(0,n5.jsx)("path",{d:"M14.5 9.5L17.5 6.5",stroke:l,strokeWidth:"1.5",strokeLinecap:"square"}),(0,n5.jsx)("path",{d:"M12.0001 16V19",stroke:l,strokeWidth:"1.5"}),(0,n5.jsx)("path",{d:"M8.00012 12L5.00012 12",stroke:l,strokeWidth:"1.5"}),(0,n5.jsx)("path",{d:"M12.0001 8.00002L12.0001 4.99999",stroke:l,strokeWidth:"1.5"}),(0,n5.jsx)("path",{d:"M16.0002 12L19.0002 12",stroke:l,strokeWidth:"1.5"})]}):(0,n5.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.24999 4V1H8.74999V4H7.24999ZM5.46966 6.53033L1.46966 2.53033L2.53032 1.46967L6.53032 5.46967L5.46966 6.53033ZM9.46966 5.46967L13.4697 1.46967L14.5303 2.53033L10.5303 6.53033L9.46966 5.46967ZM0.999992 7.25H3.99999V8.75H0.999992V7.25ZM12 7.25H15V8.75H12V7.25ZM1.46966 13.4697L5.46966 9.46967L6.53032 10.5303L2.53032 14.5303L1.46966 13.4697ZM13.4697 14.5303L9.46966 10.5303L10.5303 9.46967L14.5303 13.4697L13.4697 14.5303ZM7.24999 15V12H8.74999V15H7.24999Z",fill:"currentColor"})]})},oA=(0,i("cgtv4").defineMessages)({tellAILabel:{id:"fabric.editor.ai.ui.components.suggestions.tellAILabel",defaultMessage:"Tell AI"},tellAgentLabel:{id:"fabric.editor.ai.ui.components.suggestions.tellAgentLabel",defaultMessage:"Tell Agent"},suggestionStatusBeta:{id:"fabric.editor.ai.ui.components.suggestions.betaLozenge",defaultMessage:"BETA"},suggestionStatusNew:{id:"fabric.editor.ai.ui.components.suggestions.newLozenge",defaultMessage:"NEW"}}),ov={default:"_19bv1b66"},oP=(e,t)=>{let n=e.offsetParent?.parentElement;if(!n||"DIV"!==n.tagName)return;let i=n.getBoundingClientRect(),a=e.getBoundingClientRect();(e.offsetTop<n.scrollTop||e.offsetTop+a.height>n.scrollTop+i.height)&&n.scrollTo({top:e.offsetTop-t,behavior:"smooth"})},ok={beta:oA.suggestionStatusBeta,new:oA.suggestionStatusNew},ox=({suggestion:t,customLabel:n,highlighted:a,setSuggestion:r,hasGroupHeading:o})=>{let{formatMessage:s}=(0,i("8C5kA").default)(),l=(0,g.useRef)(null),c=(0,g.useMemo)(()=>t.childSuggestions&&t.childSuggestions.length,[t.childSuggestions]),d=e(g).useCallback(e=>{r&&r(t,e)},[r,t]),p=e(g).useCallback(()=>{d("focus"),t.onSuggestionFocused()},[d,t]),u=e(g).useCallback(()=>{d("mousemove")},[d]);(0,g.useEffect)(()=>{a&&l.current&&!l.current.matches(":hover")&&oP(l.current,32*!!o)},[l,a,o]);let m=(0,g.useMemo)(()=>c&&!a?(0,n5.jsx)("span",{className:(0,i("gMc0m").default)(["_ca0qze3t _n3tdze3t _19bv1b66 _u5f31b66"]),children:(0,n5.jsx)(e(i("6R5uz")),{label:"",color:"var(--ds-icon-subtle, #505258)",size:"small"})}):null,[c,a]),f=t.statusLozengeType&&(ok[t.statusLozengeType]?s(ok[t.statusLozengeType]):null),h=n||("string"==typeof t.label?t.label:s(oA.tellAILabel));return(0,n5.jsx)("li",{ref:l,className:(0,i("gMc0m").default)(["_qtt8glyw _19pkze3t"]),children:(0,n5.jsxs)("button",{type:"button",onClick:t.onSelect,onMouseMove:u,"data-testid":t.testId||(n?"tell-ai":t.label),"data-highlighted":a,"aria-label":(0,td.expValEquals)("platform_editor_drag_handle_aria_label","isEnabled",!0)?h:"",onFocus:p,className:(0,i("gMc0m").default)(["_11c82smr _1bsb1osq _1tke1ylp _ca0q12x7 _u5f3utpp _n3td12x7 _19bvutpp _19pkze3t _1e0c1txw _2lx2vrvc _1bahv2br _4cvr1h6o _y3gn1e5h _k48pi7a9 _syazi7uo","_19itidpf _2rkoidpf _zulpw1gv _11q7glyw _13liidpf _qrwqidpf _p8yktlke _ga3tfcek _13l41dpa _1jlodfik _1afz1i6y _1b6jby5v _xa3z1gmx _1lo213gf",(0,i("dh538").fg)("ai-smart-button-team-25")&&"_zulputpp _1bsb1osq _19bvv47k _u5f3v47k _ca0q12x7 _n3td12x7 _19pkze3t _otyrze3t _18u0ze3t _2hwxze3t _1e0c1txw _1bahv2br _4cvr1h6o _y3gn1e5h _k48pi7a9 _syazi7uo",(0,i("dh538").fg)("ai-smart-button-team-25")&&"_19itidpf _11q7glyw _1tke1jfw _p8yktlke _ga3tfcek _13l41dpa _1jlodfik _1afz1i6y _1b6jby5v _xa3z1gmx _1lo213gf",t.value.includes("agent:")&&"_1tke1a70"]),children:[!t.hideIcon&&(0,n5.jsx)("span",{className:(0,i("gMc0m").default)(["_1e0c116y _4cvr1h6o _1bah1h6o _4t3i1tcg _1bsb1tcg","_xcdj1tcg _htdvgktf",(0,i("dh538").fg)("ai-smart-button-team-25")&&"_1e0c1txw _4cvr1h6o _1bah1h6o",(0,i("dh538").fg)("ai-smart-button-team-25")&&"_4t3ixy5q _1bsbxy5q",!t.isAgent&&(0,i("dh538").fg)("ai-smart-button-team-25")&&"_2rko12b0 _189ee4h9 _1dqonqa1 _1h6d1l7x",t.value.includes("agent:")&&"_4t3izwfg _1bsbzwfg"]),children:t.icon||((0,i("dh538").fg)("ai-smart-button-team-25")?(0,n5.jsx)(e(i("3Mg7y")),{spacing:"spacious",label:""}):(0,n5.jsx)(oC,{className:"default-icon",alt:""}))}),(0,n5.jsxs)(i("1s5hv").default,{direction:"column",xcss:"_16jlkb7n _1o9zkb7n _i0dlf1ug _1reo15vq _18m915vq _ct361wug _slp31hna _1ul9l1r9 _1bto1l2s _o5721q9c",children:[(0,n5.jsxs)(i("1s5hv").default,{alignItems:"center",children:[n?(0,n5.jsxs)(e(g).Fragment,{children:[(0,n5.jsx)("span",{className:(0,i("gMc0m").default)(["_k48p1wq8 _2hwx1b66"]),children:n}),' "',t.label,'"']}):(0,n5.jsx)(i("iXCQx").default,{children:t.label}),f&&(0,n5.jsx)(i("1s5hv").default,{alignItems:"center",xcss:ov.default,children:(0,n5.jsx)(i("5nBzc").default,{appearance:"new",children:f})})]}),t.description&&(0,n5.jsx)("span",{className:(0,i("gMc0m").default)(["_16jlkb7n _1o9zkb7n _i0dlf1ug _1reo15vq _18m915vq _11c8dcr7 _ct361wug _slp31hna _1ul9l1r9 _1bto1l2s _o5721q9c _syaz1rpy _1e0c1o8l","_vwz4dlk8"]),children:t.description})]}),t.rightText&&(0,n5.jsx)(i("iXCQx").default,{color:"color.text.subtlest",children:t.rightText}),"no-suggestions"!==t.value&&(0,n5.jsx)("span",{className:(0,i("gMc0m").default)(["_1e0cglyw _4t3igktf _1bsbgktf _syazazsu _bfhk1dpa","_2rkofajl _jbdb116y _w7a71h6o _1rrh1h6o"]),children:(0,n5.jsx)(i("510uT").default,{})}),m]})})},ow={default:"_16jlidpf _1o9zkb7n _i0dl1wug _18m91wug"};function oM(e,t){let n;n="function"==typeof t.groupHeading?t.groupHeading():t.groupHeading||"";let i=e.findIndex(e=>e.groupHeading===n);return -1===i&&(i=e.push({groupHeading:n,suggestions:[]})-1),e[i].suggestions.push(t),e}let oN=({suggestionsHeading:t,suggestions:n,value:a,setSuggestion:r,hideGroupHeading:o})=>{let{formatMessage:s}=(0,i("8C5kA").default)(),l=e(g).useRef(!1),c=e(g).useRef(null),d=e(g).useCallback((e,t)=>{r&&("mousemove"===t&&l.current||r(e))},[r]);e(g).useEffect(()=>{if(!c.current)return;let t=e(eo)(()=>{l.current=!1},75),n=()=>{l.current=!0,t()},i=c.current;return i.addEventListener("scroll",n),i.addEventListener("scrollend",n),()=>{i.removeEventListener("scroll",n),i.removeEventListener("scrollend",n)}},[c]);let p=(0,g.useMemo)(()=>{let t={"tell-ai":s(oA.tellAILabel),"tell-agent":s(oA.tellAgentLabel)};return(n||[]).reduce(oM,[]).map(n=>{let r=`list-heading-${e(ob)(n.groupHeading)}`;return(0,n5.jsxs)(n5.Fragment,{children:[n.groupHeading&&!o&&(0,n5.jsx)(oT,{id:r,heading:n.groupHeading}),(0,n5.jsx)("ul",{"aria-labelledby":r,"data-testid":`suggestion-group-${e(ob)(n.groupHeading||"Atlassian intelligence")}`,className:(0,i("gMc0m").default)(["_19pkidpf _2hwxidpf _otyridpf _18u0idpf _ca0qidpf _u5f3idpf _n3tdidpf _19bvidpf"]),children:n.suggestions.map(e=>(0,n5.jsx)(ox,{suggestion:e,customLabel:t[e.value]||void 0,highlighted:e.value===a,setSuggestion:d,hasGroupHeading:!!n.groupHeading&&!o},e.value))},`group_${n.groupHeading}`)]})})},[s,d,n,a,o]);return p.length?(0,n5.jsxs)(i("gdv5Z").default,{testId:"suggestions-container",xcss:ow.default,ref:c,style:{borderTop:"var(--ds-border-width, 1px) solid var(--ds-border, #0B120E24)"},children:[t&&(0,n5.jsx)("h2",{className:(0,i("gMc0m").default)(["_fqox1o8v _rcujze3t _o81cze3t _1l6uze3t _149mze3t _1dlt12x7 _w8squtpp _fjwr12x7 _1yxxutpp _1y2cmoej _nmk4angw _1w90azsu"]),children:t}),(0,n5.jsx)("div",{"data-testid":"editor-plugin-ai-suggestion-list",id:"suggestion-list",className:(0,i("gMc0m").default)([(0,i("dh538").fg)("ai-smart-button-team-25")&&"_qtt8glyw _kqswh2mm _1bsb1osq _4t3i1osq _19bvze3t _u5f3ze3t _ca0qze3t _n3tdutpp",!(0,i("dh538").fg)("ai-smart-button-team-25")&&"_qtt8glyw _1bsb1osq _4t3i1osq _19pkze3t _2hwxze3t _otyrze3t _18u0ze3t _ca0qze3t _u5f3ze3t _n3tdze3t _19bvze3t _1e0c1o8l _kqswh2mm",!(0,i("dh538").fg)("ai-smart-button-team-25")&&"_1x7s1kw7 _136z1kw7 _19511kw7 _jb8p1kw7"]),children:p})]}):null};i("42omo"),i("42omo");function oO({text:t,onClose:n}){return(0,n5.jsxs)(i("1s5hv").default,{xcss:"_2rko12b0 _ca0qutpp _n3tdutpp _19bvutpp _u5f3utpp _bfhk6vm6 _syazdv2p",alignItems:"center",justifyContent:"space-between",gap:"space.050",children:[t,(0,n5.jsx)(i("1qfLF").default,{icon:e(i("hmuev")),label:"Close",spacing:"compact",appearance:"subtle",onClick:n})]})}let oR={default:"_ca0qu2gc _19bvu2gc _u5f3u2gc _n3tdu2gc _15a5nqa1 _uwhke4h9 _1i531l7x"};function oD({banners:e}){return 0===e.length?null:(0,n5.jsx)(i("1s5hv").default,{xcss:oR.default,direction:"column",gap:"space.100",children:e.map(e=>(0,n5.jsx)(oO,{text:e.text,onClose:e.onClose},e.id))})}let oL=(e,t,n)=>{let i=e.indexOf(t),{length:a}=e;if(0===a)return"";if("ArrowUp"===n)if(i>a-1)return e[0];else if(i>0)return e[i-1];else if(0===i)return e[a-1];else return e[0];if("ArrowDown"===n){if(i>=a-1)return e[0];else if(i<0)return e[0];else if(i<a-1)return e[i+1]}else throw Error("Unknown direction");return""};var oF=(0,i("cgtv4").defineMessages)({footerText:{id:"fabric.editor.ai.screens.UserInputCommamdPalette.footerText",defaultMessage:"Atlassian Intelligence"},suggestionsUpdated:{id:"fabric.editor.ai.experience.suggestionsUpdated",defaultMessage:"{numberOfSuggestions} suggestions available for typed text"},rovoProductLabel:{id:"fabric.editor.ai.experience.rovoAgents.productLabel",defaultMessage:"Rovo"},rovoProductLogoAltText:{id:"fabric.editor.ai.experience.rovoAgents.productLogoAltText",defaultMessage:"Rovo Logo"},rovoAgentsPalettePlaceholder:{id:"fabric.editor.ai.experience.rovoAgents.agentPalette.placeholder",defaultMessage:"Tell Agent to write anything or choose from the below"},commandPaletteAriaName:{id:"fabric.editor.ai.experience.commandPaletteAriaName",defaultMessage:"Atlassian Intelligence"},commandPaletteV2Placeholder:{id:"fabric.editor.ai.experience.commandPaletteV2Placeholder",defaultMessage:"Tell AI what to do ..."}});function oG(e,t){let{nestingConfig:n}=t;if(n){let i=e.findIndex(e=>e.nestingConfig?.parentTitle===n.parentTitle);if(-1===i){let i={...n};delete i.shortTitle,e.push({...t,testId:n.parentTestId,label:n.parentTitle||"",nestingConfig:i,childSuggestions:[t],value:t.nestingConfig?.parentTitle||""})}else e[i].childSuggestions?.push(t)}else e.push(t);return e}let oB={default:"_ca0qutpp _u5f3utpp _19bvutpp _n3tdutpp _1tkeidpf _1o9zidpf"},oU={default:"_18zrpxbi _1rjcutpp _1tkeidpf _1o9zidpf"},oV=({appearance:t,inputValue:n,inputADFValue:a,onInputUpdate:r,onADFUpdate:o,presetPromptLabel:s,onSubmit:l,onEscapeKeyPressed:c,onRefinementTagRemove:d,onBack:p,placeholder:u,getSuggestions:m,suggestionsHeading:f,focusInputRef:h,PromptEditor:_,agent:y,hideLegacySubmitCancelButtons:I,announcementBanners:E,pageKnowledgeProps:S,isAIFC:b})=>{let T=(0,g.useRef)(null),{formatMessage:C}=(0,i("8C5kA").default)(),[A,v]=(0,g.useState)(!1),[P,k]=(0,g.useState)(!1);(0,g.useLayoutEffect)(()=>{let{current:e}=T;return e?((0,i("dh538").fg)("platform_editor_ai_scroll_into_view_fix")||e.scrollIntoView({block:"nearest",behavior:"auto"}),(0,i("fFa3V").bindAll)(e,[{type:"keydown",listener:e=>{"Escape"===e.key&&(e.preventDefault(),e.stopPropagation(),c())}},{type:"keyup",listener:e=>{"Escape"===e.key&&(e.preventDefault(),e.stopPropagation())}}])):void 0},[T,c]);let x=(0,g.useCallback)((e,t)=>{let n=m(e)??[];n=n.reduce(oG,[]),t&&(n=n.find(e=>e.nestingConfig?.parentTitle===t)?.childSuggestions??[]);let i=n.findIndex(e=>"show-more"===e.value);if(-1!==i){let e=n[i].onSelect;n[i].onSelect=()=>{e(),k(!0)}}return n},[m]),w=(0,g.useMemo)(()=>y?m(n,y):n.length?m(n)??[]:x(n,s),[y,m,x,n,s]),M=(0,g.useMemo)(()=>b?x("",s):[],[x,s,b]),N=(0,g.useMemo)(()=>s&&!!w.length,[w,s]),O=(0,i("9LxGu").useAgentRefinementTagProps)(y),R=(0,g.useRef)(null),D=(0,g.useMemo)(()=>void 0===s?void 0:(0,n5.jsx)(i("bwdMU").RefinementTag,{...O,label:s,ref:R,onClick:d}),[O,s,d,R]),L=(0,g.useMemo)(()=>(w||[]).map(e=>e.value),[w]),[F,G]=(0,g.useState)(L.length>0?L[0]:""),B=(0,g.useCallback)(e=>{let t=w.find(t=>t.value===e);t?.onSuggestionFocused()},[w]),U=(0,g.useCallback)(e=>{B(e),G(e)},[G,B]);(0,g.useEffect)(()=>{L.includes(F)||0===L.length||U(L[0])},[F,L,U]);let V=(0,g.useMemo)(()=>{let e=L.filter(e=>"show-more"!==e);if(P||n.length>0)return e;let t=L.filter(e=>e.startsWith("agent:"));if(0===t.length||e.length<=9||e.length-t.length<=4)return e;let i=9-t.length-1;return i<4&&(i=4),[...L.slice(0,i),"show-more",...t]},[n.length,P,L]),j=(0,g.useMemo)(()=>w.filter(e=>V.includes(e.value)),[w,V]),H=(0,g.useCallback)(e=>{if(!e.metaKey&&!e.ctrlKey&&!e.altKey&&!e.shiftKey&&!(V.length<=1))switch(e.key){case"ArrowUp":case"ArrowDown":v(!0),U(oL(V,F,e.key)),e.preventDefault(),e.stopPropagation();break;default:return}},[F,U,V]),z=(0,g.useMemo)(()=>e(eo)(()=>{v(!1)},300),[]),K=(0,g.useCallback)(()=>{z()},[z]),W=(0,g.useCallback)(e=>{U(e.value)},[U]),q=(0,g.useCallback)(()=>{if(""===F||w?.length===0)return void l();let e=(w||[]).find(e=>e.value===F);e&&e.onSelect(),U("")},[F,w,U,l]),Y=!I&&!!(s&&!y),$=(0,g.useMemo)(()=>y?C(oF.rovoAgentsPalettePlaceholder):u,[y,C,u,D]),J=(0,n5.jsx)(i("1s5hv").default,{testId:"prompt-header-wrapper",xcss:(0,i("dh538").fg)("ai-smart-button-team-25")?oU.default:oB.default,children:(0,n5.jsx)(i("2NU90").PromptForm,{type:"user-input",showButtons:Y,placeholder:b?C(oF.commandPaletteV2Placeholder):$,value:n,adfValue:a,onFormSubmit:q,onInputChange:r,onADFChange:o,tag:N?void 0:D,focusInputRef:h,showLogo:!1,onInputKeyDown:H,onInputKeyUp:K,PromptEditor:_,enableLinks:!0,showBack:!!s,onBack:p,refinementTagRef:R,isAIFC:b})});return(0,n5.jsxs)("div",{ref:T,"data-testid":"user-input-command-palette-screen",className:(0,i("gMc0m").default)(["_zulp1b66 _1e0c1txw _2lx21bp4 _4cvr1y6m","_j4orxy5q",A&&"_1n5d1j28",`user-input-command-palette-screen ${i("kuYGt").AI_MODAL_SCREEN_CLASS}`]),children:[(0,n5.jsx)(i("7hXDW").default,{size:"large",children:(0,n5.jsx)(i("6F6hl").default,{children:C(oF.commandPaletteAriaName)})}),(0,n5.jsxs)(i("40sdH").FloatingContainer,{disablePadding:!0,"data-testid":"prompt-form-screen",rainbowBorder:!1,enableMaxHeight:!0,isAIFC:b,className:(0,i("gMc0m").default)(["_1e0c1txw _2lx21bp4 _ca0qze3t _u5f3ze3t _n3tdze3t _19bvze3t"]),children:[J,b?(0,n5.jsx)(oE,{onFormSubmit:q,inputValue:n,suggestions:M,setSuggestion:W,showButton:!s}):(0,n5.jsxs)(e(g).Fragment,{children:[E&&(0,n5.jsx)(oD,{banners:E}),(0,i("dh538").fg)("editor_a11y_announce_editor_ai_list_update")&&(0,n5.jsx)(i("5KVL8").AssistiveText,{assistiveText:C(oF.suggestionsUpdated,{numberOfSuggestions:j.length}),isInFocus:j.length>0,id:"suggestions-updated","data-testid":"suggestions-updated"}),w||n?(0,n5.jsx)(oN,{appearance:t,suggestions:j,suggestionsHeading:f,value:F,setSuggestion:W,hideGroupHeading:!!y}):null,S?.isVisible&&(0,n5.jsx)(oS,{onChange:S.onToggle,isChecked:S.isEnabled})]})]})]})},oj=e=>(0,n5.jsxs)("svg",{width:"23",height:"26",viewBox:"0 0 23 26",fill:"none",...e,children:[(0,n5.jsx)("path",{d:"M10.512 1.06137C11.1247 0.713259 11.8753 0.713259 12.488 1.06137L21.488 6.17501C22.1136 6.53043 22.5 7.19446 22.5 7.91392V18.0861C22.5 18.8055 22.1136 19.4696 21.488 19.825L12.488 24.9386C11.8753 25.2867 11.1247 25.2867 10.512 24.9386L1.51198 19.825C0.886437 19.4696 0.5 18.8055 0.5 18.0861V7.91392C0.5 7.19446 0.886437 6.53043 1.51198 6.17501L10.512 1.06137Z",fill:e.primaryColor||"#0C66E4"}),!e.primaryColor&&!e.excludeOverlay&&(0,n5.jsxs)(g.Fragment,{children:[(0,n5.jsx)("path",{d:"M15.3711 9.12845C15.7263 9.30173 16.1726 9.00581 16.3843 9.37104C16.1136 9.2564 16.1496 10.7306 16.5959 10.3814C16.6497 10.1521 16.7793 10.1801 16.551 10.1015C16.9344 10.0988 16.5779 9.84556 16.5907 9.80957C16.7998 9.80424 16.5266 9.68161 16.7254 9.72427C16.8408 9.70027 16.5035 9.39637 16.7318 9.47768C16.8049 9.14711 17.1615 9.14976 17.0819 8.94849C17.0858 9.08578 18.2708 9.11778 17.9425 8.59261C17.7347 8.60328 17.7617 8.36068 17.7309 8.67659C17.668 8.28471 17.5283 8.67658 17.4949 8.66725C17.4641 8.44731 17.4026 8.75122 17.4115 8.53662C17.3808 8.42066 17.1807 8.79121 17.2204 8.54861C16.5292 8.36067 17.096 8.15807 16.6972 7.75019C16.6574 7.56092 16.7549 6.94644 16.3278 7.00376C15.7661 7.17171 16.4214 8.22072 16.088 8.40333C15.9392 8.54195 15.7276 8.71656 15.4467 8.59793C15.3082 8.59527 15.13 9.1831 15.3698 9.12979L15.3711 9.12845Z",fill:"#579DFF"}),(0,n5.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15.3218 15.6931L14.5291 14.9004C12.9326 16.1142 11.4765 17.4318 10.1783 18.8662C8.3402 17.3566 6.68445 15.6005 5.18662 13.6303L11.4518 7.36515C12.9665 10.1168 15.0426 12.0855 17.5196 13.4953L15.3218 15.6931ZM10.7452 13.7518L10.7452 15.6016L10.7454 15.6016L11.6857 15.6016L11.6857 13.7518L13.4285 13.7518L11.2154 11.5387L9.00236 13.7518L10.7452 13.7518ZM14.5291 14.9007L15.3217 15.6934L11.2855 19.7296C10.9092 19.4518 10.5403 19.1639 10.1783 18.8665C11.4764 17.4323 12.9325 16.1146 14.5291 14.9007Z",fill:"#CCE0FF"})]})]}),oH=e=>(0,n5.jsx)(oj,{...e}),oz=e=>(0,n5.jsx)(i("gdv5Z").default,{xcss:"_195g1b66 _4t3i1osq _1e0c1txw _1bah1h6o _4cvr1h6o",children:(0,n5.jsx)(oH,{...e})}),oK=(t,n=3)=>Array(n).fill(null).map((n,a)=>({value:`agent:${t.id}:${e(eI)()}:dummy`,label:e(g).createElement(i("kpYGL").default,{width:`${a%2!=0?205:180}px`,height:"18px",borderRadius:2,isShimmering:!0}),icon:e(g).createElement(oz,{label:"",excludeOverlay:!0,size:"large",width:32,height:32,primaryColor:`var(--ds-skeleton, ${i("6fnsQ").N20A})`}),groupHeading:"",onSelect:()=>{},onSuggestionFocused:()=>{}})),oW="Rovo agent conversation starters",oq=({hasInput:e,suggestions:t,agentVisible:n,nestedMenuSelected:a})=>{let{sendToAIExperienceMachine:r,includeKnowledgeFromCurrentPage:o}=i$(),s=(0,g.useMemo)(()=>{if((0,i("dh538").fg)("ai-smart-button-team-25")){let e=[aA,av,aT,aC].includes(t[0]?.value);return!!(n||e&&!a)}let r=t[0]?.groupHeading===n1.atlassianIntelligenceGroupHeading.defaultMessage;return!!(n||e&&!r&&!a)},[n,a,e,t]);return(0,g.useMemo)(()=>({isEnabled:!!o,isVisible:s,onToggle:()=>r({type:"toggle use page knowledge"})}),[o,s,r])},oY="editor-ai.submit-prompt";var o$=()=>{let e=(0,i("1pSma").default)(`${oY}.atlassian-intelligence`),t=(0,i("1pSma").default)(`${oY}.rovo`);return(0,g.useCallback)(n=>{("rovo"===n?t:e)()},[e,t])};function oJ({context:t,initialPrompt:n}){let a=i$(),{appearance:r,editorPluginAIProvider:o,endExperience:s,sendToAIExperienceMachine:l,modalRef:c}=a,{formatMessage:d}=(0,i("8C5kA").default)(),{configItem:p,baseGenerate:u,userInput:m,userADFInput:f,parentPresetPromptLabel:h,editCount:_,positions:y,editorView:I,isEmpty:E,latestPromptResponse:S,aiProvider:b}=t,[T,C]=e(g).useState(!1),A=o$(),{context:v,send:P}=a7({baseGenerate:u,startingConfig:p,startingPresetPromptLabel:h||J(p,d),startingUserInput:m,startingUserADFInput:f}),{textInput:k,adfInput:x,configItem:w,presetPromptLabel:M}=v,N=!!(M&&w.nestingConfig),O=iL({editorState:I.state}),{isBrowseModalOpen:R=!1}=O??{};aG({disabled:R,modalRef:c,onCancel:()=>a.endExperience(),onDiscard:()=>{l({type:"update context",context:{configItem:w,userInput:k||"",userADFInput:x}}),l({type:"enable discard"})}});let D=e(g).useRef(void 0),L=(0,g.useCallback)(({configItem:e,userInput:t,userADFInput:n})=>{l({type:"kickoff with command palette input",context:{parentPresetPromptLabel:N?M:"",configItem:e,userInput:t,userADFInput:n}})},[N,M,l]),F=(0,g.useCallback)((e,{presetPromptLabel:t}={})=>{P({type:"onPartialPresetSelected",configItem:e,presetPromptLabel:t??J(e,d)}),D.current?.()},[P,d]),G=(0,g.useCallback)(e=>{if(e.agent?.creatorType!=="CUSTOMER")return e.agent?.creatorType==="SYSTEM"?e.agent?.name:e.promptLabel?d(e.promptLabel):void 0},[d]),B=tQ({stepName:"prompt",attributes:{experienceName:w.key,featureId:w.featureId,promptTitle:G(w),promptType:"generate",usingCommandPalette:!0,retryPromptCount:t.retryPromptCount,editCount:_}}),U=r5({editorPluginAIProvider:o}),V=(0,g.useCallback)(e=>{B.updateCommonAttributes({backendModel:e?.getBackendModel?.(!!S),...B.getUserFlowCommonAttributes(e)});let t={experienceName:e.key,featureId:e.featureId,promptTitle:G(e)};if((0,i("dh538").fg)("platform_editor_ai_prompt_input_statistics")){let e={},n=0;x&&(t.inputNodeCount=(0,i("1A9t2").reduce)(x,(e,t)=>("text"===t.type&&(n+=(t.text??"").length),e[t.type]=(e[t.type]??0)+1,t?.marks?.forEach(t=>{e[t.type]=(e[t.type]??0)+1}),e),{}),t.characterCount=n)}B.addAttributes(t)},[B,S,G,x]),j=(0,g.useCallback)(e=>{P({type:"onTextEntered",input:e})},[P]),H=e(g).useCallback(e=>{P({type:"onADFEntered",adf:e})},[P]),z=(0,g.useCallback)(({configItem:e}={})=>{N||(A(e?.agent?"rovo":"atlassian-intelligence"),L({configItem:e||v.configItem,userInput:v.textInput||"",userADFInput:v.adfInput}))},[N,L,v.configItem,v.textInput,v.adfInput,A]),K=(0,g.useMemo)(()=>()=>q({configItemWithOptions:o.configItemWithOptions,editorView:I,positions:y,isEmpty:E}),[I,y,E,o.configItemWithOptions]),Y=(0,g.useCallback)(({configItem:e,promptLabel:t})=>{if(void 0!==e.promptLabel&&!e.agent||t===aA||t===aT||t===aC||t===aP){let e=I.state.tr;e.setMeta("hideSelectionPreview",!0),I.dispatch(e);return}let n=I.state.tr;n.setMeta("showSelectionPreview",!0),I.dispatch(n)},[I]),Q=(0,g.useCallback)(e=>{let t=(0,i("caRYB").doc)((0,i("2FFuS").paragraph)(e));Y({configItem:w}),V(w),F(w,{presetPromptLabel:`@${w.agent.name}`}),L({userInput:e,configItem:w,userADFInput:t})},[Y,V,F,L,w]);(0,g.useEffect)(()=>{if(n&&!T){if(w.agent)Q(n);else if(!t.latestPrompt){let e=(0,i("caRYB").doc)((0,i("2FFuS").paragraph)(n));H(e),j(n),C(!0),L({userInput:n,configItem:w,userADFInput:e})}C(!0)}},[n,Q,T,w,t.latestPrompt,H,j,L]);let{starters:X}=function({handleHighlight:t,configItem:n,onConversationStarterSelected:a,product:r,editorPluginAIProvider:o}){let s;n.silentAgentPrompt||(s=n.agent);let{formatMessage:l}=(0,i("8C5kA").default)(),c=(0,g.useMemo)(()=>o?.getChannelVariables?.("rovo-agent")?.cloudId||"",[o]),[d,p]=(0,g.useState)(!1),u=(0,i("4SGh1").useFireAIAnalyticsEvent)(),m=tJ(),[f,h]=(0,g.useState)(""),_=m.getAiLifeCycleDynamicAttributes,y=(0,g.useMemo)(()=>s?s.conversationStarters.filter(e=>"user-defined"===e.type):[],[s]),I=i$(),E=(0,g.useCallback)(()=>{p(!1);let t=e(eI)();h(t),u({payload:(0,i("ilIeg").createUnifiedAnalyticsPayload)({action:i("d925B").ACTION.INITIATED,interactionID:t,experienceName:oW,isProactive:!1,invokedFrom:I.lastTriggeredFrom,attributes:_?.({init:!0})})})},[I.lastTriggeredFrom,u,_]),S=(0,g.useCallback)(e=>{p(!0),u({payload:(0,i("ilIeg").createUnifiedAnalyticsPayload)({action:i("d925B").ACTION.ERROR,interactionID:f,experienceName:oW,isProactive:!1,invokedFrom:I.lastTriggeredFrom,attributes:{aiErrorMessage:e.message,aiErrorCode:500,..._?.({init:!1})}})})},[I.lastTriggeredFrom,u,f,_]),{getDynamicContextualStarters:b,starters:T,isMutating:C}=(0,i("CV9x9").useContextualConversationStarters)({onInit:E,onError:S,assistanceServiceParams:{touchpointSource:"editor-ai-conversation-starters",product:(0,i("8klLr").mapToAssistanceServiceProduct)(r),experienceId:"ai-mate",siteId:c}}),A=(0,g.useMemo)(()=>C||T.some(e=>!e)&&y.length<3,[C,T,y]);(0,g.useEffect)(()=>{s&&y.length<3&&b({locationUrl:window.location.href,fallbackStarters:s.conversationStarters.map(e=>("string"!=typeof e.message&&(e.message=l(e.message)),e))})},[s,b,l,y]);let v=(0,g.useMemo)(()=>{if(!s)return[];let r=y;if(A)return oK(s,3);if(r.length<3){let e=T.filter(e=>null!==e).slice(0,3-r.length);r=[...r,...e]}return r.map(({message:r},o)=>{let c="string"==typeof r?r:l(r);return{value:`agent:${s.id}:${o}:${c}`,label:c,icon:e(g).createElement(i("hezkK").AgentAvatar,{agentId:s.id,agentNamedId:s.externalConfigReference??s.namedId,agentIdentityAccountId:s.identityAccountId,isForgeAgent:"FORGE"===s.creatorType,forgeAgentIconUrl:s.icon}),groupHeading:"",onSelect:()=>{a(c)},onSuggestionFocused:()=>{t({configItem:n})},...(0,i("dh538").fg)("ai-smart-button-team-25")&&{isAgent:!0}}})},[s,A,y,T,l,a,t,n]);return(0,g.useEffect)(()=>{A||d||!v.length||u({payload:(0,i("ilIeg").createUnifiedAnalyticsPayload)({action:i("d925B").ACTION.VIEWED,interactionID:f,experienceName:oW,isProactive:!1,invokedFrom:I.lastTriggeredFrom,attributes:_?.({init:!0})})})},[I.lastTriggeredFrom,A,d,v,u,f,_]),{starters:v}}({handleHighlight:Y,configItem:w,onConversationStarterSelected:Q,product:o.product,editorPluginAIProvider:o}),Z=(0,g.useCallback)((t,n)=>{if(M&&!w.nestingConfig&&!n)return[];function a(e){let t=(0,i("ljZgt").createAgentConfigItem)(e,o);return{testId:aC,value:aC,label:d(n1.useRovoOrganisationKnowledgeLabel),groupHeading:d(n1.knowledgeSourceGroupHeading),rightText:d(n1.useRovoOrganisationKnowledgeRightText),hideIcon:!0,onSelect:()=>{Y({configItem:t}),V(t),z({configItem:t})},onSuggestionFocused:()=>{Y({configItem:t,promptLabel:aC})}}}let r=t.trim().split(" ").length>3;function s(){let e=Z(k||"").filter(e=>e.isAgent).length;return 0===e?d(n1.rovoAgentsSuggestionGroupHeading):r?d(n1.useRovoAgentsCountSuggestionGroupHeading,{numberOfAgents:e.toString()}):d(n1.rovoAgentsCountSuggestionGroupHeading,{numberOfAgents:e.toString()})}let l=b.showRovoAgentsInCommandPalette&&O?.enabled&&O?.defaultAgent&&b.getChannelVariables&&!n&&!M,c=n&&!w.silentAgentPrompt?av:aA,p={value:c,label:t,hideIcon:!0,onSelect:()=>{Y({configItem:w}),V(w),z()},onSuggestionFocused:()=>{Y({configItem:w,promptLabel:c})}},u=O?.enabled&&O?.defaultAgent&&b.getChannelVariables?a(O.defaultAgent):p;u.value=c,u.label=t;let m=!t||N?[]:l?function(){let e=b.showRovoAgentsInCommandPalette&&O?.enabled&&O?.defaultAgent&&b.getChannelVariables&&!n?[a(O.defaultAgent)]:[],t=W({isEmpty:E,configItem:w});if(U&&!w.agent&&!t.find(e=>"generic-chat"===e.type)){let e=(0,i("jAwX6").createContinueInChat)({appearance:"secondary",product:o.product,actionSideEffect:o.actionSideEffects?.continueInChat,factoryOptions:{product:o.product,isInDocumentStreamingEnabled:o.isInDocumentStreamingEnabled}});t.unshift(e)}return[{testId:aT,value:aT,label:d(n1.useGeneralAiKnowledgeLabel),groupHeading:d(n1.knowledgeSourceGroupHeading),rightText:d(n1.useGeneralAiKnowledgeRightText),hideIcon:!0,onSelect:()=>{Y({configItem:w}),V(w),z()},onSuggestionFocused:()=>{Y({configItem:w,promptLabel:aT})}},...e]}():[p],f=d(n1.showMoreButton),h=[{value:"show-more",label:f,icon:e(g).createElement(e(i("9VJDA")),{spacing:"spacious",label:f}),onSelect:()=>{Y({configItem:w}),V(w)},onSuggestionFocused:()=>{Y({configItem:w,promptLabel:f})}}],_=b.showRovoAgentsInCommandPalette&&O?.enabled&&b.getChannelVariables&&!n?{value:aP,label:d(n1.agentsBrowseMore),icon:e(g).createElement(e(i("hge3g")),{label:"browse-more-agents"}),groupHeading:s,onSelect:()=>{(0,i("eIhC8").openBrowseAgentsModal)(!0,y)(I.state,I.dispatch)},onSuggestionFocused:()=>{Y({configItem:w,promptLabel:aP})}}:[];if(n&&!w.silentAgentPrompt)return X.filter(e=>"string"!=typeof e.label).length?X:X.filter(e=>e.label.toLowerCase().includes((t||"").toLowerCase()));let S=K({inputValue:t}).map(e=>{let n=e.icon?.({formatMessage:d});e.nestingConfig&&e.nestingConfig.icon&&!M&&!t&&(n=e.nestingConfig.icon?.({formatMessage:d}));let a=W({isEmpty:E,configItem:e});if(U&&!e.agent&&!a.find(e=>"generic-chat"===e.type)){let e=(0,i("jAwX6").createContinueInChat)({appearance:"secondary",product:o.product,actionSideEffect:o.actionSideEffects?.continueInChat,factoryOptions:{product:o.product,isInDocumentStreamingEnabled:o.isInDocumentStreamingEnabled}});a.unshift(e)}return{icon:n,label:e.nestingConfig&&M?d(e.nestingConfig.shortTitle):$(e,d),statusLozengeType:e.statusLozengeType,value:e.key,nestingConfig:e.nestingConfig?{parentTestId:e.nestingConfig.parentTestId,parentTitle:d(e.nestingConfig.parentTitle)}:void 0,onSuggestionFocused:()=>{Y({configItem:e})},onSelect:()=>{!e.nestingConfig||M||t?(Y({configItem:e}),V(e),e.promptLabel?F(e):L({userInput:"",userADFInput:void 0,configItem:e})):F(e,{presetPromptLabel:d(e.nestingConfig.parentTitle)})}}}).concat(h).concat(!n?m:[]).concat(!b.showRovoAgentsInCommandPalette||!O?.enabled||!b.getChannelVariables||n?[]:O.agents.map(n=>{let a=(0,i("ljZgt").createAgentConfigItem)(n,o);return{value:`agent:${n.id}`,label:n.name,description:n.description??"",icon:e(g).createElement(e(g).Fragment,null,o.isRovoEnabled&&e(g).createElement(iW,null),e(g).createElement(i("hezkK").AgentAvatar,{agentId:n.id,agentNamedId:n.externalConfigReference??n.namedId,agentIdentityAccountId:n.identityAccountId,isForgeAgent:"FORGE"===n.creatorType,forgeAgentIconUrl:n.icon})),groupHeading:s,isAgent:!0,onSelect:()=>{Y({configItem:a}),V(a),F(a,{presetPromptLabel:`@${a.agent.name}`}),r&&L({userInput:t,userADFInput:void 0,configItem:a})},onSuggestionFocused:()=>{Y({configItem:a})}}})).concat(n?m:[]).filter(e=>{if(!e||"string"!=typeof e.label)return!1;if(e.value===aT||e.value===aC)return!0;if(N&&e.nestingConfig?.parentTitle!==M)return!1;if(e?.isAgent&&r)return!0;let n=[e.label.toLowerCase()];return n.push((e.description??"").toLowerCase()),e?.isAgent&&n.push("rovo","agent"),n.join(" ").includes((t||"").toLowerCase())}).concat(!N?_:[]).map(e=>(e.groupHeading||(e.groupHeading=N&&w?.nestingConfig?.parentTitle?d(w.nestingConfig.parentTitle):(0,i("dh538").fg)("ai-smart-button-team-25")?d(n1.actionsGroupHeading):d(n1.atlassianIntelligenceGroupHeading)),e));return S.length?S:N?[{value:"no-suggestions",label:d(n1.noResultsSuggestion),hideIcon:!0,icon:void 0,onSelect:()=>{},onSuggestionFocused:()=>{}}]:[]},[M,w,O?.enabled,O?.defaultAgent,O?.agents,b.getChannelVariables,b.showRovoAgentsInCommandPalette,N,d,K,o,Y,V,z,k,y,I,E,X,F,L,U]),ee=function(e,t){let{stopMessage:n,startMessage:i}=function(){let{engagementPlatformApi:e}=i$();return e||{startMessage:()=>Promise.resolve(!1),stopMessage:()=>Promise.resolve(!1)}}(),[a,r]=(0,g.useState)(!1);(0,g.useEffect)(()=>{i(e).then(e=>{r(e)})},[e,i]);let o=(0,g.useCallback)(()=>{r(!1),n(e)},[e,n]);return(0,g.useMemo)(()=>{if(a)return{id:e,text:t,onClose:o}},[e,t,o,a])}("cc-editor-ai_ai-toolbar-button-pulse",d(n1.engagementBannerLinksText));(0,g.useEffect)(()=>{b.onAIProviderChanged&&b.onAIProviderChanged("command-palette",w.agent?{type:"rovo",agent:w.agent}:void 0)},[w.agent,b]);let et=(0,g.useCallback)(()=>{B.addAttributes({experienceName:u?.key,featureId:u?.featureId,promptTitle:u?J(u,d):""}),B.updateCommonAttributes({backendModel:u?.getBackendModel?.(!!S)}),P({type:"onPartialPresetRemoved"}),D.current?.()},[B,u,d,S,P]),en=(0,g.useCallback)(()=>{et(),j(""),H()},[et,j,H]),ei=oq({hasInput:!!(k||x),suggestions:Z(k||""),agentVisible:!!X.length,nestedMenuSelected:N});return e(g).createElement(e(g).Fragment,null,e(g).createElement(oV,{appearance:r,presetPromptLabel:M,inputValue:k||"",inputADFValue:x,onInputUpdate:j,onADFUpdate:H,onEscapeKeyPressed:()=>{s()},onSubmit:z,onRefinementTagRemove:et,onBack:en,placeholder:w.promptHint?d(w.promptHint):"",getSuggestions:Z,focusInputRef:D,PromptEditor:o.PromptEditor,agent:w.silentAgentPrompt?void 0:w.agent,hideLegacySubmitCancelButtons:N,announcementBanners:ee?[ee]:void 0,pageKnowledgeProps:ei}))}function oQ(t){let{api:n}=t,a=t.state,r=t.context,o=i$(),{formatMessage:s}=(0,i("8C5kA").default)(),l=(0,i("i25hX").usePublish)("ai-mate"),c=o.canInlineStreamChanges();e(g).useEffect(()=>{let e=o.sendToAIExperienceMachine;e&&"started state"===a&&e({type:"kick off"})},[a,o.sendToAIExperienceMachine]);let d=r?.configItem?.getBackendModel?.(!!r?.latestPromptResponse),p=tJ();e(g).useEffect(()=>{p.updateCommonAttributes({backendModel:d,channelId:r.channelId,...p.getUserFlowCommonAttributes(r.configItem),autoAcceptAIChanges:c,inlineStreamingAvailable:!1})},[p,d,r.channelId,r.configItem,c]);let u=r.aiLifeCycleDynamicAttributesGetter;if(e(g).useEffect(()=>{u&&p.registerAiLifeCycleDynamicAttributesGetter(u)},[p,u]),"started state"===a)return null;if(!("string"!=typeof a&&a["modal active state"]))throw Error("AI machine state is not: modal active state or modal error state");let m=a["modal active state"].experience;if((0,i("dh538").fg)("platform_editor_ai_handle_invalid_input")){if("object"==typeof m&&"error state"in m&&"active"===m["error state"]||"string"!=typeof m&&"error state"in m)return r.apiErrorInfo.failureReason===eN.NO_TEXTUAL_CONTENT?e(g).createElement(aI,{errorInfo:r.apiErrorInfo,contextStatistics:r.contextStatistics}):e(g).createElement(ay,{errorInfo:r.apiErrorInfo})}else if("object"==typeof m&&"error state"in m&&"active"===m["error state"])return e(g).createElement(ay,{errorInfo:r.apiErrorInfo});if("object"==typeof a["modal active state"]&&"active"===a["modal active state"].discard)return e(g).createElement(oy,{state:m,channelId:r.channelId,editCount:r.editCount,retryPromptCount:r.retryPromptCount,history:r.responseHistory,latestPrompt:r.latestPrompt,onceDiscard:r.onceDiscard,streamFlowPacer:t.streamFlowPacer,api:n});if("string"==typeof m&&"command palette state"===m)return e(g).createElement(oJ,{context:r,initialPrompt:t.initialPrompt});if("object"==typeof m&&"loading state"in m&&"loading"===m["loading state"]){let t=r.parentPresetPromptLabel&&r.configItem.nestingConfig?s(r.configItem.nestingConfig.shortTitle):"",n=i0({status:r?.loadingStatus,formatMessage:s});return e(g).createElement(e(g).Fragment,null,e(g).createElement(oI,{parentPresetPromptLabel:r.parentPresetPromptLabel,childShortTitle:t,title:n||s(n1.loadingTitle),markdown:r.markdown,adfResponse:r.adfResponse,latestPrompt:r.latestPrompt,promptTrigger:r.promptTrigger,refinementCount:r.refinementCount,latestPromptRetried:r.latestPromptRetried,idMap:r.idMap,contextStatistics:r.contextStatistics,hideLoadingScreen:o.hideLoadingScreen}),e(g).createElement(i9,{loadingStatus:r.loadingStatus}))}if("string"!=typeof m&&"review state"in m){let t=r.rovoActions?r.rovoActions[r.selectionType]:void 0;return e(g).createElement(a2,{aiExperienceMachineContext:r,isInputActive:"refinement"===m["review state"],backendModel:d,rovoAction:t,rovoPublish:l})}if(!(0,i("dh538").fg)("platform_editor_ai_handle_invalid_input")&&"string"!=typeof m&&"error state"in m)return e(g).createElement(ay,{errorInfo:r.apiErrorInfo});throw Error("unhandled state")}function oX(e){return e.isRovoEnabled&&e.useFreeGenerateEditorAgent}function oZ(t){let{api:n,editorView:a,endExperience:r}=t,o=(0,i("8C5kA").default)(),s=e(g).useRef(null),[l,c]=(0,g.useState)(),d=t.positions,p=d[0]===d[1],u=t.configItem,m=t.editorPluginAIProvider.baseGenerate;t.defaultAgent&&oX(t.editorPluginAIProvider)&&(m=iJ({agent:t.defaultAgent,product:t.editorPluginAIProvider.product,isInDocumentStreamingEnabled:t.editorPluginAIProvider.isInDocumentStreamingEnabled}),t.configItem.key===i("bwpRs").CONFIG_ITEM_KEYS.FREE_GENERATE&&(u=m));let f=(0,g.useRef)(!1),h=(0,g.useRef)(!0),_=i1(!1),y=tJ(),I=eX({fireAIAnalyticsEvent:(0,i("4SGh1").useFireAIAnalyticsEvent)(),aiInteractionID:y.getLastAiInteractionId(),streamFlowPacer:_.current}),{context:E,state:S,send:b}=iR({context:{analyticsContext:t.analyticsContext,aiProvider:t.editorPluginAIProvider,intl:o,editorView:t.editorView,positions:d,isEmpty:p,selectionType:p?"empty":"range",baseGenerate:m,configItem:u,aiLifeCycleDynamicAttributesGetter:t.editorPluginAIProvider?.aiLifeCycleDynamicAttributesGetter,markdown:"",latestPromptResponse:void 0,editCount:0,refinementCount:0,retryPromptCount:0,latestPromptRetried:!1,userInput:"",apiErrorInfo:{},responseHistory:{positionFromEnd:0,entries:[],totalSize:0,traversals:0},channelId:void 0,getMentionNameDetails:t.getMentionNameDetails,triggeredFor:t.triggeredFor,usePageKnowledge:!0,endExperience:t.endExperience,streamingHandler:I}});e(g).useEffect(()=>{if(t.defaultAgent&&oX(t.editorPluginAIProvider)){let e=iJ({agent:t.defaultAgent,product:t.editorPluginAIProvider.product,isInDocumentStreamingEnabled:t.editorPluginAIProvider.isInDocumentStreamingEnabled});b({type:"update baseGenerate and configItem",baseGenerate:e,configItem:e})}},[t.defaultAgent,t.editorPluginAIProvider,b]);let[T,C]=t.positions;e(g).useEffect(()=>{b({type:"update positions",positions:[T,C]})},[b,T,C]),function({editorView:e,cancelRovoPrompt:t}){(0,g.useEffect)(()=>{t&&(e.hasFocus()||e.focus())},[t,e])}({editorView:a,cancelRovoPrompt:l}),e(g).useEffect(()=>{if(!s.current)return;let e=s.current;if(e)return(0,i("fFa3V").bindAll)(e,[{type:"keydown",listener:function(e){if("Escape"!==e.key||"string"==typeof S||!("modal active state"in S))return;e.preventDefault(),e.stopPropagation();let t=S?.["modal active state"],n=t?.experience;if("object"==typeof n&&"loading state"in n&&"loading"===n["loading state"])t?.discard==="active"?b({type:"disable discard"}):b({type:"enable discard"});else{if(a5(E.promptTrigger,E.responseHistory))return void r();b({type:"escape"})}}},{type:"keyup",listener:function(e){"Escape"===e.key&&"string"!=typeof S&&"modal active state"in S&&(e.preventDefault(),e.stopPropagation())}}])},[s,S,b,E.promptTrigger,E.responseHistory,r,a,l,n]);let[A,v]=e(g).useState(!1);e(g).useEffect(()=>{(0,i("dh538").fg)("platform_editor_ai_scroll_into_view_fix")&&s.current&&(0,g.startTransition)(()=>{v(!0)})},[s]),e(g).useEffect(()=>{(0,i("dh538").fg)("platform_editor_ai_scroll_into_view_fix")&&s.current&&A&&s.current?.scrollIntoView({block:"nearest",behavior:"auto"})},[A,s]);let P=e(g).useMemo(()=>({appearance:t.appearance,configItem:E.configItem,editorPluginAIProvider:t.editorPluginAIProvider,endExperience:t.endExperience,lastTriggeredFrom:t.lastTriggeredFrom,providerFactory:t.providerFactory,editorView:t.editorView,positions:t.positions,triggerMethod:t.triggerMethod,triggeredFor:t.triggeredFor,sendToAIExperienceMachine:b,modalRef:s,isUserScroll:f,isProgrammaticScroll:h,engagementPlatformApi:t.engagementPlatformApi,includeKnowledgeFromCurrentPage:E.usePageKnowledge,canInlineStreamChanges:t.canInlineStreamChanges,hideLoadingScreen:t.hideLoadingScreen,setCancelRovoPrompt:c,aiSessionId:t.interactionSessionId}),[E.configItem,E.usePageKnowledge,t.editorView,t.editorPluginAIProvider,t.appearance,t.endExperience,t.lastTriggeredFrom,t.providerFactory,t.positions,t.triggerMethod,t.triggeredFor,t.engagementPlatformApi,t.canInlineStreamChanges,b,s,f,h,t.hideLoadingScreen,t.interactionSessionId]);return e(g).useEffect(()=>{y.updateCommonAttributes({traceIds:E.traceIds})},[y,E.traceIds]),e(g).createElement("div",{role:"dialog","aria-label":o.formatMessage(n1.dialogAriaLabel),ref:s},e(g).createElement(iY.Provider,{value:P},e(g).createElement(oQ,{api:n,state:S,context:E,initialPrompt:t.initialPrompt,modalRef:s,streamFlowPacer:_.current})))}function o0(t){let n=tq({invokeAttributes:{invokedFrom:t.lastTriggeredFrom,invokedFor:t.triggeredFor?t.triggeredFor.name:"text",triggerMethod:t.triggerMethod,experienceName:t.configItem.key,featureId:t.configItem.featureId,aiGroupId:t.aiGroupId,aiSessionId:t.interactionSessionId},canInlineStreamChanges:()=>!1,isInDocumentStreamingEnabled:!1});return e(g).useEffect(()=>{let e=(0,i("2pjJ5").isEmptyDocument)(t.editorView.state.doc);if(n.updateCommonAttributes({isInvokedFromEmptyPage:e,nudgeMetrics:t.nudgeMetrics}),t.initialPositions){let i=eF(t.editorView,t.initialPositions);n.updateCommonAttributes({isInvokedFromEmptyPage:e,selectionCategory:i})}},[n,t.editorView,t.initialPositions,t.nudgeMetrics]),e(g).useEffect(()=>()=>{window.requestAnimationFrame(()=>{n.fireQueuedStep()})},[n]),e(g).useEffect(()=>()=>{let e=t.editorView.state.tr;e.setMeta("hideSelectionPreview",!0),t.editorView.dispatch(e)},[t.editorView]),e(g).createElement(i4,{onCloseFallback:()=>{t.endExperience()}},e(g).createElement(t$,{value:n},e(g).createElement(i("hnvzE").default,{name:"EditorAICommandPalette"},e(g).createElement(oZ,{...t,analyticsContext:{aiSessionId:n.aiSessionId,aiGroupId:t.aiGroupId??n.aiSessionId}}))))}let o1=t=>{let n=(0,i("4SGh1").useFireAIAnalyticsEvent)(),{formatMessage:a}=(0,i("8C5kA").default)();return e(g).createElement(o5,{...t,fireAIAnalyticsEvent:n,formatMessage:a})};class o5 extends e(g).Component{shouldRecover(){return this.state.errorCaptured}componentDidCatch(e,t){if((0,i("hWRJP").logException)(e,{location:"editor-plugin-ai-error-boundary"}),e.name===i5){let n="type"in e?e.type:void 0;this.props.fireAIAnalyticsEvent({payload:{action:"unhandledErrorCaught",actionSubject:"editorPluginAI",actionSubjectId:"experienceApplication",attributes:{componentStack:t.componentStack||"",errorType:"markdownToProseMirrorError",errorSubType:n,errorMessage:i("2QlXt").ErrorUtils.extractErrorMessage(e)},eventType:i("d925B").EVENT_TYPE.OPERATIONAL}}),this.setState({errorCaptured:!0,fallbackMessage:this.getFallbackMessage(i("7ShCl").aiMessages.markdownErrorMessage)})}else this.props.fireAIAnalyticsEvent({payload:{action:"unhandledErrorCaught",actionSubject:"editorPluginAI",actionSubjectId:"experienceApplication",attributes:{componentStack:t.componentStack||"",errorMessage:i("2QlXt").ErrorUtils.extractErrorMessage(e)},eventType:i("d925B").EVENT_TYPE.OPERATIONAL}}),this.setState({errorCaptured:!0,fallbackMessage:this.getFallbackMessage(i("7ShCl").aiMessages.unhandledErrorMessage)})}render(){return this.shouldRecover()?e(g).createElement(i("f02sP").UnhandledErrorScreen,{text:this.state.fallbackMessage,onCancel:this.props.onCloseFallback}):this.props.children}constructor(...e){super(...e),this.getFallbackMessage=e=>this.props.formatMessage(e),this.state={errorCaptured:!1,fallbackMessage:this.getFallbackMessage(i("7ShCl").aiMessages.unhandledErrorMessage)}}}let o2=Math.min(500,Math.max(402,i("aFUXX").akEditorFloatingPanelZIndex+2)),o8=e=>e?.dom.querySelector(".ai-modal-end-widget")||e?.dom.querySelector(".ai-selection-node"),o4=({children:t,decoration:n,editorView:a,editorRelativeWrapper:r,appearance:o,endExperience:s,lastTriggeredFrom:l,decorationSet:c,autoScroll:d})=>{let p=a.dom,u=(0,g.useRef)(null),[m,f]=(0,g.useState)(0),[h,_]=(0,g.useState)(0),[y,I]=(0,g.useState)(0),[E,S]=(0,g.useState)(""),b=(0,g.useRef)(null),T=(0,g.useMemo)(()=>rY(a,n.to),[a,n]),C=o8(a);if((0,g.useEffect)(()=>{if("comment"===o){let e=null;if(r?e=r.querySelector(".ak-editor-content-area"):C&&(e=C.closest(".ak-editor-content-area")),e){let t=getComputedStyle(e),n="none"!==t.maxHeight,i=t.position;return n&&(e.style.position="relative"),()=>{n&&e&&(e.style.position=i)}}}},[C,o,r]),(0,g.useEffect)(()=>{let t=()=>{if(!u.current||!C||!C.offsetParent)return;let e=p;if(T&&!p.contains(T))return;e=T||p;let t=rq({appearance:o,modalElement:u.current,editorRelativeWrapper:r,modalDecorationElement:C,lastTriggeredFrom:l,editorView:a});f(rW({relativePositionElement:e,modalElement:u.current})),_(t),I(e.offsetWidth),E||S("all 0.1s ease-in")};t();let n=e(eo)(()=>{t()},20),i=new ResizeObserver(n);i.observe(p);let s=p.offsetParent;return s&&i.observe(s),T&&i.observe(T),()=>{i.disconnect(),n.cancel()}},[p,C,r,T]),(0,g.useEffect)(()=>{if(u.current&&!b.current){let e=(0,i("7YjFd").findOverflowScrollParent)(u.current)||null;e&&(b.current=e)}},[]),(0,g.useEffect)(()=>{if(!d||!h)return;let e=u.current;if(!e||!C)return;if(!b.current){let t=(0,i("7YjFd").findOverflowScrollParent)(e)||null;if(!t)return;b.current=t}let t=b.current.scrollTop,n=b.current.scrollTop+(b.current.offsetHeight-32),a=Math.max(0,h-C.offsetHeight),r=h+e.offsetHeight,o=b.current.offsetHeight-32<e.scrollHeight;if(!(a>=t&&r<=n)){if(o||a<t)return void b.current.scroll({top:Math.max(0,a-32),behavior:"instant"});b.current.scroll({top:t+Math.max(r-n,0)+32,behavior:"instant"})}},[d,h,C]),rH({modalElement:u.current,editorViewElement:p,isInDocumentStreamingEnabled:!1}),c===i("ftzrq").DecorationSet.empty)return s(),null;let A={top:h,transition:E,left:m,"--content-width":`${y}px`,display:y?"block":"none"};return g.createElement("div",{className:(0,i("gMc0m").default)(["_19pkpxbi _kqswstnw _1pby1kbs _2hwxmgjw _18u0mgjw _1bsbxj84 _j7hq1w10 _5sagfnf5 _1pgl6ui8 _1o51q7pw _ta6yglyw","ak-editor-plugin-ai-modal"]),"data-testid":"ai-plugin-modal",ref:u,"data-editor-popup":!0,style:{...A,"--_1dsp0pi":(0,i("7sObp").default)(o2)}},t)},o3=()=>{let{aiOptIn:t,editorPluginAIProvider:n,editorView:a,api:r,wrapperElement:o,appearance:s,providerFactory:l,getMentionNameDetails:c,canInlineStreamChanges:d,isRovoLoading:p}=nD(),u=(0,i("eiA8Z").useSharedPluginStateWithSelector)(r,["aiExperience"],e=>e.aiExperienceState?.aiDecorationExperiencePluginState),m=!u||u.modalDecorationSet===i("ftzrq").DecorationSet.empty,f=(0,i("eiA8Z").useSharedPluginStateWithSelector)(r,["aiExperience"],e=>e.aiExperienceState?.rovoAgentsPluginState),h=i("3yUTv").aiExperienceDecorationPluginKey.getState(a.state),_=(0,i("8C5kA").default)(),y=(0,g.useCallback)(e=>{n.onAIProviderChanged&&n.onAIProviderChanged("command-palette");let t=(0,i("kqrrC").getPluginState)(a.state),r=(0,i("56Rej").hasGeneratedContentDecorations)(t)||e?.preserveEditorSelectionOnComplete?t.modalDecorationSet:void 0;(0,i("5SuLc").createEndAIExperienceCommand)(r,e?.preserveEditorSelectionOnComplete,e?.shouldClearSelectionContext)(a.state,a.dispatch),a.focus()},[a,n]),{send:I,state:E,context:S}=iR({context:{analyticsContext:{aiSessionId:"",aiGroupId:""},aiProvider:n,intl:_,editorView:a,positions:[0,0],isEmpty:!0,selectionType:"empty",configItem:n?.baseGenerate,markdown:"",latestPromptResponse:void 0,editCount:0,refinementCount:0,retryPromptCount:0,latestPromptRetried:!1,userInput:"",apiErrorInfo:{},responseHistory:{positionFromEnd:0,entries:[],totalSize:0,traversals:0},channelId:void 0,usePageKnowledge:!0,endExperience:y}}),b=!p&&"object"==typeof E&&"command palette state"===E["modal active state"].experience,T=e(g).createElement(ot,{editorApi:r,positions:eL({modalDecorationSet:u?.modalDecorationSet}),editorView:a,product:n.product,onDocChangeByAgent:n.onDocChangeByAgent,onAIProviderChanged:n.onAIProviderChanged,editorPluginAIProvider:n});return e(g).createElement(e(g).Fragment,null,e(g).createElement(r2,{editorView:a,editorPluginAIProvider:n},e(g).createElement(r0,{editorView:a,getMentionNameDetails:c,editorPluginAIProvider:n,editorApi:r}),e(g).createElement(iz,{editorPluginAIProvider:n,editorView:a}),T),e(g).createElement(o1,{inContentComponent:!0,onCloseFallback:y},(()=>{let t;if(m||(0,i("56Rej").hasGeneratedContentDecorations)(u))return null;let p=u.modalDecorationSet.find(void 0,void 0,e=>"inlineDecoration"===e.key).shift()||u.modalDecorationSet.find(void 0,void 0,e=>"startWidgetDecoration"===e.key||"endWidgetDecoration"===e.key).shift();if(p){if(!u?.initialPositions)return null;t=u?.initialPositions}else{let e=u.modalDecorationSet.find(void 0,void 0,e=>"ai-nodeDecoration"===e.key);e.length>0&&(t=[Math.min(...e.map(e=>e.from)),Math.max(...e.map(e=>e.to))]),p=e.shift()}return p?e(g).createElement(o4,{isDirectionalPinningEnabled:b,lastTriggeredFrom:u.lastTriggeredFrom,key:u.modalMountedTimeStamp,decoration:p,editorView:a,editorRelativeWrapper:o?.offsetParent,endExperience:y,appearance:s,decorationSet:u.modalDecorationSet},u.configItem&&a&&e(g).createElement(o0,{api:r,context:S,send:I,state:E,configItem:u.configItem,editorPluginAIProvider:n,endExperience:y,positions:t,editorView:a,providerFactory:l,lastTriggeredFrom:u.lastTriggeredFrom,triggerMethod:u.triggerMethod,appearance:s,initialPrompt:u?.initialPrompt,getMentionNameDetails:c,triggeredFor:u.triggeredFor,engagementPlatformApi:r?.engagementPlatform?.actions,initialPositions:u?.initialPositions,nudgeMetrics:u.nudgeMetrics,defaultAgent:f?.defaultAgent,canInlineStreamChanges:d,hideLoadingScreen:h?.hideLoadingScreen,aiGroupId:u?.currentSessionId,interactionSessionId:u?.interactionSessionId})):null})(),f?.isBrowseModalOpen&&e(g).createElement(iK,{editorView:a,aiGlobalOptIn:t,editorPluginAIProvider:n,startingConfig:u?.configItem,positions:f?.positions})))},o9=e=>{let t=(0,i("eiA8Z").useSharedPluginStateWithSelector)(e.api,["aiExperience"],e=>e.aiExperienceState?.aiDecorationExperiencePluginState),n=t?.modalMountedTimeStamp,[a,r]=(0,g.useState)(!1);return g.createElement(oh,null,g.createElement(nR,{value:{...e,isRovoLoading:a,setIsRovoLoading:r}},g.createElement(o3,{key:n})))};i("42omo");let o6=({label:t,testId:n,color:a,shouldRecommendSmallIcon:r,spacing:o})=>(0,n5.jsx)(e(i("6R5uz")),{label:t,testId:n,color:a,shouldRecommendSmallIcon:r,spacing:o,size:"small"}),o7=()=>e(g).createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},e(g).createElement("path",{d:"M15 6H9C8.44772 6 8 6.44772 8 7C8 7.55228 8.44772 8 9 8H15C15.5523 8 16 7.55228 16 7C16 6.44772 15.5523 6 15 6Z"}),e(g).createElement("path",{d:"M15 9H9C8.44772 9 8 9.44772 8 10C8 10.5523 8.44772 11 9 11H15C15.5523 11 16 10.5523 16 10C16 9.44772 15.5523 9 15 9Z"}),e(g).createElement("path",{d:"M11 12H9C8.44772 12 8 12.4477 8 13C8 13.5523 8.44772 14 9 14H11C11.5523 14 12 13.5523 12 13C12 12.4477 11.5523 12 11 12Z"}),e(g).createElement("path",{d:"M7 4V20H17V4H7ZM5 3.99C5 2.892 5.897 2 7.006 2H16.994C18.102 2 19 2.898 19 3.99V20.01C19 21.109 18.103 22 16.994 22H7.006C6.4765 22.0008 5.96822 21.7919 5.59231 21.419C5.21639 21.0461 5.00344 20.5395 5 20.01V3.99Z"})),se=e=>{switch(e){case"bug":return"Bug";case"story":return"Story";case"epic":return"Epic";default:return"Task"}},st=t=>({key:i("bwpRs").CONFIG_ITEM_KEYS.ADD_STRUCTURE,title:i("AMCQl").aiConfigItemMessages.improveDescription,description:i("AMCQl").aiConfigItemMessages.reformatWithTemplateDescription,icon:({formatMessage:n})=>t.isInDocumentStreamingEnabled?e(g).createElement(e(i("lW0cT")),{label:n(i("AMCQl").aiConfigItemMessages.improveDescription),size:"small"}):e(g).createElement(o7,null),endpoint:i("klIiV").jiraIssueReformatterApiURL,experienceId:"issue-reformatter",intentSchemaId:"issue_reformatter_intent_schema.json",featureId:"issue_reformatter",alwaysNeedDoc:!0,getRequestPayload:({locale:e,doc:n})=>{let{issue_summary:i,project_id:a,issue_type_label:r,linked_urls:o}=t.getAdditionalProps?.();return{ai_feature_input:{source:"JIRA",locale:e,context:{project_id:a,summary:i,description:n,...{links:o}??[]},response_type:"NO_SCHEMA",suggested_issues_config:{use_template:!0,max_issues:1,suggested_issue_field_types:[{issue_type:se(r),fields:[{field_name:"Description",field_type:"Paragraph"}]}]}}}},actions:{empty:[(0,i("jc4DP").createInsertBelow)({appearance:"secondary",factoryOptions:t}),(0,i("jc4DP").createReplace)({appearance:"primary"})],selection:[(0,i("jc4DP").createInsertBelow)({appearance:"secondary",factoryOptions:t}),(0,i("jc4DP").createReplace)({appearance:"primary"})]},getBackendModel:()=>"assistance-service"}),sn=(0,i("dTb09").conditionalHooksFactory)(()=>(0,td.expValEquals)("platform_editor_toolbar_aifc_patch_3","isEnabled",!0),e=>{let{editorViewMode:t}=(0,i("gzUv9").useEditorToolbar)();return{editorViewMode:t}},e=>{let{mode:t}=(0,i("eiA8Z").useSharedPluginStateWithSelector)(e,["editorViewMode"],e=>({mode:e.editorViewModeState?.mode}));return{editorViewMode:t}}),si=({api:t,children:n,hasSeparator:a})=>{let{editorViewMode:r}=sn(t);return"edit"!==r&&void 0!==r?null:e(g).createElement(i("48SU7").ToolbarSection,{hasSeparator:a},n)},sa=({api:t,children:n,hasSeparator:a})=>{let{editorViewMode:r}=sn(t);return"view"!==r?null:e(g).createElement(i("48SU7").ToolbarSection,{hasSeparator:a},n)},sr=({api:e,state:t,enabled:n,actionSubjectId:a})=>{(0,g.useEffect)(()=>{if(!n||!t)return;let{charCount:r,wordCount:o}=(0,i("4SGh1").selectionCharWordCount)(t);(0,i("4SGh1").fireButtonViewedAnalyticsEvent)({api:e,actionSubjectId:a,attributes:{selectionCharCount:r,selectionWordCount:o}})},[a,e,n,t])},so={container:"_d4lfxy5q"},ss=({isNewToolbarEnabled:t,isInDocumentStreamingEnabled:n,children:a})=>!t&&n?e(g).createElement(i("u9agA").default,{xcss:so.container},a):a,sl=({api:t,children:n,editorAppearance:a,hasSeparator:r=!1})=>{let{editorAppearance:o}=(0,i("gzUv9").useEditorToolbar)();return o!==a?null:e(g).createElement(si,{api:t,hasSeparator:r?i("48SU7").SeparatorPosition.END:void 0},n)},sc=e=>{let{disabled:t}=(0,i("eiA8Z").useSharedPluginStateWithSelector)(e,["connectivity"],({connectivityState:e})=>(0,m.editorExperiment)("platform_editor_offline_editing_web",!0)?{disabled:(0,i("91bcx").isOfflineMode)(e?.mode)}:{disabled:!1});return t},sd=({aiGlobalOptIn:t,isNewToolbarEnabled:n,editorPluginAIProvider:{baseGenerate:a,isInDocumentStreamingEnabled:r},isDisabled:o,parents:s,api:l})=>{let{formatMessage:c,locale:d}=(0,i("8C5kA").default)(),p=sc(l),{editorView:u,editorAppearance:f}=(0,i("gzUv9").useEditorToolbar)(),h=s.some(e=>e.key===i("cPCP8").ROVO_GROUP_DISPLAY_SMALL.key);sr({api:l,state:u?.state,enabled:r&&!h,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.AI_ASK_ROVO_BUTTON});let _=((0,td.expValEquals)("platform_editor_hydratable_ui","isEnabled",!0)?(0,i("d7ZU3").getBrowserInfo)():i("d7ZU3").browser).mac?"⌘":"Ctrl",y=s.at(0)?.key===i("cPCP8").TOOLBARS.PRIMARY_TOOLBAR,I="";return y?"full-page"===f&&r&&(I=c(i("SFzFl").default.aiUniversalShortCallToAction)):I=c(i("7ShCl").aiMessages.askRovoToolbarIconTitle),e(g).createElement(ss,{isNewToolbarEnabled:n,isInDocumentStreamingEnabled:r},e(g).createElement(i("iIVVb").ToolbarTooltip,{content:(0,m.editorExperiment)("platform_editor_ai_quickstart_command",!0)?c(i("7ShCl").aiMessages.askRovoToolbarIconTooltipQuickCommand,{key:_}):c(i("7ShCl").aiMessages.askRovoToolbarIconTitle)},e(g).createElement(i("7ERUE").ToolbarButton,{iconBefore:e(g).createElement(i("9J8UT").AIChatIcon,{label:c(i("7ShCl").aiMessages.askRovoToolbarIconTitle)}),testId:"editor-toolbar__ask-rovo",isDisabled:(0,i("dh538").fg)("platform_editor_toolbar_aifc_patch_8")?p:o,onClick:e=>{if(!u)return;let n=e?.nativeEvent?.detail===0;l?.analytics?.actions.fireAnalyticsEvent({action:i("d925B").ACTION.CLICKED,actionSubject:i("d925B").ACTION_SUBJECT.BUTTON,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.AI_ASK_ROVO_BUTTON,eventType:i("d925B").EVENT_TYPE.UI,attributes:{inputMethod:(0,i("4Dsx2").getInputMethodFromParentKeys)(s)}}),(0,i("5SuLc").createOpenAIModalCommand)({state:u.state,configItem:a,lastTriggeredFrom:y?"mainToolbar":"floatingToolbar",triggerMethod:n?"keyboard":"click",aiGlobalOptIn:t,locale:d})(u.state,u.dispatch)}},I)))},sp=({api:t,editorPluginAIProvider:n})=>{let a=(0,i("i25hX").usePublish)("ai-mate"),{editorView:r}=(0,i("gzUv9").useEditorToolbar)(),{product:o}=n,s=(0,i("b4emg").getEmptyADF)(),l=i("5SAOw").Fragment.from(r?.state.selection.content().content);if(l){let e=i("iyDxB").defaultSchema.nodes.doc.create({},l);s=new(0,i("h9yJL").JSONTransformer)().encode(e)}return e(g).createElement(i("abUsF").RovoChatHighlightActions,{selectedContent:s,product:o.toLowerCase(),onClickChat:()=>{if(r?.dispatch){let e=r.state.tr;e.setSelection(i("ks2lK").TextSelection.create(r.state.doc,Math.min(r.state.selection.to,r.state.doc.content.size))),r.dispatch(e)}t?.core.actions.blur(),a({type:"chat-new",source:"editor",product:o,data:{dialogues:[]}})}})},su=({api:t})=>{let{formatMessage:n}=(0,i("8C5kA").default)(),{editorView:a}=(0,i("gzUv9").useEditorToolbar)(),r=(0,i("eiA8Z").useSharedPluginStateWithSelector)(t,["aiExperience"],e=>e.aiExperienceState?.aiDecorationExperiencePluginState.isInDocumentStreamingEnabled);return sr({api:t,state:a?.state,enabled:r,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.AI_DEFINITIONS_DEFINE_BUTTON}),e(g).createElement(i("iIVVb").ToolbarTooltip,{content:n(i("7ShCl").aiMessages.DefineDropdownIconTitle)},e(g).createElement(i("7ERUE").ToolbarButton,{isDisabled:t?.aiDefinitions?.actions.selectionExceedsMaxWordCount()||!1,iconBefore:e(g).createElement(e(i("8tSmd")),{label:"",size:"small"}),onClick:()=>{t?.aiDefinitions?.actions.openReadingAidsPopup()}},n(i("7ShCl").aiMessages.DefineDropdownIconTitle)))},sg=({aiGlobalOptIn:t,isDisabled:n,parents:a,api:r,heroConfigItem:o})=>{let{formatMessage:s,locale:l}=(0,i("8C5kA").default)(),{editorView:c}=(0,i("gzUv9").useEditorToolbar)(),d=sc(r),p=(0,i("eiA8Z").useSharedPluginStateWithSelector)(r,["aiExperience"],e=>e.aiExperienceState?.hasVisibleContent),u=(0,i("eiA8Z").useSharedPluginStateWithSelector)(r,["aiExperience"],e=>e.aiExperienceState?.aiDecorationExperiencePluginState.isInDocumentStreamingEnabled);sr({api:r,state:c?.state,enabled:u,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.AI_HERO_PROMPT_BUTTON});let m=o.config,f=s(m.title),h=m.key.toLowerCase().split("_").join("-").split(" ").join("-"),_=`editor-toolbar__${h}`,y=0===o.triggers.empty.docMinSize&&o.triggers.empty.enabled,I=o.config.key===i("bwpRs").CONFIG_ITEM_KEYS.SUGGEST_RESPONSE&&(0,i("dh538").fg)("draft_reply_contextual_pills_gate"),E=(0,i("dh538").fg)("platform_editor_toolbar_aifc_patch_8")?d:n,S=E||!p;(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")&&(S=E||!p&&!y),I&&(S=E||!!p);let b=a.at(0)?.key===i("cPCP8").TOOLBARS.PRIMARY_TOOLBAR,T=m.icon?m.icon({formatMessage:s}):null;return e(g).createElement(i("7ERUE").ToolbarButton,{isDisabled:S,iconBefore:T,testId:_,onClick:e=>{if(!c)return;let n=e?.nativeEvent?.detail===0;(0,i("5SuLc").createOpenAIModalCommand)({state:c.state,configItem:m,lastTriggeredFrom:b?"mainToolbar":"floatingToolbar",triggerMethod:n?"keyboard":"click",aiGlobalOptIn:t,locale:l})(c.state,c.dispatch)}},f)},sm=({aiGlobalOptIn:t,isDisabled:n,parents:a,shouldShowImproveDescription:r,getAdditionalProps:o,api:s})=>{let{formatMessage:l,locale:c}=(0,i("8C5kA").default)(),{editorView:d}=(0,i("gzUv9").useEditorToolbar)(),p=sc(s),u=(0,i("eiA8Z").useSharedPluginStateWithSelector)(s,["aiExperience"],e=>e.aiExperienceState?.hasVisibleContent),m=(0,i("eiA8Z").useSharedPluginStateWithSelector)(s,["aiExperience"],e=>e.aiExperienceState?.aiDecorationExperiencePluginState.isInDocumentStreamingEnabled);sr({api:s,state:d?.state,enabled:m,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.AI_HERO_PROMPT_BUTTON});let f=a.at(0)?.key===i("cPCP8").TOOLBARS.PRIMARY_TOOLBAR,h=r&&f,_=l(h?i("AMCQl").aiConfigItemMessages.improveDescription:i("7ShCl").aiMessages.improveWritingToolbarIconTitle),y=((0,i("dh538").fg)("platform_editor_toolbar_aifc_patch_8")?p:n)||!u;return e(g).createElement(i("7ERUE").ToolbarButton,{isDisabled:y,iconBefore:e(g).createElement(e(i("lW0cT")),{label:_,size:"small"}),testId:h?"editor-toolbar__improve-description":"editor-toolbar__improve-writing",onClick:e=>{if(!d)return;let n=h?st({getAdditionalProps:o}):(0,i("iBSwI").improveWriting)(),a=e?.nativeEvent?.detail===0;(0,i("5SuLc").createOpenAIModalCommand)({state:d.state,configItem:n,lastTriggeredFrom:f?"mainToolbar":"floatingToolbar",triggerMethod:a?"keyboard":"click",aiGlobalOptIn:t,locale:c})(d.state,d.dispatch)}},_)},sf=({children:t,isDisabled:n,isNewToolbarEnabled:a,api:r,parents:o,testId:s,isInDocumentStreamingEnabled:l})=>{let{formatMessage:c}=(0,i("8C5kA").default)(),{editorView:d}=(0,i("gzUv9").useEditorToolbar)(),p=(0,i("eiA8Z").useSharedPluginStateWithSelector)(r,["aiExperience"],e=>e.aiExperienceState?.hasVisibleContent),u=sc(r),m=((0,i("dh538").fg)("platform_editor_toolbar_aifc_patch_8")?u:n)||!p;return e(g).createElement(ss,{isNewToolbarEnabled:a,isInDocumentStreamingEnabled:l},e(g).createElement(i("5v3PK").ToolbarDropdownMenuProvider,null,e(g).createElement(i("bTiiT").ToolbarDropdownMenu,{iconBefore:e(g).createElement(i("EJKmu").MoreItemsIcon,{label:c(i("7ShCl").aiMessages.moreRovoOptionsMenuLabel)}),testId:s??"editor-toolbar__ask-rovo-menu",isDisabled:m,onClick:(e,t)=>{d&&r?.analytics?.actions.fireAnalyticsEvent({action:i("d925B").ACTION.CLICKED,actionSubject:i("d925B").ACTION_SUBJECT.BUTTON,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.AI_MORE_ROVO_OPTIONS,eventType:i("d925B").EVENT_TYPE.UI,attributes:{inputMethod:(0,i("4Dsx2").getInputMethodFromParentKeys)(o),opened:t}})}},t)))},sh=({itemKey:t,icon:n,messageDescriptor:a,children:r,api:o,parents:s})=>{let{formatMessage:l}=(0,i("8C5kA").default)();return e(g).createElement(i("87Gms").ToolbarNestedDropdownMenu,{elemBefore:e(g).createElement(n,{size:"small",label:l(a)}),text:l(a),elemAfter:e(g).createElement(o6,{label:l(a)}),testId:`dropdown-item__${t}`,onClick:()=>{let e=t===i("cPCP8").CHANGE_TONE_NESTED_MENU.key?i("d925B").ACTION_SUBJECT_ID.AI_CHANGE_TONE:t===i("cPCP8").TRANSLATE_NESTED_MENU.key?i("d925B").ACTION_SUBJECT_ID.AI_TRANSLATE:void 0;e&&o?.analytics?.actions.fireAnalyticsEvent({action:i("d925B").ACTION.CLICKED,actionSubject:i("d925B").ACTION_SUBJECT.TOOLBAR_DROPDOWN_MENU_ITEM,actionSubjectId:e,eventType:i("d925B").EVENT_TYPE.UI,attributes:{inputMethod:(0,i("4Dsx2").getInputMethodFromParentKeys)(s)}})}},r)},s_=({api:t,aiGlobalOptIn:n,itemKey:a,icon:r,messageDescriptor:o,configItem:s,parents:l,onClick:c,isDisabled:d=!1})=>{let{editorView:p}=(0,i("gzUv9").useEditorToolbar)(),{formatMessage:u,locale:m}=(0,i("8C5kA").default)(),f=sc(t),h=l.at(0)?.key===i("cPCP8").TOOLBARS.PRIMARY_TOOLBAR;return e(g).createElement(i("2GVu1").ToolbarDropdownItem,{elemBefore:e(g).createElement(r,{size:"small",label:u(o)}),elemAfter:(0,td.expValEquals)("platform_editor_toolbar_aifc_patch_6","isEnabled",!0)?e(g).createElement("div",null):void 0,testId:`dropdown-item__${a}`,isDisabled:(0,i("dh538").fg)("platform_editor_toolbar_aifc_patch_8")?f:d,onClick:e=>{if(c)return c();if(!p)return;let t=e?.nativeEvent?.detail===0;(0,i("5SuLc").createOpenAIModalCommand)({state:p.state,configItem:s,lastTriggeredFrom:h?"primaryToolbar":"floatingToolbar",triggerMethod:t?"keyboard":"click",aiGlobalOptIn:n,locale:m})(p.state,p.dispatch)}},u(o))},sy=({editorPluginAIProvider:t,aiGlobalOptIn:n,shouldShowImproveDescription:a,getAdditionalProps:r,isNewToolbarEnabled:o,api:s})=>{let l="enabled"!==n.status,c=(0,i("dh538").fg)("platform_editor_toolbar_aifc_patch_7"),d=s?.toolbar?.actions.getBreakpointPreset();return[{type:i("cPCP8").AI_SECTION.type,key:i("cPCP8").AI_SECTION.key,parents:[{type:"toolbar",key:i("cPCP8").TOOLBARS.INLINE_TEXT_TOOLBAR,rank:i("4Chin").TOOLBAR_RANK[i("cPCP8").AI_SECTION.key]}],component:({children:t})=>e(g).createElement(si,{api:s,hasSeparator:c?i("48SU7").SeparatorPosition.END:void 0},t)},{type:i("cPCP8").AI_SECTION.type,key:i("cPCP8").AI_SECTION_FULL_PAGE_PRIMARY_TOOLBAR.key,parents:[...t.hidePrimaryToolbarButton||t.isInDocumentStreamingEnabled||!t.isInDocumentStreamingEnabled&&(0,m.editorExperiment)("platform_editor_toolbar_aifc",!0)?[]:[{type:"toolbar",key:i("cPCP8").TOOLBARS.PRIMARY_TOOLBAR,rank:i("4Chin").TOOLBAR_RANK[i("cPCP8").AI_SECTION.key]}]],component:({children:t})=>e(g).createElement(sl,{api:s,editorAppearance:"full-page"},t)},{type:i("cPCP8").AI_SECTION.type,key:i("cPCP8").AI_SECTION_COMMENT_PRIMARY_TOOLBAR.key,parents:[...t.hidePrimaryToolbarButton?[]:[{type:"toolbar",key:i("cPCP8").TOOLBARS.PRIMARY_TOOLBAR,rank:i("4Chin").TOOLBAR_RANK[i("cPCP8").AI_SECTION.key]}]],component:({children:t})=>e(g).createElement(sl,{api:s,editorAppearance:"comment"},t)},{type:i("cPCP8").AI_SECTION_PRIMARY_TOOLBAR.type,key:i("cPCP8").AI_SECTION_PRIMARY_TOOLBAR.key,parents:[...t.hidePrimaryToolbarButton||!t.isInDocumentStreamingEnabled||!t.isInDocumentStreamingEnabled&&(0,m.editorExperiment)("platform_editor_toolbar_aifc",!0)?[]:[{type:"toolbar",key:i("cPCP8").TOOLBARS.PRIMARY_TOOLBAR,rank:i("4Chin").TOOLBAR_RANK[i("cPCP8").AI_SECTION.key]}]],component:({children:t})=>e(g).createElement(sl,{api:s,editorAppearance:"full-page",hasSeparator:!0},t)},{type:i("cPCP8").AI_VIEW_SECTION.type,key:i("cPCP8").AI_VIEW_SECTION.key,parents:[{type:"toolbar",key:i("cPCP8").TOOLBARS.INLINE_TEXT_TOOLBAR,rank:i("4Chin").TOOLBAR_RANK[i("cPCP8").AI_VIEW_SECTION.key]}],component:({children:t})=>e(g).createElement(sa,{api:s,hasSeparator:c?i("48SU7").SeparatorPosition.END:void 0},t)},{type:i("cPCP8").AI_VIEW_SECTION.type,key:i("cPCP8").AI_VIEW_SECTION.key,parents:[...t.hidePrimaryToolbarButton?[]:[{type:"toolbar",key:i("cPCP8").TOOLBARS.PRIMARY_TOOLBAR,rank:i("4Chin").TOOLBAR_RANK[i("cPCP8").AI_VIEW_SECTION.key]}]],component:({children:t})=>e(g).createElement(sa,{api:s},t)},{type:i("cPCP8").ROVO_GROUP.type,key:i("cPCP8").ROVO_GROUP.key,parents:[{type:i("cPCP8").AI_SECTION.type,key:i("cPCP8").AI_SECTION.key,rank:!t.isInDocumentStreamingEnabled&&(0,m.editorExperiment)("platform_editor_toolbar_aifc",!0)?400:i("4Chin").AI_SECTION_RANK[i("cPCP8").ROVO_GROUP.key]},{type:i("cPCP8").AI_SECTION.type,key:i("cPCP8").AI_SECTION_FULL_PAGE_PRIMARY_TOOLBAR.key,rank:i("4Chin").AI_SECTION_RANK[i("cPCP8").ROVO_GROUP.key]},{type:i("cPCP8").AI_SECTION.type,key:i("cPCP8").AI_SECTION_COMMENT_PRIMARY_TOOLBAR.key,rank:i("4Chin").AI_SECTION_RANK[i("cPCP8").ROVO_GROUP.key]}],component:(0,td.expValEquals)("platform_editor_toolbar_aifc_responsive","isEnabled",!0)?({children:t})=>e(g).createElement(i("aro2m").Show,{above:"jsm-comment"===d?"sm":"lg"},e(g).createElement(i("kDB94").ToolbarButtonGroup,null,t)):void 0},...(0,td.expValEquals)("platform_editor_toolbar_aifc_responsive","isEnabled",!0)?[{type:i("cPCP8").ROVO_GROUP_DISPLAY_SMALL.type,key:i("cPCP8").ROVO_GROUP_DISPLAY_SMALL.key,parents:[{type:i("cPCP8").AI_SECTION.type,key:i("cPCP8").AI_SECTION.key,rank:i("4Chin").AI_SECTION_RANK[i("cPCP8").ROVO_GROUP_DISPLAY_SMALL.key]},{type:i("cPCP8").AI_SECTION.type,key:i("cPCP8").AI_SECTION_FULL_PAGE_PRIMARY_TOOLBAR.key,rank:i("4Chin").AI_SECTION_RANK[i("cPCP8").ROVO_GROUP_DISPLAY_SMALL.key]},{type:i("cPCP8").AI_SECTION.type,key:i("cPCP8").AI_SECTION_COMMENT_PRIMARY_TOOLBAR.key,rank:i("4Chin").AI_SECTION_RANK[i("cPCP8").ROVO_GROUP_DISPLAY_SMALL.key]}],component:({children:t})=>e(g).createElement(i("aro2m").Show,{below:"jsm-comment"===d?"sm":"lg"},e(g).createElement(i("kDB94").ToolbarButtonGroup,null,t))}]:[],{type:i("cPCP8").ROVO_HERO_BUTTON.type,key:i("cPCP8").ROVO_HERO_BUTTON.key,parents:[{type:i("cPCP8").ROVO_GROUP.type,key:i("cPCP8").ROVO_GROUP.key,rank:i("4Chin").ROVO_GROUP_RANK[i("cPCP8").ROVO_HERO_BUTTON.key]},{type:i("cPCP8").ROVO_GROUP_DISPLAY_SMALL.type,key:i("cPCP8").ROVO_GROUP_DISPLAY_SMALL.key,rank:i("4Chin").ROVO_GROUP_DISPLAY_SMALL_RANK[i("cPCP8").ROVO_HERO_BUTTON.key]}],component:({parents:i})=>e(g).createElement(sd,{editorPluginAIProvider:t,aiGlobalOptIn:n,isDisabled:l,parents:i,isNewToolbarEnabled:o,api:s})},{type:i("cPCP8").ROVO_GROUP_PRIMARY_TOOLBAR.type,key:i("cPCP8").ROVO_GROUP_PRIMARY_TOOLBAR.key,parents:[{type:i("cPCP8").AI_SECTION_PRIMARY_TOOLBAR.type,key:i("cPCP8").AI_SECTION_PRIMARY_TOOLBAR.key,rank:i("4Chin").AI_SECTION_RANK[i("cPCP8").ROVO_GROUP_PRIMARY_TOOLBAR.key]}],component:({children:t})=>e(g).createElement(i("kDB94").ToolbarButtonGroup,null,t)},{type:i("cPCP8").ROVO_WRITE_BUTTON_PRIMARY_TOOLBAR.type,key:i("cPCP8").ROVO_WRITE_BUTTON_PRIMARY_TOOLBAR.key,parents:[{type:i("cPCP8").ROVO_GROUP_PRIMARY_TOOLBAR.type,key:i("cPCP8").ROVO_GROUP_PRIMARY_TOOLBAR.key,rank:i("4Chin").ROVO_GROUP_RANK[i("cPCP8").ROVO_WRITE_BUTTON_PRIMARY_TOOLBAR.key]}],component:({parents:i})=>e(g).createElement(sd,{editorPluginAIProvider:t,aiGlobalOptIn:n,isDisabled:l,parents:i,isNewToolbarEnabled:o,api:s})},{type:i("cPCP8").ROVO_MENU.type,key:i("cPCP8").ROVO_MENU.key,parents:[...!t.isInDocumentStreamingEnabled&&(0,m.editorExperiment)("platform_editor_toolbar_aifc",!0)?[]:[{type:i("cPCP8").ROVO_GROUP.type,key:i("cPCP8").ROVO_GROUP.key,rank:i("4Chin").ROVO_GROUP_RANK[i("cPCP8").ROVO_MENU.key]}]],component:({children:n,parents:i})=>e(g).createElement(sf,{api:s,isDisabled:l,isNewToolbarEnabled:o,isInDocumentStreamingEnabled:t.isInDocumentStreamingEnabled,parents:i,testId:"editor-toolbar__ask-rovo-menu"},n)},{type:i("cPCP8").ROVO_PROMPT_MENU_SECTION.type,key:i("cPCP8").ROVO_PROMPT_MENU_SECTION.key,parents:[{type:i("cPCP8").ROVO_MENU.type,key:i("cPCP8").ROVO_MENU.key,rank:i("4Chin").ROVO_MENU_RANK[i("cPCP8").ROVO_PROMPT_MENU_SECTION.key]}]},{type:i("cPCP8").ROVO_MENU_DISPLAY_SMALL.type,key:i("cPCP8").ROVO_MENU_DISPLAY_SMALL.key,parents:[...!t.isInDocumentStreamingEnabled&&(0,m.editorExperiment)("platform_editor_toolbar_aifc",!0)?[]:[{type:i("cPCP8").ROVO_GROUP_DISPLAY_SMALL.type,key:i("cPCP8").ROVO_GROUP_DISPLAY_SMALL.key,rank:i("4Chin").ROVO_GROUP_DISPLAY_SMALL_RANK[i("cPCP8").ROVO_MENU_DISPLAY_SMALL.key]}]],component:({children:t,parents:n})=>e(g).createElement(sf,{api:s,isDisabled:l,isNewToolbarEnabled:o,parents:n,testId:"editor-toolbar__ask-rovo-menu-display-small"},t)},{type:i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.type,key:i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.key,parents:[{type:i("cPCP8").ROVO_MENU_DISPLAY_SMALL.type,key:i("cPCP8").ROVO_MENU_DISPLAY_SMALL.key,rank:i("4Chin").ROVO_MENU_RANK[i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.key]}]},...t.heroConfigItem&&t.isInDocumentStreamingEnabled?[{type:i("cPCP8").HERO_PROMPT_MENU_ITEM.type,key:i("cPCP8").HERO_PROMPT_MENU_ITEM.key,parents:[{type:i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.type,key:i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.key,rank:i("4Chin").ROVO_PROMPT_MENU_SECTION_RANK[i("cPCP8").HERO_PROMPT_MENU_ITEM.key]}],component:({parents:a})=>{if(!t.heroConfigItem)return null;let r=t.heroConfigItem.config;return e(g).createElement(s_,{api:s,aiGlobalOptIn:n,itemKey:i("cPCP8").HERO_PROMPT_MENU_ITEM.key,icon:sE(r),messageDescriptor:r.title,configItem:r,parents:a})}}]:t.isInDocumentStreamingEnabled?[{type:i("cPCP8").IMPROVE_WRITING_MENU_ITEM.type,key:i("cPCP8").IMPROVE_WRITING_MENU_ITEM.key,parents:[{type:i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.type,key:i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.key,rank:i("4Chin").ROVO_PROMPT_MENU_SECTION_RANK[i("cPCP8").IMPROVE_WRITING_MENU_ITEM.key]}],component:({parents:t})=>e(g).createElement(s_,{api:s,aiGlobalOptIn:n,itemKey:i("cPCP8").IMPROVE_WRITING_MENU_ITEM.key,icon:e(i("lW0cT")),messageDescriptor:i("7ShCl").aiMessages.improveWritingToolbarIconTitle,configItem:(0,i("iBSwI").improveWriting)(),parents:t})}]:[],{type:i("cPCP8").SPELLING_AND_GRAMMAR_MENU_ITEM.type,key:i("cPCP8").SPELLING_AND_GRAMMAR_MENU_ITEM.key,parents:[{type:i("cPCP8").ROVO_PROMPT_MENU_SECTION.type,key:i("cPCP8").ROVO_PROMPT_MENU_SECTION.key,rank:i("4Chin").ROVO_PROMPT_MENU_SECTION_RANK[i("cPCP8").SPELLING_AND_GRAMMAR_MENU_ITEM.key]},{type:i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.type,key:i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.key,rank:i("4Chin").ROVO_PROMPT_MENU_SECTION_RANK[i("cPCP8").SPELLING_AND_GRAMMAR_MENU_ITEM.key]}],component:({parents:t})=>e(g).createElement(s_,{api:s,aiGlobalOptIn:n,itemKey:i("cPCP8").SPELLING_AND_GRAMMAR_MENU_ITEM.key,icon:e(i("dLjaJ")),messageDescriptor:i("7ShCl").aiMessages.spellingAndGrammarToolbarDropdownIconTitle,configItem:(0,i("iBSwI").fixSpellingAndGrammar)(),parents:t})},{type:i("cPCP8").CHANGE_TONE_NESTED_MENU.type,key:i("cPCP8").CHANGE_TONE_NESTED_MENU.key,parents:[{type:i("cPCP8").ROVO_PROMPT_MENU_SECTION.type,key:i("cPCP8").ROVO_PROMPT_MENU_SECTION.key,rank:i("4Chin").ROVO_PROMPT_MENU_SECTION_RANK[i("cPCP8").CHANGE_TONE_NESTED_MENU.key]},{type:i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.type,key:i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.key,rank:i("4Chin").ROVO_PROMPT_MENU_SECTION_RANK[i("cPCP8").CHANGE_TONE_NESTED_MENU.key]}],component:({children:t,parents:n})=>e(g).createElement(sh,{itemKey:i("cPCP8").CHANGE_TONE_NESTED_MENU.key,icon:e(i("iulqN")),messageDescriptor:i("7ShCl").aiMessages.changeToneToolbarDropdownIconTitle,api:s,parents:n},t)},{type:i("cPCP8").CHANGE_TONE_MENU_SECTION.type,key:i("cPCP8").CHANGE_TONE_MENU_SECTION.key,parents:[{type:i("cPCP8").CHANGE_TONE_NESTED_MENU.type,key:i("cPCP8").CHANGE_TONE_NESTED_MENU.key,rank:i("4Chin").CHANGE_TONE_MENU_RANK[i("cPCP8").CHANGE_TONE_MENU_SECTION.key]}]},{type:i("cPCP8").MORE_PROFESSIONAL_MENU_ITEM.type,key:i("cPCP8").MORE_PROFESSIONAL_MENU_ITEM.key,parents:[{type:i("cPCP8").CHANGE_TONE_MENU_SECTION.type,key:i("cPCP8").CHANGE_TONE_MENU_SECTION.key,rank:i("4Chin").CHANGE_TONE_MENU_SECTION_RANK[i("cPCP8").MORE_PROFESSIONAL_MENU_ITEM.key]}],component:({parents:t})=>e(g).createElement(s_,{api:s,aiGlobalOptIn:n,itemKey:i("cPCP8").MORE_PROFESSIONAL_MENU_ITEM.key,icon:e(i("oeZjt")),messageDescriptor:i("7ShCl").aiMessages.moreProfessionalToneToolbarDropdownIconTitle,configItem:(0,i("l5nYy").changeToneToProfessional)(),parents:t})},{type:i("cPCP8").MORE_CASUAL_MENU_ITEM.type,key:i("cPCP8").MORE_CASUAL_MENU_ITEM.key,parents:[{type:i("cPCP8").CHANGE_TONE_MENU_SECTION.type,key:i("cPCP8").CHANGE_TONE_MENU_SECTION.key,rank:i("4Chin").CHANGE_TONE_MENU_SECTION_RANK[i("cPCP8").MORE_CASUAL_MENU_ITEM.key]}],component:({parents:t})=>e(g).createElement(s_,{api:s,aiGlobalOptIn:n,itemKey:i("cPCP8").MORE_CASUAL_MENU_ITEM.key,icon:e(i("j398X")),messageDescriptor:i("7ShCl").aiMessages.moreCasualToneToolbarDropdownIconTitle,configItem:(0,i("l5nYy").changeToneToCasual)(),parents:t})},{type:i("cPCP8").MORE_EMPATHETIC_MENU_ITEM.type,key:i("cPCP8").MORE_EMPATHETIC_MENU_ITEM.key,parents:[{type:i("cPCP8").CHANGE_TONE_MENU_SECTION.type,key:i("cPCP8").CHANGE_TONE_MENU_SECTION.key,rank:i("4Chin").CHANGE_TONE_MENU_SECTION_RANK[i("cPCP8").MORE_EMPATHETIC_MENU_ITEM.key]}],component:({parents:t})=>e(g).createElement(s_,{api:s,aiGlobalOptIn:n,itemKey:i("cPCP8").MORE_EMPATHETIC_MENU_ITEM.key,icon:e(i("j8LwF")),messageDescriptor:i("7ShCl").aiMessages.moreEmpatheticToneToolbarDropdownIconTitle,configItem:(0,i("l5nYy").changeToneToEmpathetic)(),parents:t})},{type:i("cPCP8").MAKE_SHORTER_MENU_ITEM.type,key:i("cPCP8").MAKE_SHORTER_MENU_ITEM.key,parents:[{type:i("cPCP8").ROVO_PROMPT_MENU_SECTION.type,key:i("cPCP8").ROVO_PROMPT_MENU_SECTION.key,rank:i("4Chin").ROVO_PROMPT_MENU_SECTION_RANK[i("cPCP8").MAKE_SHORTER_MENU_ITEM.key]},{type:i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.type,key:i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.key,rank:i("4Chin").ROVO_PROMPT_MENU_SECTION_RANK[i("cPCP8").MAKE_SHORTER_MENU_ITEM.key]}],component:({parents:t})=>e(g).createElement(s_,{api:s,aiGlobalOptIn:n,itemKey:i("cPCP8").MAKE_SHORTER_MENU_ITEM.key,icon:e(i("cH4SO")),messageDescriptor:i("7ShCl").aiMessages.makeShorterToolbarDropdownIconTitle,configItem:(0,i("96Uu5").makeShorter)(),parents:t})},{type:i("cPCP8").MAKE_LONGER_MENU_ITEM.type,key:i("cPCP8").MAKE_LONGER_MENU_ITEM.key,parents:[{type:i("cPCP8").ROVO_PROMPT_MENU_SECTION.type,key:i("cPCP8").ROVO_PROMPT_MENU_SECTION.key,rank:i("4Chin").ROVO_PROMPT_MENU_SECTION_RANK[i("cPCP8").MAKE_LONGER_MENU_ITEM.key]},{type:i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.type,key:i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.key,rank:i("4Chin").ROVO_PROMPT_MENU_SECTION_RANK[i("cPCP8").MAKE_LONGER_MENU_ITEM.key]}],component:({parents:t})=>e(g).createElement(s_,{api:s,aiGlobalOptIn:n,itemKey:i("cPCP8").MAKE_LONGER_MENU_ITEM.key,icon:e(i("eugUs")),messageDescriptor:i("7ShCl").aiMessages.makeLongerToolbarDropdownIconTitle,configItem:(0,i("2KJU8").makeLonger)(),parents:t})},{type:i("cPCP8").TRANSLATE_NESTED_MENU.type,key:i("cPCP8").TRANSLATE_NESTED_MENU.key,parents:[{type:i("cPCP8").ROVO_PROMPT_MENU_SECTION.type,key:i("cPCP8").ROVO_PROMPT_MENU_SECTION.key,rank:i("4Chin").ROVO_PROMPT_MENU_SECTION_RANK[i("cPCP8").TRANSLATE_NESTED_MENU.key]},{type:i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.type,key:i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.key,rank:i("4Chin").ROVO_PROMPT_MENU_SECTION_RANK[i("cPCP8").TRANSLATE_NESTED_MENU.key]}],component:({children:t,parents:n})=>e(g).createElement(sh,{itemKey:i("cPCP8").TRANSLATE_NESTED_MENU.key,icon:e(i("3tLv0")),messageDescriptor:i("7ShCl").aiMessages.translateOptionsIconLabel,api:s,parents:n},t)},{type:i("cPCP8").TRANSLATE_MENU_SECTION.type,key:i("cPCP8").TRANSLATE_MENU_SECTION.key,parents:[{type:i("cPCP8").TRANSLATE_NESTED_MENU.type,key:i("cPCP8").TRANSLATE_NESTED_MENU.key,rank:i("4Chin").TRANSLATE_MENU_RANK[i("cPCP8").TRANSLATE_MENU_SECTION.key]}]},...sI(s,n),...t.isInDocumentStreamingEnabled?[{type:i("cPCP8").DEFINE_MENU_ITEM.type,key:i("cPCP8").DEFINE_MENU_ITEM.key,parents:[{type:i("cPCP8").ROVO_PROMPT_MENU_SECTION.type,key:i("cPCP8").ROVO_PROMPT_MENU_SECTION.key,rank:i("4Chin").ROVO_PROMPT_MENU_SECTION_RANK[i("cPCP8").DEFINE_MENU_ITEM.key]},{type:i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.type,key:i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.key,rank:i("4Chin").ROVO_PROMPT_MENU_SECTION_RANK[i("cPCP8").DEFINE_MENU_ITEM.key]}],component:({parents:t})=>!s?.aiDefinitions&&(0,i("dh538").fg)("platform_editor_ai_conditional_define_item")?null:e(g).createElement(s_,{api:s,aiGlobalOptIn:n,itemKey:i("cPCP8").DEFINE_MENU_ITEM.key,icon:e(i("8tSmd")),messageDescriptor:i("7ShCl").aiMessages.DefineDropdownIconTitle,onClick:()=>{s?.aiDefinitions?.actions.openReadingAidsPopup()},isDisabled:s?.aiDefinitions?.actions.selectionExceedsMaxWordCount()||!1,parents:t})}]:[],...o&&t.heroConfigItem&&(t.isInDocumentStreamingEnabled||(0,i("dh538").fg)("draft_reply_contextual_pills_gate"))?[{type:i("cPCP8").HERO_PROMPT_BUTTON_GROUP.type,key:i("cPCP8").HERO_PROMPT_BUTTON_GROUP.key,parents:[{type:i("cPCP8").AI_SECTION.type,key:i("cPCP8").AI_SECTION.key,rank:i("4Chin").AI_SECTION_RANK[i("cPCP8").HERO_PROMPT_BUTTON_GROUP.key]},{type:i("cPCP8").AI_SECTION.type,key:i("cPCP8").AI_SECTION_FULL_PAGE_PRIMARY_TOOLBAR.key,rank:i("4Chin").AI_SECTION_RANK[i("cPCP8").HERO_PROMPT_BUTTON_GROUP.key]},{type:i("cPCP8").AI_SECTION.type,key:i("cPCP8").AI_SECTION_COMMENT_PRIMARY_TOOLBAR.key,rank:i("4Chin").AI_SECTION_RANK[i("cPCP8").HERO_PROMPT_BUTTON_GROUP.key]}],component:(0,td.expValEquals)("platform_editor_toolbar_aifc_responsive","isEnabled",!0)?({children:t})=>e(g).createElement(i("aro2m").Show,{above:"jsm-comment"===d?"sm":"lg"},e(g).createElement(i("kDB94").ToolbarButtonGroup,null,t)):void 0},{type:i("cPCP8").HERO_PROMPT_BUTTON.type,key:i("cPCP8").HERO_PROMPT_BUTTON.key,parents:[{type:i("cPCP8").HERO_PROMPT_BUTTON_GROUP.type,key:i("cPCP8").HERO_PROMPT_BUTTON_GROUP.key,rank:i("4Chin").HERO_PROMPT_BUTTON_GROUP_RANK[i("cPCP8").HERO_PROMPT_BUTTON.key]}],component:({parents:i})=>t.heroConfigItem?e(g).createElement(sg,{aiGlobalOptIn:n,isDisabled:l,parents:i,api:s,heroConfigItem:t.heroConfigItem}):null}]:o?[{type:"group",key:"improve-writing-group",parents:[{type:i("cPCP8").AI_SECTION.type,key:i("cPCP8").AI_SECTION.key,rank:i("4Chin").AI_SECTION_RANK[i("cPCP8").IMPROVE_WRITING_GROUP.key]},{type:i("cPCP8").AI_SECTION.type,key:i("cPCP8").AI_SECTION_FULL_PAGE_PRIMARY_TOOLBAR.key,rank:i("4Chin").AI_SECTION_RANK[i("cPCP8").IMPROVE_WRITING_GROUP.key]},{type:i("cPCP8").AI_SECTION.type,key:i("cPCP8").AI_SECTION_COMMENT_PRIMARY_TOOLBAR.key,rank:i("4Chin").AI_SECTION_RANK[i("cPCP8").IMPROVE_WRITING_GROUP.key]}],component:(0,td.expValEquals)("platform_editor_toolbar_aifc_responsive","isEnabled",!0)?({children:t})=>e(g).createElement(i("aro2m").Show,{above:"jsm-comment"===d?"sm":"lg"},e(g).createElement(i("kDB94").ToolbarButtonGroup,null,t)):void 0},{type:i("cPCP8").IMPROVE_WRITING_BUTTON.type,key:i("cPCP8").IMPROVE_WRITING_BUTTON.key,parents:[{type:i("cPCP8").IMPROVE_WRITING_GROUP.type,key:i("cPCP8").IMPROVE_WRITING_GROUP.key,rank:i("4Chin").IMPROVE_WRITING_GROUP_RANK[i("cPCP8").IMPROVE_WRITING_BUTTON.key]}],component:({parents:t})=>e(g).createElement(sm,{aiGlobalOptIn:n,isDisabled:l,parents:t,shouldShowImproveDescription:a,getAdditionalProps:r,api:s})}]:[],{type:i("cPCP8").ROVO_GROUP_VIEW.type,key:i("cPCP8").ROVO_GROUP_VIEW.key,parents:[{type:i("cPCP8").AI_VIEW_SECTION.type,key:i("cPCP8").AI_VIEW_SECTION.key,rank:i("4Chin").AI_SECTION_RANK[i("cPCP8").ROVO_GROUP.key]}]},{type:i("cPCP8").ROVO_HERO_BUTTON.type,key:i("cPCP8").ROVO_HERO_BUTTON.key,parents:[{type:i("cPCP8").ROVO_GROUP_VIEW.type,key:i("cPCP8").ROVO_GROUP_VIEW.key,rank:i("4Chin").ROVO_GROUP_RANK[i("cPCP8").ROVO_HERO_BUTTON.key]}],component:()=>e(g).createElement(sp,{api:s,editorPluginAIProvider:t})},{type:i("cPCP8").DEFINE_GROUP.type,key:i("cPCP8").DEFINE_GROUP.key,parents:[{type:i("cPCP8").AI_VIEW_SECTION.type,key:i("cPCP8").AI_VIEW_SECTION.key,rank:i("4Chin").AI_SECTION_RANK[i("cPCP8").DEFINE_GROUP.key]}],component:(0,td.expValEquals)("platform_editor_toolbar_aifc_responsive","isEnabled",!0)?({children:t})=>!s?.aiDefinitions&&(0,i("dh538").fg)("platform_editor_ai_conditional_define_item")?null:s?.aiDefinitions?.actions.selectionExceedsMaxWordCount()?void 0:e(g).createElement(i("aro2m").Show,{above:"lg"},e(g).createElement(i("kDB94").ToolbarButtonGroup,null,t)):void 0},{type:i("cPCP8").DEFINE_BUTTON.type,key:i("cPCP8").DEFINE_BUTTON.key,parents:[{type:i("cPCP8").DEFINE_GROUP.type,key:i("cPCP8").DEFINE_GROUP.key,rank:i("4Chin").DEFINE_GROUP_RANK[i("cPCP8").DEFINE_BUTTON.key]}],component:()=>!s?.aiDefinitions&&(0,i("dh538").fg)("platform_editor_ai_conditional_define_item")?null:e(g).createElement(su,{api:s})},...(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")?[{type:i("cPCP8").ADD_POLISH_MENU_ITEM.type,key:i("cPCP8").ADD_POLISH_MENU_ITEM.key,parents:[{type:i("cPCP8").ROVO_PROMPT_MENU_SECTION.type,key:i("cPCP8").ROVO_PROMPT_MENU_SECTION.key,rank:i("4Chin").ROVO_PROMPT_MENU_SECTION_RANK[i("cPCP8").ADD_POLISH_MENU_ITEM.key]},{type:i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.type,key:i("cPCP8").ROVO_PROMPT_MENU_SECTION_DISPLAY_SMALL.key,rank:i("4Chin").ROVO_PROMPT_MENU_SECTION_RANK[i("cPCP8").ADD_POLISH_MENU_ITEM.key]}],component:({parents:t})=>e(g).createElement(s_,{api:s,aiGlobalOptIn:n,itemKey:i("cPCP8").ADD_POLISH_MENU_ITEM.key,icon:e(i("cbtR4")),messageDescriptor:i("AMCQl").aiConfigItemMessages.addPolishTitle,configItem:(0,i("kOMDA").addPolish)(),parents:t})}]:[]]},sI=(t,n)=>{let a=(0,i("6PN31").createTranslationConfigItems)();return(0,i("8vIZB").getSortedSupportedTranslationLanguages)().map((r,o)=>({type:"menu-item",key:`${r}-language-menu-item`,parents:[{type:i("cPCP8").TRANSLATE_MENU_SECTION.type,key:i("cPCP8").TRANSLATE_MENU_SECTION.key,rank:(o+1)*100}],component:({parents:o})=>e(g).createElement(s_,{api:t,aiGlobalOptIn:n,itemKey:`${r}-language-menu-item`,icon:e(i("3tLv0")),messageDescriptor:i("bpQiY").aiLanguageMessages[r],configItem:a[r],parents:o})}))},sE=t=>Object.assign(()=>{let{formatMessage:n}=(0,i("8C5kA").default)();if(t.icon){let e=t.icon({formatMessage:n});if(e)return e}return e(g).createElement(e(i("lW0cT")),{label:n(t.title),size:"small"})},{displayName:"HeroPromptIcon"}),sS="ak-editor-ai-selection-toolbar-ai-button",sb=({intl:t,rangeBaseGenerate:n,hideTitle:a,aiGlobalOptIn:r,icon:o,title:s,tooltip:l,triggeredFor:c,pulse:d,onMount:p,onClick:u,disabled:m})=>{let f=!1,h=((0,td.expValEquals)("platform_editor_hydratable_ui","isEnabled",!0)?(0,i("d7ZU3").getBrowserInfo)():i("d7ZU3").browser).mac?"⌘":"Ctrl";return{type:"button",isRadioButton:!1,pulse:d,showTitle:!0,testId:sS,icon:o??(()=>e(g).createElement(i("lAFHW").RovoIcon,{size:"small"})),...!a&&{title:t.formatMessage(s??i("7ShCl").aiMessages.aiToolbarTitle)},ariaLabel:(0,td.expValEquals)("platform_editor_drag_handle_aria_label","isEnabled",!0)?t.formatMessage(s??i("7ShCl").aiMessages.aiToolbarTitle):"",tooltipContent:t.formatMessage(l??i("SFzFl").default.aiUniversalShortCallToAction,{key:h}),onMount:p,onMouseEnter:()=>(f=!0,!1),onClick:(e,a,o)=>((0,i("5SuLc").createOpenAIModalCommand)({state:e,configItem:n,lastTriggeredFrom:"floatingToolbar",triggerMethod:f?"click":"keyboard",aiGlobalOptIn:r,triggeredFor:c,locale:t.locale})(e,a),u&&u(),!1),disabled:m}},sT=({intl:t,hideTitle:n,aiGlobalOptIn:a,disabled:r,onMount:o,isInDocumentStreamingEnabled:s})=>{let l=!1;return{type:"button",isRadioButton:!1,showTitle:!0,testId:`${sS}-improve-writing`,ariaLabel:(0,td.expValEquals)("platform_editor_floating_toolbar_button_aria_label","isEnabled",!0)?t.formatMessage(i("7ShCl").aiMessages.improveWritingToolbarIconTitle):void 0,icon:(0,i("dh538").fg)("ai-smart-button-team-25")||(0,m.editorExperiment)("platform_editor_controls","variant1")?e(i("lW0cT")):void 0,...!n&&{title:t.formatMessage(i("7ShCl").aiMessages.improveWritingToolbarIconTitle)},tooltipContent:s?void 0:t.formatMessage(i("7ShCl").aiMessages.improveWritingToolbarIconTooltip),onMouseEnter:()=>(l=!0,!1),onClick:(e,n,r)=>((0,i("5SuLc").createOpenAIModalCommand)({state:e,configItem:(0,i("iBSwI").improveWriting)(),lastTriggeredFrom:"floatingToolbar",triggerMethod:l?"click":"keyboard",aiGlobalOptIn:a,locale:t.locale})(e,n),!1),disabled:r,onMount:o}},sC=({intl:t,rangeBaseGenerate:n,aiGlobalOptIn:a,triggeredFor:r,pulse:o,onMount:s,onClick:l,disabled:c})=>sb({intl:t,rangeBaseGenerate:n,hideTitle:!1,aiGlobalOptIn:a,icon:()=>e(g).createElement(i("lAFHW").RovoIcon,{size:"small"}),title:i("7ShCl").aiMessages.askRovoToolbarIconTitle,tooltip:i("7ShCl").aiMessages.askRovoToolbarIconTooltipQuickCommand,triggeredFor:r,pulse:o,onMount:s,onClick:l,disabled:c}),sA=({view:t,api:n,editorPluginAIProvider:a,aiGlobalOptIn:r,onMount:o})=>{let s=n?.toolbar?.actions.getComponents?.(),l=e(g).useMemo(()=>s??sy({editorPluginAIProvider:a,aiGlobalOptIn:r,isNewToolbarEnabled:!1,api:n}),[s,a,r,n]),c=e(g).useMemo(()=>({type:"toolbar",key:i("cPCP8").TOOLBARS.INLINE_TEXT_TOOLBAR,component:({children:t})=>e(g).createElement(e(g).Fragment,null,t)}),[]),d=e(g).useMemo(()=>({group:i("kDB94").ToolbarButtonGroup,section:i("48SU7").ToolbarSection,menuSection:i("6UWPx").ToolbarDropdownItemSection}),[]);return e(g).useEffect(()=>{o?.()},[]),e(g).createElement(i("gzUv9").EditorToolbarProvider,{editorView:t??null},e(g).createElement(i("biAkr").EditorToolbarUIProvider,{api:n},e(g).createElement(i("cf8NL").ToolbarModelRenderer,{toolbar:c,components:l,fallbacks:d})))},sv=t=>{let{intl:n,rangeBaseGenerate:i,aiGlobalOptIn:a,editorPluginAIProvider:r,disabled:o,api:s,triggeredFor:l,pulse:c,onMount:d}=t;return{type:"custom",fallback:[sC({intl:n,rangeBaseGenerate:i,aiGlobalOptIn:t.aiGlobalOptIn,triggeredFor:l,pulse:c,onMount:d,disabled:o})],render:t=>t?e(g).createElement(sA,{onMount:d,view:t,api:s,editorPluginAIProvider:r,aiGlobalOptIn:a}):null}},sP=({intl:e,editorPluginAIProvider:t,aiGlobalOptIn:n,nodeType:a,disabled:r,api:o,state:s})=>{let l="enabled"===n.status;return t.isInDocumentStreamingEnabled?sv({intl:e,rangeBaseGenerate:t.baseGenerate,aiGlobalOptIn:n,triggeredFor:a,disabled:r,editorPluginAIProvider:t,api:o,onMount:()=>{let{charCount:e,wordCount:t}=(0,i("4SGh1").selectionCharWordCount)(s);(0,i("4SGh1").fireButtonViewedAnalyticsEvent)({api:o,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.AI_ASK_ROVO_BUTTON,attributes:{selectionCharCount:e,selectionWordCount:t}})}}):l&&(0,i("dh538").fg)("ai-smart-button-team-25")||(0,m.editorExperiment)("platform_editor_controls","variant1")?sC({intl:e,rangeBaseGenerate:t.baseGenerate,aiGlobalOptIn:n,triggeredFor:a,disabled:r}):sb({intl:e,rangeBaseGenerate:t.baseGenerate,hideTitle:!0,aiGlobalOptIn:n,triggeredFor:a,disabled:r})},sk=({aiGlobalOptIn:e,editorPluginAIProvider:t,api:n})=>(a,r,o,s)=>{let l=i("3yUTv").aiExperienceDecorationPluginKey.getState(a);if((l?.modalDecorationSet??i("ftzrq").DecorationSet.empty)!==i("ftzrq").DecorationSet.empty&&t.isInDocumentStreamingEnabled)return{title:"",visible:!1,items:[],nodeType:Object.values(a.schema.nodes).reduce((e,t)=>(t.isBlock&&e.push(t),e),[])};let c=nB.maybeBuild(a,n);if(c)return c;let{selection:d}=a,{from:p,to:u}=d,g=d instanceof i("ks2lK").NodeSelection,f="cell"===d.toJSON().type,h=(0,m.editorExperiment)("platform_editor_offline_editing_web",!0)&&(0,i("91bcx").isOfflineMode)(n?.connectivity?.sharedState?.currentState()?.mode),_=(()=>{let e=(0,i("jdR93").getSupportedNodesForAIModal)(a);if(g)return e.has(d.node.type)?d.node:void 0;{let t=(0,D.findParentNode)(t=>e.has(t.type))(d);return t?.node}})(),y="enabled"===e.status;if((p===u||g||f)&&_){let o=g||_,l=_?.type;if(o&&l){let o=sP({intl:r,editorPluginAIProvider:t,aiGlobalOptIn:e,nodeType:l,disabled:h,api:n,state:a}),c={type:"separator",fullHeight:(0,m.editorExperiment)("platform_editor_controls","variant1")};if(!t.isInDocumentStreamingEnabled){let e=s?.find(e=>"Table floating controls"===e.title),t=Array.isArray(e?.items)?e?.items:[];return e&&t.length?(e.items=y&&(0,i("dh538").fg)("ai-smart-button-team-25")||(0,m.editorExperiment)("platform_editor_controls","variant1")?[o,c,...t]:[...t.slice(0,t.length-3),o,c,...t.slice(t.length-3,t.length)],e):void 0}}}},sx=e=>{let[t,n]=(0,g.useState)(0);return(0,g.useEffect)(()=>{if(!e)return;let i=new MutationObserver(e=>{e.forEach(e=>{let{addedNodes:i,removedNodes:a}=e;[...i,...a].some(e=>1===e.nodeType&&"DIV"===e.nodeName)&&n(t+1)})}),a=document.querySelector('[data-testid="ak-editor-main-toolbar"]');return a&&i.observe(a,{childList:!0,subtree:!0}),()=>{i.disconnect()}},[t,e]),t},sw=e=>{if(!e)return!1;let t=e.previousElementSibling?.tagName==="STYLE"?e.previousElementSibling?.previousElementSibling:e.previousElementSibling,n=t?.querySelector(":scope > span:last-child:empty");return!(n&&n.clientWidth>0)},sM=({api:e,view:t,onClick:n,isDisabled:a})=>{let{formatMessage:r}=(0,i("8C5kA").default)(),o=r(i("SFzFl").default.aiUniversalDescriptor),{width:s}=(0,i("eiA8Z").useSharedPluginStateWithSelector)(e,["width"],e=>({width:e.widthState?.width}));return g.createElement(i("a4eZN").default,{onClick:n,buttonId:i("8TW6I").TOOLBAR_ACTION_SUBJECT_ID.AI,"aria-label":o,testId:"atlassian-intelligence-toolbar-button",title:o,iconBefore:(0,i("dh538").fg)("platform_editor_old_main_toolbar_rovo_icon_update")?g.createElement("span",{className:(0,i("gMc0m").default)(["_1ul97vkz _1e0c1txw _1bah1h6o _4cvr1h6o"])},g.createElement(i("9J8UT").AIChatIcon,{label:"atlassian-intelligence-toolbar-button-icon"})):g.createElement("span",{className:(0,i("gMc0m").default)(["_1ul91tcg"])},g.createElement(i("lAFHW").RovoIcon,{label:"atlassian-intelligence-toolbar-button-icon",size:"small",appearance:"neutral"})),disabled:a},(!s||s>=1076)&&r(i("SFzFl").default.aiUniversalShortCallToAction))},sN=({onClick:e,disabled:t,ButtonWrapper:n,api:a,view:r})=>{let[o,s]=(0,g.useState)(!1),l=g.createElement(sM,{api:a,view:r,onClick:e,isDisabled:t}),c=sx(n);return g.createElement("span",{ref:e=>{s(sw(e))},className:(0,i("gMc0m").default)(["_1e0c1txw _4cvr1h6o _18u0idpf _1ul91wug","_p7r11txw _1xdi1txw _1ylx1txw _1fvdglyw _1c1bglyw"])},o&&g.createElement(i("jN96M").ToolbarSeparator,null),n?g.createElement(n,{key:`${c}-key-wrapper`},l):l)},sO=({editorView:t,api:n,editorPluginAIProvider:a,aiGlobalOptIn:r,disabled:o})=>{let s=(0,i("b3YrF").useSharedPluginStateSelector)(n,"connectivity.mode"),l=(0,i("b3YrF").useSharedPluginStateSelector)(n,"aiExperience.aiButtonState"),c=(0,i("91bcx").isOfflineMode)(s);return e(g).createElement(sN,{api:n,ButtonWrapper:a?.AIButtonWrapper,onClick:()=>{let{state:e,dispatch:n}=t,o=a.baseGenerate;(0,i("5SuLc").createOpenAIModalCommand)({state:e,configItem:o,lastTriggeredFrom:"mainToolbar",aiGlobalOptIn:r,triggeredFor:l?.triggeredFor})(e,n)},disabled:o||c||!l?.isSelectionValidForAIExperience,view:t})},sR=({api:t,editorPluginAIProvider:n,aiGlobalOptIn:i})=>({editorView:a,disabled:r})=>a?e(g).createElement(sO,{editorView:a,api:t,editorPluginAIProvider:n,aiGlobalOptIn:i,disabled:r}):null,sD=({api:t,editorView:n,editorPluginAIProvider:a,aiGlobalOptIn:r})=>{let o=(0,i("b3YrF").useSharedPluginStateSelector)(t,"aiExperience.aiButtonState");return e(g).createElement(sN,{ButtonWrapper:a?.AIButtonWrapper,onClick:()=>{let{state:e,dispatch:t}=n,s=a.baseGenerate;(0,i("5SuLc").createOpenAIModalCommand)({state:e,configItem:s,lastTriggeredFrom:"mainToolbar",aiGlobalOptIn:r,triggeredFor:o?.triggeredFor})(e,t)},disabled:!o?.isSelectionValidForAIExperience,view:n})},sL=({api:t,editorPluginAIProvider:n,aiGlobalOptIn:i})=>({editorView:a})=>a?e(g).createElement(sD,{api:t,editorView:a,editorPluginAIProvider:n,aiGlobalOptIn:i}):null,sF=({editorPluginAIProvider:e,aiGlobalOptIn:t,api:n})=>(a,r)=>{let o;if(e.disableAISelectionToolbar)return;let s=(0,m.editorExperiment)("platform_editor_offline_editing_web",!0)&&(0,i("91bcx").isOfflineMode)(n?.connectivity?.sharedState?.currentState()?.mode),l=n?.engagementPlatform?.sharedState.currentState()?.messageStates["cc-editor-ai_ai-toolbar-button-pulse"],c=()=>{if(e.isInDocumentStreamingEnabled){let{charCount:e,wordCount:t}=(0,i("4SGh1").selectionCharWordCount)(a);(0,i("4SGh1").fireButtonViewedAnalyticsEvent)({api:n,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.AI_ASK_ROVO_BUTTON,attributes:{selectionCharCount:e,selectionWordCount:t}})}n?.engagementPlatform?.actions.startMessage("cc-editor-ai_ai-toolbar-button-pulse")};if(e.isInDocumentStreamingEnabled){let{charCount:e,wordCount:t}=(0,i("4SGh1").selectionCharWordCount)(a);o=()=>{(0,i("4SGh1").fireButtonViewedAnalyticsEvent)({api:n,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.AI_HERO_PROMPT_BUTTON,attributes:{selectionCharCount:e,selectionWordCount:t}})}}let d=sT({intl:r,hideTitle:!1,aiGlobalOptIn:t,disabled:s,onMount:o,isInDocumentStreamingEnabled:e.isInDocumentStreamingEnabled});return e.isInDocumentStreamingEnabled?{rank:10,isToolbarAbove:!0,items:[sv({intl:r,rangeBaseGenerate:e.baseGenerate,aiGlobalOptIn:t,disabled:s,editorPluginAIProvider:e,api:n,pulse:l,onMount:c}),d]}:(0,i("dh538").fg)("ai-smart-button-team-25")||(0,m.editorExperiment)("platform_editor_controls","variant1")?{rank:10,isToolbarAbove:!0,items:[d,sC({intl:r,rangeBaseGenerate:e.baseGenerate,aiGlobalOptIn:t,pulse:l,onMount:c,disabled:s}),...(0,m.editorExperiment)("platform_editor_controls","variant1")?[{type:"separator",fullHeight:!0}]:[]]}:{rank:-10,isToolbarAbove:!0,items:[d,sb({intl:r,rangeBaseGenerate:e.baseGenerate,hideTitle:!0,aiGlobalOptIn:t,title:i("7ShCl").aiMessages.tryAIToolbarIconTitle,tooltip:i("7ShCl").aiMessages.tryAIToolbarIconTooltip,pulse:l,onMount:c,disabled:s})]}},sG=new iv({id:"EditorPluginAI",description:`This machine models the high level functionality of the EditorPluginAI.

Currently this logic is split across prosemirror, xstate, and elsewhere.

The intention is to migrate to a single source of truth, backed by a state machine.`,states:{"No AI experience active":{description:`When an Editor is first started up with an editor-plugin-ai EditorPlugin - it will start in this state.

This state will be returned to when an ai experience is either discarded or completed.`},"AI Modal active":{on:{AI_CONTENT_INSERTED:"AI Content Highlighted",MODAL_DISCARDED:{target:"No AI experience active",description:"This transition is intended to model when a user makes an explicit decision to clear the modal."},MODAL_INVALIDATED:{target:"No AI experience active",description:`This transition is intended to model when an AI experience is ended due to the modal no longer being valid.

For example, if it's been linked to a selection, and another user collaborating on the document deletes the selected content.

In future we might expect this to go to an alternate state.`}},description:`Currently there is a seperate xstate state machine which is run when the ai modal is active.
Over time we can expect to link these state machines.`},"AI Content Highlighted":{on:{SELECTION_CHANGED:{target:"No AI experience active",description:"This transition models when a user interacts with a document following the insertion of content via AI."}},description:`Following content being inserted, the inserted content is highlighted so the user is able to understand the impact of inserting the generated content into the document.

This highlight is persisted either until the user changes makes a selection change in the document or the content is removed from the document (ie. via collab editing sessions)`}},on:{START_AI_EXPERIENCE:{target:"#EditorPluginAI.AI Modal active",description:`We expect AI Experiences to be started in a variety of ways including;
- via the slash command/typeahead
- via the toolbar quick insert menu
- via the toolbar ai button
- via external actions (ie. atlas have a button outside the editor which starts an ai experience)

Only one AI experience can be active at a single time in an Editor.  If another AI experience is active when the user starts a new AI experience, the prior experience is replaced/reset with the new experience details.`}},initial:"No AI experience active"},void 0);class sB extends WeakMap{getActor(e){if(this.has(e))return this.get(e);let t=(0,i("d0N4G").A)(sG);return t.start(),sU.set(e,t),t}}let sU=new sB;t.exports.aiPlugin=({config:t,api:n})=>{let a,r,o,s=t,l=t.aiGlobalOptIn,c=e=>{a=e},d=!!n?.toolbar,p=()=>{let{isInDocumentStreamingAllowed:e=!0}=s?.getUserPreferences?.()??{};return!!s.isInDocumentStreamingEnabled&&e},u=e=>{r=e},S=async e=>{if(!o||!(0,i("bqMS3").isResolvingMentionProvider)(o))return;let t=o.resolveMentionName(e);return(0,i("6mYMS").isPromise)(t)?await t:t},C=()=>{let e=(t,n)=>{n&&n.then(t=>{o=t,r.unsubscribe("mentionProvider",e)})};r.subscribe("mentionProvider",e)},v=()=>{s?.providers?.mediaProvider&&r.setProvider("mediaProvider",Promise.resolve(s.providers.mediaProvider))},P=()=>{let{emojiProvider:e}=n?.emoji?.sharedState.currentState()||{};if(e)r.setProvider("emojiProvider",Promise.resolve(e));else{let e=n?.emoji?.sharedState.onChange(t=>{t.nextSharedState?.emojiProvider&&(r.setProvider("emojiProvider",Promise.resolve(t.nextSharedState.emojiProvider)),e?.())})}},k=()=>{let{extensionProvider:e}=n?.extension?.sharedState.currentState()||{};if(e)r.setProvider("extensionProvider",Promise.resolve(e));else{let e=n?.extension?.sharedState.onChange(t=>{t.nextSharedState?.extensionProvider&&(r.setProvider("extensionProvider",Promise.resolve(t.nextSharedState.extensionProvider)),e?.())})}},x=l||{status:"enabled",triggerOptInFlow:()=>{}},w=t=>{let n=[];return s.disableQuickInsert||(s.isInDocumentStreamingEnabled?n.push(s.baseGenerate):n.push(s.baseGenerate,...q({configItemWithOptions:s.configItemWithOptions,editorView:a,positions:[0,0],isEmpty:!0}))),function({configItems:t,formatMessage:n,aiGlobalOptIn:a,editorView:r,locale:o}){let s=r.dispatch;return t.map(t=>({priority:t.quickInsertPriority??9e3,categories:["AI"],title:$(t,n),description:n(t.description||t.title),keywords:["ai","generate","rovo",$(t,n)],icon:()=>t.icon?t.icon({formatMessage:n}):e(g).createElement(i("3ZqD0").default,{label:"",size:"small"}),action:(e,n)=>(requestAnimationFrame(()=>{(0,i("5SuLc").createOpenAIModalCommand)({state:r.state,configItem:t,lastTriggeredFrom:"quickInsert",aiGlobalOptIn:a,locale:o})(r.state,s)}),e("")),isDisabledOffline:!0}))}({configItems:n,formatMessage:t.formatMessage,aiGlobalOptIn:x,editorView:a,locale:t.locale})};if(w.disableMemo=!0,d){let e=t.configItemWithOptions?.[0]?.config?.key===i("bwpRs").CONFIG_ITEM_KEYS.ADD_STRUCTURE;n?.toolbar?.actions.registerComponents(sy({aiGlobalOptIn:x,editorPluginAIProvider:s,shouldShowImproveDescription:e,getAdditionalProps:t.getAdditionalProps,isNewToolbarEnabled:!0,api:n}))}else s?.hidePrimaryToolbarButton||n?.primaryToolbar?.actions.registerComponent({name:"aiExperience",component:sR({api:n,editorPluginAIProvider:s,aiGlobalOptIn:x})});let M=(0,i("4F0gv").isAdfStreamingEnabled)();return{name:"aiExperience",pmPlugins:()=>{let e=[{name:"ai-content-state",plugin:()=>tj()},{name:"ai-experience-actor",plugin:()=>new(0,i("1S4f7").SafePlugin)({view:e=>{let t=sU.getActor(e);return{destroy:()=>{t?.stop(),sU.delete(e)}}}})},{name:"aiExperience",plugin:e=>{let t={action:"init",actionSubject:"editor",actionSubjectId:"editorPluginAI",eventType:i("d925B").EVENT_TYPE.TRACK,attributes:{aiGlobalOptIn:x?.status}};return e.dispatchAnalyticsEvent(t),tU({dispatchAnalyticsEvent:e.dispatchAnalyticsEvent,dispatch:e.dispatch,api:n,isInDocumentStreamingEnabled:s.isInDocumentStreamingEnabled})}},{name:"ai-experience-get-editor-view-and-provider-factory",plugin:e=>(u(e.providerFactory),C(),v(),P(),M&&k(),tz({setEditorView:c}))},{name:"ai-experience-ai-button",plugin:()=>F()},{name:"ai-experience-selection-preview",plugin:()=>nw()},{name:"inline-suggestions",plugin:({dispatch:e,getIntl:t})=>nP({dispatch:e,getIntl:t,api:n})}];if((0,i("dh538").fg)("platform_editor_ai_migrate_from_xstate")&&e.push({name:"ai-session-context",plugin:e=>tm(e)}),s.isInDocumentStreamingEnabled&&e.push({name:"ai-experience-placeholder-controller",plugin:()=>nk({api:n,editorPluginAIProvider:s})}),e.push({name:"ai-event-hub",plugin:({getIntl:e})=>e1({aiGlobalOptIn:x,editorPluginAIProvider:s,getIntl:e,api:n})}),s.isRovoEnabled&&(e.push({name:"editor-ai-rovo-agents",plugin:e=>new(0,i("1S4f7").SafePlugin)({key:i("47Psn").rovoAgentsPluginKey,state:(0,i("6bKwm").createPluginState)(e.dispatch,{agents:[],enabled:!1,publish:()=>{},isBrowseModalOpen:!1,positions:void 0,initialised:!1})})}),e.push({name:"ai-experience-selection",plugin:()=>nN({api:n,editorPluginAIProvider:s})})),s.auditLogSettings&&s.auditLogSettings.enabled&&(0,i("dh538").fg)("platform_editor_ai_audit_logs_events")){let t=s.auditLogSettings.eventData;e.push({name:"ai-audit-log",plugin:({dispatch:e})=>R({dispatch:e,eventData:t})})}let{aiSmartButtonOptions:t,dynamicSurfaceConfigItems:a}=s;return t&&a&&(0,i("dh538").fg)("ai-smart-button-team-25")&&e.push({name:"ai-smart-button-api",plugin:({getIntl:e,dispatch:r})=>tF({aiGlobalOptIn:x,aiSmartButtonOptions:t,api:n,dispatch:r,dynamicSurfaceConfigItems:a,getIntl:e,proactiveAIApiUrl:(0,i("klIiV").deriveProactiveAIApiUrl)(),product:s.product,getMentionNameDetails:S})}),(0,m.editorExperiment)("platform_editor_ai_quickstart_command",!0,{exposure:!0})&&e.push({name:"ai-quickstart-command",plugin:({getIntl:e})=>tu({aiGlobalOptIn:x,editorPluginAIProvider:s,getIntl:e})}),s.isInDocumentStreamingEnabled&&(e.push({name:"in-editor-direct-streaming",plugin:({getIntl:e})=>t4({getIntl:e,api:n})}),e.push({name:"ai-annotation-watchmen",plugin:()=>A({onAnnotationsRemoved:s.onAnnotationsRemoved})}),e.push({name:"ai-monitor-watchmen",plugin:()=>tc(n,p)}),"CONFLUENCE"===s.product&&(0,i("dh538").fg)("platform_editor_ai_aifc_space_shortcut")&&e.push({name:"ai-space-shortcut",plugin:({getIntl:e})=>{var t;return t={aiGlobalOptIn:x,editorPluginAIProvider:s,getIntl:e},(0,i("dus6D").keymap)({[`${i("hgeg8").space.common}`]:(e,n,a)=>{if(!a)return!1;let{from:r,to:o,$to:s}=e.selection;if(t.editorPluginAIProvider.isInDocumentStreamingEnabled?r===o&&(0,i("l9G9n").isEmptyParagraph)(s.parent)&&(0,i("l9G9n").hasDocAsParent)(s):(0,i("2pjJ5").isEmptyDocument)(e.doc)){let{editorPluginAIProvider:a,aiGlobalOptIn:r}=t,o=a.baseGenerate;return(0,i("5SuLc").createOpenAIModalCommand)({state:e,configItem:o,lastTriggeredFrom:"spaceShortcut",triggerMethod:"shortcut",aiGlobalOptIn:r,locale:t.getIntl().locale})(e,n),!0}return!1}})}})),e},actions:{openAIModal:({invokedFrom:e,configItem:t=s.baseGenerate,withAcceptReject:n,withStreamingHighlight:i,hideLoadingScreen:r})=>{h({invokedFrom:e,editorView:a,aiOptIn:x,configItem:t,withAcceptReject:n,withStreamingHighlight:i,isExternal:!0,hideLoadingScreen:r})},endAIExperience:()=>{_({editorView:a})},getAiExperienceActor:()=>{if(!a)throw Error("editorView is not defined");let e=iN.getActor(a);if(!e)throw Error("No cached item found");return e},getAISelectionContext:()=>{let e=n?.selection?.sharedState.currentState()?.selection?.content().content;return n?.aiExperience?.sharedState.currentState()?.selectionContext??{selectionFragment:n?.selection?.actions.getSelectionFragment()??null,localIds:n?.selection?.actions.getSelectionLocalIds()??null,selectionMarkdown:e?(0,i("6eZqW").convertProsemirrorNodeToMarkdown)({node:e})?.markdown:null}},getPartialDocumentFromSelection:e=>b({selection:a?.state.selection,maxSize:e}),getPartialMarkdownFromSelection:e=>T({selection:a?.state.selection,maxSize:e}),startSession:e=>{n?.core?.actions.execute(n?.history?.commands?.startHistorySlice("ai")),y({editorView:a,sessionId:e})},endSession:e=>{I({editorView:a,sessionId:e}),n?.core?.actions.execute(n?.history?.commands?.endHistorySlice("ai"))},updateTargetId:e=>{E({editorView:a,targetId:e})},dispatchAIEvent:e=>{(0,i("dh538").fg)("platform_editor_ai_migrate_from_xstate")&&n?.core.actions.execute(tI(e));let t=(0,i("1xicG").normaliseAIExperienceEvent)(e);n?.aiExperience?.actions.getAiExperienceActor()?.send(t)}},getSharedState:e=>e?{nonCursorSelectionChangeCount:(i("fXyZM").selectionPluginKey.getState(e)??{})?.nonCursorSelectionChangeCount,aiButtonState:{triggeredFor:(L.getState(e)??{}).triggeredFor,isSelectionValidForAIExperience:(L.getState(e)??{}).isSelectionValidForAIExperience},aiDecorationExperiencePluginState:{isRunning:(i("3yUTv").aiExperienceDecorationPluginKey.getState(e)??{}).isRunning??!1,modalDecorationSet:(i("3yUTv").aiExperienceDecorationPluginKey.getState(e)??{}).modalDecorationSet??i("ftzrq").DecorationSet.empty,configItem:(i("3yUTv").aiExperienceDecorationPluginKey.getState(e)??{}).configItem,lastTriggeredFrom:(i("3yUTv").aiExperienceDecorationPluginKey.getState(e)??{}).lastTriggeredFrom,modalMountedTimeStamp:(i("3yUTv").aiExperienceDecorationPluginKey.getState(e)??{}).modalMountedTimeStamp,triggerMethod:(i("3yUTv").aiExperienceDecorationPluginKey.getState(e)??{}).triggerMethod,initialPrompt:(i("3yUTv").aiExperienceDecorationPluginKey.getState(e)??{}).initialPrompt,triggeredFor:(i("3yUTv").aiExperienceDecorationPluginKey.getState(e)??{}).triggeredFor,initialPositions:(i("3yUTv").aiExperienceDecorationPluginKey.getState(e)??{}).initialPositions,positions:(i("3yUTv").aiExperienceDecorationPluginKey.getState(e)??{}).positions,nudgeMetrics:(i("3yUTv").aiExperienceDecorationPluginKey.getState(e)??{}).nudgeMetrics,currentSessionId:(i("3yUTv").aiExperienceDecorationPluginKey.getState(e)??{}).currentSessionId,nextSessionId:(i("3yUTv").aiExperienceDecorationPluginKey.getState(e)??{}).nextSessionId,interactionSessionId:(i("3yUTv").aiExperienceDecorationPluginKey.getState(e)??{}).interactionSessionId,hideLoadingScreen:(i("3yUTv").aiExperienceDecorationPluginKey.getState(e)??{}).hideLoadingScreen,targetId:(i("3yUTv").aiExperienceDecorationPluginKey.getState(e)??{}).targetId,isInDocumentStreamingEnabled:(i("3yUTv").aiExperienceDecorationPluginKey.getState(e)??{}).isInDocumentStreamingEnabled},rovoAgentsPluginState:{positions:(i("47Psn").rovoAgentsPluginKey.getState(e)??{}).positions,isBrowseModalOpen:(i("47Psn").rovoAgentsPluginKey.getState(e)??{}).isBrowseModalOpen??!1,defaultAgent:(i("47Psn").rovoAgentsPluginKey.getState(e)??{}).defaultAgent},isStreaming:i("5vNOi").inEditorDirectStreamingPluginKey.getState(e)?.isStreaming??!1,isShowingAcceptRejectScreen:(i("3yUTv").aiExperienceDecorationPluginKey.getState(e)??{}).isShowingAcceptRejectScreen??!1,chunkNumber:i("5vNOi").inEditorDirectStreamingPluginKey.getState(e)?.chunkNumber??0,selectionContext:i("fXyZM").selectionPluginKey.getState(e)?.lastSelectionContext??void 0,hasVisibleContent:tV.getState(e)?.hasVisibleContent??!1,aiSessionPluginState:f.getState(e)??tg}:{nonCursorSelectionChangeCount:0,aiButtonState:{triggeredFor:void 0,isSelectionValidForAIExperience:!0},aiDecorationExperiencePluginState:{isRunning:!1,interactionSessionId:void 0,modalDecorationSet:i("ftzrq").DecorationSet.empty,configItem:void 0,lastTriggeredFrom:void 0,modalMountedTimeStamp:void 0,triggerMethod:void 0,initialPrompt:void 0,triggeredFor:void 0,initialPositions:void 0,nudgeMetrics:void 0,hideLoadingScreen:!1,targetId:void 0,isInDocumentStreamingEnabled:s.isInDocumentStreamingEnabled},rovoAgentsPluginState:{positions:void 0,isBrowseModalOpen:!1},isStreaming:!1,isShowingAcceptRejectScreen:!1,chunkNumber:0,selectionContext:void 0,hasVisibleContent:!1,aiSessionPluginState:tg},pluginsOptions:{...!d&&{selectionToolbar:sF({aiGlobalOptIn:x,editorPluginAIProvider:s,api:n})},quickInsert:w,floatingToolbar:sk({aiGlobalOptIn:x,editorPluginAIProvider:s,api:n})},contentComponent:({editorView:t,wrapperElement:i,appearance:a,providerFactory:r})=>{if(!t)return null;let o=s.isInDocumentStreamingEnabled?oa:o9;return e(g).createElement(o,{aiOptIn:x,api:n,editorView:t,wrapperElement:i,appearance:a,editorPluginAIProvider:s,providerFactory:r,getMentionNameDetails:S,canInlineStreamChanges:p,isInDocumentStreamingEnabled:!!s.isInDocumentStreamingEnabled})},primaryToolbarComponent:n?.primaryToolbar||s.hidePrimaryToolbarButton?void 0:sL({api:n,editorPluginAIProvider:s,aiGlobalOptIn:x})}}}),a("8zG4S",function(e,t){e.exports.getEditorAgent=e=>{let{id:t,name:n,description:a,named_id:r,creator_type:o,system_prompt_template:s,creator:l,visibility:c,is_default:d,identity_account_id:p,icon:u}=e;return{id:t,name:n,description:a,namedId:r,creatorType:o,systemPromptTemplate:s,creator:l??void 0,visibility:c,isDefault:d,identityAccountId:p,icon:u,conversationStarters:(0,i("jMZdB").getConversationStarters)({isAgentDefault:d,userDefinedConversationStarters:e.user_defined_conversation_starters?.map(e=>({message:e,type:"user-defined"}))}).combinedConversationStarters,externalConfigReference:e.external_config_reference}}}),a("eIhC8",function(e,t){e.exports.updateAgents=({agents:e,defaultAgent:t})=>(0,i("6bKwm").createCommand)(()=>({type:i("la6aw").ACTIONS.UPDATE_PLUGIN_STATE,data:{agents:e.filter(e=>"ai_mate_agent"!==e.namedId),defaultAgent:t,initialised:!0}})),e.exports.openBrowseAgentsModal=(e,t)=>{let n=t&&{startPos:t[0],endPos:t[1]};return(0,i("6bKwm").createCommand)(()=>({type:i("la6aw").ACTIONS.UPDATE_PLUGIN_STATE,data:{isBrowseModalOpen:e,positions:n}}))},e.exports.updatePublish=e=>(0,i("6bKwm").createCommand)(()=>({type:i("la6aw").ACTIONS.UPDATE_PLUGIN_STATE,data:{publish:e}})),e.exports.updateEnabled=e=>(0,i("6bKwm").createCommand)(()=>({type:i("la6aw").ACTIONS.UPDATE_PLUGIN_STATE,data:{enabled:e}}))}),a("04nhu",function(e,t){let n=i("4mJKd")(5);e.exports=Promise.all([n("8Qv5g"),n("4Jbf1"),n("3qsjq"),n("lUlCu"),n("3kUQf"),n("6wr18"),n("9gFpE"),n("b2FtX"),n("ffEVr"),n("6z3SN")]).then(()=>i("ckdGi"))}),a("4mJKd",function(e,t){e.exports=e=>t=>import(i("8tirZ").shardUrl(i("02nRr").resolve(t),e))}),a("8tirZ",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.applyShardToDomain=o,e.exports.domainShardingKey=void 0,e.exports.getDomainShardIndex=i,e.exports.shardUrl=function(e,t){return globalThis[n]?s(e,t):e},e.exports.shardUrlUnchecked=s;let n="__ATLASPACK_ENABLE_DOMAIN_SHARDS";function i(e,t){let n=t+1,i=e.split("").reduce((e,t)=>{let i=(e<<n)-e+t.charCodeAt(0);return i&i},0);return(i%=n)<0&&(i+=n),i}let a=/-\d+$/;function r(e){if(!a.test(e))return e;let t=e.lastIndexOf("-");return e.slice(0,t)}function o(e,t){let n=e.indexOf("."),i=0===t?"":`-${t-1}`;if(-1===n)return`${r(e)}${i}`;let a=r(e.slice(0,n));return`${a}${i}${e.slice(n)}`}function s(e,t){let n=new URL(e),a=i(function(e){let t=e.lastIndexOf("/");if(-1===t||t===e.length-1)throw Error("Expected an absolute URL with a file name, unable to apply sharding.");return e.slice(t+1)}(n.pathname),t);return n.hostname=o(n.hostname,a),n.toString()}e.exports.domainShardingKey=n}),a("02nRr",function(e,n){t(e.exports,"register",()=>i,e=>i=e),t(e.exports,"resolve",()=>a,e=>a=e);var i,a,r=new Map;i=function(e,t){for(var n=0;n<t.length-1;n+=2)r.set(t[n],{baseUrl:e,path:t[n+1]})},a=function(e){var t=r.get(e);if(null==t)throw Error("Could not resolve bundle with id "+e);return new URL(t.path,t.baseUrl).toString()}}),a("ljZgt",function(e,t){e.exports.createAgentConfigItem=(e,t)=>{let n=(0,i("jAwX6").createContinueInChatForAgent)({appearance:"secondary",agent:e,product:t.product,actionSideEffect:t.actionSideEffects?.continueInChat,actionOverride:t.actionOverrides?.continueInChat,factoryOptions:{product:t.product,isInDocumentStreamingEnabled:t.isInDocumentStreamingEnabled}});return{key:i("bwpRs").CONFIG_ITEM_KEYS.ROVO_AGENT,title:i("AMCQl").aiConfigItemMessages.agentConfigTitle,description:i("AMCQl").aiConfigItemMessages.agentConfigDescription,statusLozengeType:"beta",promptHint:i("AMCQl").aiConfigItemMessages.agentConfigPromptHint,promptLabel:{defaultMessage:e?.name,id:`fabric.editor.ai.config.item.range.agent.${e?.name.toLocaleLowerCase().replace(/\s+/g,".")||"label"}`},disableInterrogation:()=>!1,agent:e,intentSchemaId:"DISABLED",getBackendModel:()=>"assistance-service",actions:{empty:[n,(0,i("jc4DP").createInsertAtCurrentPosition)({appearance:"primary",isRovoAgentAction:!0})],selection:[n,(0,i("jc4DP").createReplace)({appearance:"primary",isRovoAgentAction:!0})]}}}}),a("dF1N1",function(e,t){var n=i("42omo");function a(e){return"number"==typeof e}function r(e){return"object"==typeof e&&null!==e&&a(e.initialDelaySec)&&a(e.stepDelaySec)&&a(e.flushDelaySec)&&a(e.growthFactor)}function o(e,t){return i("c6GJD").default.getExperimentValue("platform-editor-ai-streaming-speed",e,t,{typeGuard:a})}let s="\x1b[0m";class l{add(e){if((0,i("dh538").fg)("platform_editor_editor_debugging_panel")){try{if(window.top?.__aifcDebuggerEnabled__){let{type:t,message:n}=e;console.log(`\x1b[35m[AIFC]:EditorStreamQueue${s} ${"Public"===t?"\x1b[32m":"Queue"===t?"\x1b[34m":"\x1b[31m"}${t}${s} ${n}`,e)}}catch(e){}this.logs.push({type:e.type,message:e.message,timestamp:e.timestamp}),this.logs.length>this.MAX_LENGTH&&this.logs.shift()}}logPublic(e,t){this.add({type:"Public",message:e,...t,timestamp:new Date})}logError(e,t){this.add({type:"Error",message:e,...t,timestamp:new Date})}logQueueState(e,t){this.add({type:"Queue",message:e,...t,timestamp:new Date})}getAdf(){let e;if(this.api)return this.api.core.actions.execute(({tr:t})=>(e=t.doc.toJSON(),null)),e}getDebugInformation(){return{logs:this.logs,adf:this.getAdf(),selection:this.api?.selection?.actions.getSelectionFragment()??void 0,localIds:this.api?.selection?.actions.getSelectionLocalIds()??void 0}}constructor(e){if(this.api=e,this.logs=[],this.MAX_LENGTH=100,(0,i("dh538").fg)("platform_editor_editor_debugging_panel")&&window.top)try{window.top.__aifcEditorDebugData__=()=>this.getDebugInformation()}catch(e){}}}function c(e){let t;return e?.core.actions.execute(({tr:e})=>(t=e.doc,null)),t}function d(e,t){let n;return e.descendants((e,i,a)=>!n&&(e.attrs.localId===t&&(n={node:e,pos:i,parent:a}),!n)),n}function p(e,t){let n;if(t)return e?.core.actions.execute(({tr:e})=>(n=d(e.doc,t)?.node,null)),n}function u(e,t,n,a,r){let o=((0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")&&r?function(e,t){let n;return e.descendants((e,i,a)=>e.attrs.localId!==t||(n={node:e,pos:i,parent:a},!1)),n}:d)(t.doc,n);if(o&&a(o),!o){let t;if(e?.core.actions.execute(({tr:e})=>(t=e.doc.nodeSize,null)),e?.analytics?.actions.fireAnalyticsEvent({action:i("d925B").ACTION.LOCAL_ID_NOT_FOUND,actionSubject:i("d925B").ACTION_SUBJECT.AI_STREAMING,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.EXPERIENCE_APPLICATION,eventType:i("d925B").EVENT_TYPE.OPERATIONAL,attributes:{localIdLength:n?.length,docSize:t}}),(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga"))return null;throw Error(`Node with localId ${n} not found`)}return t}let g=new(0,i("h9yJL").JSONTransformer);function m(e,t,n){let a=e?.core.sharedState.currentState()?.schema;if(!a||!t)return{adfDoc:t};try{let e=a.node("doc",null,[a.node("paragraph",null,[])]),r=new(0,i("aXG5V").Transform)(e),o=i("5SAOw").Node.fromJSON(a,t),s=r.replaceWith(0,2,o).doc;if((0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga"))return{doc:s,adfDoc:"replaceNode"===n||(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?t:g.encode(s)};return{doc:s,adfDoc:g.encode(s)}}catch{return{adfDoc:t}}}function f({api:e,command:t,docBeforeStreaming:n}){let a=c(e);if(n&&a){let t=n.eq(a),r=(0,i("2pjJ5").areNodesEqualIgnoreAttrs)(n,a);(t||r)&&e.analytics?.actions.fireAnalyticsEvent({action:i("d925B").ACTION.NO_DOC_CHANGE_FOUND,actionSubject:i("d925B").ACTION_SUBJECT.AI_STREAMING,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.EXPERIENCE_APPLICATION,eventType:i("d925B").EVENT_TYPE.OPERATIONAL,attributes:{isSameDoc:t,isSameDocIgnoreAttrs:r}})}}function h(e){return["replaceNode","insertNodeBefore","insertNodeAfter","appendNode","appendNodeToEnd"].includes(e.type)}let _=e=>()=>e.core.actions.execute(({tr:e})=>{let t;if((0,i("2pjJ5").isEmptyDocument)(e.doc))t=i("ks2lK").Selection.atEnd(e.doc);else{let n=e.doc.resolve(e.doc.content.size);e.insert(n.pos,e.doc.type.schema.nodes.paragraph.create()),t=i("ks2lK").TextSelection.create(e.doc,n.pos+1)}if(!t)throw Error("Failed to create selection");return e.setSelection(t).scrollIntoView(),e}),y=["listItem","taskItem","decisionItem"],I=e=>t=>e.core.actions.execute(({tr:n})=>u(e,n,t.localId,({pos:e,node:t,parent:a})=>{if("tableRow"===t.type.name&&a){let t=i("LmqWp").TableMap.get(a),r=n.doc.resolve(e),o=r.start(r.depth),s=t.findCell(e-o+1);(0,i("9MzzS").addRow)(n,{map:t,table:a,tableStart:o},s.bottom);let l=n.doc.resolve(e),c=l.node(l.depth),d=i("LmqWp").TableMap.get(c).mapByRow[s.bottom],p=i("7XFGZ").CellSelection.rowSelection(n.doc.resolve(d[0]+o),n.doc.resolve(d[d.length-1]+o));n.setSelection(p).scrollIntoView()}else if(y.includes(t.type.name)&&a&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")){let a=i("ks2lK").TextSelection.create(n.doc,e+t.nodeSize);n.setSelection(a).scrollIntoView()}else{let a=Math.min(e+t.nodeSize,n.doc.content.size);if((0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga"))for(a=e+t.nodeSize;a<n.doc.content.size;){let e=n.doc.resolve(a),t=null;if(0===e.depth){let i=e.indexAfter(0);i<n.doc.childCount&&(t=n.doc.child(i))}else t=e.nodeAfter;if(t&&!t.attrs.localId)a+=t.nodeSize;else break}("tableCell"===t.type.name||"tableHeader"===t.type.name)&&a--,n.insert(a,n.doc.type.schema.nodes.paragraph.create());let r=i("ks2lK").TextSelection.create(n.doc,a+1);n.setSelection(r).scrollIntoView()}},!0)),E=e=>t=>e.core.actions.execute(({tr:n})=>u(e,n,t.localId,({pos:e})=>{let t=new(0,i("ks2lK").TextSelection)(n.doc.resolve(e));n.setSelection(t).scrollIntoView()})),S=e=>t=>e.core.actions.execute(({tr:n})=>u(e,n,t.localId,({node:e,pos:t})=>{n.delete(t,t+e.nodeSize).scrollIntoView()})),b=e=>t=>e.core.actions.execute(({tr:n})=>u(e,n,t.localId,({pos:e,node:t})=>{let a=null;if("table"!==t.type.name||(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga"))if(i("ks2lK").NodeSelection.isSelectable(t))a=i("ks2lK").NodeSelection.create(n.doc,e);else{let r=t.type.spec.tableRole;if("cell"===r||"header_cell"===r)a=i("7XFGZ").CellSelection.create(n.doc,e);else if("row"===r){let t=n.doc.resolve(e+1);a=i("7XFGZ").CellSelection.rowSelection(t,t,!0)}else{let r=n.doc.resolve(e),o=n.doc.resolve(e+t.nodeSize);a=i("ks2lK").TextSelection.between(r,o)}}else n.replaceRangeWith(e,e+t.nodeSize,n.doc.type.schema.nodes.paragraph.create()),a=i("ks2lK").TextSelection.create(n.doc,e+1);a&&n.setSelection(a).scrollIntoView()})),T=(e,t)=>{let n={};for(let i in e)t.attrs?.hasOwnProperty(i)&&(n[i]=e[i]);return n},C=e=>t=>e.core.actions.execute(({tr:n})=>{let i=!1;return u(e,n,t.localId,({node:e,pos:a})=>{if(e){let r=t.attrs;if(!r||"object"!=typeof r)return;let o=T(r,e.type.spec);e.type.spec.attrs,n.setNodeMarkup(a,e.type,{...e.attrs,...o}),i=!0}}),i?n:null}),A=new(0,i("3KVX0").default)(i("4rpi6").panel.props.attrs.props.panelType.values),v=e=>t=>{let n,a=!1,r=!1,o=[],s=[];if(e.core.actions.execute(({tr:l})=>{try{u(e,l,t.localId,({node:e,pos:c})=>{let d=l.doc.resolve(c),p=l.doc.resolve(c+e.nodeSize),u=d.blockRange(p);if(u){let e=l.doc.type.schema.nodes[t.wrapperType],c=t.wrapperAttrs;if("panel"===t.wrapperType&&void 0!==c.panelType){let e=t.wrapperAttrs.panelType,n=A.search(e);n.length?c.panelType=n[0].item:c.panelType="info"}try{let t=(0,i("aXG5V").findWrapping)(u,e,c);if(null!==t)l.wrap(u,t).scrollIntoView(),a=!0;else{let t=l.doc.slice(u.$from.pos,u.$to.pos).content,n=e.createAndFill(c,t);if(n||(n=function(e,t,n){if(!e.firstChild)return null;let i=t.contentMatch.findWrapping(e.firstChild.type),a=null;if(i){a=e.content;for(let e=i.length-1;e>=0;e--){let t=i[e].createAndFill(null,a);if(t)a=[t];else{a=null;break}}}return a?t.createAndFill(n,a):null}(t,e,c)),n){let e=function(e,t){for(let n=t.depth;n>=0;n--)if(t.node(n).type.contentMatch.matchType(e.type))return t.after(n+1);return null}(n,p);null!==e&&(l.insert(e,n).scrollIntoView(),l.replaceRange(u.$from.pos,u.$to.pos,i("5SAOw").Slice.empty),a=!0,r=!0)}o=function(e){let t=[];for(let n=e.depth;n>=0;n--){let i=e.node(n);t.push(i.type.name)}return t}(p),s=t.content.map(e=>e.type.name)}}catch(e){n=e,console.error(e)}}})}catch(e){n=e,console.error(e)}return l}),!a||r){let t=i("2QlXt").ErrorUtils.extractErrorMessage(n),l="";n instanceof Error&&(l=n.stack||""),e?.analytics?.actions.fireAnalyticsEvent({action:i("d925B").ACTION.INVALID_COMMAND_FOUND,actionSubject:i("d925B").ACTION_SUBJECT.AI_STREAMING,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.EXPERIENCE_APPLICATION,eventType:i("d925B").EVENT_TYPE.OPERATIONAL,attributes:{success:a,repaired:r,ancestors:o,fragments:s,errorMessage:t,errorStack:l}})}return a};class P{isActorReady(){try{let e=this.api.aiExperience.actions.getAiExperienceActor(),t=this.api.aiExperience.sharedState.currentState();return e&&t?.isStreaming===!0}catch{return!1}}commandToProcess(e){let{type:t,actionId:n,chunk:i}=e;return"initStream"===t?this.initStreamPromise(e.command,e.options):"endStream"===t?this.endExperiencePromise(e):this.processStreamCommandPromise(n,i)}async processQueue(){if(this.processingQueue)return;this.queueTimeout&&clearTimeout(this.queueTimeout),this.processingQueue=!0;let e=[...this.queue].filter(e=>e.actionId===this.currentAction?.id);this.inProcessing=[...new Set(e.map(e=>e.actionId))],this.queue=this.queue.filter(t=>!e.includes(t));try{for(let t of((0,i("dh538").fg)("platform_editor_ai_aifc_background")&&(e=function(e){let t=[];for(let n of e){let e=t[t.length-1];"streamCommand"===n.type&&e&&"streamCommand"===e.type&&n.actionId===e.actionId?e.chunk+=n.chunk:t.push(n)}return t}(e)),e)){if(this.aborted.includes(t.actionId)){"endStream"===t.type&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")&&this.resolvePendingQueue(!0);continue}await this.wrapInTimeout(this.commandToProcess(t),t)}}finally{this.processingQueue=!1;let t=e.pop();this.inProcessing=[],t?.type==="endStream"&&this.checkAndResolveEmptyQueue()}this.queue.filter(e=>e.actionId===this.currentAction?.id).length>0?this.processQueue():this.queue.length>0&&(this.queueTimeout=setTimeout(()=>{this.logger.logError("Current stream queue timed out while starting next",{actionId:this.currentAction?.id??void 0}),this.resolvePendingQueue(!0),this.processQueue()},this.CURRENT_QUEUE_TIMEOUT))}onEmptyQueue(){if((0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")){let e=new Promise(e=>{this.onEmptyQueueResolve=e});return this.checkAndResolveEmptyQueue(),e}return 0===this.queue.length?Promise.resolve():new Promise(e=>{this.onEmptyQueueResolve=e})}async wrapInTimeout(e,t){let{promise:n,resetTimeout:i}=function(e,t){let n,i,{timeout:a,onTimeout:r,onCleanup:o}=t,s=!1,l=()=>{s||(n&&clearTimeout(n),n=setTimeout(()=>{s||(r(),i?.())},a))},c=new Promise(e=>{i=e});return l(),{resetTimeout:l,promise:Promise.race([e,c]).finally(()=>{s=!0,n&&clearTimeout(n),o?.()})}}(e,{timeout:this.COMMAND_TIMEOUT,onTimeout:()=>{this.logger.logError(`Stream command timed out ${t.type}`,{actionId:t.actionId,chunk:t.chunk})},onCleanup:()=>{this.currentCommandTimeoutReset=null,"endStream"===t.type&&this.checkAndResolveEmptyQueue(),this.resolvePendingQueue()}});this.currentCommandTimeoutReset=i,await n}endStreamCommand(e){return this.endedActionIds.includes(e)?void this.logger.logPublic("End Stream Command Ignored",{actionId:e}):(this.endedActionIds.push(e),this.endedActionIds.length>10&&this.endedActionIds.shift(),this.logger.logPublic("End Stream Command",{actionId:e}),this.hideLoadingScreen=!1,this.aborted.includes(e)||this.isAborted)?void this.updateAbortedCache([e]):void(this.queue.push({type:"endStream",actionId:e,chunk:void 0,reason:"endCurrentStream"}),this.processQueue())}endExperience(){this.isFinalStream||(this.logger.logQueueState("End AI Experience"),this.api.aiExperience.actions.endAIExperience()),this.isFinalStream=!1,this.hideLoadingScreen=!1,this.adfStreamer?.reset(),this.streamFlowPacer?.reset(),this.subscription?.()}resolvePendingQueue(e=!1){if(e||this.isPendingResolveQueue){let t=this.queue.find(e=>"initStream"===e.type)??null;this.logger.logQueueState("Resolve Pending Queue",{actionId:t?.actionId,reason:e?"timeout":"isPendingResolveQueue"}),this.currentAction=t?{id:t.actionId,isCreateAction:"appendNode"===t.command.type&&"create"===t.command.streamingType,initialNode:p(this.api,"replaceNode"===t.command.type&&t.command.localId),type:t.command.type}:null,this.isPendingResolveQueue=!1}}checkAndResolveEmptyQueue(){0===this.queue.length&&0===this.inProcessing.length&&this.onEmptyQueueResolve?.()}endNonStreamble(){if((0,i("dh538").fg)("platform_editor_ai_migrate_from_xstate"))this.api.aiExperience.actions.dispatchAIEvent({type:"complete",adfResponse:void 0});else{let{send:e}=this.api.aiExperience.actions.getAiExperienceActor();e({type:"complete",markdown:"",adfResponse:void 0,cacheKey:"",modelInput:{}})}}async endExperiencePromise(e){let{actionId:t,reason:n}=e;this.logger.logQueueState("End Experience",{actionId:t,reason:n}),this.isPendingResolveQueue="endCurrentStream"===n;let a="endCurrentStream"===n,r=!(this.currentAction?.type&&!h({type:this.currentAction?.type}));return this.isStreaming&&r?(await this.processStreamCommandPromise(t,"",!0),this.currentAction?.type==="replaceNode"&&function({api:e,initialNode:t,lastDoc:n}){e?.analytics?.actions.fireAnalyticsEvent({action:"replaceNodeAction",actionSubject:"editorPluginAI",actionSubjectId:"orchestratorReplaceNode",eventType:i("d925B").EVENT_TYPE.TRACK,attributes:{attributeOnlyChange:function(e,t,n){let a=e?.core.sharedState.currentState()?.schema;if(!t||!n||!a||!t.attrs.localId)return!1;let r=m(e,n,void 0)?.doc;if(!r)return!1;let o=d(r,t.attrs.localId)?.node;return(o&&!t.eq(o)&&(0,i("2pjJ5").areNodesEqualIgnoreAttrs)(t,o))??!1}(e,t,n),nodeName:t?.type.name}})}({api:this.api,initialNode:this.currentAction.initialNode,lastDoc:this.adfStreamer?.getLastDoc()}),f({api:this.api,command:this.currentCommand,docBeforeStreaming:this.docBeforeStreaming})):!r&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")&&(this.isFinalStream=!0),new Promise(e=>{let o=()=>{this.endExperience(),setTimeout(()=>{let o=()=>{e(),this.logger.logQueueState("End Experience Resolved",{actionId:t,reason:n}),this.resolvePendingQueue(),a&&this.checkAndResolveEmptyQueue()};if(!r&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")){this.endNonStreamble(),o();return}if(!this.api.aiExperience?.sharedState.currentState()?.isStreaming)return void o();let s=this.api.aiExperience?.sharedState.onChange(({nextSharedState:e})=>{e.isStreaming||(s(),o())})},0)};!this.streamFlowPacer?.isRunning()||this.currentAction?.type&&!h({type:this.currentAction?.type})?o():this.streamFlowPacer.onComplete(()=>{setTimeout(o,100)})})}queueStreamCommand(e,t){if(this.logger.logPublic("Stream Command",{actionId:e,chunk:t}),this.aborted.includes(e)||this.isAborted)return void this.updateAbortedCache([e]);if(this.queue.push({type:"streamCommand",actionId:e,chunk:t}),this.isActorReady())this.processQueue();else{let e=this.api?.aiExperience.sharedState.onChange(()=>{this.isActorReady()&&(e?.(),this.processQueue())})}}hasChangedDocument(e){if(!this.previousValidDoc&&e&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers"))return!0;let t=!this.previousValidDoc?.doc||!e?.doc||!(0,i("2pjJ5").areNodesEqualIgnoreAttrs)(this.previousValidDoc?.doc,e.doc);if(null===this.streamFlowPacer)return!!(t&&e.doc&&!(0,i("2pjJ5").isEmptyDocument)(e.doc));let n=this.streamFlowPacer?.adfTextLen(e?.adfDoc);return!!(t&&e.adfDoc&&this.previousValidDoc?.adfDoc&&n.chars>0&&!this.streamFlowPacer?.adfTextLen(this.previousValidDoc?.adfDoc).gte(n))}createCallback(e){if(e)return e=>{let t=(0,i("1xicG").normaliseAIExperienceEvent)(e);this?.streamFlowPacer?.push(t)};if((0,i("dh538").fg)("platform_editor_ai_migrate_from_xstate"))return e=>{this.api.aiExperience.actions.dispatchAIEvent(e)};let{send:t}=this.api.aiExperience.actions.getAiExperienceActor();return e=>{t((0,i("1xicG").normaliseAIExperienceEvent)(e))}}processStreamCommand(e,t,n=!1){if((0,i("dh538").fg)("platform_editor_ai_migrate_from_xstate"))this.streamFlowPacer?.setEmit(e=>{this.currentCommandTimeoutReset?.(),this.api.aiExperience.actions.dispatchAIEvent(e)});else{let{send:e}=this.api.aiExperience.actions.getAiExperienceActor();this.streamFlowPacer?.setEmit(t=>{this.currentCommandTimeoutReset?.(),e(t)})}let a=this.createCallback(!!this.streamFlowPacer?.push);if(!this.adfStreamer){let e=this.api.core.sharedState.currentState()?.schema;this.adfStreamer=e?new(0,i("4pSml").ADFStreamer)(e,function({api:e,isCreateAction:t}){return n=>{"error"===n.type?e?.analytics?.actions.fireAnalyticsEvent({action:"error",actionSubject:"editorPluginAI",actionSubjectId:"adfStreaming",eventType:i("d925B").EVENT_TYPE.OPERATIONAL,attributes:{errorMessage:n.message,errorData:n.data,experienceName:null,selectionType:null,selectionCategory:null,streamId:null,source:{type:"orchestrator",isCreateAction:t}}}):e?.analytics?.actions.fireAnalyticsEvent({action:"info",actionSubject:"editorPluginAI",actionSubjectId:"adfStreaming",eventType:i("d925B").EVENT_TYPE.OPERATIONAL,attributes:{message:n.message,data:n.data,experienceName:null,selectionType:null,selectionCategory:null,streamId:null,source:{type:"orchestrator",isCreateAction:t}}})}}({api:this.api,isCreateAction:this.currentAction?.isCreateAction??!1})):void 0}if(n){let t=m(this.api,this.adfStreamer?.getLastDoc(),this.currentAction?.type).adfDoc,n=this.api.core.sharedState.currentState()?.schema,{updatedResponse:r,localId:o}=function(e,t,n){if(!e||"insertNodeAfter"!==t||!(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga"))return{updatedResponse:e,localId:void 0};let a=[],r=crypto.randomUUID(),o=+!(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers");(0,i("6jPem").traverse)(e,{any:(e,t,n,i)=>{i===o&&a.push(n)}});let s=!1;return{updatedResponse:(0,i("6jPem").traverse)({...e},{any:(e,t,l,c)=>{if(c===o&&a[a.length-1]===l&&n?.nodes[e.type]?.spec?.attrs?.localId)return s=!0,e?.attrs?.localId&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")&&(r=e?.attrs?.localId),{...e,attrs:{...e.attrs,localId:r}}}})||e,localId:s?r:void 0}}(t,this.currentAction?.type,n),s=(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")?r:t;return this.insertAfterQueueLocalId=o,this.adfStreamer?.endStreamingSession({hasProcessedFinalResponse:!0}),this.logger.logQueueState("Final Stream",{actionId:e,adf:s,finalStream:!0}),a({type:"complete",adfResponse:s}),!0}this.currentAction?.isCreateAction&&this.adfStreamer?.reset(),this.adfStreamer?.processChunk(t);let r=m(this.api,this.adfStreamer?.getLastDocWithoutLastLeafNode(),this.currentAction?.type),o=this.hasChangedDocument(r);return this.previousValidDoc=r,!!o&&(a({type:"stream",adfResponse:r.adfDoc}),!0)}processStreamCommandPromise(e,t,n=!1){return this.logger.logQueueState("Streaming Command",{actionId:e,chunk:t,finalStream:n}),this.isStreaming=!n,this.isFinalStream=n,new Promise(a=>{let r=()=>{let i=this.api.aiExperience?.sharedState.currentState()?.chunkNumber;if(!this.processStreamCommand(e,t,n)||i!==this.api.aiExperience?.sharedState.currentState()?.chunkNumber){a(),this.logger.logQueueState("Streaming Command Resolved",{actionId:e,chunk:t,finalStream:n});return}let r=this.api.aiExperience?.sharedState.onChange(({nextSharedState:i,prevSharedState:o})=>{i?.chunkNumber!==o?.chunkNumber&&(r?.(),a(),this.logger.logQueueState("Streaming Command Resolved",{actionId:e,chunk:t,finalStream:n}))})};(0,i("dh538").fg)("platform_editor_ai_aifc_background")?r():setTimeout(()=>r(),0)})}initStreamCommand(e,t,n){this.logger.logPublic("Init Command",{actionId:e,command:t}),this.isAborted=!1,this.hideLoadingScreen=n?.hideLoadingScreen??!1,this.currentAction||(this.currentAction={id:e,isCreateAction:"appendNode"===t.type&&"create"===t.streamingType,initialNode:p(this.api,"replaceNode"===t.type&&t.localId),type:t.type}),this.api.aiExperience.sharedState.currentState()?.aiDecorationExperiencePluginState.isRunning&&this.queue.push({type:"endStream",actionId:e,chunk:void 0,reason:"endPreviousStream"}),this.queue.push({type:"initStream",actionId:e,chunk:void 0,command:t,options:n}),this.processQueue()}applyCommand(e){let t=this.currentCommand?.type==="insertNodeAfter"&&"insertNodeAfter"===e.type&&e.localId===this.currentCommand?.localId;this.currentCommand=e,this.docBeforeStreaming=c(this.api);let n=!0;if(t&&this.insertAfterQueueLocalId&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga"))try{n=this.streamingCommands[e.type]({...e,localId:this.insertAfterQueueLocalId})}catch{n=this.streamingCommands[e.type](e)}else n=this.streamingCommands[e.type](e);return n}initStream(e,t){if(!this.applyCommand(e)&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga"))return this.currentAction?.id&&this.updateAbortedCache([this.currentAction?.id]),!0;if(this.streamFlowPacer?.reset(),this.adfStreamer?.reset(),this.streamFlowPacer?.setEmit(()=>{}),this.streamFlowPacer?.start(),(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")){let n=("appendNode"===e.type||"appendNodeToEnd"===e.type)&&"create"===e.streamingType;return this.logger.logQueueState("Open AI Modal",{command:e}),this.api.aiExperience.actions.openAIModal({invokedFrom:"streamingApi",configItem:i("9Tkc6").UNSTABLE_configItems.freeGenerateAifcConfigItem,withStreamingHighlight:!n,withAcceptReject:!n,hideLoadingScreen:((0,i("dh538").fg)("platform_editor_tmp_hide_loader")&&t?.hideLoadingScreen)??!1}),h(e)||f({api:this.api,command:this.currentCommand,docBeforeStreaming:this.docBeforeStreaming}),!1}if(!h(e))return f({api:this.api,command:this.currentCommand,docBeforeStreaming:this.docBeforeStreaming}),!0;{let t=("appendNode"===e.type||"appendNodeToEnd"===e.type)&&"create"===e.streamingType;return this.logger.logQueueState("Open AI Modal",{command:e}),this.api.aiExperience.actions.openAIModal({invokedFrom:"streamingApi",configItem:i("9Tkc6").UNSTABLE_configItems.freeGenerateAifcConfigItem,withStreamingHighlight:!t,withAcceptReject:!t,hideLoadingScreen:(0,i("dh538").fg)("platform_editor_tmp_hide_loader")&&this.hideLoadingScreen}),!1}}async initStreamPromise(e,t){await new Promise(n=>{if(this.logger.logQueueState(`Init Command ${e.type}`,{command:e}),this.initStream(e,t)){n(),this.logger.logQueueState(`Init Command Resolved ${e.type}`,{command:e});return}let i=this.api.aiExperience?.sharedState.onChange(({nextSharedState:t})=>{t.aiDecorationExperiencePluginState.isRunning&&(i?.(),n(),this.logger.logQueueState(`Init Command Resolved ${e.type}`,{command:e}))})})}startSession(e){this.logger.logPublic("Start Session",{sessionId:e})}queueEndSession(e){this.logger.logPublic("Queue End Session",{sessionId:e})}endSession(e){(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")&&(this.currentCommand=void 0),this.logger.logPublic("End Session",{sessionId:e})}destroy(){this.queue=[],this.adfStreamer=void 0,this.currentCommand=void 0,this.docBeforeStreaming=void 0}abort(){this.logger.logPublic("Abort");let e=this.queue.map(e=>e.actionId);this.queue=[],this.updateAbortedCache([...new Set(e),...this.inProcessing]),this.isAborted=!0,this.endExperience(),this.isPendingResolveQueue=!1,this.queueTimeout&&clearTimeout(this.queueTimeout),this.currentAction=null,this.isFinalStream=!1,(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")&&(this.currentCommand=void 0)}updateAbortedCache(e){this.aborted=[...new Set([...this.aborted,...e])],this.aborted.length>5&&(this.aborted=this.aborted.slice(-5))}constructor(e,t=null){this.api=e,this.streamFlowPacer=t,this.queue=[],this.adfStreamer=void 0,this.streamingCommands=void 0,this.currentCommand=void 0,this.docBeforeStreaming=void 0,this.isStreaming=!1,this.isFinalStream=!1,this.aborted=[],this.subscription=null,this.previousValidDoc=null,this.logger=void 0,this.endedActionIds=[],this.currentAction=null,this.hideLoadingScreen=!1,this.insertAfterQueueLocalId=void 0,this.processingQueue=!1,this.inProcessing=[],this.queueTimeout=null,this.CURRENT_QUEUE_TIMEOUT=5e3,this.currentCommandTimeoutReset=null,this.onEmptyQueueResolve=null,this.COMMAND_TIMEOUT=2e3,this.isPendingResolveQueue=!1,this.isAborted=!1,this.logger=new l(e),this.streamingCommands={replaceNode:b(e),insertNodeBefore:E(e),insertNodeAfter:I(e),removeNode:S(e),appendNode:_(e),appendNodeToEnd:_(e),wrap:v(e),wrapNode:v(e),setAttrs:C(e)}}}e.exports.aiStreamingOrchestratorPlugin=({api:e,config:t})=>{let a;if(!e)throw Error("api is not defined");let s=null,l=function(e){if(!1===e)return null;let t=o("backlogRampThreshold",100),n=o("initialCharsPerTick",8),a=o("maxCharsPerTick",1e3),s=o("tickMs",41),l=i("c6GJD").default.getExperimentValue("platform-editor-ai-streaming-speed","ramp",{initialDelaySec:6,stepDelaySec:3,flushDelaySec:.5,growthFactor:1.5},{typeGuard:r});return new(0,i("e83av").StreamFlowPacer)({backlogRampThreshold:t,initialCharsPerTick:n,maxCharsPerTick:a,ramp:l,tickMs:s})}(t?.streamFlowPacerEnabled);return{name:"aiStreamingOrchestrator",actions:{startSession:()=>(s=crypto.randomUUID(),(a=new P(e,l)).startSession(s),e.aiExperience.actions.startSession(s),s),endSession:async t=>{if(null===s)throw Error("endSession requires a session to be started first!");if(a?.queueEndSession(s),t)if((0,i("dh538").fg)("platform_editor_ai_migrate_from_xstate"))e.aiExperience.actions.dispatchAIEvent({type:"error",errorInfo:{failureReason:t.failureReason,statusCode:t.statusCode}});else{let{send:n}=e.aiExperience.actions.getAiExperienceActor();n({type:"error",errorInfo:{failureReason:t.failureReason,statusCode:t.statusCode}})}await a?.onEmptyQueue(),a?.endSession(s),e.aiExperience.actions.endSession(s),s=null},abortSession:()=>{if(!s)return;let t=s;s=null,a?.abort(),t&&e.aiExperience.actions.endSession(t)},initAction:(e,t)=>{if(null===s)throw Error("initAction requires a session to be started first!");let n=crypto.randomUUID();return a?.initStreamCommand(n,e,t),n},streamValue:(e,t)=>{a?.queueStreamCommand(e,t)},finishAction:(t,n)=>{if(n)if((0,i("dh538").fg)("platform_editor_ai_migrate_from_xstate"))e.aiExperience.actions.dispatchAIEvent({type:"error",errorInfo:{failureReason:n.failureReason,statusCode:n.statusCode}});else{let{send:t}=e.aiExperience.actions.getAiExperienceActor();t({type:"error",errorInfo:{failureReason:n.failureReason,statusCode:n.statusCode}})}a?.endStreamCommand(t)}},usePluginHook:()=>{(0,n.useEffect)(()=>()=>{a?.destroy()},[])}}}}),a("drPNW",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.default=void 0;var n=r(i("42omo")),a=r(i("aSNrY"));function r(e){return e&&e.__esModule?e:{default:e}}let o=e=>n.default.createElement(a.default,Object.assign({name:"TextAdjustLengthIcon",dangerouslySetGlyph:'<path fill="currentcolor" d="M3.25 1c.199 0 .39.08.53.22l2.5 2.5-1.06 1.06L4 3.56v8.88l1.22-1.22 1.06 1.06-2.5 2.5a.75.75 0 0 1-1.06 0l-2.5-2.5 1.06-1.06 1.22 1.22V3.56L1.28 4.78.22 3.72l2.5-2.5.114-.094A.75.75 0 0 1 3.25 1M13 11.5V13H8v-1.5zm3-4.25v1.5H8v-1.5zM16 3v1.5H8V3z"/>'},e));o.displayName="TextAdjustLengthIcon",e.exports.default=o}),a("cbtR4",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.default=void 0;var n=r(i("42omo")),a=r(i("aSNrY"));function r(e){return e&&e.__esModule?e:{default:e}}let o=e=>n.default.createElement(a.default,Object.assign({name:"AiGenerativeCleanupIcon",dangerouslySetGlyph:'<path fill="currentcolor" d="M14.23.44 12.22 8h1.58a2 2 0 0 1 1.91 2.59l-1.23 4a2 2 0 0 1-1.9 1.41H4.75a.75.75 0 0 1-.28-1.45h-.01l.02-.01q.03-.01.1-.06c.09-.06.23-.16.39-.32.31-.32.71-.88.93-1.84l.03-.09L7 9.3A2 2 0 0 1 8.87 8h1.8L12.78.06zM8.87 9.5a.5.5 0 0 0-.47.33l-1.06 2.89a5.7 5.7 0 0 1-.73 1.78h5.97a.5.5 0 0 0 .48-.35l1.23-4a.5.5 0 0 0-.48-.65zM4.62 1.01a.75.75 0 0 1 .54.38l.05.11.54 1.47.05.1a.5.5 0 0 0 .25.2l1.47.54.11.05a.75.75 0 0 1 0 1.31l-.11.05-1.47.54a.5.5 0 0 0-.3.3l-.54 1.47a.75.75 0 0 1-1.36.11l-.05-.1-.54-1.47a.5.5 0 0 0-.2-.25l-.1-.05-1.47-.53a.75.75 0 0 1-.48-.59L1 4.5l.01-.12a.75.75 0 0 1 .48-.59l1.47-.54.1-.05a.5.5 0 0 0 .2-.25l.54-1.47.05-.11A.75.75 0 0 1 4.5 1z"/>'},e));o.displayName="AiGenerativeCleanupIcon",e.exports.default=o}),a("fUwkU",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.default=void 0;var n=r(i("42omo")),a=r(i("aSNrY"));function r(e){return e&&e.__esModule?e:{default:e}}let o=e=>n.default.createElement(a.default,Object.assign({name:"TextConclusionAddIcon",dangerouslySetGlyph:'<path fill="currentcolor" fill-rule="evenodd" d="M15 6.5H1V5h14zm0-4H1V1h14z" clip-rule="evenodd"/><path fill="currentcolor" d="M1.75 11a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5m0 4a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5m3.88-4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0M4.88 15a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5m3.87-4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0M8 15a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5m3.88-4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m2.37.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5"/>'},e));o.displayName="TextConclusionAddIcon",e.exports.default=o}),a("4zFET",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.default=void 0;var n=r(i("42omo")),a=r(i("aSNrY"));function r(e){return e&&e.__esModule?e:{default:e}}let o=e=>n.default.createElement(a.default,Object.assign({name:"TextIntroductionAddIcon",dangerouslySetGlyph:'<path fill="currentcolor" fill-rule="evenodd" d="M15 9.5H1V11h14zm-7 4H1V15h7z" clip-rule="evenodd"/><path fill="currentcolor" d="M1.75 5a.75.75 0 1 1 0 1.5.75.75 0 0 1 0-1.5m0-4a.75.75 0 1 1 0 1.5.75.75 0 0 1 0-1.5m3.88 4.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0M4.88 1a.75.75 0 1 1 0 1.5.75.75 0 0 1 0-1.5m3.87 4.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0M8 1a.75.75 0 1 1 0 1.5A.75.75 0 0 1 8 1m3.88 4.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0M11.13 1a.75.75 0 1 1 0 1.5.75.75 0 0 1 0-1.5M15 5.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0M14.25 1a.75.75 0 1 1 0 1.5.75.75 0 0 1 0-1.5"/>'},e));o.displayName="TextIntroductionAddIcon",e.exports.default=o}),a("bwpRs",function(e,t){var n,a=((n={}).ADD_STRUCTURE="Add structure",n.BRAINSTORM="Brainstorm",n.CHANGE_TONE_TO_CASUAL="Change tone to casual",n.CHANGE_TONE_TO_EDUCATIONAL="Change tone to educational",n.CHANGE_TONE_TO_EMPATHETIC="Change tone to empathetic",n.CHANGE_TONE_TO_NEUTRAL="Change tone to neutral",n.CHANGE_TONE_TO_PROFESSIONAL="Change tone to professional",n.CREATE_PULL_REQUEST_DESCRIPTION="Create pull request description",n.DESCRIBE_YOUR_PULL_REQUEST="Describe your pull request",n.FIND_ACTION_ITEMS="Find action items",n.FIX_SPELLING_AND_GRAMMAR="Fix spelling & grammar",n.FREE_GENERATE="AI (Atlassian Intelligence)",n.FREE_GENERATE_EDITOR_AGENT="AI (Atlassian Intelligence) Editor Agent",n.FREE_GENERATE_AIFC="AI (Atlassian Intelligence) AIFC",n.IMPROVE_WRITING="Improve writing",n.MAKE_SHORTER="Make shorter",n.ROVO_AGENT="Rovo agent",n.SHORTEN_UPDATE="Shorten update",n.SUGGEST_A_TITLE="Suggest a title",n.SUGGEST_RESPONSE="Draft a Reply",n.DRAFT_REPLY_PILL="Draft a Reply Pill",n.GENERATE_ESCALATION_NOTES="Generate escalation notes",n.INCIDENT_SMART_COMMENTS="Incident smart comments",n.SUMMARISE_WRITING="Summarize writing",n.MAKE_LONGER="Make longer",n.REPHRASE="Rephrase",n.ADD_INTRODUCTION="Add introduction",n.ADD_CONCLUSION="Add conclusion",n.CONVERT_TO_BULLETED_LIST="Convert to bulleted list",n.CONVERT_TO_TABLE="Convert to table",n[n.TRANSLATE_TO_CHINESE_SIMPLIFIED=`Translate to ${i("hgTYG").SupportedTranslationLanguages.ChineseSimplified}`]="TRANSLATE_TO_CHINESE_SIMPLIFIED",n[n.TRANSLATE_TO_CHINESE_TRADITIONAL=`Translate to ${i("hgTYG").SupportedTranslationLanguages.ChineseTraditional}`]="TRANSLATE_TO_CHINESE_TRADITIONAL",n[n.TRANSLATE_TO_CZECH=`Translate to ${i("hgTYG").SupportedTranslationLanguages.Czech}`]="TRANSLATE_TO_CZECH",n[n.TRANSLATE_TO_DANISH=`Translate to ${i("hgTYG").SupportedTranslationLanguages.Danish}`]="TRANSLATE_TO_DANISH",n[n.TRANSLATE_TO_DUTCH=`Translate to ${i("hgTYG").SupportedTranslationLanguages.Dutch}`]="TRANSLATE_TO_DUTCH",n[n.TRANSLATE_TO_ENGLISH=`Translate to ${i("hgTYG").SupportedTranslationLanguages.English}`]="TRANSLATE_TO_ENGLISH",n[n.TRANSLATE_TO_FINNISH=`Translate to ${i("hgTYG").SupportedTranslationLanguages.Finnish}`]="TRANSLATE_TO_FINNISH",n[n.TRANSLATE_TO_FRENCH=`Translate to ${i("hgTYG").SupportedTranslationLanguages.French}`]="TRANSLATE_TO_FRENCH",n[n.TRANSLATE_TO_GERMAN=`Translate to ${i("hgTYG").SupportedTranslationLanguages.German}`]="TRANSLATE_TO_GERMAN",n[n.TRANSLATE_TO_HUNGARIAN=`Translate to ${i("hgTYG").SupportedTranslationLanguages.Hungarian}`]="TRANSLATE_TO_HUNGARIAN",n[n.TRANSLATE_TO_ITALIAN=`Translate to ${i("hgTYG").SupportedTranslationLanguages.Italian}`]="TRANSLATE_TO_ITALIAN",n[n.TRANSLATE_TO_JAPANESE=`Translate to ${i("hgTYG").SupportedTranslationLanguages.Japanese}`]="TRANSLATE_TO_JAPANESE",n[n.TRANSLATE_TO_KOREAN=`Translate to ${i("hgTYG").SupportedTranslationLanguages.Korean}`]="TRANSLATE_TO_KOREAN",n[n.TRANSLATE_TO_NORWEGIAN=`Translate to ${i("hgTYG").SupportedTranslationLanguages.Norwegian}`]="TRANSLATE_TO_NORWEGIAN",n[n.TRANSLATE_TO_POLISH=`Translate to ${i("hgTYG").SupportedTranslationLanguages.Polish}`]="TRANSLATE_TO_POLISH",n[n.TRANSLATE_TO_PORTUGUESE_BRAZILIAN=`Translate to ${i("hgTYG").SupportedTranslationLanguages.PortugueseBrazilian}`]="TRANSLATE_TO_PORTUGUESE_BRAZILIAN",n[n.TRANSLATE_TO_RUSSIAN=`Translate to ${i("hgTYG").SupportedTranslationLanguages.Russian}`]="TRANSLATE_TO_RUSSIAN",n[n.TRANSLATE_TO_SPANISH=`Translate to ${i("hgTYG").SupportedTranslationLanguages.Spanish}`]="TRANSLATE_TO_SPANISH",n[n.TRANSLATE_TO_SWEDISH=`Translate to ${i("hgTYG").SupportedTranslationLanguages.Swedish}`]="TRANSLATE_TO_SWEDISH",n[n.TRANSLATE_TO_TURKISH=`Translate to ${i("hgTYG").SupportedTranslationLanguages.Turkish}`]="TRANSLATE_TO_TURKISH",n[n.TRANSLATE_TO_THAI=`Translate to ${i("hgTYG").SupportedTranslationLanguages.Thai}`]="TRANSLATE_TO_THAI",n[n.TRANSLATE_TO_UKRAINIAN=`Translate to ${i("hgTYG").SupportedTranslationLanguages.Ukrainian}`]="TRANSLATE_TO_UKRAINIAN",n[n.TRANSLATE_TO_VIETNAMESE=`Translate to ${i("hgTYG").SupportedTranslationLanguages.Vietnamese}`]="TRANSLATE_TO_VIETNAMESE",n.EXPERIMENTAL_PROMPT_PLACEHOLDER="Experimental prompt placeholder",n.ADD_POLISH="Add polish",n);e.exports.CONFIG_ITEM_KEYS=a}),a("jdR93",function(e,t){e.exports.getSupportedNodesForAIModal=({schema:{nodes:e}})=>new Set([e.table]),e.exports.isCellSelection=(e,t)=>{let{tableHeader:n,tableCell:i,tabeRow:a,table:r}=e.schema.nodes,{$from:o}=t||e.selection;return[n,i,a,r].includes(o.parent.type)}}),a("4SGh1",function(e,t){var n=i("42omo"),a=i("k7eoe");function r(e){let t=(0,i("4NrmI").getPackageInfo)(),n=e.attributes||{};return{...e,attributes:{...n,aiPluginPackageName:t.packageName,aiPluginPackageVersion:t.packageVersion}}}let o=e=>{let t=e.replace(/\s+/gu,""),n=e.replace(/\s+/gu," ").trim(),i="undefined"!=typeof Intl&&"function"==typeof Intl.Segmenter;return{charCount:i?function(e,t){let n=new Intl.Segmenter("und",{granularity:t}),i=0;for(let t of n.segment(e))i++;return i}(t,"grapheme"):Array.from(t).length,wordCount:""===n?0:i?function(e){let t=new Intl.Segmenter("und",{granularity:"word"}),n=0;for(let i of t.segment(e))i.isWordLike&&n++;return n}(n):n.split(/\s+/u).length}};e.exports.addAnalytics=function({editorState:e,tr:t,payload:n,channel:o=a.FabricChannel.editor,addToHistory:s=!0}){return(function({editorState:e,payload:t,channel:n=a.FabricChannel.editor}){return a=>{let{storedMarks:o}=a,s=a.mapping.map(e.selection.$from.pos,-1);return a.step(new(0,i("jy7VG").AnalyticsStep)([{payload:r(t),channel:n}],[],s)),o&&a.setStoredMarks(o),!0}})({editorState:e,payload:n,channel:o})(t),s||t.setMeta("addToHistory",!1),t},e.exports.useFireAIAnalyticsEvent=function(){let{createAnalyticsEvent:e}=(0,i("inPa6").useAnalyticsEvents)();return(0,n.useCallback)(t=>(({payload:t,channel:n=a.FabricChannel.editor})=>{if(!e)return;let i=()=>e(r(t))?.fire(n);window.requestIdleCallback?window.requestIdleCallback(i):window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,0)})(t),[e])},e.exports.isErrorStepAttributes=function(e){return!!e&&("errorKey"in e||"errorType"in e||"statusCode"in e)},e.exports.fireButtonViewedAnalyticsEvent=({api:e,actionSubjectId:t,attributes:n})=>{e?.analytics?.actions.fireAnalyticsEvent({action:i("d925B").ACTION.VIEWED,actionSubject:i("d925B").ACTION_SUBJECT.BUTTON,actionSubjectId:t,eventType:i("d925B").EVENT_TYPE.UI,attributes:{inputMethod:i("d925B").INPUT_METHOD.FLOATING_TB,mode:i("e2wMq").MODE.EDITOR,selectionCharCount:n.selectionCharCount,selectionWordCount:n.selectionWordCount}})},e.exports.rangeCharWordCount=(e,t,n)=>t===n?{charCount:0,wordCount:0}:o(e.textBetween(t,n,"\n"," ")),e.exports.selectionCharWordCount=e=>{let{from:t,to:n}=e.selection;return e.selection.empty?{charCount:0,wordCount:0}:o(e.doc.textBetween(t,n,"\n"," "))}}),a("j51b9",function(e,t){function n({step:e,doc:t}){return function({pos:e,doc:t}){let n=e;for(;n>0&&!t.resolve(n).parent.inlineContent;)n--;return n}({pos:function({step:e,doc:t}){let n=e.from+e.slice.size,i=!1,a=function(e){if(e.childCount<=0)return null;let t=e.childCount-1,n=e.child(t);for(;t>=0&&""===e.child(t).textContent;)t--;return n}(e.slice.content);if(!a)return e.from;let r=a.textContent;for(;!1===i&&n>0;){let a=t.textBetween(e.from,n),o=t.slice(e.from,n);if(a.endsWith(r)&&o.content.lastChild?.textContent!==""){i=!0;break}n--}return n}({step:e,doc:t}),doc:t})}function a(e){let t=e.find(e=>e instanceof i("aXG5V").ReplaceStep||e instanceof i("aXG5V").ReplaceAroundStep);return t||null}e.exports.getValidEndTextPosition=n,e.exports.findFirstReplaceStep=a,e.exports.getGeneratedDecorationFromTransaction=function(e,t){let r=a(e.steps);if(!r)return null;let o=function({pos:e,doc:t}){let n=e,i=!1;for(;!1===i;){if(t.nodeAt(n)){i=!0;break}n++}return function({pos:e,doc:t}){let n=e,i=!1;for(;!1===i;){if(t.resolve(n).parent.inlineContent){i=!0;break}n++}return n}({pos:n,doc:t})}({pos:r.from,doc:e.doc}),s=n({step:r,doc:e.doc});return(0,i("5SuLc").createGeneratedContentDecorations)(o,s,t)},e.exports.getGeneratedNodeDecorationsFromTransaction=function(e){let t=e.steps.filter(e=>e instanceof i("aXG5V").ReplaceStep||e instanceof i("aXG5V").ReplaceAroundStep);return 0===t.length?[]:t.map(t=>{let n=t.from,a=e.doc.nodeAt(n);if(a){let e=n+a.nodeSize;return(0,i("5SuLc").createGeneratedNodeDecorations)(n,e)}}).filter(e=>void 0!==e)}}),a("kqrrC",function(e,t){let{createPluginState:n,createCommand:a,getPluginState:r}=(0,i("lkJUe").pluginFactory)(i("3yUTv").aiExperienceDecorationPluginKey,i("99IPz").reducer,{mapping:function(e,t){let{initialPositions:n}=t;if(!n)return t;if(t.isInDocumentStreamingEnabled){let n=e.getMeta("appendedTransaction");if(e.getMeta("isAIStreamingTransformation")||n&&n.getMeta("isAIStreamingTransformation"))return t}let i=[e.mapping.map(n[0]),e.mapping.map(n[1])];return i[0]===n[0]&&i[1]===n[1]?t:{...t,initialPositions:i}},onDocChanged:function(e,t){return t.isInDocumentStreamingEnabled?function(e,t){let{dispatchAnalyticsEvent:n}=t;try{if(t.modalDecorationSet===i("ftzrq").DecorationSet.empty)return t;let n=t.modalDecorationSet.map(e.mapping,e.doc),a=n.find(),r=a.find(e=>"modalMountPointRangeDecoration"===e.spec.key);if(a.find(e=>"modalMountPointDecoration"===e.spec.key))return{...t,modalDecorationSet:n};let o=r&&r.from!==r.to,s=e.getMeta("appendedTransaction");if(e.getMeta("isAIStreamingTransformation")||s&&s.getMeta("isAIStreamingTransformation"))return{...t,modalDecorationSet:i("ftzrq").DecorationSet.create(e.doc,[...a,(0,i("5SuLc").createModalMountPointDecoration)(Math.max(1,Math.min(e.doc.content.size,e.steps[0].to)))])};if(o)return{...t,modalDecorationSet:i("ftzrq").DecorationSet.create(e.doc,[...a,(0,i("5SuLc").createModalMountPointDecoration)(Math.max(1,Math.min(e.doc.content.size,r.to)))])};return{...t,modalDecorationSet:i("ftzrq").DecorationSet.empty}}catch(e){return n({action:"unhandledErrorCaught",actionSubject:"editorPluginAI",actionSubjectId:"decorationPluginFactory",attributes:{errorType:"handleDocChangedError",errorMessage:i("2QlXt").ErrorUtils.extractErrorMessage(e)},eventType:i("d925B").EVENT_TYPE.OPERATIONAL}),{...t,modalDecorationSet:i("ftzrq").DecorationSet.empty}}}(e,t):function(e,t){let{dispatchAnalyticsEvent:n}=t;try{if(e.getMeta("isAiContentTransformationForBlocks")){let n=(0,i("j51b9").getGeneratedNodeDecorationsFromTransaction)(e);if(n.length)return{...t,modalDecorationSet:i("ftzrq").DecorationSet.create(e.doc,n)}}if(e.getMeta("isAiContentTransformation")){let n=(0,i("j51b9").getGeneratedDecorationFromTransaction)(e,t.isInDocumentStreamingEnabled);if(!n)throw Error("Did not expect not to find new content in a `isAiContentTransformation` transaction?");return{...t,modalDecorationSet:i("ftzrq").DecorationSet.create(e.doc,n)}}if(t.modalDecorationSet===i("ftzrq").DecorationSet.empty)return t;let n=(0,i("56Rej").hasGeneratedContentDecorations)(t),a=e.getMeta("isRemote")??!1,r=e.selectionSet&&void 0===e.getMeta("appendedTransaction");if(n&&!a&&r)return{...t,modalDecorationSet:i("ftzrq").DecorationSet.empty};let o=t.modalDecorationSet.map(e.mapping,e.doc);if(n)return{...t,modalDecorationSet:o};let s=o.find(),l=s.find(e=>"inlineDecoration"===e.spec.key),c=s.find(e=>"startWidgetDecoration"===e.spec.key),d=s.find(e=>"endWidgetDecoration"===e.spec.key);if(s.find(e=>"ai-nodeDecoration"===e.spec.key)||d&&!c&&!l)return{...t,modalDecorationSet:o};let p=!!l&&l.from!==l.to;if(!l||!p)return{...t,modalDecorationSet:i("ftzrq").DecorationSet.empty};return 0===l.from&&(l=(0,i("5SuLc").createInlineDecoration)(l.from||1,l.to||1)),c||(c=(0,i("5SuLc").createWidgetDecoration)(t.isInDocumentStreamingEnabled)(l.from,"start")),d||(d=(0,i("5SuLc").createWidgetDecoration)(t.isInDocumentStreamingEnabled)(l.to,"end")),{...t,modalDecorationSet:i("ftzrq").DecorationSet.create(e.doc,[c,l,d])}}catch(e){return n({action:"unhandledErrorCaught",actionSubject:"editorPluginAI",actionSubjectId:"decorationPluginFactory",attributes:{errorType:"handleDocChangedError",errorMessage:i("2QlXt").ErrorUtils.extractErrorMessage(e)},eventType:i("d925B").EVENT_TYPE.OPERATIONAL}),{...t,modalDecorationSet:i("ftzrq").DecorationSet.empty}}}(e,t)},onSelectionChanged:function(e,t){return t.modalDecorationSet===i("ftzrq").DecorationSet.empty||t.configItem?t:(0,i("56Rej").hasGeneratedContentDecorations)(t)?{...t,modalDecorationSet:i("ftzrq").DecorationSet.empty}:t}});e.exports.createInitialState=(e,t)=>n=>({isRunning:!1,modalDecorationSet:i("ftzrq").DecorationSet.empty,dispatchAnalyticsEvent:e,isInDocumentStreamingEnabled:t}),e.exports.createPluginState=n,e.exports.createCommand=a,e.exports.getPluginState=r}),a("9OCYt",function(e,t){var n,i=((n={}).START_WATCHING_REGION="START_WATCHING_REGION",n.END_WATCHING_REGION="END_WATCHING_REGION",n);e.exports.ACTIONS=i}),a("3tFte",function(e,t){let n=new(0,i("ks2lK").PluginKey)("aiAnnotationWatchmen");e.exports.aiAnnotationWatchmenPluginKey=n}),a("klIiV",function(e,t){function n(){let{origin:e="",port:t="",hostname:n=""}=void 0!==window.location?window.location:{};return"localhost"===n&&"8081"!==t||["atlaskit-website-staging.stg-east.frontend.public.atl-paas.net","statlas.prod.atl-paas.net","atlaskit.atlassian.com"].some(e=>n===e)?"https://pug.jira-dev.com":e}let i=`${n()}/gateway/api/assist/chat/v1/invoke_agent/stream`,a=`${n()}/gateway/api/assist/api/ai/v2/ai-feature/editor-ai/stream`,r=`${n()}/gateway/api/assist/rovo/v1/editor/conversation`,o=`${n()}/gateway/api/ai/v2/ai-feature/audit-logs`,s=`${n()}/gateway/api/assist/ai/v2/ai-feature/jira/issue/source-type/work-item/suggestions/stream`;function l(){return`${n()}/gateway/api/assist/ai/v2/ai-feature/proactive`}e.exports._getFetchCustomHeaders=function(){return window.location.origin,{}},e.exports.convoAIApiUrl=a,e.exports.convoAIRovoApiURL=r,e.exports.convoAIAuditLogApiURL=o,e.exports.jiraIssueReformatterApiURL=s,e.exports.deriveProactiveAIApiUrl=l,e.exports.getAPIName=e=>{switch(e){case i:return"assistance-service";case a:return"convo-ai";case r:return"rovo-agent";case o:return"audit-logs";case s:return"jira-issue-reformatter";case l():return"proactive-ai";default:return"unknown-api"}}}),a("70Lwl",function(t,n){var a=i("42omo");let r=t=>({key:i("bwpRs").CONFIG_ITEM_KEYS.SUGGEST_A_TITLE,title:i("AMCQl").aiConfigItemMessages.suggestTitleTitle,description:i("AMCQl").aiConfigItemMessages.suggestTitleDescription,icon:()=>e(a).createElement(i("8VRku").SuggestTitleIcon,null),intentSchemaId:"suggest_title_intent_schema.json",featureId:"suggest_title",actions:{empty:[(0,i("jc4DP").createInsertAtCurrentPosition)({appearance:"secondary"}),(0,i("jc4DP").createInsertAtTop)({appearance:"primary"})],selection:[(0,i("jc4DP").createInsertAtCurrentPosition)({appearance:"secondary"}),(0,i("jc4DP").createInsertAtTop)({appearance:"primary"})]},getBackendModel:()=>"assistance-service"}),o=t=>({key:i("bwpRs").CONFIG_ITEM_KEYS.SUGGEST_A_TITLE,title:i("AMCQl").aiConfigItemMessages.suggestTitleTitle,description:i("AMCQl").aiConfigItemMessages.suggestTitleDescription,icon:()=>e(a).createElement(i("8VRku").SuggestTitleIcon,null),intentSchemaId:"suggest_title_intent_schema.json",featureId:"suggest_title",actions:{empty:[(0,i("jc4DP").createReplaceExistingConfluenceTitle)({appearance:"primary"})],selection:[(0,i("jc4DP").createReplaceExistingConfluenceTitle)({appearance:"primary"})]},getBackendModel:()=>"assistance-service"});t.exports.suggestTitleWithOptions=e=>({config:r(e),triggers:{empty:{enabled:!0,docMinSize:1},selection:{enabled:!0}}}),t.exports.suggestTitleForConfluenceTitleToolbar=o,t.exports.suggestTitleForConfluenceTitleToolbarWithOptions=e=>({config:o(e),triggers:{empty:{enabled:!0,docMinSize:1},selection:{enabled:!0}}})}),a("2e7rb",function(e,t){e.exports.findEditorIdFromView=e=>e.dom?.dataset?.editorId}),a("4F0gv",function(e,t){var n=i("1oCLl"),a=i("dZ8uq");e.exports.isAdfStreamingEnabled=function(e=!1){if(e){let e=(0,n.expValEquals)("platform_editor_ai_iw_adf_streaming","cohort","adf_gpt41mini")||(0,n.expValEquals)("platform_editor_ai_iw_adf_streaming","cohort","adf_gemini25flash"),t=(0,n.expValEquals)("platform_editor_ai_non_iw_adf_streaming","cohort","adf_gpt41mini")||(0,n.expValEquals)("platform_editor_ai_non_iw_adf_streaming","cohort","adf_gemini25flash");return e||t||(0,i("dh538").fg)("platform_editor_ai_adf_prompts_in_all_products")}return(0,i("dh538").fg)("platform_editor_ai_adf_prompts_in_all_products")||(0,a.expValEqualsNoExposure)("platform_editor_ai_iw_adf_streaming","cohort","adf_gpt41mini")||(0,a.expValEqualsNoExposure)("platform_editor_ai_iw_adf_streaming","cohort","adf_gemini25flash")||(0,a.expValEqualsNoExposure)("platform_editor_ai_non_iw_adf_streaming","cohort","adf_gpt41mini")||(0,a.expValEqualsNoExposure)("platform_editor_ai_non_iw_adf_streaming","cohort","adf_gemini25flash")}}),a("4pSml",function(t,n){var a=i("a4TK8");function r(e){return"paragraph"===e||"heading"===e||"decisionItem"===e||"taskItem"===e||"caption"===e}let o=(e,t)=>!!t&&!!e.nodes[t]?.isTextblock,s=["blockCard","embedCard","unsupportedBlock","tableRow"];function l(e){return e.type.startsWith("media")||e.type.startsWith("extension")||e.type.endsWith("Extension")||s.includes(e.type)}function c({analyticsEventsSessionData:e,processStatus:t,error:n,stack:i,validationError:a}){t.failed=!0,t.error=n,t.recovered=!1,t.stack=i,t.validationError=a,t.lastFailedAtChunk=e.chunksCount,0===t.firstFailedAtChunk&&(t.firstFailedAtChunk=e.chunksCount)}function d({analyticsEventsSessionData:e,processStatus:t}){t.failed&&!t.recovered&&(t.recovered=!0,t.lastRecoveredAtChunk=e.chunksCount,0===t.firstRecoveredAtChunk&&(t.firstRecoveredAtChunk=e.chunksCount))}let p={failed:!1,error:"",recovered:!1,firstFailedAtChunk:0,firstRecoveredAtChunk:0,lastFailedAtChunk:0,lastRecoveredAtChunk:0},u=()=>({chunksCount:0,json:{repairJson:Object.assign({},p)},adf:{topNode:Object.assign({},p),repairInvalidContent:{wrappingNodesFoundEvents:[],nodeMovedToEndOfPreviousNodeEvents:[],invalidWrappingNodesEvents:[],wrappingNodesNotFoundEvents:[]},failedToRepairADF:Object.assign({},p),topNodeValidation:Object.assign({},p)}});function g(t,n,i){return t[n].some(t=>e(a)(t,i))}t.exports.ADFStreamer=class{setAnalyticsEventMetaData(e){this.analyticsEventMetaData=e}fireAnalyticEvent(e){e.data={...e.data,...this.analyticsEventMetaData},this.fireAnalyticEventCallback?.(e)}setInputDocumentTree(e){if(!e||0===e.size)return;let t=this.schema.topNodeType.createAndFill();if(t)try{let n=new(0,i("aXG5V").Transform)(t).replaceRange(0,t.content.size,e).doc.toJSON(),a=this.getPartialNodeTypeTree(n);this.inputDocumentTree=a}catch{}}reset(){this.jsonRepair.reset(),this.lastDoc=this.createDefaultDoc(),this.analyticsEventMetaData=void 0,this.analyticsEventsSessionData=u()}isInErrorState(){let e=this.analyticsEventsSessionData.json.repairJson.failed&&!this.analyticsEventsSessionData.json.repairJson.recovered,t=this.analyticsEventsSessionData.adf.failedToRepairADF.failed&&!this.analyticsEventsSessionData.adf.failedToRepairADF.recovered,n=this.analyticsEventsSessionData.adf.topNode.failed&&!this.analyticsEventsSessionData.adf.topNode.recovered,i=this.analyticsEventsSessionData.adf.topNodeValidation.failed&&!this.analyticsEventsSessionData.adf.topNodeValidation.recovered;return e||t||n||i||this.isEmptyLastDoc()}createDefaultDoc(){return{...this.schema.topNodeType.createAndFill()?.toJSON(),version:1}}appendChunk(e){this.jsonRepair.append(e)}processChunk(e){var t,n,i;this.analyticsEventsSessionData.chunksCount++,this.jsonRepair.append(e);try{let{hasChanged:e,repairedJson:n}=this.jsonRepair.parse();e&&this.repairADFJson(n),t=this.analyticsEventsSessionData,d({analyticsEventsSessionData:t,processStatus:t.json.repairJson})}catch(e){n=this.analyticsEventsSessionData,i=e instanceof Error?e.message:"Unknown error",c({analyticsEventsSessionData:n,processStatus:n.json.repairJson,error:i})}return this}getLastDocWithoutLastLeafNode(){let e=this.createCopyOfDoc(this.lastDoc),{parent:t,leaf:n}=function(e){let t=e,n=e.content&&e.content[e.content.length-1];for(;n&&n.content&&!l(n);)t=n,n=n.content[n.content.length-1];return{parent:t,leaf:n}}(e);if(!n)return this.createCopyOfDoc(e);let a=(0,i("dh538").fg)("platform_editor_ai_generic_prep_for_aifc_2")?n&&!!n.text&&!("text"===n.type&&n.marks?.find(e=>"link"===e.type)):n&&!!n.text;if(((0,i("dh538").fg)("platform_editor_ai_generic_prep_for_aifc_2")?o(this.schema,n.type):r(n.type))||a)return this.createCopyOfDoc(e);if("table"===t.type&&"tableRow"===n.type){let e=function(e){if("table"!==e.type)return 0;let t=e.content;if(!t)return 0;if(1===t.length)return 1;let n=t.slice(0,t.length-1),i=-1,a=1;return n.forEach((e,t)=>{let n=(e.content||[]).reduce((e,t)=>Math.max(e,"number"==typeof t.attrs?.rowspan?t.attrs.rowspan:1),1);a=Math.max(a,n),0==--a&&(i=t)}),n.length-i}(t);t.content&&(t.content=t.content.slice(0,t.content.length-e))}else{let e=l(n)||((0,i("dh538").fg)("platform_editor_ai_generic_prep_for_aifc_2")?o(this.schema,t.type):r(t.type));t.content&&t.content.length>0&&e&&(t.content=t.content.slice(0,t.content.length-1))}return this.createCopyOfDoc(e)}getLastDoc(){return this.createCopyOfDoc(this.lastDoc)}createCopyOfDoc(e){return"undefined"!=typeof window&&"function"==typeof window.structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}repairADFJson(e){var t,n,i,a,r,o,s,l,p,u,g;let m=this.sanitizeTopNode(e);if(m.failed)return t=this.analyticsEventsSessionData,n=m.error,c({analyticsEventsSessionData:t,processStatus:t.adf.topNode,error:n}),this.lastDoc;this.analyticsEventsSessionData.adf.topNode.failed&&d({analyticsEventsSessionData:i=this.analyticsEventsSessionData,processStatus:i.adf.topNode});let f=m.sanitizedTopNode;try{let e=this.repairNode({partialNodeJson:f,isTopNode:!0});if(e&&e.node){let t=e.node,{result:n,error:i}=this.validateNodeUsingValidator(t);n?(this.lastDoc=t.toJSON(),a=this.analyticsEventsSessionData,d({analyticsEventsSessionData:a,processStatus:a.adf.topNodeValidation})):(r=this.analyticsEventsSessionData,o=i?.errorMessage||"Invalid top node",s=i?.validationError,c({analyticsEventsSessionData:r,processStatus:r.adf.topNodeValidation,error:o,validationError:s})),l=this.analyticsEventsSessionData,d({analyticsEventsSessionData:l,processStatus:l.adf.failedToRepairADF})}}catch(e){p=this.analyticsEventsSessionData,u=e instanceof Error?e.message:"Unknown error",g=e instanceof Error?e.stack:void 0,c({analyticsEventsSessionData:p,processStatus:p.adf.failedToRepairADF,error:u,stack:g})}return this.lastDoc}sanitizeTopNode(e){let t=e;if(Array.isArray(e)){if(!(t=e.find(e=>e.type===this.schema.topNodeType.name)))return{failed:!0,error:"Valid top node not found in array."};{let n=e.filter(e=>e.type!==this.schema.topNodeType.name);t.content=[...t.content||[],...n]}}else if("object"!=typeof e||null===e)return{failed:!0,error:"Invalid top node."};return{failed:!1,sanitizedTopNode:t}}repairNode(...e){return(0,i("dh538").fg)("platform_editor_ai_refactor_repair_method")?this.repairNodeNew(...e):this.repairNodeOld(...e)}repairNodeOld({partialNodeJson:e,parentNodeType:t,isTopNode:n}){let a=this.inferNodeType({partialNodeJson:e,parentNodeType:t,isTopNode:n});if(!a)return void this.fireAnalyticEvent({type:"info",message:"Failed to infer node type.",data:{nodeType:e.type??"type is undefined"}});let r=e.marks;if((0,i("dh538").fg)("platform_editor_ai_repair_using_validatorspec")){let e=(0,i("haQ6N").repairNodeMarks)(a.name,r);e.repairedMarks&&e.repairedMarks.length>0&&(r=e.repairedMarks),e.errors&&e.errors.length}let o=r?r.map(e=>this.createMark(e)).filter(e=>null!==e):[];if("text"===a.name)return{node:this.schema.text(e.text?e.text:" ",o),invalidNodes:[]};if("date"===a.name){let t=new Date().getTime().toString();if(e.attrs=e.attrs||{},e.attrs.timestamp){if("string"==typeof e.attrs.timestamp)if(e.attrs.timestamp.includes("-")){let n=new Date(e.attrs.timestamp);e.attrs.timestamp=isNaN(n.getTime())?t:n.getTime().toString()}else String(e.attrs.timestamp).match(/^\d+$/)||(e.attrs.timestamp=t)}else e.attrs.timestamp=t}"panel"===a.name&&e.attrs?.panelType==="tip"&&(0,i("dh538").fg)("platform_editor_convert_tip_to_info")&&(e.attrs.panelType="info");let s=e.content?this.repairContent({newContent:e.content,parentNodeType:a}).filter(e=>!!e).map(e=>this.schema.nodeFromJSON(e)):void 0,l=e.attrs;if((0,i("dh538").fg)("platform_editor_ai_repair_attrs_with_validatorspec")){let e=(0,i("8LROh").validateAndRepairNodeAttrs)(a.name,l);e.isValid&&(l=e.repairedAttrs)}let c=a.createAndFill(l,s,o),d=[];if(!c&&s){let{repairedContent:t,invalidNodes:n}=this.repairInvalidContent({parentNodeType:a,maybeContent:s});if(d=n,!(c=a.createAndFill(l,t,o)))return void this.fireAnalyticEvent({type:"info",message:"Tried to repair content of node, but failed.",data:{nodeType:a.name??"type is undefined",repairedContentNodeTypeTree:t.map(e=>this.getNodeTypeTree(e)),originalNodeTypeTree:this.getPartialNodeTypeTree(e)}})}return{node:c,invalidNodes:d}}repairNodeNew({partialNodeJson:e,parentNodeType:t,isTopNode:n}){let a=this.inferNodeType({partialNodeJson:e,parentNodeType:t,isTopNode:n});if(!a)return void this.fireAnalyticEvent({type:"info",message:"Failed to infer node type.",data:{nodeType:e.type??"type is undefined"}});let r=e.marks;if((0,i("dh538").fg)("platform_editor_ai_repair_using_validatorspec")){let e=(0,i("haQ6N").repairNodeMarks)(a.name,r);e.repairedMarks&&e.repairedMarks.length>0&&(r=e.repairedMarks),e.errors&&e.errors.length}let o=r?r.map(e=>this.createMark(e)).filter(e=>null!==e):[];if("text"===a.name)return{node:this.schema.text(e.text?e.text:" ",o),invalidNodes:[]};let s=e.content?this.repairContent({newContent:e.content,parentNodeType:a}).filter(e=>!!e).map(e=>this.schema.nodeFromJSON(e)):void 0,l=e.attrs;if((0,i("dh538").fg)("platform_editor_ai_repair_attrs_with_validatorspec")){let e=(0,i("8LROh").validateAndRepairNodeAttrs)(a.name,l);e.isValid&&(l=e.repairedAttrs)}let c={...e,attrs:l},d=(0,i("grDNZ").toSupportedNode)(a.name,c),p=a.createAndFill(d.attrs,s,o),u=[];if(!p&&s){let{repairedContent:e,invalidNodes:t}=this.repairInvalidContent({parentNodeType:a,maybeContent:s});if(u=t,!(p=a.createAndFill(d.attrs,e,o)))return void this.fireAnalyticEvent({type:"info",message:"Tried to repair content of node, but failed.",data:{nodeType:a.name??"type is undefined",repairedContentNodeTypeTree:e.map(e=>this.getNodeTypeTree(e)),originalNodeTypeTree:this.getPartialNodeTypeTree(d)}})}return{node:p,invalidNodes:u}}repairInvalidContent({parentNodeType:e,maybeContent:t}){let n=e.contentMatch,a=[],r=[];return t.forEach((t,o)=>{let s=n.matchType(t.type);if(s)n=s,r.push(t);else{let{taskItem:s,paragraph:l}=this.schema.nodes;if(e===s&&t.type===l&&(0,i("dh538").fg)("platform_editor_ai_generic_prep_for_aifc_2"))return void r.push(...t.content.content);if(o>0&&r.length>0){let n=r[r.length-1],i=n.childCount;if(n.canReplaceWith(i,i,t.type)){let i=n.content,a=i.addToEnd(t),s=n.copy(a);r[r.length-1]=s;let l={parentNodeType:e.name,previousNodeType:n.type.name,movedNodeType:t.type.name,oldChildIndex:o,childIndexInPreviousNode:i.childCount};g(this.analyticsEventsSessionData.adf.repairInvalidContent,"nodeMovedToEndOfPreviousNodeEvents",l)||this.analyticsEventsSessionData.adf.repairInvalidContent.nodeMovedToEndOfPreviousNodeEvents.push(l);return}}let c=n.findWrapping(t.type),d=t;if(c){for(let e=c?.length-1;e>=0;e--){let n=c[e],i=n.createAndFill(null,[d]);if(i)d=i;else{let e={childNodeType:t.type.name,childIndex:o,wrappingNodeType:n.name,currentChildNode:d.type.name};g(this.analyticsEventsSessionData.adf.repairInvalidContent,"invalidWrappingNodesEvents",e)||this.analyticsEventsSessionData.adf.repairInvalidContent.invalidWrappingNodesEvents.push(e);return}}let n={childNodeType:t.type.name,childIndex:o,wrappingNodeTypes:c.map(e=>e.name),parentNodeType:e.name};g(this.analyticsEventsSessionData.adf.repairInvalidContent,"wrappingNodesFoundEvents",n)||this.analyticsEventsSessionData.adf.repairInvalidContent.wrappingNodesFoundEvents.push(n),r.push(d)}else{let n={childNodeType:t.type.name,parentNodeType:e.name,childIndex:o};g(this.analyticsEventsSessionData.adf.repairInvalidContent,"wrappingNodesNotFoundEvents",n)||this.analyticsEventsSessionData.adf.repairInvalidContent.wrappingNodesNotFoundEvents.push(n),a.push(t)}}}),{repairedContent:r.filter(e=>!!e),invalidNodes:a}}inferNodeType({partialNodeJson:e,parentNodeType:t,isTopNode:n}){let a=null;return e.type&&(a=this.schema.nodes[e.type]),!a&&(n?a=this.schema.topNodeType:(((0,i("dh538").fg)("platform_editor_ai_generic_prep_for_aifc_2")?o(this.schema,t?.name):r(t?.name))||t?.name==="codeBlock"||"object"==typeof e&&"text"in e)&&(a=this.schema.nodes.text)),a||t?.contentMatch.defaultType}repairContent({newContent:e,parentNodeType:t}){let n=[];return e.forEach((e,i)=>{try{let i=this.repairNode({partialNodeJson:e,parentNodeType:t});i?.node&&n.push(i.node.toJSON()),i?.invalidNodes&&i?.invalidNodes.length>0&&n.push(...i.invalidNodes.map(e=>e.toJSON()))}catch(n){this.fireAnalyticEvent({type:"info",message:"Failed to repair node",data:{error:n instanceof Error?n.message:"Unknown error",stack:n instanceof Error?n.stack:void 0,nodeType:e.type??"type is undefined",parentNodeType:t.name,childIndex:i}})}}),n}validateNodeUsingValidator(e,t){let n=Object.keys(this.schema.nodes),a=Object.keys(this.schema.marks),r=(0,i("jqXx5").validator)(n,a,{allowPrivateAttributes:!0,mode:"strict"});try{let n;if("table"===e.type.name&&(t?.name==="tableCell"||t?.name==="tableHeader"))return{result:!0};let i=r({...e?.toJSON(),..."doc"===e.type.name?{version:"1"}:{}},(e,t)=>{n={nodeType:e.type??"type is undefined",validationError:t}});if(i.valid)return{result:!0,entity:i.entity,error:n};return{result:!1,error:n}}catch(t){return{result:!1,error:{nodeType:e.type.name,errorMessage:t instanceof Error?t.message:"Unknown error"}}}}createMark(e){if(e.type){let t=this.schema.marks[e.type];return t?t.create(e.attrs):(this.fireAnalyticEvent({type:"info",message:"Failed to repair mark, type not found",data:{markType:e.type}}),null)}return null}getPartialNodeTypeTree(e){let t=e.content;return{type:e.type,content:Array.isArray(t)?t.map(e=>this.getPartialNodeTypeTree(e)):[]}}getNodeTypeTree(e){let t=e.content;return{type:e.type.name,content:Array.isArray(t)?t.map(e=>this.getNodeTypeTree(e)):[]}}isEmptyLastDoc(){try{let e=this.schema.nodeFromJSON(this.lastDoc).textContent;return 0===e.length}catch(e){return!0}}endStreamingSession({hasProcessedFinalResponse:e}={}){this.fireAnalyticEvent({type:"info",message:"Number of chunks processed",data:{chunksCount:this.analyticsEventsSessionData.chunksCount,inputDocumentTree:this.inputDocumentTree}}),this.isEmptyLastDoc()&&e&&this.fireAnalyticEvent({type:"error",message:"Top node is empty",data:{inputDocumentTree:this.inputDocumentTree}}),this.analyticsEventsSessionData.json.repairJson.failed&&(this.fireAnalyticEvent({type:"info",message:"Failed to repair partial JSON using jsonrepair",data:{error:this.analyticsEventsSessionData.json.repairJson.error,firstFailedAtChunk:this.analyticsEventsSessionData.json.repairJson.firstFailedAtChunk,lastFailedAtChunk:this.analyticsEventsSessionData.json.repairJson.lastFailedAtChunk,recovered:this.analyticsEventsSessionData.json.repairJson.recovered,firstRecoveredAtChunk:this.analyticsEventsSessionData.json.repairJson.firstRecoveredAtChunk,lastRecoveredAtChunk:this.analyticsEventsSessionData.json.repairJson.lastRecoveredAtChunk}}),this.analyticsEventsSessionData.json.repairJson.recovered||this.fireAnalyticEvent({type:"error",message:"Received invalid json",data:{error:this.analyticsEventsSessionData.json.repairJson.error,firstFailedAtChunk:this.analyticsEventsSessionData.json.repairJson.firstFailedAtChunk,lastFailedAtChunk:this.analyticsEventsSessionData.json.repairJson.lastFailedAtChunk}})),this.analyticsEventsSessionData.adf.failedToRepairADF.failed&&(this.analyticsEventsSessionData.adf.failedToRepairADF.recovered?this.fireAnalyticEvent({type:"info",message:"Failed to repair ADF json during streaming, but recovered",data:{error:this.analyticsEventsSessionData.adf.failedToRepairADF.error,stack:this.analyticsEventsSessionData.adf.failedToRepairADF.stack,firstFailedAtChunk:this.analyticsEventsSessionData.adf.failedToRepairADF.firstFailedAtChunk,lastFailedAtChunk:this.analyticsEventsSessionData.adf.failedToRepairADF.lastFailedAtChunk,recovered:this.analyticsEventsSessionData.adf.failedToRepairADF.recovered,firstRecoveredAtChunk:this.analyticsEventsSessionData.adf.failedToRepairADF.firstRecoveredAtChunk,lastRecoveredAtChunk:this.analyticsEventsSessionData.adf.failedToRepairADF.lastRecoveredAtChunk}}):this.fireAnalyticEvent({type:"error",message:"Failed to repair ADF Json",data:{error:this.analyticsEventsSessionData.adf.failedToRepairADF.error,stack:this.analyticsEventsSessionData.adf.failedToRepairADF.stack,firstFailedAtChunk:this.analyticsEventsSessionData.adf.failedToRepairADF.firstFailedAtChunk,lastFailedAtChunk:this.analyticsEventsSessionData.adf.failedToRepairADF.lastFailedAtChunk}})),this.analyticsEventsSessionData.adf.topNode.failed&&(this.analyticsEventsSessionData.adf.topNode.recovered?this.fireAnalyticEvent({type:"info",message:"Got invalid top not, but recovered",data:{error:this.analyticsEventsSessionData.adf.topNode.error,firstFailedAtChunk:this.analyticsEventsSessionData.adf.topNode.firstFailedAtChunk,lastFailedAtChunk:this.analyticsEventsSessionData.adf.topNode.lastFailedAtChunk,firstRecoveredAtChunk:this.analyticsEventsSessionData.adf.topNode.firstRecoveredAtChunk,lastRecoveredAtChunk:this.analyticsEventsSessionData.adf.topNode.lastRecoveredAtChunk}}):this.fireAnalyticEvent({type:"error",message:"Invalid top node",data:{error:this.analyticsEventsSessionData.adf.topNode.error,firstFailedAtChunk:this.analyticsEventsSessionData.adf.topNode.firstFailedAtChunk,lastFailedAtChunk:this.analyticsEventsSessionData.adf.topNode.lastFailedAtChunk}})),this.analyticsEventsSessionData.adf.topNodeValidation.failed&&(this.analyticsEventsSessionData.adf.topNodeValidation.recovered?this.fireAnalyticEvent({type:"info",message:"Top node validation failed, but recovered",data:{error:this.analyticsEventsSessionData.adf.topNodeValidation.error,validationError:this.analyticsEventsSessionData.adf.topNodeValidation.validationError,firstFailedAtChunk:this.analyticsEventsSessionData.adf.topNodeValidation.firstFailedAtChunk,lastFailedAtChunk:this.analyticsEventsSessionData.adf.topNodeValidation.lastFailedAtChunk,firstRecoveredAtChunk:this.analyticsEventsSessionData.adf.topNodeValidation.firstRecoveredAtChunk,lastRecoveredAtChunk:this.analyticsEventsSessionData.adf.topNodeValidation.lastRecoveredAtChunk}}):this.fireAnalyticEvent({type:"error",message:"Top node validation failed",data:{error:this.analyticsEventsSessionData.adf.topNodeValidation.error,validationError:this.analyticsEventsSessionData.adf.topNodeValidation.validationError,firstFailedAtChunk:this.analyticsEventsSessionData.adf.topNodeValidation.firstFailedAtChunk,lastFailedAtChunk:this.analyticsEventsSessionData.adf.topNodeValidation.lastFailedAtChunk}})),this.analyticsEventsSessionData.adf.repairInvalidContent.wrappingNodesFoundEvents.forEach(e=>{this.fireAnalyticEvent({type:"info",message:"Wrapping nodes found",data:{...e}})}),this.analyticsEventsSessionData.adf.repairInvalidContent.nodeMovedToEndOfPreviousNodeEvents.forEach(e=>{this.fireAnalyticEvent({type:"info",message:"Node moved to the end of previous node",data:{...e}})}),this.analyticsEventsSessionData.adf.repairInvalidContent.invalidWrappingNodesEvents.forEach(e=>{this.fireAnalyticEvent({type:"info",message:"Invalid wrapping nodes found for node.",data:{...e}})}),this.analyticsEventsSessionData.adf.repairInvalidContent.wrappingNodesNotFoundEvents.forEach(e=>{this.fireAnalyticEvent({type:"info",message:"Wrapping nodes not found.",data:{...e}})})}constructor(e,t){this.jsonRepair=void 0,this.schema=void 0,this.lastDoc=void 0,this.fireAnalyticEventCallback=void 0,this.analyticsEventMetaData=void 0,this.inputDocumentTree=void 0,this.analyticsEventsSessionData=u(),this.jsonRepair=new(0,i("9SZMg").JsonRepair),this.schema=e,this.fireAnalyticEventCallback=t,this.lastDoc=this.createDefaultDoc(),this.inputDocumentTree=void 0}}}),a("6gJll",function(t,n){var a=i("cUcZ5"),r=i("k7eoe");function o(e,t){return"jiraProactiveDescriptionCompleterFooterButton"===t&&e===i("bwpRs").CONFIG_ITEM_KEYS.ADD_STRUCTURE?"proactiveDescriptionCompleter":e===i("bwpRs").CONFIG_ITEM_KEYS.EXPERIMENTAL_PROMPT_PLACEHOLDER&&(0,i("c6GJD").default.getExperimentValue)("platform_editor_ai-prompts-placeholder","analytics_experience_name","")||e}function s({errorSubType:e,errorProperties:t}){return{payload:{action:"unhandledErrorCaught",actionSubject:"editorPluginAI",actionSubjectId:"experienceApplication",attributes:{errorType:"userFlowAnalyticsError",errorSubType:e,...t},eventType:i("d925B").EVENT_TYPE.OPERATIONAL},channel:r.FabricChannel.editor}}t.exports.convertExperienceName=o,t.exports.createAnalyticsFlow=function({fireAIAnalyticsEvent:t,invokeAttributes:n,canInlineStreamChanges:r,onCommonAttributesUpdated:l,isInDocumentStreamingEnabled:c}){let d,p,u,g,m=performance.now(),f={},h=n.aiSessionId??e(a)(),_=n.aiGroupId??h,y=performance.now(),I={},E={},S={},b=!1,T=!1,C=0,A={stepName:"invoke",attributes:n},v=({init:e})=>(e&&u&&(S=u()),S),P=()=>({agentName:E.agentName,agentId:E.agentId,agentCreatorType:E.agentCreatorType,agentExternalConfigReference:E.agentExternalConfigReference,agentIsDefault:E.agentIsDefault});return{aiSessionId:h,aiGroupId:_,enqueueStep:e=>{if(b)return void t(s({aiSessionId:h,errorSubType:"userFlowAlreadyFinished",errorProperties:{stepArgs:e,queuedStepArgs:A}}));if("loading"===e.stepName&&(g=`${h}-${++C}`,c&&"streamingApi"===n.invokedFrom||t({payload:(0,i("ilIeg").createUnifiedAnalyticsPayload)({action:i("d925B").ACTION.INITIATED,interactionID:E.channelId??g,experienceName:o(p??"",n.invokedFrom),isProactive:!1,invokedFrom:n.invokedFrom,nudgeMetrics:E.nudgeMetrics,attributes:{...v({init:!0}),...P()}})})),"complete"===e.stepName){let a=e?.attributes??{},r="actionTaken"in a?a.actionTaken:void 0,s="promptType"in a?a.promptType:void 0,l="refinementCount"in a?a.refinementCount:void 0;t({payload:(0,i("ilIeg").createUnifiedAnalyticsPayload)({action:i("d925B").ACTION.ACTIONED,interactionID:E.channelId??g,experienceName:o(p??"",n.invokedFrom),isProactive:!1,invokedFrom:n.invokedFrom,nudgeMetrics:E.nudgeMetrics,attributes:{...v({init:!1}),...P(),promptType:s,refinementCount:l,aiResultAction:r?.toLowerCase()},traceIds:E.traceIds})})}if(void 0!==A)return void t(s({aiSessionId:h,errorSubType:"cannotEnqueueMoreThanOneEvent",errorProperties:{stepArgs:e,queuedStepArgs:A}}));A=e},fireQueuedStep:e=>b?void t(s({aiSessionId:h,errorSubType:"userFlowAlreadyFinished",errorProperties:{target:e,queuedStepArgs:A}})):A?void(A.attributes={...A.attributes,...I,...E,invokedFrom:n.invokedFrom,nudgeMetrics:E.nudgeMetrics,invokedFor:n.invokedFor,triggerMethod:n.triggerMethod,target:e,...(0,i("dh538").fg)("platform_editor_ai_streaming_ended_analytics_attr")?{isStreamingEnded:!!E.isStreamingEnded}:void 0},("failed"===e||"apiError"===e)&&t({payload:(0,i("ilIeg").createUnifiedAnalyticsPayload)({action:i("d925B").ACTION.ERROR,interactionID:E.channelId??g,experienceName:o(p??"",n.invokedFrom),isProactive:!1,invokedFrom:n.invokedFrom,nudgeMetrics:E.nudgeMetrics,attributes:{...v({init:!1}),...P(),aiErrorMessage:(0,i("4SGh1").isErrorStepAttributes)(A?.attributes)?A?.attributes?.errorKey??A?.attributes?.errorType:"Unknown error",aiErrorCode:(0,i("4SGh1").isErrorStepAttributes)(A.attributes)?A.attributes?.statusCode??500:500},traceIds:E.traceIds})}),"preview"===e&&!r()&&t({payload:(0,i("ilIeg").createUnifiedAnalyticsPayload)({action:i("d925B").ACTION.VIEWED,interactionID:E.channelId??g,experienceName:o(p??"",n.invokedFrom),isProactive:!1,invokedFrom:n.invokedFrom,nudgeMetrics:E.nudgeMetrics,attributes:{...v({init:!1}),...P()},traceIds:E.traceIds})}),function({stepName:e,attributes:a={}}){f[e]?f[e]=f[e]+1:f[e]=1,a.experienceName&&(p=o(a.experienceName,n.invokedFrom));let r={...E,duration:Math.round(performance.now()-y),...a,aiSessionId:h,aiGroupId:_,experienceName:p,featureId:a.featureId||n.featureId,source:d,invokedFrom:a.invokedFrom,nudgeMetrics:a.nudgeMetrics,triggerMethod:a.triggerMethod,isInvokedFromEmptyPage:a.isInvokedFromEmptyPage,stepOccurrence:String(f[e]),sawAupViolation:!1,includeKnowledgeFromCurrentPage:a.includeKnowledgeFromCurrentPage};a.target||(r.totalDuration=Math.round(performance.now()-m),r.contentCopiedSometime=T,b=!0),("loading"===r.source||"complete"===e)&&(r.aiInteractionID=g);let s={action:e,actionSubject:"editorPluginAI",actionSubjectId:"userFlow",attributes:r,eventType:i("d925B").EVENT_TYPE.UI};y=performance.now(),d=e;let l="modelIO"in I?I.modelIO:void 0;I={},t({payload:s}),b&&t({payload:{...s,action:"finished",attributes:{...s.attributes,source:e,modelIO:(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")?l:void 0}}})}(A),A=void 0):void t(s({aiSessionId:h,errorSubType:"noEventExistsToBeFired",errorProperties:{target:e}})),addAttributes:e=>{"contentCopied"in e&&e.contentCopied&&(T=!0),I={...I,...e}},getAiLifeCycleDynamicAttributes:v,registerAiLifeCycleDynamicAttributesGetter:e=>{u=e},updateCommonAttributes:e=>{if((0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")){let t={...E,...e};E=t,l?.(t)}else E={...E,...e}},getLastAiInteractionId:()=>g,getUnifiedEventData:()=>({interactionID:E.channelId??g,experienceName:o(p??"",n.invokedFrom),invokedFrom:n.invokedFrom,traceIds:E.traceIds,attributes:{...v({init:!1}),...P()}}),getUserFlowCommonAttributes:e=>({agentName:e.agent?.creatorType==="SYSTEM"?e.agent?.name:void 0,agentId:e.agent?.id,agentCreatorType:e.agent?.creatorType,agentExternalConfigReference:e.agent?.externalConfigReference,agentIsDefault:e.agent?.isDefault,adfPrompt:!!e.adfPrompt}),getCommonAttributes:()=>E}}}),a("3yUTv",function(e,t){let n=new(0,i("ks2lK").PluginKey)("aiExperienceDecoration");e.exports.aiExperienceDecorationPluginKey=n}),a("56Rej",function(e,t){e.exports.hasGeneratedContentDecorations=e=>e.modalDecorationSet.find(void 0,void 0,e=>"generatedInlineDecoration"===e.key||"generatedNodeDecoration"===e.key||"generatedStartWidget"===e.key||"generatedEndWidget"===e.key).length>0}),a("9F9dO",function(e,t){var n,i=((n={}).INIT_POSITIONS="initPositions",n.ADJUST_INIT_POSITIONS="adjustInitPositions",n.UPDATE_STREAM_POSITIONS="updateStream",n.UPDATE_LOADING_POSITIONS="updateLoadingPos",n.END_STREAM="endStream",n);e.exports.ACTIONS=i}),a("hX9je",function(e,t){e.exports.isConfluenceTitleToolbarSuggestTitle=({configItem:e,lastTriggeredFrom:t})=>!!e&&!!t&&e.key===i("bwpRs").CONFIG_ITEM_KEYS.SUGGEST_A_TITLE&&"confluenceTitleToolbar"===t,e.exports.isSuggestTitleForConfluence=e=>e.key===i("bwpRs").CONFIG_ITEM_KEYS.SUGGEST_A_TITLE}),a("kTCUV",function(e,t){e.exports.startWatchingAnnotationChanges=({from:e,to:t})=>n=>n.setMeta(i("3tFte").aiAnnotationWatchmenPluginKey,{action:i("9OCYt").ACTIONS.START_WATCHING_REGION,from:e,to:t}),e.exports.endWatchingAnnotationChanges=e=>e.setMeta(i("3tFte").aiAnnotationWatchmenPluginKey,{action:i("9OCYt").ACTIONS.END_WATCHING_REGION})}),a("5vNOi",function(e,t){let n=new(0,i("ks2lK").PluginKey)("inEditorDirectStreaming");e.exports.inEditorDirectStreamingPluginKey=n}),a("eyHC2",function(e,t){e.exports.initPositions=({start:e,end:t,showHighlight:n,showAIContentHighlight:a,showTelepointer:r,telepointerPos:o})=>s=>s.setMeta(i("5vNOi").inEditorDirectStreamingPluginKey,{action:i("9F9dO").ACTIONS.INIT_POSITIONS,positions:{startPos:e,userContentEndPos:t,telepointerPos:o},showHighlight:n,showAIContentHighlight:a,showTelepointer:r}),e.exports.adjustInitPositions=({start:e,end:t})=>n=>n.setMeta(i("5vNOi").inEditorDirectStreamingPluginKey,{action:i("9F9dO").ACTIONS.ADJUST_INIT_POSITIONS,positions:{startPos:e,userContentEndPos:t}}),e.exports.updateStreamPositions=({aiContentEndPos:e,telepointerPos:t,isFinalStream:n})=>a=>a.setMeta(i("5vNOi").inEditorDirectStreamingPluginKey,{action:i("9F9dO").ACTIONS.UPDATE_STREAM_POSITIONS,positions:{aiContentEndPos:e,telepointerPos:t},isFinalStream:n}),e.exports.updateLoadingPositions=e=>e.setMeta(i("5vNOi").inEditorDirectStreamingPluginKey,{action:i("9F9dO").ACTIONS.UPDATE_LOADING_POSITIONS}),e.exports.endStream=e=>e.setMeta(i("5vNOi").inEditorDirectStreamingPluginKey,{action:i("9F9dO").ACTIONS.END_STREAM}),e.exports.metaTransaction=({tr:e,isFinalStream:t,stackTime:n})=>(e=e.setMeta("isAIStreamingTransformation",!0).setMeta("isAIFinalStreamingTransformation",!!t).setMeta("scrollIntoView",!1),n&&e.setTime(n),e)}),a("cVxBN",function(e,t){e.exports.isWithinSameCell=function({$from:e,$to:t,schema:n}){let i,a,{tableCell:r,tableHeader:o}=n.nodes;for(let t=e.depth;t>0;t--)if([r,o].includes(e.node(t).type)){i=e.node(t);break}if(!i)return!1;for(let e=t.depth;e>0;e--)if([r,o].includes(t.node(e).type)){a=t.node(e);break}return!!a&&i.eq(a)},e.exports.getPositionNodeTypeDepth=function({resolvedPos:e,nodeType:t}){for(let n=e.depth;n>0;n--)if(e.node(n).type===t)return n}}),a("fXyZM",function(e,t){let n=new(0,i("ks2lK").PluginKey)("aiExperienceSelection");e.exports.selectionPluginKey=n}),a("3ZqD0",function(e,t){var n=i("l998X");i("42omo");let a={small:"_1bsb7vkz _4t3i7vkz",medium:"_1bsb1tcg _4t3i1tcg",large:"_1bsbzwfg _4t3izwfg",xlarge:"_1bsbckbl _4t3ickbl"},r=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M10.7601 0.338448C11.5933 -0.121106 12.6101 -0.112663 13.4365 0.363775L19.9352 4.11317L21.4762 5.0023C22.3177 5.4874 22.8385 6.3874 22.8385 7.35696V16.6341C22.8385 17.6075 22.3208 18.5036 21.4769 18.9884L15.4334 22.4752C15.4466 22.438 15.4592 22.4006 15.4713 22.363C15.5834 22.0154 15.6429 21.6481 15.6429 21.2727V11.9955C15.6429 10.7211 14.9646 9.5458 13.8581 8.91002L12.7419 8.26625L9.35306 6.31196V2.71838C9.35306 2.43521 9.39687 2.1586 9.47978 1.89674C9.68356 1.26299 10.117 0.714353 10.7101 0.371867L10.7119 0.37083C10.7288 0.361022 10.745 0.350144 10.7601 0.338448Z",fill:"#FCA700"}),(0,n.jsx)("path",{d:"M8.71417 1.52478L2.67066 5.01159C1.82674 5.49643 1.30908 6.39246 1.30908 7.36586V16.643C1.30908 17.6126 1.82979 18.5125 2.67121 18.9976L4.10412 19.8243L10.7111 23.6362C11.5374 24.1126 12.5543 24.1211 13.3875 23.6616C13.4026 23.6499 13.4186 23.639 13.4356 23.6292C14.0293 23.287 14.4634 22.7381 14.6675 22.1041C14.7506 21.842 14.7945 21.5651 14.7945 21.2816V17.688L11.2974 15.6713L10.2897 15.0901C9.18348 14.4543 8.50468 13.2788 8.50468 12.0044V2.72728C8.50468 2.35237 8.56398 1.98558 8.67586 1.63842C8.68799 1.60029 8.70078 1.56241 8.71417 1.52478Z",fill:"#FCA700"}),(0,n.jsx)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.2974 15.6713L4.10412 19.8243L2.67121 18.9976C1.82979 18.5125 1.30908 17.6126 1.30908 16.643V7.36586C1.30908 6.39246 1.82674 5.49643 2.67066 5.01159L8.71417 1.52478C8.70078 1.56241 8.68799 1.60029 8.67586 1.63842C8.56398 1.98558 8.50468 2.35237 8.50468 2.72728V12.0044C8.50468 13.2788 9.18348 14.4543 10.2897 15.0901L11.2974 15.6713Z",fill:"#1868DB"}),(0,n.jsx)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M12.7419 8.26625L9.35306 6.31196V2.71838C9.35306 2.43521 9.39687 2.15859 9.47978 1.89674C9.68356 1.26299 10.117 0.714353 10.7101 0.371867L10.7119 0.37083C10.7288 0.361022 10.745 0.350144 10.7601 0.338447C11.5933 -0.121106 12.6101 -0.112663 13.4365 0.363775L19.9352 4.11317L12.7419 8.26625Z",fill:"#FCA700"}),(0,n.jsx)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M21.4762 5.00229L19.9352 4.11316L12.7419 8.26624L13.8581 8.91001C14.9646 9.54579 15.6429 10.721 15.6429 11.9955V21.2727C15.6429 21.6481 15.5834 22.0154 15.4713 22.363C15.4592 22.4006 15.4466 22.438 15.4334 22.4752L21.4769 18.9884C22.3208 18.5036 22.8385 17.6075 22.8385 16.6341V7.35695C22.8385 6.38739 22.3177 5.48739 21.4762 5.00229Z",fill:"#AF59E0"}),(0,n.jsx)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.2975 15.6713L4.10413 19.8244L10.7111 23.6362C11.5375 24.1126 12.5544 24.1211 13.3875 23.6616C13.4026 23.6499 13.4186 23.639 13.4356 23.6292C14.0293 23.287 14.4634 22.7381 14.6675 22.1041C14.7506 21.842 14.7945 21.5651 14.7945 21.2816V17.688L11.2975 15.6713Z",fill:"#6A9A23"})]});(0,n.jsxs)("g",{transform:"translate(4, 4)",children:[(0,n.jsx)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M7.53094 10.4476L2.73541 13.2163L1.78022 12.6652C1.21927 12.3418 0.872135 11.7418 0.872135 11.0954V4.91066C0.872135 4.26173 1.21724 3.66437 1.77985 3.34114L5.80885 1.01662C5.79992 1.0417 5.7914 1.06696 5.78331 1.09238C5.70872 1.32382 5.66919 1.56834 5.66919 1.81828V8.00304C5.66919 8.8526 6.12173 9.63628 6.85921 10.0602L7.53094 10.4476Z",fill:"#357DE8"}),(0,n.jsx)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M7.53076 10.4476L2.73523 13.2163L7.13984 15.7575C7.69076 16.0751 8.36871 16.0808 8.92411 15.7744C8.93417 15.7666 8.94488 15.7594 8.95621 15.7529C9.35198 15.5247 9.6414 15.1588 9.77748 14.7361C9.83287 14.5614 9.86214 14.3768 9.86214 14.1878V11.7921L7.53076 10.4476Z",fill:"#82B536"}),(0,n.jsx)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.3184 3.33501L13.291 2.74227L8.49549 5.51098L9.23969 5.94015C9.97729 6.36401 10.4295 7.14752 10.4295 7.99717V14.1819C10.4295 14.4322 10.3899 14.6771 10.3151 14.9088C10.3071 14.9339 10.2987 14.9588 10.2899 14.9836L14.3189 12.6591C14.8815 12.3358 15.2266 11.7385 15.2266 11.0895V4.90479C15.2266 4.25842 14.8794 3.65842 14.3184 3.33501Z",fill:"#BF63F3"}),(0,n.jsx)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M8.49384 5.51082L6.23466 4.20796V1.81225C6.23466 1.62347 6.26387 1.43906 6.31913 1.26449C6.455 0.841993 6.74398 0.476235 7.13931 0.247911L7.14051 0.247219C7.15185 0.240681 7.16263 0.233429 7.17269 0.225631C7.72811 -0.0807372 8.40603 -0.0751089 8.95696 0.242516L13.2894 2.74211L8.49384 5.51082Z",fill:"#FCA700"})]}),e.exports.default=e=>{let{primaryColor:t,size:o="small",label:s}=e;return(0,n.jsx)("svg",{viewBox:"0 0 24 24",style:{color:t},"aria-label":s||void 0,role:s?"img":"presentation",className:(0,i("gMc0m").default)(["_1reo15vq _18m915vq _lswuvuon _lcxvglyw",a[o]]),children:r})}}),a("3Ev1M",function(e,t){var n,a;i("2gWl9");let r=new WeakMap;new WeakMap,a=void 0,n=e=>void 0,e.exports.fromCallback=function(e){return{config:e,start:(t,n)=>{let{self:i,system:a,emit:o}=n,s={receivers:void 0,dispose:void 0};r.set(i,s),s.dispose=e({input:t.input,system:a,self:i,sendBack:e=>{"stopped"!==i.getSnapshot().status&&i._parent&&a._relay(i,i._parent,e)},receive:e=>{s.receivers??(s.receivers=new Set),s.receivers.add(e)},emit:o})},transition:(e,t,n)=>{let a=r.get(n.self);return t.type===i("d0N4G").X?(e={...e,status:"stopped",error:void 0},a.dispose?.()):a.receivers?.forEach(e=>e(t)),e},getInitialSnapshot:(e,t)=>({status:"active",output:void 0,error:void 0,input:t}),getPersistedSnapshot:e=>e,restoreSnapshot:e=>e}}}),a("d0N4G",function(e,t){var n,a=i("2gWl9");class r{start(){this._active=!0,this.flush()}clear(){this._current&&(this._current.next=null,this._last=this._current)}enqueue(e){let t={value:e,next:null};if(this._current){this._last.next=t,this._last=t;return}this._current=t,this._last=t,this._active&&this.flush()}flush(){for(;this._current;){let e=this._current;this._process(e.value),this._current=e.next}this._last=null}constructor(e){this._process=e,this._active=!1,this._current=null,this._last=null}}let o="xstate.init",s="xstate.stop";function l(e,t){return{type:`xstate.done.state.${e}`,output:t}}function c(e,t){return{type:`xstate.error.actor.${e}`,error:t,actorId:e}}function d(e){return{type:o,input:e}}function p(e){setTimeout(()=>{throw e})}let u="function"==typeof Symbol&&Symbol.observable||"@@observable";function g(e){if(y(e))return e;let t=[],n="";for(let i=0;i<e.length;i++){switch(e.charCodeAt(i)){case 92:n+=e[i+1],i++;continue;case 46:t.push(n),n="";continue}n+=e[i]}return t.push(n),t}function m(e){var t;return(t=e)&&"object"==typeof t&&"machine"in t&&"value"in t?e.value:"string"!=typeof e?e:function(e){if(1===e.length)return e[0];let t={},n=t;for(let t=0;t<e.length-1;t++)if(t===e.length-2)n[e[t]]=e[t+1];else{let i=n;n={},i[e[t]]=n}return t}(g(e))}function f(e){return y(e)?e:[e]}function h(e){var t;return void 0===e?[]:y(t=e)?t:[t]}function _(e,t,n,i){return"function"==typeof e?e({context:t,event:n,self:i}):e}function y(e){return Array.isArray(e)}function I(e){var t;return(y(t=e)?t:[t]).map(e=>void 0===e||"string"==typeof e?{target:e}:e)}function E(e){if(void 0!==e&&""!==e)return h(e)}function S(e,t,n){let i="object"==typeof e,a=i?e:void 0;return{next:(i?e.next:e)?.bind(a),error:(i?e.error:t)?.bind(a),complete:(i?e.complete:n)?.bind(a)}}function b(e,t){let n=t.match(/^xstate\.invoke\.(\d+)\.(.*)/);if(!n)return e.implementations.actors[t];let[,i,a]=n,r=e.getStateNodeById(a).config.invoke;return(Array.isArray(r)?r[i]:r).src}function T(e,t){return`${e.sessionId}.${t}`}let C=0,A=!1,v=((n={})[n.NotStarted=0]="NotStarted",n[n.Running=1]="Running",n[n.Stopped=2]="Stopped",n),P={clock:{setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e)},logger:console.log.bind(console),devTools:!1};class k{_initState(e){try{this._snapshot=e?this.logic.restoreSnapshot?this.logic.restoreSnapshot(e,this._actorScope):e:this.logic.getInitialSnapshot(this._actorScope,this.options?.input)}catch(e){this._snapshot={status:"error",output:void 0,error:e}}}update(e,t){let n;for(this._snapshot=e;n=this._deferred.shift();)try{n()}catch(t){this._deferred.length=0,this._snapshot={...e,status:"error",error:t}}switch(this._snapshot.status){case"active":for(let t of this.observers)try{t.next?.(e)}catch(e){p(e)}break;case"done":var i;for(let t of this.observers)try{t.next?.(e)}catch(e){p(e)}this._stopProcedure(),this._complete(),this._doneEvent=(i=this.id,{type:`xstate.done.actor.${i}`,output:this._snapshot.output,actorId:i}),this._parent&&this.system._relay(this,this._parent,this._doneEvent);break;case"error":this._error(this._snapshot.error)}this.system._sendInspectionEvent({type:"@xstate.snapshot",actorRef:this,event:t,snapshot:e})}subscribe(e,t,n){let i=S(e,t,n);if(this._processingStatus!==v.Stopped)this.observers.add(i);else switch(this._snapshot.status){case"done":try{i.complete?.()}catch(e){p(e)}break;case"error":{let e=this._snapshot.error;if(i.error)try{i.error(e)}catch(e){p(e)}else p(e)}}return{unsubscribe:()=>{this.observers.delete(i)}}}on(e,t){let n=this.eventListeners.get(e);n||(n=new Set,this.eventListeners.set(e,n));let i=t.bind(void 0);return n.add(i),{unsubscribe:()=>{n.delete(i)}}}start(){if(this._processingStatus===v.Running)return this;this._syncSnapshot&&this.subscribe({next:e=>{"active"===e.status&&this.system._relay(this,this._parent,{type:`xstate.snapshot.${this.id}`,snapshot:e})},error:()=>{}}),this.system._register(this.sessionId,this),this._systemId&&this.system._set(this._systemId,this),this._processingStatus=v.Running;let e=d(this.options.input);switch(this.system._sendInspectionEvent({type:"@xstate.event",sourceRef:this._parent,actorRef:this,event:e}),this._snapshot.status){case"done":return this.update(this._snapshot,e),this;case"error":return this._error(this._snapshot.error),this}if(this._parent||this.system.start(),this.logic.start)try{this.logic.start(this._snapshot,this._actorScope)}catch(e){return this._snapshot={...this._snapshot,status:"error",error:e},this._error(e),this}return this.update(this._snapshot,e),this.options.devTools&&this.attachDevTools(),this.mailbox.start(),this}_process(e){let t,n;try{t=this.logic.transition(this._snapshot,e,this._actorScope)}catch(e){n={err:e}}if(n){let{err:e}=n;this._snapshot={...this._snapshot,status:"error",error:e},this._error(e);return}this.update(t,e),e.type===s&&(this._stopProcedure(),this._complete())}_stop(){return this._processingStatus===v.Stopped||((this.mailbox.clear(),this._processingStatus===v.NotStarted)?this._processingStatus=v.Stopped:this.mailbox.enqueue({type:s})),this}stop(){if(this._parent)throw Error("A non-root actor cannot be stopped directly.");return this._stop()}_complete(){for(let e of this.observers)try{e.complete?.()}catch(e){p(e)}this.observers.clear()}_reportError(e){if(!this.observers.size){this._parent||p(e);return}let t=!1;for(let n of this.observers){let i=n.error;t||(t=!i);try{i?.(e)}catch(e){p(e)}}this.observers.clear(),t&&p(e)}_error(e){this._stopProcedure(),this._reportError(e),this._parent&&this.system._relay(this,this._parent,c(this.id,e))}_stopProcedure(){return this._processingStatus!==v.Running||(this.system.scheduler.cancelAll(this),this.mailbox.clear(),this.mailbox=new r(this._process.bind(this)),this._processingStatus=v.Stopped,this.system._unregister(this)),this}_send(e){this._processingStatus!==v.Stopped&&this.mailbox.enqueue(e)}send(e){this.system._relay(void 0,this,e)}attachDevTools(){let{devTools:e}=this.options;e&&("function"==typeof e?e:a.devToolsAdapter)(this)}toJSON(){return{xstate$$type:1,id:this.id}}getPersistedSnapshot(e){return this.logic.getPersistedSnapshot(this._snapshot,e)}[u](){return this}getSnapshot(){return this._snapshot}constructor(e,t){this.logic=e,this._snapshot=void 0,this.clock=void 0,this.options=void 0,this.id=void 0,this.mailbox=new r(this._process.bind(this)),this.observers=new Set,this.eventListeners=new Map,this.logger=void 0,this._processingStatus=v.NotStarted,this._parent=void 0,this._syncSnapshot=void 0,this.ref=void 0,this._actorScope=void 0,this._systemId=void 0,this.sessionId=void 0,this.system=void 0,this._doneEvent=void 0,this.src=void 0,this._deferred=[];let n={...P,...t},{clock:i,logger:a,parent:o,syncSnapshot:s,id:l,systemId:c,inspect:d}=n;this.system=o?o.system:function(e,t){let n=new Map,i=new Map,a=new WeakMap,r=new Set,o={},{clock:s,logger:l}=t,c={schedule:(e,t,n,i,a=Math.random().toString(36).slice(2))=>{let r={source:e,target:t,event:n,delay:i,id:a,startedAt:Date.now()},l=T(e,a);d._snapshot._scheduledEvents[l]=r;let c=s.setTimeout(()=>{delete o[l],delete d._snapshot._scheduledEvents[l],d._relay(e,t,n)},i);o[l]=c},cancel:(e,t)=>{let n=T(e,t),i=o[n];delete o[n],delete d._snapshot._scheduledEvents[n],void 0!==i&&s.clearTimeout(i)},cancelAll:e=>{for(let t in d._snapshot._scheduledEvents){let n=d._snapshot._scheduledEvents[t];n.source===e&&c.cancel(e,n.id)}}},d={_snapshot:{_scheduledEvents:(t?.snapshot&&t.snapshot.scheduler)??{}},_bookId:()=>`x:${C++}`,_register:(e,t)=>(n.set(e,t),e),_unregister:e=>{n.delete(e.sessionId);let t=a.get(e);void 0!==t&&(i.delete(t),a.delete(e))},get:e=>i.get(e),_set:(e,t)=>{let n=i.get(e);if(n&&n!==t)throw Error(`Actor with system ID '${e}' already exists.`);i.set(e,t),a.set(t,e)},inspect:e=>{let t=S(e);return r.add(t),{unsubscribe(){r.delete(t)}}},_sendInspectionEvent:t=>{if(!r.size)return;let n={...t,rootId:e.sessionId};r.forEach(e=>e.next?.(n))},_relay:(e,t,n)=>{d._sendInspectionEvent({type:"@xstate.event",sourceRef:e,actorRef:t,event:n}),t._send(n)},scheduler:c,getSnapshot:()=>({_scheduledEvents:{...d._snapshot._scheduledEvents}}),start:()=>{let e=d._snapshot._scheduledEvents;for(let t in d._snapshot._scheduledEvents={},e){let{source:n,target:i,event:a,delay:r,id:o}=e[t];c.schedule(n,i,a,r,o)}},_clock:s,_logger:l};return d}(this,{clock:i,logger:a}),d&&!o&&this.system.inspect(S(d)),this.sessionId=this.system._bookId(),this.id=l??this.sessionId,this.logger=t?.logger??this.system._logger,this.clock=t?.clock??this.system._clock,this._parent=o,this._syncSnapshot=s,this.options=n,this.src=n.src??e,this.ref=this,this._actorScope={self:this,id:this.id,sessionId:this.sessionId,logger:this.logger,defer:e=>{this._deferred.push(e)},system:this.system,stopChild:e=>{if(e._parent!==this)throw Error(`Cannot stop child actor ${e.id} of ${this.id} because it is not a child`);e._stop()},emit:e=>{let t=this.eventListeners.get(e.type),n=this.eventListeners.get("*");if(t||n)for(let i of[...t?t.values():[],...n?n.values():[]])i(e)},actionExecutor:e=>{let t=()=>{if(this._actorScope.system._sendInspectionEvent({type:"@xstate.action",actorRef:this,action:{type:e.type,params:e.params}}),!e.exec)return;let t=A;try{A=!0,e.exec(e.info,e.params)}finally{A=t}};this._processingStatus===v.Running?t():this._deferred.push(t)}},this.send=this.send.bind(this),this.system._sendInspectionEvent({type:"@xstate.actor",actorRef:this}),c&&(this._systemId=c,this.system._set(c,this)),this._initState(t?.snapshot??t?.state),c&&"active"!==this._snapshot.status&&this.system._unregister(this)}}function x(e,...[t]){return new k(e,t)}function w(e,t,n,i,{sendId:a}){return[t,{sendId:"function"==typeof a?a(n,i):a},void 0]}function M(e,t){e.defer(()=>{e.system.scheduler.cancel(e.self,t.sendId)})}function N(e){function t(e,t){}return t.type="xstate.cancel",t.sendId=e,t.resolve=w,t.execute=M,t}function O(e,t,n,i,{id:a,systemId:r,src:o,input:s,syncSnapshot:l}){let c,d,p="string"==typeof o?b(t.machine,o):o,u="function"==typeof a?a(n):a;return p&&(d="function"==typeof s?s({context:t.context,event:n.event,self:e.self}):s,c=x(p,{id:u,src:o,parent:e.self,syncSnapshot:l,systemId:r,input:d})),[eI(t,{children:{...t.children,[u]:c}}),{id:a,systemId:r,actorRef:c,src:o,input:d},void 0]}function R(e,{actorRef:t}){t&&e.defer(()=>{t._processingStatus!==v.Stopped&&t.start()})}function D(...[e,{id:t,systemId:n,input:i,syncSnapshot:a=!1}={}]){function r(e,t){}return r.type="xstate.spawnChild",r.id=t,r.systemId=n,r.src=e,r.input=i,r.syncSnapshot=a,r.resolve=O,r.execute=R,r}function L(e,t,n,i,{actorRef:a}){let r="function"==typeof a?a(n,i):a,o="string"==typeof r?t.children[r]:r,s=t.children;return o&&(s={...s},delete s[o.id]),[eI(t,{children:s}),o,void 0]}function F(e,t){if(t){if(e.system._unregister(t),t._processingStatus!==v.Running)return void e.stopChild(t);e.defer(()=>{e.stopChild(t)})}}function G(e){function t(e,t){}return t.type="xstate.stopChild",t.actorRef=e,t.resolve=L,t.execute=F,t}function B(e,t,n,i){let{machine:a}=i,r="function"==typeof e,o=r?e:a.implementations.guards["string"==typeof e?e:e.type];if(!r&&!o)throw Error(`Guard '${"string"==typeof e?e:e.type}' is not implemented.'.`);if("function"!=typeof o)return B(o,t,n,i);let s={context:t,event:n},l=r||"string"==typeof e?void 0:"params"in e?"function"==typeof e.params?e.params({context:t,event:n}):e.params:void 0;return"check"in o?o.check(i,s,o):o(s,l)}let U=e=>"atomic"===e.type||"final"===e.type;function V(e){return Object.values(e.states).filter(e=>"history"!==e.type)}function j(e,t){let n=[];if(t===e)return n;let i=e.parent;for(;i&&i!==t;)n.push(i),i=i.parent;return n}function H(e){let t=new Set(e),n=z(t);for(let e of t)if("compound"!==e.type||n.get(e)&&n.get(e).length){if("parallel"===e.type){for(let n of V(e))if("history"!==n.type&&!t.has(n))for(let e of Q(n))t.add(e)}}else Q(e).forEach(e=>t.add(e));for(let e of t){let n=e.parent;for(;n;)t.add(n),n=n.parent}return t}function z(e){let t=new Map;for(let n of e)t.has(n)||t.set(n,[]),n.parent&&(t.has(n.parent)||t.set(n.parent,[]),t.get(n.parent).push(n));return t}function K(e,t){return function e(t,n){let i=n.get(t);if(!i)return{};if("compound"===t.type){let e=i[0];if(!e)return{};if(U(e))return e.key}let a={};for(let t of i)a[t.key]=e(t,n);return a}(e,z(H(t)))}function W(e,t){return"compound"===t.type?V(t).some(t=>"final"===t.type&&e.has(t)):"parallel"===t.type?V(t).every(t=>W(e,t)):"final"===t.type}let q=e=>"#"===e[0];function Y(e,t,n){let i=E(n.target),a=n.reenter??!1,r=function(e,t){if(void 0!==t)return t.map(t=>{if("string"!=typeof t)return t;if(q(t))return e.machine.getStateNodeById(t);let n="."===t[0];if(n&&!e.parent)return ee(e,t.slice(1));let i=n?e.key+t:t;if(e.parent)try{return ee(e.parent,i)}catch(t){throw Error(`Invalid transition definition for state node '${e.id}':
${t.message}`)}throw Error(`Invalid target: "${t}" is not a valid target from the root node. Did you mean ".${t}"?`)})}(e,i),o={...n,actions:h(n.actions),guard:n.guard,target:r,source:e,reenter:a,eventType:t,toJSON:()=>({...o,source:`#${e.id}`,target:r?r.map(e=>`#${e.id}`):void 0})};return o}function $(e){let t=E(e.config.target);return t?{target:t.map(t=>"string"==typeof t?ee(e.parent,t):t)}:e.parent.initial}function J(e){return"history"===e.type}function Q(e){let t=X(e);for(let n of t)for(let i of j(n,e))t.add(i);return t}function X(e){let t=new Set;return!function e(n){if(!t.has(n)){if(t.add(n),"compound"===n.type)e(n.initial.target[0]);else if("parallel"===n.type)for(let t of V(n))e(t)}}(e),t}function Z(e,t){if(q(t))return e.machine.getStateNodeById(t);if(!e.states)throw Error(`Unable to retrieve child state '${t}' from '${e.id}'; no child states exist.`);let n=e.states[t];if(!n)throw Error(`Child state '${t}' does not exist on '${e.id}'`);return n}function ee(e,t){if("string"==typeof t&&q(t))try{return e.machine.getStateNodeById(t)}catch{}let n=g(t).slice(),i=e;for(;n.length;){let e=n.shift();if(!e.length)break;i=Z(i,e)}return i}function et(e,t){if("string"==typeof t){let n=e.states[t];if(!n)throw Error(`State '${t}' does not exist on '${e.id}'`);return[e,n]}let n=Object.keys(t),i=n.map(t=>Z(e,t)).filter(Boolean);return[e.machine.root,e].concat(i,n.reduce((n,i)=>{let a=Z(e,i);if(!a)return n;let r=et(a,t[i]);return n.concat(r)},[]))}function en(e,t){let n=e;for(;n.parent&&n.parent!==t;)n=n.parent;return n.parent===t}function ei(e,t,n){let i=new Set;for(let a of e){let e=!1,r=new Set;for(let o of i)if(function(e,t){let n=new Set(e),i=new Set(t);for(let e of n)if(i.has(e))return!0;for(let e of i)if(n.has(e))return!0;return!1}(eo([a],t,n),eo([o],t,n)))if(en(a.source,o.source))r.add(o);else{e=!0;break}if(!e){for(let e of r)i.delete(e);i.add(a)}}return Array.from(i)}function ea(e,t){if(!e.target)return[];let n=new Set;for(let i of e.target)if(J(i))if(t[i.id])for(let e of t[i.id])n.add(e);else for(let e of ea($(i),t))n.add(e);else n.add(i);return[...n]}function er(e,t){let n=ea(e,t);if(!n)return;if(!e.reenter&&n.every(t=>t===e.source||en(t,e.source)))return e.source;let i=function(e){let[t,...n]=e;for(let e of j(t,void 0))if(n.every(t=>en(t,e)))return e}(n.concat(e.source));return i||(e.reenter?void 0:e.source.machine.root)}function eo(e,t,n){let i=new Set;for(let a of e)if(a.target?.length){let e=er(a,n);for(let n of(a.reenter&&a.source===e&&i.add(e),t))en(n,e)&&i.add(n)}return[...i]}function es(e,t,n,i,a,r){if(!e.length)return t;let o=new Set(t._nodes),s=t.historyValue,c=ei(e,o,s),d=t;a||([d,s]=function(e,t,n,i,a,r,o,s){let l,c=e,d=eo(i,a,r);for(let e of(d.sort((e,t)=>t.order-e.order),d))for(let t of function(e){return Object.keys(e.states).map(t=>e.states[t]).filter(e=>"history"===e.type)}(e)){let n;n="deep"===t.history?t=>U(t)&&en(t,e):t=>t.parent===e,l??(l={...r}),l[t.id]=Array.from(a).filter(n)}for(let e of d)c=ed(c,t,n,[...e.exit,...e.invoke.map(e=>G(e.id))],o,void 0),a.delete(e);return[c,l||r]}(d,i,n,c,o,s,r,n.actionExecutor)),d=function(e,t,n,i,a,r,o,s){let c=e,d=new Set,p=new Set;(function(e,t,n,i){for(let a of e){let e=er(a,t);for(let r of a.target||[])!J(r)&&(a.source!==r||a.source!==e||a.reenter)&&(i.add(r),n.add(r)),el(r,t,n,i);for(let r of ea(a,t)){let o=j(r,e);e?.type==="parallel"&&o.push(e),ec(i,t,n,o,!a.source.parent&&a.reenter?void 0:e)}}})(i,o,p,d),s&&p.add(e.machine.root);let u=new Set;for(let e of[...d].sort((e,t)=>e.order-t.order)){a.add(e);let i=[];for(let t of(i.push(...e.entry),e.invoke))i.push(D(t.src,{...t,syncSnapshot:!!t.onSnapshot}));if(p.has(e)){let t=e.initial.actions;i.push(...t)}if(c=ed(c,t,n,i,r,e.invoke.map(e=>e.id)),"final"===e.type){let i=e.parent,o=i?.type==="parallel"?i:i?.parent,s=o||e;for(i?.type==="compound"&&r.push(l(i.id,void 0!==e.output?_(e.output,c.context,t,n.self):void 0));o?.type==="parallel"&&!u.has(o)&&W(a,o);)u.add(o),r.push(l(o.id)),s=o,o=o.parent;if(o)continue;c=eI(c,{status:"done",output:function(e,t,n,i,a){if(void 0===i.output)return;let r=l(a.id,void 0!==a.output&&a.parent?_(a.output,e.context,t,n.self):void 0);return _(i.output,e.context,r,n.self)}(c,t,n,c.machine.root,s)})}}return c}(d=ed(d,i,n,c.flatMap(e=>e.actions),r,void 0),i,n,c,o,r,s,a);let p=[...o];"done"===d.status&&(d=ed(d,i,n,p.sort((e,t)=>t.order-e.order).flatMap(e=>e.exit),r,void 0));try{if(s===t.historyValue&&function(e,t){if(e.length!==t.size)return!1;for(let n of e)if(!t.has(n))return!1;return!0}(t._nodes,o))return d;return eI(d,{_nodes:p,historyValue:s})}catch(e){throw e}}function el(e,t,n,i){var a,r,o,s;if(J(e))if(t[e.id]){let o=t[e.id];for(let e of o)i.add(e),el(e,t,n,i);for(let s of o){a=s,r=e.parent,ec(i,t,n,j(a,r))}}else{let a=$(e);for(let r of a.target)i.add(r),a===e.parent?.initial&&n.add(e.parent),el(r,t,n,i);for(let r of a.target){o=r,s=e.parent,ec(i,t,n,j(o,s))}}else if("compound"===e.type){let[a]=e.initial.target;J(a)||(i.add(a),n.add(a)),el(a,t,n,i),ec(i,t,n,j(a,e))}else if("parallel"===e.type)for(let a of V(e).filter(e=>!J(e)))[...i].some(e=>en(e,a))||(J(a)||(i.add(a),n.add(a)),el(a,t,n,i))}function ec(e,t,n,i,a){for(let r of i)if((!a||en(r,a))&&e.add(r),"parallel"===r.type)for(let i of V(r).filter(e=>!J(e)))[...e].some(e=>en(e,i))||(e.add(i),el(i,t,n,e))}function ed(e,t,n,i,a,r){let o=r?[]:void 0,s=function e(t,n,i,a,r,o){let{machine:s}=t,l=t;for(let t of a){var c;let a="function"==typeof t,d=a?t:(c="string"==typeof t?t:t.type,s.implementations.actions[c]),p={context:l.context,event:n,self:i.self,system:i.system},u=a||"string"==typeof t?void 0:"params"in t?"function"==typeof t.params?t.params({context:l.context,event:n}):t.params:void 0;if(!d||!("resolve"in d)){i.actionExecutor({type:"string"==typeof t?t:"object"==typeof t?t.type:t.name||"(anonymous)",info:p,params:u,exec:d});continue}let[g,m,f]=d.resolve(i,l,p,u,d,r);l=g,"retryResolve"in d&&o?.push([d,m]),"execute"in d&&i.actionExecutor({type:d.type,info:p,params:m,exec:d.execute.bind(null,i,m)}),f&&(l=e(l,n,i,f,r,o))}return l}(e,t,n,i,{internalQueue:a,deferredActorIds:r},o);return o?.forEach(([e,t])=>{e.retryResolve(n,s,t)}),s}function ep(e,t,n){return ed(e,t,n,Object.values(e.children).map(e=>G(e)),[],void 0)}function eu(e,t){return t.machine.getTransitionData(t,e)}let eg=function(e){return function e(t,n){let i=m(t),a=m(n);return"string"==typeof a?"string"==typeof i&&a===i:"string"==typeof i?i in a:Object.keys(i).every(t=>t in a&&e(i[t],a[t]))}(e,this.value)},em=function(e){return this.tags.has(e)},ef=function(e){let t=this.machine.getTransitionData(this,e);return!!t?.length&&t.some(e=>void 0!==e.target||e.actions.length)},eh=function(){let{_nodes:e,tags:t,machine:n,getMeta:i,toJSON:a,can:r,hasTag:o,matches:s,...l}=this;return{...l,tags:Array.from(t)}},e_=function(){return this._nodes.reduce((e,t)=>(void 0!==t.meta&&(e[t.id]=t.meta),e),{})};function ey(e,t){return{status:e.status,output:e.output,error:e.error,machine:t,context:e.context,_nodes:e._nodes,value:K(t.root,e._nodes),tags:new Set(e._nodes.flatMap(e=>e.tags)),children:e.children,historyValue:e.historyValue||{},matches:eg,hasTag:em,can:ef,getMeta:e_,toJSON:eh}}function eI(e,t={}){return ey({...e,...t},e.machine)}function eE(e,t,n,i,{event:a,id:r,delay:o},{internalQueue:s}){let l,c=t.machine.implementations.delays;if("string"==typeof a)throw Error(`Only event objects may be used with raise; use raise({ type: "${a}" }) instead`);let d="function"==typeof a?a(n,i):a;if("string"==typeof o){let e=c&&c[o];l="function"==typeof e?e(n,i):e}else l="function"==typeof o?o(n,i):o;return"number"!=typeof l&&s.push(d),[t,{event:d,id:r,delay:l},void 0]}function eS(e,t){let{event:n,delay:i,id:a}=t;if("number"==typeof i)return void e.defer(()=>{let t=e.self;e.system.scheduler.schedule(t,t,n,i,a)})}function eb(e,t){function n(e,t){}return n.type="xstate.raise",n.event=e,n.id=t?.id,n.delay=t?.delay,n.resolve=eE,n.execute=eS,n}e.exports.S=".",e.exports.N="",e.exports.V="xstate.error",e.exports.X=s,e.exports.W=c,e.exports.q=d,e.exports.v=g,e.exports.m=function(e,t){let n={},i=Object.keys(e);for(let a=0;a<i.length;a++){let r=i[a];n[r]=t(e[r],r,e,a)}return n},e.exports.t=h,e.exports.a=I,e.exports.L=S,e.exports.c=function(e,t){return`${t}.${e}`},e.exports.z=b,e.exports.$=1,e.exports.T=v,e.exports.A=x,e.exports.M=N,e.exports.U=eI,e.exports.P=D,e.exports.R=G,e.exports.w=q,e.exports.e=B,e.exports.i=H,e.exports.l=W,e.exports.h=function(e,t){return e.transitions.get(t)||[...e.transitions.keys()].filter(e=>{if("*"===e)return!0;if(!e.endsWith(".*"))return!1;let n=e.split("."),i=t.split(".");for(let e=0;e<n.length;e++){let t=n[e],a=i[e];if("*"===t)return e===n.length-1;if(t!==a)return!1}return!0}).sort((e,t)=>t.length-e.length).flatMap(t=>e.transitions.get(t))},e.exports.g=function(e){let t=e.config.after;if(!t)return[];let n=t=>{var n;let i=(n=e.id,{type:`xstate.after.${t}.${n}`}),a=i.type;return e.entry.push(eb(i,{id:a,delay:t})),e.exit.push(N(a)),a};return Object.keys(t).flatMap(e=>{let i=t[e],a=Number.isNaN(+e)?e:+e,r=n(a);return h("string"==typeof i?{target:i}:i).map(e=>({...e,event:r,delay:a}))}).map(t=>{let{delay:n}=t;return{...Y(e,t.event,t),delay:n}})},e.exports.O=eb,e.exports.b=Y,e.exports.f=function(e){let t=new Map;if(e.config.on)for(let n of Object.keys(e.config.on)){if(""===n)throw Error('Null events ("") cannot be specified as a transition key. Use `always: { ... }` instead.');let i=e.config.on[n];t.set(n,I(i).map(t=>Y(e,n,t)))}if(e.config.onDone){let n=`xstate.done.state.${e.id}`;t.set(n,I(e.config.onDone).map(t=>Y(e,n,t)))}for(let n of e.invoke){if(n.onDone){let i=`xstate.done.actor.${n.id}`;t.set(i,I(n.onDone).map(t=>Y(e,i,t)))}if(n.onError){let i=`xstate.error.actor.${n.id}`;t.set(i,I(n.onError).map(t=>Y(e,i,t)))}if(n.onSnapshot){let i=`xstate.snapshot.${n.id}`;t.set(i,I(n.onSnapshot).map(t=>Y(e,i,t)))}}for(let n of e.after){let e=t.get(n.eventType);e||(e=[],t.set(n.eventType,e)),e.push(n)}return t},e.exports.d=function(e,t){let n="string"==typeof t?e.states[t]:t?e.states[t.target]:void 0;if(!n&&t)throw Error(`Initial state node "${t}" not found on parent state node #${e.id}`);let i={source:e,actions:t&&"string"!=typeof t?h(t.actions):[],eventType:null,reenter:!1,target:n?[n]:[],toJSON:()=>({...i,source:`#${e.id}`,target:n?[`#${n.id}`]:[]})};return i},e.exports.x=ee,e.exports.u=X,e.exports.j=et,e.exports.o=function e(t,n,i,a){if("string"==typeof n){let e=Z(t,n).next(i,a);return e&&e.length?e:t.next(i,a)}if(1===Object.keys(n).length){let r=Object.keys(n),o=e(Z(t,r[0]),n[r[0]],i,a);return o&&o.length?o:t.next(i,a)}let r=[];for(let o of Object.keys(n)){let s=n[o];if(!s)continue;let l=e(Z(t,o),s,i,a);l&&r.push(...l)}return r.length?r:t.next(i,a)},e.exports.s=es,e.exports.p=ed,e.exports.n=function(e,t,n,i){let a=e,r=[];function l(e,t,i){n.system._sendInspectionEvent({type:"@xstate.microstep",actorRef:n.self,event:t,snapshot:e,_transitions:i}),r.push(e)}if(t.type===s)return l(a=eI(ep(a,t,n),{status:"stopped"}),t,[]),{snapshot:a,microstates:r};let c=t;if(c.type!==o){let t=c,o=t.type.startsWith("xstate.error.actor"),s=eu(t,a);if(o&&!s.length)return l(a=eI(e,{status:"error",error:t.error}),t,[]),{snapshot:a,microstates:r};l(a=es(s,e,n,c,!1,i),t,s)}let d=!0;for(;"active"===a.status;){let e=d?function(e,t){let n=new Set;for(let i of e._nodes.filter(U))e:for(let a of[i].concat(j(i,void 0)))if(a.always){for(let i of a.always)if(void 0===i.guard||B(i.guard,e.context,t,e)){n.add(i);break e}}return ei(Array.from(n),new Set(e._nodes),e.historyValue)}(a,c):[],t=e.length?a:void 0;if(!e.length){if(!i.length)break;e=eu(c=i.shift(),a)}d=(a=es(e,a,n,c,!1,i))!==t,l(a,c,e)}return"active"!==a.status&&ep(a,c,n),{snapshot:a,microstates:r}},e.exports.r=function(e,t){let n=H(et(e,t));return K(e,[...n])},e.exports.k=ey,e.exports.y=function(e,t){let{_nodes:n,tags:i,machine:a,children:r,context:o,can:s,hasTag:l,matches:c,getMeta:d,toJSON:p,...u}=e,g={};for(let e in r){let n=r[e];g[e]={snapshot:n.getPersistedSnapshot(t),src:n.src,systemId:n._systemId,syncSnapshot:n._syncSnapshot}}return{...u,context:function e(t){let n;for(let i in t){let a=t[i];if(a&&"object"==typeof a)if("sessionId"in a&&"send"in a&&"ref"in a)n??(n=Array.isArray(t)?t.slice():{...t}),n[i]={xstate$$type:1,id:a.id};else{let r=e(a);r!==a&&(n??(n=Array.isArray(t)?t.slice():{...t}),n[i]=r)}}return n??t}(o),children:g}}}),a("cPMXw",function(e,t){var n;function a(e,t,n,a,{assignment:r}){if(!t.context)throw Error("Cannot assign to undefined `context`. Ensure that `context` is defined in the machine config.");let o={},s={context:t.context,event:n.event,spawn:function(e,{machine:t,context:n},a,r){let o=(o,s={})=>{let{systemId:l,input:c}=s;if("string"!=typeof o)return(0,i("d0N4G").A)(o,{id:s.id,parent:e.self,syncSnapshot:s.syncSnapshot,input:s.input,src:o,systemId:l});{let d=(0,i("d0N4G").z)(t,o);if(!d)throw Error(`Actor logic '${o}' not implemented in machine '${t.id}'`);let p=(0,i("d0N4G").A)(d,{id:s.id,parent:e.self,syncSnapshot:s.syncSnapshot,input:"function"==typeof c?c({context:n,event:a,self:e.self}):c,src:o,systemId:l});return r[p.id]=p,p}};return(t,n)=>{let a=o(t,n);return r[a.id]=a,e.defer(()=>{a._processingStatus!==i("d0N4G").T.Stopped&&a.start()}),a}}(e,t,n.event,o),self:e.self,system:e.system},l={};if("function"==typeof r)l=r(s,a);else for(let e of Object.keys(r)){let t=r[e];l[e]="function"==typeof t?t(s,a):t}let c=Object.assign({},t.context,l);return[(0,i("d0N4G").U)(t,{context:c,children:Object.keys(o).length?{...t.children,...o}:t.children}),void 0,void 0]}function r(e){function t(e,t){}return t.type="xstate.assign",t.assignment=e,t.resolve=a,t}function o(e,t,n,i,{event:a}){return[t,{event:"function"==typeof a?a(n,i):a},void 0]}function s(e,{event:t}){e.defer(()=>e.emit(t))}let l=((n={}).Parent="#_parent",n.Internal="#_internal",n);function c(e,t,n,i,{to:a,event:r,id:o,delay:s},c){let d,p,u=t.machine.implementations.delays;if("string"==typeof r)throw Error(`Only event objects may be used with sendTo; use sendTo({ type: "${r}" }) instead`);let g="function"==typeof r?r(n,i):r;if("string"==typeof s){let e=u&&u[s];d="function"==typeof e?e(n,i):e}else d="function"==typeof s?s(n,i):s;let m="function"==typeof a?a(n,i):a;if("string"==typeof m){if(!(p=m===l.Parent?e.self._parent:m===l.Internal?e.self:m.startsWith("#_")?t.children[m.slice(2)]:c.deferredActorIds?.includes(m)?m:t.children[m]))throw Error(`Unable to send event to actor '${m}' from machine '${t.machine.id}'.`)}else p=m||e.self;return[t,{to:p,targetId:"string"==typeof m?m:void 0,event:g,id:o,delay:d},void 0]}function d(e,t,n){"string"==typeof n.to&&(n.to=t.children[n.to])}function p(e,t){e.defer(()=>{let{to:n,event:a,delay:r,id:o}=t;if("number"==typeof r)return void e.system.scheduler.schedule(e.self,n,a,r,o);e.system._relay(e.self,n,a.type===i("d0N4G").V?(0,i("d0N4G").W)(e.self.id,a.data):a)})}function u(e,t,n){function i(e,t){}return i.type="xstate.sendTo",i.to=e,i.event=t,i.id=n?.id,i.delay=n?.delay,i.resolve=c,i.retryResolve=d,i.execute=p,i}function g(e,t,n,a,{collect:c}){let d=[],p=function(e){d.push(e)};return p.assign=(...e)=>{d.push(r(...e))},p.cancel=(...e)=>{d.push((0,i("d0N4G").M)(...e))},p.raise=(...e)=>{d.push((0,i("d0N4G").O)(...e))},p.sendTo=(...e)=>{d.push(u(...e))},p.sendParent=(...e)=>{d.push(function(e,t){return u(l.Parent,e,t)}(...e))},p.spawnChild=(...e)=>{d.push((0,i("d0N4G").P)(...e))},p.stopChild=(...e)=>{d.push((0,i("d0N4G").R)(...e))},p.emit=(...e)=>{d.push(function(e){function t(e,t){}return t.type="xstate.emit",t.event=e,t.resolve=o,t.execute=s,t}(...e))},c({context:n.context,event:n.event,enqueue:p,check:e=>(0,i("d0N4G").e)(e,t.context,n.event,t),self:e.self,system:e.system},a),[t,void 0,d]}e.exports.a=r,e.exports.b=function(e){function t(e,t){}return t.type="xstate.enqueueActions",t.collect=e,t.resolve=g,t}}),a("9uNdP",function(e,t){e.exports.ChatAgent={actor_type:"AGENT",available_plugins:{"Content-Read-Plugin":{},"Ethical-Filtering-Plugin":{},"Jira-JQL-Plugin":{},"Jira-NL-JQL-Plugin":{},"Jira-Software-Plugin":{},"Page-Search-Plugin":{},"People-Plugin":{},"Search-QA-Plugin":{}},creator:"mock",creator_cloud_id:null,creator_type:"SYSTEM",description:"Mocking: Get answers, generate new ideas, and accelerate everyday work. Write a prompt to get started.",external_files:null,follow_up_prompt_template:"\nYour task is to generate follow-up questions for the given conversation from the user's perspective.\nThe conversation history is provided in triple backticks.\n\nConversation History:\n```\n{message_history}\n```\n\nWhen you generate follow-up questions, follow these steps closely:\n1. Read the conversation history carefully to understand the user's intent. Keep it open and refer back to it as necessary.\n2. Pretend that you are the user and think about what you would ask next based on the conversation history and the original intent.\n3. Generate 3 follow-up questions from the perspective of the user that meet the following criteria.\n    - Relevant to the conversation.\n    - Unique and different from previously asked questions.\n    - Requests new information.\n    - Insightful and enhances the engagement of the conversation.\n    - Succinct and straight to the point.\n    - Specific and avoids being too general.\n    - Less than 9 words.\n    - When the subject of the question is the user asking questions, use the first-person pronoun \"I\".\n4. Read your follow-up questions again and remove the ones that do not meet ALL of the listed criteria.\n5. If there are no follow-up questions left, return an empty list.\n6. If there are follow-up questions left, paraphrase them to make them more concise.\n7. Return your paraphrased follow-up questions.\n",id:"f3a534d9-1498-e0d4-8b50-e058a8fb8156",is_default:!0,name:"Mock Chat",named_id:"ai_mate_agent",plugin_routing_type:"DEFAULT",system_prompt_template:"\nYou are Rovo Chat, an AI assistant built by Atlassian, you can do everything in the list of functions available. \nTreat the human in a friendly and personalised way, if what they ask is completely nonsensical, ask for clarification.  \n\nFollowing are the details of the human user:\n\nName: {{ user_name }}\n{{ location_info }}\n\nCurrent Time: {{ current_time }}\n\n{{ browsing_context }}\n\nFollow these rules:\n- Respond with names in the following format [name](/people/id) when appropriate.\n- Always use a function to find information, even if you know the answer.\n- Prioritise the Search-QA-Plugin when the function to use is not obvious.\n- Never answer the user directly without results from a function, unless they asked to reformat an existing answer.\n- Do not use your pretrained knowledge to answer.\n- Do not return function details in your answer.\n- If the answer is not available from the current function, always call another function.\n",visibility:"PUBLIC",user_defined_conversation_starters:[],favourite:!1,deactivated:!1},e.exports.CommsCrafterAgent={actor_type:"AGENT",available_plugins:{"Confluence-Suggestion-Plugin":{is_terminal:!0,raise_no_answer_exception:!0},"Page-Search-Plugin":{}},creator:null,creator_cloud_id:null,creator_type:"SYSTEM",description:"Craft and refine all things blogs, external comms, and announcements. Align with your brand's voice.",external_files:null,follow_up_prompt_template:null,id:"3506f1fa-13ab-0c9c-d645-f26c759ef903",is_default:!1,name:"Comms crafter",named_id:"confluence_reviewer_agent",plugin_routing_type:"DEFAULT",system_prompt_template:"You are the Comms crafter, a helpful assistant for reviewing Confluence documents. You are tasked with providing suggestions to improve a Confluence document.\n\nA user may highlight an important part of the document for you to focus on using a document selection.\n\nFollow these rules:\n- Always use a function to provide a suggested replacement for the current document selection when there is a suggested replacement.\n- If the user asks for similar documents, you rely on the document selection.\n- If there is a suggested replacement to a document selection, the final answer should be only a 1 sentence summary of the changes suggested, not the update itself.\n- Do not return function details in your answer.\n- Respond with names in the following format [name](/people/id) if at all possible.\n- Do not use your pretrained knowledge to answer.\n\nFollowing are the details of the users session:\n\nName: {{ user_name }}\nLocation: {{ location_info }}\nCurrent Time: {{ current_time }}\nDocument Selection: {{ additional_context.confluence.selection }}\nDocument: {{ additional_context.confluence.document }}\n",visibility:"PRIVATE",user_defined_conversation_starters:["Can you help me with this blog post I'm working on?","Help me with this announcement I'm drafting."],favourite:!1,deactivated:!1},e.exports.JobWriterAgent={actor_type:"AGENT",available_plugins:{"Confluence-Suggestion-Plugin":{},"Content-Read-Plugin":{},"Page-Search-Plugin":{}},creator:null,creator_cloud_id:null,creator_type:"SYSTEM",description:"Crafts job descriptions that align with corporate guidelines and ensures they promote inclusivity and diversity.",external_files:null,follow_up_prompt_template:null,id:"5692d6dd-3045-499f-b08b-77ed2d253941",is_default:!1,name:"Job writer",named_id:"job_writer_agent",plugin_routing_type:"DEFAULT",system_prompt_template:"You are the Job writer agent, a helpful assistant for hiring managers and recruitment teams to standardize on job descriptions which follow diversity and inclusion guidelines. \nYou are tasked with providing suggestions to improve a Confluence document for job descriptions.\n\nA user may highlight an important part of the document for you to focus on using a document selection.\n\nFollow these rules:\n- You must always provide a suggested replacement for insertion when asked to create, insert or draft job descriptions, summaries or any unique content.\n- You must always use a function to provide a suggested replacement for the current document selection when there is a suggested replacement.\n- If the user asks for similar documents, you rely on the document selection.\n- If there is a suggested replacement to a document selection, the final answer should be only a 1 sentence summary of the changes suggested, not the update itself.\n- Do not return function details in your answer.\n- Respond with names in the following format [name](/people/id) if at all possible.\n- Do not use your pretrained knowledge to answer.\n\nFollowing are the details of the users session:\n\nName: {{ user_name }}\nLocation: {{ location_info }}\nCurrent Time: {{ current_time }}\nDocument Selection: {{ additional_context.confluence.selection }}\nDocument: {{ additional_context.confluence.document }}\nBrowsing Context: {{ browsing_context }}",visibility:"PRIVATE",user_defined_conversation_starters:[],favourite:!1,deactivated:!1},e.exports.A11yMateAgent={actor_type:"AGENT",available_plugins:{"Search-QA-Plugin":{space_filter:["A11YKB"]}},creator:"ari:cloud:identity::user/557057:db25fe7e-23f8-4e0f-aa1d-74a8c29bbc10",creator_cloud_id:"a436116f-02ce-4520-8fbb-7301462a1674",creator_type:"CUSTOMER",description:"Accessibility help by Central Accessibility Team",external_files:[],follow_up_prompt_template:null,id:"a7f547de-aa39-4d25-9234-65ac13c19acd",is_default:!1,name:"A11Y Mate Long Name for Selection Toolbar",named_id:"A11Y Mate",plugin_routing_type:null,system_prompt_template:"",visibility:"PUBLIC",user_defined_conversation_starters:["What can you help me with?","What can you help me with?","What can you help me with?"],favourite:!1,deactivated:!1}}),a("AMCQl",function(e,t){let n=(0,i("cgtv4").defineMessages)({agentConfigTitle:{id:"fabric.editor.ai.config.item.agent.title",defaultMessage:"Atlassian Intelligence Rovo Agent"},agentConfigDescription:{id:"fabric.editor.ai.config.item.range.agent.description",defaultMessage:"No description"},agentConfigPromptHint:{id:"fabric.editor.ai.config.item.range.agent.prompt.hint",defaultMessage:"Tell the Agent to write anything or choose from below"},configActionInsert:{id:"fabric.editor.ai.config.item.action.insert",defaultMessage:"Insert"},configActionInsertAtTop:{id:"fabric.editor.ai.config.item.action.insertAtTop",defaultMessage:"Insert at top"},configActionInsertBelow:{id:"fabric.editor.ai.config.item.action.insertBelow",defaultMessage:"Insert below"},configActionInsertBelowOriginal:{id:"fabric.editor.ai.config.item.action.insertBelowOriginal",defaultMessage:"Insert below original"},configActionReplace:{id:"fabric.editor.ai.config.item.action.replace",defaultMessage:"Replace"},configActionReplaceTitle:{id:"fabric.editor.ai.config.item.action.replaceTitle",defaultMessage:"Replace title"},configActionReplaceTitleTooLongDisabledTooltip:{id:"fabric.editor.ai.config.item.action.replaceTitleTooLongDisabledTooltip",defaultMessage:"Title cannot exceed {maxLength} characters"},configActionContinueInChatLabel:{id:"fabric.editor.ai.config.item.action.rovoAgents.continueInChatLabel",defaultMessage:"Open in Chat"},configActionContinueChatLabel:{id:"fabric.editor.ai.config.item.action.rovoAgents.contineChatLabel",defaultMessage:"Continue in chat"},configActionEdit:{id:"fabric.editor.ai.config.item.action.edit",defaultMessage:"Edit"},atlasShortenUpdatetitle:{id:"fabric.editor.ai.config.item.atlas-shorten-update.title",defaultMessage:"Shorten update"},atlasShortenUpdateDescription:{id:"fabric.editor.ai.config.item.atlas-shorten-update.description",defaultMessage:"Shortens the content to make it more concise"},brainstormTitle:{id:"fabric.editor.ai.config.item.brainstorm.title",defaultMessage:"Brainstorm"},brainstormDescription:{id:"fabric.editor.ai.config.item.brainstorm.description",defaultMessage:"Generates a list of ideas for a topic you provide"},brainstormPromptLabel:{id:"fabric.editor.ai.config.item.brainstorm.promptLabel",defaultMessage:"Brainstorm"},brainstormPromptHint:{id:"fabric.editor.ai.config.item.brainstorm.promptHint",defaultMessage:"Tell me the topic..."},adjustLengthNestingParentTitle:{id:"fabric.editor.ai.config.item.changeTone.adjustLengthNestingParentTitle",defaultMessage:"Adjust length"},adjustLengthNestingParentShortTitle:{id:"fabric.editor.ai.config.item.changeTone.adjustLengthNestingParentShortTitle",defaultMessage:"Length"},changeToneNestingParentTitlePostGA:{id:"fabric.editor.ai.config.item.changeTone.nestingParentTitlePostGA",defaultMessage:"Change tone to ..."},changeToneNeutralToneTitle:{id:"fabric.editor.ai.config.item.changeTone.neutralTone.title",defaultMessage:"Change tone to neutral"},changeToneNeutralToneShortTitle:{id:"fabric.editor.ai.config.item.changeTone.neutralTone.shortTitle",defaultMessage:"Neutral"},changeToneNeutralToneDescription:{id:"fabric.editor.ai.config.item.changeTone.neutralTone.description",defaultMessage:"Changes the tone of the content to neutral"},changeToneNeutralToneSelectionToolbarDropdownItemTitle:{id:"fabric.editor.ai.config.item.changeTone.neutralTone.selectionToolbar.dropdownItem.title",defaultMessage:"Neutral"},changeToneProfessionalToneTitle:{id:"fabric.editor.ai.config.item.changeTone.professionalTone.title",defaultMessage:"Change tone to professional"},changeToneProfessionalToneShortTitle:{id:"fabric.editor.ai.config.item.changeTone.professionalTone.shortTitle",defaultMessage:"Professional"},changeToneProfessionalToneDescription:{id:"fabric.editor.ai.config.item.changeTone.professionalTone.description",defaultMessage:"Changes the tone of the content to professional"},changeToneProfessionalToneSelectionToolbarDropdownItemTitle:{id:"fabric.editor.ai.config.item.changeTone.professionalTone.selectionToolbar.dropdownItem.title",defaultMessage:"Professional"},changeToneCasualToneTitle:{id:"fabric.editor.ai.config.item.changeTone.casualTone.title",defaultMessage:"Change tone to casual"},changeToneCasualToneShortTitle:{id:"fabric.editor.ai.config.item.changeTone.casualTone.shortTitle",defaultMessage:"Casual"},changeToneCasualToneDescription:{id:"fabric.editor.ai.config.item.changeTone.casualTone.description",defaultMessage:"Changes the tone of the content to casual"},changeToneCasualToneSelectionToolbarDropdownItemTitle:{id:"fabric.editor.ai.config.item.changeTone.casualTone.selectionToolbar.dropdownItem.title",defaultMessage:"Casual"},changeToneEducationalToneTitle:{id:"fabric.editor.ai.config.item.changeTone.educationalTone.title",defaultMessage:"Change tone to educational"},changeToneEducationalToneShortTitle:{id:"fabric.editor.ai.config.item.changeTone.educationalTone.shortTitle",defaultMessage:"Educational"},changeToneEducationalToneDescription:{id:"fabric.editor.ai.config.item.changeTone.educationalTone.description",defaultMessage:"Changes the tone of the content to educational"},changeToneEducationalToneSelectionToolbarDropdownItemTitle:{id:"fabric.editor.ai.config.item.changeTone.educationalTone.selectionToolbar.dropdownItem.title",defaultMessage:"Educational"},changeToneEmpatheticToneTitle:{id:"fabric.editor.ai.config.item.changeTone.empatheticTone.title",defaultMessage:"Change tone to empathetic"},changeToneEmpatheticToneShortTitle:{id:"fabric.editor.ai.config.item.changeTone.empatheticTone.shortTitle",defaultMessage:"Empathetic"},changeToneEmpatheticToneDescription:{id:"fabric.editor.ai.config.item.changeTone.empatheticTone.description",defaultMessage:"Changes the tone of the content to empathetic"},changeToneEmpatheticToneSelectionToolbarDropdownItemTitle:{id:"fabric.editor.ai.config.item.changeTone.empatheticTone.selectionToolbar.dropdownItem.title",defaultMessage:"Empathetic"},convertToBulletListTitle:{id:"fabric.editor.ai.config.item.convertToBulletList.title",defaultMessage:"Convert to bulleted list"},convertToBulletListDescription:{id:"fabric.editor.ai.config.item.convertToBulletList.description",defaultMessage:"Reformats content to a bulleted list"},convertToTableTitle:{id:"fabric.editor.ai.config.item.convertToTable.title",defaultMessage:"Convert to table"},convertToTableDescription:{id:"fabric.editor.ai.config.item.convertToTable.description",defaultMessage:"Reformats content to a table with headings"},draftReplyTitle:{id:"fabric.editor.ai.config.item.draftReply.title",defaultMessage:"Draft reply"},draftReplyDescription:{id:"fabric.editor.ai.config.item.draftReply.description",defaultMessage:"Drafts a reply based on issues similar to the one you’re working on"},draftReplyHeroPromptTitle:{id:"fabric.editor.ai.config.item.draftReply.heroPromptTitle",defaultMessage:"Suggest reply"},draftReplyHeroPromptDescription:{id:"fabric.editor.ai.config.item.draftReply.heroPromptDescription",defaultMessage:"Enhances the reply based on issues similar to the one you’re working on"},generateEscalationNotesTitle:{id:"fabric.editor.ai.config.item.generateEscalationNotes.title",defaultMessage:"Generate escalation notes"},generateEscalationNotesDescription:{id:"fabric.editor.ai.config.item.generateEscalationNotes.description",defaultMessage:"Generates escalation notes based on the issue context"},improveWritingTitle:{id:"fabric.editor.ai.config.item.enhance.improveWriting.title",defaultMessage:"Improve writing"},improveWritingSelectionToolbarDropdownItemTitle:{id:"fabric.editor.ai.config.item.enhance.improveWriting.selectionToolbar.dropdownItem.title",defaultMessage:"Improve writing"},fixSpellingGrammarTitle:{id:"fabric.editor.ai.config.item.enhance.fixSpellingGrammar.title",defaultMessage:"Fix spelling & grammar"},improveWritingDescription:{id:"fabric.editor.ai.config.item.enhance.improveWriting.description",defaultMessage:"Enhances clarity, structure, and tone for better engagement and comprehension"},fixSpellingGrammarDescription:{id:"fabric.editor.ai.config.item.enhance.fixSpellingGrammar.description",defaultMessage:"Fixes spelling and grammar mistakes"},fixSpellingGrammarSelectionToolbarDropdownItemTitle:{id:"fabric.editor.ai.config.item.enhance.fixSpellingGrammar.selectionToolbar.dropdownItem.title",defaultMessage:"Spelling & grammar"},findActionItemsTitle:{id:"fabric.editor.ai.config.item.findActionItems.title",defaultMessage:"Find action items"},findActionItemsDescription:{id:"fabric.editor.ai.config.item.findActionItems.description",defaultMessage:"Finds action items in the content you provide"},freeGeneratePromptHint:{id:"fabric.editor.ai.config.item.generateContent.promptHint",defaultMessage:"Write with AI or select from below"},freeGenerateRovoPromptHint:{id:"fabric.editor.ai.config.item.generateContent.rovoPromptHint",defaultMessage:"Write with Rovo or select from below"},freeGenerateDisabledPromptHint:{id:"fabric.editor.ai.config.item.freeGenerate.disabled.promptHint",defaultMessage:"Select from below (free generate is disabled in Elevate at this time)"},reformatWithTemplateDescription:{id:"fabric.editor.ai.config.item.improveDescription.default.description",defaultMessage:"Restructure the issue description based on the issue type"},improveDescription:{id:"fabric.editor.ai.config.item.improveDescription.default.title.experiment.one",defaultMessage:"Improve description"},makeLongerTitle:{id:"fabric.editor.ai.config.item.makeLonger.title",defaultMessage:"Make longer"},makeLongerDescription:{id:"fabric.editor.ai.config.item.makeLonger.description",defaultMessage:"Expands the content based on the context you provide"},makeShorterTitle:{id:"fabric.editor.ai.config.item.shorten.title",defaultMessage:"Make shorter"},makeShorterDescription:{id:"fabric.editor.ai.config.item.shorten.description",defaultMessage:"Shortens the content to make it more concise"},makeShorterSelectionToolbarDropdownItemTitle:{id:"fabric.editor.ai.config.item.shorten.selectionToolbar.dropdownItem.title",defaultMessage:"Make shorter"},prDescriptionTitle:{id:"fabric.editor.ai.config.item.bb.pr.description.title",defaultMessage:"Create pull request description"},prDescriptionDescription:{id:"fabric.editor.ai.config.item.bb.pr.description.description",defaultMessage:"Creates a pull request description with a summary of changes"},rephraseTitle:{id:"fabric.editor.ai.config.item.rephrase.title",defaultMessage:"Rephrase"},rephraseDescription:{id:"fabric.editor.ai.config.item.rephrase.description",defaultMessage:"Creates a suggestion for rewriting your sentences"},suggestTitleTitle:{id:"fabric.editor.ai.config.item.suggest.title",defaultMessage:"Suggest a title"},suggestTitleDescription:{id:"fabric.editor.ai.config.item.suggest.description",defaultMessage:"Suggests a title for content you provide"},summarizeWritingtitle:{id:"fabric.editor.ai.config.item.summarize.title",defaultMessage:"Summarize writing"},summarizeWritingDescription:{id:"fabric.editor.ai.config.item.summarize.description",defaultMessage:"Creates a summary of the text you're working on, highlighting key points"},summarizeWritingSelectionToolbarDropdownItemTitle:{id:"fabric.editor.ai.config.item.summarize.dropdownItem.title",defaultMessage:"Summarize writing"},addPolishTitle:{id:"fabric.editor.ai.config.item.addPolish.title",defaultMessage:"Add polish"},addPolishDescription:{id:"fabric.editor.ai.config.item.addPolish.description",defaultMessage:"Polishes the content to make it more polished"}});e.exports.aiConfigItemMessages=n}),a("jc4DP",function(e,t){var n=i("8m4tT");e.exports.createInsertAtTop=({appearance:e})=>({type:"markdown",title:i("AMCQl").aiConfigItemMessages.configActionInsertAtTop,appearance:e,run({editorView:e,pmFragment:t}){let{state:n}=e,a=n.tr,r=new(0,i("5SAOw").Slice)(t,0,0);a.replace(0,0,r),(0,i("ieno2").beforeDispatchAITransaction)(a,n),e.dispatch(a)},icon:i("amGbB").InsertAtTopIcon}),e.exports.createInsertBelow=({appearance:e,factoryOptions:t})=>({type:"markdown",title:t?.isInDocumentStreamingEnabled?i("AMCQl").aiConfigItemMessages.configActionInsertBelowOriginal:i("AMCQl").aiConfigItemMessages.configActionInsertBelow,appearance:e,run({editorView:e,positions:t,pmFragment:a,triggeredFor:r}){let{state:o}=e,s=o.tr;if((0,i("zT4ZO").fragmentContainsNodeType)(a,o.schema.nodes.table)&&(0,i("ieno2").shouldInsertAfterTable)({selection:o.selection,tableSchema:o.schema.nodes.table})&&(0,i("sxTNo").isNestedTablesSupported)(o.schema)&&(0,i("dh538").fg)("platform_editor_use_nested_table_pm_nodes"))(0,i("ieno2").insertContentAfterTable)({pmFragment:a,transaction:s});else if(r?.isBlock){let r=t[1];(0,n.safeInsert)(a,r)(s),(0,i("ieno2").beforeDispatchingTransactionForBlocks)(a,s,e.state)}else{let e;try{e=o.doc.resolve(t[1]).after()}catch(n){e=t[1]}(0,n.safeInsert)(a,e)(s)}(0,i("ieno2").beforeDispatchAITransaction)(s,o),e.dispatch(s)},icon:i("jX1nN").InsertAtOrBelowIcon}),e.exports.createInsertAtCurrentPosition=({appearance:e,isRovoAgentAction:t,title:n=i("AMCQl").aiConfigItemMessages.configActionInsert})=>({type:"markdown",title:n,appearance:e,isRovoAgentAction:t,run({editorView:e,positions:n,pmFragment:a}){let r=(0,i("ieno2").insertAIContentAtCurrentPosition)({editorView:e,positions:n,pmFragment:a});t&&(0,i("ieno2").beforeDispatchAIRovoAgentTransaction)(r),e.dispatch(r)},icon:i("jX1nN").InsertAtOrBelowIcon}),e.exports.createReplace=({appearance:e,isRovoAgentAction:t})=>({type:"markdown",title:i("AMCQl").aiConfigItemMessages.configActionReplace,appearance:e,isRovoAgentAction:t,run({editorView:e,positions:n,pmFragment:a,selectionMetaData:r,triggeredFor:o}){let s=o?.isBlock?(0,i("ieno2").replaceWithAIContentForBlock)({editorView:e,positions:n,pmFragment:a,triggeredFor:o}):(0,i("ieno2").replaceWithAIContent)({editorView:e,positions:n,pmFragment:a,selectionMetaData:r});t&&(0,i("ieno2").beforeDispatchAIRovoAgentTransaction)(s),e.dispatch(s)}}),e.exports.createReplaceExistingConfluenceTitle=({appearance:e})=>({type:"markdown",title:i("AMCQl").aiConfigItemMessages.configActionReplaceTitle,appearance:e,getDisabledState:({markdown:e,formatMessage:t})=>(e?.length??0)>=255?{isDisabled:!0,tooltip:t(i("AMCQl").aiConfigItemMessages.configActionReplaceTitleTooLongDisabledTooltip,{maxLength:255})}:{isDisabled:!1},run({editorView:e,pmFragment:t}){let n="";t.forEach(e=>{n+=e.textContent});let a=document.querySelector('textarea[data-ai-suggest-title-target="true"]');if(a){let t=(0,i("2e7rb").findEditorIdFromView)(e);t&&i("jOIil").eventHub.publishFromEditor({event:"replace title in confluence",data:{analyticSourceId:"confluenceTitleToolbar",sourceEditorId:t,title:n}}),a.scrollIntoView()}}})}),a("ieno2",function(e,t){var n=i("8m4tT"),a=i("iu6m9");function r(e,t){e.setMeta("isAiContentTransformation",!0);let n=(0,i("j51b9").findFirstReplaceStep)(e.steps);if(!n)return(0,i("4SGh1").addAnalytics)({editorState:t,tr:e,payload:{action:"failed",actionSubject:"editorPluginAI",actionSubjectId:"experienceApplication",attributes:{errorType:"replaceStepNotFound"},eventType:i("d925B").EVENT_TYPE.OPERATIONAL}}),e;let a=(0,i("j51b9").getValidEndTextPosition)({step:n,doc:e.doc});return 0!==a&&e.setSelection(i("ks2lK").TextSelection.create(e.doc,a)),e}function o(e,t,n){let a=(0,i("jdR93").getSupportedNodesForAIModal)(n),r=!0;return(e.forEach(e=>{r=r&&a.has(e.type)}),r)?t.setMeta("isAiContentTransformationForBlocks",!0):t}function s({selection:e,tableSchema:t}){let r=(0,a.editorExperiment)("nested-tables-in-tables",!1,{exposure:!0}),o=(0,i("sxTNo").getParentOfTypeCount)(t)(e.$from);return(0,n.hasParentNodeOfType)(t)(e)&&(r||o>1)}let l=({pmFragment:e,transaction:t})=>{let a=t.doc.type.schema.nodes.table,r=t.selection.$from,o=(0,i("sxTNo").getPositionAfterTopParentNodeOfType)(a)(r);return(0,n.safeInsert)(e,o)(t)};e.exports.beforeDispatchAITransaction=r,e.exports.beforeDispatchingTransactionForBlocks=o,e.exports.beforeDispatchAIRovoAgentTransaction=function(e){return e.setMeta("isAiRovoAgentContentTransformation",!0),e},e.exports.shouldInsertAfterTable=s,e.exports.insertContentAfterTable=l,e.exports.replaceWithAIContentForBlock=({editorView:e,positions:t,pmFragment:a,triggeredFor:s})=>{let{state:l}=e,c=l.tr,d=0===a.size&&(0,i("dh538").fg)("platform_editor_ai_replace_content_empty_slice")?i("5SAOw").Slice.empty:new(0,i("5SAOw").Slice)(a,0,0);0===a.size&&(0,i("dh538").fg)("platform_editor_ai_replace_content_empty_slice")&&(c=(0,i("4SGh1").addAnalytics)({editorState:l,tr:c,payload:{action:"fallback",actionSubject:"editorPluginAI",actionSubjectId:"replaceWithEmptyAIContent",eventType:i("d925B").EVENT_TYPE.OPERATIONAL,attributes:{isBlock:!0,isSelectionEmpty:t[0]===t[1]}}}));try{c=c.replaceRange(t[0],t[1],d)}catch(e){c=(0,n.safeInsert)(a,void 0,!0)((0,i("4SGh1").addAnalytics)({editorState:l,tr:c,payload:{action:"fallback",actionSubject:"editorPluginAI",actionSubjectId:"proseMirrorReplace",eventType:i("d925B").EVENT_TYPE.OPERATIONAL,attributes:{target:"replaceWithAIContentForBlock",isSelectionEmpty:t[0]===t[1],errorMessage:i("2QlXt").ErrorUtils.extractErrorMessage(e),isReplacementEmpty:0===a.size}}}))}return r(o(a,c,l),l)},e.exports.replaceWithAIContent=({editorView:e,positions:t,pmFragment:a,selectionMetaData:o,options:c={replaceDocOnEmptySelection:!0}})=>{let{state:d}=e,p=d.tr,u=d.doc.resolve(t[1]).depth,g=function({pmFragment:e}){let t=0,n=e;for(;n.firstChild;)t++,n=n.firstChild;return t}({pmFragment:a}),m=o?.sliceOpenStart||1,f=o?.sliceOpenEnd||Math.min(u,g),h=0===a.size&&(0,i("dh538").fg)("platform_editor_ai_replace_content_empty_slice")?i("5SAOw").Slice.empty:new(0,i("5SAOw").Slice)(a,m,f);if(0===a.size&&(0,i("dh538").fg)("platform_editor_ai_replace_content_empty_slice")&&(p=(0,i("4SGh1").addAnalytics)({editorState:d,tr:p,payload:{action:"fallback",actionSubject:"editorPluginAI",actionSubjectId:"replaceWithEmptyAIContent",eventType:i("d925B").EVENT_TYPE.OPERATIONAL,attributes:{isBlock:!1,isSelectionEmpty:t[0]===t[1]}}})),(0,i("zT4ZO").fragmentContainsNodeType)(a,p.doc.type.schema.nodes.table)&&s({selection:p.selection,tableSchema:p.doc.type.schema.nodes.table})&&(0,i("sxTNo").isNestedTablesSupported)(d.schema)&&(0,i("dh538").fg)("platform_editor_use_nested_table_pm_nodes"))return l({pmFragment:a,transaction:p});if(c.replaceDocOnEmptySelection&&t[0]===t[1])p=p.replaceRange(0,d.doc.content.size,h);else try{p=p.replaceRange(t[0],t[1],h)}catch(e){p=(0,n.safeInsert)(a,void 0,!0)((0,i("4SGh1").addAnalytics)({editorState:d,tr:p,payload:{action:"fallback",actionSubject:"editorPluginAI",actionSubjectId:"proseMirrorReplace",eventType:i("d925B").EVENT_TYPE.OPERATIONAL,attributes:{target:"replaceWithAIContent",isSelectionEmpty:t[0]===t[1],errorMessage:i("2QlXt").ErrorUtils.extractErrorMessage(e),isReplacementEmpty:0===a.size}}}))}return r(p,d)},e.exports.insertAIContentAtCurrentPosition=({editorView:e,positions:t,pmFragment:n})=>{var a;let{state:o}=e,c=o.tr,d=t[0],p=o.doc.resolve(d),u=!function(e){let t=e.parent;return!!t&&("paragraph"===t.type.name||"heading"===t.type.name)&&!e.parentOffset}(p)?d:d-1,g=n;return(function(e){let t=e.parent;return!!t&&("decisionList"===t.type.name||"decisionItem"===t.type.name||"taskList"===t.type.name||"taskItem"===t.type.name)}(p)&&1===(a=n).childCount&&"paragraph"===a.firstChild.type.name&&(g=n.firstChild.content),(0,i("zT4ZO").fragmentContainsNodeType)(n,c.doc.type.schema.nodes.table)&&s({selection:c.selection,tableSchema:c.doc.type.schema.nodes.table})&&(0,i("sxTNo").isNestedTablesSupported)(o.schema)&&(0,i("dh538").fg)("platform_editor_use_nested_table_pm_nodes"))?l({pmFragment:n,transaction:c}):r(c.insert(u,g),o)}}),a("iBSwI",function(t,n){var a=i("42omo"),r=i("dZ8uq");let o=t=>{let n=t?.product!=="CONFLUENCE"&&(0,i("dh538").fg)("platform_editor_ai_adf_prompts_in_all_products")?"improve_writing_adf_gpt41mini":"improve_writing",o=t?.product!=="CONFLUENCE"&&(0,i("dh538").fg)("platform_editor_ai_adf_prompts_in_all_products");return(0,r.expValEqualsNoExposure)("platform_editor_ai_iw_adf_streaming","cohort","adf_gemini25flash")?(n="improve_writing_adf_gemini25flash",o=!0):(0,r.expValEqualsNoExposure)("platform_editor_ai_iw_adf_streaming","cohort","adf_gpt41mini")&&(n="improve_writing_adf_gpt41mini",o=!0),{key:i("bwpRs").CONFIG_ITEM_KEYS.IMPROVE_WRITING,title:i("AMCQl").aiConfigItemMessages.improveWritingTitle,description:i("AMCQl").aiConfigItemMessages.improveWritingDescription,icon:({formatMessage:n})=>t?.isInDocumentStreamingEnabled?e(a).createElement(e(i("lW0cT")),{label:n(i("AMCQl").aiConfigItemMessages.improveWritingTitle),size:"small"}):e(a).createElement(i("h5jTI").ImproveWritingIcon,null),intentSchemaId:"improve_quality_intent_schema.json",featureId:n,adfPrompt:o,requiresTextualContent:o,actions:{empty:[(0,i("jc4DP").createInsertBelow)({appearance:"secondary",factoryOptions:t}),(0,i("jc4DP").createReplace)({appearance:"primary"})],selection:[(0,i("jc4DP").createInsertBelow)({appearance:"secondary",factoryOptions:t}),(0,i("jc4DP").createReplace)({appearance:"primary"})]},getBackendModel:()=>"assistance-service",canToggleDiffPreview:!0}},s=t=>{let n=t?.product!=="CONFLUENCE"&&(0,i("dh538").fg)("platform_editor_ai_adf_prompts_in_all_products")?"fix_spelling_grammar_adf_gpt41mini":"fix_spelling_grammar",o=t?.product!=="CONFLUENCE"&&(0,i("dh538").fg)("platform_editor_ai_adf_prompts_in_all_products");return(0,r.expValEqualsNoExposure)("platform_editor_ai_non_iw_adf_streaming","cohort","adf_gpt41mini")?(n="fix_spelling_grammar_adf_gpt41mini",o=!0):(0,r.expValEqualsNoExposure)("platform_editor_ai_non_iw_adf_streaming","cohort","adf_gemini25flash")&&(n="fix_spelling_grammar_adf",o=!0),{key:i("bwpRs").CONFIG_ITEM_KEYS.FIX_SPELLING_AND_GRAMMAR,title:i("AMCQl").aiConfigItemMessages.fixSpellingGrammarTitle,description:i("AMCQl").aiConfigItemMessages.fixSpellingGrammarDescription,icon:()=>e(a).createElement(i("5BsiJ").FixSpellingIcon,null),intentSchemaId:"grammar_spelling_intent_schema.json",featureId:n,adfPrompt:o,requiresTextualContent:o,actions:{empty:[(0,i("jc4DP").createReplace)({appearance:"primary"})],selection:[(0,i("jc4DP").createReplace)({appearance:"primary"})]},getBackendModel:()=>"assistance-service"}};t.exports.improveWriting=o,t.exports.improveWritingWithOptions=e=>({config:o(e),triggers:{empty:{enabled:!0,docMinSize:1},selection:{enabled:!0}}}),t.exports.fixSpellingAndGrammar=s,t.exports.fixSpellingAndGrammarWithOptions=e=>({config:s(e),triggers:{empty:{enabled:!0,docMinSize:1},selection:{enabled:!0}}})}),a("bpQiY",function(e,t){let n=(0,i("cgtv4").defineMessages)({nestingParentTitle:{id:"fabric.editor.ai.config.item.translate.nestingParentTitle.ga",defaultMessage:"Translate"},nestingParentTitlePostGA:{id:"fabric.editor.ai.config.item.translate.nestingParentTitlePostGA",defaultMessage:"Translate to ..."},chineseSimplified:{id:"fabric.editor.ai.config.item.translate.chineseSimplified",defaultMessage:"Chinese (Simplified)"},chineseTraditional:{id:"fabric.editor.ai.config.item.translate.chineseTraditional",defaultMessage:"Chinese (Traditional)"},czech:{id:"fabric.editor.ai.config.item.translate.czech",defaultMessage:"Czech"},danish:{id:"fabric.editor.ai.config.item.translate.danish",defaultMessage:"Danish"},dutch:{id:"fabric.editor.ai.config.item.translate.dutch",defaultMessage:"Dutch"},english:{id:"fabric.editor.ai.config.item.translate.english",defaultMessage:"English"},finnish:{id:"fabric.editor.ai.config.item.translate.finnish",defaultMessage:"Finnish"},french:{id:"fabric.editor.ai.config.item.translate.french",defaultMessage:"French"},german:{id:"fabric.editor.ai.config.item.translate.german",defaultMessage:"German"},hungarian:{id:"fabric.editor.ai.config.item.translate.hungarian",defaultMessage:"Hungarian"},italian:{id:"fabric.editor.ai.config.item.translate.italian",defaultMessage:"Italian"},japanese:{id:"fabric.editor.ai.config.item.translate.japanese",defaultMessage:"Japanese"},korean:{id:"fabric.editor.ai.config.item.translate.korean",defaultMessage:"Korean"},norwegian:{id:"fabric.editor.ai.config.item.translate.norwegian",defaultMessage:"Norwegian"},polish:{id:"fabric.editor.ai.config.item.translate.polish",defaultMessage:"Polish"},portugueseBrazilian:{id:"fabric.editor.ai.config.item.translate.portugueseBrazilian",defaultMessage:"Portuguese (Brazilian)"},russian:{id:"fabric.editor.ai.config.item.translate.russian",defaultMessage:"Russian"},spanish:{id:"fabric.editor.ai.config.item.translate.spanish",defaultMessage:"Spanish"},swedish:{id:"fabric.editor.ai.config.item.translate.swedish",defaultMessage:"Swedish"},turkish:{id:"fabric.editor.ai.config.item.translate.turkish",defaultMessage:"Turkish"},thai:{id:"fabric.editor.ai.config.item.translate.thai",defaultMessage:"Thai"},ukrainian:{id:"fabric.editor.ai.config.item.translate.ukrainian",defaultMessage:"Ukrainian"},vietnamese:{id:"fabric.editor.ai.config.item.translate.vietnamese",defaultMessage:"Vietnamese"},chineseSimplifiedTitle:{id:"fabric.editor.ai.config.item.translateTo.chineseSimplified.title",defaultMessage:"Translate to Chinese (Simplified)"},chineseSimplifiedDescription:{id:"fabric.editor.ai.config.item.translateTo.chineseSimplified.description",defaultMessage:"Translates the text you're working on to Chinese (Simplified)"},chineseTraditionalTitle:{id:"fabric.editor.ai.config.item.translateTo.chineseTraditional.title",defaultMessage:"Translate to Chinese (Traditional)"},chineseTraditionalDescription:{id:"fabric.editor.ai.config.item.translateTo.chineseTraditional.description",defaultMessage:"Translates the text you're working on to Chinese (Traditional)"},czechTitle:{id:"fabric.editor.ai.config.item.translateTo.czech.title",defaultMessage:"Translate to Czech"},czechDescription:{id:"fabric.editor.ai.config.item.translateTo.czech.description",defaultMessage:"Translates the text you're working on to Czech"},danishTitle:{id:"fabric.editor.ai.config.item.translateTo.danish.title",defaultMessage:"Translate to Danish"},danishDescription:{id:"fabric.editor.ai.config.item.translateTo.danish.description",defaultMessage:"Translates the text you're working on to Danish"},dutchTitle:{id:"fabric.editor.ai.config.item.translateTo.dutch.title",defaultMessage:"Translate to Dutch"},dutchDescription:{id:"fabric.editor.ai.config.item.translateTo.dutch.description",defaultMessage:"Translates the text you're working on to Dutch"},englishTitle:{id:"fabric.editor.ai.config.item.translateTo.english.title",defaultMessage:"Translate to English"},englishDescription:{id:"fabric.editor.ai.config.item.translateTo.english.description",defaultMessage:"Translates the text you're working on to English"},finnishTitle:{id:"fabric.editor.ai.config.item.translateTo.finnish.title",defaultMessage:"Translate to Finnish"},finnishDescription:{id:"fabric.editor.ai.config.item.translateTo.finnish.description",defaultMessage:"Translates the text you're working on to Finnish"},frenchTitle:{id:"fabric.editor.ai.config.item.translateTo.french.title",defaultMessage:"Translate to French"},frenchDescription:{id:"fabric.editor.ai.config.item.translateTo.french.description",defaultMessage:"Translates the text you're working on to French"},germanTitle:{id:"fabric.editor.ai.config.item.translateTo.german.title",defaultMessage:"Translate to German"},germanDescription:{id:"fabric.editor.ai.config.item.translateTo.german.description",defaultMessage:"Translates the text you're working on to German"},hungarianTitle:{id:"fabric.editor.ai.config.item.translateTo.hungarian.title",defaultMessage:"Translate to Hungarian"},hungarianDescription:{id:"fabric.editor.ai.config.item.translateTo.hungarian.description",defaultMessage:"Translates the text you're working on to Hungarian"},italianTitle:{id:"fabric.editor.ai.config.item.translateTo.italian.title",defaultMessage:"Translate to Italian"},italianDescription:{id:"fabric.editor.ai.config.item.translateTo.italian.description",defaultMessage:"Translates the text you're working on to Italian"},japaneseTitle:{id:"fabric.editor.ai.config.item.translateTo.japanese.title",defaultMessage:"Translate to Japanese"},japaneseDescription:{id:"fabric.editor.ai.config.item.translateTo.japanese.description",defaultMessage:"Translates the text you're working on to Japanese"},koreanTitle:{id:"fabric.editor.ai.config.item.translateTo.korean.title",defaultMessage:"Translate to Korean"},koreanDescription:{id:"fabric.editor.ai.config.item.translateTo.korean.description",defaultMessage:"Translates the text you're working on to Korean"},norwegianTitle:{id:"fabric.editor.ai.config.item.translateTo.norwegian.title",defaultMessage:"Translate to Norwegian"},norwegianDescription:{id:"fabric.editor.ai.config.item.translateTo.norwegian.description",defaultMessage:"Translates the text you're working on to Norwegian"},polishTitle:{id:"fabric.editor.ai.config.item.translateTo.polish.title",defaultMessage:"Translate to Polish"},polishDescription:{id:"fabric.editor.ai.config.item.translateTo.polish.description",defaultMessage:"Translates the text you're working on to Polish"},portugueseBrazilianTitle:{id:"fabric.editor.ai.config.item.translateTo.portugueseBrazilian.title",defaultMessage:"Translate to Portuguese (Brazilian)"},portugueseBrazilianDescription:{id:"fabric.editor.ai.config.item.translateTo.portugueseBrazilian.description",defaultMessage:"Translates the text you're working on to Portuguese (Brazilian)"},russianTitle:{id:"fabric.editor.ai.config.item.translateTo.russian.title",defaultMessage:"Translate to Russian"},russianDescription:{id:"fabric.editor.ai.config.item.translateTo.russian.description",defaultMessage:"Translates the text you're working on to Russian"},spanishTitle:{id:"fabric.editor.ai.config.item.translateTo.spanish.title",defaultMessage:"Translate to Spanish"},spanishDescription:{id:"fabric.editor.ai.config.item.translateTo.spanish.description",defaultMessage:"Translates the text you're working on to Spanish"},swedishTitle:{id:"fabric.editor.ai.config.item.translateTo.swedish.title",defaultMessage:"Translate to Swedish"},swedishDescription:{id:"fabric.editor.ai.config.item.translateTo.swedish.description",defaultMessage:"Translates the text you're working on to Swedish"},turkishTitle:{id:"fabric.editor.ai.config.item.translateTo.turkish.title",defaultMessage:"Translate to Turkish"},turkishDescription:{id:"fabric.editor.ai.config.item.translateTo.turkish.description",defaultMessage:"Translates the text you're working on to Turkish"},thaiTitle:{id:"fabric.editor.ai.config.item.translateTo.thai.title",defaultMessage:"Translate to Thai"},thaiDescription:{id:"fabric.editor.ai.config.item.translateTo.thai.description",defaultMessage:"Translates the text you're working on to Thai"},ukrainianTitle:{id:"fabric.editor.ai.config.item.translateTo.ukrainian.title",defaultMessage:"Translate to Ukrainian"},ukrainianDescription:{id:"fabric.editor.ai.config.item.translateTo.ukrainian.description",defaultMessage:"Translates the text you're working on to Ukrainian"},vietnameseTitle:{id:"fabric.editor.ai.config.item.translateTo.vietnamese.title",defaultMessage:"Translate to Vietnamese"},vietnameseDescription:{id:"fabric.editor.ai.config.item.translateTo.vietnamese.description",defaultMessage:"Translates the text you're working on to Vietnamese"}});e.exports.aiLanguageMessages=n}),a("l5nYy",function(t,n){var a=i("42omo"),r=i("dZ8uq");function o({key:t,title:n,description:r,intentSchemaId:o,featureId:s,icon:l,shortTitle:c,adfPrompt:d,factoryOptions:p}){return{key:t,title:n,description:r,icon:l,showInRefineDropdown:!0,intentSchemaId:o,featureId:s,adfPrompt:d,requiresTextualContent:d,nestingConfig:{id:"change-tone-to",parentTestId:"change-tone-to",parentTitle:(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?i("7ShCl").aiMessages.changeToneToolbarDropdownIconTitle:i("AMCQl").aiConfigItemMessages.changeToneNestingParentTitlePostGA,shortTitle:c,icon:()=>e(a).createElement(e(i("bAxHS")),{label:"",spacing:"spacious"})},actions:{empty:[(0,i("jc4DP").createInsertBelow)({appearance:"secondary",factoryOptions:p}),(0,i("jc4DP").createReplace)({appearance:"primary"})],selection:[(0,i("jc4DP").createInsertBelow)({appearance:"secondary",factoryOptions:p}),(0,i("jc4DP").createReplace)({appearance:"primary"})]},getBackendModel:()=>"assistance-service"}}let s=t=>{let n=t?.product!=="CONFLUENCE"&&(0,i("dh538").fg)("platform_editor_ai_adf_prompts_in_all_products")?"change_tone_professional_adf_gpt41mini":"change_tone_professional",s=t?.product!=="CONFLUENCE"&&(0,i("dh538").fg)("platform_editor_ai_adf_prompts_in_all_products");return(0,r.expValEqualsNoExposure)("platform_editor_ai_non_iw_adf_streaming","cohort","adf_gpt41mini")?(n="change_tone_professional_adf_gpt41mini",s=!0):(0,r.expValEqualsNoExposure)("platform_editor_ai_non_iw_adf_streaming","cohort","adf_gemini25flash")&&(n="change_tone_professional_adf_v111",s=!0),o({key:i("bwpRs").CONFIG_ITEM_KEYS.CHANGE_TONE_TO_PROFESSIONAL,title:(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?i("7ShCl").aiMessages.moreProfessionalToneToolbarDropdownIconTitle:i("AMCQl").aiConfigItemMessages.changeToneProfessionalToneTitle,shortTitle:i("AMCQl").aiConfigItemMessages.changeToneProfessionalToneShortTitle,description:i("AMCQl").aiConfigItemMessages.changeToneProfessionalToneDescription,intentSchemaId:"change_tone_professional_intent_schema.json",featureId:n,adfPrompt:s,icon:()=>e(a).createElement(i("3CQrB").ToneProfessionalIcon,null),factoryOptions:t})},l=t=>{let n=t?.product!=="CONFLUENCE"&&(0,i("dh538").fg)("platform_editor_ai_adf_prompts_in_all_products")?"change_tone_casual_adf_gpt41mini":"change_tone_casual",s=t?.product!=="CONFLUENCE"&&(0,i("dh538").fg)("platform_editor_ai_adf_prompts_in_all_products");return(0,r.expValEqualsNoExposure)("platform_editor_ai_non_iw_adf_streaming","cohort","adf_gpt41mini")?(n="change_tone_casual_adf_gpt41mini",s=!0):(0,r.expValEqualsNoExposure)("platform_editor_ai_non_iw_adf_streaming","cohort","adf_gemini25flash")&&(n="change_tone_casual_adf_v111",s=!0),o({key:i("bwpRs").CONFIG_ITEM_KEYS.CHANGE_TONE_TO_CASUAL,title:(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?i("7ShCl").aiMessages.moreCasualToneToolbarDropdownIconTitle:i("AMCQl").aiConfigItemMessages.changeToneCasualToneTitle,shortTitle:i("AMCQl").aiConfigItemMessages.changeToneCasualToneShortTitle,description:i("AMCQl").aiConfigItemMessages.changeToneCasualToneDescription,intentSchemaId:"change_tone_business_casual_intent_schema.json",featureId:n,adfPrompt:s,icon:()=>e(a).createElement(i("kzUJG").ToneCasualIcon,null),factoryOptions:t})},c=t=>{let n=t?.product!=="CONFLUENCE"&&(0,i("dh538").fg)("platform_editor_ai_adf_prompts_in_all_products")?"change_tone_educational_adf_gpt41mini":"change_tone_educational",s=t?.product!=="CONFLUENCE"&&(0,i("dh538").fg)("platform_editor_ai_adf_prompts_in_all_products");return(0,r.expValEqualsNoExposure)("platform_editor_ai_non_iw_adf_streaming","cohort","adf_gpt41mini")?(n="change_tone_educational_adf_gpt41mini",s=!0):(0,r.expValEqualsNoExposure)("platform_editor_ai_non_iw_adf_streaming","cohort","adf_gemini25flash")&&(n="change_tone_educational_adf",s=!0),o({key:i("bwpRs").CONFIG_ITEM_KEYS.CHANGE_TONE_TO_EDUCATIONAL,title:i("AMCQl").aiConfigItemMessages.changeToneEducationalToneTitle,shortTitle:i("AMCQl").aiConfigItemMessages.changeToneEducationalToneShortTitle,description:i("AMCQl").aiConfigItemMessages.changeToneEducationalToneDescription,intentSchemaId:"change_tone_educational_intent_schema.json",featureId:n,adfPrompt:s,icon:()=>e(a).createElement(i("4iTxZ").ToneEducationalIcon,null),factoryOptions:t})},d=t=>{let n=t?.product!=="CONFLUENCE"&&(0,i("dh538").fg)("platform_editor_ai_adf_prompts_in_all_products")?"change_tone_empathetic_adf_gpt41mini":"change_tone_empathetic",s=t?.product!=="CONFLUENCE"&&(0,i("dh538").fg)("platform_editor_ai_adf_prompts_in_all_products");return(0,r.expValEqualsNoExposure)("platform_editor_ai_non_iw_adf_streaming","cohort","adf_gpt41mini")?(n="change_tone_empathetic_adf_gpt41mini",s=!0):(0,r.expValEqualsNoExposure)("platform_editor_ai_non_iw_adf_streaming","cohort","adf_gemini25flash")&&(n="change_tone_empathetic_adf_v111",s=!0),o({key:i("bwpRs").CONFIG_ITEM_KEYS.CHANGE_TONE_TO_EMPATHETIC,title:(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")?i("7ShCl").aiMessages.moreEmpatheticToneToolbarDropdownIconTitle:i("AMCQl").aiConfigItemMessages.changeToneEmpatheticToneTitle,shortTitle:i("AMCQl").aiConfigItemMessages.changeToneEmpatheticToneShortTitle,description:i("AMCQl").aiConfigItemMessages.changeToneEmpatheticToneDescription,intentSchemaId:"change_tone_empathetic_intent_schema.json",featureId:n,adfPrompt:s,icon:()=>e(a).createElement(i("huBgn").ToneEmpatheticIcon,null),factoryOptions:t})};t.exports.changeToneToNeutral=t=>o({key:i("bwpRs").CONFIG_ITEM_KEYS.CHANGE_TONE_TO_NEUTRAL,title:i("AMCQl").aiConfigItemMessages.changeToneNeutralToneTitle,shortTitle:i("AMCQl").aiConfigItemMessages.changeToneNeutralToneShortTitle,description:i("AMCQl").aiConfigItemMessages.changeToneNeutralToneDescription,intentSchemaId:"change_tone_neutral_intent_schema.json",featureId:"change_tone_neutral",adfPrompt:!1,icon:()=>e(a).createElement(i("34mjL").ToneNeutralIcon,null),factoryOptions:t}),t.exports.changeToneToProfessional=s,t.exports.changeToneToProfessionalWithOptions=e=>({config:s(e),triggers:{empty:{enabled:!0,docMinSize:1},selection:{enabled:!0}}}),t.exports.changeToneToCasual=l,t.exports.changeToneToCasualWithOptions=e=>({config:l(e),triggers:{empty:{enabled:!0,docMinSize:1},selection:{enabled:!0}}}),t.exports.changeToneToEducational=c,t.exports.changeToneToEducationalWithOptions=e=>({config:c(e),triggers:{empty:{enabled:!0,docMinSize:1},selection:{enabled:!0}}}),t.exports.changeToneToEmpathetic=d,t.exports.changeToneToEmpatheticWithOptions=e=>({config:d(e),triggers:{empty:{enabled:!0,docMinSize:1},selection:{enabled:!0}}})}),a("2KJU8",function(t,n){var a=i("42omo"),r=i("dZ8uq");let o=t=>{let n=t?.product!=="CONFLUENCE"&&(0,i("dh538").fg)("platform_editor_ai_adf_prompts_in_all_products")?"make_longer_adf_gpt41mini":"make_longer",o=t?.product!=="CONFLUENCE"&&(0,i("dh538").fg)("platform_editor_ai_adf_prompts_in_all_products");return(0,r.expValEqualsNoExposure)("platform_editor_ai_non_iw_adf_streaming","cohort","adf_gpt41mini")?(n="make_longer_adf_gpt41mini",o=!0):(0,r.expValEqualsNoExposure)("platform_editor_ai_non_iw_adf_streaming","cohort","adf_gemini25flash")&&(n="make_longer_adf_v111",o=!0),{key:i("bwpRs").CONFIG_ITEM_KEYS.MAKE_LONGER,title:i("AMCQl").aiConfigItemMessages.makeLongerTitle,description:i("AMCQl").aiConfigItemMessages.makeLongerDescription,icon:()=>e(a).createElement(i("2RGeG").MakeLongerIcon,null),statusLozengeType:"beta",intentSchemaId:"make_longer.json",featureId:n,adfPrompt:o,requiresTextualContent:o,getBackendModel:()=>"assistance-service",showInRefineDropdown:!0,actions:{empty:[(0,i("jc4DP").createInsertBelow)({appearance:"secondary",factoryOptions:t}),(0,i("jc4DP").createReplace)({appearance:"primary"})],selection:[(0,i("jc4DP").createInsertBelow)({appearance:"secondary",factoryOptions:t}),(0,i("jc4DP").createReplace)({appearance:"primary"})]},get nestingConfig(){if(t?.isInDocumentStreamingEnabled)return{id:"adjust-length",parentTestId:"adjust-length",parentTitle:i("AMCQl").aiConfigItemMessages.adjustLengthNestingParentTitle,shortTitle:i("AMCQl").aiConfigItemMessages.adjustLengthNestingParentShortTitle,icon:()=>e(a).createElement(e(i("drPNW")),{label:"",spacing:"spacious"})};return}}};t.exports.makeLonger=o,t.exports.makeLongerWithOptions=e=>({config:o(e),triggers:{empty:{enabled:!0,docMinSize:1},selection:{enabled:!0}}})}),a("96Uu5",function(t,n){var a=i("42omo"),r=i("dZ8uq");let o=t=>{let n=t?.product!=="CONFLUENCE"&&(0,i("dh538").fg)("platform_editor_ai_adf_prompts_in_all_products")?"make_shorter_adf_gpt41mini":"make_shorter",o=t?.product!=="CONFLUENCE"&&(0,i("dh538").fg)("platform_editor_ai_adf_prompts_in_all_products");return(0,r.expValEqualsNoExposure)("platform_editor_ai_non_iw_adf_streaming","cohort","adf_gpt41mini")?(n="make_shorter_adf_gpt41mini",o=!0):(0,r.expValEqualsNoExposure)("platform_editor_ai_non_iw_adf_streaming","cohort","adf_gemini25flash")&&(n="make_shorter_adf_v111",o=!0),{key:i("bwpRs").CONFIG_ITEM_KEYS.MAKE_SHORTER,title:i("AMCQl").aiConfigItemMessages.makeShorterTitle,description:i("AMCQl").aiConfigItemMessages.makeShorterDescription,icon:()=>e(a).createElement(i("8vLXI").MakeShorterIcon,null),showInRefineDropdown:!0,intentSchemaId:"shorten_intent_schema.json",featureId:n,adfPrompt:o,requiresTextualContent:o,actions:{empty:[(0,i("jc4DP").createInsertBelow)({appearance:"secondary",factoryOptions:t}),(0,i("jc4DP").createReplace)({appearance:"primary"})],selection:[(0,i("jc4DP").createInsertBelow)({appearance:"secondary",factoryOptions:t}),(0,i("jc4DP").createReplace)({appearance:"primary"})]},getBackendModel:()=>"assistance-service",get nestingConfig(){if(t?.isInDocumentStreamingEnabled)return{id:"adjust-length",parentTestId:"adjust-length",parentTitle:i("AMCQl").aiConfigItemMessages.adjustLengthNestingParentTitle,shortTitle:i("AMCQl").aiConfigItemMessages.adjustLengthNestingParentShortTitle,icon:()=>e(a).createElement(e(i("drPNW")),{label:"",spacing:"spacious"})};return}}};t.exports.makeShorter=o,t.exports.makeShorterWithOptions=e=>({config:o(e),triggers:{empty:{enabled:!0,docMinSize:1},selection:{enabled:!0}}})}),a("kOMDA",function(t,n){var a=i("42omo");let r=t=>({key:i("bwpRs").CONFIG_ITEM_KEYS.ADD_POLISH,title:i("AMCQl").aiConfigItemMessages.addPolishTitle,description:i("AMCQl").aiConfigItemMessages.addPolishDescription,icon:()=>e(a).createElement(e(i("cbtR4")),{label:""}),showInRefineDropdown:!0,intentSchemaId:"shorten_intent_schema.json",featureId:"add_polish_adf",adfPrompt:!0,requiresTextualContent:!0,actions:{empty:[(0,i("jc4DP").createInsertBelow)({appearance:"secondary",factoryOptions:t}),(0,i("jc4DP").createReplace)({appearance:"primary"})],selection:[(0,i("jc4DP").createInsertBelow)({appearance:"secondary",factoryOptions:t}),(0,i("jc4DP").createReplace)({appearance:"primary"})]},getBackendModel:()=>"assistance-service"});t.exports.addPolish=r,t.exports.addPolishWithOptions=e=>({config:r(),triggers:{empty:{enabled:e?.isInDocumentStreamingEnabled??!1,docMinSize:1},selection:{enabled:e?.isInDocumentStreamingEnabled??!1,selectionMinSize:1}}})}),a("6PN31",function(t,n){var a=i("42omo"),r=i("dZ8uq");let o=(0,i("8vIZB").getSortedSupportedTranslationLanguages)(),s=t=>{let n=t?.product!=="CONFLUENCE"&&(0,i("dh538").fg)("platform_editor_ai_adf_prompts_in_all_products")?"translate_adf_gpt41mini":"translate",s=t?.product!=="CONFLUENCE"&&(0,i("dh538").fg)("platform_editor_ai_adf_prompts_in_all_products");return(0,r.expValEqualsNoExposure)("platform_editor_ai_non_iw_adf_streaming","cohort","adf_gpt41mini")?(n="translate_adf_gpt41mini",s=!0):(0,r.expValEqualsNoExposure)("platform_editor_ai_non_iw_adf_streaming","cohort","adf_gemini25flash")&&(s=!0,n="translate_adf"),Object.fromEntries(o.map(r=>{let o=i("bpQiY").aiLanguageMessages[r];if(!o)return!1;let l={key:`Translate to ${r}`,title:i("bpQiY").aiLanguageMessages[`${r}Title`],description:i("bpQiY").aiLanguageMessages[`${r}Description`],icon:()=>e(a).createElement(i("jcb9f").TranslateIcon,null),showInRefineDropdown:(0,i("8vIZB").isRefinementSupport)(r),nestingConfig:{id:"translate-to",parentTestId:"translate-to",parentTitle:i("bpQiY").aiLanguageMessages.nestingParentTitlePostGA,shortTitle:o,icon:()=>e(a).createElement(i("jcb9f").TranslateIcon,null)},intentSchemaId:"translate_intent_schema.json",featureId:n,adfPrompt:s,requiresTextualContent:s,lang:o.defaultMessage,actions:{empty:[(0,i("jc4DP").createInsertBelow)({appearance:"secondary",factoryOptions:t}),(0,i("jc4DP").createReplace)({appearance:"primary"})],selection:[(0,i("jc4DP").createInsertBelow)({appearance:"secondary",factoryOptions:t}),(0,i("jc4DP").createReplace)({appearance:"primary"})]}};return[r,l]}).filter(Boolean))},l=e=>Object.values(s(e));t.exports.createTranslationConfigItems=s,t.exports.translationConfigItemWithOptions=e=>l(e).map(e=>({config:e,triggers:{empty:{enabled:!0,docMinSize:1},selection:{enabled:!0}}})),t.exports.translationConfigItemWithOptionsEnabledForSelectionOnly=e=>l(e).map(e=>({config:e,triggers:{empty:{enabled:!1},selection:{enabled:!0}}}))}),a("8vIZB",function(e,t){e.exports.getSortedSupportedTranslationLanguages=()=>i("hgTYG").supportedTranslationLanguagesPopularOrder,e.exports.isRefinementSupport=e=>i("hgTYG").refinementSupportedTranslationLanguages.includes(e)}),a("6bKwm",function(e,t){let{createPluginState:n,createCommand:a}=(0,i("lkJUe").pluginFactory)(i("47Psn").rovoAgentsPluginKey,i("6R7jM").reducer);e.exports.createPluginState=n,e.exports.createCommand=a,e.exports.getRovoAgentsPluginState=e=>i("47Psn").rovoAgentsPluginKey.getState(e)}),a("la6aw",function(e,t){var n,i=((n={})[n.UPDATE_PLUGIN_STATE=0]="UPDATE_PLUGIN_STATE",n);e.exports.ACTIONS=i}),a("jAwX6",function(e,t){e.exports.createContinueInChat=({appearance:e,product:t,actionSideEffect:n,factoryOptions:a})=>({type:"generic-chat",title:a?.isInDocumentStreamingEnabled?i("AMCQl").aiConfigItemMessages.configActionContinueChatLabel:i("AMCQl").aiConfigItemMessages.configActionContinueInChatLabel,appearance:e,shortcut:i("hgeg8").continueInRovoChat,run:({name:e,dialogues:i,publish:a})=>{a&&i.length&&(a({type:"chat-new",product:t,data:{dialogues:i,name:e},source:"editor"}),n?.())},preserveEditorSelectionOnComplete:!0,icon:i("2JNmf").ChatIcon}),e.exports.createContinueInChatForAgent=({appearance:e,agent:t,product:n,actionSideEffect:a,actionOverride:r,factoryOptions:o})=>({type:"agent",title:o?.isInDocumentStreamingEnabled?i("AMCQl").aiConfigItemMessages.configActionContinueChatLabel:i("AMCQl").aiConfigItemMessages.configActionContinueInChatLabel,shortcut:i("hgeg8").continueInRovoChat,appearance:e,run:({channelId:e,publish:i})=>{if(e&&i){if("function"==typeof r)return void r({channelId:e});i({type:"chat-open",product:n,data:{channelId:e,agentId:t.namedId},source:"editor"}),a?.()}},preserveEditorSelectionOnComplete:!0,icon:i("2JNmf").ChatIcon})}),a("e83av",function(e,t){class n{eq(e){return this.chars===e.chars&&this.length===e.length}sub(e){return new n(this.chars-e.chars,this.length-e.length)}gte(e){return this.chars>=e.chars&&this.length>=e.length}constructor(e,t){this.chars=e,this.length=t}}e.exports.StreamFlowPacer=class{setEmit(e){this.emit=e}setTickMs(e){this.cfg.tickMs=e}setCharsPerTick(e){this.charsPerTick=e}setMaxCharsPerTick(e){this.cfg.maxCharsPerTick=e}start(){!this.destroyed&&this.emit&&(this.timer=setInterval(()=>this.tick(),this.cfg.tickMs))}pause(){this.paused=!0,this.stop()}resume(){this.paused=!1,this.start()}destroy(){this.reset(),this.destroyed=!0}onComplete(e){this.onCompleteHandlers.push(e)}reset(){this.stop(),this.emit=null,this.streamEvt=null,this.terminalEvt=null,this.charsPerTick=this.cfg.initialCharsPerTick,this.delivered=new n(0,0),this.prevTickTime=0,this.currTickTime=0,this.ticksSinceRamp=0,this.ramped=0,this.paused=!1,this.destroyed=!1,this.onCompleteHandlers.length=0}isRunning(){return null!==this.timer}stop(){this.timer&&(clearInterval(this.timer),this.timer=null)}tick(){this.prevTickTime=this.currTickTime,this.currTickTime=Date.now(),!this.paused&&(this.streamEvt||this.terminalEvt)&&(this.maybeRamp(),this.deliverChunk(),this.maybeFlushTerminal())}deliverChunk(){let e;if(!this.streamEvt)return;let t=this.semanticLen(this.streamEvt);!this.delivered.gte(t)&&(e=this.prevTickTime>0&&this.currTickTime>0&&this.currTickTime-this.prevTickTime>=3e3&&(0,i("dh538").fg)("platform_editor_ai_aifc_background")||this.delivered.chars>=t.chars&&this.delivered.length<t.length?this.sliceStreamEvt(this.streamEvt,-1):this.sliceStreamEvt(this.streamEvt,Math.min(this.delivered.chars+this.charsPerTick,t.chars)))&&(this.emit?.(e),this.delivered=this.semanticLen(e),this.delivered.eq(t)&&this.onCompleteHandlers.length&&(this.onCompleteHandlers.forEach(e=>e()),this.onCompleteHandlers.length=0))}canFlushTerminal(){return!!this.terminalEvt&&("complete"!==this.terminalEvt.type&&"response too similar"!==this.terminalEvt.type||this.backlog().chars<=0)}maybeFlushTerminal(){this.canFlushTerminal()&&this.terminalEvt&&(this.emit?.(this.terminalEvt),this.destroy())}maybeRamp(){if(!this.shouldRamp())return void this.ticksSinceRamp++;this.charsPerTick=Math.min(Math.ceil(this.charsPerTick*this.cfg.ramp.growthFactor),this.cfg.maxCharsPerTick),this.ticksSinceRamp=0,this.ramped++}shouldRamp(){let e=this.secondsToTicks(this.getRampDelay(this.cfg.ramp,this.ramped,this.terminalEvt));return(this.backlog().chars>this.cfg.backlogRampThreshold||this.terminalEvt?.type==="response too similar")&&this.ticksSinceRamp>=e&&this.charsPerTick<this.cfg.maxCharsPerTick}backlog(){return this.streamEvt?this.semanticLen(this.streamEvt).sub(this.delivered):new n(0,0)}getRampDelay(e,t,n){return n?.type==="response too similar"?e.flushDelaySec:t>0?e.stepDelaySec:e.initialDelaySec}secondsToTicks(e){return 1e3*e/this.cfg.tickMs}semanticLen(e){return e.markdown&&"string"==typeof e.markdown?new n(e.markdown.length,e.markdown.length):this.adfTextLen(e.adfResponse)}sliceStreamEvt(e,t){return e.adfResponse?t<0?{...e,adfResponse:e.adfResponse}:{...e,adfResponse:this.truncateAdf(e.adfResponse,t)}:e.markdown?.length?{...e,markdown:e.markdown.slice(0,t<0?void 0:t)}:null}adfTextLen(e){if(!e)return new n(0,0);let{chars:t,length:a}=(0,i("1A9t2").reduce)(e,(e,t)=>"text"===t.type&&"string"==typeof t.text?{chars:e.chars+t.text.length,length:e.length+t.text.length+2}:{chars:e.chars,length:e.length+2},{chars:0,length:0});return new n(t,a)}truncateAdf(e,t){let n,a=Math.max(0,t),r="undefined"!=typeof window&&"function"==typeof window.structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e)),o=1;return(0,i("6jPem").traverse)(r,{any(e,t){if(("tableCell"===e.type||"tableHeader"===e.type)&&(o=Math.max(o,e.attrs?.rowspan||1)),o>0&&"tableRow"===e.type&&(o--,!(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")))return;if("tableRow"===e.type&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")&&(n=e.attrs?.localId),0===a){if("tableRow"===e.type&&(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers"))return 0!==o&&void 0;let a=t;for(;a;){if(a?.node?.type==="tableRow"){if(a.node?.attrs?.localId===n||o>0)if((0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers")){if("tableCell"===e.type||"tableHeader"===e.type)return}else{if("text"===e.type)return!1;return}break}a=a.parent}return!1}if("tableRow"===e.type&&!(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga_blockers"))return n=e.attrs?.localId,{...e};if("text"!==e.type||"string"!=typeof e.text)return;if(e.text.length<=a){a-=e.text.length;return}let r=e.text.slice(0,a);return a=0,{...e,text:r}}})}constructor(e){this.cfg=e,this.push=e=>{"stream"===e.type?this.streamEvt=e:this.terminalEvt=e},this.timer=null,this.streamEvt=null,this.terminalEvt=null,this.charsPerTick=void 0,this.delivered=new n(0,0),this.prevTickTime=0,this.currTickTime=0,this.ticksSinceRamp=0,this.ramped=0,this.paused=!1,this.destroyed=!1,this.emit=null,this.onCompleteHandlers=[],this.charsPerTick=e.initialCharsPerTick}}}),a("1xicG",function(e,t){e.exports.normaliseAIExperienceEvent=function(e){switch(e.type){case"complete":return{markdown:"",cacheKey:"",modelInput:{},...e};case"stream":return{markdown:"",...e};case"error":return{cacheKey:"",modelInput:{},...e}}}}),a("hgTYG",function(e,t){var n,i=((n={}).ChineseSimplified="chineseSimplified",n.ChineseTraditional="chineseTraditional",n.Czech="czech",n.Danish="danish",n.Dutch="dutch",n.English="english",n.Finnish="finnish",n.French="french",n.German="german",n.Hungarian="hungarian",n.Italian="italian",n.Japanese="japanese",n.Korean="korean",n.Norwegian="norwegian",n.Polish="polish",n.PortugueseBrazilian="portugueseBrazilian",n.Russian="russian",n.Spanish="spanish",n.Swedish="swedish",n.Turkish="turkish",n.Thai="thai",n.Ukrainian="ukrainian",n.Vietnamese="vietnamese",n);e.exports.SupportedTranslationLanguages=i,e.exports.supportedTranslationLanguagesPopularOrder=["english","german","japanese","french","korean","spanish","portugueseBrazilian","russian","dutch","chineseSimplified","polish","italian","chineseTraditional","norwegian","swedish","czech","finnish","danish","hungarian","turkish","thai","ukrainian","vietnamese"],e.exports.refinementSupportedTranslationLanguages=["english","german","french","spanish","japanese","portugueseBrazilian","chineseSimplified","korean"]}),a("4NrmI",function(e,t){e.exports.getPackageInfo=function(){return{packageName:"platform-pkg",packageVersion:"0.0.0-use.local"}}}),a("99IPz",function(e,t){function n(e,t){let n=[0,0];if(e.find(void 0,void 0,e=>"modalMountPointDecoration"===e.key||"modalMountPointRangeDecoration"===e.key).shift()){if(!t)return;n=t}else{let t=e.find(void 0,void 0,e=>"ai-nodeDecoration"===e.key);if(!(t.length>0))return;n=[Math.min(...t.map(e=>e.from)),Math.max(...t.map(e=>e.to))]}return n}e.exports.reducer=function(e,t){switch(t.type){case"END_EXPERIENCE":return{modalDecorationSet:i("ftzrq").DecorationSet.empty,dispatchAnalyticsEvent:e.dispatchAnalyticsEvent,initialPositions:void 0,initialSelection:void 0,positions:void 0,...t.data,isRunning:!1,isShowingAcceptRejectScreen:!1,targetId:e.targetId,currentSessionId:e.currentSessionId===e.nextSessionId?e.currentSessionId:void 0,nextSessionId:e.nextSessionId,hideLoadingScreen:(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")?!!e.nextSessionId&&e.hideLoadingScreen:void 0,sessionEnded:!1,isInDocumentStreamingEnabled:e.isInDocumentStreamingEnabled};case"SHOW_MODAL":return{...e,...t.data,isRunning:!0,isShowingAcceptRejectScreen:t.data.withAcceptReject&&!e.nextSessionId,currentSessionId:e.nextSessionId,sessionEnded:!1,positions:n(t.data.modalDecorationSet,t.data.initialPositions)};case"UPDATE_MODAL_DECORATION_SET":return{...e,modalDecorationSet:t.data.modalDecorationSet,positions:n(t.data.modalDecorationSet,e.initialPositions)};case"START_SESSION":return{...e,nextSessionId:t.data.sessionId,sessionStarted:!0,sessionEnded:!1,isShowingAcceptRejectScreen:!1};case"END_SESSION":return{...e,nextSessionId:t.data.sessionId,currentSessionId:e.isRunning?e.currentSessionId:t.data.sessionId,hideLoadingScreen:!(0,i("dh538").fg)("platform_editor_ai_aifc_patch_ga")&&e.hideLoadingScreen,sessionStarted:!1,sessionEnded:!0};case"UPDATE_TARGET_ID":return{...e,targetId:t.data.targetId};default:return e}}}),a("8VRku",function(t,n){var a=i("42omo");t.exports.SuggestTitleIcon=()=>e(a).createElement(e(i("f8c3d")),{label:"",color:"currentColor",spacing:"spacious"})}),a("9SZMg",function(e,t){e.exports.JsonRepair=class{append(e){this.buffer+=e}parse(){let e=(0,i("cbRqO").sanitizeStreamContentForADFStreamer)(this.buffer),t=(0,i("gZzhj").jsonrepair)(e);if(t?.length)try{let e=JSON.parse(t),n=t.length,i=n!==this.prevSize;return this.prevSize=n,{hasChanged:i,repairedJson:e}}catch(e){throw Error("failed to parse repaired json string returned by jsonrepair.")}throw Error("jsonrepair returned undefined or empty string.")}reset(){this.buffer="",this.prevSize=0}constructor(){this.buffer="",this.prevSize=0}}}),a("haQ6N",function(e,t){e.exports.repairNodeMarks=function(e,t){if(!t||!Array.isArray(t))return{repairedMarks:[]};let n=function(e){let t=new Set,n=i("4sRZs").allSpecs[e],a=[];function r(e){if(e){if("props"in e&&"marks"in e.props&&e.props.marks)o(e.props.marks.items);else if(Array.isArray(e)&&e.length>=2){let t=e[1];t?.props?.marks?.items&&o(t.props.marks.items)}}}function o(e){Array.isArray(e)&&e.forEach(e=>{"string"==typeof e?t.add(e):Array.isArray(e)&&e.forEach(e=>{"string"==typeof e&&t.add(e)})})}return Object.keys(i("4sRZs").allSpecs).forEach(t=>{t.startsWith(e)&&Array.isArray(i("4sRZs").allSpecs[t])&&i("4sRZs").allSpecs[t][0]===e&&a.push(i("4sRZs").allSpecs[t])}),r(n),a.forEach(e=>r(e)),Array.from(t)}(e),a=[],r=[];for(let o=0;o<t.length;o++){let s=t[o],l=function(e,t){if(!e||"object"!=typeof e)return{isValid:!1,error:"Mark must be an object"};let n=e.type;if(n&&t.includes(n)||(n=function(e,t,n){if(e||(e=function(e){if(e&&"object"==typeof e){if(e.align)return"alignment";if(e.annotationType)return"annotation";if(e.size)return"border";if(e.color)return"backgroundColor";if(e.mode)return"breakout";if(e.sources)return"dataConsumer";if(e.localId&&void 0!==e.name)return"fragment";if(e.level)return"indentation";if(e.href||e.title||e.collection||e.occurrenceKey)return"link";if(e.type&&("sub"===e.type||"sup"===e.type))return"subsup"}}(n)),"string"==typeof e&&!t.includes(e)){let n=t.filter(t=>t.startsWith(e));n.length>0&&(e=n[0])}return e}(n,t,e.attrs)),!n)return{isValid:!1,error:`Mark type '${n}' is invalid and could not be inferred`};let a=function(e,t){let n=i("4sRZs").allSpecs[e];if(!n)return{isValid:!1,error:`Unknown mark type: ${e}`};let a=n.props.attrs;if(!a)return{isValid:!0};if(!t){let t={},n=[];for(let[r,o]of Object.entries(a.props))if(!o.optional){let a=(0,i("8pB0g").generateDefaultValueForAttribute)(o,r,e);null===a?n.push(`Mark ${e}: Required attribute '${r}' cannot have default value`):t[r]=a}return n.length>0?{isValid:!1,error:n.join("; ")}:{isValid:!0,repairedAttrs:t}}let r={...t},o=[];for(let[n,s]of Object.entries(a.props)){let a=t[n],l=(0,i("8pB0g").validateAndRepairAttributeValue)(n,a,s,e);l.isValid?r[n]=l.repairedValue:s.optional||o.push(l.error||`Invalid value for attribute '${n}'`)}return o.length>0?{isValid:!1,error:o.join("; ")}:{isValid:!0,repairedAttrs:r}}(n,e.attrs);if(!a.isValid)return{isValid:!1,error:a.error};let r={type:n};return a.repairedAttrs&&Object.keys(a.repairedAttrs).length>0&&(r.attrs=a.repairedAttrs),{isValid:!0,repairedMark:r}}(s,n);l.isValid&&l.repairedMark?a.push(l.repairedMark):r.push(l.error||`Can' repair mark ${s.type} for node ${e}`)}return{repairedMarks:a,errors:r}}}),a("8LROh",function(t,n){var a=i("a4TK8");function r(e,t,n){if(!e){let e={},a=[];for(let[r,o]of Object.entries(t.props))if(!o.optional){let t=(0,i("8pB0g").generateDefaultValueForAttribute)(o,r,n);null===t?a.push(`Required attribute '${r}' cannot have default value (has validatorFn)`):e[r]=t}return a.length>0?{isValid:!1,error:a.join("; ")}:{isValid:!0,repairedAttrs:e}}let a={...e},r=[];for(let[o,s]of Object.entries(t.props)){let t=e[o],l=(0,i("8pB0g").validateAndRepairAttributeValue)(o,t,s,n);l.isValid?a[o]=l.repairedValue:s.optional||r.push(l.error||`Invalid value for attribute '${o}'`)}return r.length>0?{isValid:!1,error:r.join("; ")}:{isValid:!0,repairedAttrs:a}}t.exports.validateAndRepairNodeAttrs=function(t,n){if(!i("4sRZs").allSpecs[t])return{isValid:!1,error:`Unknown node type: ${t}`};let o=function(e){let t=i("4sRZs").allSpecs[e];if(!t)return null;if(t.props.attrs)return t;for(let[,n]of Object.entries(i("4sRZs").allSpecs))if(Array.isArray(n)){let[i,a]=n;if(i===e&&a.props.attrs)return{...t,props:{...t.props,...a.props},required:a.required||t.required}}return t}(t);if(!o)return{isValid:!1,error:`Unable to resolve spec for node type: ${t}`};let s=o.props.attrs;if(!s)return{isValid:!0,repairedAttrs:n||{}};if(Array.isArray(s)){let i=[];for(let o=0;o<s.length;o++){let l=r(n,s[o],t);if(l.isValid&&(o===s.length-1||e(a)(l.repairedAttrs,n)))return l;i.push(l.error||"Unknown validation error")}return{isValid:!1,error:`Node '${t}' attrs don't match any valid schema: ${i.join(" | ")}`}}return r(n,s,t)}}),a("grDNZ",function(e,t){let n={date:i("auD3v").toSupportedDate,panel:i("gbta9").toSupportedPanel};e.exports.toSupportedNode=(e,t)=>{let i=n[e];return i?i(t):t}}),a("2gWl9",function(e,t){e.exports.devToolsAdapter=e=>{if("undefined"==typeof window)return;let t=function(){let e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:void 0;if(e.__xstate__)return e.__xstate__}();t&&t.register(e)}}),a("jX1nN",function(t,n){var a=i("42omo");t.exports.InsertAtOrBelowIcon=()=>e(a).createElement(e(i("fUwkU")),{label:"",spacing:"spacious"})}),a("amGbB",function(t,n){var a=i("42omo");t.exports.InsertAtTopIcon=()=>e(a).createElement(e(i("4zFET")),{label:"",spacing:"spacious"})}),a("5BsiJ",function(t,n){var a=i("42omo");t.exports.FixSpellingIcon=()=>e(a).createElement(e(i("dLjaJ")),{label:"",color:"currentColor",spacing:"spacious"})}),a("h5jTI",function(t,n){var a=i("42omo");t.exports.ImproveWritingIcon=()=>e(a).createElement(e(i("lW0cT")),{label:"",color:"currentColor",spacing:"spacious"})}),a("kzUJG",function(t,n){var a=i("42omo");t.exports.ToneCasualIcon=()=>e(a).createElement(e(i("j398X")),{color:"currentColor",label:"",spacing:"spacious"})}),a("4iTxZ",function(t,n){var a=i("42omo");t.exports.ToneEducationalIcon=()=>e(a).createElement(e(i("gWb8i")),{label:"",color:"currentColor",spacing:"spacious"})}),a("huBgn",function(t,n){var a=i("42omo");t.exports.ToneEmpatheticIcon=()=>e(a).createElement(e(i("j8LwF")),{label:"",color:"currentColor",spacing:"spacious"})}),a("34mjL",function(t,n){var a=i("42omo");t.exports.ToneNeutralIcon=()=>e(a).createElement(e(i("kMl1Y")),{color:"currentColor",label:"",spacing:"spacious"})}),a("3CQrB",function(t,n){var a=i("42omo");t.exports.ToneProfessionalIcon=()=>e(a).createElement(e(i("oeZjt")),{label:"",color:"currentColor",spacing:"spacious"})}),a("2RGeG",function(t,n){var a=i("42omo");t.exports.MakeLongerIcon=()=>e(a).createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e(a).createElement("path",{d:"M5 5.75L19 5.75M5 9.91667L19 9.91667M5 14.0833L19 14.0833M5 18.25L12 18.25",stroke:"currentColor",strokeWidth:"1.5"}))}),a("8vLXI",function(t,n){var a=i("42omo");t.exports.MakeShorterIcon=()=>e(a).createElement(e(i("cH4SO")),{label:"",color:"currentColor",spacing:"spacious"})}),a("jcb9f",function(t,n){var a=i("42omo");t.exports.TranslateIcon=()=>e(a).createElement(e(i("3tLv0")),{label:"",color:"currentColor",spacing:"spacious"})}),a("47Psn",function(e,t){let n=new(0,i("ks2lK").PluginKey)("rovoAgentsPlugin");e.exports.rovoAgentsPluginKey=n}),a("6R7jM",function(e,t){e.exports.reducer=(e,t)=>t.type===i("la6aw").ACTIONS.UPDATE_PLUGIN_STATE?{...e,...t.data}:e}),a("2JNmf",function(t,n){var a=i("42omo");t.exports.ChatIcon=()=>e(a).createElement(e(i("lDwiy")),{label:"",spacing:"spacious"})}),a("gZzhj",function(e,t){let n={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},a={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"};e.exports.jsonrepair=function(e){let t=0,r="";d(["```","[```","{```"]),s()||function(){throw new(0,i("k97go").JSONRepairError)("Unexpected end of json string",e.length)}(),d(["```","```]","```}"]);let o=p(",");for(o&&l(),(0,i("iIblK").isStartOfValue)(e[t])&&(0,i("iIblK").endsWithCommaOrNewline)(r)?(o||(r=(0,i("iIblK").insertBeforeLastWhitespace)(r,",")),function(){let e=!0,t=!0;for(;t;)e?e=!1:p(",")||(r=(0,i("iIblK").insertBeforeLastWhitespace)(r,",")),t=s();t||(r=(0,i("iIblK").stripLastOccurrence)(r,",")),r=`[
${r}
]`}()):o&&(r=(0,i("iIblK").stripLastOccurrence)(r,","));"}"===e[t]||"]"===e[t];)t++,l();if(t>=e.length)return r;function s(){l();let n=function(){if("{"===e[t]){r+="{",t++,l(),u(",")&&l();let n=!0;for(;t<e.length&&"}"!==e[t];){let a;if(n?n=!1:(p(",")||(r=(0,i("iIblK").insertBeforeLastWhitespace)(r,",")),l()),g(),!(m()||_(!0))){"}"===e[t]||"{"===e[t]||"]"===e[t]||"["===e[t]||void 0===e[t]?r=(0,i("iIblK").stripLastOccurrence)(r,","):function(){throw new(0,i("k97go").JSONRepairError)("Object key expected",t)}();break}l();let o=p(":"),c=t>=e.length;o||((0,i("iIblK").isStartOfValue)(e[t])||c?r=(0,i("iIblK").insertBeforeLastWhitespace)(r,":"):S()),s()||(o||c?r+="null":S())}return"}"===e[t]?(r+="}",t++):r=(0,i("iIblK").insertBeforeLastWhitespace)(r,"}"),!0}return!1}()||function(){if("["===e[t]){r+="[",t++,l(),u(",")&&l();let n=!0;for(;t<e.length&&"]"!==e[t];)if(n?n=!1:p(",")||(r=(0,i("iIblK").insertBeforeLastWhitespace)(r,",")),g(),!s()){r=(0,i("iIblK").stripLastOccurrence)(r,",");break}return"]"===e[t]?(r+="]",t++):r=(0,i("iIblK").insertBeforeLastWhitespace)(r,"]"),!0}return!1}()||m()||function(){let n=t;if("-"===e[t]){if(t++,I())return E(n),!0;if(!(0,i("iIblK").isDigit)(e[t]))return t=n,!1}for(;(0,i("iIblK").isDigit)(e[t]);)t++;if("."===e[t]){if(t++,I())return E(n),!0;if(!(0,i("iIblK").isDigit)(e[t]))return t=n,!1;for(;(0,i("iIblK").isDigit)(e[t]);)t++}if("e"===e[t]||"E"===e[t]){if(("-"===e[++t]||"+"===e[t])&&t++,I())return E(n),!0;if(!(0,i("iIblK").isDigit)(e[t]))return t=n,!1;for(;(0,i("iIblK").isDigit)(e[t]);)t++}if(!I())return t=n,!1;if(t>n){let i=e.slice(n,t),a=/^0\d/.test(i);return r+=a?`"${i}"`:i,!0}return!1}()||h("true","true")||h("false","false")||h("null","null")||h("True","true")||h("False","false")||h("None","null")||_(!1)||function(){if("/"===e[t]){let n=t;for(t++;t<e.length&&("/"!==e[t]||"\\"===e[t-1]);)t++;return t++,r+=`"${e.substring(n,t)}"`,!0}}();return l(),n}function l(){let n=!(arguments.length>0)||void 0===arguments[0]||arguments[0],i=t,a=c(n);do(a=function(){if("/"===e[t]&&"*"===e[t+1]){for(var n,i;t<e.length&&("*"!==(n=e)[i=t]||"/"!==n[i+1]);)t++;return t+=2,!0}if("/"===e[t]&&"/"===e[t+1]){for(;t<e.length&&"\n"!==e[t];)t++;return!0}return!1}())&&(a=c(n));while(a)return t>i}function c(n){let a=n?i("iIblK").isWhitespace:i("iIblK").isWhitespaceExceptNewline,o="";for(;;)if(a(e,t))o+=e[t],t++;else if((0,i("iIblK").isSpecialWhitespace)(e,t))o+=" ",t++;else break;return o.length>0&&(r+=o,!0)}throw new(0,i("k97go").JSONRepairError)(`Unexpected character ${JSON.stringify(e[t])}`,t);function d(n){if(function(n){for(let i of(c(!0),n)){let n=t+i.length;if(e.slice(t,n)===i)return t=n,!0}return!1}(n)){if((0,i("iIblK").isFunctionNameCharStart)(e[t]))for(;t<e.length&&(0,i("iIblK").isFunctionNameChar)(e[t]);)t++;return l(),!0}return!1}function p(n){return e[t]===n&&(r+=e[t],t++,!0)}function u(n){return e[t]===n&&(t++,!0)}function g(){return l(),"."===e[t]&&"."===e[t+1]&&"."===e[t+2]&&(t+=3,l(),u(","),!0)}function m(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,c="\\"===e[t];if(c&&(t++,c=!0),(0,i("iIblK").isQuote)(e[t])){let d=(0,i("iIblK").isDoubleQuote)(e[t])?i("iIblK").isDoubleQuote:(0,i("iIblK").isSingleQuote)(e[t])?i("iIblK").isSingleQuote:(0,i("iIblK").isSingleQuoteLike)(e[t])?i("iIblK").isSingleQuoteLike:i("iIblK").isDoubleQuoteLike,p=t,g=r.length,h='"';for(t++;;){if(t>=e.length){let n=y(t-1);if(!o&&(0,i("iIblK").isDelimiter)(e.charAt(n)))return t=p,r=r.substring(0,g),m(!0);return h=(0,i("iIblK").insertBeforeLastWhitespace)(h,'"'),r+=h,!0}if(t===s)return h=(0,i("iIblK").insertBeforeLastWhitespace)(h,'"'),r+=h,!0;if(d(e[t])){let n=t,a=h.length;if(h+='"',t++,r+=h,l(!1),o||t>=e.length||(0,i("iIblK").isDelimiter)(e[t])||(0,i("iIblK").isQuote)(e[t])||(0,i("iIblK").isDigit)(e[t]))return f(),!0;let s=y(n-1),c=e.charAt(s);if(","===c)return t=p,r=r.substring(0,g),m(!1,s);if((0,i("iIblK").isDelimiter)(c))return t=p,r=r.substring(0,g),m(!0);r=r.substring(0,g),t=n+1,h=`${h.substring(0,a)}\\${h.substring(a)}`}else if(o&&(0,i("iIblK").isUnquotedStringDelimiter)(e[t])){if(":"===e[t-1]&&i("iIblK").regexUrlStart.test(e.substring(p+1,t+2)))for(;t<e.length&&i("iIblK").regexUrlChar.test(e[t]);)h+=e[t],t++;return h=(0,i("iIblK").insertBeforeLastWhitespace)(h,'"'),r+=h,f(),!0}else if("\\"===e[t]){let n=e.charAt(t+1);if(void 0!==a[n])h+=e.slice(t,t+2),t+=2;else if("u"===n){let n=2;for(;n<6&&(0,i("iIblK").isHex)(e[t+n]);)n++;6===n?(h+=e.slice(t,t+6),t+=6):t+n>=e.length?t=e.length:function(){let n=e.slice(t,t+6);throw new(0,i("k97go").JSONRepairError)(`Invalid unicode character "${n}"`,t)}()}else h+=n,t+=2}else{let a=e.charAt(t);'"'===a&&"\\"!==e[t-1]?h+=`\\${a}`:(0,i("iIblK").isControlCharacter)(a)?h+=n[a]:((0,i("iIblK").isValidStringCharacter)(a)||function(e){throw new(0,i("k97go").JSONRepairError)(`Invalid character ${JSON.stringify(e)}`,t)}(a),h+=a),t++}c&&u("\\")}}return!1}function f(){let n=!1;for(l();"+"===e[t];){n=!0,t++,l();let e=(r=(0,i("iIblK").stripLastOccurrence)(r,'"',!0)).length;r=m()?(0,i("iIblK").removeAtIndex)(r,e,1):(0,i("iIblK").insertBeforeLastWhitespace)(r,'"')}return n}function h(n,i){return e.slice(t,t+n.length)===n&&(r+=i,t+=n.length,!0)}function _(n){let a=t;if((0,i("iIblK").isFunctionNameCharStart)(e[t])){for(;t<e.length&&(0,i("iIblK").isFunctionNameChar)(e[t]);)t++;let n=t;for(;(0,i("iIblK").isWhitespace)(e,n);)n++;if("("===e[n])return t=n+1,s(),")"===e[t]&&";"===e[++t]&&t++,!0}for(;t<e.length&&!(0,i("iIblK").isUnquotedStringDelimiter)(e[t])&&!(0,i("iIblK").isQuote)(e[t])&&(!n||":"!==e[t]);)t++;if(":"===e[t-1]&&i("iIblK").regexUrlStart.test(e.substring(a,t+2)))for(;t<e.length&&i("iIblK").regexUrlChar.test(e[t]);)t++;if(t>a){for(;(0,i("iIblK").isWhitespace)(e,t-1)&&t>0;)t--;let n=e.slice(a,t);return r+="undefined"===n?"null":JSON.stringify(n),'"'===e[t]&&t++,!0}}function y(t){let n=t;for(;n>0&&(0,i("iIblK").isWhitespace)(e,n);)n--;return n}function I(){return t>=e.length||(0,i("iIblK").isDelimiter)(e[t])||(0,i("iIblK").isWhitespace)(e,t)}function E(n){r+=`${e.slice(n,t)}0`}function S(){throw new(0,i("k97go").JSONRepairError)("Colon expected",t)}}}),a("cbRqO",function(e,t){let n=["```json","<adf_input>"],i=["```","</adf_input>"];e.exports.sanitizeStreamContentForADFStreamer=function(e){return n.forEach(t=>{e.startsWith(t)&&(e=e.replace(t,""))}),i.forEach(t=>{e.endsWith(t)&&(e=e.replace(t,""))}),e}}),a("8pB0g",function(e,t){function n(e,t,n){if("enum"===e.type&&e.values&&e.values.length>0)return e.values[0];if("number"===e.type)return e.minimum??0;if("string"===e.type){if(e.validatorFn)return null;if(e.pattern)return"^#[0-9a-fA-F]{6}$"===e.pattern?"textColor"===n?"#172B4D":"backgroundColor"===n?"#DCDFE4":"#000000":"^#[0-9a-fA-F]{8}$|^#[0-9a-fA-F]{6}$"===e.pattern?"#091E4224":"timestamp"===t?new Date().getTime().toString():"shortName"===t?":smile:":null;return e.minLength&&e.minLength>0?"a".repeat(e.minLength):null}return"boolean"!==e.type&&("array"===e.type?e.minItems&&e.minItems>0?null:[]:null)}e.exports.generateDefaultValueForAttribute=n,e.exports.validateAndRepairAttributeValue=function(e,t,i,a){if("string"===i.type){if(i.pattern){if(!RegExp(i.pattern,"u").test(t)&&!i.optional){let t=n(i,e,a);return null===t?{isValid:!1,error:`Attribute '${e}' does not match required pattern`}:{isValid:!0,repairedValue:t}}return{isValid:!0,repairedValue:t}}let r="string"==typeof t||"number"==typeof t?t.toString():void 0;if(r&&(!i.minLength||r.length>i.minLength))return{isValid:!0,repairedValue:r};if(!i.optional){let t=n(i,e,a);if(null!==t)return{isValid:!0,repairedValue:t}}return{isValid:!1,error:`Attribute '${e}' has invalid value and can't be repaired`}}if("number"===i.type){let n="number"==typeof t?t:parseInt(t);return void 0!==i.minimum&&(isNaN(n)||n<i.minimum)?{isValid:!0,repairedValue:i.minimum}:void 0!==i.maximum&&(isNaN(n)||n>i.maximum)?{isValid:!0,repairedValue:i.maximum}:isNaN(n)?"layoutColumn"===a&&"width"===e?{isValid:!0,repairedValue:20}:{isValid:!1,error:`Failed to repair attribute '${e}'`}:{isValid:!0,repairedValue:n}}if("boolean"===i.type){if("boolean"==typeof t)return{isValid:!0,repairedValue:t};if("string"==typeof t){if("true".includes(t))return{isValid:!0,repairedValue:!0};if("false".includes(t))return{isValid:!0,repairedValue:!1}}return{isValid:!1,error:`Attribute '${e}' has invalid boolean value '${t}'`}}if("enum"===i.type&&i.values){if(i.values.includes(t))return{isValid:!0,repairedValue:t};{let e=i.values.filter(e=>e.startsWith(t));return e.length>0?{isValid:!0,repairedValue:e[0]}:{isValid:!0,repairedValue:i.values.includes("default")?"default":i.values[0]}}}if("array"===i.type){if(!Array.isArray(t))return{isValid:!1,error:`Attribute '${e}' must be an array`};let n=i.items?.[0]?.type;if(t.some(e=>typeof e!==n))return{isValid:!1,error:`Attribute '${e}' must have items of type ${n}`};if(void 0!==i.minItems&&t.length<i.minItems)return{isValid:!1,error:`Attribute '${e}' must have at least ${i.minItems} items`}}return"object"===i.type&&"object"!=typeof t?{isValid:!1,error:`Attribute '${e}' must be an object`}:{isValid:!0,repairedValue:t}}}),a("4sRZs",function(e,t){let n=i("4rpi6").blockCard,a=i("4rpi6").inlineCard,r=i("4rpi6").media,o={alignment:i("4rpi6").alignment,annotation:i("4rpi6").annotation,backgroundColor:i("4rpi6").backgroundColor,blockCard:n,block_content:i("4rpi6").block_content,blockRootOnly:i("4rpi6").blockRootOnly,blockquote:i("4rpi6").blockquote,blockTaskItem:i("4rpi6").blockTaskItem,bodiedExtension:i("4rpi6").bodiedExtension,bodiedExtension_with_marks:i("4rpi6").bodiedExtension_with_marks,border:i("4rpi6").border,breakout:i("4rpi6").breakout,bulletList:i("4rpi6").bulletList,caption:i("4rpi6").caption,code:i("4rpi6").code,codeBlock:i("4rpi6").codeBlock,codeBlock_root_only:i("4rpi6").codeBlock_root_only,text_with_no_marks:i("4rpi6").text_with_no_marks,confluenceInlineComment:i("4rpi6").confluenceInlineComment,dataConsumer:i("4rpi6").dataConsumer,date:i("4rpi6").date,decisionItem:i("4rpi6").decisionItem,decisionList:i("4rpi6").decisionList,doc:i("4rpi6").doc,em:i("4rpi6").em,embedCard:i("4rpi6").embedCard,emoji:i("4rpi6").emoji,expand:i("4rpi6").expand,expand_root_only:i("4rpi6").expand_root_only,extension:i("4rpi6").extension,extensionFrame:i("4rpi6").extensionFrame,extension_with_marks:i("4rpi6").extension_with_marks,fragment:i("4rpi6").fragment,hardBreak:i("4rpi6").hardBreak,heading:i("4rpi6").heading,heading_with_alignment:i("4rpi6").heading_with_alignment,heading_with_indentation:i("4rpi6").heading_with_indentation,heading_with_no_marks:i("4rpi6").heading_with_no_marks,indentation:i("4rpi6").indentation,inlineCard:a,inlineExtension:i("4rpi6").inlineExtension,inlineExtension_with_marks:i("4rpi6").inlineExtension_with_marks,inline_content:i("4rpi6").inline_content,layoutColumn:i("4rpi6").layoutColumn,layoutSection:i("4rpi6").layoutSection,layoutSection_full:i("4rpi6").layoutSection_full,layoutSection_with_single_column:i("4rpi6").layoutSection_with_single_column,link:i("4rpi6").link,listItem:i("4rpi6").listItem,media:r,mediaGroup:i("4rpi6").mediaGroup,mediaInline:i("4rpi6").mediaInline,mediaSingle:i("4rpi6").mediaSingle,mediaSingle_caption:i("4rpi6").mediaSingle_caption,mediaSingle_full:i("4rpi6").mediaSingle_full,mention:i("4rpi6").mention,multiBodiedExtension:i("4rpi6").multiBodiedExtension,nestedExpand:i("4rpi6").nestedExpand,nestedExpand_with_no_marks:i("4rpi6").nestedExpand_with_no_marks,non_nestable_block_content:i("4rpi6").non_nestable_block_content,orderedList:i("4rpi6").orderedList,panel:i("4rpi6").panel,paragraph:i("4rpi6").paragraph,paragraph_with_alignment:i("4rpi6").paragraph_with_alignment,paragraph_with_indentation:i("4rpi6").paragraph_with_indentation,paragraph_with_no_marks:i("4rpi6").paragraph_with_no_marks,placeholder:i("4rpi6").placeholder,rule:i("4rpi6").rule,status:i("4rpi6").status,strike:i("4rpi6").strike,strong:i("4rpi6").strong,subsup:i("4rpi6").subsup,table:i("4rpi6").table,tableCell:i("4rpi6").tableCell,tableHeader:i("4rpi6").tableHeader,tableRow:i("4rpi6").tableRow,taskItem:i("4rpi6").taskItem,taskList:i("4rpi6").taskList,text:i("4rpi6").text,textColor:i("4rpi6").textColor,text_code_inline:i("4rpi6").text_code_inline,text_formatted:i("4rpi6").text_formatted,text_link_inline:i("4rpi6").text_link_inline,underline:i("4rpi6").underline};e.exports.allSpecs=o}),a("auD3v",function(e,t){let n=e=>{let t=new Date().getTime().toString();if(!e)return t;if("string"!=typeof e)return e;if(e.includes("-")){let n=new Date(e).getTime();return isNaN(n)?t:n.toString()}return e.match(/^\d+$/)?e:t};e.exports.toSupportedDate=({attrs:e={},...t})=>({...t,attrs:{...e,timestamp:n(e.timestamp)}})}),a("gbta9",function(e,t){e.exports.toSupportedPanel=e=>e.attrs?.panelType==="tip"&&(0,i("dh538").fg)("platform_editor_convert_tip_to_info")?{...e,attrs:{...e.attrs,panelType:"info"}}:e}),a("k97go",function(e,t){e.exports.JSONRepairError=class extends Error{constructor(e,t){super(`${e} at position ${t}`),this.position=t}}}),a("iIblK",function(e,t){let n=/^[[{\w-]$/;function i(e,t){let n=e.charCodeAt(t);return 32===n||10===n||9===n||13===n}function a(e){return r(e)||o(e)}function r(e){return'"'===e||"“"===e||"”"===e}function o(e){return"'"===e||"‘"===e||"’"===e||"`"===e||"´"===e}e.exports.isHex=function(e){return/^[0-9A-Fa-f]$/.test(e)},e.exports.isDigit=function(e){return e>="0"&&e<="9"},e.exports.isValidStringCharacter=function(e){return e>=" "},e.exports.isDelimiter=function(e){return",:[]/{}()\n+".includes(e)},e.exports.isFunctionNameCharStart=function(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||"_"===e||"$"===e},e.exports.isFunctionNameChar=function(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||"_"===e||"$"===e||e>="0"&&e<="9"},e.exports.regexUrlStart=/^(http|https|ftp|mailto|file|data|irc):\/\/$/,e.exports.regexUrlChar=/^[A-Za-z0-9-._~:/?#@!$&'()*+;=]$/,e.exports.isUnquotedStringDelimiter=function(e){return",[]/{}\n+".includes(e)},e.exports.isStartOfValue=function(e){return a(e)||n.test(e)},e.exports.isQuote=a,e.exports.isControlCharacter=function(e){return"\n"===e||"\r"===e||"	"===e||"\b"===e||"\f"===e},e.exports.isWhitespace=i,e.exports.isWhitespaceExceptNewline=function(e,t){let n=e.charCodeAt(t);return 32===n||9===n||13===n},e.exports.isSpecialWhitespace=function(e,t){let n=e.charCodeAt(t);return 160===n||n>=8192&&n<=8202||8239===n||8287===n||12288===n},e.exports.isDoubleQuoteLike=r,e.exports.isSingleQuoteLike=o,e.exports.isDoubleQuote=function(e){return'"'===e},e.exports.isSingleQuote=function(e){return"'"===e},e.exports.stripLastOccurrence=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.lastIndexOf(t);return -1!==i?e.substring(0,i)+(n?"":e.substring(i+1)):e},e.exports.insertBeforeLastWhitespace=function(e,t){let n=e.length;if(!i(e,n-1))return e+t;for(;i(e,n-1);)n--;return e.substring(0,n)+t+e.substring(n)},e.exports.removeAtIndex=function(e,t,n){return e.substring(0,t)+e.substring(t+n)},e.exports.endsWithCommaOrNewline=function(e){return/[,\n][ \t\r]*$/.test(e)}});
//# sourceMappingURL=FullPageEditorComponent.f63e341e.js.map
