function e(e){return e&&e.__esModule?e.default:e}var t=globalThis.parcelRequired477,i=t.register;i("hnH0O",function(i,a){var n=t("42omo"),s=t("T1bCI"),r=t("b3j2Y");let o=(0,t("jmjWc").LoadableAfterPaint)({__loadable_id__:"a3_wy",name:"SatisfactionSurveyFlag",loader:async()=>(await t("6SwkJ")).SatisfactionSurveyFlag}),u=(0,t("cgtv4").defineMessages)({superAdminSatisfactionSurveyTitle:{id:"super-admin.satisfaction.survey.title",defaultMessage:"How was your admin key experience?"},superAdminSatisfactionSurveyFinalTitle:{id:"super-admin.satisfaction.survey.final.title",defaultMessage:"Thank you"},superAdminSatisfactionSurveyFinalDescription:{id:"super-admin.satisfaction.survey.final.description",defaultMessage:"Your feedback has been submitted"},superAdminSatisfactionSurveyReactionTerrible:{id:"super-admin.satisfaction.survey.reaction.terrible",defaultMessage:"Terrible"},superAdminSatisfactionSurveyReactionBad:{id:"super-admin.satisfaction.survey.reaction.bad",defaultMessage:"Bad"},superAdminSatisfactionSurveyReactionOkay:{id:"super-admin.satisfaction.survey.reaction.okay",defaultMessage:"Okay"},superAdminSatisfactionSurveyReactionGreat:{id:"super-admin.satisfaction.survey.reaction.great",defaultMessage:"Great"},superAdminSatisfactionSurveyReactionAmazing:{id:"super-admin.satisfaction.survey.reaction.amazing",defaultMessage:"Amazing"},superAdminSatisfactionSurveyQuestionBad:{id:"super-admin.satisfaction.survey.question.bad",defaultMessage:"We’re sorry to hear that. What went wrong? (optional)"},superAdminSatisfactionSurveyQuestionGood:{id:"super-admin.satisfaction.survey.question.good",defaultMessage:"Thanks! What did you like about it? What could be improved? (optional)"},superAdminSatisfactionSurveyButtonSubmit:{id:"super-admin.satisfaction.survey.button.submit",defaultMessage:"Submit"},superAdminSatisfactionSurveyButtonClose:{id:"super-admin.satisfaction.survey.button.close",defaultMessage:"Close"}});class l extends n.Component{render(){let{eventSent:t}=this.state;return this.initializeText(),e(n).createElement(o,{size:"medium",title:this.title,description:"",finalTitle:this.finalTitle,finalDescription:this.finalDescription,reactionTitles:this.reactionTitles,formQuestions:this.formQuestions,submitButtonText:this.submitButtonText,closeButtonText:this.closeButtonText,onInteraction:this.handleInteraction,isOnFinalStage:t,autoHideTime:-1,autoHideFinalTime:2e3})}constructor(...e){super(...e),this.state={eventSent:!1},this.initializeText=()=>{if(!this.formQuestions){let{intl:e}=this.props;this.title=e.formatMessage(u.superAdminSatisfactionSurveyTitle),this.finalTitle=e.formatMessage(u.superAdminSatisfactionSurveyFinalTitle),this.finalDescription=e.formatMessage(u.superAdminSatisfactionSurveyFinalDescription),this.submitButtonText=e.formatMessage(u.superAdminSatisfactionSurveyButtonSubmit),this.closeButtonText=e.formatMessage(u.superAdminSatisfactionSurveyButtonClose),this.reactionTitles=[e.formatMessage(u.superAdminSatisfactionSurveyReactionTerrible),e.formatMessage(u.superAdminSatisfactionSurveyReactionBad),e.formatMessage(u.superAdminSatisfactionSurveyReactionOkay),e.formatMessage(u.superAdminSatisfactionSurveyReactionGreat),e.formatMessage(u.superAdminSatisfactionSurveyReactionAmazing)];let t=e.formatMessage(u.superAdminSatisfactionSurveyQuestionBad),i=e.formatMessage(u.superAdminSatisfactionSurveyQuestionGood);this.formQuestions=[t,t,i,i,i]}},this.fireAnalyticsEvent=({reaction:e=null,feedback:i="",submitted:a=!1})=>{let{createAnalyticsEvent:n}=this.props,s=a&&e?e.value:0;i=a?i:"",n({type:"sendTrackEvent",data:{action:"submitted",actionSubject:"adminKeyFeedbackSurvey",attributes:{reaction:s,feedback:(0,t("ajdQJ").dangerouslyCreateSafeString)(i)},source:"adminKeyCsatSurvey"}}).fire()},this.markUserAsSubmitted=()=>{t("17wUi").confluenceLocalStorageInstance.setItem(t("1UApO").keys.SUPERADMIN_SURVEY_SUBMITTED,"true",259200)},this.handleInteraction=async e=>{let{onDone:t}=this.props,{eventSent:i}=this.state;i||(this.fireAnalyticsEvent(e),e.submitted&&this.markUserAsSubmitted(),await this.setState({eventSent:!0})),e.dismissed&&t()}}}l.propTypes={intl:e(t("4xcIM")).object.isRequired,createAnalyticsEvent:e(t("4xcIM")).func.isRequired,onDone:e(t("4xcIM")).func.isRequired};let c=(0,t("1DWH0").default)()((0,t("gmMgo").default)(l)),d=(0,t("eSUdr").default)`mutation DisableSuperAdmin{disableSuperAdmin{user{id confluence{roles{isSuperAdmin}}}}}`,m=(0,t("cgtv4").defineMessages)({disableSuperAdminErrorTitle:{id:"super-admin.disable.super.admin.error.title",defaultMessage:"Something went wrong"},disableSuperAdminErrorDescription:{id:"super-admin.disable.super.admin.error.description-with-link",defaultMessage:"If this keeps happening, let us know at {atlassianSupportLink}"}}),p=({handleMutationCompleteCallback:i,handleMutationErrorCallback:a,children:r})=>{let o=(0,t("8C5kA").default)(),u=e=>a=>{a?.disableSuperAdmin?.user?.confluence?.roles?.isSuperAdmin?l(e)():((0,t("6jrkJ").removeSuperAdminClaim)(),(0,t("5sbfe").removeAKTimeout)(),i(),window.location.reload())},l=i=>()=>{i.showErrorFlag({title:o.formatMessage(m.disableSuperAdminErrorTitle),description:o.formatMessage(m.disableSuperAdminErrorDescription,{atlassianSupportLink:e(n).createElement(t("cqmCC").AtlassianSupportLink,{showHostname:!0})})}),a()};return e(n).createElement(s.Subscribe,{to:[t("gqqjz").FlagsStateContainer]},i=>e(n).createElement(t("30qWc").MutationInterop,{mutation:d,onCompleted:u(i),onError:l(i)},e=>r(e,i)))},f=({initialCountdown:i})=>{let[a,s]=(0,n.useState)(i),[r,o]=(0,n.useState)(null),u=(0,n.useRef)(()=>{}),l=()=>{if(i>0){let e=setInterval(()=>u.current(),1e3);return o(e),e}return null},c=e=>{e&&clearInterval(e)};return u.current=()=>{a>0?s(a-1):c(r)},(0,n.useEffect)(()=>{let e=l();return()=>{c(e)}},[]),e(n).createElement(t("gtD4K").default,{id:"super-admin.timeout.super.admin.description.counter",defaultMessage:"{count, plural, =0 {0 seconds} one {1 second} other {# seconds}}",values:{count:a}})},S=(0,t("cgtv4").defineMessages)({timeoutSuperAdminTitle:{id:"super-admin.timeout.super.admin.title",defaultMessage:"Still there?"},superAdminTimerFlagAction:{id:"super-admin.timer.flag.action",defaultMessage:"Keep using admin key"}}),g=(0,n.forwardRef)(({as:i="div",style:a,...s},r)=>e(n).createElement(i,{...s,style:a,ref:r,className:(0,t("gMc0m").default)(["_k48pmoej _1e0c1nu9",s.className])})),A=({flags:i,disableSuperAdminTrigger:a})=>{let[s,r]=(0,n.useState)(),o=(0,n.useRef)();o.current=s;let u=(0,t("8C5kA").default)(),{createAnalyticsEvent:l}=(0,t("inPa6").useAnalyticsEvents)(),c=e=>{setTimeout(e,1e3)},d=e=>{i.showWarningFlag({title:u.formatMessage(S.timeoutSuperAdminTitle),description:p(e),actions:[{content:u.formatMessage(S.superAdminTimerFlagAction),onClick:A()}]}).then(e=>r(e.id))},m=()=>{void 0!==o.current&&i.hideFlag(o.current)},p=i=>e(n).createElement("div",{"data-testid":"super-admin.timeout.flag.description"},e(n).createElement(t("gtD4K").default,{id:"super-admin.timeout.super.admin.description",defaultMessage:"Due to inactivity, you will be signed out in {counter}.",values:{counter:e(n).createElement(g,null,e(n).createElement(f,{initialCountdown:(0,t("5sbfe").getSecondsBetweenNowAndTime)(i)}))}})),A=()=>()=>{(0,t("5sbfe").refreshAKTimeout)(),y(),m()},y=()=>{l({type:"sendTrackEvent",data:{source:"superAdminExpiration",action:"extended",actionSubject:"adminKeySession"}}).fire()},E=e=>{(0,t("5sbfe").foldTimeout)((0,t("5sbfe").getAKTimeout)())({beforeNotify:()=>c(()=>{e&&m(),E(!1)}),afterNotify:t=>c(()=>{e||d(t),E(!0)}),afterExpiry:()=>a(),noTimeout:()=>{}})};return(0,n.useEffect)(()=>{E(!1)},[a]),null},y=(0,t("cgtv4").defineMessages)({sessionExpirationTitle:{id:"super-admin.session.expiration.title",defaultMessage:"Access to restricted content has ended"},sessionExpirationDescription:{id:"super-admin.session.expiration.description",defaultMessage:"You’ve been inactive for a while. To keep things secure, we’ve ended your access to restricted content."}}),E=({flags:e})=>{let i=(0,t("8C5kA").default)();return(0,n.useEffect)(()=>{t("17wUi").confluenceLocalStorageInstance.getAndRemoveItem(t("1UApO").keys.SUPERADMIN_SESSION_EXPIRED)&&e.showInfoFlag({title:i.formatMessage(y.sessionExpirationTitle),description:i.formatMessage(y.sessionExpirationDescription)})},[e,i]),null};class h extends n.Component{constructor(...i){super(...i),this.fireAdminKeyExpiredAnalyticsEvent=()=>{this.props.createAnalyticsEvent({type:"sendTrackEvent",data:{source:"superAdminExpiration",action:"expired",actionSubject:"adminKeySession"}}).fire()},this.deleteStoredRestrictedPage=()=>t("17wUi").confluenceLocalStorageInstance.removeItem(t("1UApO").keys.RESTRICTED_PAGE_CONFIRMED),this.fireAdminKeyExpiryFailedAnalyticsEvent=()=>this.props.createAnalyticsEvent({type:"sendTrackEvent",data:{action:"failed",actionSubject:"exitAdminKeySession",source:"superAdminExpiration"}}).fire(),this.setAKSessionExpired=()=>t("17wUi").confluenceLocalStorageInstance.setItem(t("1UApO").keys.SUPERADMIN_SESSION_EXPIRED,!0,(0,t("5sbfe").addSecondsToDate)(new Date,10).getTime()),this.render=()=>e(n).createElement(p,{handleMutationCompleteCallback:()=>{this.fireAdminKeyExpiredAnalyticsEvent(),this.deleteStoredRestrictedPage(),this.setAKSessionExpired()},handleMutationErrorCallback:()=>(this.fireAdminKeyExpiryFailedAnalyticsEvent(),Promise.resolve())},(t,i)=>e(n).createElement(n.Fragment,null,e(n).createElement(A,{flags:i,disableSuperAdminTrigger:t}),e(n).createElement(E,{flags:i})))}}h.propTypes={createAnalyticsEvent:e(t("4xcIM")).func.isRequired};let v=(0,t("1DWH0").default)()(h),b="SuperAdminBanner",T=(0,t("ecnYn").xcss)({width:"100%"}),M=(0,n.forwardRef)(({as:i="div",style:a,...s},r)=>e(n).createElement(i,{...s,style:a,ref:r,className:(0,t("gMc0m").default)(["_11c82smr _1yt4utpp _1bsb1osq _1e0c1txw _4cvr1h6o _4t3i1f4h _bfhk1kmu _syaz1yd3",s.className])})),k=(0,n.forwardRef)(({as:i="span",style:a,...s},r)=>e(n).createElement(i,{...s,style:a,ref:r,className:(0,t("gMc0m").default)(["_1yt41b66",s.className])})),I=(0,n.forwardRef)(({as:i="a",style:a,...s},r)=>e(n).createElement(i,{...s,style:a,ref:r,className:(0,t("gMc0m").default)(["_4bfu1r31 _1hms8stv _ajmmnqa1 _syaz1kw7 _80omtlke _k48pi7a9 _18u01b66",s.className])})),_=e(n).createElement(e(t("ebrpi")),{label:"Warning icon",spacing:"spacious",color:"var(--ds-icon-warning-inverse, #292A2E)"}),w=({bannerState:i})=>{let[a,s]=(0,n.useState)(!1),[o,u]=(0,n.useState)(52),{createAnalyticsEvent:l}=(0,t("inPa6").useAnalyticsEvents)(),d=(0,t("luv00").useSSRPlaceholderReplaceIdProp)();(0,n.useEffect)(()=>{t("17wUi").confluenceLocalStorageInstance.getItemAsBoolean(t("1UApO").keys.SUPERADMIN_SURVEY_REQUESTED)&&s(!0)},[]);let m=e=>{!t("17wUi").confluenceLocalStorageInstance.getItemAsBoolean(t("1UApO").keys.SUPERADMIN_SURVEY_SUBMITTED)&&(t("17wUi").confluenceLocalStorageInstance.setItem(t("1UApO").keys.SUPERADMIN_SURVEY_REQUESTED,"true"),e&&s(!0))},f=(0,n.useCallback)(()=>l({type:"sendUIEvent",data:{action:"clicked",actionSubject:"link",actionSubjectId:"adminKeyExit",source:"superAdminBanner"}}).fire(),[l]),S=(0,n.useCallback)(()=>l({type:"sendTrackEvent",data:{action:"failed",actionSubject:"exitAdminKeySession",source:"superAdminBanner"}}).fire(),[l]),g=()=>t("17wUi").confluenceLocalStorageInstance.removeItem(t("1UApO").keys.RESTRICTED_PAGE_CONFIRMED),A=(0,n.useCallback)(()=>{m(!1),g(),f()},[f]),y=()=>{Promise.resolve(S())},E=()=>{let a={role:"alert"};return 52!==i.getTotalHeight()&&(u(52),i.show(b,o),(0,t("cbc8g").addUFOCustomData)({isSuperAdminBannerDisplayed:!0})),e(n).createElement(p,{handleMutationCompleteCallback:A,handleMutationErrorCallback:y},i=>e(n).createElement(t("6f0Oj").default,{xcss:T,"data-vc":"super-admin-banner",...d},e(n).createElement(M,a,_,e(n).createElement(k,null,e(n).createElement(t("gtD4K").default,{id:"super-admin.banner.message",defaultMessage:"You’re using admin key, which gives you temporary access to restricted content."}),e(n).createElement(I,{onClick:i},e(n).createElement(t("gtD4K").default,{id:"super-admin.banner.exit",defaultMessage:"Stop using admin key"}))))))},h=()=>(i.hide(b),null),w=(t,i,a)=>i?e(n).createElement(r.ErrorDisplay,{error:i}):t?null:a?E():h();return e(n).createElement(e(n).Fragment,null,(0,t("6jrkJ").getSuperAdminClaim)()&&e(n).createElement(t("lfFzM").AdminKeyQuery,null,({loading:e,error:t,isSuperAdmin:i})=>w(e,t,i)),a&&e(n).createElement(c,{onDone:()=>{t("17wUi").confluenceLocalStorageInstance.removeItem(t("1UApO").keys.SUPERADMIN_SURVEY_REQUESTED),s(!1)}}),e(n).createElement(v,null))};i.exports.Banner=M,i.exports.SuperAdminBannerComponent=w,i.exports.SuperAdminBanner=()=>e(n).createElement(s.Subscribe,{to:[t("hrAmX").BannerStateContainer]},t=>e(n).createElement(w,{bannerState:t}))}),i("lfFzM",function(i,a){let n=()=>{let e=(0,t("6jrkJ").getSuperAdminClaim)(),{loading:i,error:a,data:n}=(0,t("xQxzY").useQuery)(t("kOBmw").IsSuperAdmin,{skip:!e});return e?{loading:i,error:a,isSuperAdmin:!!n?.user?.confluence?.roles?.isSuperAdmin}:{loading:!1,isSuperAdmin:!1}},s=({children:e})=>{let{isSuperAdmin:t,loading:i,error:a}=n();return e({loading:i,error:a,isSuperAdmin:t})};s.propTypes={children:e(t("4xcIM")).func.isRequired},i.exports.useIsSuperAdmin=n,i.exports.AdminKeyQuery=s}),i("kOBmw",function(e,i){let a=(0,t("eSUdr").default)`query IsSuperAdminQuery{user:confluence_atlassianUser(current:true){id confluence{roles{isSuperAdmin}}}}`;e.exports.IsSuperAdmin=a}),i("ajdQJ",function(e,t){class i{constructor(e){this.value=e,this.valueOf=this.toString=this.toJSON=()=>this.value}}e.exports.dangerouslyCreateSafeString=e=>new i(e),e.exports.markAsSafe=(...e)=>t=>e.includes(t)?Object.freeze(new i(t)):t}),i("6SwkJ",function(e,i){let a=t("4mJKd")(5);e.exports=Promise.all([a("f8xBv"),a("kHOMt"),a("hhss7"),a("jE5XU")]).then(()=>t("alFtm"))}),i("30qWc",function(e,i){e.exports.MutationInterop=function({children:e,mutation:i,...a}){let[n,s]=(0,t("308Wd").useMutationInterop)(i,a);return e(n,s)}}),i("cqmCC",function(i,a){var n=t("3u0dr"),s=t("frIzR"),r=t("jiJCD"),o=t("42omo");let u="https://support.atlassian.com/contact/#/",l=i=>i?(0,r.parse)(u).hostname:e(o).createElement(t("gtD4K").default,{id:"error-boundary.description.support-link",defaultMessage:"Atlassian Support"}),c=(0,n.isReactCompilerActiveV1)()?i=>{let a,n=(0,s.c)(3),{showHostname:r,children:c}=i;return n[0]!==c||n[1]!==r?(a=(0,t("9wGTI").fg)("dst-a11y__replace-anchor-with-link__enterprise-exp")?e(o).createElement(t("2Nwuj").default,{href:u,target:"_blank"},e(o).Children.count(c)?c:l(r)):e(o).createElement("a",{href:u,target:"_blank"},e(o).Children.count(c)?c:l(r)),n[0]=c,n[1]=r,n[2]=a):a=n[2],a}:({showHostname:i,children:a})=>(0,t("9wGTI").fg)("dst-a11y__replace-anchor-with-link__enterprise-exp")?e(o).createElement(t("2Nwuj").default,{href:u,target:"_blank"},e(o).Children.count(a)?a:l(i)):e(o).createElement("a",{href:u,target:"_blank"},e(o).Children.count(a)?a:l(i));i.exports.ATLASSIAN_SUPPORT_URL=u,i.exports.AtlassianSupportLink=c}),i("5sbfe",function(e,i){let a=(0,t("7W8i8").getLogger)("super-admin"),n=e=>Math.round((e-new Date().getTime())/1e3),s=e=>60*e,r=(e,t)=>o(e,s(t)),o=(e,t)=>new Date(e.getTime()+1e3*t),u=e=>{try{t("17wUi").confluenceLocalStorageInstance.setItem(t("1UApO").keys.SUPER_ADMIN_TIMEOUT,e.toString())}catch(i){a.error`Unable to set local storage. key = "${t("1UApO").keys.SUPER_ADMIN_TIMEOUT}", value = "${e}"`}};e.exports.getSecondsBetweenNowAndTime=n,e.exports.addSecondsToDate=o,e.exports.foldTimeout=e=>({beforeNotify:t,afterNotify:i,afterExpiry:a,noTimeout:s})=>{if(!e)return s();{let s=n(e);return s>0?s<=60?i(e):t(e):a(e)}},e.exports.getAKTimeout=()=>{let e=t("17wUi").confluenceLocalStorageInstance.getItem(t("1UApO").keys.SUPER_ADMIN_TIMEOUT);return e?parseInt(e):0},e.exports.removeAKTimeout=()=>{t("17wUi").confluenceLocalStorageInstance.removeItem(t("1UApO").keys.SUPER_ADMIN_TIMEOUT)},e.exports.refreshAKTimeout=()=>{u(r(new Date,10).getTime())}});
//# sourceMappingURL=SuperAdminBanner.e888429f.js.map
