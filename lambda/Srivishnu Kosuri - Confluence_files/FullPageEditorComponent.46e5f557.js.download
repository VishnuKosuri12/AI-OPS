function e(e){return e&&e.__esModule?e.default:e}function t(e,t,n,o){Object.defineProperty(e,t,{get:n,set:o,enumerable:!0,configurable:!0})}var n=globalThis.parcelRequired477,o=n.register;o("fIKxq",function(t,o){var a=n("3u0dr"),r=n("frIzR"),s=n("42omo"),m=n("gIaMn");let d=(0,n("jmjWc").LoadableAfterPaint)({__loadable_id__:"cFlY8",name:"EndOfPageRecommendationLoader",loader:async()=>(await n("leITG")).EndOfPageRecommendation}),i=(0,n("jmjWc").LoadableActivatable)({__loadable_id__:"nhVSK",name:"EndOfPageRecommendationLoaderWithScrollIntoView",loader:async()=>(await n("leITG")).EndOfPageRecommendation,triggers:[{type:m.ActivationTriggerType.SCROLL_INTO_VIEW}],ssrSuccessCheckName:n("5Abqh").SSR_PARTIAL_COMPONENT.EndOfPageRecommendation}),c=(0,a.isReactCompilerActiveV1)()?t=>{let o,a=(0,r.c)(2);return a[0]!==t?(o=e(s).createElement(s.Fragment,null,(0,n("6mKj3").expVal)("confluence_selective_hydrate_eop_recommendations","isEnabled",!1)?e(s).createElement(i,t):e(s).createElement(d,t)),a[0]=t,a[1]=o):o=a[1],o}:t=>e(s).createElement(s.Fragment,null,(0,n("6mKj3").expVal)("confluence_selective_hydrate_eop_recommendations","isEnabled",!1)?e(s).createElement(i,t):e(s).createElement(d,t));t.exports.EndOfPageRecommendationLoader=d,t.exports.EndOfPageRecommendationFinalLoader=c}),o("leITG",function(e,t){let o=n("4mJKd")(5);e.exports=Promise.all([o("blWD9"),o("cxJEE"),o("49jWi"),o("19uFC"),o("hhss7"),o("iV6RN")]).then(()=>n("kPKkS"))}),o("4mJKd",function(e,t){e.exports=e=>t=>import(n("8tirZ").shardUrl(n("02nRr").resolve(t),e))}),o("8tirZ",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.applyShardToDomain=s,e.exports.domainShardingKey=void 0,e.exports.getDomainShardIndex=o,e.exports.shardUrl=function(e,t){return globalThis[n]?m(e,t):e},e.exports.shardUrlUnchecked=m;let n="__ATLASPACK_ENABLE_DOMAIN_SHARDS";function o(e,t){let n=t+1,o=e.split("").reduce((e,t)=>{let o=(e<<n)-e+t.charCodeAt(0);return o&o},0);return(o%=n)<0&&(o+=n),o}let a=/-\d+$/;function r(e){if(!a.test(e))return e;let t=e.lastIndexOf("-");return e.slice(0,t)}function s(e,t){let n=e.indexOf("."),o=0===t?"":`-${t-1}`;if(-1===n)return`${r(e)}${o}`;let a=r(e.slice(0,n));return`${a}${o}${e.slice(n)}`}function m(e,t){let n=new URL(e),a=o(function(e){let t=e.lastIndexOf("/");if(-1===t||t===e.length-1)throw Error("Expected an absolute URL with a file name, unable to apply sharding.");return e.slice(t+1)}(n.pathname),t);return n.hostname=s(n.hostname,a),n.toString()}e.exports.domainShardingKey=n}),o("02nRr",function(e,n){t(e.exports,"register",()=>o,e=>o=e),t(e.exports,"resolve",()=>a,e=>a=e);var o,a,r=new Map;o=function(e,t){for(var n=0;n<t.length-1;n+=2)r.set(t[n],{baseUrl:e,path:t[n+1]})},a=function(e){var t=r.get(e);if(null==t)throw Error("Could not resolve bundle with id "+e);return new URL(t.path,t.baseUrl).toString()}}),o("iNYtG",function(t,o){var a=n("42omo"),r=n("4PPzL");let s=(0,n("eSUdr").default)`query ActivePageCommentQuery($commentId:ID!$contentId:ID!){comments(commentId:$commentId){nodes{id ancestors{id}author{type displayName profilePicture{path}...on KnownUser{accountId permissionType}}body(representation:ATLAS_DOC_FORMAT){value}contentStatus createdAt{value}createdAtNonLocalized links{webui}location{type ...on InlineComment{inlineMarkerRef inlineText inlineResolveProperties{isDangling resolvedTime resolvedFriendlyDate resolvedUser resolved}}...on FooterComment{commentResolveProperties{resolvedTime resolvedFriendlyDate resolvedUser resolved}}}parentId permissions{isEditable isRemovable isResolvable}version{friendlyWhen number when by{type displayName ...on KnownUser{accountId}}}reactionsSummary(pageId:$contentId contentType:"page" childType:"comment"){ari containerAri reactionsCount reactionsSummaryForEmoji{id emojiId count reacted}}replies{id author{type ...on KnownUser{accountId permissionType}}createdAt{value}createdAtNonLocalized parentId}}}}`,m=async(e,{contentId:t,isReactionsEnabled:o})=>{let a=await (0,n("hp2SH").getApolloClient)(),r=o?n("kQekh").CommentsSectionGetSingleCommentQuery:n("kQekh").CommentsSectionGetSingleCommentWithoutReactionsQuery;a.query({query:r,variables:o?{commentId:e,contentId:t}:{commentId:e}})},d=(e,t,n,o)=>e().then(()=>{setTimeout(()=>{n.forEach(e=>{t({newCommentId:e.commentId,currentUserMadeComment:e.accountId===o})})},3e3)}).catch(e=>{throw e}),i=async(e,t)=>(await (0,n("hp2SH").getApolloClient)().query({query:n("kQekh").CommentsSectionGetSingleCommentQuery,fetchPolicy:"network-only",variables:{commentId:t,contentId:e}})).data,c=async(e,t)=>(await (0,n("hp2SH").getApolloClient)().query({query:s,fetchPolicy:"network-only",variables:{commentId:t,contentId:e}})).data,l=async({commentId:e,contentId:t,addNewCommentThreads:o,addReplyToCommentThread:a})=>{let r=await i(t,e??""),s=r?.comments?.nodes?.[0];if(s){let e=s.version.when,t=s.location;if(s.parentId){let o=s.ancestors[s.ancestors.length-1]?.id??s.id;a&&a(o,{...s,isUnread:!0,isOpen:!0,wasRemovedByAnotherUser:!1,type:n("8i27m").CommentType.GENERAL,createdAt:{value:e},location:{type:"FOOTER",commentResolveProperties:t.commentResolveProperties},links:{webui:s.links.webui,editui:null},permissions:{isEditable:s.permissions.isEditable,isRemovable:s.permissions.isRemovable,isResolvable:!0}},n("8i27m").CommentType.GENERAL)}else o&&o({general:{[s.id]:{...s,isUnread:!0,isOpen:!0,wasRemovedByAnotherUser:!1,type:n("8i27m").CommentType.GENERAL,replies:[],createdAt:{value:e},location:{type:"FOOTER",commentResolveProperties:t.commentResolveProperties},links:{webui:s.links.webui,editui:null},permissions:{isEditable:s.permissions.isEditable,isRemovable:s.permissions.isRemovable,isResolvable:!0}}},inline:{}})}},u=async({commentId:e,contentId:t,updateCommentBody:o})=>{let a=await i(t,e??""),r=a?.comments?.nodes?.[0];if(r){let e=r.ancestors[r.ancestors.length-1]?.id??r.id;o&&o(r.id,e,r.body.value,n("8i27m").CommentType.GENERAL,r.version?.by?.displayName)}},p=async({commentId:e,contentId:t,updateRemovedCommentIdsMap:o})=>{let a=await i(t,e??""),r=a?.comments?.nodes?.[0];r&&"FooterComment"===r.location.__typename&&r.location.commentResolveProperties&&(0,n("9wGTI").fg)("confluence_gen_comments_resolve_pubsub")?o&&o({threadKey:r.id,commentId:r.id,commentActionType:n("8i27m").CommentActionType.RESOLVE_COMMENT_THREAD,isReply:!!r.parentId,commentType:n("8i27m").CommentType.GENERAL,resolvedProperties:r.location.commentResolveProperties}):r&&o&&o({threadKey:r.id,commentId:r.id,commentActionType:n("8i27m").CommentActionType.RESOLVE_COMMENT_THREAD,isReply:!!r.parentId,commentType:n("8i27m").CommentType.GENERAL})},f=async({commentId:e,contentId:t,addNewCommentThreads:o,getCurrentCommentsPanelState:a})=>{if(!a)return;let{commentsDataMap:r}=a(),s=(0,n("9wGTI").fg)("confluence_frontend_unread_comments_fixes")?await c(t,e??""):await i(t,e??""),m=s?.comments?.nodes?.[0];if(m&&r){let e={...r},t=e[n("8i27m").CommentType.GENERAL][m.id];t&&(t.isOpen=!0,t.wasRemovedByAnotherUser=!1,o&&o(e))}return m},C=({comment:e,userId:t,viewedComments:o,updateUnreadCommentIDSet:a})=>{let r=new Set,s=(0,n("e4kZB").buildValidationObjectFromProps)({commentId:e.id,userId:e.author?.__typename==="KnownUser"?e.author.accountId:void 0,createdAt:e.createdAt?.value||void 0,commentType:"FOOTER",resolveProperties:{resolved:!1}});(0,n("e4kZB").isValidUnreadComment)({comment:s,currentUserId:t,viewedComments:o})&&r.add(e.id),e.replies&&e.replies.forEach(e=>{let a=(0,n("e4kZB").buildValidationObjectFromProps)({commentId:e.id,userId:e.author?.__typename==="KnownUser"?e.author.accountId:void 0,createdAt:e.createdAt?.value||void 0,commentType:"FOOTER",resolveProperties:{resolved:!1}});(0,n("e4kZB").isValidUnreadComment)({comment:a,currentUserId:t,viewedComments:o})&&r.add(e.id)}),a(r,"add")},E=async({commentId:e,updateRemovedCommentIdsMap:t,getCurrentCommentsPanelState:o})=>{if(e){let a=e,r=!1;if(o){let{commentsDataMap:t}=o();if(!t[n("8i27m").CommentType.GENERAL][e]){for(let o of Object.values(t[n("8i27m").CommentType.GENERAL]))if(o.replies){for(let t of o.replies)if(t.id===e){a=o.id,r=!0;break}}}}t&&t({threadKey:a,commentId:e,commentActionType:n("8i27m").CommentActionType.DELETE_COMMENT,isReply:r,commentType:n("8i27m").CommentType.GENERAL})}},_=({userId:e,contentId:t,reloader:o,addNewComment:a,removeComment:r,updateQueryVariables:s,addNewCommentThreads:i,addReplyToCommentThread:c,updateCommentBody:_,updateRemovedCommentIdsMap:g,reopenParentComment:y,getCurrentCommentsPanelState:h,getViewedCommentsCacheOnly:I,updateUnreadCommentIDSet:b,addCommentInCache:T,deleteCommentInCache:R})=>(v,S)=>{let w;if(!v)return;let{accountId:A}=S,{commentId:P}=w=(0,n("9wGTI").fg)("cc_fps_migration_comments")&&(0,n("9wGTI").fg)("confluence_enable_subscriptions-context-provider")?S?.[v]:S.commentRequestBody;if(e!==A)switch(v){case"commentCreated":case"avi:confluence:created:comment":(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?T&&P&&(0,n("lb2Lp").fetchCommentById)({commentId:P,contentId:t,fetchPolicy:"network-only"}).then(e=>{e&&T({newComment:e})}):(l({commentId:P,contentId:t,addNewCommentThreads:i,addReplyToCommentThread:c}),d(o,a,[{commentId:P,accountId:A}],e)),b&&(0,n("9wGTI").fg)("confluence_frontend_unread_comments_fixes")&&b(new Set([P]),"add");break;case"commentResolved":case"avi:confluence:resolved:comment":(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?(P&&(0,n("lb2Lp").fetchCommentById)({commentId:P,contentId:t,fetchPolicy:"network-only"}).then(()=>{if((0,n("9wGTI").fg)("confluence_frontend_unread_comments_fixes")){let{replies:e=[]}=w;b&&b(new Set([P,...e]),"remove")}}),g&&P&&g({threadKey:P,commentId:P,commentActionType:n("8i27m").CommentActionType.RESOLVE_COMMENT_THREAD,isReply:!1,commentType:n("8i27m").CommentType.GENERAL})):o&&o().then(()=>{if(p({commentId:P,contentId:t,updateRemovedCommentIdsMap:g}),(0,n("9wGTI").fg)("confluence_frontend_unread_comments_fixes")){let{replies:e=[]}=w;b&&b(new Set([P,...e]),"remove")}}).catch(e=>{throw e});break;case"commentDeleted":case"avi:confluence:deleted:comment":(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?(R&&P&&R({commentId:P}),b&&(0,n("9wGTI").fg)("confluence_frontend_unread_comments_fixes")&&b(new Set([P]),"remove"),g&&P&&g({threadKey:P,commentId:P,commentActionType:n("8i27m").CommentActionType.DELETE_COMMENT,isReply:!1,commentType:n("8i27m").CommentType.GENERAL})):(E({commentId:P,updateRemovedCommentIdsMap:g,getCurrentCommentsPanelState:h}),o&&o().then(()=>{r&&r(P),b&&(0,n("9wGTI").fg)("confluence_frontend_unread_comments_fixes")&&b(new Set([P]),"remove")}).catch(e=>{throw e}));break;case"commentReopened":case"avi:confluence:reopen:comment":(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?P&&(0,n("lb2Lp").fetchCommentById)({commentId:P,contentId:t,fetchPolicy:"network-only"}).then(t=>{if((0,n("9wGTI").fg)("confluence_frontend_unread_comments_fixes")&&b&&t&&e&&I){let n=I();n.success&&n.data&&C({comment:t,userId:e,viewedComments:n.data,updateUnreadCommentIDSet:b})}}):o&&o().then(async()=>{let o=await f({commentId:P,contentId:t,addNewCommentThreads:i,getCurrentCommentsPanelState:h});if((0,n("9wGTI").fg)("confluence_frontend_unread_comments_fixes")&&b&&o&&e&&I){let t=I();t.success&&t.data&&C({comment:o,userId:e,viewedComments:t.data,updateUnreadCommentIDSet:b})}}).catch(e=>{throw e}),P&&y&&(0,n("9wGTI").fg)("confluence_comments_reply_inline_reliability")&&y({threadKey:P,commentType:n("8i27m").CommentType.GENERAL});break;case"commentUpdated":case"avi:confluence:updated:comment":(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?P&&(0,n("lb2Lp").fetchCommentById)({commentId:P,contentId:t,fetchPolicy:"network-only"}):(u({commentId:P,contentId:t,updateCommentBody:_}),m(P,s))}},g=({contentId:e,contentType:t,userId:o,reloader:a,addNewComment:r,removeComment:s,queryArgs:{isReactionsEnabled:m},addNewCommentThreads:d,addReplyToCommentThread:i,updateCommentBody:c,updateRemovedCommentIdsMap:l,reopenParentComment:u,getCurrentCommentsPanelState:p,addSubscriber:f,setContentType:C,setContentId:E,updateUnreadCommentIDSet:g,getViewedCommentsCacheOnly:y,addCommentInCache:h,deleteCommentInCache:I})=>{let b=t||"page",T=[];if((0,n("9wGTI").fg)("cc_fps_migration_comments")&&(0,n("9wGTI").fg)("confluence_enable_subscriptions-context-provider")){if(!f||!C||!E)return;for(let t of(C(b),E(e),[{subscriberId:"pageCommentsPubSubCommentCreated",onSubscriptionData:_({userId:o,contentId:e,reloader:a,addNewComment:r,addNewCommentThreads:d,addReplyToCommentThread:i,updateUnreadCommentIDSet:g,addCommentInCache:h}),delta:"commentCreated"},{subscriberId:"pageCommentsPubSubCommentResolved",onSubscriptionData:_({userId:o,contentId:e,reloader:a,addNewComment:r,updateRemovedCommentIdsMap:l,updateUnreadCommentIDSet:g}),delta:"commentResolved"},{subscriberId:"pageCommentsPubSubCommentDeleted",onSubscriptionData:_({userId:o,contentId:e,reloader:a,removeComment:s,updateRemovedCommentIdsMap:l,getCurrentCommentsPanelState:p,updateUnreadCommentIDSet:g,deleteCommentInCache:I}),delta:"commentDeleted"},{subscriberId:"pageCommentsPubSubCommentReopened",onSubscriptionData:_({userId:o,contentId:e,reloader:a,addNewComment:r,addNewCommentThreads:d,reopenParentComment:u,getCurrentCommentsPanelState:p,getViewedCommentsCacheOnly:y,updateUnreadCommentIDSet:g}),delta:"commentReopened"},{subscriberId:"pageCommentsPubSubCommentUpdated",onSubscriptionData:_({userId:o,contentId:e,updateQueryVariables:{contentId:e,isReactionsEnabled:m},updateCommentBody:c}),delta:"commentUpdated"}]))T.push({subscriberId:f(t),delta:t.delta});return T}(0,n("gRrX4").getPubSubClient)().then(t=>{t.joinChannel(b,e).finally(()=>{t.subscribe((0,n("7S9uM").eventToAvi)("created:comment"),_({userId:o,contentId:e,reloader:a,addNewComment:r,addNewCommentThreads:d,addReplyToCommentThread:i,updateUnreadCommentIDSet:g,addCommentInCache:h})),t.subscribe((0,n("7S9uM").eventToAvi)("resolved:comment"),_({userId:o,contentId:e,reloader:a,addNewComment:r,updateRemovedCommentIdsMap:l,updateUnreadCommentIDSet:g})),t.subscribe((0,n("7S9uM").eventToAvi)("deleted:comment"),_({userId:o,contentId:e,reloader:a,removeComment:s,updateRemovedCommentIdsMap:l,getCurrentCommentsPanelState:p,updateUnreadCommentIDSet:g,deleteCommentInCache:I})),t.subscribe((0,n("7S9uM").eventToAvi)("reopen:comment"),_({userId:o,contentId:e,reloader:a,addNewComment:r,addNewCommentThreads:d,reopenParentComment:u,getCurrentCommentsPanelState:p,getViewedCommentsCacheOnly:y,updateUnreadCommentIDSet:g})),t.subscribe((0,n("7S9uM").eventToAvi)("updated:comment"),_({userId:o,contentId:e,updateQueryVariables:{contentId:e,isReactionsEnabled:m},updateCommentBody:c}))}).catch(e=>{throw Error(`Unable to joinChannel ${JSON.stringify(e)}`)})})},y=({contentId:e,contentType:t,userId:o,reloader:a,addNewComment:r,removeComment:s,queryArgs:{isReactionsEnabled:m},removeSubscriber:d,subscriptions:i,getViewedCommentsCacheOnly:c})=>{let l=t||"page",u=["commentCreated","commentDeleted","commentUpdated"];if((0,n("9wGTI").fg)("cc_fps_migration_comments")&&(0,n("9wGTI").fg)("confluence_enable_subscriptions-context-provider")){if(!d||!i?.length)return;for(let e of i)u.includes(e.delta)&&d(e)}else(0,n("gRrX4").getPubSubClient)().then(t=>{t.leaveChannel(l,e),t.unsubscribe((0,n("7S9uM").eventToAvi)("created:comment"),_({userId:o,contentId:e,reloader:a,addNewComment:r,getViewedCommentsCacheOnly:c})),t.unsubscribe((0,n("7S9uM").eventToAvi)("deleted:comment"),_({userId:o,contentId:e,reloader:a,removeComment:s,getViewedCommentsCacheOnly:c})),t.unsubscribe((0,n("7S9uM").eventToAvi)("updated:comment"),_({userId:o,contentId:e,updateQueryVariables:{contentId:e,isReactionsEnabled:m},getViewedCommentsCacheOnly:c}))})};t.exports.PageCommentsPubSubHandler=({contentId:t,contentType:o})=>{let s=(0,n("l5y3Y").useIsReactionsEnabled)(t),{addNewComment:m,removeComment:i,clearNewComments:c}=(0,a.useContext)(n("4r9Ir").NewCommentsContext),{addSubscriber:l,removeSubscriber:u,setContentType:p,setContentId:f}=(0,n("6UYek").useSubscriptionsDispatchContext)()||{},C=(0,a.useRef)([]),{userId:E}=(0,n("bQm3c").useSessionData)(),{updateUnreadCommentIDSet:_}=(0,n("fHAwL").useUnreadCommentsActions)(),{getViewedCommentsCacheOnly:h}=(0,n("d3bcC").useViewedComments)({pageId:t}),I=(0,n("aSsfA").useGetPageMode)(),{addReplyToCommentThread:b,addNewCommentThreads:T,getCurrentCommentsPanelState:R,updateCommentBody:v,updateRemovedCommentIdsMap:S,reopenParentComment:w}=(0,n("8i27m").useCommentsDataActions)(),[A,P]=(0,a.useState)(!0);(0,a.useEffect)(()=>{P(!0)},[t]);let{deleteCommentInCache:O,addCommentInCache:M}=(0,n("NYiei").useAllCommentsData)({contentId:t,options:{skip:!0}}),x=(0,n("xQxzY").useQuery)(s?n("ftXPY").CommentsSectionQuery:n("ftXPY").CommentsSectionWithoutReactionsQuery,{variables:{contentId:t,offset:"",first:n("2i3To").DEFAULT_LIMIT},fetchPolicy:"cache-and-network",skip:!t||(0,n("6mKj3").expValEquals)("confluence_comment_use_active_comment_query_exp","isEnabled",!0)}),{refetch:N}=(0,n("dkkKv").useActiveCommentsQuery)({pageId:t,type:"FOOTER",skip:A||!(0,n("6mKj3").expValEquals)("confluence_comment_use_active_comment_query_exp","isEnabled",!0)||!t,fetchPolicy:"cache-and-network"}),V=(0,a.useMemo)(()=>(0,n("6mKj3").expValEquals)("confluence_comment_use_active_comment_query_exp","isEnabled",!0)?N:x.refetch,[N,x.refetch]),k=(0,a.useCallback)(()=>{I===n("cD1qu").PageMode.EDIT&&(0,n("6mKj3").expValEquals)("confluence_comment_footercomments_editpage_exp","isEnabled",!0)||C.current.length>0&&(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)||(C.current=g({contentId:t,contentType:o,userId:E,reloader:V,addNewComment:m,removeComment:i,queryArgs:{isReactionsEnabled:s},addNewCommentThreads:T,addReplyToCommentThread:b,updateCommentBody:v,updateRemovedCommentIdsMap:S,reopenParentComment:w,getCurrentCommentsPanelState:R,addSubscriber:l,setContentType:p,setContentId:f,updateUnreadCommentIDSet:_,getViewedCommentsCacheOnly:h,addCommentInCache:M,deleteCommentInCache:O})??[])},[t,o,E,V,m,i,s,T,b,v,S,w,R,l,p,f,_,h,M,O,I]),L=(0,a.useCallback)(()=>{!(I===n("cD1qu").PageMode.EDIT&&(0,n("6mKj3").expValEquals)("confluence_comment_footercomments_editpage_exp","isEnabled",!0)||0===C.current.length&&(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1))&&(y({contentId:t,contentType:o,userId:E,reloader:V,addNewComment:m,removeComment:i,queryArgs:{isReactionsEnabled:s},updateRemovedCommentIdsMap:S,removeSubscriber:u,subscriptions:C.current,getViewedCommentsCacheOnly:h}),(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)&&(C.current=[]))},[t,o,E,V,m,i,s,S,u,h,I]),D=(0,a.useCallback)(e=>{e&&e.contentId===t&&(P(!1),e.commentEvents.length&&d(V,m,e.commentEvents.map(e=>({commentId:e.id,accountId:e.accountId})),E))},[t,m,V,E]);return!E||I===n("cD1qu").PageMode.EDIT&&(0,n("6mKj3").expValEquals)("confluence_comments_get_document_version_number","isEnabled",!0)?null:e(a).createElement(r.ErrorBoundary,{attribution:n("3IBnw").Attribution.COLLABORATION},e(a).createElement(n("804Ue").MissedPubSubCommentEventsHandler,{contentId:t,eventType:n("804Ue").CommentEventType.FOOTER,subscribeToPubSubEvents:k,unsubscribeFromPubSubEvents:L,onEventFetchSuccess:D,onDocumentReturn:c,isAutoReloadPageComments:!0}))}}),o("2xS8W",function(t,o){var a=n("3u0dr"),r=n("frIzR"),s=n("42omo"),m=n("jAfH5");let d={draftComment:"_2rko12b0 _1yt4u2gc _189ee4h9 _1dqonqa1 _1h6d1l7x _1bsb1osq _4t3i14no _1e0c1txw _4cvr1h6o _1bah1yb4 _syaz1rpy _bfhk1j9a"},i=(0,n("cgtv4").defineMessages)({unsavedDraftComment:{id:"object-comments.draft-comment-box.text",defaultMessage:"Comment in progress - select to continue"}}),c=(0,a.isReactCompilerActiveV1)()?t=>{let o,a,m=(0,r.c)(6),{testId:c,expandPageCommentEditorHandler:l}=t,u=void 0===c?"draft-comment-box":c,{formatMessage:p}=(0,n("8C5kA").default)();return m[0]!==p?(o=p(i.unsavedDraftComment),m[0]=p,m[1]=o):o=m[1],m[2]!==l||m[3]!==o||m[4]!==u?(a=e(s).createElement(n("fVUfS").default,{xcss:d.draftComment,testId:u,onClick:l},o),m[2]=l,m[3]=o,m[4]=u,m[5]=a):a=m[5],a}:({testId:t="draft-comment-box",expandPageCommentEditorHandler:o})=>{let{formatMessage:a}=(0,n("8C5kA").default)();return e(s).createElement(n("fVUfS").default,{xcss:d.draftComment,testId:t,onClick:o},a(i.unsavedDraftComment))};var l=n("dL5YQ");let u={stickyDraftViewPageWrapper:"_kqsw1if8 _1pbykb7n",stickyDraftLivePageWrapper:"_kqsw1n9t _1pbybfng",hiddenStyles:"_1e0cglyw",visibleStyles:"_1e0c1txw",commonStyle:"_4cvr1h6o _1bah1h6o _94n5ze3t _bfhkvuon",childWrapperStyle:"_1yt4pxbi _19pkidpf _2hwx1wug _otyridpf _18u01wug _1h6d1l7x _uwhke4h9 _15a5nqa1",zIndexStyle:"_1pby1kze _1ltvze3t _1bsb1osq"},p=(0,a.isReactCompilerActiveV1)()?t=>{let o,a,d,i,p,f,C,E,_,g,y,h,I,b,T,R,v,S=(0,r.c)(55),{pageWidthType:w}=t,{expanded:A,isObjectCommentWrapperVisible:P,footerEditorEntry:O}=(0,n("fNzRA").useObjectCommentContext)(),{expandCommentContainer:M,setWrapperWidth:x,setIsObjectCommentWrapperVisible:N,setFooterEditorEntry:V}=(0,n("fNzRA").useObjectCommentDispatchContext)(),[k]=(0,n("ep3mz").usePageContentId)(),[L,D]=(0,s.useState)(null),F=(0,n("aSsfA").useGetPageMode)(),j=F===n("cD1qu").PageMode.VIEW,{width:U,left:G,right:K}=(0,n("aOKRX").usePageContentDimensions)(),{hasRecs:B}=(0,m.usePageRecommendationData)(),{addFooterCommentAdf:q}=(0,n("3mVfX").useCommentsPanelState)();S[0]!==M||S[1]!==A||S[2]!==P||S[3]!==V?(o=()=>{P&&A&&(M(),V(n("3mVfX").AddFooterCommentMode.FOOTER))},a=[P,M,A,V],S[0]=M,S[1]=A,S[2]=P,S[3]=V,S[4]=o,S[5]=a):(o=S[4],a=S[5]),(0,s.useEffect)(o,a),S[6]!==j||S[7]!==N||S[8]!==x?(d=()=>{let e=null,t=null,n=()=>{let e=document.querySelector('[data-testid="object-comment-wrapper"]');if(e){let t=e.getBoundingClientRect();D({width:t.width}),x(t.width)}},o=()=>{let o=document.querySelector('[data-testid="object-comment-wrapper"]');if(!o)return void N(!1);e||(e=new IntersectionObserver(e=>{let[t]=e;N(t.isIntersecting)},{rootMargin:"0px"})).observe(o),t||(t=new ResizeObserver(()=>{n()})).observe(o),n()};o();let a=new MutationObserver(()=>{!document.querySelector('[data-testid="object-comment-wrapper"]')||e&&(j||t)||o()});return a.observe(document.body,{childList:!0,subtree:!0}),()=>{e&&e.disconnect(),t&&t.disconnect(),a.disconnect()}},S[6]=j,S[7]=N,S[8]=x,S[9]=d):d=S[9],S[10]!==k||S[11]!==j||S[12]!==N||S[13]!==x?(i=[j,x,N,k],S[10]=k,S[11]=j,S[12]=N,S[13]=x,S[14]=i):i=S[14],(0,s.useEffect)(d,i),S[15]!==G||S[16]!==K||S[17]!==U?(p={width:U,left:G,right:K},S[15]=G,S[16]=K,S[17]=U,S[18]=p):p=S[18];let W=p;S[19]!==w?(f=()=>void 0===w?"100%":JSON.parse(w)===n("1d2ww").ContentAppearanceType.DEFAULT?"1000px":"unset",S[19]=w,S[20]=f):f=S[20];let H=f;S[21]!==H||S[22]!==B||S[23]!==j||S[24]!==L||S[25]!==F||S[26]!==w?(C=()=>{if(j&&(0,n("6mKj3").expValEquals)("confluence_unify_footer_comments_space_width","isEnabled",!0)){let e=(0,n("aHcFH").getWidthAndMaxWidth)({pageMode:F,pageWidthType:w,hasEndOfPageRecommendations:B??!1});return{width:e.width,maxWidth:e.maxWidth}}return{maxWidth:j?H():"100%",width:!j&&L?`${L.width}px`:"100%"}},S[21]=H,S[22]=B,S[23]=j,S[24]=L,S[25]=F,S[26]=w,S[27]=C):C=S[27];let z=C,X=!P&&(q||A)&&O!==n("3mVfX").AddFooterCommentMode.STICKY_DRAFT;S[28]!==M||S[29]!==V?(E=()=>{M(),V(n("3mVfX").AddFooterCommentMode.STICKY_DRAFT)},S[28]=M,S[29]=V,S[30]=E):E=S[30];let Q=E;if(!X&&(0,n("6mKj3").expValEquals)("confluence_comment_remove_sticky_displayprop","isEnabled",!0))return;let $=j?u.stickyDraftViewPageWrapper:u.stickyDraftLivePageWrapper,Y=X?u.visibleStyles:u.hiddenStyles,J=!j&&u.zIndexStyle;S[31]!==Y||S[32]!==J||S[33]!==$?(_=(0,n("1Whri").cx)($,Y,u.commonStyle,J),S[31]=Y,S[32]=J,S[33]=$,S[34]=_):_=S[34],S[35]!==W||S[36]!==F?(g=F===n("cD1qu").PageMode.VIEW?(0,n("niTts").hideWhiteSpace)({shouldRenderFixedStyle:!0,pageContentDimensions:W}):void 0,S[35]=W,S[36]=F,S[37]=g):g=S[37],S[38]===Symbol.for("react.memo_cache_sentinel")?(y=(0,n("1Whri").cx)(u.childWrapperStyle),S[38]=y):y=S[38],S[39]!==z?(h=z(),S[39]=z,S[40]=h):h=S[40];let Z=X?u.visibleStyles:u.hiddenStyles;return S[41]!==Z?(I=(0,n("1Whri").cx)(Z),S[41]=Z,S[42]=I):I=S[42],S[43]!==Q?(b=e(s).createElement(c,{expandPageCommentEditorHandler:Q}),S[43]=Q,S[44]=b):b=S[44],S[45]!==I||S[46]!==b?(T=e(s).createElement(n("gdv5Z").default,null,e(s).createElement(l.ObjectAddCommentProfileWrapper,null,e(s).createElement(n("gdv5Z").default,{xcss:I},b))),S[45]=I,S[46]=b,S[47]=T):T=S[47],S[48]!==h||S[49]!==T?(R=e(s).createElement(n("gdv5Z").default,{xcss:y,style:h},T),S[48]=h,S[49]=T,S[50]=R):R=S[50],S[51]!==_||S[52]!==g||S[53]!==R?(v=e(s).createElement(n("gdv5Z").default,{xcss:_,testId:"sticky-draft-comment-box",id:"addCommentButton-draft",style:g},R),S[51]=_,S[52]=g,S[53]=R,S[54]=v):v=S[54],v}:({pageWidthType:t})=>{let{expanded:o,isObjectCommentWrapperVisible:a,footerEditorEntry:r}=(0,n("fNzRA").useObjectCommentContext)(),{expandCommentContainer:d,setWrapperWidth:i,setIsObjectCommentWrapperVisible:p,setFooterEditorEntry:f}=(0,n("fNzRA").useObjectCommentDispatchContext)(),[C]=(0,n("ep3mz").usePageContentId)(),[E,_]=(0,s.useState)(null),g=(0,n("aSsfA").useGetPageMode)(),y=g===n("cD1qu").PageMode.VIEW,{width:h,left:I,right:b}=(0,n("aOKRX").usePageContentDimensions)(),{hasRecs:T}=(0,m.usePageRecommendationData)(),{addFooterCommentAdf:R}=(0,n("3mVfX").useCommentsPanelState)();(0,s.useEffect)(()=>{a&&o&&(d(),f(n("3mVfX").AddFooterCommentMode.FOOTER))},[a,d,o,f]),(0,s.useEffect)(()=>{let e=null,t=null,n='[data-testid="object-comment-wrapper"]',o=()=>{let e=document.querySelector(n);if(e){let t=e.getBoundingClientRect();_({width:t.width}),i(t.width)}},a=()=>{let a=document.querySelector(n);if(!a)return void p(!1);e||(e=new IntersectionObserver(([e])=>{p(e.isIntersecting)},{rootMargin:"0px"})).observe(a),t||(t=new ResizeObserver(()=>{o()})).observe(a),o()};a();let r=new MutationObserver(()=>{!document.querySelector('[data-testid="object-comment-wrapper"]')||e&&(y||t)||a()});return r.observe(document.body,{childList:!0,subtree:!0}),()=>{e&&e.disconnect(),t&&t.disconnect(),r.disconnect()}},[y,i,p,C]);let v=(0,s.useMemo)(()=>({width:h,left:I,right:b}),[h,I,b]),S=()=>void 0===t?"100%":JSON.parse(t)===n("1d2ww").ContentAppearanceType.DEFAULT?"1000px":"unset",w=!a&&(R||o)&&r!==n("3mVfX").AddFooterCommentMode.STICKY_DRAFT;if(!(!w&&(0,n("6mKj3").expValEquals)("confluence_comment_remove_sticky_displayprop","isEnabled",!0)))return e(s).createElement(n("gdv5Z").default,{xcss:(0,n("1Whri").cx)(y?u.stickyDraftViewPageWrapper:u.stickyDraftLivePageWrapper,w?u.visibleStyles:u.hiddenStyles,u.commonStyle,!y&&u.zIndexStyle),testId:"sticky-draft-comment-box",id:"addCommentButton-draft",style:g===n("cD1qu").PageMode.VIEW?(0,n("niTts").hideWhiteSpace)({shouldRenderFixedStyle:!0,pageContentDimensions:v}):void 0},e(s).createElement(n("gdv5Z").default,{xcss:(0,n("1Whri").cx)(u.childWrapperStyle),style:(()=>{if(y&&(0,n("6mKj3").expValEquals)("confluence_unify_footer_comments_space_width","isEnabled",!0)){let e=(0,n("aHcFH").getWidthAndMaxWidth)({pageMode:g,pageWidthType:t,hasEndOfPageRecommendations:T??!1});return{width:e.width,maxWidth:e.maxWidth}}return{maxWidth:y?S():"100%",width:!y&&E?`${E.width}px`:"100%"}})()},e(s).createElement(n("gdv5Z").default,null,e(s).createElement(l.ObjectAddCommentProfileWrapper,null,e(s).createElement(n("gdv5Z").default,{xcss:(0,n("1Whri").cx)(w?u.visibleStyles:u.hiddenStyles)},e(s).createElement(c,{expandPageCommentEditorHandler:()=>{d(),f(n("3mVfX").AddFooterCommentMode.STICKY_DRAFT)}}))))))};t.exports.StickyDraftCommentContainer=p}),o("jAfH5",function(e,t){var o=n("42omo"),a=n("8dbvt");e.exports.usePageRecommendationData=(e=!1)=>{let[t]=(0,n("ep3mz").usePageSpaceKey)(),[r]=(0,n("ep3mz").usePageContentId)(),{error:s,loading:m,data:d}=(0,n("jMyy4").useQueryInterop)(...(0,n("3joiD").getQueryParamsAndSetFetchPolicyForNetworkOnlyQuery)({query:n("4XcQZ").EndOfPageRecommendationQuery,variables:{type:"page",id:r??"",exp:"end_of_page_v5",key:t??"",keyString:t??""},context:{single:!0},errorPolicy:"all",skip:e})),i=(0,o.useMemo)(()=>(0,a.transformAndOrderRecs)(d?.getRecommendedPages?.recommendedPages),[d]);return s||e?{loading:!1,error:s,data:void 0,hasRecs:!1}:{loading:m,error:s,data:i,hasRecs:i&&i.length>2}}}),o("70pcM",function(t,o){var a=n("42omo"),r=n("5CNGn");let s=(0,n("jmjWc").LoadablePaint)({__loadable_id__:"zDMTR",name:"ObjectCommentContainerLoader",loader:async()=>(await Promise.resolve(n("5CNGn"))).ObjectCommentContainer});t.exports.ObjectCommentWrapper=({showGeneralComment:t,pageWidthType:o,loadingPriority:m,showLabels:d,hasReactions:i,editorIsUserOffline:c})=>{let{setShowGeneralComments:l}=(0,n("3mVfX").useCommentsPanelActions)();return(0,a.useEffect)(()=>{l(t)},[]),m===n("398ES").LoadingPriority.PAINT?e(a).createElement(s,{pageWidthType:o,showLabels:d,hasReactions:i,editorIsUserOffline:c}):e(a).createElement(r.ObjectCommentContainer,{pageWidthType:o,showLabels:d,hasReactions:i,editorIsUserOffline:c})}}),o("5CNGn",function(t,o){var a=n("42omo"),r=n("jTxSS"),s=n("5fMeR");let m=(0,n("eSUdr").default)`query ObjectCommentQueryParamsListenerObjectCommentQueryParamsQuery($commentId:ID!){comments(commentId:$commentId){nodes{id parentId author{displayName ...on KnownUser{accountId}}location{type ...on FooterComment{commentResolveProperties{resolved}}}}}}`,d=(0,n("7W8i8").getLogger)("inline-comments:query-param-listener"),i=(0,n("dPJCf").createSingleQueryParamHook)("focusedCommentId"),c=(0,n("dPJCf").createSingleQueryParamHook)("replyToComment"),l=[404],u=e=>e.graphQLErrors.some(e=>l.includes(e?.extensions?.statusCode)),p=({hasLoadedObjectComments:e,allObjectCommentsRendered:t,commentBatchRendered:o,commentBatchCount:r,setForceLoadComments:l})=>{let p,f,[C,E]=(0,a.useState)(!1),[_,g]=(0,a.useState)(!1),y=(0,a.useRef)(null),h=(0,a.useRef)(null),I=(0,a.useRef)(0),b=()=>{null!==h.current&&("number"==typeof h.current?"undefined"!=typeof window&&"cancelIdleCallback"in window&&"function"==typeof window.cancelIdleCallback&&window.cancelIdleCallback(h.current):clearTimeout(h.current),h.current=null)},T=()=>{y.current&&(y.current.disconnect(),y.current=null)},R=(0,a.useCallback)(()=>{y.current&&T(),null!==h.current&&b()},[]),{setCurrentlySelectedThreadKey:v,setReplyToCommentId:S}=(0,n("3mVfX").useCommentsPanelActions)(),{showCommentsPanel:w}=(0,s.useShowCommentsPanel)(),[A]=(0,n("ep3mz").usePageContentId)(),P=(0,n("aSsfA").useGetPageMode)(),O=i(),M=c(),x=O||M,{comment:N,error:V}=(0,n("lb2Lp").useCommentById)({commentId:x||"",contentId:A||"",contentStatus:(0,n("kgNLQ").buildDefaultCommentsContentStatusFilters)(P),options:{skip:!x||!(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)}}),{data:k,error:L}=(0,n("xQxzY").useQuery)(m,{variables:{commentId:x},skip:!x||(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)});if(L&&!u(L)&&d.error`An error occurred when querying the focused object comment status; ${L}`,(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)){if(N&&!V){let e=N.location;p=!!e?.commentResolveProperties?.resolved,f=N.parentId}}else if(k&&!L){let e=k?.comments?.nodes?.[0]?.location;p=!!e?.commentResolveProperties?.resolved,f=k?.comments?.nodes?.[0]?.parentId}let D=(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?N:k?.comments?.nodes?.[0]||null;return(0,a.useEffect)(()=>{let o=(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?N&&!V:k&&!L;if(o&&x&&(0,n("6mKj3").expValEquals)("confluence_comment_deeplink_queryparam_selection","isEnabled",!0)){let e=(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?N?.location:k?.comments?.nodes?.[0]?.location;if(e&&"type"in e&&"INLINE"===e.type)return}if(x&&o&&e&&t&&!C&&!_)if(p)w({openWithView:n("3mVfX").ViewValues.RESOLVED}),v(x,n("8i27m").CommentType.GENERAL),O?E(!0):g(!0);else{let e=`footer-comment-thread-${x}-container`,t=`footer-comment-thread-${x}-replies`,o=document.getElementById(e),a=document.getElementById(t),r=o||a,s=((0,n("6mKj3").expValEquals)("confluence_comment_deeplink_thread_selection","isEnabled",!0)?f:null)??x;if(x&&(0,n("9wGTI").fg)("confluence_comments_unified_navigation"))if((0,n("6mKj3").expValEquals)("confluence_comment_deeplink_delay_scroll","isEnabled",!0)){if(M){v(s);let e=D?.author;S((0,n("eTcMK").createReplyToCommentParams)(M,n("i6UMJ").LocationValue.FOOTER,e,(0,n("6mKj3").expValEquals)("confluence_comment_expand_reply_editor","isEnabled",!0))),g(!0);return}T();let o=()=>{b(),(0,n("9FoVw").handleFooterCommentsNavigation)({scrollBehavior:n("9FoVw").ScrollBehavior.SMOOTH,block:"center",inline:"center",commentId:x,navigationContext:f?n("9FoVw").NavigationContext.REPLY:void 0}),E(!0),v(s),T()},a=()=>{b(),I.current=Date.now(),"undefined"!=typeof window&&"requestIdleCallback"in window?h.current=window.requestIdleCallback(()=>{let e=Date.now()-I.current;e>=500?o():h.current=setTimeout(()=>{o()},500-e)}):h.current=setTimeout(()=>{o()},4e3)},r=()=>{let n=document.getElementById(e)||document.getElementById(t);if(!n)return{element:null,isReady:!1};let o=n.getBoundingClientRect(),a=n.offsetHeight>0&&n.offsetWidth>0&&o.height>0&&o.width>0;return{element:n,isReady:a}},{element:m,isReady:d}=r();if(m&&d)a();else{if(y.current=new MutationObserver(()=>{I.current=Date.now();let{element:e,isReady:t}=r();e&&t&&a()}),m){y.current.observe(m,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"]});let e=m.parentElement;e&&y.current.observe(e,{childList:!0,subtree:!0})}else y.current.observe(document.body,{childList:!0,subtree:!0});setTimeout(()=>{y.current&&o()},4e3)}}else r&&((0,n("9FoVw").handleFooterCommentsNavigation)({scrollBehavior:n("9FoVw").ScrollBehavior.SMOOTH,block:"center",inline:"center",commentId:x,navigationContext:f?n("9FoVw").NavigationContext.REPLY:void 0}),E(!0),v(s));else if(r){if(M){v(M);let e=D?.author;S((0,n("eTcMK").createReplyToCommentParams)(M,n("i6UMJ").LocationValue.FOOTER,e,(0,n("6mKj3").expValEquals)("confluence_comment_expand_reply_editor","isEnabled",!0))),g(!0);return}let e=r.getBoundingClientRect();e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)||((0,n("4u5NT").abortAll)("new_interaction","document-scroll:object-comment-container"),r.scrollIntoView({behavior:n("9FoVw").ScrollBehavior.SMOOTH,block:"center",inline:"center"}),E(!0),v(O))}}},[k,L,N,V,e,x,O,M,t,o,r,v,S,p,w,C,_,D,f]),(0,a.useEffect)(()=>{E(!1),g(!1),R()},[O,M,R]),(0,a.useEffect)(()=>()=>{R()},[R]),(0,a.useEffect)(()=>{(O||M)&&!e&&l(!0)},[O,M,e,l]),null};var f=n("aJv6Q"),C=n("jAfH5"),E=n("3u0dr"),_=n("frIzR");let g=(0,n("cgtv4").defineMessages)({addCommentTooltip:{id:"object-comments.footer.add-button-tooltip",defaultMessage:"Add comment"}}),y=(0,E.isReactCompilerActiveV1)()?t=>{let o,r,s,m,d,i,c,l,u=(0,_.c)(17),{onClick:p,autofocusRef:f}=t,{formatMessage:C}=(0,n("8C5kA").default)();u[0]===Symbol.for("react.memo_cache_sentinel")?(o={shortcut:n("gnkil").UNIVERSAL_OPEN_COMMENT_EDITOR},u[0]=o):o=u[0];let E=(0,n("4tOXV").useShortcutStrings)(o),y=(0,a.useRef)(null);u[1]!==f?(r=()=>{f.current&&(y.current?.focus({preventScroll:!0}),f.current=!1)},s=[f],u[1]=f,u[2]=r,u[3]=s):(r=u[2],s=u[3]),(0,a.useEffect)(r,s),u[4]!==C?(m=(0,n("9wGTI").fg)("platform_tooltip_shortcuts_migration_1")?C(g.addCommentTooltip):e(a).createElement(n("4tOXV").ShortcutVisualizer,{shortcut:n("gnkil").UNIVERSAL_OPEN_COMMENT_EDITOR,contentBefore:C(g.addCommentTooltip),isTooltip:!0}),u[4]=C,u[5]=m):m=u[5];let h=m;return u[6]!==h?(d=(0,n("6mKj3").expValEquals)("confluence_comments_cohiti_footer_tooltips","isEnabled",!0)?h:void 0,u[6]=h,u[7]=d):d=u[7],u[8]!==E?(i=(0,n("9wGTI").fg)("platform_tooltip_shortcuts_migration_1")?E:void 0,u[8]=E,u[9]=i):i=u[9],u[10]!==f||u[11]!==p?(c=e(a).createElement(n("famWw").AddCommentPromptButton,{onClick:p,autofocusRef:f,testId:"add-comment-button"}),u[10]=f,u[11]=p,u[12]=c):c=u[12],u[13]!==d||u[14]!==i||u[15]!==c?(l=e(a).createElement(n("6f0Oj").default,null,e(a).createElement(n("3gadb").default,{content:d,shortcut:i,position:"top"},c)),u[13]=d,u[14]=i,u[15]=c,u[16]=l):l=u[16],l}:({onClick:t,autofocusRef:o})=>{let{formatMessage:r}=(0,n("8C5kA").default)(),s=(0,n("4tOXV").useShortcutStrings)({shortcut:n("gnkil").UNIVERSAL_OPEN_COMMENT_EDITOR}),m=(0,a.useRef)(null);(0,a.useEffect)(()=>{o.current&&(m.current?.focus({preventScroll:!0}),o.current=!1)},[o]);let d=(0,n("9wGTI").fg)("platform_tooltip_shortcuts_migration_1")?r(g.addCommentTooltip):e(a).createElement(n("4tOXV").ShortcutVisualizer,{shortcut:n("gnkil").UNIVERSAL_OPEN_COMMENT_EDITOR,contentBefore:r(g.addCommentTooltip),isTooltip:!0});return e(a).createElement(n("6f0Oj").default,null,e(a).createElement(n("3gadb").default,{content:(0,n("6mKj3").expValEquals)("confluence_comments_cohiti_footer_tooltips","isEnabled",!0)?d:void 0,shortcut:(0,n("9wGTI").fg)("platform_tooltip_shortcuts_migration_1")?s:void 0,position:"top"},e(a).createElement(n("famWw").AddCommentPromptButton,{onClick:t,autofocusRef:o,testId:"add-comment-button"})))};var h=n("1NF8X");let I=(0,n("cgtv4").defineMessages)({addNew:{id:"object-comments.page.reactions.add.new",defaultMessage:"Add new"},addReaction:{id:"object-comments.page.reactions.add.reaction",defaultMessage:"Add reaction"}}),b=(0,E.isReactCompilerActiveV1)()?t=>{let o,r,s,m,d,i=(0,_.c)(18),{isOffline:c,optimisticReactions:l}=t,u=void 0!==c&&c,p=void 0!==l&&l,[f]=(0,n("ep3mz").usePageContentId)(),[C]=(0,n("ep3mz").useContentType)(),E=(0,n("7QM6o").useSpaceId)(),{formatMessage:g}=(0,n("8C5kA").default)(),{isReactionsEnabled:y}=(0,a.useContext)(n("8SCD6").ReactionsContext);i[0]!==f?(o=(0,n("9sGCn").getCachedPageData)(f),i[0]=f,i[1]=o):o=i[1];let{subType:b}=o;i[2]!==g?(r=g(I.addReaction),i[2]=g,i[3]=r):r=i[3],i[4]!==r?(s=e(a).createElement(e(n("4FHTF")),{testId:"emoji-add-icon",color:"var(--ds-icon-subtle, #505258)",label:r}),i[4]=r,i[5]=s):s=i[5];let T=s,R=f||"",v="blogpost"===C?n("2ttXz").ReactionLocation.OBJECT_COMMENT_FOOTER_BLOGPOST:n("2ttXz").ReactionLocation.OBJECT_COMMENT_FOOTER_PAGE,S=E||"";i[6]!==g?(m=g(I.addNew),i[6]=g,i[7]=m):m=i[7];let w=y?T:void 0;return i[8]!==T||i[9]!==u||i[10]!==p||i[11]!==b||i[12]!==w||i[13]!==R||i[14]!==v||i[15]!==S||i[16]!==m?(d=e(a).createElement(h.ReactionsLoader,{contentId:R,location:v,containerId:S,containerType:n("2ttXz").ReactionContainerType.SPACE,contentSubType:b,summaryViewEnabled:!0,summaryViewThreshold:1,allowSelectFromSummaryView:!0,useButtonAlignmentStyling:!0,summaryViewPlacement:"bottom-end",hideNoReactionsText:!0,readOnly:u,isViewOnly:u,isSubtle:!0,reactionPickerTriggerIcon:T,reactionPickerTriggerText:m,useDefaultStyledContainer:!1,hidePlaceholder:!!window.__SSR_RENDERED__,noRelativeContainer:!1,noFlexWrap:!1,hoverableSummaryView:!0,reactionPickerPlacement:"bottom-end",summaryButtonIconAfter:w,optimisticallyLoadSummaryEmojis:p,renderParticleEffectOnSummaryView:!0}),i[8]=T,i[9]=u,i[10]=p,i[11]=b,i[12]=w,i[13]=R,i[14]=v,i[15]=S,i[16]=m,i[17]=d):d=i[17],d}:({isOffline:t=!1,optimisticReactions:o=!1})=>{let[r]=(0,n("ep3mz").usePageContentId)(),[s]=(0,n("ep3mz").useContentType)(),m=(0,n("7QM6o").useSpaceId)(),{formatMessage:d}=(0,n("8C5kA").default)(),{isReactionsEnabled:i}=(0,a.useContext)(n("8SCD6").ReactionsContext),{subType:c}=(0,n("9sGCn").getCachedPageData)(r),l=e(a).createElement(e(n("4FHTF")),{testId:"emoji-add-icon",color:"var(--ds-icon-subtle, #505258)",label:d(I.addReaction)});return e(a).createElement(h.ReactionsLoader,{contentId:r||"",location:"blogpost"===s?n("2ttXz").ReactionLocation.OBJECT_COMMENT_FOOTER_BLOGPOST:n("2ttXz").ReactionLocation.OBJECT_COMMENT_FOOTER_PAGE,containerId:m||"",containerType:n("2ttXz").ReactionContainerType.SPACE,contentSubType:c,summaryViewEnabled:!0,summaryViewThreshold:1,allowSelectFromSummaryView:!0,useButtonAlignmentStyling:!0,summaryViewPlacement:"bottom-end",hideNoReactionsText:!0,readOnly:t,isViewOnly:t,isSubtle:!0,reactionPickerTriggerIcon:l,reactionPickerTriggerText:d(I.addNew),useDefaultStyledContainer:!1,hidePlaceholder:!!window.__SSR_RENDERED__,noRelativeContainer:!1,noFlexWrap:!1,hoverableSummaryView:!0,reactionPickerPlacement:"bottom-end",summaryButtonIconAfter:i?l:void 0,optimisticallyLoadSummaryEmojis:o,renderParticleEffectOnSummaryView:!0})},T=(0,n("jmjWc").LoadablePaint)({__loadable_id__:"zM3y-",name:"FooterLabelsLoader",loader:async()=>(await n("7aqgU")).FooterLabels}),R={oldAddCommentContainerStyles:"_1yt4pxbi _x3doia51 _kqsw1if8 _94n5ze3t _1e0c1txw _1bsb1osq _bfhk1j9a",addCommentContainerStyles:"_1yt4pxbi _x3doia51 _kqsw1if8 _94n5ze3t _1e0c1txw _1bsb1osq _bfhkvuon",addCommentClosedContainerStyles:"_1bsb1osq _1e0c1txw _1bah1yb4 _4cvr1h6o _1o9zidpf",addCommentReactionsContainerStyles:"_1e0c1txw _4cvr1h6o _1bahesu3",rightButtonContainerStyles:"_4cvr1h6o"},v=(0,E.isReactCompilerActiveV1)()?t=>{let o,r,s,m,d=(0,_.c)(15),{showReactions:i,showLabels:c,isOffline:l,optimisticReactions:u}=t,p=void 0!==u&&u,{edition:f}=(0,n("bQm3c").useSessionData)(),C=(0,a.useRef)(!1),{expandCommentContainer:E,setFooterEditorEntry:g}=(0,n("fNzRA").useObjectCommentDispatchContext)(),{expanded:h}=(0,n("fNzRA").useObjectCommentContext)(),[I]=(0,n("ep3mz").usePageContentId)();d[0]!==f||d[1]!==E||d[2]!==g?(o=()=>{(0,n("9wGTI").fg)("confluence_fe_add_page_comment_exp_coverage")||(0,n("8Ss4E").startEditorExperiences)({name:n("irVI7").ADD_PAGE_COMMENT_EXPERIENCE,attributes:{...(0,n("gtj7V").getCommentsDataManagerExperimentAttributes)(),editor:"FABRIC",isSingleExperience:!0,edition:f,source:n("en1dX").AnalyticsSource.PAGE_FOOTER}},{name:n("irVI7").ADD_PAGE_COMMENT_LOAD_EXPERIENCE},{name:n("irVI7").ADD_PAGE_COMMENT_PUBLISH_EXPERIENCE}),E({entryPoint:"pageFooter"}),g(n("3mVfX").AddFooterCommentMode.FOOTER)},d[0]=f,d[1]=E,d[2]=g,d[3]=o):o=d[3];let v=o;return d[4]===Symbol.for("react.memo_cache_sentinel")?(r=(0,n("1Whri").cx)((0,n("9wGTI").fg)("confluence_frontend_content_wrapper")&&R.addCommentContainerStyles,!(0,n("9wGTI").fg)("confluence_frontend_content_wrapper")&&R.oldAddCommentContainerStyles),d[4]=r):r=d[4],d[5]!==I||d[6]!==h||d[7]!==v||d[8]!==l||d[9]!==p||d[10]!==c||d[11]!==i?(s=!h&&e(a).createElement(n("gdv5Z").default,{xcss:R.addCommentClosedContainerStyles},e(a).createElement(y,{onClick:v,autofocusRef:C}),e(a).createElement(n("1s5hv").default,{gap:"space.050",testId:"objectAddCommentContainer-rightButtonContainer",xcss:R.rightButtonContainerStyles},c&&(0,n("9wGTI").fg)("confluence_frontend_labels_in_footer")&&e(a).createElement(e(a).Fragment,null,e(a).createElement(n("ln0hx").ExperienceStart,{id:I,name:n("irVI7").VIEW_PAGE_LABELS_IN_FOOTER_EXPERIENCE}),e(a).createElement(T,null)),i&&e(a).createElement(n("gdv5Z").default,{xcss:R.addCommentReactionsContainerStyles},e(a).createElement(b,{isOffline:l,optimisticReactions:p})))),d[5]=I,d[6]=h,d[7]=v,d[8]=l,d[9]=p,d[10]=c,d[11]=i,d[12]=s):s=d[12],d[13]!==s?(m=e(a).createElement(e(a).Fragment,null,e(a).createElement(n("gdv5Z").default,{id:"addCommentButton",xcss:r,testId:"addCommentButton"},s)),d[13]=s,d[14]=m):m=d[14],m}:({showReactions:t,showLabels:o,isOffline:r,optimisticReactions:s=!1})=>{let{edition:m}=(0,n("bQm3c").useSessionData)(),d=(0,a.useRef)(!1),{expandCommentContainer:i,setFooterEditorEntry:c}=(0,n("fNzRA").useObjectCommentDispatchContext)(),{expanded:l}=(0,n("fNzRA").useObjectCommentContext)(),[u]=(0,n("ep3mz").usePageContentId)(),p="addCommentButton",f=(0,a.useCallback)(()=>{(0,n("9wGTI").fg)("confluence_fe_add_page_comment_exp_coverage")||(0,n("8Ss4E").startEditorExperiences)({name:n("irVI7").ADD_PAGE_COMMENT_EXPERIENCE,attributes:{...(0,n("gtj7V").getCommentsDataManagerExperimentAttributes)(),editor:"FABRIC",isSingleExperience:!0,edition:m,source:n("en1dX").AnalyticsSource.PAGE_FOOTER}},{name:n("irVI7").ADD_PAGE_COMMENT_LOAD_EXPERIENCE},{name:n("irVI7").ADD_PAGE_COMMENT_PUBLISH_EXPERIENCE}),i({entryPoint:"pageFooter"}),c(n("3mVfX").AddFooterCommentMode.FOOTER)},[m,i,c]);return e(a).createElement(e(a).Fragment,null,e(a).createElement(n("gdv5Z").default,{id:p,xcss:(0,n("1Whri").cx)((0,n("9wGTI").fg)("confluence_frontend_content_wrapper")&&R.addCommentContainerStyles,!(0,n("9wGTI").fg)("confluence_frontend_content_wrapper")&&R.oldAddCommentContainerStyles),testId:p},!l&&e(a).createElement(n("gdv5Z").default,{xcss:R.addCommentClosedContainerStyles},e(a).createElement(y,{onClick:f,autofocusRef:d}),e(a).createElement(n("1s5hv").default,{gap:"space.050",testId:"objectAddCommentContainer-rightButtonContainer",xcss:R.rightButtonContainerStyles},o&&(0,n("9wGTI").fg)("confluence_frontend_labels_in_footer")&&e(a).createElement(e(a).Fragment,null,e(a).createElement(n("ln0hx").ExperienceStart,{id:u,name:n("irVI7").VIEW_PAGE_LABELS_IN_FOOTER_EXPERIENCE}),e(a).createElement(T,null)),t&&e(a).createElement(n("gdv5Z").default,{xcss:R.addCommentReactionsContainerStyles},e(a).createElement(b,{isOffline:r,optimisticReactions:s}))))))},S=(0,f.withErrorBoundary)({attribution:n("3IBnw").Attribution.COMMENTS})(v);var w=n("auGhu"),A=n("kEmgx");let P=(0,n("eSUdr").default)`mutation ObjectCommentResolveCommentMutation($commentIds:[ID]!$cloudId:ID!){confluence_resolveComments(commentIds:$commentIds cloudId:$cloudId){success commentResolutionStates{commentId resolveProperties{resolvedTime resolvedUser resolvedFriendlyDate}status}errors{message extensions{...on ResolveCommentsMutationErrorExtension{errorType statusCode}__typename}}}}`,O=(0,n("eSUdr").default)`mutation ObjectCommentReopenCommentMutation($commentId:ID!$cloudId:ID!){confluence_reopenComment(commentId:$commentId cloudId:$cloudId){success commentResolutionStates{commentId status}errors{message extensions{...on ReopenCommentsMutationErrorExtension{errorType statusCode}__typename}}}}`,M=(0,n("eSUdr").default)`mutation ObjectCommentDeleteGeneralCommentMutation($commentIdToDelete:ID!$deleteFrom:CommentDeletionLocation){deleteComment(commentIdToDelete:$commentIdToDelete deleteFrom:$deleteFrom)}`,x=(0,n("cgtv4").defineMessages)({commentReopenedFlagTitle:{id:"object-comments.comment.reopened.flag.title",defaultMessage:"Comment reopened"},commentReopenFailedFlagTitle:{id:"object-comments.comment.reopen.failed.flag.title",defaultMessage:"Failed to reopen comment"},commentReopenCacheUpdateFailedFlagTitle:{id:"object-comments.comment.reopen.cache-update.failed.flag.title",defaultMessage:"Failed to update reopened comment. Please refresh the page."},retryCTA:{id:"object-comments.comment.reopen.failed.flag.cta.retry",defaultMessage:"Retry now"},cannotDeleteTitle:{id:"object-comments.could.not.delete.title",defaultMessage:"Unable to delete comment"}}),N=(0,n("7W8i8").getLogger)("page-comments-queries"),V=({comment:t,supportedTopLevelActions:o,pageMode:r,pageInfo:m,isUnread:d=!1,isHovered:i,threadKey:c,flags:l,adjustForNestedReplies:u=!1,hideBranchingStyle:p=!1,canAddComments:f=!0,isThreadHovered:C,isParentCommentOpen:E,adjustForFooterNestedReplies:_=!1,topLevelParentCommentId:g,commentHasChildren:y=!1,isLastNestedFooterReply:h=!1,isOffline:I=!1,showRepliesWithCurvedBorders:b,replyHasNestedObjects:T=!1})=>{let R=(0,a.useRef)(null),v=(0,a.useRef)(null),{isReactionsEnabled:S}=(0,a.useContext)(n("8SCD6").ReactionsContext),V=(0,a.useContext)(n("1kHsc").ExperienceTrackerContext),{resetContentChanged:k}=(0,n("bSvtO").useCommentsContentActions)(),[L]=(0,n("ep3mz").usePageContentId)(),{createAnalyticsEvent:D}=(0,n("inPa6").useAnalyticsEvents)(),[{commentsDataMap:F,hasNestedComments:j,cacheUpdateFailed:U},{addNewCommentThreads:G,deleteParentComment:K,handleRemovingComments:B}]=(0,n("8i27m").useCommentsData)(),{setCacheUpdateFailed:q}=(0,n("8i27m").useCommentsDataActions)(),{deleteCommentInCache:W}=(0,n("NYiei").useAllCommentsData)({contentId:L||"",options:{skip:!0}}),H=(0,n("4L9ve").useProcessedCommentsDataState)(),z=(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?H.commentsDataMap:F,X=(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?H.hasNestedComments:j,{cloudId:Q}=(0,n("bQm3c").useSessionData)(),[{currentlySelectedThreadKey:$,footerEditCommentIds:Y},{setCurrentView:J,setCurrentlySelectedThreadKey:Z,setReplyToCommentId:ee,addFooterEditCommentId:et,removeFooterEditCommentId:en}]=(0,n("3mVfX").useCommentsPanel)(),{formatMessage:eo}=(0,n("8C5kA").default)(),{focusedCommentId:ea}=(0,n("liGyh").useInlineCommentQueryParams)(),{scrollCommentsPanelToThread:er}=(0,n("6KwrO").useCommentsPanelScroll)(),{isCommentsPanelShown:es,showCommentsPanel:em}=(0,s.useShowCommentsPanel)(),ed=(0,n("7aw3q").useEmbeddedComments)(),[ei]=(0,n("1KmJq").useMutation)(P),[ec]=(0,n("1KmJq").useMutation)(O,{refetchQueries:r!==n("cD1qu").PageMode.VIEW||(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?[]:[{query:n("3s9yq").InlineCommentsQuery,variables:{pageId:L}}]}),{updateCommentInCache:el}=(0,n("jbF1h").useUpdateCommentInCache)(),{updateCommentInCache:eu}=(0,n("jbF1h").useUpdateCommentInCache)(),[ep]=(0,n("1KmJq").useMutation)(M),ef=t?.author?.accountId,eC=t?.author?.profilePicture?.path,eE=t?.author?.displayName??eo(n("3ejfs").commentsi18n.anonymous),e_=t?.id,eg=t?.version?.when,ey=t?.createdAt?.value,eh=t?.createdAtNonLocalized,eI=t?.version?.by?.displayName,eb=t?.version?.when,eT=t?.permissions,eR=t?.body?.value,ev=t?.author?.permissionType??void 0,eS=t?.parentId,ew=!!eS,eA=(t?.version?.number||0)>1,eP=t?.replies?.length||0,eO=t?.links.webui??void 0,eM=t?.reactionsSummary,ex=t?.location,eN=(0,a.useCallback)(()=>{let e=ex?.commentResolveProperties;if(!ew)return e||void 0},[ex,ew])(),eV=t?.wasRemovedByAnotherUser,ek=eV&&eV===n("8i27m").CommentActionType.RESOLVE_COMMENT_THREAD,eL=eV&&eV===n("8i27m").CommentActionType.DELETE_COMMENT,eD=(0,a.useCallback)(e=>W({commentId:e,onError:t=>{(0,n("8dA1U").handleMutationFailure)({experienceTracker:V,experienceName:n("irVI7").DELETE_PAGE_COMMENT_EXPERIENCE,error:t,commentId:e})}}),[W,V]),eF=()=>{ep({...{variables:{commentIdToDelete:e_,deleteFrom:void 0},update:(0,n("kgNLQ").selectUpdateFunction)((0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1),()=>eD(e_),()=>ew?(0,n("87CZC").updateApolloCacheReplyCallback)("delete",{pageId:L,contentStatus:["DRAFT","CURRENT"],type:["FOOTER"]},eS,S,e_):(0,n("87CZC").updateApolloCacheParentCallback)("delete",{pageId:L,contentStatus:["DRAFT","CURRENT"],type:["FOOTER"]},S,e_))}}).then(({data:e})=>{if(!e||!e.deleteComment)throw Error("No data returned from mutation");k(),ew?B({threadKey:c,commentId:e_,action:n("8i27m").CommentActionType.DELETE_COMMENT,commentType:n("8i27m").CommentType.GENERAL}):K({threadKey:c,commentType:n("8i27m").CommentType.GENERAL}),D({type:"sendTrackEvent",data:{action:"deleted",actionSubject:"comment",actionSubjectId:e_,objectType:"page",objectId:L,source:n("en1dX").AnalyticsSource.COMMENTS_PANEL,attributes:{commentType:n("en1dX").CommentType.PAGE,source:n("en1dX").AnalyticsSource.PAGE_FOOTER,pageMode:r,isReply:ew}}}).fire(),V.succeed({name:n("irVI7").DELETE_PAGE_COMMENT_EXPERIENCE})}).catch(t=>{if((0,n("9wGTI").fg)("confluence_frontend_show_already_deleted_flag")){let o=(0,n("isdzP").parseError)(t),s=(0,n("isdzP").getTranslatedError)(o.message,e_);(0,n("isdzP").isAlreadyDeletedError)(s)&&(l?.showWarningFlag({title:e(a).createElement(n("gtD4K").default,x.cannotDeleteTitle),description:e(a).createElement(n("gtD4K").default,s)}),D({type:"sendOperationalEvent",data:{action:"alreadyDeleted",actionSubject:"comment",actionSubjectId:e_,objectType:"page",objectId:L,source:n("en1dX").AnalyticsSource.PAGE_FOOTER,attributes:{commentType:n("8i27m").CommentType.GENERAL,mode:r,isReply:ew}}}).fire())}(0,n("8dA1U").handleMutationFailure)({experienceTracker:V,experienceName:n("irVI7").DELETE_PAGE_COMMENT_EXPERIENCE,error:t,commentId:e_})})},ej=(0,a.useCallback)(eF,[e_,D,ep,K,eD,V,l,B,S,ew,L,r,eS,k,c]),eU=(0,n("6mKj3").expValEquals)("cc_fe_performance_page_comments_stability","cohort","experiment")?ej:eF,eG=()=>{et(e_)},eK=(0,a.useCallback)(eG,[et,e_]),eB=(0,n("6mKj3").expValEquals)("cc_fe_performance_page_comments_stability","cohort","experiment")?eK:eG,eq=(0,a.useCallback)(({isCacheUpdateFailed:e})=>{l?.showErrorFlag({id:e_,title:eo(e?x.commentReopenCacheUpdateFailedFlagTitle:x.commentReopenFailedFlagTitle),isAutoDismiss:!0,actions:[{content:eo(x.retryCTA),onClick:()=>{l.hideFlag(l.state.flags[0]?.id),v.current?.()}}]})},[e_,l,eo]),eW=(0,a.useCallback)((e,t)=>eu({mutationResult:t,commentId:e_,updateCallback:n("kgNLQ").reopenCommentInCacheCallback,onError:()=>eq({isCacheUpdateFailed:!0})}),[e_,eq,eu]),eH=()=>{ec({variables:{commentId:e_,cloudId:Q},update:(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?eW:void 0}).then(()=>{let e={...z},t=e[n("8i27m").CommentType.GENERAL][c];if(t){t.isOpen=!0,t.wasRemovedByAnotherUser=!1,G(e);let n=t.location;n&&"commentResolveProperties"in n&&n.commentResolveProperties&&(n.commentResolveProperties.resolved=!1)}l?.showSuccessCircleFlag({id:e_,title:eo(x.commentReopenedFlagTitle),isAutoDismiss:!0,actions:[{content:eo(n("9CnRS").i18n.goToCommentCTA),onClick:()=>{es?J(n("3mVfX").ViewValues.OPEN):em({openWithView:n("3mVfX").ViewValues.OPEN}),l.hideFlag(l.state.flags[0]?.id)}},{content:eo(n("9CnRS").i18n.undoCTA),onClick:()=>{R.current?.(),l.hideFlag(l.state.flags[0]?.id)}}]})}).catch(()=>{eq({isCacheUpdateFailed:!1})})},ez=(0,a.useCallback)(eH,[G,Q,e_,z,l,eo,eq,es,ec,eW,J,em,c]),eX=(0,a.useCallback)(e=>{(0,n("8dA1U").handleMutationFailure)({experienceTracker:V,experienceName:n("irVI7").RESOLVE_PAGE_COMMENT_EXPERIENCE,error:e})},[V]),eQ=(0,a.useCallback)((e,t)=>el({mutationResult:t,commentId:e_,updateCallback:n("kgNLQ").resolveCommentInCacheCallback,onError:eX}),[el,e_,eX]),e$=()=>{let e=n("eg9xl").ActiveCommentsQuery,t=(0,n("9rE3H").buildConsistentActiveCommentsQueryVariables)({pageId:L,type:"FOOTER"});ei({variables:{commentIds:[e_],cloudId:Q},update:(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?eQ:o=>{try{let a=o.readQuery({query:(0,n("86okN").toDocumentNode)(e),variables:t}),r=Object.assign({},a?.comments),s=r.totalCount||0,m=r.nodes?.filter(e=>null!==e),d=m.findIndex(e=>e.id===e_);-1!==d&&(m.splice(d,1),s--),o.writeQuery({query:(0,n("86okN").toDocumentNode)(e),variables:t,data:{comments:{__typename:"PaginatedCommentList",nodes:m,totalCount:s}}}),U&&q(!1)}catch(e){N.error`An error occurred when updating cache for comments panel resolve - ${e}`,q(!0)}}}).then(()=>{let e={...z};if(e[n("8i27m").CommentType.GENERAL][c]){e[n("8i27m").CommentType.GENERAL][c].isOpen=!1;let t=e[n("8i27m").CommentType.GENERAL][c].location;t&&t.commentResolveProperties&&(t.commentResolveProperties.resolved=!0),G(e)}(0,n("8dA1U").handleResolveSuccess)({commentId:e_,parentCommentMarkerRef:c,pageId:L,pageMode:r,source:n("en1dX").AnalyticsSource.PAGE_FOOTER,commentType:n("8i27m").CommentType.GENERAL,createAnalyticsEvent:D}),ed&&l?.showSuccessCircleFlag({id:e_,title:eo(n("9CnRS").i18n.resolvedFlagText),isAutoDismiss:!0,actions:[{content:eo(n("9CnRS").i18n.goToCommentCTA),onClick:()=>{es?J(n("3mVfX").ViewValues.RESOLVED):em({openWithView:n("3mVfX").ViewValues.RESOLVED}),er({annotationId:c}),l.hideFlag(l.state.flags[0]?.id)}},{content:eo(n("9CnRS").i18n.undoCTA),onClick:()=>{es||(0,n("9wGTI").fg)("confluence_comments_dont_open_cp_on_reopen")||em({openWithView:n("3mVfX").ViewValues.OPEN}),v.current?.(),l.hideFlag(l.state.flags[0]?.id)}}]}),V.succeed({name:n("irVI7").RESOLVE_PAGE_COMMENT_EXPERIENCE})}).catch(e=>{eX(e)})},eY=(0,a.useCallback)(e$,[G,ed,U,Q,e_,z,D,V,l,eo,eX,es,L,r,ei,eQ,er,q,J,em,c]),eJ=(0,n("6mKj3").expValEquals)("cc_fe_performance_page_comments_stability","cohort","experiment")?eY:e$,eZ=(0,n("6mKj3").expValEquals)("cc_fe_performance_page_comments_stability","cohort","experiment")?ez:eH;R.current=eJ,v.current=eZ;let e0=m?.type??"",e1=m?.space?.id??"",e3=m?.operations||[],e2=e3.some(e=>e?.operation==="create"&&e?.targetType==="comment"),e6=(0,n("9wGTI").fg)("confluence_comment_use_comment_media_endpoint")?e2:e3.some(e=>e?.operation==="update"&&e?.targetType===e0),e4=eN?.resolved&&e_===ea,e8=!ew&&eV?["reopen"]:o;return Y?.has(e_)?e(a).createElement(w.EditComment,{pageId:L,date:eg??"",createdAtNonLocalized:eh,pageType:e0,commentId:e_,annotationId:c,spaceId:e1,content:eR??"",isReply:ew,displayCommentInViewMode:()=>{en(e_)},avatarUrl:eC??"",displayName:eE,dateUrl:eO??"",versionByDisplayName:eI??"",versionDate:eb??"",mode:r===n("cD1qu").PageMode.VIEW?"view":"edit",hasMediaUploadPermissions:e6,isFooterComment:!0,commentType:n("8i27m").CommentType.GENERAL,adjustForFooterReplies:y||!ew,isLastNestedFooterReply:h,isOffline:I}):e(a).createElement(A.CommentBody,{mode:"view",annotationId:c,userId:ef,avatarUrl:eC,displayName:eE,date:eg??"",dateUrl:eO??"",createdAt:ey??"",createdAtNonLocalized:eh??"",versionByDisplayName:eI??"",versionDate:eb??"",pageId:L,pageType:e0,commentId:e_??"",isReply:ew,isEdited:eA,parentCommentId:eS,permissions:eT,content:eR??"",permissionType:ev??void 0,supportedActions:e8,deleteComment:eU,editComment:eB,resolveComment:eJ,numReplies:eP,isUnread:d,isCommentActive:!0,isCommentsPanel:!0,isHovered:i,isResolvedByAnotherUser:ek,isFocused:e4,resolveProperties:eN,replyToComment:e=>{ee({parentCommentId:X?e:g||e,location:n("i6UMJ").LocationValue.FOOTER,user:{displayName:t?.author?.displayName,accountId:t?.author?.accountId}})},inheritedReactionsData:eM,isDeletedByAnotherUser:eL,currentlySelectedThreadKey:$,setCurrentlySelectedThreadKey:Z,commentType:n("8i27m").CommentType.GENERAL,adjustForNestedReplies:u,hideBranchingStyle:p,canAddComments:f,isThreadHovered:C,isParentCommentOpen:E,isFooterComment:!0,adjustForFooterNestedReplies:_,isOffline:I,showRepliesWithCurvedBorders:b,replyHasNestedObjects:T})};var k=n("cMvMc"),L=n("lLpk8"),D=n("lesF8"),F=n("hXzKU");let j=(0,n("eSUdr").default)`mutation ObjectCommentReplyEditorCreateGeneralReplyMutation($cloudId:ID!$input:CreateCommentInput!){createFooterComment(cloudId:$cloudId input:$input){id author{displayName profilePicture{path}permissionType ...on KnownUser{accountId}}body(representation:ATLAS_DOC_FORMAT){value}contentStatus createdAt{value}createdAtNonLocalized links{webui editui}location{type ...on FooterComment{commentResolveProperties{resolvedTime resolvedFriendlyDate resolvedUser resolved}}}parentId permissions{isEditable isRemovable isResolvable}version{by{displayName}when number}}}`,U=(0,n("ecnYn").xcss)({paddingTop:"space.100",paddingBottom:"space.100"}),G={marginLeft:"var(--ds-space-300, 24px)",height:"24px",marginRight:"var(--ds-space-050, 4px)"},K=({pageInfo:t,pageMode:o,setReplyView:r,parentComment:s,threadKey:m,replyToId:d,isOffline:i,customBeforeLeftForNestedReply:c})=>{let l=`object-comment-reply-editor-${d}`,[u]=(0,n("308Wd").useMutationInterop)(j),p=t?.id??"",f=t?.type??"",C=t?.space?.id??"",E=s.type,{addCommentInCache:_}=(0,n("NYiei").useAllCommentsData)({contentId:p,options:{skip:!0}}),g=(0,n("ag51I").useCreateObjectCommentMutation)(),{isReactionsEnabled:y}=(0,a.useContext)(n("8SCD6").ReactionsContext),{onChange:h,resetContentChanged:I}=(0,n("bSvtO").useCommentsContentActions)(),{cloudId:b}=(0,n("bQm3c").useSessionData)(),[{searchSessionId:T}]=(0,n("hl1Kw").useSearchSessionId)(),{createAnalyticsEvent:R}=(0,n("inPa6").useAnalyticsEvents)(),{addReplyToCommentThread:v}=(0,n("8i27m").useCommentsDataActions)(),{updateReadCommentsListState:S}=(0,n("fHAwL").useUnreadCommentsActions)(),[{replyToCommentId:w,replyToCommentUser:A},{setReplyToCommentId:P}]=(0,n("3mVfX").useCommentsPanel)(),[,O]=(0,a.useState)(""),M=(0,a.useContext)(n("1kHsc").ExperienceTrackerContext),x=t?.operations||[],N=x.some(e=>e?.operation==="create"&&e?.targetType==="comment"),V=(0,n("9wGTI").fg)("confluence_comment_use_comment_media_endpoint")?N:x.some(e=>e?.operation==="update"&&e?.targetType===f),k=(0,a.useCallback)(()=>{let e=n("irVI7").REPLY_TO_INLINE_COMMENT_LOAD_EXPERIENCE;E===n("8i27m").CommentType.GENERAL&&(e=n("irVI7").REPLY_TO_PAGE_COMMENT_LOAD_EXPERIENCE),M.succeed({name:e});let t=document.getElementById(l);t&&t.getBoundingClientRect().bottom>window.innerHeight&&t.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})},[E,M,l]),L=(0,a.useCallback)(({destroy:e=!1}={})=>{(!e||w!==d)&&(0,n("9wGTI").fg)("confluence_comment_fix_reply_discard")?P():(0,n("9wGTI").fg)("confluence_comment_fix_reply_discard")||P()},[w,d,P]),K=(0,a.useCallback)((e,t)=>(0,n("7qvmT").onSaveReply)({pageId:p,parentCommentId:d,cloudId:b,adf:e,onSuccess:t,pageMode:o,setCommentForEdit:O,createAnalyticsEvent:R,pageType:f,experienceTracker:M,createFooterReplyFn:u,createObjectReplyFn:(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?g:void 0,addCommentInCommentsDataManagerCacheFn:(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?_:void 0,addReplyToCommentThread:v,threadKey:m,updateReadCommentsListState:S,commentType:E,searchSessionId:T,isReactionsEnabled:y,setReplyView:r,setReplyToCommentId:P,resetContentChanged:I,analyticsSource:n("en1dX").AnalyticsSource.PAGE_FOOTER,isFooterComment:!0}),[S,m,P,r,T,I,d,v,b,E,R,u,_,g,M,y,p,o,f]),B=E===n("8i27m").CommentType.GENERAL?"page":E,q=e(a).createElement(n("6f0Oj").default,{xcss:U,id:l,testId:l},e(a).createElement(F.LazyCommentEditor,{pageId:p,pageType:f,content:(0,n("7qvmT").getAdfForQuickReplyMention)(A),appearance:"comment",EditorComponent:D.CommentEditor,onSaveComment:K,onContentChange:h,onEditorReady:k,commentMode:"reply",commentType:B,spaceId:C,showCancelButton:!0,useNewWarningModal:!0,hideWatchCheckbox:!0,expandEditor:!0,pageMode:"edit"===o?"edit":"view",hasMediaUploadPermissions:V,topLevelCommentId:s.id,shouldWarnOnInternalNavigation:!0,onCancelComment:L,isCommentsPanel:!1,isFooterComment:!0,wasRemovedByAnotherUser:s.wasRemovedByAnotherUser,isOffline:i}));return w?(0,n("6mKj3").expValEquals)("confluence_comments_tuneup","isEnabled",!0)?q:e(a).createElement(n("1Sjzs").WithCurvedBranchingStyle,{showDefaultStyles:!0,customStyles:{...G,...c&&{left:"-25px"}}},q):null},B=(0,n("cgtv4").defineMessages)({replyAriaLabel:{id:"object-comments.reply.aria-label",defaultMessage:"Reply by {authorName}, {timestamp}"}}),q=({parentReplyId:t,parentToRepliesMap:o,handleMouseEnter:r,handleMouseLeave:s,canAddComments:m,pageInfo:d,pageMode:i,threadKey:c,supportedTopLevelActions:l,hoveredCommentId:u,isTopLevelReply:p,parentComment:f,parentReplyButtonAllowed:C,setReplyView:E,isOffline:_,flags:g,isEditorExpanded:y})=>{let{commentsMarkedAsRead:h,replyToCommentId:I,location:b,footerEditCommentIds:T}=(0,n("3mVfX").useCommentsPanelState)(),{hasNestedComments:R}=(0,n("8i27m").useCommentsDataState)(),v=(0,n("4L9ve").useProcessedCommentsDataState)(),S=(0,n("6mKj3").expValEquals)("cc_comments_new_comments_data_manager","isEnabled",!0)?v.hasNestedComments:R,[w,A]=(0,a.useState)(null),P=(0,n("8C5kA").default)(),{formatMessage:O}=P,{unreadCommentIDSet:M}=(0,n("fHAwL").useUnreadCommentsState)(),x=f.isOpen,N=o[t],k=(0,a.useCallback)((e,t)=>{e.stopPropagation(),A(t)},[A]),L=(0,a.useCallback)(e=>{e.relatedTarget&&e.currentTarget.contains(e.relatedTarget)||A(null)},[A]);return e(a).createElement("div",{"data-testId":"footer-reply-container",role:"list",className:(0,n("gMc0m").default)([p?"_1e0c1txw _2lx21bp4":"_1e0c1txw _2lx21bp4 _18u0pxbi",(0,n("9wGTI").fg)("confluence-fe-footer-comment-left-border")&&p&&!(0,n("6mKj3").expValEquals)("confluence_comments_tuneup","isEnabled",!0)&&"_kqswh2mm _1n1j11qs _1kt9b3bt _1cs8stnw _qnecidpf _1aukidpf _19woidpf"])},N.map((R,v)=>{let A=o[R.id]?.length>0,D=v===N.length-1,F=R.id===I&&b===n("i6UMJ").LocationValue.FOOTER,j=(0,n("6mKj3").expValEquals)("confluence_frontend_prevent_new_nested_comments","isEnabled",!0)?S&&F:F,U=C&&p,G=A||j,W=T?.has(R.id),H=U||G&&!D||W&&!D,z=(0,n("6mKj3").expValEquals)("confluence_comments_tuneup","isEnabled",!0)?D&&!y:U||G||!U&&D,X=z&&(!D||U),Q=D&&!p;return e(a).createElement("div",{key:R.id,id:`${n("i6UMJ").LocationValue.FOOTER}-comment-thread-${R.id}-replies`,"data-testid":`comment-thread-${t}-replies-${R.id}`,onMouseEnter:()=>r(R.id),onMouseLeave:s,onFocus:e=>k(e,R.id),onBlur:L,role:"listitem","aria-label":O(B.replyAriaLabel,{authorName:R.author?.displayName||O(n("3ejfs").commentsi18n.anonymous),timestamp:(0,n("6faGq").formatTimestampForAriaLabel)({intl:P,dateString:R.createdAtNonLocalized,isReply:!0})}),...(0,n("6mKj3").expVal)("confluence_frontend_comments_a11y_kb_exp","isEnabled",!1)?{tabIndex:0}:{},className:(0,n("gMc0m").default)(["_qtt8glyw _kqswh2mm _19bv1ejb",(0,n("9wGTI").fg)("confluence-fe-footer-comment-left-border")&&"_kqswh2mm _1n1j11qs _4k1c11qs _1kt9b3bt _1cs8stnw _qnecidpf _1aukidpf _1mp41gif _kfgt1tcg _fik81mok _13y0usvi",H&&!(0,n("9wGTI").fg)("confluence-fe-footer-comment-left-border")&&"_1kl711qs",H&&G&&(0,n("9wGTI").fg)("confluence_comment_nested_footer_border")&&"_16qsuq84"])},e(a).createElement("div",{className:(0,n("gMc0m").default)([!W&&"_n3tdu2gc"])},e(a).createElement(V,{comment:R,supportedTopLevelActions:l,pageInfo:d,pageMode:i,isUnread:(0,n("9wGTI").fg)("confluence_frontend_unread_comments_fixes")?M.has(R.id):!h[n("8i27m").CommentType.GENERAL][c]?.has(R.id)&&R.isUnread,isHovered:u===R.id||w===R.id&&(0,n("6mKj3").expVal)("confluence_frontend_comments_a11y_kb_exp","isEnabled",!1),threadKey:c,hideBranchingStyle:z,adjustForNestedReplies:!1,canAddComments:m,isParentCommentOpen:x,adjustForFooterNestedReplies:X&&!(0,n("9wGTI").fg)("confluence-fe-footer-comment-left-border"),topLevelParentCommentId:f.id,commentHasChildren:A,isLastNestedFooterReply:Q,flags:g,showRepliesWithCurvedBorders:!(0,n("9wGTI").fg)("confluence-fe-footer-comment-left-border")&&void 0,replyHasNestedObjects:G})),j&&e(a).createElement("div",{className:(0,n("gMc0m").default)(["_1e0c1txw _2lx21bp4 _18u0pxbi",A&&"_1kl711qs"])},e(a).createElement(K,{pageInfo:d,pageMode:i,setReplyView:E,parentComment:f,threadKey:c,replyToId:R.id,isOffline:_,customBeforeLeftForNestedReply:X})),o[R.id]?.length>0&&e(a).createElement(q,{parentReplyId:R.id,parentToRepliesMap:o,handleMouseEnter:r,handleMouseLeave:s,canAddComments:m,pageInfo:d,pageMode:i,threadKey:c,supportedTopLevelActions:l,hoveredCommentId:u,isTopLevelReply:!1,parentComment:f,parentReplyButtonAllowed:!1,setReplyView:E,isOffline:_,flags:g,isEditorExpanded:y}))}))},W={marginLeft:"var(--ds-space-150, 12px)",width:"62px",height:"24px",left:"-12px",paddingTop:"var(--ds-space-100, 8px)",paddingBottom:"var(--ds-space-100, 8px)"},H=(0,n("cgtv4").defineMessages)({replyAction:{id:"object-comments.reply.action",defaultMessage:"Reply"}}),z=({parentComment:t,pageInfo:o,isCurrentSelectedComment:r,hoveredCommentId:s,pageMode:m,parentCommentId:d,handleMouseEnter:i,handleMouseLeave:c,canAddComments:l,isOffline:u=!1,flags:p,isEditorExpanded:f})=>{let{hasContentChanged:C}=(0,n("bSvtO").useCommentsContentState)(),{resetContentChanged:E}=(0,n("bSvtO").useCommentsContentActions)(),[{commentsMarkedAsRead:_,replyToCommentId:g,location:y},{setCommentsInThreadToBeMarkedAsRead:h,setReplyToCommentId:I}]=(0,n("3mVfX").useCommentsPanel)(),b=(0,a.useMemo)(()=>t.replies.filter(e=>null!==e),[t.replies]),T=b.length,{unreadCommentIDSet:R}=(0,n("fHAwL").useUnreadCommentsState)(),v=(0,a.useMemo)(()=>b.filter(e=>(0,n("9wGTI").fg)("confluence_frontend_unread_comments_fixes")?R.has(e.id):e.isUnread).map(e=>e.id),[b,R]),[S,w]=(0,a.useState)(!0),[A,P]=(0,a.useState)([]),{showModal:O}=(0,n("8aF6s").useDialogs)(),M=t.type,x=t.isOpen,[N,V]=(0,a.useState)(n("ibqdE").ViewReplyOptions.ALL),D=M===n("8i27m").CommentType.INLINE?(t?.location).inlineMarkerRef||"":d,F=x?["edit","resolve","delete"]:["reopen"],j=d===g&&y===n("i6UMJ").LocationValue.FOOTER,U=(0,n("6mKj3").expValEquals)("confluence_frontend_prevent_new_nested_comments","isEnabled",!0)?f:j,G=(0,a.useMemo)(()=>(0,n("9wGTI").fg)("confluence_frontend_unread_comments_fixes")?[]:A.filter(e=>{let t=_[M][D];return(!t||!t.has(e.id))&&e.isUnread}).map(e=>e.id),[A,_,D,M]),B=(0,a.useRef)(N===n("ibqdE").ViewReplyOptions.ALL?0:T-A.length),z=(0,a.useMemo)(()=>{let e=new Set(b.filter(e=>e.parentId===d).map(e=>e.id)),t=Array.from(e).reduce((e,t)=>(e[t]=[],e),{}),n=b.reduce((e,t)=>(e[t.id]=t,e),{});for(let o of b.filter(t=>!e.has(t.id))){let a=o.parentId,r=0;for(;a&&r<100&&!e.has(a);)a=n[a]?.parentId,r++;a&&a in t&&t[a].push(o)}return t},[b,d]),X=(0,a.useMemo)(()=>{let e=[],t=b.filter(e=>e.id in z);t.sort((e,t)=>{let o=(0,n("6faGq").getValidDate)(e?.createdAtNonLocalized),a=(0,n("6faGq").getValidDate)(t?.createdAtNonLocalized);return o.getTime()-a.getTime()});for(let o=0;o<n("ibqdE").DEFAULT_NUM_VISIBLE_REPLIES;o++)if(t.length>0){let n=t.pop();n&&e.unshift(n)}return e},[b,z]),Q=(0,a.useMemo)(()=>{let e=new Set;for(let t of X)for(let n of(e.add(t.id),z[t.id]))e.add(n.id);return e},[X,z]),$=(0,a.useMemo)(()=>{let e={[d]:[],...b.reduce((e,t)=>({...e,[t.id]:[]}),{})};for(let t of b)t.parentId&&t.parentId in e&&e[t.parentId].push(t);return e},[b,d]);(0,a.useEffect)(()=>{!(0,n("9wGTI").fg)("confluence_frontend_unread_comments_fixes")&&r&&h({threadKey:D,commentIds:G,commentType:M})},[r]),(0,n("8gR6k").useUpdateVisibleReplies)({allReplies:b,commentType:M,isParentCommentOpen:x,currentReplyView:N,latestReplies:X,latestReplyIds:Q,parentCommentId:d,setVisibleReplies:P,shouldShowLatestReplies:S,numOfHiddenReplies:B,allowNestedReplies:!0});let Y=()=>{C?O(k.CommentWarningDialog,{onConfirm:()=>{E(),I({parentCommentId:d,location:n("i6UMJ").LocationValue.FOOTER})}}):I({parentCommentId:d,location:n("i6UMJ").LocationValue.FOOTER})},J=x&&l,Z=()=>e(a).createElement(n("58Zuw").RepliesToggler,{replies:b,setVisibleReplies:P,unreadReplyIds:v,setReplyView:V,threadKey:D,currentReplyView:N,numOfHiddenReplies:B,commentType:M,parentCommentId:d,isParentOpen:x,canAddComments:l,shouldShowLatestReplies:S,setShouldShowLatestReplies:w,latestReplyIds:Q,onMouseEnter:i,onMouseLeave:c,analyticsSource:n("en1dX").AnalyticsSource.PAGE_FOOTER,expandReplyEditor:U});return e(a).createElement(e(a).Fragment,null,T>0&&(0,n("6mKj3").expValEquals)("confluence_comments_tuneup","isEnabled",!0)&&Z(),e(a).createElement("div",{"data-testid":`${n("i6UMJ").LocationValue.FOOTER}-comment-thread-${t.id}-replies`,className:(0,n("gMc0m").default)(["_1e0c1txw _2lx21bp4 _19bvpxbi _u5f3u2gc",t.wasRemovedByAnotherUser&&"_tzy41ssb"])},T>0&&!(0,n("6mKj3").expValEquals)("confluence_comments_tuneup","isEnabled",!0)&&Z(),A.length>0&&e(a).createElement(q,{parentReplyId:d,parentToRepliesMap:$,handleMouseEnter:i,handleMouseLeave:c,canAddComments:l,pageInfo:o,pageMode:m,threadKey:D,supportedTopLevelActions:F,hoveredCommentId:s,isTopLevelReply:!0,parentComment:t,parentReplyButtonAllowed:J,setReplyView:V,isOffline:u,flags:p,isEditorExpanded:f}),(0,n("6mKj3").expValEquals)("confluence_comments_tuneup","isEnabled",!0)?e(a).createElement(L.RepliesFooter,{replyView:N,setReplyView:V,isEditorExpanded:f,isParentCommentOpen:x,handleReplyButtonClick:Y,numOfVisibleReplies:A?A.length:0,isOffline:u,scrollToId:d,location:n("i6UMJ").LocationValue.FOOTER},e(a).createElement(K,{pageInfo:o,pageMode:m,setReplyView:V,parentComment:t,threadKey:D,replyToId:d,isOffline:u})):U?e(a).createElement(K,{pageInfo:o,pageMode:m,setReplyView:V,parentComment:t,threadKey:D,replyToId:d,isOffline:u}):J&&e(a).createElement(n("1Sjzs").WithCurvedBranchingStyle,{showDefaultStyles:!0,customStyles:W,testId:"comments-panel-reply-comment-action",onClick:Y},e(a).createElement(n("ccHMk").default,{"data-cy":"comments-panel-reply-comment-action",appearance:"subtle",isDisabled:!x||u,analyticsContext:{attributes:{name:"replyToCommentButton",source:n("en1dX").AnalyticsSource.COMMENTS_PANEL}},interactionName:"comments-panel-reply-comment-action",className:(0,n("gMc0m").default)(["_1tv3glyw"])},e(a).createElement(n("gtD4K").default,H.replyAction)))))},X=(0,n("ecnYn").xcss)({listStyle:"none",position:"relative",paddingLeft:"space.200",paddingRight:"space.250",paddingTop:"space.100",paddingBottom:"space.200",margin:"0",display:"flex",flexDirection:"column",":focus":{outlineOffset:"space.negative.025"},":focus-visible":{outlineOffset:"space.negative.025"}}),Q=(0,n("ecnYn").xcss)({cursor:"pointer"}),$=(0,n("ecnYn").xcss)({display:"flex",gap:"space.050",paddingTop:"space.300",paddingRight:"space.300",paddingBottom:"space.150",paddingLeft:"space.200",borderWidth:"border.width",borderStyle:"solid",borderColor:"color.border"}),Y=(0,n("ecnYn").xcss)({listStyle:"none",position:"relative",marginRight:"space.100"}),J=(0,n("ecnYn").xcss)({background:"var(--ds-background-input-hovered, #F8F8F8)"}),Z=(0,n("ecnYn").xcss)({background:"var(--ds-background-input-hovered, #F8F8F8)"}),ee=(0,n("cgtv4").defineMessages)({commentTypeSeperatorText:{id:"object-comments.comment.thread.type-seperator",defaultMessage:"General comments"},threadContentAriaLabelWithName:{id:"object-comments.thread.content.aria-label.with-name",defaultMessage:"{name}s comment thread"}}),et=(0,n("dPJCf").createSingleQueryParamHook)("focusedCommentId"),en=(0,n("dPJCf").createSingleQueryParamHook)("replyToComment"),eo=({parentComment:t,supportedTopLevelActions:o,pageMode:r,flags:m,shouldRenderCommentTypeSeparator:d,isLastThread:i,onLastThreadRendered:c,isOffline:l})=>{let{formatMessage:u}=(0,n("8C5kA").default)(),[{currentlySelectedThreadKey:p,commentsMarkedAsRead:f},{setCurrentlySelectedThreadKey:C,setCommentsInThreadToBeMarkedAsRead:E}]=(0,n("3mVfX").useCommentsPanel)(),{pageInfo:_}=(0,n("cAdj8").usePageInfo)(),{handleMarkCommentsAsRead:g}=(0,n("9buj5").useUnreadPanelComments)(),{unreadCommentIDSet:y}=(0,n("fHAwL").useUnreadCommentsState)(),{scrollCommentsPanelToThread:h}=(0,n("6KwrO").useCommentsPanelScroll)(),{isCommentsPanelShown:I}=(0,s.useShowCommentsPanel)(),b=(0,n("e4o8D").useRenderServerPlaceholder)(),T=t.id,[R,v]=(0,a.useState)(!1),[S,w]=(0,a.useState)(!1),[A,P]=(0,a.useState)(void 0),[O,M]=(0,a.useState)(!1),x=et(),N=en(),k=(0,n("7wP5b").useIsEditorExpanded)(t,n("i6UMJ").LocationValue.FOOTER),L=(0,a.useRef)(null),D=p===T,{canAddComments:F}=(0,n("dANtQ").useAddCommentPermissionCheck)(_?.id??"",!0);(0,a.useEffect)(()=>{!(0,n("9wGTI").fg)("confluence_frontend_unread_comments_fixes")&&D&&Object.keys(f.general).length>0&&g()},[f,g,D]);let j=(0,a.useRef)(new Set),U=(0,a.useRef)(null);(0,a.useEffect)(()=>{if((0,n("9wGTI").fg)("confluence_frontend_unread_comments_fixes")||!(0,n("9wGTI").fg)("confluence-fe-comment-scroll-to-read")||b||!L.current)return;let e=e=>{e.isIntersecting&&e.intersectionRatio>0&&(t.isUnread&&!f[t.type][T]?.has(t.id)&&j.current.add(t.id),t.replies.forEach(e=>{e.isUnread&&!f[t.type][T]?.has(e.id)&&j.current.add(e.id)}),U.current&&clearTimeout(U.current),U.current=setTimeout(()=>{let e=Array.from(j.current);e.length>0&&(E({threadKey:T,commentIds:e,commentType:t.type}),j.current.clear(),g())},2e3))},o=new IntersectionObserver(t=>{e(t[0])},{threshold:[0,1],rootMargin:"0px 0px -10% 0px"});return o.observe(L.current),()=>{o.disconnect(),U.current&&clearTimeout(U.current)}},[t.isUnread,t.id,t.type,t.replies,T,E,f,g,b]),(0,a.useEffect)(()=>{if((0,n("9wGTI").fg)("confluence_frontend_unread_comments_fixes")||!(0,n("9wGTI").fg)("confluence-fe-comment-scroll-to-read")||!t.isUnread)return;let e=x||N;e&&e===t.id&&E({threadKey:T,commentIds:[t.id],commentType:t.type})},[t.isUnread,t.id,t.type,T,E,x,N]);let G=(0,a.useMemo)(()=>({threadKey:T,setIsThreadHovered:v,setHoveredCommentId:P,pageMode:r}),[T,v,P,r]),K=(0,a.useCallback)(e=>{(0,n("cZRYC").handleCommentThreadMouseEnter)({...G,id:e})},[G]),B=(0,a.useCallback)(()=>{(0,n("cZRYC").handleCommentThreadMouseLeave)(G)},[G]),q=(0,a.useCallback)(e=>{e.stopPropagation(),M(!0)},[M]),W=(0,a.useCallback)(e=>{e.relatedTarget&&e.currentTarget.contains(e.relatedTarget)||M(!1)},[M]),H=(0,a.useRef)(!1);D&&!H.current&&t.isUnread&&!(0,n("9wGTI").fg)("confluence_frontend_unread_comments_fixes")&&(E({threadKey:T,commentIds:[t.id],commentType:t.type}),H.current=!0);let eo=t?.wasRemovedByAnotherUser,ea=eo&&eo===n("8i27m").CommentActionType.RESOLVE_COMMENT_THREAD;(0,a.useEffect)(()=>{if(!(0,n("9wGTI").fg)("confluence_frontend_unread_comments_fixes")&&ea){let e=[];t.isUnread&&e.push(t.id);let n=t.replies.filter(e=>e.isUnread);n.length>0&&e.push(...n.map(e=>e.id)),e.length>0&&E({threadKey:T,commentIds:e,commentType:t.type})}},[]);let er=()=>{D||((0,n("6mKj3").expValEquals)("cc_comments_common_refactor","isEnabled",!0)||w(!0),C(T))};(0,a.useEffect)(()=>{if(!(0,n("6mKj3").expValEquals)("cc_comments_common_refactor","isEnabled",!0)){let e=t?.replies?.find(e=>e.id===p);D||e?w(!0):w(!1)}},[p,D,t?.replies]),(0,a.useEffect)(()=>{i&&c&&"boolean"==typeof i&&c()},[i,c]);let es=()=>{C(T),I&&(0,n("9wGTI").fg)("confluence_comments_footer_panel_syn_scroll")?(0,n("9FoVw").handleCommentsPanelNavigation)({annotationId:T,commentType:"FOOTER",scrollBehavior:n("9FoVw").ScrollBehavior.SMOOTH,block:"center",context:n("9FoVw").NavigationContext.PANEL}):h({annotationId:T,commentType:n("8i27m").CommentType.GENERAL})};return(0,n("6mKj3").expValEquals)("cc_comments_common_refactor","isEnabled",!0)?e(a).createElement(n("i8TeS").BaseCommentThread,{commentThreadRef:L,commentComponent:t=>e(a).createElement(V,{...t,supportedTopLevelActions:o,flags:m,isOffline:l}),commentRepliesComponent:t=>e(a).createElement(z,{...t,isOffline:l,flags:m}),parentComment:t,pageMode:r,shouldRenderCommentTypeSeparator:d,canAddComments:F,handleCommentThreadClick:es,handleCommentThreadMouseDown:er,testIdPrefix:n("i6UMJ").LocationValue.FOOTER,isEditorExpanded:k}):e(a).createElement(e(a).Fragment,null,d&&e(a).createElement(n("bUlM5").default,{xcss:$,as:"li",testId:"comment-section-separator",alignItems:"center"},e(a).createElement(e(n("8jHAi")),{testId:"general-comment-page-icon",color:"var(--ds-icon-subtlest, #6B6E76)",label:u(ee.commentTypeSeperatorText)}),e(a).createElement(n("5dK2X").default,{color:"color.text.subtlest",weight:"medium"},u(ee.commentTypeSeperatorText))),e(a).createElement(n("6f0Oj").default,{ref:L,id:`${n("i6UMJ").LocationValue.FOOTER}-comment-thread-${T}-container`,testId:`${n("i6UMJ").LocationValue.FOOTER}-comment-thread-${T}-container`,xcss:[X,D&&J,!D&&S&&Z,Q],onClick:es,onMouseDown:er,onMouseUp:()=>w(!1),onFocus:q,onBlur:W,...(0,n("6mKj3").expVal)("confluence_frontend_comments_a11y_kb_exp","isEnabled",!1)?{tabIndex:0,"aria-label":u(ee.threadContentAriaLabelWithName,{name:t.author?.displayName||u(n("3ejfs").commentsi18n.anonymous)})}:{}},e(a).createElement(n("6f0Oj").default,{testId:`${n("i6UMJ").LocationValue.FOOTER}-comment-thread-${t.id}-parent`,xcss:Y,onMouseEnter:()=>K(t.id),onMouseLeave:B},e(a).createElement(V,{comment:t,supportedTopLevelActions:o,pageInfo:_,pageMode:r,isUnread:(0,n("9wGTI").fg)("confluence_frontend_unread_comments_fixes")?y.has(t.id):!f[t.type][T]?.has(t.id)&&t.isUnread,isHovered:A===t.id||O&&(0,n("9wGTI").fg)("confluence_comments_hover_state_on_focused_comment"),threadKey:T,flags:m,hideBranchingStyle:(0,n("6mKj3").expValEquals)("confluence_comments_tuneup","isEnabled",!0)?0===t.replies.length&&!k:(!t.isOpen||!F)&&0===t.replies.length,canAddComments:F,isThreadHovered:R,isOffline:l})),e(a).createElement(z,{parentComment:t,pageInfo:_,isCurrentSelectedComment:D,hoveredCommentId:A??"",pageMode:r,parentCommentId:t.id,handleMouseEnter:K,handleMouseLeave:B,canAddComments:F,isOffline:l,flags:m,isEditorExpanded:k})))},ea=(0,E.isReactCompilerActiveV1)()?t=>{let o,r,s,m,d=(0,_.c)(13),{commentThreads:i,supportedTopLevelActions:c,flags:l,onAllCommentsRendered:u,onCommentBatchRendered:p,isOffline:f}=t;d[0]!==i?(o=e=>e===i.length-1,d[0]=i,d[1]=o):o=d[1];let C=o;d[2]!==l||d[3]!==C||d[4]!==f||d[5]!==u||d[6]!==p||d[7]!==c?(r={supportedTopLevelActions:c,flags:l,onLastThreadRendered:u,onCommentBatchRendered:p,isLastThread:C,isOffline:f},d[2]=l,d[3]=C,d[4]=f,d[5]=u,d[6]=p,d[7]=c,d[8]=r):r=d[8];let E=r;return d[9]===Symbol.for("react.memo_cache_sentinel")?(s=(0,n("gMc0m").default)(["_18m9ewfl _1reoewfl _16jlkb7n _1e0c1ule"]),d[9]=s):s=d[9],d[10]!==i||d[11]!==E?(m=e(a).createElement("div",{id:"object-comments-list-container","data-testid":"object-comments-list-container",className:s},e(a).createElement(n("3cu4A").CommentBatchList,{commentsList:i,passThroughProps:E,Component:eo,getElementsToBatch:n("7qvmT").getCommentThreadsToBatch})),d[10]=i,d[11]=E,d[12]=m):m=d[12],m}:({commentThreads:t,supportedTopLevelActions:o,flags:r,onAllCommentsRendered:s,onCommentBatchRendered:m,isOffline:d})=>{let i=(0,a.useCallback)(e=>e===t.length-1,[t]);return e(a).createElement("div",{id:"object-comments-list-container","data-testid":"object-comments-list-container",className:(0,n("gMc0m").default)(["_18m9ewfl _1reoewfl _16jlkb7n _1e0c1ule"])},e(a).createElement(n("3cu4A").CommentBatchList,{commentsList:t,passThroughProps:{supportedTopLevelActions:o,flags:r,onLastThreadRendered:s,onCommentBatchRendered:m,isLastThread:i,isOffline:d},Component:eo,getElementsToBatch:n("7qvmT").getCommentThreadsToBatch}))},er=(0,n("ecnYn").xcss)({borderTop:"var(--ds-border-width, 1px) solid var(--ds-border, #0B120E24)",background:"color.text.inverse",height:"64px",width:"100%",display:"flex",padding:"space.200",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"}),es=(0,n("ecnYn").xcss)({display:"flex",alignItems:"center",justifyContent:"flex-end",alignSelf:"stretch"}),em=(0,n("cgtv4").defineMessages)({objectCommentHeaderText:{id:"object-comments.object-comment-header.text",defaultMessage:"Comments"}}),ed=(0,a.forwardRef)((0,E.isReactCompilerActiveV1)()?(t,o)=>{let r,s,m,d,i,c,l=(0,_.c)(13);if(l[0]!==o||l[1]!==t){let{as:e,style:a,...c}=t;r=void 0===e?"span":e,s=c,m=a,d=o,i=(0,n("gMc0m").default)(["_11c8lodh _syazazsu _ect44w24 _k48p1wq8",c.className]),l[0]=o,l[1]=t,l[2]=r,l[3]=s,l[4]=m,l[5]=d,l[6]=i}else r=l[2],s=l[3],m=l[4],d=l[5],i=l[6];return l[7]!==r||l[8]!==s||l[9]!==m||l[10]!==d||l[11]!==i?(c=e(a).createElement(r,{...s,style:m,ref:d,className:i}),l[7]=r,l[8]=s,l[9]=m,l[10]=d,l[11]=i,l[12]=c):c=l[12],c}:({as:t="span",style:o,...r},s)=>e(a).createElement(t,{...r,style:o,ref:s,className:(0,n("gMc0m").default)(["_11c8lodh _syazazsu _ect44w24 _k48p1wq8",r.className])})),ei=(0,E.isReactCompilerActiveV1)()?t=>{let o,r,s,m,d=(0,_.c)(10),{isOffline:i,showReactions:c}=t,l=void 0!==i&&i,{formatMessage:u}=(0,n("8C5kA").default)();return d[0]!==u?(o=u(em.objectCommentHeaderText),d[0]=u,d[1]=o):o=d[1],d[2]!==o?(r=e(a).createElement(ed,null,o),d[2]=o,d[3]=r):r=d[3],d[4]!==l||d[5]!==c?(s=c&&e(a).createElement(n("6f0Oj").default,{xcss:es},e(a).createElement(b,{isOffline:l})),d[4]=l,d[5]=c,d[6]=s):s=d[6],d[7]!==r||d[8]!==s?(m=e(a).createElement(n("6f0Oj").default,{xcss:er},r,s),d[7]=r,d[8]=s,d[9]=m):m=d[9],m}:({isOffline:t=!1,showReactions:o})=>{let{formatMessage:r}=(0,n("8C5kA").default)();return e(a).createElement(n("6f0Oj").default,{xcss:er},e(a).createElement(ed,null,r(em.objectCommentHeaderText)),o&&e(a).createElement(n("6f0Oj").default,{xcss:es},e(a).createElement(b,{isOffline:t})))};var ec=n("b4BfG"),el=n("56QzY");let eu=(0,n("eSUdr").default)`mutation ObjectAddCommentEditorCreateGeneralCommentMutation($cloudId:ID!$input:CreateCommentInput!){createFooterComment(cloudId:$cloudId input:$input){id author{displayName profilePicture{path}permissionType ...on KnownUser{accountId}}body(representation:ATLAS_DOC_FORMAT){value}contentStatus createdAt{value}createdAtNonLocalized links{webui editui}location{type ...on FooterComment{commentResolveProperties{resolvedTime resolvedFriendlyDate resolvedUser resolved}}}parentId permissions{isEditable isRemovable isResolvable}version{by{displayName}when number}}}`,ep=(0,E.isReactCompilerActiveV1)()?t=>{let o,r,s,m,d,i,c,l,u,p,f,C=(0,_.c)(53),{isOffline:E,setAutoFocusPromptRef:g,handleCancel:y}=t,{isReactionsEnabled:h}=(0,a.useContext)(n("8SCD6").ReactionsContext),I=(0,a.useContext)(n("1kHsc").ExperienceTrackerContext),{createAnalyticsEvent:b}=(0,n("inPa6").useAnalyticsEvents)(),{closeCommentContainer:T}=(0,n("fNzRA").useObjectCommentDispatchContext)(),{footerEditorEntry:R}=(0,n("fNzRA").useObjectCommentContext)(),[v]=(0,n("ep3mz").usePageContentId)(),[S]=(0,n("hl1Kw").useSearchSessionId)(),{searchSessionId:w}=S,{setCurrentlySelectedThreadKey:A,setAddFooterCommentAdf:P}=(0,n("3mVfX").useCommentsPanelActions)(),{hasContentChanged:O}=(0,n("bSvtO").useCommentsContentState)(),{onChange:M,resetContentChanged:x}=(0,n("bSvtO").useCommentsContentActions)(),{addNewCommentThreads:N}=(0,n("8i27m").useCommentsDataActions)(),{updateReadCommentsListState:V}=(0,n("fHAwL").useUnreadCommentsActions)(),{scrollCommentsPanelToThread:k}=(0,n("6KwrO").useCommentsPanelScroll)(),L=(0,n("aSsfA").useGetPageMode)(),[D]=(0,n("ep3mz").useContentType)(),{cloudId:F}=(0,n("bQm3c").useSessionData)(),[j]=(0,n("308Wd").useMutationInterop)(eu),U=v||"";C[0]===Symbol.for("react.memo_cache_sentinel")?(o={skip:!0},C[0]=o):o=C[0],C[1]!==U?(r={contentId:U,options:o},C[1]=U,C[2]=r):r=C[2];let{addCommentInCache:G}=(0,n("NYiei").useAllCommentsData)(r),K=(0,n("ag51I").useCreateObjectCommentMutation)();C[3]!==P?(s=()=>{P(void 0)},C[3]=P,C[4]=s):s=C[4];let B=s;C[5]!==I?(m=e=>{I.stopOnError({name:n("irVI7").ADD_PAGE_COMMENT_PUBLISH_EXPERIENCE,error:e})},C[5]=I,C[6]=m):m=C[6];let q=m;C[7]!==G||C[8]!==q?(d=(e,t)=>{G({newComment:(0,n("ag51I").addEmptyObjectRepliesArray)(t.data.createFooterComment),onError:q})},C[7]=G,C[8]=q,C[9]=d):d=C[9];let W=d;C[10]!==N||C[11]!==B||C[12]!==T||C[13]!==F||C[14]!==v||C[15]!==D||C[16]!==b||C[17]!==j||C[18]!==K||C[19]!==I||C[20]!==q||C[21]!==R||C[22]!==h||C[23]!==L||C[24]!==x||C[25]!==k||C[26]!==w||C[27]!==A||C[28]!==W||C[29]!==V?(i=(e,t)=>{let o=v||"",{adf:a}=e;(0,n("8Ss4E").startEditorSubExperience)({name:n("irVI7").ADD_PAGE_COMMENT_PUBLISH_EXPERIENCE,timeout:n("aJPUt").ExperienceTimeout.EDITOR_PUBLISH});let r={cloudId:F,input:{commentBody:{value:JSON.stringify(a),representationFormat:n("kKAQX").ContentRepresentation.ATLAS_DOC_FORMAT},commentSource:n("kKAQX").Platform.WEB,containerId:o}};return((0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?K({variables:{...r,pageId:o},update:W}):j({variables:r,update:(0,n("87CZC").updateApolloCacheParentCallback)("create",{pageId:o,contentStatus:["DRAFT","CURRENT"],type:["FOOTER"]},h)})).then(e=>{let{data:o}=e,a={...o.createFooterComment,replies:[],isUnread:!1,isOpen:!0,type:n("8i27m").CommentType.GENERAL};V(e=>new Set([...e,a.id])),N({inline:{},general:{[a.id]:a}}),t&&t(),x(),B(),T(),b({type:"sendTrackEvent",data:{action:"created",actionSubject:"comment",actionSubjectId:a.id,objectType:D,objectId:v,source:n("en1dX").AnalyticsSource.PAGE_FOOTER,attributes:{commentType:n("en1dX").CommentType.PAGE,source:n("en1dX").AnalyticsSource.PAGE_FOOTER,pageMode:L,isReply:!1,pageType:D,isLivePage:L===n("cD1qu").PageMode.LIVE,editor:"v2",searchSessionId:w,navdexPointType:el.END,parentCommentId:null,isStickyFooter:R===n("3mVfX").AddFooterCommentMode.STICKY_DRAFT}}}).fire(),I.succeed({name:n("irVI7").ADD_PAGE_COMMENT_PUBLISH_EXPERIENCE}),(0,n("9wGTI").fg)("confluence_comments_unified_navigation")?(A(a.id,n("8i27m").CommentType.GENERAL),(0,n("9FoVw").handleFooterCommentsNavigation)({scrollBehavior:n("9FoVw").ScrollBehavior.SMOOTH,block:"center",inline:"center",commentId:a.id})):setTimeout(()=>{(0,n("7qvmT").handlePanelSelectionAndScroll)({threadKey:a.id,isResolved:!1,pageMode:L,setCurrentlySelectedThreadKey:A,eventEmitter:void 0,commentType:n("8i27m").CommentType.GENERAL,scrollCommentsPanelToThread:k,shouldScrollCommentsPanel:!0})},1e3)}).catch(e=>{if((0,n("9wGTI").fg)("confluence_fe_add_page_comment_exp_coverage")){let t=(0,n("lFkRf").getTranslatedError)(e);(0,n("lFkRf").isCreateNotPermittedError)(t)||(0,n("lFkRf").isViewNotPermittedError)(t)?(I.abort({name:n("irVI7").ADD_PAGE_COMMENT_PUBLISH_EXPERIENCE,reason:t.id}),I.abort({name:n("irVI7").ADD_PAGE_COMMENT_EXPERIENCE,reason:t.id})):q(e)}})},C[10]=N,C[11]=B,C[12]=T,C[13]=F,C[14]=v,C[15]=D,C[16]=b,C[17]=j,C[18]=K,C[19]=I,C[20]=q,C[21]=R,C[22]=h,C[23]=L,C[24]=x,C[25]=k,C[26]=w,C[27]=A,C[28]=W,C[29]=V,C[30]=i):i=C[30];let H=i;C[31]!==B||C[32]!==T||C[33]!==I||C[34]!==y||C[35]!==O||C[36]!==x||C[37]!==g?(c=e=>{let{isEditorAborted:t}=e;O&&x(),t&&(g?.(!0),I.abort({name:n("irVI7").ADD_PAGE_COMMENT_EXPERIENCE,reason:"aborted because comment was cancelled"})),B(),T(),y?.()},C[31]=B,C[32]=T,C[33]=I,C[34]=y,C[35]=O,C[36]=x,C[37]=g,C[38]=c):c=C[38];let z=c;C[39]!==I?(l=()=>{I.succeed({name:n("irVI7").ADD_PAGE_COMMENT_LOAD_EXPERIENCE});let e=document.querySelector('[data-testId="footerCommentEditor"]');e&&e.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})},C[39]=I,C[40]=l):l=C[40];let X=l;C[41]!==X?(u=()=>{X()},C[41]=X,C[42]=u):u=C[42];let Q=u;C[43]!==M||C[44]!==P?(p=(e,t)=>{e&&t?P(t):P(void 0),M(e)},C[43]=M,C[44]=P,C[45]=p):p=C[45];let $=p;return C[46]!==z||C[47]!==H||C[48]!==$||C[49]!==Q||C[50]!==X||C[51]!==E?(f=e(a).createElement(ec.PageCommentEditor,{mode:"create",saveHandler:H,cancelHandler:z,onEditorLoaded:X,onEditorReady:Q,onEditorContentChangedWithData:$,useNewExperienceAbort:!0,expandEditor:!0,isFooterComment:!0,isOffline:E}),C[46]=z,C[47]=H,C[48]=$,C[49]=Q,C[50]=X,C[51]=E,C[52]=f):f=C[52],f}:({isOffline:t,setAutoFocusPromptRef:o,handleCancel:r})=>{let{isReactionsEnabled:s}=(0,a.useContext)(n("8SCD6").ReactionsContext),m=(0,a.useContext)(n("1kHsc").ExperienceTrackerContext),{createAnalyticsEvent:d}=(0,n("inPa6").useAnalyticsEvents)(),{closeCommentContainer:i}=(0,n("fNzRA").useObjectCommentDispatchContext)(),{footerEditorEntry:c}=(0,n("fNzRA").useObjectCommentContext)(),[l]=(0,n("ep3mz").usePageContentId)(),[{searchSessionId:u}]=(0,n("hl1Kw").useSearchSessionId)(),{setCurrentlySelectedThreadKey:p,setAddFooterCommentAdf:f}=(0,n("3mVfX").useCommentsPanelActions)(),{hasContentChanged:C}=(0,n("bSvtO").useCommentsContentState)(),{onChange:E,resetContentChanged:_}=(0,n("bSvtO").useCommentsContentActions)(),{addNewCommentThreads:g}=(0,n("8i27m").useCommentsDataActions)(),{updateReadCommentsListState:y}=(0,n("fHAwL").useUnreadCommentsActions)(),{scrollCommentsPanelToThread:h}=(0,n("6KwrO").useCommentsPanelScroll)(),I=(0,n("aSsfA").useGetPageMode)(),[b]=(0,n("ep3mz").useContentType)(),{cloudId:T}=(0,n("bQm3c").useSessionData)(),[R]=(0,n("308Wd").useMutationInterop)(eu),{addCommentInCache:v}=(0,n("NYiei").useAllCommentsData)({contentId:l||"",options:{skip:!0}}),S=(0,n("ag51I").useCreateObjectCommentMutation)(),w=(0,a.useCallback)(()=>{f(void 0)},[f]),A=(0,a.useCallback)(e=>{m.stopOnError({name:n("irVI7").ADD_PAGE_COMMENT_PUBLISH_EXPERIENCE,error:e})},[m]),P=(0,a.useCallback)((e,t)=>{v({newComment:(0,n("ag51I").addEmptyObjectRepliesArray)(t.data.createFooterComment),onError:A})},[v,A]),O=()=>{m.succeed({name:n("irVI7").ADD_PAGE_COMMENT_LOAD_EXPERIENCE});let e=document.querySelector('[data-testId="footerCommentEditor"]');e&&e.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})};return e(a).createElement(ec.PageCommentEditor,{mode:"create",saveHandler:(e,t)=>{let o=l||"",{adf:a}=e;(0,n("8Ss4E").startEditorSubExperience)({name:n("irVI7").ADD_PAGE_COMMENT_PUBLISH_EXPERIENCE,timeout:n("aJPUt").ExperienceTimeout.EDITOR_PUBLISH});let r={cloudId:T,input:{commentBody:{value:JSON.stringify(a),representationFormat:n("kKAQX").ContentRepresentation.ATLAS_DOC_FORMAT},commentSource:n("kKAQX").Platform.WEB,containerId:o}};return((0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?S({variables:{...r,pageId:o},update:P}):R({variables:r,update:(0,n("87CZC").updateApolloCacheParentCallback)("create",{pageId:o,contentStatus:["DRAFT","CURRENT"],type:["FOOTER"]},s)})).then(({data:e})=>{let o={...e.createFooterComment,replies:[],isUnread:!1,isOpen:!0,type:n("8i27m").CommentType.GENERAL};y(e=>new Set([...e,o.id])),g({inline:{},general:{[o.id]:o}}),t&&t(),_(),w(),i(),d({type:"sendTrackEvent",data:{action:"created",actionSubject:"comment",actionSubjectId:o.id,objectType:b,objectId:l,source:n("en1dX").AnalyticsSource.PAGE_FOOTER,attributes:{commentType:n("en1dX").CommentType.PAGE,source:n("en1dX").AnalyticsSource.PAGE_FOOTER,pageMode:I,isReply:!1,pageType:b,isLivePage:I===n("cD1qu").PageMode.LIVE,editor:"v2",searchSessionId:u,navdexPointType:el.END,parentCommentId:null,isStickyFooter:c===n("3mVfX").AddFooterCommentMode.STICKY_DRAFT}}}).fire(),m.succeed({name:n("irVI7").ADD_PAGE_COMMENT_PUBLISH_EXPERIENCE}),(0,n("9wGTI").fg)("confluence_comments_unified_navigation")?(p(o.id,n("8i27m").CommentType.GENERAL),(0,n("9FoVw").handleFooterCommentsNavigation)({scrollBehavior:n("9FoVw").ScrollBehavior.SMOOTH,block:"center",inline:"center",commentId:o.id})):setTimeout(()=>{(0,n("7qvmT").handlePanelSelectionAndScroll)({threadKey:o.id,isResolved:!1,pageMode:I,setCurrentlySelectedThreadKey:p,eventEmitter:void 0,commentType:n("8i27m").CommentType.GENERAL,scrollCommentsPanelToThread:h,shouldScrollCommentsPanel:!0})},1e3)}).catch(e=>{if((0,n("9wGTI").fg)("confluence_fe_add_page_comment_exp_coverage")){let t=(0,n("lFkRf").getTranslatedError)(e);(0,n("lFkRf").isCreateNotPermittedError)(t)||(0,n("lFkRf").isViewNotPermittedError)(t)?(m.abort({name:n("irVI7").ADD_PAGE_COMMENT_PUBLISH_EXPERIENCE,reason:t.id}),m.abort({name:n("irVI7").ADD_PAGE_COMMENT_EXPERIENCE,reason:t.id})):A(e)}})},cancelHandler:({isEditorAborted:e})=>{C&&_(),e&&(o?.(!0),m.abort({name:n("irVI7").ADD_PAGE_COMMENT_EXPERIENCE,reason:"aborted because comment was cancelled"})),w(),i(),r?.()},onEditorLoaded:O,onEditorReady:()=>{O()},onEditorContentChangedWithData:(e,t)=>{e&&t?f(t):f(void 0),E(e)},useNewExperienceAbort:!0,expandEditor:!0,isFooterComment:!0,isOffline:t})};var ef=n("dL5YQ");let eC=n("1ydBT").default,eE=(0,n("ecnYn").xcss)({height:"100%",width:"100%"}),e_=(0,n("ecnYn").xcss)({position:"relative",visibility:"visible",minHeight:"50px",margin:"0 auto"}),eg=(0,n("ecnYn").xcss)({zIndex:"modal",backgroundColor:"elevation.surface",borderTopWidth:"border.width",borderTopStyle:"solid",borderColor:"color.border",padding:"space.200",position:"relative"}),ey=(0,n("ecnYn").xcss)({zIndex:"navigation",backgroundColor:"elevation.surface",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",bottom:"space.0"}),eh=(0,n("ecnYn").xcss)({zIndex:"1",transform:"unset",bottom:"space.0"}),eI=(0,n("ecnYn").xcss)({left:"space.0"}),eb=(0,n("ecnYn").xcss)({position:"fixed"}),eT=(0,n("ecnYn").xcss)({position:"sticky"}),eR=(0,n("ecnYn").xcss)({width:"60%"}),ev=(0,n("ecnYn").xcss)({width:"60%"}),eS=(0,n("ecnYn").xcss)({transition:"transform 0.3s ease-out, opacity 0.3s ease-out",transformOrigin:"top",position:"sticky",bottom:"space.0",zIndex:"1"}),ew=(0,n("ecnYn").xcss)({transform:"translateY(100%)",opacity:0,pointerEvents:"none"}),eA=(0,n("ecnYn").xcss)({transform:"translateY(0)",opacity:1,pointerEvents:"auto"}),eP=(0,n("dPJCf").createSingleQueryParamHook)("focusedCommentId"),eO=(0,n("dPJCf").createSingleQueryParamHook)("replyToComment"),eM=(0,n("7aRa9").withFlags)(({flags:t,pageWidthType:o,showLabels:s,hasReactions:m,editorIsUserOffline:d})=>{let[i]=(0,n("ep3mz").usePageContentId)(),c=(0,n("5vi32").useIsEmbeddedConfluence_DO_NOT_USE)(),l=(0,a.useRef)(null),[u,f]=(0,a.useState)(0),[E,_]=(0,a.useState)(!1),[g,y]=(0,a.useState)(!1),[h,I]=(0,a.useState)(!1),[b,T]=(0,a.useState)(0),[R,v]=(0,a.useState)(!1),[w,A]=(0,a.useState)(!0),[P]=(0,n("isEtk").useContentState)(),O=(0,n("aSsfA").useGetPageMode)(),M=(0,n("e4o8D").useRenderServerPlaceholder)(),{contentStatus:x}=(0,n("htsj6").useContentStatus)(),{expanded:N,width:V,footerEditorEntry:k}=(0,n("fNzRA").useObjectCommentContext)(),{closeCommentContainer:L}=(0,n("fNzRA").useObjectCommentDispatchContext)(),{width:D,left:F,right:j}=(0,n("aOKRX").usePageContentDimensions)(),{orderedActiveAnnotationIdList:U,commentsDataMap:G,removedThreadsMap:K,footerCommentsLoadingState:B}=(0,n("8i27m").useCommentsDataState)(),q=(0,n("kgNLQ").buildDefaultCommentsContentStatusFilters)(O),W=(0,n("4L9ve").useProcessedCommentsDataState)(),H=null;if(i&&(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1))try{H=(0,n("l1uFv").readQueryInterop)({query:eC,variables:(0,n("MJaSd").buildPreloadObjectCommentsQueryVariables)(i)})}catch{H=null}let z=(0,a.useMemo)(()=>(0,n("MJaSd").getPreloadAwareObjectComments)(W,H,q),[W,H,q]),[X,Q]=(0,a.useState)(!1),$=(0,a.useRef)(!1),Y=(0,a.useRef)(!1),J=eP(),Z=eO(),{showInlineComments:ee,showGeneralComments:et,replyToCommentId:en,commentType:eo,currentlySelectedThreadKey:er,location:es}=(0,n("3mVfX").useCommentsPanelState)(),[{isUnreadQueryLoading:em}]=(0,n("fHAwL").useUnreadComments)(),[ed,ec]=(0,a.useState)(!1),el=(0,a.useContext)(n("1kHsc").ExperienceTrackerContext),eu=O!==n("cD1qu").PageMode.VIEW||P.isContentReady,eM=x===n("aqBZ0").CONTENT_STATUS_ARCHIVED;(0,a.useEffect)(()=>{eM&&(A(!1),Q(!0))},[eM]),(0,a.useEffect)(()=>{(0,n("9wGTI").fg)("confluence_comment_sticky_footer_enabled")&&N&&i&&L()},[i]);let ex=E&&eu,eN=n("dkkKv").useActiveCommentsQuery,eV=X&&!$.current,ek=(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?z.isUsingFullData||z.allDataPreloaded:B===n("8i27m").FooterCommentsLoadingStateType.FULLY_LOADED&&!eV,eL=(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?z.isPreloadDataProcessed:B===n("8i27m").FooterCommentsLoadingStateType.PARTIALLY_LOADED,eD=(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?z.isPreloadLoading:B===n("8i27m").FooterCommentsLoadingStateType.PRELOADING,eF=!ek&&!eD&&(ex||R),ej={pageId:i||"",skip:ek||(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1),type:"FOOTER",returnNativeLoading:!0,useStableCommentsDataUpdates:!0,fetchPolicy:eF?"network-only":"cache-only",isPreload:M},{hasRecs:eU}=(0,C.usePageRecommendationData)(),eG=eN(ej),{error:eK,data:eB}=(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?{data:{comments:{totalCount:z.commentCount,nodes:z.openFooterComments}},error:z.error}:eG,eq=(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?z.isPreloadLoading||!z.isDataProcessed:eG.loading,eW=M&&eB?.comments?.totalCount===0,eH=(0,a.useMemo)(()=>eB?.comments?.nodes?.length===0||!0,[eB]);(0,a.useEffect)(()=>{eV&&!eq&&eB&&($.current=!0)},[eB,eq,eV]);let ez=ek||eL||eW,eX=eK&&!(0,n("i6UMJ").onlyHasReactionsSummaryErrors)(eK)||!ex&&!ez,eQ=ex&&!ez,e$=M&&z?.preloadCompletedWithComments&&(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1),eY=(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?ez&&eq&&!ek||e$:ez&&eq;(0,a.useEffect)(()=>{if(M||!eu)return;let e=new IntersectionObserver(([e])=>{let t=e.isIntersecting;t&&_(t)},{root:null,rootMargin:"10px",threshold:.1});return l.current&&e.observe(l.current),()=>{e.disconnect()}},[M,O,P.isContentReady,eu]),(0,a.useEffect)(()=>{if((0,n("9wGTI").fg)("confluence_frontend_page_comments_race_condition")||M||!er)return;let e=new MutationObserver(()=>{let t=`footer-comment-thread-${er}-container`;document.getElementById(t)?(y(!0),e.disconnect()):y(!1)});return e.observe(document.body,{childList:!0,subtree:!0}),()=>{y(!1),e.disconnect()}},[er,M]),(0,a.useEffect)(()=>{ek&&v(!1)},[ek]),(0,a.useEffect)(()=>{em||ed||ec(!0)},[em,ed]),(0,a.useEffect)(()=>{if(!(0,n("9wGTI").fg)("confluence_comments_unified_navigation")&&ez&&eo===n("8i27m").CommentType.GENERAL&&g){let e=`footer-comment-thread-${er}-container`,t=document.getElementById(e);if(t){let e=t.getBoundingClientRect();e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)||t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}}},[ek,eo,er,g,ed,ez]),(0,a.useEffect)(()=>{if(eo===n("8i27m").CommentType.GENERAL){let e=`footer-comment-thread-${er}-container`;document.getElementById(e)||v(!0)}},[er,eo]),(0,a.useEffect)(()=>{let e=document.getElementById("ak-editor-textarea");if(e){if(eU&&(0,n("6mKj3").expValEquals)("confluence_ai_related_content_for_live_pages","isEnabled",!0)&&(0,n("9wGTI").fg)("confluence_frontend_unify_footer_comment_space_ld"))return void f(0);let t=new ResizeObserver(e=>{if((0,n("9wGTI").fg)("confluence_footer_comment_styling_change")){let t=(0,n("aHcFH").getCommentPositionTopOfSectionEditor)(e);(0,r.flushSync)(()=>{void 0!==t&&f(t)})}});return t.observe(e),t.observe(document.body),()=>t.disconnect()}},[eU]),(0,a.useEffect)(()=>{let e=document.querySelector('[data-testid="content-container-component"]');if(O===n("cD1qu").PageMode.VIEW&&e&&(0,n("9wGTI").fg)("confluence_frontend_unify_footer_comment_space_old")){let t=new ResizeObserver(e=>{let t=(0,n("aHcFH").getCommentPositionTopOfSectionRenderer)();(0,r.flushSync)(()=>{f(t)})});return t.observe(e),t.observe(document.body),()=>{t.disconnect()}}},[O]);let eJ=(0,n("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?z.commentsDataMap:G,eZ=(0,a.useMemo)(()=>ek||ez?(0,n("9wGTI").fg)("confluence_frontend_content_wrapper")?(0,n("6lAIr").getVisibleCommentThreads)({commentsDataMap:eJ,includeGeneralComments:!0,includeInlineComments:!1,orderedAnnotationIds:(0,n("i6UMJ").getAnnotationThreadKeys)(U)}):(0,n("i6UMJ").getOpenCommentThreads)({commentsDataMap:eJ,showInlineComments:ee,showGeneralComments:et,location:n("i6UMJ").LocationValue.FOOTER,orderedActiveAnnotationIdList:U,removedThreadsMap:K}):[],[ek,ez,eJ,U,ee,et,K]),e0=eZ.length>0;(0,a.useEffect)(()=>{if(!eM)if(en&&es===n("i6UMJ").LocationValue.FOOTER)A(!1);else{let e=setTimeout(()=>{A(!0)},50);return()=>clearTimeout(e)}},[en,es,eM]),(0,a.useEffect)(()=>{!Y.current&&(ex&&eq||ek&&e0)&&(el.start({name:n("irVI7").VIEW_PAGE_COMMENTS_EXPERIENCE,attributes:{...(0,n("gtj7V").getCommentsDataManagerExperimentAttributes)(),isConditionalRenderingOn:!0,isFocusedComment:!!(J||Z),contentId:i,pageMode:O}}),Y.current=!0,n("6Hogt").PAGE_COMMENTS_METRIC.start(),n("6Hogt").PAGE_COMMENTS_METRIC.mark("pageCommentsRenderStart"))},[eY,eQ,eq,ex,ek,e0]),(0,a.useEffect)(()=>{if(eK){if((0,n("i6UMJ").onlyHasReactionsSummaryErrors)(eK))return void el.updateAttributes({name:n("irVI7").VIEW_PAGE_COMMENTS_EXPERIENCE,attributes:{ignoredReactionsSummaryErrors:!0}});let o=(0,n("lFkRf").getTranslatedError)(eK);if((0,n("lFkRf").isViewNotPermittedError)(o)){t.showWarningFlag({title:e(a).createElement(n("gtD4K").default,n("FBfum").i18n.unableToLoadCommentsTitle),description:e(a).createElement(n("gtD4K").default,o)}),el.abort({name:n("irVI7").VIEW_PAGE_COMMENTS_EXPERIENCE,reason:n("FBfum").i18n.viewNotPermitted.id}),n("6Hogt").PAGE_COMMENTS_METRIC.cancel();return}(0,n("lFkRf").isNetworkError)(o)&&t.showWarningFlag({title:e(a).createElement(n("gtD4K").default,n("FBfum").i18n.unableToLoadCommentsTitle),description:e(a).createElement(n("gtD4K").default,o)}),el.stopOnError({name:n("irVI7").VIEW_PAGE_COMMENTS_EXPERIENCE,error:eK}),n("6Hogt").PAGE_COMMENTS_METRIC.cancel()}},[eK]),(0,a.useEffect)(()=>{g&&ek&&e0?(el.succeed({name:n("irVI7").VIEW_PAGE_COMMENTS_EXPERIENCE,attributes:{totalComments:eB?.comments?.totalCount,totalCommentThreads:eZ.length}}),n("6Hogt").PAGE_COMMENTS_METRIC.mark("pageCommentsRenderEnd"),n("6Hogt").PAGE_COMMENTS_METRIC.stop({customData:{contentId:i||"",totalComments:eB?.comments?.totalCount||0}})):!g&&ez&&!eX&&!J&&!Z&&eB?.comments?.totalCount!==0&&(0,n("9wGTI").fg)("confluence_frontend_page_comments_race_condition")&&(el.fail({name:n("irVI7").VIEW_PAGE_COMMENTS_EXPERIENCE,error:Error("Object comment wrapper not visible on screen")}),n("6Hogt").PAGE_COMMENTS_METRIC.cancel())},[g,ez,J,Z,ek]),(0,a.useEffect)(()=>{if(h){n("6Hogt").PAGE_COMMENTS_METRIC.markFMP(),n("6Hogt").PAGE_COMMENTS_METRIC.mark("tti");let e=el.getExperienceState(n("irVI7").VIEW_PAGE_COMMENTS_EXPERIENCE);e?.startTime&&"number"==typeof e.startTime&&el.updateAttributes({name:n("irVI7").VIEW_PAGE_COMMENTS_EXPERIENCE,attributes:{firstMeaningfulPaint:window.performance.now()-e.startTime}})}},[h]),(0,a.useEffect)(()=>{eB?.comments?.totalCount===0&&(el.abort({name:n("irVI7").VIEW_PAGE_COMMENTS_EXPERIENCE,reason:"No page comments"}),n("6Hogt").PAGE_COMMENTS_METRIC.cancel())},[eB]);let e1=(0,a.useCallback)(()=>y(!0),[]),e3=(0,n("aHcFH").getWidthAndMaxWidth)({pageMode:O,pageWidthType:o,hasEndOfPageRecommendations:eU??!1}),e2=(0,a.useMemo)(()=>!!(0,n("9wGTI").fg)("confluence_comment_sticky_footer_enabled")&&!!N&&k===n("3mVfX").AddFooterCommentMode.STICKY_DRAFT,[N,k]),e6=(0,a.useMemo)(()=>({width:D,left:F,right:j}),[D,F,j]);return e(a).createElement(e(a).Fragment,null,e(a).createElement(n("6f0Oj").default,{ref:l,xcss:e_,testId:"object-comment-wrapper",style:{top:u,width:e3.width,maxWidth:e3.maxWidth},"data-vc":`object-comment-wrapper-${O}-${e0?"has-comments":"no-comments"}`},e(a).createElement(e(a).Fragment,null,e(a).createElement(p,{hasLoadedObjectComments:!!ez,allObjectCommentsRendered:g||eH||ek,commentBatchRendered:h,commentBatchCount:b,setForceLoadComments:v}),eX?null:e(a).createElement(e(a).Fragment,null,eQ&&e(a).createElement(n("6f0Oj").default,{xcss:eR},e(a).createElement(n("deTj5").CommentPlaceholder,{showPlaceholder:!0})),ez&&e(a).createElement(n("8SCD6").ReactionsProvider,{contentId:i??""},e0&&e(a).createElement(ei,{isOffline:d,showReactions:!c||m}),e(a).createElement(n("1GzhS").default,{xcss:eE},!e$&&e(a).createElement(ea,{commentThreads:eZ,supportedTopLevelActions:["edit","resolve","delete"],flags:t,onAllCommentsRendered:e1,onCommentBatchRendered:()=>{I(!0),T(e=>e+1)},isOffline:d}),eY&&e(a).createElement(n("6f0Oj").default,{xcss:ev},e(a).createElement(n("deTj5").CommentPlaceholder,{showPlaceholder:!0}))),e(a).createElement(n("6f0Oj").default,{xcss:[eS,en&&es===n("i6UMJ").LocationValue.FOOTER?ew:eA]},!eQ&&!eY&&w&&!eM&&!N&&e(a).createElement(S,{showReactions:!e0&&(!c||m),showLabels:s,isOffline:d,optimisticReactions:!0}))))),N&&e(a).createElement(n("6f0Oj").default,{xcss:[(0,n("9wGTI").fg)("confluence_comment_sticky_footer_enabled")&&ey,e2?eb:eT,O===n("cD1qu").PageMode.VIEW&&eh,O!==n("cD1qu").PageMode.VIEW&&eI],testId:"footerCommentEditor",style:O===n("cD1qu").PageMode.VIEW?(0,n("niTts").hideWhiteSpace)({shouldRenderFixedStyle:e2,pageContentDimensions:e6,fallbackWidth:V}):void 0},e(a).createElement(n("6f0Oj").default,{xcss:eg,style:{width:V,maxWidth:e3.maxWidth}},e(a).createElement(ef.ObjectAddCommentProfileWrapper,null,e(a).createElement(ep,{isOffline:d}))))))}),ex=(0,f.withErrorBoundary)({attribution:n("3IBnw").Attribution.COMMENTS})(eM);t.exports.ObjectCommentContainer=ex}),o("7aqgU",function(e,t){e.exports=n("4mJKd")(5)("BbB4M").then(()=>n("JSoWM"))}),o("hdxAi",function(e,t){let o=()=>({deletedMentions:[],addedMentions:[],deletedTasks:[],addedTasks:[],unrestrictedMentions:[],parentSpaceRestrictedMentions:[],pageRestrictedMentions:[],unrestrictedTasks:[],parentSpaceRestrictedTasks:[],pageRestrictedTasks:[],editorApi:void 0,mentionsAdded:{currentUser:[],otherUsers:[]},tasksAdded:{currentUser:[],otherUsers:[]}}),a=(0,n("1P1Tu").createStore)({initialState:o(),actions:{setDeletedMentions:e=>({setState:t})=>{t({deletedMentions:e})},setAddedMentions:e=>({setState:t})=>{t({addedMentions:e})},setUnrestrictedMentions:e=>({setState:t})=>{t({unrestrictedMentions:e})},addUnrestrictedMentions:e=>({setState:t,getState:n})=>{let{unrestrictedMentions:o}=n();t({unrestrictedMentions:[...o,...e]})},removeUnrestrictedMentions:e=>({setState:t,getState:n})=>{let o=new Set(e.map(e=>e.localId)),{unrestrictedMentions:a}=n();t({unrestrictedMentions:a.filter(e=>!o.has(e.localId))})},setParentSpaceRestrictedMentions:e=>({setState:t})=>{t({parentSpaceRestrictedMentions:e})},addParentSpaceRestrictedMentions:e=>({setState:t,getState:n})=>{let{parentSpaceRestrictedMentions:o}=n();t({parentSpaceRestrictedMentions:[...o,...e]})},removeParentSpaceRestrictedMentions:e=>({setState:t,getState:n})=>{let o=new Set(e.map(e=>e.localId)),{parentSpaceRestrictedMentions:a}=n();t({parentSpaceRestrictedMentions:a.filter(e=>!o.has(e.localId))})},setPageRestrictedMentions:e=>({setState:t})=>{t({pageRestrictedMentions:e})},addPageRestrictedMentions:e=>({setState:t,getState:n})=>{let{pageRestrictedMentions:o}=n();t({pageRestrictedMentions:[...o,...e]})},removePageRestrictedMentions:e=>({setState:t,getState:n})=>{let o=new Set(e.map(e=>e.localId)),{pageRestrictedMentions:a}=n();t({pageRestrictedMentions:a.filter(e=>!o.has(e.localId))})},setDeletedTasks:e=>({setState:t})=>{t({deletedTasks:e})},setAddedTasks:e=>({setState:t})=>{t({addedTasks:e})},setPageRestrictedTasks:e=>({setState:t})=>{t({pageRestrictedTasks:e})},addPageRestrictedTasks:e=>({setState:t,getState:n})=>{let{pageRestrictedTasks:o}=n();t({pageRestrictedTasks:[...o,...e]})},removePageRestrictedTasks:e=>({setState:t,getState:n})=>{let o=new Set(e.map(e=>e.localId)),{pageRestrictedTasks:a}=n();t({pageRestrictedTasks:a.filter(e=>!o.has(e.localId))})},setParentSpaceRestrictedTasks:e=>({setState:t})=>{t({parentSpaceRestrictedTasks:e})},addParentSpaceRestrictedTasks:e=>({setState:t,getState:n})=>{let{parentSpaceRestrictedTasks:o}=n();t({parentSpaceRestrictedTasks:[...o,...e]})},removeParentSpaceRestrictedTasks:e=>({setState:t,getState:n})=>{let o=new Set(e.map(e=>e.localId)),{parentSpaceRestrictedTasks:a}=n();t({parentSpaceRestrictedTasks:a.filter(e=>!o.has(e.localId))})},setUnrestrictedTasks:e=>({setState:t})=>{t({unrestrictedTasks:e})},addUnrestrictedTasks:e=>({setState:t,getState:n})=>{let{unrestrictedTasks:o}=n();t({unrestrictedTasks:[...o,...e]})},removeUnrestrictedTasks:e=>({setState:t,getState:n})=>{let o=new Set(e.map(e=>e.localId)),{unrestrictedTasks:a}=n();t({unrestrictedTasks:a.filter(e=>!o.has(e.localId))})},setMentionsAdded:e=>({setState:t,getState:n})=>{let{mentionsAdded:o}=n();e.currentUser&&(e.currentUser.length>0?o.currentUser=[...e.currentUser,...o.currentUser]:o.currentUser=[]),t({mentionsAdded:o})},setTasksAdded:e=>({setState:t,getState:n})=>{let{tasksAdded:o}=n();e.currentUser&&(e.currentUser.length>0?o.currentUser=[...e.currentUser,...o.currentUser]:o.currentUser=[]),t({tasksAdded:o})},clearMentionsFlags:()=>({setState:e})=>{e(o())}},name:"MentionsNotificationsStore"}),r=(0,n("9zUhf").createHook)(a),s=(0,n("9zUhf").createActionsHook)(a);e.exports.useMentionsNotifications=r,e.exports.useMentionsNotificationsActions=s}),o("cmBjr",function(t,o){var a=n("42omo"),r=n("kyKWe");let s=(0,n("7aRa9").withFlags)(({flags:t})=>{let[o]=(0,n("ep3mz").usePageContentId)(),{userId:s}=(0,n("bQm3c").useSessionData)(),{setQueryParams:m}=(0,n("dPJCf").useRouteActions)(),d=(0,n("jv3O2").useShowConvertToLivePageFlag)({flags:t}),i=(0,a.useCallback)(t=>{let{accountId:o,pageUpdated:a}=t||{};"convertToLiveEdit"===a?.trigger&&(d({converterWasCurrentUser:o===s}),m({[n("bqMNb").FORCE_TRANSITION_QUERY_PARAM]:e(r)()}))},[d,s,m]);return(0,n("i9VoI").useSubscriptionEvent)({subscriberId:"convertToLivePageFlag",contentId:o,delta:"pageUpdated",contentType:"page",skip:!o,onDataReceived:e=>i(e)}),null});t.exports.ConvertToLivePageFlag=s}),o("hrEV9",function(t,o){var a=n("42omo");let r=(0,n("jmjWc").LoadablePaint)({__loadable_id__:"v-far",name:"CommentsSectionLoaderPaint",loading:({handlePageCommentsRender:e})=>e?null:n("deTj5").CommentPlaceholder,loader:async()=>(await n("3CxZ7")).CommentsSection}),s=(0,n("jmjWc").LoadableAfterPaint)({__loadable_id__:"COkRl",name:"CommentsSectionLoaderAfterPaint",loading:()=>e(a).createElement(n("deTj5").CommentPlaceholder,null),loader:async()=>(await n("3CxZ7")).CommentsSection}),m={[n("398ES").LoadingPriority.PAINT]:r,[n("398ES").LoadingPriority.AFTER_PAINT]:s};t.exports.CommentsSectionLoader=({loadingPriority:t,...n})=>{let o=m[t]||s;return e(a).createElement(o,n)}}),o("3CxZ7",function(e,t){e.exports=n("4mJKd")(5)("3NlhD").then(()=>n("8zun0"))}),o("aOKRX",function(e,t){var o=n("3u0dr"),a=n("frIzR"),r=n("42omo");let s=(0,o.isReactCompilerActiveV1)()?()=>{let e,t,o,s,m,d,i=(0,a.c)(10),[c,l]=(0,r.useState)(0),[u,p]=(0,r.useState)(0),[f,C]=(0,r.useState)(0);return i[0]===Symbol.for("react.memo_cache_sentinel")?(e=()=>{if(!(0,n("9wGTI").fg)("confluence_comment_sticky_footer_enabled")||(0,n("9wGTI").fg)("confluence_comment_expand_footer_editor"))return;let e=document.querySelector("[data-testid='page-content-only']");if(e){let t=()=>{let t=e.getBoundingClientRect();l(t.width),p(t.left),C(t.right)},n=new ResizeObserver(()=>{t()}),o=()=>{t()};n.observe(e),window.addEventListener("resize",o);let a=new MutationObserver(()=>{let o=document.querySelector("[data-testid='page-content-only']");o&&o!==e&&(n.disconnect(),n.observe(o),t())});return a.observe(document.body,{childList:!0,subtree:!0}),t(),()=>{n.disconnect(),window.removeEventListener("resize",o),a.disconnect()}}},t=[],i[0]=e,i[1]=t):(e=i[0],t=i[1]),(0,r.useEffect)(e,t),i[2]===Symbol.for("react.memo_cache_sentinel")?(o=()=>{if(!(0,n("9wGTI").fg)("confluence_comment_sticky_footer_enabled")||!(0,n("9wGTI").fg)("confluence_comment_expand_footer_editor"))return;let e=null,t=null,o=null,a=()=>{if(!o)return;let e=o.getBoundingClientRect();l(e.width),p(e.left),C(e.right)},r=()=>{a()};window.addEventListener("resize",r);let s=t=>{o=t,e&&e.disconnect(),(e=new ResizeObserver(()=>{a()})).observe(t),a()},m=document.querySelector("[data-testid='page-content-only']");return m&&s(m),(t=new MutationObserver(()=>{let e=document.querySelector("[data-testid='page-content-only']");e&&e!==o&&s(e)})).observe(document.body,{childList:!0,subtree:!0}),()=>{e&&e.disconnect(),window.removeEventListener("resize",r),t&&t.disconnect()}},s=[],i[2]=o,i[3]=s):(o=i[2],s=i[3]),(0,r.useEffect)(o,s),i[4]!==c?(m=(0,n("9wGTI").fg)("confluence_comment_sticky_footer_enabled")?c:"100%",i[4]=c,i[5]=m):m=i[5],i[6]!==u||i[7]!==f||i[8]!==m?(d={width:m,left:u,right:f},i[6]=u,i[7]=f,i[8]=m,i[9]=d):d=i[9],d}:()=>{let[e,t]=(0,r.useState)(0),[o,a]=(0,r.useState)(0),[s,m]=(0,r.useState)(0);return(0,r.useEffect)(()=>{if(!(0,n("9wGTI").fg)("confluence_comment_sticky_footer_enabled")||(0,n("9wGTI").fg)("confluence_comment_expand_footer_editor"))return;let e=document.querySelector("[data-testid='page-content-only']");if(e){let n=()=>{let n=e.getBoundingClientRect();t(n.width),a(n.left),m(n.right)},o=new ResizeObserver(()=>{n()}),r=()=>{n()};o.observe(e),window.addEventListener("resize",r);let s=new MutationObserver(()=>{let t=document.querySelector("[data-testid='page-content-only']");t&&t!==e&&(o.disconnect(),o.observe(t),n())});return s.observe(document.body,{childList:!0,subtree:!0}),n(),()=>{o.disconnect(),window.removeEventListener("resize",r),s.disconnect()}}},[]),(0,r.useEffect)(()=>{if(!(0,n("9wGTI").fg)("confluence_comment_sticky_footer_enabled")||!(0,n("9wGTI").fg)("confluence_comment_expand_footer_editor"))return;let e=null,o=null,r=null,s=()=>{if(!r)return;let e=r.getBoundingClientRect();t(e.width),a(e.left),m(e.right)},d=()=>{s()};window.addEventListener("resize",d);let i=t=>{r=t,e&&e.disconnect(),(e=new ResizeObserver(()=>{s()})).observe(t),s()},c=document.querySelector("[data-testid='page-content-only']");return c&&i(c),(o=new MutationObserver(()=>{let e=document.querySelector("[data-testid='page-content-only']");e&&e!==r&&i(e)})).observe(document.body,{childList:!0,subtree:!0}),()=>{e&&e.disconnect(),window.removeEventListener("resize",d),o&&o.disconnect()}},[]),{width:(0,n("9wGTI").fg)("confluence_comment_sticky_footer_enabled")?e:"100%",left:o,right:s}};e.exports.usePageContentDimensions=s}),o("niTts",function(e,t){e.exports.hideWhiteSpace=({shouldRenderFixedStyle:e,pageContentDimensions:t,fallbackWidth:n="100%"})=>{if(!e)return{width:n};let{width:o,left:a,right:r}=t,s="number"==typeof o?o:0,m=a??0,d=r??0;return{left:m>0?`${m}px`:"0px",right:d>0?`${window.innerWidth-d}px`:"0px",width:s>0?`${s}px`:"100%"}}}),o("dL5YQ",function(t,o){var a=n("3u0dr"),r=n("frIzR"),s=n("42omo"),m=n("fs6LW");let d=(0,n("eSUdr").default)`query ObjectAddCommentProfileWrapperUserQuery($id:ID!){user:confluence_atlassianUser(id:$id){id displayName photos{value}}}`,i={addCommentOpenContainerStyles:"_zulppxbi _1e0c1txw _2lx2vrvc _1bsb1osq _4cvr1y6m",addCommentEditorStyles:"_1bsb1osq",avatarStyles:"_1bsbzwfg _4t3izwfg"},c=(0,a.isReactCompilerActiveV1)()?t=>{let o,a,c,l,u,p,f,C,E=(0,r.c)(21),{children:_}=t,{userId:g}=(0,n("bQm3c").useSessionData)(),y=(0,n("e4o8D").useRenderServerPlaceholder)(),h=g||"";E[0]!==h?(o={id:h},E[0]=h,E[1]=o):o=E[1];let I=!g;E[2]!==o||E[3]!==I?(a={variables:o,fetchPolicy:"cache-and-network",skip:I},E[2]=o,E[3]=I,E[4]=a):a=E[4];let{data:b,loading:T}=(0,n("jMyy4").useQueryInterop)(d,a),R=b?.user?.photos?.[0]?.value||"",v=b?.user?.displayName||"";E[5]!==R||E[6]!==v||E[7]!==g?(c={avatarUrl:R,accountId:g,displayName:v},E[5]=R,E[6]=v,E[7]=g,E[8]=c):c=E[8];let S=c;return E[9]===Symbol.for("react.memo_cache_sentinel")?(l={float:"left"},E[9]=l):l=E[9],E[10]!==T||E[11]!==y||E[12]!==S?(u=T||y?null:e(s).createElement(m.ProfileAvatar,{canViewProfile:!0,src:S.avatarUrl,userId:S.accountId,isAnonymous:!S.accountId,name:S.displayName,testId:"profile-avatar-comment"}),E[10]=T,E[11]=y,E[12]=S,E[13]=u):u=E[13],E[14]!==u?(p=e(s).createElement(n("gdv5Z").default,{xcss:i.avatarStyles,style:l},u),E[14]=u,E[15]=p):p=E[15],E[16]!==_?(f=e(s).createElement(n("gdv5Z").default,{xcss:i.addCommentEditorStyles},_),E[16]=_,E[17]=f):f=E[17],E[18]!==p||E[19]!==f?(C=e(s).createElement(n("gdv5Z").default,{xcss:i.addCommentOpenContainerStyles},p,f),E[18]=p,E[19]=f,E[20]=C):C=E[20],C}:({children:t})=>{let{userId:o}=(0,n("bQm3c").useSessionData)(),a=(0,n("e4o8D").useRenderServerPlaceholder)(),{data:r,loading:c}=(0,n("jMyy4").useQueryInterop)(d,{variables:{id:o||""},fetchPolicy:"cache-and-network",skip:!o}),l={avatarUrl:r?.user?.photos?.[0]?.value||"",accountId:o,displayName:r?.user?.displayName||""};return e(s).createElement(n("gdv5Z").default,{xcss:i.addCommentOpenContainerStyles},e(s).createElement(n("gdv5Z").default,{xcss:i.avatarStyles,style:{float:"left"}},c||a?null:e(s).createElement(m.ProfileAvatar,{canViewProfile:!0,src:l.avatarUrl,userId:l.accountId,isAnonymous:!l.accountId,name:l.displayName,testId:"profile-avatar-comment"})),e(s).createElement(n("gdv5Z").default,{xcss:i.addCommentEditorStyles},t))};t.exports.ObjectAddCommentProfileWrapper=c});
//# sourceMappingURL=FullPageEditorComponent.46e5f557.js.map
