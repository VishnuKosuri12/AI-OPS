function e(e){return e&&e.__esModule?e.default:e}var t=globalThis.parcelRequired477;(0,t.register)("Vjn6T",function(a,r){var n=t("42omo");let o=({children:e,userOffline:a,params:r,apolloClient:o,collabEditProvider:p,currentContentAppearance:l,setContentAppearance:i})=>{let[c,d]=(0,n.useState)(!1),s=async()=>{let e=await (0,t("8VcPj").fetchContentAppearanceProperty)(r.contentId,r.propertyKey,o,"network-only"),a=l?.version||0;if(e?.version>a){let a={...r,propertyValue:e.appearance,versionNumber:e.version};i(e),(0,t("8VcPj").updateAppearanceForCollab)(p,a)}};return(0,n.useEffect)(()=>{d(!!a)},[a]),!a&&c&&s(),e},p=(0,t("cgtv4").defineMessages)({fixedWidth:{id:"editor-appearance-button.toggle.fixed.width",defaultMessage:"Make full-width"},fullWidth:{id:"editor-appearance-button.toggle.full.width",defaultMessage:"Make fixed-width"}}),l=({contentAppearanceDraft:a,contentId:r,updateContentAppearanceProperty:l,collabEditProvider:i,isDisabled:c,isStatusDisconnected:d,setContentAppearance:s})=>{let{formatMessage:u}=(0,t("8C5kA").default)(),{createAnalyticsEvent:f}=(0,t("inPa6").useAnalyticsEvents)(),y=(0,t("hp2SH").getApolloClient)(),[b,m]=(0,n.useState)(!1),g=(0,n.useRef)(null),E=a.appearance===t("1d2ww").ContentAppearanceType.FULL_WIDTH,A=u(E?p.fullWidth:p.fixedWidth),C=(0,n.useCallback)((e,t={})=>{f({type:"sendTrackEvent",data:{action:e,actionSubject:"updateContentAppearanceDraft",source:"EditContentAppearanceButtonComponent",attributes:{contentId:r,...t}}}).fire()},[r,f]),w=(0,n.useCallback)(()=>{let e=E?t("1d2ww").ContentAppearanceType.DEFAULT:t("1d2ww").ContentAppearanceType.FULL_WIDTH,n=a.version?a.version+1:1;return{contentId:r||"",propertyKey:t("1d2ww").ContentAppearancePropertyKey.DRAFT,propertyValue:e,versionNumber:n}},[r,a,E]),v=(0,n.useCallback)(async()=>{let e=document.activeElement===g.current;if(r){m(!0);let r=w();r=await (0,t("8VcPj").updateContentAppearancePropertyWithRetry)(l,r,y,i),m(!1),C("content.appearance.draft",{appearance:r.propertyValue,previousAppearance:a.appearance,appearanceVersion:r.versionNumber}),e&&g.current?.focus()}},[r,a,y,l,i,w,C]),h=(0,n.useCallback)(()=>E?e(n).createElement(e(t("64M9v")),{color:"currentColor",spacing:"spacious",label:A}):e(n).createElement(e(t("1kVeP")),{color:"currentColor",spacing:"spacious",label:A}),[E,A]);return e(n).createElement(o,{userOffline:d,apolloClient:y,params:w(),collabEditProvider:i,currentContentAppearance:a,setContentAppearance:s},e(n).createElement(t("3gadb").default,{content:A,tag:"span",hideTooltipOnClick:!0},e(n).createElement(t("4KS7f").default,{ref:g,appearance:"subtle",iconBefore:h(),style:{minWidth:36},onClick:v,isDisabled:b||!window.__SSR_RENDERED__&&c,"data-test-id":"editor-appearance-button"})))},i=(0,t("eSUdr").default)`mutation UpdateContentAppearancePropertyMutation($contentId:String!$propertyKey:String!$propertyValue:String!$versionNumber:String!$isDelete:Boolean)@experimental{experimentalUpdateContentProperty(contentId:$contentId propertyKey:$propertyKey propertyValue:$propertyValue versionNumber:$versionNumber isDelete:$isDelete){success id key value}}`,c=(0,t("cgtv4").defineMessages)({adjustWidthButtonLabel:{id:"editor-appearance-button.max-width.adjust-width-label",defaultMessage:"Adjust width"},fullPageLabel:{id:"editor-appearance-button.max-width.narrow-label",defaultMessage:"Narrow"},fullWidthLabel:{id:"editor-appearance-button.max-width.wide-label",defaultMessage:"Wide"},maxLabel:{id:"editor-appearance-button.max-width.max-label",defaultMessage:"Max"},dropdownAriaLabel:{id:"editor-appearance-button.max-width.dropdown-aria-label",defaultMessage:"Page width options"}}),d={packageName:"@confluence/editor-appearance-button",packageVersion:"0.0.1"},s=({contentAppearanceDraft:a,contentId:r,updateContentAppearanceProperty:p,collabEditProvider:l,isDisabled:i,isStatusDisconnected:s,setContentAppearance:u})=>{let f=(0,t("8C5kA").default)(),{createAnalyticsEvent:y}=(0,t("inPa6").useAnalyticsEvents)(),b=(0,t("hp2SH").getApolloClient)(),[m,g]=(0,n.useState)(!1),[E,A]=(0,n.useState)(a.appearance);(0,n.useEffect)(()=>{A(a.appearance)},[a.appearance]);let C=(0,n.useCallback)((e,t={})=>{y({type:"sendTrackEvent",data:{action:e,actionSubject:"updateContentAppearanceDraft",source:"EditContentAppearanceButtonComponent",attributes:{contentId:r,...t}}}).fire()},[r,y]),w=(0,n.useCallback)(()=>{let e=a.version?a.version+1:1;return{contentId:r||"",propertyKey:t("1d2ww").ContentAppearancePropertyKey.DRAFT,propertyValue:E,versionNumber:e}},[a.version,r,E]),v=(0,n.useCallback)(async e=>{if(r){g(!0),A(e);let r=w();r=await (0,t("8VcPj").updateContentAppearancePropertyWithRetry)(p,{...r,propertyValue:e},b,l),g(!1),C("content.appearance.draft",{appearance:r.propertyValue,previousAppearance:a.appearance,appearanceVersion:r.versionNumber})}},[r,w,p,b,l,C,a.appearance]);return e(n).createElement(t("bYRk6").default,{data:d},e(n).createElement(o,{userOffline:s,apolloClient:b,params:w(),collabEditProvider:l,currentContentAppearance:a,setContentAppearance:u},e(n).createElement(t("52EPl").default,{trigger:({triggerRef:a,...r})=>e(n).createElement(t("3gadb").default,{content:f.formatMessage(c.adjustWidthButtonLabel)},e(n).createElement(t("ccHMk").default,{...r,ref:a,appearance:"subtle",spacing:"default",isDisabled:m||!window.__SSR_RENDERED__&&i,"aria-label":f.formatMessage(c.adjustWidthButtonLabel)},e(n).createElement(t("1s5hv").default,{gap:"space.050",alignItems:"center",xcss:"_4t3igktf"},e(n).createElement(e(t("1kVeP")),{label:"","aria-hidden":"true",size:"medium"}),e(n).createElement(e(t("ghftu")),{label:"","aria-hidden":"true",size:"small"})))),placement:"bottom-start"},e(n).createElement(t("ahaN7").default,null,e(n).createElement(t("dAYOx").default,{onClick:()=>v(t("1d2ww").ContentAppearanceType.DEFAULT),isSelected:E===t("1d2ww").ContentAppearanceType.DEFAULT},f.formatMessage(c.fullPageLabel)),e(n).createElement(t("dAYOx").default,{onClick:()=>v(t("1d2ww").ContentAppearanceType.FULL_WIDTH),isSelected:E===t("1d2ww").ContentAppearanceType.FULL_WIDTH},f.formatMessage(c.fullWidthLabel)),e(n).createElement(t("dAYOx").default,{onClick:()=>v(t("1d2ww").ContentAppearanceType.MAX),isSelected:E===t("1d2ww").ContentAppearanceType.MAX},f.formatMessage(c.maxLabel))))))},u=(0,t("cgtv4").defineMessages)({errorFlagTitle:{id:"editor-appearance-button.error.flag.title",defaultMessage:"Unable to update width"},unauthorizedErrorFlagBody:{id:"editor-appearance-button.unauthorized.error.flag.body",defaultMessage:"You donâ€™t have permission to update the width. Contact your admin to request access."},networkErrorFlagBody:{id:"editor-appearance-button.network.error.flag.body",defaultMessage:"Check your internet connection, refresh, and try again."}}),f=(0,t("7aRa9").withFlags)(({contentId:a,isStatusDisconnected:r,flags:o,disabled:p=!1})=>{let{contentAppearance:c,setContentAppearance:d,contentAppearanceLoading:f}=(0,t("2HGN8").useContentAppearance)(),{createAnalyticsEvent:y}=(0,t("inPa6").useAnalyticsEvents)(),[{collabEditProvider:b,collabEditInitialized:m}]=(0,t("hYoU4").useNativeCollabState)(),[g]=(0,t("ep3mz").useContentType)(),{updateContentProperty:E,processUpdateContentPropertyResult:A}=(0,t("5kqgA").useUpdateContentProperty)({contentId:a,contentType:g||"page"}),C=async a=>{let r=(0,t("hp2SH").getApolloClient)(),p={contentId:a.contentId,propertyKey:a.propertyKey,propertyValue:a.propertyValue,versionNumber:a.versionNumber.toString(),isDelete:!1};try{if((0,t("6mKj3").expValEquals)("migrate_off_experimentalupdatecontentproperty","isEnabled",!0)){let r=await E({propertyKey:a.propertyKey,propertyValue:a.propertyValue,isDelete:!1,hasExistingProperty:c.version>0}),p=A(r?.data);if(p?.success)d({appearance:a.propertyValue,version:a.versionNumber});else if(p?.errors?.[0]){y({type:"sendOperationalEvent",data:{action:"failed",actionSubject:"updateContentAppearanceProperty",source:"EditorAppearanceButtonNext",attributes:{error:p.errors[0]}}}).fire();let a=p.errors[0].extensions?.statusCode;if("409"===String(a))return;{let r="403"===String(a)?u.unauthorizedErrorFlagBody:u.networkErrorFlagBody;o.showErrorFlag({id:"content-appearance-button-conflict-error-flag",title:e(n).createElement(t("gtD4K").default,u.errorFlagTitle),description:e(n).createElement(t("gtD4K").default,r)})}}}else{let e=await r.mutate({mutation:i,variables:p});e?.data?.experimentalUpdateContentProperty?.success&&d({appearance:a.propertyValue,version:a.versionNumber})}}catch(l){y({type:"sendOperationalEvent",data:{action:"failed",actionSubject:"updateContentAppearanceProperty",source:"EditorAppearanceButtonNext",attributes:{error:l}}}).fire();let a=(0,t("aMcHK").isStatusCodeError)(l,"409"),r=(0,t("1uFM6").isUnauthorizedError)(l),p=(0,t("6fil2").containsNetworkError)(l);if(a)return void(0,t("7Sm4c").markErrorAsHandled)(l);if(r||p){(0,t("7Sm4c").markErrorAsHandled)(l);let a=r?u.unauthorizedErrorFlagBody:u.networkErrorFlagBody;o.showErrorFlag({id:"content-appearance-button-conflict-error-flag",title:e(n).createElement(t("gtD4K").default,u.errorFlagTitle),description:e(n).createElement(t("gtD4K").default,a)})}}},w=f||!m||p;return(0,t("6mKj3").expValEquals)("editor_tinymce_full_width_mode","isEnabled",!0)||(0,t("6mKj3").expValEquals)("confluence_max_width_content_appearance","isEnabled",!0)?e(n).createElement(s,{contentId:a,collabEditProvider:b,isDisabled:w,isStatusDisconnected:r,updateContentAppearanceProperty:C,contentAppearanceDraft:c,setContentAppearance:d}):e(n).createElement(l,{contentId:a,collabEditProvider:b,isDisabled:w,isStatusDisconnected:r,updateContentAppearanceProperty:C,contentAppearanceDraft:c,setContentAppearance:d})});a.exports.EditorAppearanceButtonNext=f});
//# sourceMappingURL=EditorAppearanceButtonNext.1b1bbae4.js.map
