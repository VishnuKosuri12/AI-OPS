var e=globalThis.parcelRequired477,t=e.register;t("6bHqX",function(t,n){e("42omo");let r=`${e("gstll").GATEWAY_URL}/bag`,a=async(e,{fetch:t})=>{try{let n=await t(`${r}/rollout/service?cloudId=${encodeURIComponent(e.cloudId)}`);if(200!==n.status)return{payload:void 0,error:`Failed to fetch commerce rollout information: ${n.statusText}`,exception:void 0};let a=(await n.json()).service;return{payload:"CCP"===a?{commerceBackend:a,ccp:{}}:{commerceBackend:a,hams:{}},error:void 0,exception:void 0}}catch(e){return{payload:void 0,error:void 0,exception:e}}};t.exports.COMMERCE_BACKEND_HAMS="HAMS",t.exports.COMMERCE_BACKEND_CCP="CCP",t.exports.fetchCommerceRolloutInformation=a}),t("gstll",function(e,t){e.exports.GATEWAY_URL="/gateway/api"}),t("6H9BA",function(t,n){var r=e("42omo");t.exports.useCommerceFetch=()=>{let t=(0,e("1EMUC").useCommerceOverride)(fetch),n=(0,e("bIMHH").useSentryExceptionDispatch)();return(0,r.useCallback)(async(...r)=>{let a=performance.now(),[o]=r,i=(0,e("1cK19").sanitizeUrlString)((0,e("lzJ3V").getRequestUrl)(o));try{let o=await t(...r);return o.status>=400&&n({exception:Error(`Status: ${o.status}
URL: ${i}`)}),(0,e("4u5NT").addSpanToAll)("fetch",i,[{name:"network"}],a,performance.now(),JSON.stringify(o).length),o}catch(t){console.warn(t);let e=t instanceof Error?t.stack??t.toString():JSON.stringify(t);throw n({exception:Error(`An error occurred when fetching from ${i}

 ${e}`)}),t}},[t,n])}}),t("goqBE",function(e,t){class n extends Error{constructor(e,t,r){super(`Unable to fetch ${e}, status: ${t}`),this.statusCode=void 0,this.body=void 0,this.name="HttpResponseError",this.statusCode=t,this.body=r,Object.setPrototypeOf(this,n.prototype)}}let r=async(e,t)=>{let r=await t;if(r.ok)return t;throw new n(e,r.status,await r.json().catch(()=>void 0))};e.exports.HttpResponseError=n,e.exports.rejectOnHttpError=r}),t("bIMHH",function(t,n){let r=e("aNwpq").internalGasV3UIEventChannel.useBreadcrumbedEventDispatch;e("aNwpq").internalGasV3ScreenEventChannel.useEventDispatch,e("aNwpq").internalGasV3TrackEventChannel.useBreadcrumbedEventDispatch,e("aNwpq").internalGasV3OperationalEventChannel.useBreadcrumbedEventDispatch;let a=e("aNwpq").internalSentryExceptionChannel.useBreadcrumbedEventDispatch;(0,e("k6lJw").createAtlaskitToEventChannelRepackager)(r),e("aNwpq").breadcrumbMountedEventChannel.Listener,t.exports.useSentryExceptionDispatch=a}),t("aNwpq",function(t,n){let r=(0,e("6YLhE").createBreadcrumbAPI)(),a=r.breadcrumbMountedEventChannel,o=r.Breadcrumb;r.useGetBreadcrumbs,(0,e("eUjEX").createCatchingEventChannel)(),(0,e("eUjEX").createCatchingEventChannel)(),(0,e("eUjEX").createCatchingEventChannel)(),(0,e("eUjEX").createCatchingEventChannel)(),(0,e("eUjEX").createCatchingEventChannel)();let i=(0,e("6YLhE").createBreadcrumbedEventChannel)(r,e("eUjEX").createCatchingEventChannel),c=(0,e("eUjEX").createCatchingEventChannel)(),l=(0,e("6YLhE").createBreadcrumbedEventChannel)(r,e("eUjEX").createCatchingEventChannel),s=(0,e("6YLhE").createBreadcrumbedEventChannel)(r,e("eUjEX").createCatchingEventChannel),u=(0,e("6YLhE").createBreadcrumbedEventChannel)(r,e("eUjEX").createCatchingEventChannel);t.exports.breadcrumbMountedEventChannel=a,t.exports.Breadcrumb=o,t.exports.internalGasV3UIEventChannel=i,t.exports.internalGasV3ScreenEventChannel=c,t.exports.internalGasV3TrackEventChannel=l,t.exports.internalGasV3OperationalEventChannel=s,t.exports.internalSentryExceptionChannel=u}),t("6YLhE",function(t,n){var r=e("l998X"),a=e("42omo");let o={};t.exports.createBreadcrumbAPI=()=>{let t=(0,a.createContext)(()=>void 0),n=()=>(0,a.useContext)(t),o=(0,e("eUjEX").createEventChannel)(),{useEventDispatch:i}=o,c=({name:e,getMountedBreadcrumbPayload:t})=>{let n=i();return(0,a.useEffect)(()=>{n(t())},[e]),null};return{breadcrumbMountedEventChannel:o,Breadcrumb:({children:e,...o})=>{let i=n(),l=(0,a.useRef)(o);(0,a.useLayoutEffect)(()=>{l.current=o});let s=(0,a.useCallback)(()=>({breadcrumbs:[...i()?.breadcrumbs??[],l.current],payload:l.current}),[i]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c,{name:o.name,getMountedBreadcrumbPayload:s}),(0,r.jsx)(t.Provider,{value:s,children:e})]})},useGetBreadcrumbs:n}},t.exports.createBreadcrumbedEventChannel=({useGetBreadcrumbs:t},n=e("eUjEX").createEventChannel)=>{let{Listener:r,useEventDispatch:o}=n();return{Listener:r,useEventDispatch:o,useBreadcrumbedEventDispatch:()=>{let e=o(),n=t();return(0,a.useCallback)(t=>e({breadcrumbs:n()?.breadcrumbs??[],payload:t}),[n,e])}}},t.exports.withBreadcrumb=(e,t,n,a=o)=>o=>(0,r.jsx)(t,{...a,name:n,children:(0,r.jsx)(e,{...o})})}),t("eUjEX",function(t,n){var r=e("l998X"),a=e("42omo");let o=e=>{let t=(0,a.createContext)(e);return{Listener:({onEvent:e,children:n})=>(0,r.jsx)(t.Provider,{value:e,children:n}),useEventDispatch:()=>{let e=(0,a.useContext)(t);return(0,a.useCallback)(t=>{e?.(t)},[e])}}},i=(...e)=>({children:t,onEvent:n})=>{let a=t;for(let t of e)a=t({onEvent:n,children:a});return(0,r.jsx)(r.Fragment,{children:a})},c=({from:e,to:t,useTransformer:n})=>{let o=Array.isArray(e)?i(...e):e;return({children:e,...i})=>{let c=t(),l=n(i),s=(0,a.useCallback)(e=>{c(l(e))},[c,l]);return(0,r.jsx)(o,{onEvent:s,children:e})}},l=({from:e,to:t})=>c({from:e,to:t,useTransformer:({onEvent:e})=>(0,a.useCallback)(t=>(e(t),t),[e])});t.exports.createCatchingEventChannel=o,t.exports.createEventChannel=()=>{let e=o();return{Listener:l({from:e.Listener,to:e.useEventDispatch}),useEventDispatch:e.useEventDispatch}}}),t("k6lJw",function(t,n){var r=e("l998X"),a=e("42omo");let o=(t,n)=>({children:o,...i})=>{let c=t(),l=(0,a.useCallback)(e=>{c({...i,...e.payload,attributes:{...i.attributes,...e.payload.attributes}})},[c,i]);return(0,r.jsx)(e("kDuN4").default,{channel:n,onEvent:l,children:o})};t.exports.createAtlaskitToEventChannelRepackager=e=>o(e,"atlaskit")}),t("1cK19",function(e,t){e.exports.sanitizeUrlString=e=>e.replace(/\?.*$/,"")}),t("1EMUC",function(t,n){e("l998X");var r=e("42omo");let a=()=>(0,r.useContext)(e("9Bcp3").overrideContext);t.exports.useCommerceOverride=e=>(a()||new Map).get(e)||e}),t("9Bcp3",function(t,n){let r=(0,e("42omo").createContext)(new Map);t.exports.overrideContext=r}),t("lzJ3V",function(e,t){e.exports.getRequestUrl=e=>"string"==typeof e?e:e instanceof URL?e.href:e.url}),t("4Twfb",function(t,n){var r=e("42omo");let a=(e,t={loading:!1,data:void 0,error:void 0})=>{let[n,a]=(0,r.useState)(t),o=(0,r.useCallback)(async(...t)=>{a({loading:!0,data:void 0,error:void 0});try{let n=await e(...t);return a({loading:!1,data:n,error:void 0}),n}catch(e){throw a({loading:!1,data:void 0,error:e}),e}},[e]);return(0,r.useMemo)(()=>({...n,fetchData:o}),[n,o])};t.exports.useFetchService=e=>{let t=a(e,{loading:!0,data:void 0,error:void 0}),{fetchData:n}=t;return(0,r.useEffect)(()=>{n().catch(e=>console.warn(e))},[n]),(0,r.useMemo)(()=>{let{fetchData:e,...n}=t;return{...n,refresh:()=>e()}},[t])},t.exports.useUpdateService=e=>{let t=a(e,{loading:!1,data:void 0,error:void 0});return(0,r.useMemo)(()=>{let{fetchData:e,...n}=t;return{...n,update:e}},[t])}}),t("3yFL2",function(e,t){e.exports.GUARANTEED="guaranteed",e.exports.MAYBE="maybe",e.exports.NONE="none"}),t("3SLm1",function(e,t){e.exports.UNKNOWN="unknown",e.exports.UNKNOWN_EXTERNAL="unknown-external",e.exports.COMMERCE_LIBRARIES="commerce-libraries",e.exports.HAMS="hams",e.exports.BILLING_API_GATEWAY="billing-api-gateway"}),t("cEhot",function(t,n){var r=e("42omo");let a=e=>e.charAt(0).toUpperCase()+e.substring(1),o=({action:t,actionSubject:n,actionSubjectId:o,histogramBuckets:i="4000"})=>{let c=e("aNwpq").internalGasV3TrackEventChannel.useBreadcrumbedEventDispatch(),l=e("aNwpq").internalSentryExceptionChannel.useBreadcrumbedEventDispatch(),s=o?`${o}`:`${t}${a(n)}`;return(0,r.useCallback)(t=>{let n={...t},r=(n,r,a,o)=>{void 0===n&&[e("3yFL2").MAYBE,e("3yFL2").NONE].includes(o.probabilityOfBug)||l({exception:n,scopeContext:(0,e("in0Xj").withTelemetryInfoScopeContext)({tags:{task:s,eventName:r,...o,...void 0!==a?{eventTaskId:a}:void 0,...void 0!==t.actionSubjectId?{actionSubjectId:t.actionSubjectId}:void 0}})})};return{fail:({loggablePayload:t,probabilityOfBug:n=e("3yFL2").MAYBE,eventTaskId:a,responsibleService:o=e("3SLm1").UNKNOWN}={})=>{r(t,"fe.user.task.failure",void 0!==a?a:n===e("3yFL2").GUARANTEED?(0,e("jVQXW").responsibleServiceIncludesCommerceLibraries)(o)?"guaranteed-bug":"external-bug":void 0,{probabilityOfBug:n,responsibleService:o})},succeed:({loggablePayload:t,eventTaskId:a,responsibleService:o=e("3SLm1").UNKNOWN}={})=>{r(t,"fe.user.task.success",a,{probabilityOfBug:e("3yFL2").NONE,responsibleService:o}),c(n)}}},[c,l,s])};t.exports.useTaskTracker=t=>{let n=o(t),a=(0,r.useRef)(t);return(0,r.useCallback)(async(t,r)=>{let{fail:o,succeed:i}=n(r||a.current);try{let n=await t();return void 0!==n.succeed?i(n.succeed):o(void 0!==n.fail?n.fail:{probabilityOfBug:e("3yFL2").GUARANTEED,loggablePayload:{result:n,error:Error("Could not find succeed nor fail")}}),n}catch(t){throw o(t instanceof TypeError&&"Failed to fetch"===t.message?{probabilityOfBug:e("3yFL2").MAYBE,loggablePayload:t}:{probabilityOfBug:e("3yFL2").GUARANTEED,loggablePayload:t}),t}},[n])}}),t("in0Xj",function(t,n){let r=({probabilityOfBug:t,responsibleService:n})=>{switch(t){case e("3yFL2").GUARANTEED:if((0,e("jVQXW").responsibleServiceIncludesCommerceLibraries)(n))return"fatal";return"error";case e("3yFL2").MAYBE:return"warning";case e("3yFL2").NONE:return"log";default:return"fatal"}};t.exports.withTelemetryInfoScopeContext=t=>{let n={...t.tags,responsibleService:t.tags.responsibleService??e("3SLm1").UNKNOWN};return{...t,tags:n,level:r(n)}}}),t("jVQXW",function(t,n){t.exports.responsibleServiceIncludesCommerceLibraries=t=>t===e("3SLm1").COMMERCE_LIBRARIES||t===e("3SLm1").UNKNOWN}),t("1Y5Zp",function(e,t){e.exports.isException=e=>void 0!==e.exception,e.exports.isSuccessful=e=>void 0!==e.payload}),t("bXe73",function(e,t){e.exports.isException=e=>void 0!==e.exception,e.exports.isSuccessful=e=>void 0!==e.payload}),t("lh1MN",function(e,t){e.exports.getCcpEntitlementFromQuery=e=>{if(e)return e.confluence_tenantContext?.licenseStates?.confluence?.ccpEntitlementId||void 0}}),t("5M47w",function(t,n){var r,a=e("42omo"),o=e("j1Ss3"),i=((r={}).FREE="free",r.STANDARD="standard",r.PREMIUM="premium",r);let c={PRODUCTION:"https://admin.atlassian.com",STAGING:"https://admin.stg.atlassian.com"},l=t=>new(0,e("6Co6F").default)({product:"confluence"}).addToUrl(t),s=({cloudId:e,environment:t,orgId:n})=>{let r=c[t??"PRODUCTION"];return n||e?n?`${r}/o/${n}/billing-preview`:`${r}/s/${e}/billing-preview`:r},u=t=>{let{cloudId:n,commerceBackendName:r,environment:a,entitlementId:o,transactionAccountId:i,orgId:l}=t;if(r===e("6bHqX").COMMERCE_BACKEND_HAMS)return"/admin/billing/applications/change-edition/confluence.ondemand";if(r===e("6bHqX").COMMERCE_BACKEND_CCP&&o&&i){let e=c[a??"PRODUCTION"];return`${e}/billing/${i}/entitlement/${o}/change-plan?referrer=confluence`}return s({cloudId:n,environment:a,orgId:l})},d=t=>{let{cloudId:n,commerceBackendName:r,entitlementId:a,environment:o,orgId:i,transactionAccountId:c,targetEdition:l}=t;return r===e("6bHqX").COMMERCE_BACKEND_HAMS?l?`${u(t)}/${l}`:u(t):r===e("6bHqX").COMMERCE_BACKEND_CCP&&a&&c?l?`${u(t)}&offeringName=${l}`:u(t):s({cloudId:n,environment:o,orgId:i})},m=t=>{let{cloudId:n,commerceBackendName:r,environment:a,entitlementId:o,orgId:i,transactionAccountId:l}=t;if(r===e("6bHqX").COMMERCE_BACKEND_HAMS)return"/admin/billing/applications";if(r===e("6bHqX").COMMERCE_BACKEND_CCP&&o&&l){let e=c[a??"PRODUCTION"];return`${e}/billing/${l}/entitlement/${o}`}return s({cloudId:n,environment:a,orgId:i})},p=(e,t)=>{let n=t instanceof Error?t.message:String(t);return`${e}: ${n}`};t.exports.CommerceDeepLinksTargetEdition=i,t.exports.useCommerceDeepLinks=({targetEdition:t,skipDeepLinks:n=!1})=>{let r,i,c,s,E,{environment:C,cloudId:h,orgId:v}=(0,e("bQm3c").useSessionData)(),{isSiteAdmin:f}=(0,a.useContext)(e("1ytiN").SPAViewContext);f&&h||(n=!0);let{commerceBackendName:g,loading:b,error:x}=(0,e("hfUvC").useCommerceRolloutInformation)(n||(0,e("lzcvT").isFedRamp)()),y=g===e("6bHqX").COMMERCE_BACKEND_CCP||(0,e("lzcvT").isFedRamp)(),{data:N,loading:I,error:S}=(0,o.useQuery)((0,e("eSUdr").default)`query useCommerceDeepLinksCcpEntitlementQuery{confluence_tenantContext{licenseStates{confluence{ccpEntitlementId}}}tenant{cloudId}}`,{skip:n||!y}),A=I?void 0:(0,e("lh1MN").getCcpEntitlementFromQuery)(N),{data:B,loading:k,error:D}=(0,o.useQuery)((0,e("eSUdr").default)`query useCommerceDeepLinksCcpTransactionAccountIdQuery($entitlementId:ID!$targetEditionName:String$shouldFetchChangeOffering:Boolean!){ccp{entitlement(id:$entitlementId){transactionAccountId experienceCapabilities@include(if:$shouldFetchChangeOffering){changeOfferingV2(offeringName:$targetEditionName){experienceUrl}}}}}`,{variables:{entitlementId:A||"",targetEditionName:t||"",shouldFetchChangeOffering:(0,e("9wGTI").fg)("ld-74-fetch-change-offering-url-in-upgrade-edition")},skip:n||!y||!A,client:(0,e("gKr8t").getAGGClient)()});if(n)return{commerceBackendName:null,planSelectionDeepLink:void 0,planConsentDeepLink:void 0,subscriptionDetailsDeepLink:void 0,loading:!1,errorMessage:void 0};try{let n=B?.ccp?.entitlement?.transactionAccountId,a=B?.ccp?.entitlement?.experienceCapabilities?.changeOfferingV2?.experienceUrl??void 0,o={cloudId:h,commerceBackendName:g,environment:C,entitlementId:A,orgId:v,transactionAccountId:n||void 0};i=l(u(o)),c=l(d({targetEdition:t,...o})),E=a?l(`${a}confluence`):void 0,s=l(m(o)),(0,e("8H5XZ").isGraphQLError)(S)&&!(0,e("7Sm4c").isErrorMarkedAsHandled)(S)&&(0,e("7Sm4c").markErrorAsHandled)(S),(0,e("8H5XZ").isGraphQLError)(D)&&!(0,e("7Sm4c").isErrorMarkedAsHandled)(D)&&(0,e("7Sm4c").markErrorAsHandled)(D),x?r=p("Error retrieving Commerce Backend Service",x):S?r=p("Error retrieving CCP Entitlement Id",S):D&&(r=p("Error retrieving CCP Transaction Account Id",D))}catch(e){r=p("Error in useCommerceDeepLinks",e)}return{commerceBackendName:g,planSelectionDeepLink:i,planConsentDeepLink:E||c,subscriptionDetailsDeepLink:s,loading:b||I||k,errorMessage:r}}}),t("hfUvC",function(t,n){var r=e("42omo");let a=(0,e("2XqLN").default)(async t=>await (0,e("6bHqX").fetchCommerceRolloutInformation)({cloudId:t,productKey:"confluence.ondemand"},{fetch:e("f7B1p").cfetch}));t.exports.useCommerceRolloutInformation=(t=!1)=>{let[n,o]=(0,r.useState)(!0),[i,c]=(0,r.useState)(null),[l,s]=(0,r.useState)(null),{cloudId:u}=(0,e("bQm3c").useSessionData)();return u||(t=!0),(0,r.useEffect)(()=>{t||(async()=>{try{let t=await a(u);if((0,e("bXe73").isSuccessful)(t))s(t.payload.commerceBackend);else{let n=(0,e("bXe73").isException)(t)?t.exception:t.error;c(n)}}catch(e){e.message=`useCommerceBackendName: ${e.message}`,c(e)}finally{o(!1)}})()},[u,t]),{commerceBackendName:t?null:l,loading:!t&&n,error:t?null:i}}});
//# sourceMappingURL=UpFlowCommerceRouter.4901381c.js.map
