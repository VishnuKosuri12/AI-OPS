function e(e,t,i,o){Object.defineProperty(e,t,{get:i,set:o,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var i=globalThis.parcelRequired477,o=i.register;o("8uNa8",function(t,o){e(t.exports,"emojiPlugin",()=>i("hcboS").emojiPlugin),e(t.exports,"EmojiNodeDataProvider",()=>i("5B7Fh").EmojiNodeDataProvider),i("hcboS")}),o("5B7Fh",function(e,t){class o extends i("i0VEL").NodeDataProvider{isNodeSupported(e){return"emoji"===e.type}nodeDataKey(e){return e.attrs.id||e.attrs.shortName}getData(e,t){let o=this.getNodeDataFromCache(e);o?.data?(t(o),(0,i("eTj7Y").isSSR)()||"undefined"==typeof requestAnimationFrame||requestAnimationFrame(()=>void this.getDataAsync(e,()=>{}))):this.getDataAsync(e,t)}async fetchNodesData(e){let t=this.emojiResource.emojiProviderConfig.optimisticImageApi?.getUrl;if((0,i("eTj7Y").isSSR)()&&t)return e.map(e=>{let o=t({id:e.attrs.id,shortName:e.attrs.shortName,fallback:e.attrs.text});return{id:e.attrs.id,shortName:e.attrs.shortName,fallback:e.attrs.text,representation:{height:i("fhsiz").defaultEmojiHeight,width:i("fhsiz").defaultEmojiHeight,imagePath:o},searchable:!0,type:"",category:""}});let o=await this.emojiProvider;return Promise.all(e.map(async e=>{let i={id:e.attrs.id,shortName:e.attrs.shortName,fallback:e.attrs.text},r=await o.fetchByEmojiId(i,!0);if(t&&r){let e=t(i);if(r.representation&&"imagePath"in r.representation)return{...r,representation:{...r.representation,imagePath:e}}}return r}))}constructor(e){super(),this.name="emojiNodeDataProvider",this.emojiResource=void 0,this.emojiProvider=void 0,this.emojiResource=e,this.emojiProvider=e.getEmojiProvider()}}e.exports.EmojiNodeDataProvider=o}),o("hcboS",function(e,o){let r,a;var n,s,l=i("l998X"),d=i("42omo"),m=i("3pLGZ"),c=i("1oCLl"),p=i("iu6m9"),u=i("cKEEj"),h=i("aFWfo");let E=function(e){let t=new Map;return{call:function(i,o){let r=t.get(i.id||i.shortName);if(r)return r;let a=e(i,o);return t.set(i.id||i.shortName,a),a},clear:t.clear.bind(t)}}((e,t)=>({title:e.shortName||"",key:e.id||e.shortName,render:({isSelected:o,onClick:r,onHover:a})=>(0,l.jsx)(i("kVNt7").default,{emoji:e,selected:o,onMouseMove:a,onSelection:r,emojiProvider:t}),emoji:e})),j=e=>e&&e.length>1&&":"===e.charAt(0)&&":"===e.charAt(e.length-1),f=e=>(t,i)=>(i&&i((0,u.setAsciiMap)(e)(t.tr)),!0),g=(n=e=>t=>(0,u.setProvider)(e)(t),s=()=>{},r=0,a=0,function(...e){let t=Date.now();return t-r<5e3?++a>3&&s?.():(r=t,a=1),n(...e)}),S=e=>(t,i)=>(i&&i(g(e)(t.tr)),!0),P=new(0,i("ks2lK").PluginKey)("emojiPlugin");e.exports.emojiPlugin=({config:e,api:o})=>{let r,a={id:i("lOELb").TypeAheadAvailableNodes.EMOJI,trigger:":",customRegex:"\\(?(:)",headless:e?e.headless:void 0,getItems({query:e,editorState:t}){var o;let r=(o=t,P.getState(o)||{}).emojiProvider;return r?new Promise(t=>{let o={result(e){e&&e.emojis?t(e.emojis.map(e=>E.call(e,r))):t([]),r.unsubscribe(o)}};r.subscribe(o),r.filter(":".concat(e),{limit:50,skinTone:r.getSelectedTone(),sort:e.length?i("aGYoD").SearchSort.Default:i("aGYoD").SearchSort.UsageFrequency})}):Promise.resolve([])},forceSelect({query:t,items:i,editorState:o}){let{asciiMap:r}=P.getState(o)||{},a=":".concat(t);if(!(e?.disableAutoformat&&(0,c.expValEquals)("platform_editor_plain_text_support","isEnabled",!0))&&r&&a.length>=3&&a.endsWith(" ")&&r.has(a.trim())){let e=r.get(a.trim());return{title:e?.name||"",emoji:e}}return j(a)?i.find(e=>e.title.toLowerCase()===a):void 0},selectItem(e,t,r,{mode:a}){let n=P.getState(e);n.emojiProvider&&n.emojiProvider.recordSelection&&t.emoji&&n.emojiProvider.recordSelection(t.emoji).then((0,i("injKz").recordSelectionSucceededSli)(t.emoji,{createAnalyticsEvent:o?.analytics?.sharedState.currentState()?.createAnalyticsEvent??void 0})).catch((0,i("injKz").recordSelectionFailedSli)(t.emoji,{createAnalyticsEvent:o?.analytics?.sharedState.currentState()?.createAnalyticsEvent??void 0}));let s=r((0,i("kQc80").createEmojiFragment)(e.doc,e.selection.$head,t.emoji));return o?.analytics?.actions.attachAnalyticsEvent({action:i("d925B").ACTION.INSERTED,actionSubject:i("d925B").ACTION_SUBJECT.DOCUMENT,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.EMOJI,attributes:{inputMethod:i("d925B").INPUT_METHOD.TYPEAHEAD},eventType:i("d925B").EVENT_TYPE.TRACK})(s),s}};return o?.base?.actions.registerMarks(({tr:e,node:t,pos:i})=>{let{doc:o}=e,{schema:r}=o.type,{emoji:a}=r.nodes;if(t.type===a){let o=t.attrs.text,a=e.mapping.map(i);e.replaceWith(a,a+t.nodeSize,r.text(o,t.marks))}}),{name:"emoji",nodes:()=>[{name:"emoji",node:(0,i("j0XxS").emojiNodeSpec)()}],usePluginHook(){(0,d.useEffect)(()=>{var e;e=()=>{(0,i("lGf1F").preloadEmojiPicker)()},"undefined"!=typeof window&&(void 0!==window.requestIdleCallback?window.requestIdleCallback(()=>e(),{timeout:500}):window.requestAnimationFrame(()=>e()))},[])},pmPlugins:()=>[{name:"emoji",plugin:t=>{var r,a,n;return r=t,a=e,n=o,new(0,i("1S4f7").SafePlugin)({key:P,state:{init:()=>a?.emojiProvider&&(0,p.editorExperiment)("platform_editor_prevent_toolbar_layout_shifts",!0)?{emojiProviderPromise:a.emojiProvider}:{},apply(e,t){let{action:i,params:o}=e.getMeta(P)||{action:null,params:null},a=t;switch(i){case u.ACTIONS.SET_PROVIDER:a={...t,emojiProvider:o.provider,emojiProviderPromise:(0,p.editorExperiment)("platform_editor_prevent_toolbar_layout_shifts",!0)?Promise.resolve(o.provider):void 0},r.dispatch(P,a);break;case u.ACTIONS.SET_ASCII_MAP:a={...t,asciiMap:o.asciiMap},r.dispatch(P,a);break;case u.ACTIONS.SET_INLINE_POPUP:a={...t,inlineEmojiPopupOpen:o.open},r.dispatch(P,a)}return a}},props:{nodeViews:{emoji:e=>new(0,i("lhIns").EmojiNodeView)(e,{intl:r.getIntl(),api:n,emojiNodeDataProvider:a?.emojiNodeDataProvider})}},view(e){let t=(t,i)=>{if("emojiProvider"===t){if(!i)return S?.(void 0)?.(e.state,e.dispatch);i.then(t=>{S?.(t)?.(e.state,e.dispatch),t.getAsciiMap().then(t=>{f(t)(e.state,e.dispatch)})}).catch(()=>S?.(void 0)?.(e.state,e.dispatch))}};return a?.emojiProvider&&t("emojiProvider",a.emojiProvider),{destroy(){r.providerFactory&&r.providerFactory.unsubscribe("emojiProvider",t)}}}})}},{name:"emojiAsciiInputRule",plugin:({schema:t})=>(0,i("cTFYB").inputRulePlugin)(t,o?.analytics?.actions,o,(0,c.expValEquals)("platform_editor_plain_text_support","isEnabled",!0)?e?.disableAutoformat:void 0)}],getSharedState(e){if(!e)return;let{emojiResourceConfig:t,asciiMap:i,emojiProvider:o,inlineEmojiPopupOpen:r,emojiProviderPromise:n}=P.getState(e)??{};return{emojiResourceConfig:t,asciiMap:i,typeAheadHandler:a,emojiProvider:o,emojiProviderPromise:n,inlineEmojiPopupOpen:r}},actions:{openTypeAhead:(0,u.openTypeAhead)(a,o),setProvider:async t=>{let i=await t;return r!==i&&e?.emojiProvider!==t&&(r=i,o?.core.actions.execute(({tr:e})=>g(i)(e))??!1)}},commands:{insertEmoji:(0,i("kQc80").insertEmoji)(o?.analytics?.actions)},contentComponent:({editorView:e,popupsBoundariesElement:t,popupsMountPoint:i,popupsScrollableElement:r})=>!o||(0,p.editorExperiment)("platform_editor_controls","control")||!e?null:(0,l.jsx)(h.InlineEmojiPopup,{api:o,editorView:e,popupsBoundariesElement:t,popupsMountPoint:i,popupsScrollableElement:r}),pluginsOptions:{quickInsert:({formatMessage:e})=>[{id:"emoji",title:e(i("4HWgE").toolbarInsertBlockMessages.emoji),description:e(i("4HWgE").toolbarInsertBlockMessages.emojiDescription),priority:500,keyshortcut:":",isDisabledOffline:!1,icon:()=>(0,l.jsx)(m.IconEmoji,{}),action(e){if((0,p.editorExperiment)("platform_editor_controls","variant1",{exposure:!0})){let t=e("");return(0,u.setInlineEmojiPopupOpen)(!0)(t)}let t=e(void 0);return o?.typeAhead?.actions.openAtTransaction({triggerHandler:a,inputMethod:i("d925B").INPUT_METHOD.QUICK_INSERT})(t),t}}],typeAhead:a,floatingToolbar:(e,r)=>{let a=()=>o?.editorViewMode?.sharedState.currentState()?.mode==="view";if(!a())return;let n=(e,t)=>!o?.annotation||(o?.analytics?.actions&&o?.analytics?.actions?.fireAnalyticsEvent({action:i("d925B").ACTION.CLICKED,actionSubject:i("d925B").ACTION_SUBJECT.BUTTON,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.CREATE_INLINE_COMMENT_FROM_HIGHLIGHT_ACTIONS_MENU,eventType:i("d925B").EVENT_TYPE.UI,attributes:{source:"highlightActionsMenu",pageMode:"edit",sourceNode:"emoji"}}),(o.annotation?.actions?.setInlineCommentDraftState(!0,i("d925B").INPUT_METHOD.TOOLBAR))(e,t));return{title:"Emoji floating toolbar",nodeType:[e.schema.nodes.emoji],onPositionCalculated:(0,i("lNDSG").calculateToolbarPositionAboveSelection)("Emoji floating toolbar"),items:e=>{let s=o?.annotation?.sharedState.currentState(),d=e.marks.find(e=>"annotation"===e.type.name&&s?.annotations[e.attrs.id]===!1);return s&&s.isVisible&&!s.bookmark&&!s.mouseData.isSelecting&&!d&&a()?[{type:"button",showTitle:!0,testId:"add-comment-emoji-button",icon:t(i("1yB28")),title:r.formatMessage(i("ahUGI").annotationMessages.createComment),onClick:n,tooltipContent:(0,l.jsx)(i("hgeg8").ToolTipContent,{description:r.formatMessage(i("ahUGI").annotationMessages.createComment)}),supportsViewMode:!0}]:[]}}}}}},e.exports.emojiPluginKey=P}),o("kQc80",function(e,t){var o=i("8m4tT");let r=(e,t,o)=>{let{id:r="",fallback:a,shortName:n}=o,s=(0,i("bYZ53").getAnnotationMarksForPos)(t),l=e.type.schema.nodes.emoji.createChecked({shortName:n,id:r,text:a||n},null,s),d=e.type.schema.text(" ",s);return i("5SAOw").Fragment.fromArray([l,d])};e.exports.createEmojiFragment=r,e.exports.insertEmoji=e=>(t,a)=>({tr:n})=>{let{doc:s,selection:l}=n,{emoji:d}=n.doc.type.schema.nodes;if(d&&t){let d=r(s,l.$head,t),m=(0,o.safeInsert)(d)(n);return a&&e?.attachAnalyticsEvent({action:i("d925B").ACTION.INSERTED,actionSubject:i("d925B").ACTION_SUBJECT.DOCUMENT,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.EMOJI,attributes:{inputMethod:a},eventType:i("d925B").EVENT_TYPE.TRACK})(m),m.setSelection(i("ks2lK").Selection.near(m.doc.resolve(l.$from.pos+d.size))),m}return null}}),o("j0XxS",function(e,t){var o=i("1oCLl");function r(e){let{shortName:t,id:r,text:a}=e.attrs,n=(0,o.expValEquals)("platform_editor_lovability_emoji_scaling","isEnabled",!0),s={"data-emoji-short-name":t,"data-emoji-id":r,"data-emoji-text":a,contenteditable:"false",style:(0,i("24P9d").convertToInlineCss)({content:"''",fill:"var(--ds-background-neutral, #0515240F)",...n?{minWidth:"16.25px",minHeight:"16.25px"}:{minWidth:"20px",width:"20px",height:"20px"},position:"relative",margin:"-1px 0",display:"inline-block",background:"var(--ds-background-neutral, #0515240F)",borderRadius:"var(--ds-radius-small, 3px)",overflow:"hidden",verticalAlign:"middle",whiteSpace:"nowrap",textAlign:"center"}),"aria-busy":"true","aria-label":t,class:"emoji-common-placeholder"};return(0,i("dh538").fg)("platform_editor_adf_with_localid")&&(s["data-local-id"]=e.attrs.localId),["span",s]}e.exports.emojiNodeSpec=()=>{let e=(0,i("dh538").fg)("platform_editor_adf_with_localid")?i("bIZRt").emojiWithLocalId:i("bIZRt").emoji;return{...e,toDOM:e=>r(e)}},e.exports.emojiToDom=r}),o("lhIns",function(e,o){var r=i("a4TK8"),a=i("1oCLl"),n=i("iu6m9");class s{static logError(e){(0,i("hWRJP").logException)(e,{location:"editor-plugin-emoji/EmojiNodeView"})}isHTMLElement(e){return null!==e&&"innerHTML"in e&&"style"in e&&"classList"in e}async updateDom(e){try{let{shortName:t,id:i,text:o}=this.node.attrs,r=await e?.fetchByEmojiId({id:i,shortName:t,fallback:o},!0);if(!r){s.logError(Error("Emoji description is not loaded")),this.renderFallback();return}let a=r?.representation;if(!s.isEmojiRepresentationSupported(a)){s.logError(Error("Emoji representation is not supported")),this.renderFallback();return}this.renderEmoji(r,a)}catch(e){s.logError(e instanceof Error?e:Error("Unknown error on EmojiNodeView updateDom")),this.renderFallback()}}static isEmojiRepresentationSupported(e){return!!e&&("sprite"in e||"imagePath"in e||"mediaPath"in e)}cleanUpAndRenderCommonAttributes(){this.domElement&&(this.domElement.innerHTML="",this.domElement.style.cssText="",this.domElement.classList.remove(i("98HrB").EmojiSharedCssClassName.EMOJI_PLACEHOLDER),this.domElement.removeAttribute("aria-label"),this.domElement.removeAttribute("aria-busy"))}renderFallback(){this.renderingFallback=!0,this.cleanUpAndRenderCommonAttributes();let e=document.createElement("span");e.innerText=this.node.attrs.text||this.node.attrs.shortName,e.setAttribute("data-testid",`fallback-emoji-${this.node.attrs.shortName}`),e.setAttribute("data-emoji-type","fallback"),this.dom.appendChild(e)}renderEmoji(e,t){this.renderingFallback=!1,this.cleanUpAndRenderCommonAttributes();let o="sprite"in t?"sprite":"image",r=document.createElement("span");r.setAttribute("role","img"),r.classList.add(i("98HrB").EmojiSharedCssClassName.EMOJI_CONTAINER),r.setAttribute("data-testid",`${o}-emoji-${e.shortName}`),r.setAttribute("data-emoji-type",o),r.setAttribute("aria-label",`${this.intl.formatMessage(i("ig7BH").messages.emojiNodeLabel)} ${e.shortName}`);let a="sprite"in t?this.createSpriteEmojiElement(t):this.createImageEmojiElement(e,t);r.appendChild(a),this.dom.appendChild(r)}createSpriteEmojiElement(e){let t=document.createElement("span");t.classList.add(i("98HrB").EmojiSharedCssClassName.EMOJI_SPRITE);let o=e.sprite,r=100/(o.column-1)*e.xIndex,n=100/(o.row-1)*e.yIndex;return t.style.backgroundImage=`url(${o.url})`,t.style.backgroundPosition=`${r}% ${n}%`,t.style.backgroundSize=`${100*o.column}% ${100*o.row}%`,t.style.minWidth=`${i("fhsiz").defaultEmojiHeight}px`,t.style.minHeight=`${i("fhsiz").defaultEmojiHeight}px`,(0,a.expValEquals)("platform_editor_lovability_emoji_scaling","isEnabled",!0)||(t.style.width=`${i("fhsiz").defaultEmojiHeight}px`,t.style.height=`${i("fhsiz").defaultEmojiHeight}px`),t}createImageEmojiElement(e,t){let o=document.createElement("img");return o.classList.add(i("98HrB").EmojiSharedCssClassName.EMOJI_IMAGE),o.src="imagePath"in t?t.imagePath:t.mediaPath,o.loading="lazy",o.alt=e.name||e.shortName,(0,a.expValEquals)("platform_editor_emoji_otp","isEnabled",!0)&&(o.style.minWidth=`${i("fhsiz").defaultEmojiHeight}px`,o.style.objectFit="contain"),t.width&&t.height&&(o.height=i("fhsiz").defaultEmojiHeight,(0,a.expValEquals)("platform_editor_emoji_otp","isEnabled",!0)||o.setAttribute("width",`${i("fhsiz").defaultEmojiHeight/t.height*t.width}`)),o.onerror=()=>{if((0,a.expValEquals)("platform_editor_emoji_otp","isEnabled",!0))return void this.renderFallback();if((0,n.editorExperiment)("platform_editor_offline_editing_web",!0)){var e;(e=this.node.attrs.text,RegExp("^(\\p{Emoji_Presentation}|\\p{Extended_Pictographic}\\u{FE0F}?(?:\\u{200D}\\p{Extended_Pictographic}\\u{FE0F}?)+|\\p{Regional_Indicator}\\p{Regional_Indicator})$","u").test(e))?this.renderFallback():this.renderingFallback=!0}},o}constructor(e,{intl:o,api:l,emojiNodeDataProvider:d}){this.dom=void 0,this.domElement=void 0,this.node=void 0,this.intl=void 0,this.renderingFallback=!1,this.destroy=()=>{},this.node=e,this.intl=o;let{dom:m}=i("5SAOw").DOMSerializer.renderSpec(document,(0,i("j0XxS").emojiToDom)(this.node));if(this.dom=m,(0,a.expValEquals)("platform_editor_emoji_otp","isEnabled",!0)?this.domElement=this.isHTMLElement(m)?m:void 0:this.domElement=m instanceof HTMLElement?m:void 0,(0,a.expValEquals)("platform_editor_emoji_otp","isEnabled",!0)&&d){let i;d.getData(e,e=>{if(e.error){s.logError(e.error),this.renderFallback();return}let o=e.data;if(!o)return void this.renderFallback();let a=o?.representation;if(!s.isEmojiRepresentationSupported(a))return void this.renderFallback();t(r)(i,o)||(i=o,this.renderEmoji(o,a))})}else{if((0,i("eTj7Y").isSSR)())return;let e=l?.emoji?.sharedState;if(!e)return;let t=e.currentState()?.emojiProvider;t&&this.updateDom(t);let o=e.onChange(({nextSharedState:e})=>{t!==e?.emojiProvider&&(t=e?.emojiProvider,this.updateDom(t))}),r=l?.connectivity?.sharedState.onChange(({prevSharedState:t,nextSharedState:o})=>{(0,i("91bcx").isOfflineMode)(t?.mode)&&o?.mode==="online"&&this.renderingFallback&&(0,n.editorExperiment)("platform_editor_offline_editing_web",!0)&&this.updateDom(e.currentState()?.emojiProvider)});this.destroy=()=>{o(),r?.()}}}}e.exports.EmojiNodeView=s}),o("ig7BH",function(e,t){let o=(0,i("cgtv4").defineMessages)({emojiNodeLabel:{id:"fabric.emoji.label",defaultMessage:"Emoji"}});e.exports.messages=o}),o("cKEEj",function(e,t){var o=i("hcboS");let r={SET_PROVIDER:"SET_PROVIDER",SET_RESULTS:"SET_RESULTS",SET_ASCII_MAP:"SET_ASCII_MAP",SET_INLINE_POPUP:"SET_INLINE_POPUP"};e.exports.ACTIONS=r,e.exports.setAsciiMap=e=>t=>t.setMeta(o.emojiPluginKey,{action:r.SET_ASCII_MAP,params:{asciiMap:e}}),e.exports.openTypeAhead=(e,t)=>i=>!!t?.typeAhead?.actions.open({triggerHandler:e,inputMethod:i}),e.exports.setProvider=e=>t=>t.setMeta(o.emojiPluginKey,{action:r.SET_PROVIDER,params:{provider:e}}),e.exports.setInlineEmojiPopupOpen=e=>t=>t.setMeta(o.emojiPluginKey,{action:r.SET_INLINE_POPUP,params:{open:e}})}),o("cTFYB",function(e,t){let o;var r=i("1oCLl");let a=e=>(t,i,r,a)=>{if(!o)return null;let n=o.match(i);return n?new u(t,n,r,a,e).create():null},n=(e,t=!0)=>e[1]+(t?e[2]:""),s=e=>n(e,!1),l=(e,t=!1)=>(t?e[2]:"")+e[3].trim(),d=e=>l(e,!0),m=e=>e[4]||"";class c{match(e){return this.getAsciiEmojiMatch(s(e),d(e),m(e))||this.getAsciiEmojiMatch(n(e),l(e),m(e))}getAsciiEmojiMatch(e,t,i){let o=this.asciiToEmojiMap.get(t);return o?{emoji:o,leadingString:e,trailingString:i}:void 0}constructor(e){this.asciiToEmojiMap=void 0,this.asciiToEmojiMap=e}}c.REGEX_WITH_WHITESPACE=RegExp(`((?:^|[\\s${i("14sLv").leafNodeReplacementCharacter}])(?:\\(*?))(\\(?)([^:\\s${i("14sLv").leafNodeReplacementCharacter}\\(]\\S{1,3}|:\\S{1,3})([\\s\\t\\n])$`),c.REGEX_LEGACY=RegExp(`((?:^|[\\s${i("14sLv").leafNodeReplacementCharacter}])(?:\\(*?))(\\(?)([^:\\s${i("14sLv").leafNodeReplacementCharacter}\\(]\\S{1,3}|:\\S{1,3}( ))$`);class p extends c{match(e){let t=super.match(e);return t&&this.emojiProvider.recordSelection&&this.emojiProvider.recordSelection(t.emoji),t}constructor(e,t){super(t),this.emojiProvider=void 0,this.emojiProvider=e}}class u{create(){let e=this.state.tr.replaceWith(this.from,this.to,this.createNodes());return this.editorAnalyticsAPI?.attachAnalyticsEvent({action:i("d925B").ACTION.INSERTED,actionSubject:i("d925B").ACTION_SUBJECT.DOCUMENT,actionSubjectId:i("d925B").ACTION_SUBJECT_ID.EMOJI,attributes:{inputMethod:i("d925B").INPUT_METHOD.ASCII},eventType:i("d925B").EVENT_TYPE.TRACK})(e),e}get from(){return this.start+this.match.leadingString.length}get to(){return this.end}createNodes(){let e=[this.createEmojiNode()];return this.trailingTextNodeRequired()&&e.push(this.createTrailingTextNode()),e}createEmojiNode(){let{emoji:e}=this.state.schema.nodes;return e.create(this.getEmojiNodeAttrs())}getEmojiNodeAttrs(){let e=this.match.emoji;return{id:e.id,shortName:e.shortName,text:e.fallback||e.shortName}}trailingTextNodeRequired(){return this.match.trailingString.length>0}createTrailingTextNode(){return this.state.schema.text(this.match.trailingString)}constructor(e,t,i,o,r){this.state=void 0,this.match=void 0,this.start=void 0,this.end=void 0,this.editorAnalyticsAPI=void 0,this.state=e,this.match=t,this.start=i,this.end=o,this.editorAnalyticsAPI=r}}e.exports.inputRulePlugin=function(e,t,n,s){if(!(s&&(0,r.expValEquals)("platform_editor_plain_text_support","isEnabled",!0))&&e.nodes.emoji){var l;l=n,l?.emoji.sharedState.onChange(({nextSharedState:e})=>{let t=e?.emojiProvider;t&&t.getAsciiMap().then(e=>{o=new p(t,e)})});let e=(0,i("l03WE").createRule)((0,r.expValEquals)("platform_editor_wait_for_space_after_ascii_emoji","isEnabled",!0)?c.REGEX_WITH_WHITESPACE:c.REGEX_LEGACY,a(t));return new(0,i("1S4f7").SafePlugin)((0,i("aIMBk").createPlugin)("emoji",[e]))}}}),o("aFWfo",function(e,o){var r=i("l998X"),a=i("42omo"),n=i("cKEEj");let s=(0,i("efG2U").default)(i("jwWgu").default),l={emojiPickerAriaLabel:{id:"fabric.emoji.picker.aria.label",defaultMessage:"Emoji picker",description:"Accessible label for the emoji picker popup"}},d=({api:e,popupsMountPoint:t,popupsBoundariesElement:o,popupsScrollableElement:d,editorView:m})=>{let c=(0,i("b3YrF").useSharedPluginStateSelector)(e,"emoji.emojiProvider"),p=(0,i("8C5kA").default)();(0,a.useEffect)(()=>{(0,i("dh538").fg)("platform_editor_ease_of_use_metrics")&&e?.core.actions.execute(e?.metrics?.commands.handleIntentToStartEdit({shouldStartTimer:!1,shouldPersistActiveSession:!0}))},[e?.core.actions,e?.metrics?.commands]);let u=(0,a.useCallback)(()=>{m.dispatch((0,n.setInlineEmojiPopupOpen)(!1)(m.state.tr)),(0,i("dh538").fg)("platform_editor_ease_of_use_metrics")&&e?.core.actions.execute(e?.metrics?.commands.startActiveSessionTimer())},[m,e.core.actions,e.metrics?.commands]),h=(0,a.useCallback)(()=>{requestAnimationFrame(()=>m.focus())},[m]),E=(0,a.useCallback)(t=>{e.core.actions.execute(e.emoji.commands.insertEmoji(t,i("d925B").INPUT_METHOD.PICKER)),u()},[e.core.actions,e.emoji.commands,u]),j=(0,a.useMemo)(()=>(0,i("kuh1P").getDomRefFromSelection)(m,i("d925B").ACTION_SUBJECT_ID.PICKER_EMOJI,e?.analytics?.actions),[m,e?.analytics?.actions]);return c?(0,r.jsx)(s,{ariaLabel:p.formatMessage(l.emojiPickerAriaLabel),offset:[0,12],mountTo:t,boundariesElement:o,scrollableElement:d,zIndex:i("aFUXX").akEditorFloatingDialogZIndex,fitHeight:350,fitWidth:350,target:j,onUnmount:h,focusTrap:!0,preventOverflow:!0,handleClickOutside:u,handleEscapeKeydown:u,captureClick:!0,children:(0,r.jsx)(i("efG2U").OutsideClickTargetRefContext.Consumer,{children:e=>(0,r.jsx)(i("fnia6").EmojiPicker,{emojiProvider:Promise.resolve(c),onPickerRef:e,onSelection:E})})}):null},m=t(a).memo(({api:e,popupsMountPoint:t,popupsBoundariesElement:o,popupsScrollableElement:a,editorView:n})=>(0,i("b3YrF").useSharedPluginStateSelector)(e,"emoji.inlineEmojiPopupOpen")?(0,r.jsx)(d,{api:e,editorView:n,popupsBoundariesElement:o,popupsMountPoint:t,popupsScrollableElement:a}):null);e.exports.InlineEmojiPopup=m}),o("kuh1P",function(e,t){var o=i("8m4tT");e.exports.getDomRefFromSelection=(e,t,r)=>{try{let t=(0,o.findDomRefAtPos)(e.state.selection.from,e.domAtPos.bind(e));if(t instanceof HTMLElement){if("P"!==t.nodeName){let e=t.closest("p");if(e)return e}return t}throw Error("Invalid DOM reference")}catch(e){if(r){let e={action:i("d925B").ACTION.ERRORED,actionSubject:i("d925B").ACTION_SUBJECT.PICKER,actionSubjectId:t,eventType:i("d925B").EVENT_TYPE.OPERATIONAL,attributes:{error:"Error getting DOM reference from selection"}};r.fireAnalyticsEvent(e)}}}});
//# sourceMappingURL=GoalPanel.cbcbc39b.js.map
