function e(e){return e&&e.__esModule?e.default:e}function t(e,t,n,o){Object.defineProperty(e,t,{get:n,set:o,enumerable:!0,configurable:!0})}var n=globalThis.parcelRequired477,o=n.register;o("OCz5m",function(t,o){var r=n("42omo"),a=n("dwS6P");let i={insertCss:e=>e._insertCss()},s=(0,r.forwardRef)(({as:t="div",style:o,...a},i)=>e(r).createElement(t,{...a,style:o,ref:i,className:(0,n("gMc0m").default)(["_1yt41ajq _bfhksm61",a.className])})),l=({contentId:t,spaceKey:o,cloudId:l,userId:c})=>({"com.atlassian.confluence.macro.core":(d,u)=>{let{extensionKey:p}=d,f=(0,n("5kjCz").getMacroAttributesFromADFNode)(d),m={mode:n("5kjCz").EDITOR,node:d,context:i,extensionKey:p,attributes:f,references:[],contentId:t,spaceKey:o};if("toc"===p){let t=new(0,n("h9yJL").JSONTransformer)().encode(u);return e(r).createElement(s,null,e(r).createElement(a.TableOfContentsLoader,{isInEditMode:!0,adf:t,userId:c||"",cloudId:l,macroDefaultProps:m}))}return null}});t.exports.useEditorSSRExtensionHandlers=(e,t,o)=>{let{cloudId:a,userId:i}=(0,n("bQm3c").useSessionData)(),[s,c]=(0,r.useState)(!1),d=(0,n("dPJCf").useIsTransition)();(0,r.useEffect)(()=>{Promise.all(o?.map(e=>void 0!==e.manifestsPromise?e.manifestsPromise:e)).then(()=>c(!0)).catch(e=>{c(!0)})},[o]);let u=(0,r.useMemo)(()=>l({contentId:e,spaceKey:t,cloudId:a,userId:i}),[e,t,a,i]);return d||s?void 0:u}}),o("jFkNO",function(e,t){var o=n("42omo");let r=["small","medium","default","large","xlarge"],a={small:"112px",medium:"262px",default:"262px",large:"524px",xlarge:"1048px"},i=(e,t)=>{if(!t||!e||!Array.isArray(t))return;let n=t.find(t=>t.extensionId===e)?.viewportSize;if(n&&r.includes(n))return a[n]},s=e=>{if(!e)return;let t=e.attrs.extensionKey,n=e.attrs.parameters?.macroParams;if("drawio"===t||"inc-drawio"===t||"drawio-sketch"===t){let e=Number(n?.width?.value),t=Number(n?.zoom?.value);if(e&&e>530||1!==t)return}return"plantumlcloud"===t?n?.originalHeight?.value:n?.height?.value};e.exports.useExtensionNodeParams=()=>{let e=(0,n("1ITQ3").useExtensionViewportSizes)(!(0,n("9wGTI").fg)("confluence_preload_forge_viewport_heights_editor")),t=(0,o.useCallback)(e=>{let t=e.attrs.extensionKey,n=Number(s(e));if(Number.isNaN(n))switch(t){case"gliffy":n=150;break;case"aura-divider":n=21;break;case"aura-cards":n=226;break;case"miro-macro-resizing":n=570;break;case"easy-math-block":n=47;break;case"mathblock":n=58;break;case"page-signatures":n=23;break;case"questionslist-macro":n=800;break;case"jiraroadmap":n=600;break;case"lucidchart":n=500;break;default:n=void 0}else switch(t){case"drawio":case"inc-drawio":case"drawio-sketch":n+=52;break;case"lref-gdrive-embedded-file":n+=79;break;case"plantumlcloud":n+=40}return n?.toString()},[]);return(0,n("9wGTI").fg)("confluence_preload_forge_viewport_heights_editor")?t=>{let n=i(t.attrs.parameters?.extensionId,e);if(n)return n}:(0,n("9wGTI").fg)("confluence_connect_macro_preset_height")?t:void 0}}),o("fthpM",function(t,o){var r=n("42omo"),a=n("b5IZN"),i=n("2NcJL");t.exports.FullPageEditor=function(t){return e(r).createElement(a.CoreEditor,{...t,appearance:t.appearance??"full-page",AppearanceComponent:i.FullPageEditor,__livePage:t.__livePage})}}),o("ijGoX",function(e,t){var o=n("42omo");e.exports.useEditorEngagementPlatform=()=>{let e=(0,n("lwNi3").useCoordinationClient)();return(0,o.useMemo)(()=>({config:{epComponents:{EngagementSpotlight:n("iPfZG").EngagementSpotlight,EngagementInlineDialog:n("kkQZq").default,Coordination:n("axAnW").default},epHooks:{useCoordination:n("hwWwS").useCoordination},coordinationClient:e}}),[e])}}),o("bDgLc",function(t,o){var r=n("5spQU"),a=n("42omo"),i=n("kyKWe");let s=(0,n("eSUdr").default)`query HighlightKeywordsQuery($pageARI:String$workspaceId:String){knowledgeDiscovery{keyPhrases(entityAri:$pageARI workspaceId:$workspaceId)@optIn(to:"KnowledgeDiscovery Get Key Phrases"){__typename ...on KnowledgeDiscoveryKeyPhraseConnection{nodes{...on KnowledgeDiscoveryKeyPhrase{keyPhrase category}}}...on QueryError{message}}}}`;var l=n("7rLBD");let c={pageARI:"",regex:RegExp("(?!)")},d=(e,t="",n=!1)=>{let o;if(t===c.pageARI)return c.regex;try{o=new RegExp(e.map(e=>`\\b${e.phrase}\\b`).join("|"),n?"gi":"g")}catch(e){o=RegExp("(?!)")}return c.pageARI=t,c.regex=o,o},u=()=>{let[t]=(0,n("ep3mz").usePageContentId)(),[o]=(0,n("ep3mz").useContentType)(),{cloudId:r,activationId:c}=(0,n("bQm3c").useSessionData)(),u=t?(0,l.generatePageARI)(t,r,o):void 0,p=(0,l.generateWorkspaceId)(c,r);return{queryHighlightAcronyms:(0,a.useCallback)(async({cacheKey:t=e(i)()}={})=>{if(!p||!u)return{acronyms:[]};let o=(0,n("gKr8t").getAGGClient)();try{let e,{data:n}=await o.query({query:s,fetchPolicy:"network-only",errorPolicy:"ignore",variables:{cacheKey:t,pageARI:u,workspaceId:p}}),r=n?.knowledgeDiscovery?.keyPhrases?.nodes?n.knowledgeDiscovery.keyPhrases.nodes.map(e=>({phrase:e.keyPhrase,category:e.category})):[],a=`${u}-${t}`;return r.length&&(e=d(r,a,!0)),{acronyms:r,acronymRegex:e}}catch(e){return{acronyms:[]}}},[u,p])}};var p=n("2Jxlo");let f=()=>{let[e]=(0,n("ep3mz").usePageContentId)(),{isAIEnabledForContent:t,isRovoEnabledForContent:o}=(0,n("7mpOv").useIsAIEnabledForContent)({contentId:e});return((0,n("9wGTI").fg)("use_frontend_feature_encoding_sdk")?(0,r.isFeatureEnabled)("confluence","confluence-ai"):!(0,n("lzcvT").isFedRamp)())&&(t||o)},m=()=>{let{locale:e}=(0,n("bQm3c").useSessionData)(),[t]=(0,n("ep3mz").usePageContentId)(),{isAIEnabledForContent:o,isRovoEnabledForContent:r}=(0,n("7mpOv").useIsAIEnabledForContent)({contentId:t});return(o||r)&&e.startsWith("en")&&!JSON.parse(n("17wUi").confluenceLocalStorageInstance.getItem(n("1UApO").PERSISTED_KEYS_ON_SERVER.PERSISTED_READING_AIDS_AUTO_HIGHLIGHT)||'""')};t.exports.useEditorPluginAIDefinitionsEnabled=f,t.exports.useEditorPluginAIDefinitionsConfig=()=>{let[e]=(0,n("ep3mz").usePageContentId)(),t=f(),o=m(),{queryHighlightAcronyms:r}=u(),{isRovoEnabledForContent:a}=(0,n("7mpOv").useIsAIEnabledForContent)({contentId:e});return{enabled:t,contentId:e,autoHighlightEnabled:o,queryHighlightAcronyms:r,ReadingAidsPopup:p.ReadingAidsPopup,enablementSource:a?"rovo":"general-ai",readingAidsMaxWordCount:l.READING_AIDS_MAX_WORD_COUNT}}}),o("diJQD",function(t,o){var r,a,i,s=n("l998X");n("42omo");var l=n("42omo"),c=n("keGcB");let d=(0,l.memo)(({useFetchSyncBlockData:e,syncBlockRendererOptions:t,api:o})=>{let{syncBlockInstance:r,providerFactory:a,isLoading:i,reloadData:l}=e(),{isInternetOffline:d}=(0,n("eiA8Z").useSharedPluginStateWithSelector)(o,["connectivity"],({connectivityState:e})=>({isInternetOffline:e?.mode==="collab-offline"}));if(d)return(0,s.jsx)(n("bEEXh").SyncedBlockErrorComponent,{error:n("awHlv").SyncBlockError.Offline});if(!r)return(0,s.jsx)(n("1Wy2j").SyncedBlockLoadingState,{});if(r.error||!r.data)return(0,s.jsx)(n("bEEXh").SyncedBlockErrorComponent,{error:r.error??n("awHlv").SyncBlockError.Errored,resourceId:r.resourceId,onRetry:l,isLoading:i,fireAnalyticsEvent:o?.analytics?.actions.fireAnalyticsEvent});let u={content:r.data.content,version:1,type:"doc"};return(0,s.jsx)(c.AKRendererWrapper,{doc:u,dataProviders:a,options:t})}),u=({syncBlockRendererOptions:e})=>({useFetchSyncBlockData:t,api:n})=>(0,s.jsx)(d,{syncBlockRendererOptions:e,useFetchSyncBlockData:t,api:n});n("42omo");var p=n("2FNjD");let f=(0,n("2XqLN").default)(()=>"undefined"!=typeof window&&!!window.CSS&&!!window.CSS.supports&&window.CSS.supports("anchor-name: --a"));class m{clear(){this.isDirty=!0,this.anchorRectMap={}}getRects(){if(this.isDirty){let e=this.view?.dom.querySelectorAll("[data-section-cta-anchor-name]")||[];this.anchorRectMap=Array.from(e).reduce((e,t)=>{let n=t.getAttribute("data-section-cta-anchor-name");return n?{...e,[n]:{height:t.clientHeight,top:t.offsetTop,left:t.offsetLeft,right:t.offsetLeft+t.clientWidth,width:t.clientWidth,bottom:t.offsetTop+t.clientHeight}}:e},{}),this.isDirty=!1}return this.anchorRectMap}setEditorView(e){this.view!==e&&(this.view=e)}getHeight(e){if(this.isAnchorSupported)return null;let t=this.getRects();return t[e]?.height}getWidth(e){if(this.isAnchorSupported)return null;let t=this.getRects();return t[e]?.width}getLeft(e){if(this.isAnchorSupported)return null;let t=this.getRects();return t[e]?.left}getTop(e){if(this.isAnchorSupported)return null;let t=this.getRects();return t[e]?.top}getRight(e){if(this.isAnchorSupported)return null;let t=this.getRects();return t[e]?.right}getRect(e){return this.isAnchorSupported?null:this.getRects()[e]}constructor(){this.anchorRectMap={},this.isAnchorSupported=f(),this.isDirty=!0,this.view=null}}let g=(0,n("cgtv4").defineMessages)({addSection:{id:"company-hub-section-cta.plus-button.add-section",defaultMessage:"Add section"},contentHeader:{id:"company-hub-section-cta.section-node.content.header",defaultMessage:"Give your section a title"},contentSubHeader:{id:"company-hub-section-cta.section-node.content.sub-header",defaultMessage:"Organize elements into sections with customizable backgrounds."},lozengeTitle:{id:"company-hub-section-cta.section-node.lozenge-title",defaultMessage:"Section"},placeHolderTitle:{id:"company-hub-section-cta.section-node.content.placeholder-title",defaultMessage:"Placeholder"}}),h=()=>(0,s.jsx)(n("gdv5Z").default,{xcss:(0,n("1Whri").cx)("_16jlkb7n _1o9zkb7n _i0dlf1ug _4t3iyh40 _bfhk1aqn")}),E=({anchorId:t,onClick:o,view:r,prevNodeTypeName:a,isLastPosition:i,anchorRectCache:c})=>{let{formatMessage:d}=(0,n("8C5kA").default)(),[u,p]=(0,l.useState)({});return(0,l.useEffect)(()=>{let e=()=>{let e="multiBodiedExtension"===a,o="paragraph"===a,r="table"===a,s="-50%";e||r?s="-100%":i&&o&&(s="0");let l={maxWidth:`${n("aFUXX").akEditorFullWidthLayoutWidth+40}px`};if(f())return void p({...l,positionAnchor:`--${t}`,top:"anchor(bottom)",left:"50%",transform:`translate(-50%, ${s})`});c?.clear();let d=c?.getRect(t);if(!d)return void p({...l,display:"none"});let u=d.top+d.height;p({...l,top:`${u}px`,left:"50%",transform:`translate(-50%, ${s})`})};e();let o=new ResizeObserver(e);return o.observe(r.dom),()=>{o.disconnect()}},[t,a,i,c,r.dom]),(0,s.jsxs)("div",{style:u,"data-testid":"company-hub-plus-button",className:(0,n("gMc0m").default)(["_v5641p41 _18zr1i3y _kqswstnw _1bsb16wv _1e0c1txw _1bah1h6o _4cvr1h6o _4t3izwfg _tzy4idpf _1pbyb4wl _16l4kb7n"]),children:[(0,s.jsx)(h,{}),(0,s.jsx)(n("3gadb").default,{content:d(g.addSection),children:t=>(0,s.jsx)(n("fVUfS").default,{...t,onClick:o,xcss:"_2rko1rr0 _bfhk1aqn _4t3izwfg _1bsbzwfg _irr31ibz _1di6of27","aria-label":d(g.addSection),children:(0,s.jsx)(e(n("g5gZt")),{label:"",color:"var(--ds-icon-inverse, #FFFFFF)"})})}),(0,s.jsx)(h,{})]})};var y=n("dQl1W");(r={}).NARROW="narrow",r.WIDE="wide",r.FULL="full";let _=({header:e,subHeader:t,placeholderTitle:n})=>({type:"extensionFrame",content:[{type:"heading",attrs:{level:1,localId:null},content:[{type:"text",text:`${e}`}]},{type:"paragraph",attrs:{localId:null},content:[{type:"text",text:`${t}`}]},{type:"paragraph",attrs:{localId:null}},{type:"extension",attrs:{extensionKey:"hub-element-placeholder",extensionType:"com.atlassian.confluence.hub-element-placeholder",parameters:{extensionTitle:n},text:null,layout:"default",localId:null}}]}),S=(e,t)=>e.schema.nodeFromJSON(_(t)),k=(t,n)=>{let o={header:n.formatMessage(g.contentHeader),subHeader:n.formatMessage(g.contentSubHeader),placeholderTitle:n.formatMessage(g.placeHolderTitle)};return t.schema.nodes.multiBodiedExtension.create({extensionType:"com.atlassian.confluence.hub-section",extensionKey:"hub-section",layout:"full-width",localId:e(y)(),parameters:{extensionTitle:n.formatMessage(g.lozengeTitle),backgroundColor:"var(--ds-surface, #FFFFFF)",contentWidth:"wide"}},S(t,o))},T=new(0,n("ks2lK").PluginKey)("companyHubSectionCta"),b=(e,t)=>{let{schema:n,doc:o}=e,r=o.resolve(t);if(r.parent.type!==n.nodes.doc)return!1;let a=r.nodeBefore,i=!a,s=a?.attrs.extensionKey==="hub-section"&&a?.attrs.extensionType==="com.atlassian.confluence.hub-section",l=!r.nodeAfter;return(i||s||l)&&r.parent.canReplaceWith(r.index(),r.index(),n.nodes.multiBodiedExtension)},N=e=>{let t=[],{doc:o}=e,r=new Map;if(b(e,0)){let e=0===o.childCount;r.set(0,{prevNodeTypeName:void 0,isLastPosition:e})}return o.content.forEach((t,n,a)=>{let i=n+t.nodeSize;if(b(e,i)){let e=a===o.childCount-1;r.set(i,{prevNodeTypeName:t.type.name,isLastPosition:e})}}),r.forEach(({prevNodeTypeName:e,isLastPosition:o},r)=>{let a=`section-cta-anchor-${r}`;t.push(n("ftzrq").Decoration.widget(r,()=>{let e=document.createElement("span");return e.style.cssText=`position: absolute; anchor-name: --${a};`,e.setAttribute("data-section-cta-anchor-name",a),e},{key:a,side:-1,anchorId:a,prevNodeTypeName:e,isLastPosition:o}))}),n("ftzrq").DecorationSet.create(o,t)};class v{update(e,t){this.view=e,this.anchorRectCache.setEditorView(this.view),T.getState(t)!==T.getState(e.state)&&(this.anchorRectCache.clear(),this.renderButtons(e.state))}destroy(){this.anchorRectCache.clear(),this.root.unmount(),this.container.remove()}renderButtons(e){let t=T.getState(e);if(!t)return;let o=e=>{let t=this.api?.companyHubSectionCtaPlugin?.commands?.insertSection(e,this.intl);t&&t(this.view.state,this.view.dispatch,this.view)},r=t.find();this.root.render((0,s.jsx)(n("gmMgo").Provider,{value:this.intl,children:r.map(e=>{let t=e.spec.anchorId,n=e.from,r=e.spec.prevNodeTypeName,a=e.spec.isLastPosition;return(0,s.jsx)(E,{anchorId:t,prevNodeTypeName:r,isLastPosition:a,onClick:()=>o(n),anchorRectCache:this.anchorRectCache,view:this.view},t)})}))}constructor(t,n,o){this.view=void 0,this.container=void 0,this.root=void 0,this.api=void 0,this.intl=void 0,this.anchorRectCache=void 0,this.view=t,this.api=n,this.intl=o,this.anchorRectCache=new m,this.anchorRectCache.setEditorView(this.view),this.container=document.createElement("div"),this.view.dom.parentElement?.appendChild(this.container),this.root=e(p).createRoot(this.container),this.renderButtons(this.view.state)}}let M=({api:e})=>({name:"companyHubSectionCtaPlugin",pmPlugins:()=>[{name:"companyHubSectionCtaButton",plugin:({getIntl:t})=>{let o=t();return new(0,n("1S4f7").SafePlugin)({key:T,state:{init:(e,t)=>N(t),apply:(e,t,n)=>N(n)},props:{decorations:e=>T.getState(e)},view:t=>new v(t,e,o)})}}],commands:{insertSection:(e,t)=>(o,r)=>{if(r){let{tr:a}=o,i=k(o,t);a.insert(e,i);let s=n("ks2lK").NodeSelection.create(a.doc,e);a.setSelection(s),r(a)}return!0}}});var I=n("hr8mu"),w=n("PJ00O");n("42omo");let A=()=>{let e=[];return{register:t=>{e.push(...t)},components:e}};var C=n("8m4tT");let O=(e,t)=>"expand"===e&&t?"nestedExpand":e,P=(e,t)=>{let n=t.nodes.expand;return n?n.createAndFill({title:e.attrs?.title||""},e.content):null},x=(e,t)=>{let n=t.nodes.nestedExpand;return n?n.createAndFill({title:e.attrs?.title||""},e.content):null},R=(e,t)=>"paragraph"===e.type.name?e:t.nodes.paragraph.createAndFill({},e.content)??null,L=e=>{if(e.startIndex===e.endIndex)return[];if(e.endIndex-e.startIndex<=1)return[e.parent.child(e.startIndex)];let t=[];for(let n=e.startIndex;n<e.endIndex;n++)e.parent.child(n).isBlock&&t.push(e.parent.child(n));return t},B=e=>e.children.map(e=>e.isText?e.text:"hardBreak"===e.type.name?"\n":"").join(""),D=(e,t)=>{let{schema:n,targetNodeTypeName:o}=t,r=n.nodes[o];if(!r)return e;if("codeBlock"===o){let t=e.map(e=>e.content.textBetween(0,e.content.size,"\n")).join("\n");return[n.nodes.codeBlock.create({},n.text(t))]}return e.map(e=>r.validContent(e.content)?n.nodes.paragraph.create({},e.content):e)},F=(e,t)=>{let{schema:n,targetNodeTypeName:o,targetAttrs:r}=t;if("heading"!==o)return e;let a=n.nodes.heading;if(!a)return e;let i="number"==typeof r?.level?r.level:1;return e.map(e=>e.isTextblock?a.create({level:i},e.content):e)},U=(e,t)=>{let n,o;switch(e){case"bulletList":n=t.nodes.bulletList,o=t.nodes.listItem;break;case"orderedList":n=t.nodes.orderedList,o=t.nodes.listItem;break;case"taskList":n=t.nodes.taskList,o=t.nodes.taskItem}return{targetListType:n,targetItemType:o}},q=(e,t)=>{let{schema:o,targetNodeTypeName:r}=t,a=o.nodes.paragraph;return e.map(e=>{if(e.type!==o.nodes.decisionList)return e;let{targetListType:t,targetItemType:i}=U(r,o);if(!t||!i)return e;let s=[];return e.forEach(e=>{let t=[];e.forEach(e=>{t.push(e)});let n=i===o.nodes.listItem?i.create({},a.create({},t)):i.create({},t);n&&s.push(n)}),t.create({},n("5SAOw").Fragment.from(s))||e})},j=(e,t)=>[t.nodes.taskList,t.nodes.bulletList,t.nodes.orderedList].some(t=>t.name===e),G=(e,t)=>[t.nodes.taskList,t.nodes.decisionList].some(t=>t.name===e),K=(e,t)=>{let o=[],r=t.nodes.paragraph,a=[t.nodes.listItem,t.nodes.taskItem,t.nodes.decisionItem],i=e=>{e.forEach(e=>{if(a.some(t=>e.type===t)){let a=[],s=[],l=e.type.inlineContent;e.forEach(e=>{j(e.type.name,t)?s.push(e):e.isText?l?a.push(e):a.push(r.createAndFill({},e)):a.push(e)}),o.push(e.copy(n("5SAOw").Fragment.from(a))),s.forEach(e=>{i(e)})}else j(e.type.name,t)&&i(e)})};return i(e),o},V=(e,t)=>e.map(e=>j(e.type.name,t.schema)?e.copy(n("5SAOw").Fragment.from(K(e,t.schema))):e),H=(e,t)=>{let{schema:n}=t,o=n.nodes.paragraph,r=[];return[...e.map(e=>{if(!j(e.type.name,n))return e;let t=[];return e.forEach(e=>{let a=[];e.forEach(e=>{e.type===o?a.push(...e.children):e.isText||e.isInline?a.push(e):j(e.type.name,n)||r.push(e)});let i=n.nodes.decisionItem.create({},a);t.push(i)}),n.nodes.decisionList.create({},t)||e}),...r]},z=(e,t,o,r)=>{let a=e.type.schema,i=a.nodes.taskList,s=e.type===i,l=t===i.name,c=(e,t,n,o=!1)=>{let a=e.type.schema,i=a.nodes[n],s="taskItem"===n,l="taskItem"===e.type.name,c=a.nodes.paragraph;if(s){let t=[];return e.forEach(e=>{e.type===c?t.push(...e.children):e.isText?t.push(e):j(e.type.name,a)||r.push(e)}),i.create({},t)}let d=[];return l?d.push(c.create(null,e.content)):e.forEach(e=>{j(e.type.name,a)?o||d.push(z(e,t,n,r)):d.push(e)}),0===d.length&&d.push(c.create()),i.create({},d)};if(s&&!l){let a=e.type.schema,i=a.nodes[t],s=[];return e.forEach(e=>{if(j(e.type.name,a)){if(s.length>0){let a=s[s.length-1],i=z(e,t,o,r),l=a.content.append(n("5SAOw").Fragment.from([i])),c=a.type.create(a.attrs,l);s[s.length-1]=c}}else{let n=c(e,t,o);n&&s.push(n)}}),i.create(e.attrs,s)}if(!s&&l){let n=e.type.schema,a=n.nodes[t],i=[];return e.forEach(e=>{let a=c(e,t,o,!0);a&&i.push(a),e.forEach(e=>{j(e.type.name,n)&&i.push(z(e,t,o,r))})}),a.create(e.attrs,i)}let d=a.nodes[t],u=[];return e.forEach(e=>{let n=j(e.type.name,a)?z(e,t,o,r):c(e,t,o);n&&u.push(n)}),d.create(e.attrs,u)},W=e=>{let t=[];return(e.forEach(e=>{"layoutSection"===e.type.name&&e.children.forEach(e=>{"layoutColumn"===e.type.name&&t.push(...e.children)})}),0===t.length)?e:t},Y={blockquote:"container",blockCard:"atomic",bodiedExtension:"atomic",bulletList:"list",codeBlock:"container",decisionList:"list",embedCard:"atomic",expand:"container",extension:"atomic",heading:"text",layoutSection:"container",media:"atomic",mediaGroup:"atomic",mediaSingle:"atomic",multiBodiedExtension:"atomic",orderedList:"list",panel:"container",paragraph:"text",nestedExpand:"container",taskList:"list",table:"atomic"},J=e=>e in Y,$=e=>e&&J(e)?e:null,X=e=>"text"===Y[e.type.name],Z=(e,t)=>{let n=t.nodes.decisionItem;return n&&n.validContent(e)?n.createAndFill({},e):null},Q=(e,t)=>{let n=t.nodes.decisionList;return n&&0!==e.length?n.createAndFill({},e):null},ee=e=>"text"===Y[e.type.name],et=(e,t,o)=>e.type.name!==o&&t.validContent(n("5SAOw").Fragment.from(e)),en=(e,t,n,o,r,a)=>{let i="container"===Y[n.type.name],s="container"===Y[r],l=!t&&e.length>0;if(i&&s&&l){let t=a.nodes.paragraph.create();return[o.create({},t),...e]}return e},eo=(e,t)=>{let{schema:o,targetNodeTypeName:r,fromNode:a}=t,i=o.nodes[r];if(!i)return e;let s=[],l=[],c=!1,d=()=>{if(l.length>0){let e=i.createAndFill({},n("5SAOw").Fragment.fromArray(l));e&&(s.push(e),c=!0),l=[]}};e.forEach(e=>{if(et(e,i,r))l.push(e);else if(e.type.name===r)d(),s.push(e);else if(ee(e)){let t=R(e,o);t&&l.push(t)}else d(),s.push(e)}),d();let u=en(s,c,a,i,r,o);return u.length>0?u:e},er=(e,t)=>{let{schema:n}=t;return e.map(e=>n.nodes.codeBlock.createAndFill({},n.text(B(e)))??e)},ea=e=>{let t=[];return e.forEach(e=>{0===e.children.length?t.push(e):t.push(...e.children)}),t},ei=(e,t)=>{let{schema:n}=t,o=[],{expand:r,nestedExpand:a}=n.nodes;return e.forEach(e=>{if(e.type.name===r.name||e.type.name===a.name){let t=e.attrs?.title;if(t){let e=n.nodes.paragraph.createAndFill({},n.text(t));e&&o.push(e)}e.children.forEach(e=>{if(e.type.name===a.name){let t=P(e,n);t?o.push(t):o.push(e)}else o.push(e)})}else ea([e],t)}),o},es=e=>t=>{let n=t.marks.filter(t=>!e.includes(t.type));return t.mark(n)},el=(e,t)=>{let n=[t.marks.breakout,t.marks.alignment];return e.map(es(n))},ec=(e,t)=>{let{schema:n}=t,{layoutSection:o,layoutColumn:r}=n.nodes||{},a=r.createAndFill({},el(e,n)),i=r.createAndFill();if(!a||!i)return e;let s=o.createAndFill({},[a,i]);return s?[s]:e},ed=(e,t,n)=>{let o="taskList"===t?n.nodes.taskItem:n.nodes.decisionItem,r=e.flatMap(e=>e.isTextblock?e.children:e.isText?[e]:[]),a=o.create({},r),i=n.nodes[t].createAndFill({},a);return i?[i]:e},eu=(e,t,n)=>{let o=e.map(e=>n.nodes.listItem.createAndFill({},e.isTextblock?R(e,n):e)).filter(e=>null!==e);if(0===o.length)return e;let r=n.nodes[t].createAndFill({},o);return r?[r]:e},ep=(e,t)=>{let{schema:n,targetNodeTypeName:o}=t;return G(o,n)?ed(e,o,n):eu(e,o,n)},ef=(e,t)=>{let{schema:n,targetNodeTypeName:o}=t,r=e;"expand"===o&&(r=e.map(e=>"expand"===e.type.name?x(e,n)??e:e));let a=n.nodes[o].createAndFill({},el(r,n));return a?[a]:e},em={atomic:{atomic:void 0,container:[ef],list:[ep],text:void 0},container:{atomic:void 0,container:[ea,ef],list:void 0,text:[ea,F]},list:{atomic:void 0,container:[ef],list:[(e,t)=>{let{schema:n,targetNodeTypeName:o}=t,r=[];return[...e.map(e=>j(e.type.name,n)?z(e,o,"taskList"===o?"taskItem":"listItem",r):e),...r]}],text:[V,(e,t)=>{let n=[t.schema.nodes.bulletList,t.schema.nodes.orderedList,t.schema.nodes.taskList,t.schema.nodes.decisionList];return e.flatMap(e=>{if(n.some(t=>e.type===t)){let n=[];return e.forEach(e=>{"taskItem"===e.type.name||"decisionItem"===e.type.name?n.push(t.schema.nodes.paragraph.create({},e.content)):n.push(...e.children)}),n}return e})},F]},text:{atomic:void 0,container:[eo],list:[ep],text:[D,F]}},eg={paragraph:{paragraph:null,codeBlock:[er],layoutSection:[ec]},heading:{codeBlock:[er],layoutSection:[ec]},panel:{panel:null,layoutSection:[ea,ec],codeBlock:[ea,D,ef],blockquote:[ea,eo],taskList:null,bulletList:null,orderedList:null,heading:null},expand:{expand:null,panel:[ei,eo],blockquote:[ei,eo],layoutSection:[ei,ec],paragraph:[ei],codeBlock:null,heading:null},nestedExpand:{expand:null,nestedExpand:null,panel:[ei,eo],blockquote:[ei,eo],paragraph:[ei],codeBlock:null,heading:null},blockquote:{blockquote:null,expand:[ef],nestedExpand:[ef],layoutSection:[ec],codeBlock:null,decisionList:[ea,(e,t)=>{let{schema:n}=t;if(!n.nodes.decisionItem)return e;let o=[],r=[],a=()=>{if(r.length>0){let e=Q(r,n);e&&o.push(e),r=[]}};return e.forEach(e=>{let t=X(e)?Z(e.content,n):null;t?r.push(t):(a(),o.push(e))}),a(),o.length>0?o:e}]},layoutSection:{layoutSection:null,blockquote:[W,eo],expand:[W,ef],panel:[W,eo],codeBlock:null,paragraph:[W],heading:null},codeBlock:{codeBlock:null,blockquote:[ef],expand:[ef],nestedExpand:[ef],layoutSection:[ec],panel:[ef],heading:null},bulletList:{bulletList:null,codeBlock:null,layoutSection:[ec],decisionList:[V,H],heading:null},orderedList:{orderedList:null,codeBlock:null,layoutSection:[ec],decisionList:[V,H],heading:null},taskList:{blockquote:null,codeBlock:null,layoutSection:[ec],decisionList:[V,H],heading:null,taskList:null},table:{layoutSection:[ec],blockquote:null,panel:null,codeBlock:null,orderedList:null,bulletList:null,taskList:null,decisionList:null},mediaSingle:{layoutSection:[ec],codeBlock:null,decisionList:null,taskList:null},mediaGroup:{layoutSection:[ec],codeBlock:null,decisionList:null,taskList:null},decisionList:{decisionList:null,bulletList:[q],orderedList:[q],taskList:[q],layoutSection:[ec]},blockCard:{layoutSection:[ec],blockquote:null,codeBlock:null,orderedList:null,bulletList:null,taskList:null,decisionList:null},embedCard:{layoutSection:[ec],blockquote:null,panel:null,codeBlock:null,orderedList:null,bulletList:null,taskList:null,decisionList:null},extension:{layoutSection:[ec],codeBlock:null,decisionList:null,taskList:null,orderedList:null,bulletList:null},bodiedExtension:{layoutSection:[ec],blockquote:null,expand:null,panel:null,codeBlock:null,orderedList:null,bulletList:null,taskList:null,decisionList:null}},eh=(e,t)=>{let n=Y[e],o=Y[t],r=eg[e]?.[t];return null===r?null:r??em[n][o]},eE=({sourceNode:e,targetNodeType:t,schema:n,isNested:o,targetAttrs:r})=>{let a=[e],i=$(e.type.name),s=O($(t.name),o);if(!i||!s)return;let l=eh(i,s),c={fromNode:e,targetNodeTypeName:s,schema:n,targetAttrs:r};if(l&&0!==l.length)return l.reduce((e,t)=>t(e,c),a)},ey=(e,t)=>{let n=eh(e,t);return!n||0===n.length},e_=(e,t,o,r)=>{let a=O(o,!0);if(!a)return!1;let i=e.nodes[a];return t.type.validContent(n("5SAOw").Fragment.from(i.createAndFill(r)))},eS=(e,t)=>{let n=e.attrs?.level,o=t?.level;return void 0!==n&&void 0!==o&&n!==o},ek=(e,t,n,o,r,a)=>{let i=$(e.type.name);return!(!i||ey(i,t))&&("heading"===i&&"heading"===t?eS(e,n):!o||!!e_(a,r,t,n))},eT=({selection:e,targetNodeTypeName:t,targetNodeTypeAttrs:o})=>{let{range:r}=(0,n("l6okE").expandSelectionToBlockRange)(e);if(!r)return!1;let a=L(r),i=r.parent,s=r.depth>=1,{schema:l}=e.$from.doc.type,c=$(t);return!c||!a.some(e=>ek(e,c,o,s,i,l))},eb=(e,t,o)=>{let r=e.doc.resolve(t),a=r.nodeAfter;if(!a)return e;let i="bulletList"===o||"orderedList"===o||"taskList"===o,s="blockquote"===o,l=["panel","expand","codeBlock","layoutSection"].includes(o);if(i||s){let t=r.pos+1,o=r.pos+a.nodeSize-1,i=n("ks2lK").TextSelection.between(e.doc.resolve(t),e.doc.resolve(o));return e.setSelection(i)}if(l){let t=n("ks2lK").NodeSelection.create(e.doc,r.pos);return e.setSelection(t)}return e};var eN=n("iu6m9");let ev=(e,t)=>{switch(e){case"heading1":return{nodeType:t.heading,attrs:{level:1}};case"heading2":return{nodeType:t.heading,attrs:{level:2}};case"heading3":return{nodeType:t.heading,attrs:{level:3}};case"heading4":return{nodeType:t.heading,attrs:{level:4}};case"heading5":return{nodeType:t.heading,attrs:{level:5}};case"heading6":return{nodeType:t.heading,attrs:{level:6}};case"paragraph":return{nodeType:t.paragraph};case"blockquote":return{nodeType:t.blockquote};case"expand":return{nodeType:t.expand};case"panel":return{nodeType:t.panel,attrs:{panelType:"info"}};case"codeBlock":return{nodeType:t.codeBlock};case"bulletList":return{nodeType:t.bulletList};case"orderedList":return{nodeType:t.orderedList};case"taskList":return{nodeType:t.taskList};case"layoutSection":return{nodeType:t.layoutSection};default:return null}},eM=e=>["paragraph","heading","codeBlock"].includes(e.type.name),eI=e=>["paragraph","heading"].includes(e.type.name),ew=e=>["bulletList","orderedList","taskList"].includes(e.type.name),eA=e=>["panel","expand","blockquote"].includes(e.type.name),eC=e=>["paragraph","heading","codeBlock"].includes(e.name),eO=e=>["bulletList","orderedList","taskList"].includes(e.name),eP=e=>["panel","expand","blockquote"].includes(e.name),ex=e=>"layoutSection"===e.name,eR=e=>"layoutSection"===e.type.name,eL=e=>["table","mediaSingle","extension","bodiedExtension","blockCard","embedCard"].includes(e.type.name),eB=e=>t=>{try{return e.validContent(n("5SAOw").Fragment.from(t))}catch{return!1}},eD=(e,t)=>{let n=[];return(e.descendants(e=>(e.isText?n.push(e):e.isInline&&n.push(e),!0)),0===n.length&&e.textContent)?[t.text(e.textContent)]:n},eF=(e,t)=>{let o=[];return e.forEach(e=>{if(e.marks.length>0){let n=t.allowedMarks(e.marks),r=e.mark(n);o.push(r)}else o.push(e)}),n("5SAOw").Fragment.from(o)},eU=(e,t)=>{let n=[];return e.textContent.split("\n").forEach(e=>{let o=t.nodes.paragraph.create(null,e?t.text(e):null);n.push(o)}),n},eq=e=>(0,eN.editorExperiment)("platform_synced_block",!0)?n("fJNzZ").breakoutResizableNodes.includes(e.name):["codeBlock","expand","layoutSection"].includes(e.name),ej=(e,t)=>{let n=t.allowedMarks(e.marks),o=e.marks.find(e=>"breakout"===e.type.name);return o&&eq(t)?n.some(e=>"breakout"===e.type.name)?n:[...n,o]:n},eG=(e,t)=>{let n=["paragraph","blockquote"],o=["heading1","heading2","heading3","heading4","heading5","heading6"],r=["bulletList","orderedList"];return["panel","expand","codeBlock","layoutSection","taskList"].includes(t)&&(n.includes(e)||o.includes(e)||r.includes(e))?"blockNodeInserted":r.includes(t)&&n.includes(e)?"listInserted":r.includes(e)&&(r.includes(t)||n.includes(t))?"listConverted":(n.includes(e)||o.includes(e))&&(n.includes(t)||o.includes(t))?"textFormatted":void 0},eK=e=>{let t="",n=[];return e.content.length<1?{inlineTextContent:"",invalidContent:n}:(e.forEach(e=>{["paragraph","heading","taskItem","codeBlock"].includes(e.type.name)?e.content.forEach(e=>{"status"===e.type.name?t+=e.attrs.text:t+=`${e.textContent}`}):eO(e.type)||n.push(e)}),{inlineTextContent:t,invalidContent:n})},eV=(e,t)=>{let n=eK(e).inlineTextContent;return t.text(n)},eH=(e,t)=>{let{tr:n,sourceNode:o,targetNodeType:r,targetAttrs:a}=e,i=n.doc.type.schema||{},s=eB(t),l=e=>{let n="text"===e.type.name,o=e;return((eP(t)||eO(t))&&(o=e.mark(e.marks.filter(e=>!["alignment","indentation"].includes(e.type.name)))),s(o)&&!n)?o:r.createChecked(a,n?o:o.content,o.marks)};if(eM(o))return o.type===i.nodes.codeBlock?o.textContent.split("\n").map(e=>r.createChecked(void 0,e?i.text(e):null)):[l(o)];if(eA(o)){let e=[];return"expand"===o.type.name&&o.attrs?.title&&e.push(l(i.text(o.attrs.title))),o.content.forEach(t=>{if(eI(t))return void e.push(l(t));e.push(t)}),e}if(ew(o)&&eC(t))if("taskList"===o.type.name)return(0,C.findChildrenByType)(o,i.nodes.taskItem).map(e=>e.node).map(e=>e.content).map(e=>r.createChecked(a,e.content));else{let e=(0,C.findChildrenByType)(o,i.nodes.paragraph).map(e=>e.node);return r===i.nodes.heading?e.map(e=>r.createChecked(a,e.content)):e}return[o]},ez=(e,t)=>{let o=[],r=e=>{if(0===o.length)o.push({canBeTransformed:!0,content:e});else{let t=o[o.length-1];t.canBeTransformed?o[o.length-1]={content:[...t.content,...e],canBeTransformed:!0}:o.push({content:e,canBeTransformed:!0})}};return e.forEach(e=>{if(e.isTextblock)r([e.type===t.nodes.codeBlock?e.textContent:eK(n("5SAOw").Fragment.from(e)).inlineTextContent]);else if(ew(e)){let o=[],a=e.type===t.nodes.taskList?t.nodes.taskItem:t.nodes.listItem;(0,C.findChildrenByType)(e,a).map(e=>e.node).forEach(e=>{if(e.type===t.nodes.taskItem){let t=eK(n("5SAOw").Fragment.from(e)).inlineTextContent;o.push(t)}else{let t=eK(e.content).inlineTextContent;o.push(t)}}),r(o)}else o.push({canBeTransformed:!1,content:e})}),o.map(({canBeTransformed:e,content:n})=>{if(!e)return n;{let e=n.join("\n");if(""!==e)return t.nodes.codeBlock.createChecked(null,t.text(e))}}).filter(Boolean)},eW=(e,t,n)=>{if(t===n.nodes.codeBlock)return ez(e,n);let o=[];return e.forEach(e=>{if(ew(e)){let r=e.type===n.nodes.taskList?n.nodes.taskItem:n.nodes.listItem;(0,C.findChildrenByType)(e,r).map(e=>e.node).forEach(e=>{if(e.type===n.nodes.taskItem){let n=[...e.content.content];n.length>0&&o.push(t.createChecked(null,n))}else e.forEach(e=>{eI(e)&&o.push(t.createChecked(null,[...e.content.content]))})})}else o.push(e)}),o},eY=(e,t)=>{let o=[],r=eB(t);return e.forEach(e=>{if(eL(e))o.push({node:e,canBeTransformed:!1});else{let n=e.type===t;if(!r(e)&&!n)return void o.push({node:e,canBeTransformed:!1});let a=n?e.content.content:[e];if(0===o.length)o.push({node:a,canBeTransformed:!0});else{let e=o[o.length-1];e.canBeTransformed?o[o.length-1]={node:[...e.node,...a],canBeTransformed:!0}:o.push({node:a,canBeTransformed:!0})}}}),o.map(({node:e,canBeTransformed:o})=>o?t.createChecked(null,n("5SAOw").Fragment.fromArray(e)):e)},eJ=(e,t,o)=>{let r=(0,n("iD5M5").isTaskList)(t),a=[],i=r?o.nodes.taskItem:o.nodes.listItem,s=[],l=e=>{s.push(e)},c=eB(i);return e.forEach(e=>{if(eL(e))a.push({canBeTransformed:!1,node:e});else{let s;if(ew(e)){let r=(0,n("iD5M5").isBulletOrOrderedList)(e.type),a=(0,n("iD5M5").isTaskList)(t),i=(0,n("iD5M5").isTaskList)(e.type),c=(0,n("iD5M5").isBulletOrOrderedList)(t),d=(0,n("iD5M5").getSupportedListTypesSet)(o.nodes);s=e.type===t?e.content.content:[...(0,n("4FFjp").transformListRecursively)({isSourceBulletOrOrdered:r,isSourceTask:i,isTargetBulletOrOrdered:c,isTargetTask:a,listNode:e,schema:o,supportedListTypes:d,targetNodeType:t},l).content.content]}else if(eI(e)||c(e))if(r){let t=[...e.content.content];t.length>0&&(s=[i.create(null,t)])}else s=[i.create(null,e)];else c(e)||a.push({canBeTransformed:!1,node:e});if(s)if(0===a.length)a.push({canBeTransformed:!0,node:s});else{let e=a[a.length-1];e.canBeTransformed?a[a.length-1]={node:[...e.node,...s],canBeTransformed:!0}:a.push({node:s,canBeTransformed:!0})}}}),[...a.map(({node:e,canBeTransformed:o})=>o?t.createChecked(null,n("5SAOw").Fragment.fromArray(e)):e),...s]},e$=(e,t,o,r)=>{if(1===e.length&&0===e[0].content.size&&!eP(t)){if(eC(t)){if(["heading","paragraph"].includes(t.name))return[t.createChecked(r)];if("codeBlock"===t.name)return[t.createChecked()]}if(eO(t)){let e=(0,n("iD5M5").isTaskList)(t)?o.nodes.taskItem.createChecked():o.nodes.listItem.createChecked(null,o.nodes.paragraph.createChecked());return[t.createChecked(null,e)]}return e}return eC(t)?eW(e,t,o):eP(t)?eY(e,t):eO(t)?eJ(e,t,o):[]},eX=(e,t,o)=>{let{layoutSection:r,layoutColumn:a,paragraph:i}=e.nodes,s=n("5SAOw").Fragment.fromArray([a.createChecked({width:n("boKri").DEFAULT_TWO_COLUMN_LAYOUT_COLUMN_WIDTH},t),a.create({width:n("boKri").DEFAULT_TWO_COLUMN_LAYOUT_COLUMN_WIDTH},i.createAndFill())]);return r.createChecked(void 0,s,o)},eZ=e=>{let{tr:t,sourceNode:n,sourcePos:o}=e,r=n.mark(n.marks.filter(e=>"breakout"!==e.type.name)),a=ej(n,t.doc.type.schema.nodes.layoutSection),i=eX(t.doc.type.schema,r,a);return eI(n)?t.replaceRangeWith(o>0?o-1:o,o+n.nodeSize-1,i):t.replaceRangeWith(o,o+n.nodeSize,i),t},eQ=e=>{let{tr:t,sourceNode:o,targetNodeType:r,sourcePos:a,targetAttrs:i}=e,s=t.doc.type.schema||{},{layoutSection:l,layoutColumn:c,paragraph:d,heading:u}=s.nodes||{},p=[],f=r===u?u:d;return o.children.forEach(e=>{if(e.type===c){let o=[];e.content.forEach(e=>{let n=eH({tr:t,sourceNode:e,targetNodeType:f,sourcePos:0,targetAttrs:i},r);o.push(...n)});let a=e$(o,r,s,i);p.push(c.createChecked(e.attrs,n("5SAOw").Fragment.fromArray(a),e.marks))}}),t.replaceRangeWith(a,a+o.nodeSize,l.createChecked(o.attrs,n("5SAOw").Fragment.fromArray(p),o.marks))},e0=(e,t,o,r)=>{let a=[];return e.forEach(e=>{t===e.type?a.push(o.createChecked(e.attrs,e.content,r?e.marks:void 0)):a.push(e)}),n("5SAOw").Fragment.from(a)},e1=({tr:e,sourceNode:t,targetNodeType:o,targetAttrs:r})=>{let a=e.selection,i=e.doc.type.schema,s=a.content().content,l=[];if(t.type===i.nodes.codeBlock){let e=eU(t,i);s=n("5SAOw").Fragment.fromArray(e),l=ej(t,o)}o===i.nodes.blockquote&&(s=e0(s,i.nodes.heading,i.nodes.paragraph,!0)),(t.type===i.nodes.paragraph||t.type===i.nodes.heading)&&(s=eF(s,o));let c=o.createAndFill(r,s,l);return c?(e.replaceRangeWith(a.from,a.to,c),e):null},e5=({tr:e,sourceNode:t,sourcePos:n,targetNodeType:o,targetAttrs:r})=>null===n?null:eC(o)?"codeBlock"===o.name?e3({tr:e,sourceNode:t,sourcePos:n,targetNodeType:o,targetAttrs:r}):e2({tr:e,sourceNode:t,sourcePos:n,targetNodeType:o,targetAttrs:r}):eO(o)?e9({tr:e,sourceNode:t,sourcePos:n,targetNodeType:o,targetAttrs:r}):eP(o)?e3({tr:e,sourceNode:t,sourcePos:n,targetNodeType:o,targetAttrs:r}):null,e2=e=>{let{tr:t,targetNodeType:o,targetAttrs:r,sourceNode:a,sourcePos:i}=e,{selection:s}=t,l=s.$from.doc.type.schema,{paragraph:c,heading:d,codeBlock:u,expand:p}=l.nodes,f=null!==i?i:s.from,m=[...a.children],g=[];if(a.type===p){let e=a.attrs?.title;if(e){let t=l.text(e);m.unshift(c.createChecked({},t))}}if(a.type===u&&(m=eU(a,l)),o===c&&(g=m),o===d&&r){let e=r.level;m.forEach((t,n)=>{if(t.isTextblock){let o=d.create({level:e},t.content);m[n]=o}}),g=m}if(o===u){let e=m.map(e=>e.content.textBetween(0,e.content.size,"\n")).join("\n"),t=ej(a,o);g=[u.createChecked({},l.text(e),t)]}let h=new(0,n("5SAOw").Slice)(n("5SAOw").Fragment.fromArray(g),0,0);return t.replaceRange(f,f+a.nodeSize,h),t},e9=({tr:e,sourceNode:t,sourcePos:o,targetNodeType:r,targetAttrs:a})=>{let{schema:i}=e.doc.type,{listItem:s,paragraph:l,taskList:c,taskItem:d,heading:u}=i.nodes,p=r===c,f=e=>e?p?d.create(null,e):s.create(null,l.create(null,e)):p?d.create():s.create(null,l.create()),m=e=>{let t=[];return e.forEach(e=>{t.push(e)}),t},g=[],h=[],E=p?d:s;if("expand"===t.type.name){let e=t.attrs?.title;if(e){let t=i.text(e);h.push(f(t))}}let y=()=>{if(h.length){let e=r.create(a||null,n("5SAOw").Fragment.from(h));h=[],g.push(e)}};if("codeBlock"===t.type.name){let e=t.textContent;e&&""!==e.replace(/\n/g,"").trim()||h.push(f()),e&&e.split("\n").filter(e=>e.trim().length>0).forEach(e=>{let t=i.text(e);h.push(f(t))})}else t.forEach(e=>{if(E.validContent(n("5SAOw").Fragment.from(e)))h.push(E.create(null,e));else if(u===e.type||p&&l===e.type){let t=n("5SAOw").Fragment.from(m(e));h.push(f(t))}else y(),g.push(e)});return g.length||h.length?(y(),e.replaceWith(o,o+t.nodeSize,n("5SAOw").Fragment.from(g))):null},e3=e=>{let{tr:t,sourceNode:n,sourcePos:o,targetNodeType:r,targetAttrs:a}=e;if("codeBlock"===r.name){let e=e4(n,r,a,t.doc.type.schema);if(0===e.length){let{schema:e}=t.doc.type,i=ej(n,r),s=e.nodes.codeBlock.create(a,null,i);return t.replaceWith(o,o+n.nodeSize,s)}return e6(t,o,n.nodeSize,e)}let i=e8(n,eB(r),r,a,t.doc.type.schema);return e6(t,o,n.nodeSize,i)},e6=(e,t,n,o)=>{let r=t;return o.forEach((o,a)=>{0===a?(e.replaceWith(t,t+n,o),r=t+o.nodeSize):(e.insert(r,o),r+=o.nodeSize)}),e},e4=(e,t,o,r)=>{let a=[],i=e.content.content,s=[],l=[];"expand"===e.type.name&&e.attrs?.title&&s.push(e.attrs.title);let c=()=>{if(s.length>0){let n=s.join("\n"),i=ej(e,t),l=t.create(o,r.text(n),i);a.push(l),s=[]}},d=e=>e.isTextblock||"codeBlock"===e.type.name;return i.forEach(e=>{if(d(e)){if("codeBlock"===e.type.name)s.push(e.textContent);else if(e.isTextblock){let t=eK(n("5SAOw").Fragment.from(e)).inlineTextContent;t.trim()&&s.push(t)}}else if(eL(e))c(),a.push(e);else if(eO(e.type)){let t="taskList"===e.type.name,o=t?e.type.schema.nodes.taskItem:e.type.schema.nodes.listItem;(0,C.findChildrenByType)(e,o).forEach(e=>{let o=eK(t?n("5SAOw").Fragment.from(e.node):e.node.content);o.inlineTextContent.trim()&&s.push(o.inlineTextContent),o.invalidContent.length>0&&l.push(...o.invalidContent)})}else{let t=e.textContent;t&&t.trim()&&s.push(t)}}),c(),[...a,...l]},e8=(e,t,o,r,a)=>{let i=[],s=e.content.content,l=[];if("expand"===e.type.name&&e.attrs?.title){let t=a.nodes.paragraph.create({},a.text(e.attrs.title));l.push(t)}let c=()=>{if(l.length>0){let t=ej(e,o),a=o.create(r,n("5SAOw").Fragment.fromArray(l),t);i.push(a),l=[]}};return s.forEach(e=>{if(t(e))l.push(e);else if(e.type.name===o.name)e.content.forEach(e=>{l.push(e)});else if(e.isBlock)c(),i.push(e);else{let t=eD(e,a);if(t.length>0){let e=a.nodes.paragraph.create({},n("5SAOw").Fragment.fromArray(t));l.push(e)}}}),c(),i},e7=e=>{let{tr:t,targetNodeType:o,targetAttrs:r,sourceNode:a,sourcePos:i}=e,{selection:s}=t,l=s.$from.doc.type.schema,c=[],d=(0,C.findChildrenByType)(a,l.nodes.listItem),u=[],p=()=>{if(o===l.nodes.codeBlock&&u.length>0){let e=u.join("\n");c.push(l.nodes.codeBlock.createChecked({},""!==e?l.text(e):null)),u=[]}};d.forEach(e=>{e.node.content.content.forEach(e=>{let t=eB(o)(e);if(!ew(e)){if(o===l.nodes.codeBlock&&e.type===l.nodes.codeBlock){let t=e.textContent;u=[...u,t];return}if(!t&&!e.isTextblock){p(),c.push(e);return}if(o===l.nodes.codeBlock){let t=eK(n("5SAOw").Fragment.from(e)).inlineTextContent;u=[...u,t];return}if(e.type===l.nodes.codeBlock){let t=e.textContent.split("\n"),n=o===l.nodes.heading?{level:r?.level??1}:null;t.forEach(e=>{c.push(o.createChecked(n,e?l.text(e):null))});return}if(o===l.nodes.heading&&r){let t=r.level;c.push(l.nodes.heading.createChecked({level:t},e.content));return}c.push(e)}})}),p();let f=n("5SAOw").Fragment.fromArray(c),m=new(0,n("5SAOw").Slice)(f,0,0),g=null!==i?i:s.from;return t.replaceRange(g,g+a.nodeSize,m),t},te=e=>{let{tr:t,targetNodeType:o,targetAttrs:r,sourceNode:a,sourcePos:i}=e,{selection:s}=t,l=s.$from.doc.type.schema,c=(0,C.findChildrenByType)(a,l.nodes.taskItem).map(e=>e.node).map(e=>e.content),d=[];if(o===l.nodes.heading&&r){let e=r.level;d=c.map(t=>l.nodes.heading.createChecked({level:e},t.content))}if(o===l.nodes.paragraph&&(d=c.map(e=>l.nodes.paragraph.createChecked({},e.content))),o===l.nodes.codeBlock){let e=c.map(e=>e.textBetween(0,e.size,"\n")).join("\n");d=[l.nodes.codeBlock.createChecked({},l.text(e))]}let u=new(0,n("5SAOw").Slice)(n("5SAOw").Fragment.fromArray(d),0,0),p=null!==i?i:s.from;return t.replaceRange(p,p+a.nodeSize,u),t},tt=(e,t,n,o,r)=>{try{let{taskItem:a}=r,i=[];if(e.doc.nodesBetween(t.start,t.end,e=>{if(e.isBlock){let t=[...e.content.content];if(t.length>0){let e=a.create(o,t);i.push(e)}}return!1}),0===i.length)return null;let s=n.create(o,i);return e.replaceWith(t.start,t.end,s),e}catch{return null}},tn=e=>{let{tr:t,sourceNode:o,targetNodeType:r,targetAttrs:a}=e,{$from:i,$to:s}=t.selection,l=t.doc.type.schema,c=i.blockRange(s);if(!c)return null;let{nodes:d}=t.doc.type.schema;if((0,n("iD5M5").isTaskList)(r))return tt(t,c,r,a,d);if(o.type===l.nodes.paragraph||o.type===l.nodes.heading){let e=r.allowedMarks(o.marks);t.setNodeMarkup(c.start,null,null,e)}o&&o.type.name.startsWith("heading")&&t.setBlockType(c.start,c.end,d.paragraph);let u=t.selection.$from.blockRange(t.selection.$to)||c,p=(0,n("aXG5V").findWrapping)(u,r,a);return p?(t.wrap(u,p),t):null},to=e=>{let{sourceNode:t}=e;return"taskList"===t.type.name?te(e):e7(e)},tr=e=>{let{tr:t,sourceNode:o,sourcePos:r,targetNodeType:a,targetAttrs:i}=e;if(null===r)return null;let{schema:s}=t.doc.type,{blockquote:l,taskList:c,taskItem:d,paragraph:u}=s.nodes;if(o.type===c&&a===l){let e=t=>{let n=[];return t.forEach(t=>{if(t.type===d){if(t.content.size>0){let e=u.createChecked({},t.content.content);n.push(e)}}else t.type===c&&n.push(...e(t))}),n},s=e(o),l=a.createAndFill(i,n("5SAOw").Fragment.from(s));return l?(t.replaceWith(r,r+o.nodeSize,l),t):null}let p=a.createAndFill(i,[o]);return p?(t.replaceWith(r,r+o.nodeSize,p),t):null},ta=e=>{let{targetNodeType:t}=e;return eC(t)?to(e):eP(t)?tr(e):eO(t)?(0,n("4FFjp").transformBetweenListTypes)(e):null},ti=e=>{let{targetNodeType:t}=e;return eO(t)?tn(e):eP(t)?e1(e):eC(t)?ts(e):null},ts=e=>{let{tr:t,targetNodeType:n,targetAttrs:o,sourceNode:r}=e,{selection:a,doc:i}=t,{$from:s,$to:l}=a,c=i.type.schema;if(n===c.nodes.codeBlock){let e=eV(a.content().content,c),n=c.nodes.codeBlock.createChecked(void 0,e);return t.replaceRangeWith(a.from,a.to,n)}return r.type===c.nodes.codeBlock?e2(e):(t.setBlockType(s.pos,l.pos,n,o),t)},tl=(e,t,n,o)=>{let r,{nodes:a}=o,{paragraph:i}=a,s=o.text(" ");if(t.startsWith("heading")){let e=parseInt(t.slice(-1),10);if(isNaN(e)||e<1||e>6)return null;r=a.heading.createAndFill({level:e},s)}else if("paragraph"===t)r=a.paragraph.createAndFill({},s);else if("layoutSection"===t){let e=i.createAndFill({},s);e&&(r=eX(o,e))}else r=a[t].createAndFill();return r?e=(0,C.safeInsert)(r,n)(e)??e:e},tc=(e,t,o,r)=>{let{nodes:a}=r,i=1,s=t;if(t.startsWith("heading")){let e=parseInt(t.slice(-1),10);!isNaN(e)&&e>=1&&e<=6&&(i=e,s="heading")}let l=null;if("layoutSection"===s){let e=a.paragraph.createAndFill();e&&(l=eX(r,e))}else l="heading"===s?a.heading.createAndFill({level:i}):a[s].createAndFill();return l&&(e.replaceWith(o.pos,o.pos+o.node.nodeSize,l),e.setSelection(new(0,n("ks2lK").TextSelection)(e.doc.resolve(o.pos)))),e},td=e=>(t,o)=>({tr:r})=>{let a,{selection:i}=r,s=r.doc.type.schema,{nodes:l}=s,c=i.from;if(i.empty){let a=[];if(r.doc.nodesBetween(i.from,i.to,(e,t)=>{eO(e.type)&&a.push({node:e,pos:t})}),a.length>0){let i=a[0],l=tc(r,t,i,s);if(l){let r=i.node.type.name;e?.analytics?.actions?.attachAnalyticsEvent({action:n("d925B").ACTION.CONVERTED,actionSubject:n("d925B").ACTION_SUBJECT.ELEMENT,eventType:n("d925B").EVENT_TYPE.TRACK,attributes:{from:r,to:t,eventCategory:eG(r,t),triggeredFrom:o?.triggeredFrom||n("d925B").INPUT_METHOD.MOUSE,inputMethod:o?.inputMethod||n("d925B").INPUT_METHOD.BLOCK_MENU,conversionSource:"emptyList"}})(l)}return l}{let a,d=tl(r,t,c,s),u=[l.blockquote,l.panel,l.codeBlock,l.layoutSection,l.expand],p="paragraph",f=(0,C.findParentNodeOfType)(u)(i),m=(0,C.findParentNodeOfType)([l.heading,l.paragraph])(i);return f?(p=f.node.type.name,a=void 0):m&&("heading"===(p=m.node.type.name)&&(p=`heading${m.node.attrs.level}`),a="emptyLine"),d&&e?.analytics?.actions?.attachAnalyticsEvent({action:n("d925B").ACTION.CONVERTED,actionSubject:n("d925B").ACTION_SUBJECT.ELEMENT,eventType:n("d925B").EVENT_TYPE.TRACK,attributes:{from:p,to:t,eventCategory:eG(p,t),triggeredFrom:o?.triggeredFrom||n("d925B").INPUT_METHOD.MOUSE,inputMethod:o?.inputMethod||n("d925B").INPUT_METHOD.BLOCK_MENU,conversionSource:a}})(d),d}}let d=(0,C.findSelectedNodeOfType)([l.paragraph,l.heading,l.blockquote,l.panel,l.expand,l.codeBlock,l.bulletList,l.orderedList,l.taskList,l.layoutSection])(i);if(d)a=d.node,c=d.pos;else{let e=(0,C.findParentNodeOfType)([l.blockquote,l.panel,l.expand,l.codeBlock,l.listItem,l.taskItem,l.layoutSection])(i);if(e){a=e.node,c=e.pos;let t=(0,C.findParentNodeOfType)([l.paragraph,l.heading])(i);if(e.node.type===l.listItem||e.node.type===l.taskItem){let e=(0,C.findParentNodeOfType)([l.bulletList,l.orderedList,l.taskList])(i);e&&(a=e.node,c=e.pos)}else e.node.type!==l.blockquote&&t&&(a=t.node,c=t.pos)}}a||(a=i.$from.node(),c=i.$from.pos);try{let i=function(e,t,n,o){let{nodes:r}=e.doc.type.schema,a=ev(o,r);if(!a)return null;let{nodeType:i,attrs:s}=a;if(t.type.name===i.name){if("heading"!==i.name)return e;else if(t.attrs?.level===s?.level)return e}let l={tr:e,sourceNode:t,sourcePos:n,targetNodeType:i,targetAttrs:s};return ex(i)?eZ(l):"codeBlock"===t.type.name&&eO(i)?e9(l):eR(t)?eQ(l):eM(t)?ti(l):ew(t)?ta(l):eA(t)?e5(l):null}(r,a,c,t),s=a.type.name;return"heading"===s&&a.attrs?.level&&(s=`heading${a.attrs.level}`),i&&s!==t&&e?.analytics?.actions?.attachAnalyticsEvent({action:n("d925B").ACTION.CONVERTED,actionSubject:n("d925B").ACTION_SUBJECT.ELEMENT,eventType:n("d925B").EVENT_TYPE.TRACK,attributes:{from:s,to:t,eventCategory:eG(s,t),triggeredFrom:o?.triggeredFrom||n("d925B").INPUT_METHOD.MOUSE,inputMethod:o?.inputMethod||n("d925B").INPUT_METHOD.BLOCK_MENU}})(i),i?eb(i,c,t):i}catch(s){(0,n("hWRJP").logException)(s,{location:"editor-plugin-block-menu"});let i=a.type.name;return"heading"===i&&a.attrs?.level&&(i=`heading${a.attrs.level}`),e?.analytics?.actions?.fireAnalyticsEvent({action:n("d925B").ACTION.ERRORED,actionSubject:n("d925B").ACTION_SUBJECT.ELEMENT,actionSubjectId:n("d925B").ACTION_SUBJECT_ID.TRANSFORM,eventType:n("d925B").EVENT_TYPE.OPERATIONAL,attributes:{error:s.message,errorStack:s.stack,docSize:r.doc.nodeSize,from:i,to:t,position:r.selection.from,selection:r.selection.toJSON(),inputMethod:o?.inputMethod||n("d925B").INPUT_METHOD.BLOCK_MENU,triggeredFrom:o?.triggeredFrom||n("d925B").INPUT_METHOD.MOUSE}}),null}},tu=(e,t)=>{if(!e)return!1;let{$from:o}=e,r=o.depth;if(1===o.depth&&e instanceof n("ks2lK").NodeSelection&&"media"===e.node.type.name&&"file"===e.node.attrs.type)return!1;if(o.depth>0&&e instanceof n("ks2lK").NodeSelection)return!0;if(r<=1)return!1;if(r>4)return!0;if(e instanceof n("7XFGZ").CellSelection)return r>3;let a=o.node(r-1);if(!a)return!0;let i=a.type.name,s=t.includes("blockquote");return("listItem"!==i||3!==r)&&("blockquote"!==i||2!==r||!s)&&("taskList"!==i||2!==r)&&("listItem"!==i||4!==r||!s)},tp=e=>(t,o)=>({tr:r})=>{let a=e?.blockControls?.sharedState.currentState()?.preservedSelection;if(!a)return r;let{nodes:i}=r.doc.type.schema,{$from:s,$to:l}=(0,n("l6okE").expandSelectionToBlockRange)(a),c=s.parent,d=c.type===i.layoutColumn,u=tu(a,"")&&!d,p=n("5SAOw").Fragment.empty,f=ew(c);r.doc.slice(f?s.pos-1:s.pos,f?l.pos+1:l.pos).content.forEach(e=>{let a=eE({sourceNode:e,targetNodeType:t,schema:r.doc.type.schema,isNested:u,targetAttrs:o?.targetAttrs});a&&(p=p.append(n("5SAOw").Fragment.fromArray(a)))});let m=[i.mediaSingle];return a instanceof n("ks2lK").NodeSelection&&m.includes(a.node.type)?(r.deleteRange(s.pos,l.pos),r.insert(s.pos,p)):r.replaceWith(f?s.pos-1:s.pos,l.pos,p),r},tf=new(0,n("ks2lK").PluginKey)("blockMenuPlugin"),tm=()=>new(0,n("1S4f7").SafePlugin)({key:tf,state:{init:()=>({showFlag:!1}),apply:(e,t)=>{let n=e.getMeta(tf);return{showFlag:n?.showFlag??t.showFlag}}}}),tg=(0,l.createContext)({onDropdownOpenChanged:()=>{},moveDownRef:e(l).createRef(),moveUpRef:e(l).createRef()}),th=()=>{let e=(0,l.useContext)(tg);if(!e)throw Error("useBlockMenu must be used within BlockMenuProvider");return e},tE=({children:e,api:t})=>{let n=(0,l.useRef)(null),o=(0,l.useRef)(null),r=(0,l.useCallback)(e=>{e||setTimeout(()=>requestAnimationFrame(()=>{t?.core.actions.focus({scrollIntoView:!1})}),1)},[t]);return(0,s.jsx)(tg.Provider,{value:{onDropdownOpenChanged:r,moveDownRef:o,moveUpRef:n},children:e})};n("42omo"),n("42omo");let ty=e=>"parent"in e&&!!e.parent,t_=e=>"block-menu-section"===e.type&&!ty(e),tS=e=>e.filter(t_).sort((e,t)=>(e.rank||0)-(t.rank||0)),tk=(e,t)=>`${t}:${e}`,tT=e=>{let t=new Map;for(let n of e)if("parent"in n&&n.parent){let e=tk(n.parent.key,n.parent.type),o=t.get(e)||[];o.push(n),t.set(e,o)}for(let[,e]of t.entries())e.sort((e,t)=>(ty(e)&&e.parent.rank||0)-(ty(t)&&t.parent.rank||0));return t},tb=(e,t)=>{if("block-menu-item"===e.type)return!e.component||null!==e.component();let n=tk(e.key,e.type),o=t.get(n)||[];return"block-menu-nested"===e.type?o.length>0:o.some(e=>tb(e,t))},tN=({registeredComponent:e,childrenMap:t,fallbacks:n})=>{if("block-menu-item"===e.type){let t=e.component||n["block-menu-item"];return(0,s.jsx)(t,{},e.key)}if(!tb(e,t))return null;let o=e.component||n[e.type],r=tk(e.key,e.type),a=t.get(r);return(0,s.jsx)(o,{children:(0,s.jsx)(tv,{registeredComponents:a,childrenMap:t,fallbacks:n})},e.key)},tv=({registeredComponents:e,childrenMap:t,fallbacks:n})=>e?.length?(0,s.jsx)(s.Fragment,{children:e.map(e=>(0,s.jsx)(tN,{registeredComponent:e,childrenMap:t,fallbacks:n},e.key))}):null;n("42omo");let tM={"block-menu-nested":({children:t})=>(0,s.jsx)(n("87Gms").ToolbarNestedDropdownMenu,{elemBefore:void 0,elemAfter:(0,s.jsx)(e(n("6R5uz")),{label:""}),text:"Nested Menu",enableMaxHeight:!0,shouldFitContainer:!0,children:t}),"block-menu-section":({children:e})=>(0,s.jsx)(n("6UWPx").ToolbarDropdownItemSection,{children:e}),"block-menu-item":()=>(0,s.jsx)(n("2GVu1").ToolbarDropdownItem,{children:"Block Menu Item"})},tI=({allRegisteredComponents:e,fallbacks:t=tM})=>{let{childrenMap:n,topLevelSections:o}=(0,l.useMemo)(()=>({childrenMap:tT(e),topLevelSections:tS(e)}),[e]);return(0,s.jsx)(tv,{registeredComponents:o,childrenMap:n,fallbacks:t})},tw={base:"_2rko12b0 _bfhk1bhr _16qs130s",emptyMenuSectionStyles:"_1cc0glyw _1k2yglyw"},tA=(0,n("efG2U").default)(n("jwWgu").default),tC=(0,n("dTb09").conditionalHooksFactory)(()=>(0,n("dh538").fg)("platform_editor_toolbar_aifc_user_intent_fix"),({api:e,isMenuOpen:t,menuTriggerBy:o,selectedByShortcutOrDragHandle:r,hasFocus:a,openedViaKeyboard:i,prevIsMenuOpenRef:s})=>{(0,l.useEffect)(()=>{t&&o&&r&&a&&(!s.current&&t&&e?.analytics?.actions.fireAnalyticsEvent({action:n("d925B").ACTION.OPENED,actionSubject:n("d925B").ACTION_SUBJECT.BLOCK_MENU,eventType:n("d925B").EVENT_TYPE.UI,attributes:{inputMethod:i?n("d925B").INPUT_METHOD.KEYBOARD:n("d925B").INPUT_METHOD.MOUSE}}),s.current=t,e?.core.actions.execute(e?.userIntent?.commands.setCurrentUserIntent("blockMenuOpen")))},[e,t,o,r,a,i,s])},({api:e,isMenuOpen:t,menuTriggerBy:o,selectedByShortcutOrDragHandle:r,hasFocus:a,currentUserIntent:i,openedViaKeyboard:s,prevIsMenuOpenRef:c})=>{(0,l.useEffect)(()=>{!(!t||!o||!r||!a||["resizing","dragging"].includes(i||""))&&(!c.current&&t&&e?.analytics?.actions.fireAnalyticsEvent({action:n("d925B").ACTION.OPENED,actionSubject:n("d925B").ACTION_SUBJECT.BLOCK_MENU,eventType:n("d925B").EVENT_TYPE.UI,attributes:{inputMethod:s?n("d925B").INPUT_METHOD.KEYBOARD:n("d925B").INPUT_METHOD.MOUSE}}),c.current=t,e?.core.actions.execute(e?.userIntent?.commands.setCurrentUserIntent("blockMenuOpen")))},[e,t,o,r,a,i,s,c])}),tO=({api:e,setRef:t})=>{let o=e?.blockMenu?.actions.getBlockMenuComponents(),r=(0,l.useContext)(n("efG2U").OutsideClickTargetRefContext);return(0,s.jsx)(n("gdv5Z").default,{testId:"editor-block-menu",ref:e=>{r(e),t?.(e)},xcss:(0,n("1Whri").cx)(tw.base,(0,eN.editorExperiment)("platform_synced_block",!0)&&tw.emptyMenuSectionStyles),children:(0,s.jsx)(n("9Z3I5").ArrowKeyNavigationProvider,{type:n("5v8Ta").ArrowKeyNavigationType.MENU,handleClose:e=>e.preventDefault(),children:(0,s.jsx)(tI,{allRegisteredComponents:o||[]})})})};var tP=(0,n("gmMgo").default)(({editorView:t,api:o,mountTo:r,boundariesElement:a,scrollableElement:i})=>{let{menuTriggerBy:c,isSelectedViaDragHandle:d,isMenuOpen:u,currentUserIntent:p,openedViaKeyboard:f}=(0,n("eiA8Z").useSharedPluginStateWithSelector)(o,["blockControls","userIntent"],e=>({menuTriggerBy:e.blockControlsState?.menuTriggerBy,isSelectedViaDragHandle:e.blockControlsState?.isSelectedViaDragHandle,isMenuOpen:e.blockControlsState?.isMenuOpen,currentUserIntent:e.userIntentState?.currentUserIntent,openedViaKeyboard:e.blockControlsState?.blockMenuOptions?.openedViaKeyboard})),{onDropdownOpenChanged:m}=th(),g=t?.dom?.querySelector(n("Yqd3z").DRAG_HANDLE_SELECTOR),h=(0,l.useRef)(!1),E=(0,l.useRef)(void 0),[y,_]=e(l).useState(0),S=-(g?.clientHeight||0);e(l).useLayoutEffect(()=>{u&&_(E.current?.clientHeight||300)},[u]);let k=(t?.hasFocus()||document.activeElement===g||E.current&&(E.current.contains(document.activeElement)||E.current===document.activeElement))??!1,T=!!d||!!f;if(tC({api:o,isMenuOpen:u,menuTriggerBy:c,selectedByShortcutOrDragHandle:T,hasFocus:k,currentUserIntent:(0,n("dh538").fg)("platform_editor_toolbar_aifc_user_intent_fix")?void 0:p,openedViaKeyboard:f,prevIsMenuOpenRef:h}),!u)return null;let b=()=>{o?.core.actions.execute(({tr:e})=>(o?.blockControls?.commands.toggleBlockMenu({closeMenu:!0})({tr:e}),m(!1),o?.userIntent?.commands.setCurrentUserIntent("blockMenuOpen"===p?"default":p||"default")({tr:e}),e))};return!c||!T||!k||["resizing","dragging"].includes(p||"")?(b(),null):g instanceof HTMLElement?(0,s.jsx)(n("7fmpI").ErrorBoundary,{component:n("d925B").ACTION_SUBJECT.BLOCK_MENU,dispatchAnalyticsEvent:o?.analytics?.actions.fireAnalyticsEvent,fallbackComponent:null,children:(0,s.jsx)(tA,{alignX:"right",alignY:"start",handleClickOutside:e=>{e.target instanceof HTMLElement&&e.target.closest(n("Yqd3z").DRAG_HANDLE_SELECTOR)||b()},handleEscapeKeydown:b,handleBackspaceDeleteKeydown:e=>{e?.preventDefault(),e?.stopPropagation(),o?.core.actions.execute(({tr:e})=>((0,n("l6okE").deleteSelectedRange)(e,o?.blockControls?.sharedState.currentState()?.preservedSelection),o?.blockControls?.commands.toggleBlockMenu({closeMenu:!0})({tr:e}),t&&!t.hasFocus()&&t.focus(),e))},mountTo:r,boundariesElement:a,scrollableElement:i,target:g,zIndex:n("aFUXX").akEditorFloatingOverlapPanelZIndex,fitWidth:230,fitHeight:y,preventOverflow:!0,stick:!0,offset:[n("Yqd3z").DRAG_HANDLE_WIDTH+5,S],focusTrap:f?{initialFocus:void 0}:void 0,children:(0,s.jsx)(tO,{api:o,setRef:e=>{e&&(E.current=e)}})})}):null});n("42omo");var tx=((a={}).LINK_COPIED_TO_CLIPBOARD="link-copied-to-clipboard",a);let tR={COPY_LINK_TO_BLOCK:"copyLinkToBlock",MOVE_UP:"moveUp",MOVE_DOWN:"moveDown",DELETE:"delete",FORMAT_MENU:"formatMenu"},tL=async({getLinkPath:e,blockLinkHashPrefix:t=n("cQJcI").DEFAULT_BLOCK_LINK_HASH_PREFIX,selection:o})=>{let r=(0,n("l6okE").expandSelectionToBlockRange)(o);if(!r)return!1;let a=r.$from.nodeAfter;if(!a||!a.attrs||!a.attrs.localId)return!1;let i=e?.()||location.pathname;try{let e=new URL(location.origin+i);e.hash=(0,n("cQJcI").createBlockLinkHashValue)(a.attrs.localId,t);let o=e.toString();await (0,n("cMZNY").copyToClipboard)(o)}catch(e){return(0,n("hWRJP").logException)(e,{location:"editor-plugin-block-menu"}),!1}return!0},tB=(0,n("gmMgo").default)(({api:t,config:o})=>{let{formatMessage:r}=(0,n("8C5kA").default)(),{onDropdownOpenChanged:a}=th(),{getLinkPath:i,blockLinkHashPrefix:c}=o||{},{preservedSelection:d,defaultSelection:u}=(0,n("eiA8Z").useSharedPluginStateWithSelector)(t,["blockControls","selection"],({blockControlsState:e,selectionState:t})=>({preservedSelection:e?.preservedSelection,defaultSelection:t?.selection})),p=d||u,f=(0,l.useCallback)(()=>{p&&(t?.core.actions.execute(({tr:e})=>{let o={action:n("d925B").ACTION.CLICKED,actionSubject:n("d925B").ACTION_SUBJECT.BLOCK_MENU_ITEM,attributes:{menuItemName:tR.COPY_LINK_TO_BLOCK},eventType:n("d925B").EVENT_TYPE.UI};return t?.analytics?.actions?.attachAnalyticsEvent(o)(e),t?.blockControls?.commands?.toggleBlockMenu({closeMenu:!0})({tr:e}),e}),a(!1),tL({getLinkPath:i,blockLinkHashPrefix:c,selection:p}).then(e=>{e&&t?.core.actions.execute(({tr:e})=>(e.setMeta(tf,{showFlag:tx.LINK_COPIED_TO_CLIPBOARD}),e))}))},[t,c,i,a,p]);return(0,n("dh538").fg)("platform_editor_adf_with_localid")?(0,s.jsx)(n("2GVu1").ToolbarDropdownItem,{onClick:f,elemBefore:(0,s.jsx)(e(n("1bY7o")),{label:""}),children:r(n("eKkkY").messages.copyLinkToBlock)}):null}),tD=(e,t)=>{let n=t.nodes;if(!n)return!1;{let t=[n.syncBlock,n.bodiedSyncBlock,n.rule];return!!(0,C.findSelectedNodeOfType)(t)(e)}},tF=e=>{let t=e?.selection?.sharedState?.currentState()?.selection,n=e?.core.sharedState.currentState()?.schema,o=e?.blockControls?.sharedState.currentState()?.menuTriggerBy;return!!t&&!!n&&!!o&&tD(t,n)},tU=({api:e,children:t})=>{let o=(0,l.useCallback)(()=>tF(e),[e]);return(0,s.jsx)(n("6UWPx").ToolbarDropdownItemSection,{hasSeparator:!!(0,eN.editorExperiment)("platform_synced_block",!0)||!o(),children:t})},tq=(0,n("gmMgo").default)(({api:t})=>{let{formatMessage:o}=(0,n("8C5kA").default)(),r=Object.values(t?.core.sharedState.currentState()?.schema?.nodes||{}),a=(0,l.useCallback)(()=>{t?.core.actions.execute(({tr:e})=>(t?.decorations?.commands?.hoverDecoration?.({nodeType:r,add:!0})({tr:e}),e))},[t,r]),i=(0,l.useCallback)(()=>{t?.core.actions.execute(({tr:e})=>(t?.decorations?.commands?.removeDecoration?.()({tr:e}),e))},[t]);return(0,l.useEffect)(()=>()=>{i()},[i]),(0,s.jsx)(n("6f0Oj").Box,{onMouseEnter:a,onMouseLeave:i,onFocus:a,onBlur:i,children:(0,s.jsx)(n("2GVu1").ToolbarDropdownItem,{elemBefore:(0,s.jsx)(e(n("gKvd9")),{color:"var(--ds-icon-danger, #C9372C)",label:""}),onClick:()=>{t?.core.actions.execute(({tr:e})=>{let o={action:n("d925B").ACTION.CLICKED,actionSubject:n("d925B").ACTION_SUBJECT.BLOCK_MENU_ITEM,attributes:{menuItemName:tR.DELETE},eventType:n("d925B").EVENT_TYPE.UI};return t?.analytics?.actions?.attachAnalyticsEvent(o)(e),(0,n("l6okE").deleteSelectedRange)(e,t?.blockControls?.sharedState.currentState()?.preservedSelection),t?.blockControls?.commands?.toggleBlockMenu({closeMenu:!0})({tr:e}),e}),t?.core.actions.focus()},children:(0,s.jsx)(n("5dK2X").default,{as:"span",color:"color.text.danger",children:o(n("eKkkY").messages.deleteBlock)})})})});n("42omo");let tj=({children:e})=>(0,s.jsx)(n("6UWPx").ToolbarDropdownItemSection,{hasSeparator:!0,children:e}),tG=({api:t,children:o})=>{let{formatMessage:r}=(0,n("8C5kA").default)(),a=(0,l.useCallback)(()=>{t?.core.actions.execute(({tr:e})=>{let o={action:n("d925B").ACTION.CLICKED,actionSubject:n("d925B").ACTION_SUBJECT.BLOCK_MENU_ITEM,attributes:{menuItemName:tR.FORMAT_MENU},eventType:n("d925B").EVENT_TYPE.UI};return t?.analytics?.actions?.attachAnalyticsEvent(o)(e),e})},[t]);return(0,s.jsx)(n("87Gms").ToolbarNestedDropdownMenu,{text:r(n("eKkkY").messages.turnInto),elemBefore:(0,s.jsx)(e(n("4BqOc")),{label:""}),elemAfter:(0,s.jsx)(e(n("6R5uz")),{label:""}),enableMaxHeight:!0,onClick:a,dropdownTestId:"editor-turn-into-menu",shouldFitContainer:!0,children:o})},tK=({children:e,api:t})=>(0,l.useCallback)(()=>tF(t),[t])()?null:(0,s.jsx)(n("6UWPx").ToolbarDropdownItemSection,{children:e}),tV=(0,n("gmMgo").default)(({api:t})=>{let{formatMessage:o}=(0,n("8C5kA").default)(),{moveUpRef:r,moveDownRef:a}=th(),{canMoveDown:i}=(0,n("eiA8Z").useSharedPluginStateWithSelector)(t,["blockControls"],({blockControlsState:e})=>({canMoveDown:e?.blockMenuOptions?.canMoveDown}));return(0,l.useEffect)(()=>{!i&&a.current&&a.current===document.activeElement&&r.current&&r.current.focus()},[i,r,a]),(0,s.jsx)(n("2GVu1").ToolbarDropdownItem,{triggerRef:a,onClick:()=>{t?.core.actions.execute(({tr:e})=>{let o={action:n("d925B").ACTION.CLICKED,actionSubject:n("d925B").ACTION_SUBJECT.BLOCK_MENU_ITEM,attributes:{menuItemName:tR.MOVE_DOWN},eventType:n("d925B").EVENT_TYPE.UI};return t?.analytics?.actions?.attachAnalyticsEvent(o)(e),t?.blockControls?.commands?.moveNodeWithBlockMenu(n("ah4M9").DIRECTION.DOWN)({tr:e}),e})},elemBefore:(0,s.jsx)(e(n("22Iw9")),{label:""}),isDisabled:!i,children:o(n("eKkkY").messages.moveDownBlock)})}),tH=(0,n("gmMgo").default)(({api:t})=>{let{formatMessage:o}=(0,n("8C5kA").default)(),{moveUpRef:r,moveDownRef:a}=th(),{canMoveUp:i}=(0,n("eiA8Z").useSharedPluginStateWithSelector)(t,["blockControls"],({blockControlsState:e})=>({canMoveUp:e?.blockMenuOptions?.canMoveUp}));return(0,l.useEffect)(()=>{!i&&r.current&&r.current===document.activeElement&&a.current&&a.current.focus()},[i,a,r]),(0,s.jsx)(n("2GVu1").ToolbarDropdownItem,{triggerRef:r,onClick:()=>{t?.core.actions.execute(({tr:e})=>{let o={action:n("d925B").ACTION.CLICKED,actionSubject:n("d925B").ACTION_SUBJECT.BLOCK_MENU_ITEM,attributes:{menuItemName:tR.MOVE_UP},eventType:n("d925B").EVENT_TYPE.UI};return t?.analytics?.actions?.attachAnalyticsEvent(o)(e),t?.blockControls?.commands?.moveNodeWithBlockMenu(n("ah4M9").DIRECTION.UP)({tr:e}),e})},elemBefore:(0,s.jsx)(e(n("euUgw")),{label:""}),isDisabled:!i,children:o(n("eKkkY").messages.moveUpBlock)})}),tz={paragraph:{[n("btNLq").TRANSFORM_STRUCTURE_PANEL_MENU_ITEM.key]:100,[n("btNLq").TRANSFORM_HEADINGS_H1_MENU_ITEM.key]:200,[n("btNLq").TRANSFORM_HEADINGS_H2_MENU_ITEM.key]:300},expand:{[n("btNLq").TRANSFORM_STRUCTURE_LAYOUT_MENU_ITEM.key]:100,[n("btNLq").TRANSFORM_STRUCTURE_PANEL_MENU_ITEM.key]:200,[n("btNLq").TRANSFORM_STRUCTURE_PARAGRAPH_MENU_ITEM.key]:300},blockquote:{[n("btNLq").TRANSFORM_STRUCTURE_EXPAND_MENU_ITEM.key]:100,[n("btNLq").TRANSFORM_STRUCTURE_LAYOUT_MENU_ITEM.key]:200,[n("btNLq").TRANSFORM_STRUCTURE_PANEL_MENU_ITEM.key]:300},layoutSection:{[n("btNLq").TRANSFORM_STRUCTURE_PANEL_MENU_ITEM.key]:100,[n("btNLq").TRANSFORM_STRUCTURE_EXPAND_MENU_ITEM.key]:200,[n("btNLq").TRANSFORM_STRUCTURE_PARAGRAPH_MENU_ITEM.key]:300},panel:{[n("btNLq").TRANSFORM_STRUCTURE_QUOTE_MENU_ITEM.key]:100,[n("btNLq").TRANSFORM_STRUCTURE_CODE_BLOCK_MENU_ITEM.key]:200,[n("btNLq").TRANSFORM_STRUCTURE_EXPAND_MENU_ITEM.key]:300},codeBlock:{[n("btNLq").TRANSFORM_STRUCTURE_EXPAND_MENU_ITEM.key]:100,[n("btNLq").TRANSFORM_STRUCTURE_PANEL_MENU_ITEM.key]:200,[n("btNLq").TRANSFORM_STRUCTURE_PARAGRAPH_MENU_ITEM.key]:300},decisionList:{[n("btNLq").TRANSFORM_STRUCTURE_PANEL_MENU_ITEM.key]:100,[n("btNLq").TRANSFORM_STRUCTURE_QUOTE_MENU_ITEM.key]:200,[n("btNLq").TRANSFORM_STRUCTURE_LAYOUT_MENU_ITEM.key]:300},bulletList:{[n("btNLq").TRANSFORM_STRUCTURE_NUMBERED_LIST_MENU_ITEM.key]:100,[n("btNLq").TRANSFORM_STRUCTURE_QUOTE_MENU_ITEM.key]:200,[n("btNLq").TRANSFORM_STRUCTURE_PANEL_MENU_ITEM.key]:300},orderedList:{[n("btNLq").TRANSFORM_STRUCTURE_TASK_LIST_MENU_ITEM.key]:100,[n("btNLq").TRANSFORM_STRUCTURE_BULLETED_LIST_MENU_ITEM.key]:200,[n("btNLq").TRANSFORM_STRUCTURE_PANEL_MENU_ITEM.key]:300},heading:{[n("btNLq").TRANSFORM_STRUCTURE_PARAGRAPH_MENU_ITEM.key]:100,[n("btNLq").TRANSFORM_STRUCTURE_BULLETED_LIST_MENU_ITEM.key]:200,[n("btNLq").TRANSFORM_STRUCTURE_QUOTE_MENU_ITEM.key]:300},taskList:{[n("btNLq").TRANSFORM_STRUCTURE_PANEL_MENU_ITEM.key]:100,[n("btNLq").TRANSFORM_STRUCTURE_NUMBERED_LIST_MENU_ITEM.key]:200,[n("btNLq").TRANSFORM_STRUCTURE_BULLETED_LIST_MENU_ITEM.key]:300},mediaSingle:{[n("btNLq").TRANSFORM_STRUCTURE_PANEL_MENU_ITEM.key]:100,[n("btNLq").TRANSFORM_STRUCTURE_EXPAND_MENU_ITEM.key]:200,[n("btNLq").TRANSFORM_STRUCTURE_QUOTE_MENU_ITEM.key]:300},extension:{[n("btNLq").TRANSFORM_STRUCTURE_EXPAND_MENU_ITEM.key]:100,[n("btNLq").TRANSFORM_STRUCTURE_PANEL_MENU_ITEM.key]:200,[n("btNLq").TRANSFORM_STRUCTURE_LAYOUT_MENU_ITEM.key]:300}},tW=e=>tz[e],tY=e=>{let t=tW(e);return t?Object.entries(t).sort(([,e],[,t])=>e-t).map(([e])=>e):[]},tJ=e=>{let{preservedSelection:t,selection:o}=(0,n("eiA8Z").useSharedPluginStateWithSelector)(e,["blockControls","selection"],e=>({preservedSelection:e.blockControlsState?.preservedSelection,selection:e.selectionState?.selection})),r=e?.blockMenu?.actions.getBlockMenuComponents(),a=(0,l.useMemo)(()=>r?new Map(r.filter(e=>"block-menu-item"===e.type).map(e=>[e.key,e])):new Map,[r]);return(0,l.useMemo)(()=>{let e=t||o;if(0===a.size||!e)return[];let{range:r}=(0,n("l6okE").expandSelectionToBlockRange)(e);if(!r)return[];let i=L(r);if(0===i.length)return[];let s=i[0].type.name;return i.every(e=>e.type.name===s)?tY(s).map(e=>a.get(e)).filter(e=>void 0!==e):[]},[a,t,o])},t$=e(l).memo(({api:e,children:t})=>0===tJ(e).length?null:(0,s.jsx)(n("6UWPx").ToolbarDropdownItemSection,{title:"Suggested",children:t})),tX=e(l).memo(({api:e})=>{let t=tJ(e);return(0,s.jsx)(s.Fragment,{children:t.map(e=>{let t=e.component;return t?(0,s.jsx)(t,{},e.key):null})})}),tZ=e=>[{type:"block-menu-item",key:n("btNLq").POSITION_MOVE_UP_MENU_ITEM.key,parent:{type:"block-menu-section",key:n("btNLq").POSITION_MENU_SECTION.key,rank:n("gEb6G").POSITION_MENU_SECTION_RANK[n("btNLq").POSITION_MOVE_UP_MENU_ITEM.key]},component:()=>(0,s.jsx)(tH,{api:e})},{type:"block-menu-item",key:n("btNLq").POSITION_MOVE_DOWN_MENU_ITEM.key,parent:{type:"block-menu-section",key:n("btNLq").POSITION_MENU_SECTION.key,rank:n("gEb6G").POSITION_MENU_SECTION_RANK[n("btNLq").POSITION_MOVE_DOWN_MENU_ITEM.key]},component:()=>(0,s.jsx)(tV,{api:e})}],tQ=e=>[{type:"block-menu-nested",key:n("btNLq").TRANSFORM_MENU_ITEM.key,parent:{type:"block-menu-section",key:n("btNLq").TRANSFORM_MENU_SECTION.key,rank:n("gEb6G").TRANSFORM_MENU_SECTION_RANK[n("btNLq").TRANSFORM_MENU_ITEM.key]},component:({children:t}={children:null})=>(0,s.jsx)(tG,{api:e,children:t})},{type:"block-menu-section",key:n("btNLq").TRANSFORM_SUGGESTED_MENU_SECTION.key,parent:{type:"block-menu-nested",key:n("btNLq").TRANSFORM_MENU_ITEM.key,rank:n("gEb6G").TRANSFORM_MENU_ITEM_RANK[n("btNLq").TRANSFORM_SUGGESTED_MENU_SECTION.key]},component:({children:t}={children:null})=>(0,s.jsx)(t$,{api:e,children:t})},{type:"block-menu-item",key:n("btNLq").TRANSFORM_SUGGESTED_MENU_ITEM.key,parent:{type:"block-menu-section",key:n("btNLq").TRANSFORM_SUGGESTED_MENU_SECTION.key,rank:n("gEb6G").TRANSFORM_SUGGESTED_MENU_SECTION_RANK[n("btNLq").TRANSFORM_SUGGESTED_MENU_ITEM.key]},component:()=>(0,s.jsx)(tX,{api:e})},{type:"block-menu-section",key:n("btNLq").TRANSFORM_CREATE_MENU_SECTION.key,parent:{type:"block-menu-nested",key:n("btNLq").TRANSFORM_MENU_ITEM.key,rank:n("gEb6G").TRANSFORM_MENU_ITEM_RANK[n("btNLq").TRANSFORM_CREATE_MENU_SECTION.key]},component:({children:e}={children:null})=>(0,s.jsx)(n("6UWPx").ToolbarDropdownItemSection,{title:"Create",children:e})},{type:"block-menu-section",key:n("btNLq").TRANSFORM_STRUCTURE_MENU_SECTION.key,parent:{type:"block-menu-nested",key:n("btNLq").TRANSFORM_MENU_ITEM.key,rank:n("gEb6G").TRANSFORM_MENU_ITEM_RANK[n("btNLq").TRANSFORM_STRUCTURE_MENU_SECTION.key]},component:({children:e}={children:null})=>(0,s.jsx)(n("6UWPx").ToolbarDropdownItemSection,{title:"Structure",children:e})},{type:"block-menu-section",key:n("btNLq").TRANSFORM_HEADINGS_MENU_SECTION.key,parent:{type:"block-menu-nested",key:n("btNLq").TRANSFORM_MENU_ITEM.key,rank:n("gEb6G").TRANSFORM_MENU_ITEM_RANK[n("btNLq").TRANSFORM_HEADINGS_MENU_SECTION.key]},component:({children:e}={children:null})=>(0,s.jsx)(n("6UWPx").ToolbarDropdownItemSection,{title:"Headings",hasSeparator:!0,children:e})},{type:"block-menu-section",key:n("btNLq").TRANSFORM_MENU_SECTION.key,rank:n("gEb6G").MAIN_BLOCK_MENU_SECTION_RANK[n("btNLq").TRANSFORM_MENU_SECTION.key],component:({children:t})=>(0,s.jsx)(tK,{api:e,children:t})}],t0=({api:e,config:t})=>[...tQ(e),{type:"block-menu-section",key:n("btNLq").BLOCK_ACTIONS_MENU_SECTION.key,rank:n("gEb6G").MAIN_BLOCK_MENU_SECTION_RANK[n("btNLq").BLOCK_ACTIONS_MENU_SECTION.key],component:({children:t})=>(0,s.jsx)(tU,{api:e,children:t})},{type:"block-menu-item",key:n("btNLq").BLOCK_ACTIONS_COPY_LINK_TO_BLOCK_MENU_ITEM.key,parent:{type:"block-menu-section",key:n("btNLq").BLOCK_ACTIONS_MENU_SECTION.key,rank:n("gEb6G").BLOCK_ACTIONS_MENU_SECTION_RANK[n("btNLq").BLOCK_ACTIONS_COPY_LINK_TO_BLOCK_MENU_ITEM.key]},component:()=>(0,s.jsx)(tB,{api:e,config:t})},{type:"block-menu-section",key:n("btNLq").POSITION_MENU_SECTION.key,rank:n("gEb6G").MAIN_BLOCK_MENU_SECTION_RANK[n("btNLq").POSITION_MENU_SECTION.key],component:({children:e})=>(0,s.jsx)(n("6UWPx").ToolbarDropdownItemSection,{hasSeparator:!0,children:e})},...tZ(e),{type:"block-menu-section",key:n("btNLq").DELETE_MENU_SECTION.key,rank:n("gEb6G").MAIN_BLOCK_MENU_SECTION_RANK[n("btNLq").DELETE_MENU_SECTION.key],component:({children:e})=>(0,s.jsx)(tj,{children:e})},{type:"block-menu-item",key:n("btNLq").DELETE_MENU_ITEM.key,parent:{type:"block-menu-section",key:n("btNLq").DELETE_MENU_SECTION.key,rank:n("gEb6G").DELETE_MENU_SECTION_RANK[n("btNLq").DELETE_MENU_ITEM.key]},component:()=>(0,s.jsx)(tq,{api:e})}];n("42omo");let t1={[tx.LINK_COPIED_TO_CLIPBOARD]:{title:n("eKkkY").messages.linkCopiedToClipboard,autoDismiss:!0}},t5=({api:t})=>{let{showFlag:o}=(0,n("eiA8Z").useSharedPluginStateWithSelector)(t,["blockMenu"],e=>({showFlag:e.blockMenuState?.showFlag})),{formatMessage:r}=(0,n("8C5kA").default)();if(!o)return;let{title:a}=t1[o],i=t1[o].autoDismiss?n("aD1SW").default:n("eCEXz").default;return(0,s.jsx)(n("6uGcC").default,{children:(0,s.jsx)(i,{onDismissed:()=>{t?.core.actions.execute(({tr:e})=>(e.setMeta(tf,{showFlag:!1}),e)),t?.core.actions.focus()},title:r(a),id:o,testId:o,icon:(0,s.jsx)(e(n("imt6g")),{label:"",color:"var(--ds-icon-success, #6A9A23)"})})})},t2=({api:e,config:t})=>{let n=A();return n.register(t0({api:e,config:t})),{name:"blockMenu",pmPlugins:()=>[{name:"blockMenuPlugin",plugin:tm}],actions:{registerBlockMenuComponents:e=>{n.register(e)},getBlockMenuComponents:()=>n.components,isTransformOptionDisabled:(t,n)=>{let o=e?.blockControls?.sharedState.currentState()?.preservedSelection,r=e?.selection?.sharedState?.currentState()?.selection,a=o||r;return!a||eT({selection:a,targetNodeTypeName:t,targetNodeTypeAttrs:n})}},commands:{formatNode:(t,n)=>td(e)(t,n),transformNode:(t,n)=>tp(e)(t,n)},getSharedState(t){if(!t)return{currentSelectedNodeName:void 0,showFlag:!1};let n=e?.blockControls?.sharedState.currentState()?.menuTriggerBy,o=tf.getState(t);return{currentSelectedNodeName:n,showFlag:o?.showFlag??!1}},contentComponent:({editorView:t,popupsMountPoint:n,popupsBoundariesElement:o,popupsScrollableElement:r})=>(0,s.jsxs)(tE,{api:e,children:[(0,s.jsx)(tP,{editorView:t,api:e,mountTo:n,boundariesElement:o,scrollableElement:r}),(0,s.jsx)(t5,{api:e})]})}};var t9=n("khxQ7"),t3=n("cwPVT"),t6=n("agrUc"),t4=n("7rj2U"),t8=n("4iQt6");class t7 extends n("cO9ey").Step{invert(e){return new t7({inverted:!0,from:this.from,to:this.to,mark:this.mark})}apply(e){return n("aXG5V").StepResult.ok(e)}merge(){return null}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,1);return t.deleted||n.deleted?null:new t7({inverted:this.inverted,from:t.pos,to:n.pos})}getMap(){return new(0,n("aXG5V").StepMap)([0,0,0])}toJSON(){return{stepType:"replace",from:0,to:0}}static fromJSON(){return new(0,n("aXG5V").ReplaceStep)(0,0,n("5SAOw").Slice.empty)}static from(e){let{mark:t,from:n,to:o}=e;return new t7({mark:t,from:n,to:o})}constructor({inverted:e,from:t,to:n,mark:o}){super(),this.inverted=void 0,this.from=void 0,this.to=void 0,this.mark=void 0,this.inverted=!!e,this.from=t,this.to=n,this.mark=o}}class ne extends n("cO9ey").Step{invert(e){return new ne({inverted:!0,pos:this.pos,mark:this.mark})}apply(e){return n("aXG5V").StepResult.ok(e)}merge(){return null}map(e){let t=e.mapResult(this.pos,1);return t.deleted?null:new ne({inverted:this.inverted,pos:t.pos})}getMap(){return new(0,n("aXG5V").StepMap)([0,0,0])}toJSON(){return{stepType:"replace",from:0,to:0}}static fromJSON(){return new(0,n("aXG5V").ReplaceStep)(0,0,n("5SAOw").Slice.empty)}static from(e){let{mark:t,pos:n}=e;return new ne({mark:t,pos:n})}constructor({inverted:e,pos:t,mark:n}){super(),this.inverted=void 0,this.pos=void 0,this.mark=void 0,this.inverted=!!e,this.pos=t,this.mark=n}}let nt=e=>()=>new(0,n("1S4f7").SafePlugin)({filterTransaction:t=>{if("view"!==e?.editorViewMode?.sharedState.currentState()?.mode||t.getMeta("isRemote")||t.getMeta("allowViewModeTransaction")&&(0,n("dh538").fg)("platform_editor_allow_viewmode_transaction"))return!0;let o=t.steps.reduce((e,t)=>((t instanceof ne||t instanceof t7)&&e.push(t),e),[]);if(0===o.length||!e)return(!(0,n("dh538").fg)("platform_editor_ai_generic_prep_for_aifc")||!t.docChanged||!t.steps.filter(e=>e instanceof n("aXG5V").ReplaceAroundStep||e instanceof n("aXG5V").ReplaceStep||e instanceof n("aXG5V").AddMarkStep||e instanceof n("aXG5V").AddNodeMarkStep||e instanceof n("aXG5V").RemoveMarkStep||e instanceof n("aXG5V").RemoveNodeMarkStep).length)&&!0;return o.forEach(t=>{!t.inverted&&t.mark&&"annotation"===t.mark.type.name&&(t instanceof ne?e.collabEdit?.actions.addInlineCommentNodeMark({mark:t.mark,pos:t.pos}):t instanceof t7&&e.collabEdit?.actions.addInlineCommentMark({mark:t.mark,from:t.from,to:t.to}))}),!0}}),nn=e=>()=>new(0,n("1S4f7").SafePlugin)({appendTransaction:(t,o,r)=>{if(!e||e?.editorViewMode?.sharedState.currentState()?.mode!=="view")return;let a=t.find(t=>e.collabEdit?.actions?.isRemoteReplaceDocumentTransaction(t));if(!a||!a.selectionSet)return;let i=r.doc,s=r.tr,l=new(0,n("ks2lK").TextSelection)(i.resolve(0));return s.setSelection(l),s}}),no=({api:e})=>({name:"editorViewModeEffects",actions:{allowViewModeTransaction:e=>(e.setMeta("allowViewModeTransaction",!0),e),applyViewModeStepAt:e=>{let t=e.steps.reduce((e,t)=>((t instanceof n("aXG5V").AddMarkStep||t instanceof n("aXG5V").AddNodeMarkStep)&&e.push(t),e),[]);return 0!==t.length&&(t.reverse().map(t=>t instanceof n("aXG5V").AddNodeMarkStep?e.step(ne.from(t)):e.step(t7.from(t))),!0)}},pmPlugins:()=>[{name:"editorViewModeEffectsFilterSteps",plugin:nt(e)},{name:"editorViewModeEffectsReplaceDocumentTransaction",plugin:nn(e)}]});var nr=n("hcboS"),na=n("fTvEN"),ni=n("eyggb"),ns=n("dtCIm"),nl=n("7sK9h"),nc=n("flknw"),nd=n("cu2RD"),nu=n("gATpw"),np=n("cVhn8"),nf=n("05jmd"),nm=n("1oCLl"),ng=n("aeAfU");let nh=new(0,n("ks2lK").PluginKey)("limitedModePlugin"),nE=()=>new(0,n("1S4f7").SafePlugin)({key:nh,view:e=>({}),state:{init(e,t){if((0,ng.expVal)("cc_editor_limited_mode_include_lcm","isEnabled",!0)){let e=t.doc.nodeSize;return t.doc.descendants(t=>{t.attrs?.extensionKey==="legacy-content"&&(e+=t.attrs?.parameters?.adf?.length??0)}),{documentSizeBreachesThreshold:e>(0,ng.expVal)("cc_editor_limited_mode","nodeSize",100)}}return t.doc.nodeSize>(0,ng.expVal)("cc_editor_limited_mode","nodeSize",100)?{documentSizeBreachesThreshold:!0}:{documentSizeBreachesThreshold:!1}},apply:(e,t)=>{if(t.documentSizeBreachesThreshold&&!e.getMeta("replaceDocument"))return t;if((0,ng.expVal)("cc_editor_limited_mode_include_lcm","isEnabled",!0)){let t=e.doc.nodeSize;return e.doc.descendants(e=>{e.attrs?.extensionKey==="legacy-content"&&(t+=e.attrs?.parameters?.adf?.length??0)}),{documentSizeBreachesThreshold:t>(0,ng.expVal)("cc_editor_limited_mode","nodeSize",100)}}return e.doc.nodeSize>(0,ng.expVal)("cc_editor_limited_mode","nodeSize",100)?{...t,documentSizeBreachesThreshold:!0}:{...t,documentSizeBreachesThreshold:!1}}}}),ny=({config:e={},api:t})=>({name:"limitedMode",pmPlugins:()=>[{name:"limitedModePlugin",plugin:nE}],getSharedState:e=>e?{get enabled(){return nh.getState(e)?.documentSizeBreachesThreshold??!1},limitedModePluginKey:nh}:{enabled:!1,limitedModePluginKey:nh},usePluginHook:({editorView:o})=>{let r=(0,l.useRef)(!1),a=(0,l.useRef)(!1),{formatMessage:i}=(0,n("8C5kA").default)();(0,l.useEffect)(()=>{a.current=!1},[e.contentId]);let c=(0,l.useCallback)(t=>{if(!0!==(0,ng.expVal)("cc_editor_limited_mode","flagEnabled",!0))return;let o=(0,ng.expVal)("cc_editor_limited_mode","learnMoreLink","");t&&r.current&&!a.current&&(e.showFlag?.({title:i(n("c067q").limitedModeMessages.limitedModeTitle),description:o?i(n("c067q").limitedModeMessages.limitedModeDescriptionWithLink,{learnMoreLink:e=>(0,s.jsx)(n("auNCB").default,{target:"_blank",href:o,children:e})}):i(n("c067q").limitedModeMessages.limitedModeDescriptionWithoutLink),close:"auto"}),a.current=!0)},[i]);(0,l.useEffect)(()=>{let e=(0,n("fFa3V").bind)(o.dom,{type:"focus",listener:()=>{r.current=!0,c(t?.limitedMode?.sharedState.currentState()?.enabled??!1)}});return()=>{e()}},[o,c]),(0,n("6qdjm").usePluginStateEffect)(t,["limitedMode"],({limitedModeState:e})=>{c(e?.enabled??!1)}),(0,n("6qdjm").usePluginStateEffect)(t,["limitedMode"],({limitedModeState:e})=>{if((0,nm.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)&&(0,n("dh538").fg)("platform_editor_native_anchor_patch_2")){let t=e?.enabled??!1,r=(0,n("b7atO").getNodeIdProvider)(o);t&&r&&!r.isLimitedMode()&&r.setLimitedMode()}})}});var n_=n("5HHoF"),nS=n("80JwR"),nk=n("cWFvG"),nT=n("2U68K"),nb=n("5u7tz"),nN=n("b3BjA"),nv=n("36iDo"),nM=n("e6sdP"),nI=n("5DsxN"),nw=n("4NiQW"),nA=n("7nKrc"),nC=n("c8680"),nO=n("efDik"),nP=n("eeGWn"),nx=n("jaskt"),nR=n("i2zv0"),nL=n("5mDFx"),nB=n("1KHo7"),nD=n("fMaLE"),nF=n("kw2eg"),nU=n("dZ8uq"),nq=n("4DEL1"),nj=n("7OCNe"),nG=n("dx8CK");let nK="jira,jiraroadmap,google-drive-sheets,google-drive-docs,OneDrive,google-drive-slides".split(","),nV=(0,n("cgtv4").defineMessages)({invalidAltText:{id:"editor-presets-confluence.media.alt-text.invalid",defaultMessage:"We arent able to accept every possible character in Alt text. All Unicode letters and numbers are OK, but these are the only acceptable symbols: , ' . - _ ( )."}}),nH="jira,jiraroadmap,google-drive-sheets,google-drive-docs,OneDrive,google-drive-slides".split(","),nz=new(0,n("9UG4T").ConfluenceTransformer)(n("iyDxB").defaultSchema),nW=new(0,n("h9yJL").JSONTransformer)(n("iyDxB").defaultSchema),nY=e=>{let t=nz.parse(e);return nW.encode(t)},nJ=(0,n("cgtv4").defineMessages)({easyMentionsPlaceholder:{id:"editor-presets-confluence.placeholder.easy-mentions-placeholder",defaultMessage:"Type / for all elements or @ to mention someone."},aiPlaceholder:{id:"editor-presets-confluence.placeholder.ai-placeholder",defaultMessage:"Type /ai for Atlassian Intelligence, / to add elements, or @ to mention someone (we'll let them know)."},defaultPlaceholder:{id:"editor-presets-confluence.placeholder.default-placeholder",defaultMessage:"Type / to insert elements"},editorEmptyDocumentPlaceholderAI:{id:"editor-presets-confluence.placeholder.default-placeholder-ai",defaultMessage:"Use {key}+' to ask AI, or type / to insert elements"},editorEmptyDocumentSpaceShortcutPlaceholder:{id:"editor-presets-confluence.placeholder.space-shortcut-placeholder",defaultMessage:"Press space to Ask Rovo or / to insert elements"},editorEmptyDocumentSpaceShortcutPlaceholderADFPrefix:{id:"editor-presets-confluence.placeholder.space-shortcut-adf-prefix",defaultMessage:"Press"},editorEmptyDocumentSpaceShortcutPlaceholderADFSpaceShortcut:{id:"editor-presets-confluence.placeholder.space-shortcut-adf-space-key",defaultMessage:"space"},editorEmptyDocumentSpaceShortcutPlaceholderADFMiddle:{id:"editor-presets-confluence.placeholder.space-shortcut-adf-middle",defaultMessage:"to Ask Rovo or"},editorEmptyDocumentSpaceShortcutPlaceholderADFSlashShortcut:{id:"editor-presets-confluence.placeholder.space-shortcut-adf-slash-key",defaultMessage:"/"},editorEmptyDocumentSpaceShortcutPlaceholderADFSuffix:{id:"editor-presets-confluence.placeholder.space-shortcut-adf-suffix",defaultMessage:"to insert elements"},placeholderADF:{id:"editor-presets-confluence.placeholderADF",defaultMessage:"Press <code>space</code> to Ask Rovo or <code>/</code> to insert elements"}}),n$=({formatMessage:e})=>({version:1,type:"doc",content:[{type:"paragraph",content:[(0,n("aoDcQ").text)(e(nJ.editorEmptyDocumentSpaceShortcutPlaceholderADFPrefix)),(0,n("aoDcQ").text)(" "),(0,n("iJQnc").code)(e(nJ.editorEmptyDocumentSpaceShortcutPlaceholderADFSpaceShortcut)),(0,n("aoDcQ").text)(" "),(0,n("aoDcQ").text)(e(nJ.editorEmptyDocumentSpaceShortcutPlaceholderADFMiddle)),(0,n("aoDcQ").text)(" "),(0,n("iJQnc").code)(e(nJ.editorEmptyDocumentSpaceShortcutPlaceholderADFSlashShortcut)),(0,n("aoDcQ").text)(" "),(0,n("aoDcQ").text)(e(nJ.editorEmptyDocumentSpaceShortcutPlaceholderADFSuffix))]}]}),nX=(e,t)=>{let o=t.target.classList.contains(`${n("cqCFf").LIVE_SEARCH_SELECT_CLASSNAME_PREFIX}__input`)||t.target.className===n("cqCFf").LIVE_SEARCH_BUTTON_CLASSNAME;return(t.target instanceof HTMLInputElement||t.target instanceof HTMLButtonElement)&&o},nZ={keydown:nX,keyup:nX,keypress:nX,beforeinput:nX};var nQ=n("kyKWe");let n0=t=>{let o=[];return t.content.forEach(t=>{if("com.atlassian.confluence.macro.core"===t.attrs.extensionType&&"anchor"===t.attrs.extensionKey){let n={...t.attrs,parameters:{...t.attrs.parameters,macroParams:{...t.attrs.parameters.macroParams,"":{value:e(nQ)()}}}};o.push(t.type.create(n,t.content,t.marks))}else o.push(t)}),new(0,n("5SAOw").Slice)(n("5SAOw").Fragment.fromArray(o),t.openStart,t.openEnd)},n1=(e,t)=>t.target instanceof HTMLInputElement&&"ch-search-text-query-input"===t.target.id,n5={keydown:n1,keyup:n1,keypress:n1,beforeinput:n1},n2="extensionManager",n9=new(0,n("ks2lK").PluginKey)(n2),n3=()=>new(0,n("1S4f7").SafePlugin)({key:n9,state:{init:()=>({}),apply(e,t){let n=e.getMeta(n9);return n?{...t,...n}:t}},props:{handleDOMEvents:{...nZ,...n5},transformPasted:n0}}),n6=(0,n("cgtv4").defineMessages)({defaultTooltipContent:{id:"fabric-extension-manager-plugin.anchor.copy-link-button.tooltip",defaultMessage:"Copy link to anchor"},erroredTooltipContent:{id:"fabric-extension-manager-plugin.anchor.copy-link-button.tooltip.disabled",defaultMessage:"Edit to create link"},copySuccessTooltipContent:{id:"fabric-extension-manager-plugin.anchor.copy-link-button.tooltip.copied",defaultMessage:"Copied!"}}),n4=()=>({tr:e})=>e.setMeta(n9,{showAnchorLinkCopiedTooltip:void 0}),n8=({node:t,intl:o,api:r,updateTooltipPosition:a})=>{let i=(0,n("eiA8Z").useSharedPluginStateWithSelector)(r,[n2],e=>e?.extensionManagerState?.showAnchorLinkCopiedTooltip),s=oe(t);return((0,l.useEffect)(()=>()=>{r?.core?.actions?.execute?.(n4())},[r]),(0,l.useLayoutEffect)(()=>{i&&a?.()},[i,a]),s)?e(l).createElement("p",null,i?o.formatMessage(n6.copySuccessTooltipContent):o.formatMessage(n6.defaultTooltipContent)):e(l).createElement("p",null,o.formatMessage(n6.erroredTooltipContent))},n7=(0,n("cgtv4").defineMessages)({anchorMacroCopyLinkCTALabel:{id:"fabric-extension-manager-plugin.anchor.copy-link-button.label",defaultMessage:"Copy link"}}),oe=e=>{let t=e.attrs.parameters.macroParams[""]?.value;if(!t)return!1;try{return decodeURIComponent(t),!0}catch(e){return!1}},ot=(e,t,o)=>(0,n("cEgMD").isCompanyHubSpaceKey)(o)&&(0,n("6mKj3").expVal)("company-hub-edit-heading-anchor-link-create","isEnabled",!1)?n("1NBp8").COMPANY_HUB.toUrl():e?window.location.pathname:n("1NBp8").VIEW_PAGE.toUrl({contentId:t,spaceKey:o}),on=(e,t)=>(o,r)=>{let{tr:a}=o,{isLivePage:i,contentId:s,spaceKey:l}=n9.getState(o)?.pageContext??{},c=e.attrs.parameters.macroParams[""]?.value,d=ot(i,s,l),u=e=>{r?.(a.setMeta(n9,{showAnchorLinkCopiedTooltip:e}))};if(t?.({action:n("d925B").ACTION.CLICKED,actionSubject:n("d925B").ACTION_SUBJECT.BUTTON,actionSubjectId:n("d925B").ACTION_SUBJECT_ID.COPY_LINK_TO_ANCHOR,eventType:n("d925B").EVENT_TYPE.UI,attributes:{inputMethod:n("d925B").INPUT_METHOD.FLOATING_TB,extensionKey:e.attrs?.extensionKey,extensionType:e.attrs?.extensionType,isLivePage:i}}),r)try{decodeURIComponent(c),(0,n("cMZNY").copyToClipboard)(`${window.location.origin}${d}#${c}`).then(()=>{u(!0)}).catch(e=>{(0,n("5ZqQS").getMonitoringClient)().submitError(e,{attribution:n("3IBnw").Attribution.PAGE_EXTENSIONS}),u(!1)})}catch(e){u(!1)}return!0},oo=(t,o,r,a)=>{let i=t.slice(),s=t.map(e=>e.type).indexOf("separator"),{fireAnalyticsEvent:c}=a?.analytics?.actions??{},d=[{id:"editor.anchor.macro.copy-link",type:"button",title:o.formatMessage(n7.anchorMacroCopyLinkCTALabel),tooltipContent:({update:t})=>e(l).createElement(n8,{node:r,intl:o,api:a,updateTooltipPosition:t}),showTitle:!0,hideTooltipOnClick:!1,icon:e(n("1bY7o")),onClick:on(r,c),disabled:!oe(r)}];return -1===s?d.unshift({type:"separator",hidden:!1}):0!==s&&s!==t.length-1&&d.push({type:"separator",hidden:!1}),i.splice(s+1,0,...d),i},or={shouldApplyOverride:(e,t)=>e.selection instanceof n("ks2lK").NodeSelection&&"com.atlassian.confluence.macro.core"===e.selection.node.attrs.extensionType&&"anchor"===e.selection.node.attrs.extensionKey&&(Array.isArray(t.nodeType)?t.nodeType.includes(e.schema.nodes.inlineExtension):t.nodeType===e.schema.nodes.inlineExtension),applyOverride:(e,t,n)=>{if(Array.isArray(e.items)){let o=e.items;e.items=e=>"com.atlassian.confluence.macro.core"===e.attrs.extensionType&&"anchor"===e.attrs.extensionKey?oo(o,t,e,n):o}}},oa=(e,t,n,o,r)=>{if(!o?.length)return;let a=[or];o.forEach(n=>{a.forEach(({shouldApplyOverride:o,applyOverride:a})=>{o(e,n)&&a(n,t,r)})})},oi=({api:e})=>({name:n2,pmPlugins:()=>[{name:n2,plugin:()=>n3()}],getSharedState(e){if(!e)return;let t=n9.getState(e);return{showAnchorLinkCopiedTooltip:t?.showAnchorLinkCopiedTooltip}},usePluginHook({editorView:e}){let t=(0,n("3jwuS").useIsCurrentPageLive)(),[{contentId:o,spaceKey:r}]=(0,n("ep3mz").usePageState)();(0,l.useEffect)(()=>{let{dispatch:n,state:{tr:a}}=e;a.setMeta(n9,{pageContext:{isLivePage:t,spaceKey:r,contentId:o}}),n(a)},[e,t,r,o])},pluginsOptions:{floatingToolbar:(...t)=>oa(...t,e)}});var os=n("ffQ2A"),ol=n("5spQU");let oc=new(0,n("ks2lK").PluginKey)("editorOfflineStoragePlugin"),od=e=>()=>new(0,n("1S4f7").SafePlugin)({key:oc,state:{init:()=>({status:"pending",disabled:!((0,n("9wGTI").fg)("use_frontend_feature_encoding_sdk")?(0,ol.isFeatureEnabled)("confluence","confluence-editor-offline-storage"):!(0,n("lzcvT").isFedRamp)())&&"disabledEnvironment",inactiveSyncing:!1}),apply:(e,t)=>{let n=e.getMeta(oc);return n?{...t,...n}:t}},view:()=>({destroy:()=>e.closeDB(!0)})});class ou{get hasLock(){return this._hasLock}get lockPurpose(){return this._lockPurpose}init(e){this.dbName=e}releaseLock(){this._releaseLock()}async acquireLock(e,t=!1,n){if(!this.dbName)return Promise.reject(Error("SynchronisationLock not initialized."));await navigator.locks?.request(this.dbName,{ifAvailable:!t},async t=>{if(null===t)return void await e?.(!1);let o=this.holdLock();return this._lockPurpose=n,await e?.(!0),o})}async isLocked(){if(!this.dbName)return!1;let e=await navigator.locks?.query(),t=e?.held?e.held.filter(e=>e.name===this.dbName):[];return!!t&&!!(t.length>0)}constructor(){this.dbName=void 0,this._hasLock=!1,this._lockPurpose=void 0,this._releaseLock=()=>{},this.holdLock=async()=>{let e;return this._hasLock=!0,this._releaseLock=()=>{e({}),this._hasLock=!1,this._lockPurpose=void 0},new Promise(t=>{e=t})}}}let op=e=>"OFFLINE_EDITING_SUCCESS_STORE_RECOVERY_VERSION"===e.action,of=e=>{let{api:t,action:o,...r}=e;if(!t||!t.analytics)return;let{version:a,steps:i,status:s,disabled:l}=t?.editorOfflineStorage?.sharedState.currentState()??{};t.analytics.actions?.fireAnalyticsEvent?.({eventType:op(e)?n("d925B").EVENT_TYPE.TRACK:n("d925B").EVENT_TYPE.OPERATIONAL,action:o,actionSubject:n("d925B").ACTION_SUBJECT.OFFLINE_EDITING,actionSubjectId:n("d925B").ACTION_SUBJECT_ID.OFFLINE_EDITING,attributes:{version:a,stepsCount:i?.length,status:s,disabled:l,...r}})},om=e=>e?e instanceof Error?`${e.name}: ${e.message}`:String(e):"Unknown error",og=e=>e.map(e=>om(e)).join(";"),oh="editor:offline:last-background-cleanup-attempt",oE=e=>e.replace(n("awSMG").OFFLINE_STEPS_DATABASE_NAME_PREFIX,"");async function oy(e){return new Promise((t,n)=>{let o=indexedDB.deleteDatabase(e);o.onsuccess=()=>t(),o.onerror=()=>n(o.error),o.onblocked=()=>t()})}async function o_(e,t){let o=e.transaction(n("awSMG").OFFLINE_META_STORE_NAME,"readwrite"),r=o.objectStore(n("awSMG").OFFLINE_META_STORE_NAME),a={...t||{doc:null,version:null},lastUpdated:Date.now()};await r.put(a,1),await o.done}async function oS(e){try{let t=await (0,os.openDB)(e,n("awSMG").OFFLINE_STEPS_DATABASE_VERSION,{upgrade(e){e.objectStoreNames.contains(n("awSMG").OFFLINE_STEPS_STORE_NAME)||e.createObjectStore(n("awSMG").OFFLINE_STEPS_STORE_NAME,{keyPath:"id",autoIncrement:!0}),e.objectStoreNames.contains(n("awSMG").OFFLINE_META_STORE_NAME)||e.createObjectStore(n("awSMG").OFFLINE_META_STORE_NAME,{})},blocking:(e,t,n)=>{n?.target&&n.target.close()}});try{if(!t.objectStoreNames.contains(n("awSMG").OFFLINE_META_STORE_NAME)||!t.objectStoreNames.contains(n("awSMG").OFFLINE_STEPS_STORE_NAME))return t.close(),await oy(e),{dbName:e,deleted:!0,reason:"error",errorMessage:"Database missing required object stores"};let o=t.transaction([n("awSMG").OFFLINE_META_STORE_NAME,n("awSMG").OFFLINE_STEPS_STORE_NAME],"readonly"),r=o.objectStore(n("awSMG").OFFLINE_META_STORE_NAME),a=o.objectStore(n("awSMG").OFFLINE_STEPS_STORE_NAME),i=await r.get(1),s=await a.count();if(!i&&0===s)return t.close(),await oy(e),{dbName:e,deleted:!0,reason:"empty"};if(!i||!i.lastUpdated)return await o_(t,i),{dbName:e,deleted:!1,reason:"migrated"};let l=Date.now()-i.lastUpdated;if(l>2592e6){let n=Math.floor(l/864e5),o=!!i.versionInsertionBackup;return t.close(),await oy(e),{dbName:e,deleted:!0,reason:"expired",daysExpired:n,stepsCount:s,hasBackup:o}}return{dbName:e,deleted:!1,reason:"active"}}catch(t){return{dbName:e,deleted:!1,reason:"error",errorMessage:om(t)}}finally{t.close()}}catch(t){return{dbName:e,deleted:!1,reason:"error",errorMessage:om(t)}}}async function ok(e,t){try{if(!window.indexedDB.databases)return;let o=(await window.indexedDB.databases()).filter(t=>t.name?.startsWith(n("awSMG").OFFLINE_STEPS_DATABASE_NAME_PREFIX)&&t.name!==e);if(0===o.length)return;let r=o.length;for(let e of o.sort(()=>Math.random()-.5).slice(0,100)){let n=e.name;try{let e=await oS(n);"expired"===e.reason&&of({api:t,action:"OFFLINE_EDITING_DATA_EXPIRY_CLEANUP",contentId:oE(n),cleanupType:"database_deleted",daysExpired:e.daysExpired??0,stepsCount:e.stepsCount??0,hasBackup:e.hasBackup??!1,isBackgroundCleanup:!0,totalOfflineDatabases:r}),"error"===e.reason&&of({api:t,action:"OFFLINE_EDITING_BACKGROUND_CLEANUP_ERROR",errorMessage:e.errorMessage??"Unknown error",errorSource:"database_check",contentId:oE(n),totalOfflineDatabases:r})}catch(e){of({api:t,action:"OFFLINE_EDITING_BACKGROUND_CLEANUP_ERROR",errorMessage:om(e),errorSource:"database_check",contentId:oE(n),totalOfflineDatabases:r})}}}catch(e){of({api:t,action:"OFFLINE_EDITING_BACKGROUND_CLEANUP_ERROR",errorMessage:om(e),errorSource:"cleanup_init"})}}class oT{onError(e,t,o){this.api?.core.actions.execute(({tr:e})=>e.setMeta(oc,{disabled:o??"stepsDatabaseError"})),of({api:this.api,action:n("d925B").ACTION.OFFLINE_STORAGE_STEPS_DATABASE_ERROR,errorMessage:om(t),errorSource:e,errorCause:{contentIdPresent:!!this.contentId,stepsDatabaseInitAttempted:this.initAttempted,isSSR:!1,isIndexedDBAvailable:this.indexedDBAvailable}})}get dbName(){if(this.contentId)return`${n("awSMG").OFFLINE_STEPS_DATABASE_NAME_PREFIX}${this.contentId}`}get hasLock(){return this.syncLock.hasLock}get lockPurpose(){return this.syncLock.lockPurpose}isLocked(){return this.syncLock.isLocked()}async releaseSyncLock(){return this.syncLock.releaseLock?.(),this.syncLock.isLocked()}acquireSyncLock(e,t=!1,o,r){let a=this.syncLock.acquireLock(e,t,o).catch(t=>(this.onError("acquireSyncLock()",t),e?.(!1)));if(!t)return;let i=(0,n("9wGTI").fg)("platform_editor_offline_editing_web_ga_fixes")?2e4:r;return i?Promise.race([a,new Promise(t=>{setTimeout(async()=>{await e?.(!1),t()},i)})]):a}async init(e,t){return(this.initAttempted=!0,this.api=t,window?.indexedDB===void 0)?(this.onError("init()",Error("indexedDB is not defined")),!1):this.contentId===e&&!!this.dbPromise||((0,n("9wGTI").fg)("platform_editor_offline_editing_web_closedb_init")||await this.closeDB(),this.contentId=e,this.dbName&&this.syncLock.init(this.dbName),!0)}async validateIndexedDBAccess(){if(void 0!==this.indexedDBAvailable)return this.indexedDBAvailable??!0;try{if(window?.indexedDB===void 0)throw Error("indexedDB is not defined");let e="editor:offline-storage-access-test",t=await (0,os.openDB)(e,1,{upgrade(e){e.createObjectStore("test",{autoIncrement:!0})}}),n=t.transaction("test","readwrite"),o=n.objectStore("test");return await o.add({test:"test"}),await n.done,t.close(),window.indexedDB.deleteDatabase(e),this.indexedDBAvailable=!0,!0}catch(e){return this.onError("validateIndexedDBAccess()",e,"indexedDBAccessError"),this.indexedDBAvailable=!1,!1}}async openDB(){if(void 0===this.dbName)throw Error("StepsDatabase not initialized. Possibly missing contentId, init hasnt been called or rendering in SSR mode.");if(this.dbPromise)try{let e=await this.dbPromise;return await e.transaction(n("awSMG").OFFLINE_META_STORE_NAME,"readonly").objectStore(n("awSMG").OFFLINE_META_STORE_NAME).count(),this.dbPromise}catch(e){await this.closeDB()}return this.dbPromise=(0,os.openDB)(this.dbName,n("awSMG").OFFLINE_STEPS_DATABASE_VERSION,{upgrade(e){e.objectStoreNames.contains(n("awSMG").OFFLINE_STEPS_STORE_NAME)||e.createObjectStore(n("awSMG").OFFLINE_STEPS_STORE_NAME,{keyPath:"id",autoIncrement:!0}),e.objectStoreNames.contains(n("awSMG").OFFLINE_META_STORE_NAME)||e.createObjectStore(n("awSMG").OFFLINE_META_STORE_NAME,{})},terminated:()=>{this.dbPromise=void 0},blocking:(e,t,o)=>{(0,n("9wGTI").fg)("platform_editor_offline_editing_web_db_expiry")&&o?.target&&o.target.close()}}),this.dbPromise}sanitizeStep(e){if(!(e instanceof n("jy7VG").AnalyticsStep)&&!(e instanceof n("8EkET").LinkMetaStep))return e.toJSON()}async updateIfChanged(e,t,o){try{if(await this.syncLock.isLocked()&&!this.hasLock)return!1;let r=(await this.openDB()).transaction([n("awSMG").OFFLINE_STEPS_STORE_NAME,n("awSMG").OFFLINE_META_STORE_NAME],"readwrite"),a=(0,os.unwrap)(r.objectStore(n("awSMG").OFFLINE_STEPS_STORE_NAME)),i=r.objectStore(n("awSMG").OFFLINE_META_STORE_NAME),s=async()=>{await new Promise((e,t)=>{let n=o.map(this.sanitizeStep).filter(e=>!!e),r=a.clear();r.onsuccess=()=>{let o=0,r=()=>{if(o<n.length){let e=n[o],i=a.add({step:e});i.onsuccess=()=>{o++,r()},i.onerror=e=>{t(e.target?.error)}}else e(void 0)};r()},r.onerror=e=>{t(e.target?.error)}})};return await Promise.all([s(),i.put({doc:t,version:e,lastUpdated:Date.now()},1)]),await r.done,!0}catch(e){throw this.onError("updateIfChanged()",e),e}}async updateDocAndVersion(e){try{let t=(0,n("9NwnH").getCollabState)(e.state)?.version;if(void 0===t)return!1;let o=(await this.openDB()).transaction(n("awSMG").OFFLINE_META_STORE_NAME,"readwrite"),r=o.objectStore(n("awSMG").OFFLINE_META_STORE_NAME),a={doc:new(0,n("h9yJL").JSONTransformer)().encode((0,n("9NwnH").getDocBeforeUnconfirmedSteps)(e.state)),version:t,lastUpdated:Date.now()};return await r.put(a,1),await o.done,!0}catch(e){throw this.onError("updateDocAndVersion()",e),e}}async getData(e){try{let t=(await this.openDB()).transaction([n("awSMG").OFFLINE_STEPS_STORE_NAME,n("awSMG").OFFLINE_META_STORE_NAME],"readonly"),o=t.objectStore(n("awSMG").OFFLINE_STEPS_STORE_NAME),r=t.objectStore(n("awSMG").OFFLINE_META_STORE_NAME),a=async()=>(await o.getAll()).map(t=>n("cO9ey").Step.fromJSON(e,t.step)),[i,s]=await Promise.all([a(),r.get(1)]);return await t.done,void 0===s?{steps:i,docJSON:null,version:null}:{steps:i,docJSON:s.doc,version:s.version}}catch(e){throw this.onError("getData()",e),e}}async clear(e){try{if(await this.syncLock.isLocked()&&!this.hasLock)return!1;let t=(await this.openDB()).transaction([n("awSMG").OFFLINE_STEPS_STORE_NAME,n("awSMG").OFFLINE_META_STORE_NAME],"readwrite"),o=t.objectStore(n("awSMG").OFFLINE_STEPS_STORE_NAME),r=t.objectStore(n("awSMG").OFFLINE_META_STORE_NAME);return e?await Promise.all([o.clear(),r.clear()]):await o.clear(),await t.done,!0}catch(e){throw this.onError("clear()",e),e}}async checkAndClearExpiredData(){(0,n("9wGTI").fg)("platform_editor_offline_editing_web_db_expiry")&&(await this.checkCurrentDocumentExpiry(),function(){try{if(!n("17wUi").confluenceLocalStorageInstance)return!1;let e=n("17wUi").confluenceLocalStorageInstance.getItem(oh);if(!e)return!0;return Date.now()-parseInt(e,10)>864e5}catch(e){return!1}}()&&(!function(){try{if(!n("17wUi").confluenceLocalStorageInstance)return;n("17wUi").confluenceLocalStorageInstance.setItem(oh,Date.now().toString())}catch(e){}}(),ok(this.dbName,this.api)))}async checkCurrentDocumentExpiry(){try{let e=await this.openDB();if(!e.objectStoreNames.contains(n("awSMG").OFFLINE_META_STORE_NAME)||!e.objectStoreNames.contains(n("awSMG").OFFLINE_STEPS_STORE_NAME))return;let t=e.transaction([n("awSMG").OFFLINE_STEPS_STORE_NAME,n("awSMG").OFFLINE_META_STORE_NAME],"readwrite"),o=t.objectStore(n("awSMG").OFFLINE_META_STORE_NAME),r=t.objectStore(n("awSMG").OFFLINE_STEPS_STORE_NAME),[a,i]=await Promise.all([o.get(1),r.count()]);if(!a)return void await t.done;let s=Date.now();if(!a.lastUpdated){let e={...a,lastUpdated:s};await o.put(e,1),await t.done;return}if(s-a.lastUpdated>2592e6){await t.done;let e=!!a.versionInsertionBackup,n=Math.floor((s-a.lastUpdated)/864e5);this.contentId&&of({api:this.api,action:"OFFLINE_EDITING_DATA_EXPIRY_CLEANUP",contentId:this.contentId,cleanupType:"database_cleared",daysExpired:n,stepsCount:i,hasBackup:e}),await this.clear(!0);return}await t.done}catch(e){this.onError("checkCurrentDocumentExpiry()",e)}}async closeDB(e=!1){try{this.dbPromise&&((await this.dbPromise).close(),this.dbPromise=void 0,e&&this.syncLock.releaseLock?.())}catch(e){throw this.onError("closeDB()",e),e}}async storeVersionInsertionBackup(e){if(!(0,n("9wGTI").fg)("platform_editor_offline_editing_web_ga_fixes"))return!1;try{let t=(await this.openDB()).transaction(n("awSMG").OFFLINE_META_STORE_NAME,"readwrite"),o=t.objectStore(n("awSMG").OFFLINE_META_STORE_NAME),r=await o.get(1);if(!r||!r.doc||void 0===r.version)return await t.done,!1;let a={...r,versionInsertionBackup:{adfContent:e},lastUpdated:Date.now()};return await o.put(a,1),await t.done,!0}catch(e){return this.onError("storeVersionInsertionBackup()",e),!1}}async getVersionInsertionBackup(){if(!(0,n("9wGTI").fg)("platform_editor_offline_editing_web_ga_fixes"))return null;try{let e=await this.openDB();if(!e.objectStoreNames.contains(n("awSMG").OFFLINE_META_STORE_NAME))return null;let t=e.transaction(n("awSMG").OFFLINE_META_STORE_NAME,"readonly"),o=t.objectStore(n("awSMG").OFFLINE_META_STORE_NAME),r=await o.get(1);return await t.done,r?.versionInsertionBackup??null}catch(e){return this.onError("getVersionInsertionBackup()",e),null}}async clearVersionInsertionBackup(){if(!(0,n("9wGTI").fg)("platform_editor_offline_editing_web_ga_fixes"))return!1;try{let e=(await this.openDB()).transaction(n("awSMG").OFFLINE_META_STORE_NAME,"readwrite"),t=e.objectStore(n("awSMG").OFFLINE_META_STORE_NAME),o=await t.get(1);if(!o||!o.versionInsertionBackup)return await e.done,!0;let{versionInsertionBackup:r,...a}=o;return await t.put({...a,lastUpdated:Date.now()},1),await e.done,!0}catch(e){return this.onError("clearVersionInsertionBackup()",e),!1}}constructor(){this.dbPromise=void 0,this.contentId=void 0,this.syncLock=new ou,this.api=void 0,this.initAttempted=!1,this.indexedDBAvailable=void 0}}let ob=e=>{let{state:t}=e,o=t.reconfigure({plugins:t.plugins.filter(e=>e.spec.key!==(0,n("ke2AI").history)().spec.key)});e.updateState(o);let{state:r}=e,a=r.reconfigure({plugins:r.plugins.concat((0,n("ke2AI").history)())});e.updateState(a)},oN=({api:e,editorView:t,stepsDatabase:o})=>{let r=window&&"BroadcastChannel"in window,a=(0,l.useRef)(),i=(0,l.useRef)(!1),s=(0,l.useCallback)((e="resync")=>{a.current&&a.current.postMessage({type:e})},[]),c=(0,l.useCallback)(async function(r){let{type:a}=r.data;if("resync"!==a&&"restore"!==a)return;let{mode:s}=e?.connectivity?.sharedState.currentState()??{};if("resync"===a){if("offline"!==s)return}else if("restore"===a&&"online"!==s)return;let{steps:l,docJSON:c,version:d}=await o.getData(t.state.schema);if(!c||null===d)return;if("resync"===a){if(!l)return}else if("restore"===a&&l&&l.length>0)return;i.current||(of({api:e,action:n("d925B").ACTION.OFFLINE_STORAGE_BROADCAST_CHANNEL_FIRST_UPDATE}),i.current=!0);let u=e?.history?.sharedState?.currentState?.(),p=(u?.done?.eventCount??0)>0||(u?.undone?.eventCount??0)>0;p&&ob(t);let f=(0,n("9NwnH").syncFromAnotherSource)(t.state,d,c,l);p&&e?.history?.commands.updatePluginState&&e.history.commands.updatePluginState({tr:f}),t.dispatch(f)},[e,t,o]);return(0,l.useEffect)(()=>{if(r&&o.dbName)return a.current=new BroadcastChannel(o.dbName),a.current.addEventListener("message",c),()=>{a.current&&(a.current.removeEventListener("message",c),a.current.close())}},[r,o.dbName,c]),s};function ov(){return({tr:e})=>(e.setMeta("addToHistory",!1),e.setMeta(oc,{status:"ready"}),e)}function oM(e){return({tr:t})=>(t.setMeta("addToHistory",!1),t.setMeta(oc,{inactiveSyncing:e}),t)}let oI=(e,t)=>{switch(e){case"init":return t?"leader_granted":"follower_waiting";case"follower_waiting":return t?"follower_granted":"follower_waiting";case"leader_granted":case"follower_granted":return e}},ow=(e,t,n)=>{try{let o=n.nodeFromJSON(e);return t.forEach(e=>{let t=e.apply(o);!t.failed&&t.doc&&(o=t.doc)}),o}catch(e){return}};async function oA(e,t,o,r){try{let{steps:a,docJSON:i}=await t.getData(o);if(a.length>0){if(i&&(0,n("9wGTI").fg)("platform_editor_offline_version_sync")){let e=ow(i,a,o);e&&r?.createOfflineVersion?.({doc:e,steps:a})}if(!e?.core.actions.execute(({tr:t})=>{let o=[];return a.forEach(e=>{try{t.step(e)}catch(t){o.push({step:e,error:t})}}),o.length>0&&of({api:e,action:n("d925B").ACTION.OFFLINE_STORAGE_FAILED_STEPS,errorInfo:og(o.map(e=>e.error)),stepsCount:o.length}),t.setMeta("addToHistory",!1),t.setMeta(oc,{status:"ready"}),t}))return!1}return!0}catch(e){return!1}}async function oC(e,t){e?.core.actions.execute(ov()),await t.releaseSyncLock(),e?.core.actions.execute(oM(!1))}async function oO(e,t,n,o){let r=0;for(;r<3;){if(await oA(e,t,n,{createOfflineVersion:o?.createOfflineVersion}))return;await new Promise(e=>setTimeout(e,1e3)),r++}await oC(e,t)}async function oP(e,t){await new Promise(e=>setTimeout(e,2e3)),e?.core.actions.execute(ov()),await t.releaseSyncLock(),e?.core.actions.execute(oM(!1))}async function ox(e,t,n){let o=0;for(;o<3;){if(await oA(e,t,n))return void await oP(e,t);await new Promise(e=>setTimeout(e,1e3)),o++}await oC(e,t)}async function oR(e,t,n){e?.core.actions.execute(oM(!0)),await t.acquireSyncLock(n,!0,"restore",2e4)}async function oL(e,t){if(!await e.validateIndexedDBAccess()||!(await window.indexedDB.databases()).find(t=>t.name===e.dbName))return!1;let{steps:n}=await e.getData(t);return n.length>0}async function oB(e,t,o,r,a,i){if(a>=2){e?.core.actions.execute(({tr:e})=>(e.setMeta("addToHistory",!1),e.setMeta(oc,{status:"tooManyRetries"}),e)),of({api:e,action:n("d925B").ACTION.OFFLINE_STORAGE_TOO_MANY_RETRIES_ERROR,errorMessage:"Exceeded max retries (2) with delay of 1000ms",errorInfo:om(i),maxRetries:2,retrySource:"isStepsRestoreRequired"});return}await new Promise(e=>setTimeout(e,1e3)),oD(e,t,o,a+1)(r)}function oD(e,t,o,r=0,a){return async i=>{try{if(!await oL(t,i))return void e?.core.actions.execute(ov())}catch(n){await oB(e,t,o,i,r,n);return}of({api:e,action:n("d925B").ACTION.OFFLINE_STORAGE_RESTORE_STEPS_INITIATED,retryCount:r});let s=function(e,t,n,o){let r="init",a="init",i=async s=>{if(a=r,(r=oI(r,s))===a)return void await oC(e,t);switch(r){case"leader_granted":await oO(e,t,n,o);break;case"follower_waiting":await oR(e,t,i);break;case"follower_granted":await ox(e,t,n)}};return i}(e,t,i,a);t.acquireSyncLock(s,!1,"restore")}}var oF=n("8Yfbq");let oU=async({editorView:e,stepsDatabase:t,version:o,steps:r,broadcast:a})=>{let i=(0,n("9NwnH").getDocBeforeUnconfirmedSteps)(e.state).toJSON();await t.updateIfChanged(o,i,r)?a():e.dispatch(e.state.tr.setMeta(oc,{disabled:"unableToSync"}))},oq=e(oF)(oU,200),oj=(e,t)=>{switch(e){case"init":return t?"granted_initial":"waiting_initial";case"waiting_initial":case"waiting_recovery":return t?"granted_recovery":"waiting_recovery";default:return e}},oG=e=>{let t=e?.history?.sharedState?.currentState?.();return(t?.done?.eventCount??0)>0||(t?.undone?.eventCount??0)>0};async function oK(e,t,o,r,a){if((0,n("91bcx").isOfflineMode)(e?.connectivity?.sharedState.currentState()?.mode))return;let i="init",s="init",l=async c=>{if(s=i,i=oj(i,c),(0,n("9wGTI").fg)("platform_editor_offline_editing_web_ga_fixes")&&i===s)return void e?.core?.actions?.execute(oM(!1));let{steps:d,docJSON:u,version:p}=await t.getData(o?.state?.schema),f=()=>{of({api:e,action:n("d925B").ACTION.OFFLINE_STORAGE_RESYNC_ONLINE,resyncStatus:i,isActiveTab:r})},m=(0,n("9NwnH").getCollabState)(o.state)?.unconfirmed??[];switch(i){case"granted_initial":if(d.length>0)f(),m.forEach(e=>{e.origin instanceof n("ks2lK").Transaction&&(e.origin.setMeta("isOffline",!1),e.origin.setMeta("wasOffline",!0))}),(0,n("9wGTI").fg)("platform_editor_offline_version_sync")&&a.createOfflineVersion?.({doc:o.state.doc,steps:m.map(e=>e.step)}),setTimeout(()=>{e?.core?.actions?.execute(oM(!1))},3e3);else if(u&&null!==p&&0!==m.length){f(),oG(e)&&ob(o);let r=(0,n("9NwnH").syncFromAnotherSource)(o.state,p,u,[]);oM(!0)({tr:r}),(0,n("9wGTI").fg)("platform_editor_offline_editing_web_ga_fixes")&&(0,n("h3X17").tintDirtyTransaction)(r),o.dispatch(r),t.acquireSyncLock(l,!0,"resync")}else setTimeout(()=>{e?.core?.actions?.execute(oM(!1))},3e3);break;case"waiting_initial":if(u&&null!==p&&m?.length!==0){f(),oG(e)&&ob(o);let r=(0,n("9NwnH").syncFromAnotherSource)(o.state,p,u,[]);oM(!0)({tr:r}),o.dispatch(r),t.acquireSyncLock(l,!0,"resync")}break;case"granted_recovery":d.length>0&&u&&null!==p&&(f(),oG(e)&&ob(o),o.dispatch((0,n("9NwnH").syncFromAnotherSource)(o.state,p,u,d))),setTimeout(()=>{e?.core?.actions?.execute(oM(!1))},3e3);break;case"waiting_recovery":d.length>0&&u&&null!==p&&f(),e?.core?.actions?.execute(oM(!1)),t.acquireSyncLock(l,!0,"resync")}};t.acquireSyncLock(l,!1,"resync")}let oV=(0,n("cgtv4").defineMessages)({errorTitle:{id:"editor-offline-storage.version-insertion-error-flag.title",defaultMessage:"Error saving version history"},errorTitleRetry:{id:"editor-offline-storage.version-insertion-error-flag.title-retry",defaultMessage:"Failed to save"},errorDescription:{id:"editor-offline-storage.version-insertion-error-flag.description",defaultMessage:"We couldn't save a version history of your offline edits. Your changes are safe, but if you want a backup please try again."},errorDescriptionRetry:{id:"editor-offline-storage.version-insertion-error-flag.description-retry",defaultMessage:"We're still having trouble saving a version history of your offline edits. Please try again."},retryButton:{id:"editor-offline-storage.version-insertion-error-flag.retry-button",defaultMessage:"Try again"},successTitle:{id:"editor-offline-storage.version-insertion-success-flag.title",defaultMessage:"Version history saved"},successDescription:{id:"editor-offline-storage.version-insertion-success-flag.description",defaultMessage:"Your offline edits have been saved to version history."}}),oH="version-insertion-error-flag",oz=(t,o,r,a,i)=>{t&&t.showCustomFlag({id:oH,title:o.formatMessage(i>0?oV.errorTitleRetry:oV.errorTitle),description:o.formatMessage(i>0?oV.errorDescriptionRetry:oV.errorDescription),customIcon:e(l).createElement(e(n("744ND")),{color:"var(--ds-icon, #292A2E)",label:""}),actions:[{content:o.formatMessage(oV.retryButton),onClick:r}],onClose:a})},oW=(t,o)=>{t&&t.showCustomFlag({id:"version-insertion-success-flag",title:o.formatMessage(oV.successTitle),description:o.formatMessage(oV.successDescription),customIcon:e(l).createElement(e(n("3sFtD")),{color:"var(--ds-icon-success, #6A9A23)",label:""})})},oY=e=>{e&&e.hideFlag(oH)},oJ=(0,n("cgtv4").defineMessages)({VersionComment:{id:"editor-offline-storage.offline-version-comment",defaultMessage:"Offline edits"},VersionCommentManualRetry:{id:"editor-offline-storage.offline-version-comment-manual-retry",defaultMessage:"Offline edits (manual retry)"}}),o$=(0,n("eSUdr").default)`mutation useCreateOfflineVersionInsertVersionMutation($cloudId:ID!$contentId:ID!$adfContent:String!$versionComment:String!){confluence_insertOfflineVersion(cloudId:$cloudId input:{contentId:$contentId adfContent:$adfContent versionComment:$versionComment}){versionNumber success errors{message}}}`,oX=({contentId:t,api:o,stepsDatabase:r,flags:a})=>{let{cloudId:i}=(0,n("bQm3c").useSessionData)(),s=(0,n("8C5kA").default)(),c=(0,l.useRef)(0),[d]=(0,n("1KmJq").useMutation)(o$),u=(0,l.useCallback)(({cloudId:e,contentId:t,adfContent:i,versionComment:l})=>{let p=()=>{a&&(c.current+=1,oY(a),u({cloudId:e,contentId:t,adfContent:i,versionComment:s.formatMessage(oJ.VersionCommentManualRetry)}))},f=()=>{of({api:o,action:"OFFLINE_EDITING_VERSION_INSERTION_ERROR_FLAG_DISMISSED",manualRetryCount:c.current})};d({variables:{cloudId:e,contentId:t,adfContent:i,versionComment:l}}).then(async e=>{if(e.errors){of({api:o,action:"OFFLINE_EDITING_FAILED_STORE_RECOVERY_VERSION",errorMessage:e.errors.map(e=>e.message).join(","),manualRetryCount:c.current}),(0,n("9wGTI").fg)("platform_editor_offline_editing_web_ga_fixes")&&(await r.storeVersionInsertionBackup(i),a&&t&&oz(a,s,p,f,c.current));return}of({api:o,action:"OFFLINE_EDITING_SUCCESS_STORE_RECOVERY_VERSION",success:e.data?.confluence_insertOfflineVersion?.success,manualRetryCount:c.current}),c.current>0&&a&&oW(a,s),c.current=0,(0,n("9wGTI").fg)("platform_editor_offline_editing_web_ga_fixes")&&await r.clearVersionInsertionBackup()}).catch(async e=>{of({api:o,action:"OFFLINE_EDITING_FAILED_STORE_RECOVERY_VERSION",errorMessage:om(e),manualRetryCount:c.current}),(0,n("9wGTI").fg)("platform_editor_offline_editing_web_ga_fixes")&&(await r.storeVersionInsertionBackup(i),a&&t&&oz(a,s,p,f,c.current))})},[d,o,r,a,s]),p=(0,l.useCallback)(e=>{t&&a&&(oY(a),u({cloudId:i,contentId:t,adfContent:e,versionComment:s.formatMessage(oJ.VersionCommentManualRetry)}))},[t,i,a,s,u]),f=(0,l.useMemo)(()=>e(oF)(u,2e4,{leading:!0,trailing:!1}),[u]);return{createVersion:(0,l.useCallback)(({doc:e,steps:r})=>{if(0!==r.filter(e=>e instanceof n("aXG5V").ReplaceStep).length){if(!t)return void of({api:o,action:"OFFLINE_EDITING_FAILED_STORE_RECOVERY_VERSION",errorMessage:"No content id",manualRetryCount:0});f({cloudId:i,contentId:t,adfContent:JSON.stringify(new(0,n("h9yJL").JSONTransformer)().encode(e)),versionComment:s.formatMessage(oJ.VersionComment)})}},[o,t,f,i,s]),manualRetryCreateVersion:p}},oZ=(e,t)=>{let n=(0,l.useRef)(t);(0,l.useLayoutEffect)(()=>(n.current=t,()=>{n.current=void 0}),[t]),(0,l.useLayoutEffect)(()=>e?.connectivity?.sharedState.onChange(({prevSharedState:e,nextSharedState:t})=>{n.current?.({prevMode:e?.mode,nextMode:t?.mode})}),[e])},oQ=({api:e,editorView:t,stepsDatabase:o,broadcastUpdate:r,contentId:a,flags:i})=>{let{createVersion:s}=oX({contentId:a,api:e,stepsDatabase:o,flags:i}),c=(0,l.useRef)(!1);oZ(e,({prevMode:a,nextMode:i})=>{let{status:l,disabled:d}=oc.getState(t.state)??{};"ready"!==l||d||!c.current&&(c.current=!0,(0,n("91bcx").isOfflineMode)(a)&&"online"===i?document&&!document?.hasFocus?.()?setTimeout(()=>oK(e,o,t,!1,{createOfflineVersion:s}).finally(()=>{c.current=!1}),document?.visibilityState==="visible"?500:1e3):oK(e,o,t,!0,{createOfflineVersion:s}).finally(()=>{c.current=!1}):(0,n("91bcx").isOfflineMode)(i)&&o.validateIndexedDBAccess().then(e=>{e?o.clear(!0).then(async e=>{e&&await o.releaseSyncLock?.()}).finally(()=>{let{version:e,steps:a}=(0,n("9NwnH").sendableSteps)(t.state)??{};void 0!==e&&void 0!==a?oU({editorView:t,stepsDatabase:o,version:e,steps:a,broadcast:r}).finally(()=>{c.current=!1}):c.current=!1}):c.current=!1}))})},o0=({api:e,stepsDatabase:t,disabledRef:o})=>{let r=(0,l.useRef)(!1);(0,n("6qdjm").usePluginStateEffect)(e,["editorOfflineStorage","connectivity","collabEdit"],()=>{"unableToSync"!==o.current||r.current||(r.current=!0,t.isLocked().then(t=>{t||"unableToSync"!==o.current||e?.core.actions.execute(({tr:e})=>e.setMeta(oc,{disabled:!1}))}).catch(()=>{}).finally(()=>{r.current=!1}))})},o1=({api:e,config:t})=>{let o=new oT;return{name:"editorOfflineStorage",pmPlugins:()=>[{name:"editorOfflineStoragePlugin",plugin:od(o)}],getSharedState(e){if(!e)return;let{status:t,disabled:o,inactiveSyncing:r}=oc.getState(e)??{},{version:a,steps:i}=(0,n("9NwnH").sendableSteps)(e)??{};return{version:a??0,steps:i??[],status:t??"pending",disabled:o??!1,inactiveSyncing:r??!1}},usePluginHook:({editorView:r})=>{let[a]=(0,n("ep3mz").usePageContentId)(),i=(0,l.useRef)(!1),s=(0,l.useRef)(!1),c=(0,n("8C5kA").default)();(0,n("6qdjm").usePluginStateEffect)(e,["editorOfflineStorage"],({editorOfflineStorageState:e})=>{i.current=e?.disabled??!1});let{createVersion:d,manualRetryCreateVersion:u}=oX({contentId:a,api:e,stepsDatabase:o,flags:t?.flags??null});(0,l.useEffect)(()=>{!a||o.dbName||i.current||o.init(a,e).then(async r=>{if(r&&(0,n("9wGTI").fg)("platform_editor_offline_editing_web_ga_fixes")&&(await o.checkAndClearExpiredData(),!s.current)){s.current=!0;let n=await o.getVersionInsertionBackup();n&&oz(t?.flags,c,()=>{u(n.adfContent)},()=>{of({api:e,action:"OFFLINE_EDITING_VERSION_INSERTION_ERROR_FLAG_DISMISSED",manualRetryCount:0})},0)}})},[a,o,e,c,u]);let p=oN({api:e,editorView:r,stepsDatabase:o});oQ({api:e,editorView:r,broadcastUpdate:p,stepsDatabase:o,contentId:a,flags:t?.flags??null}),o0({api:e,stepsDatabase:o,disabledRef:i}),(0,l.useEffect)(()=>()=>{oq.cancel()},[a,r]),(0,n("6qdjm").usePluginStateEffect)(e,["editorOfflineStorage","connectivity","collabEdit"],({editorOfflineStorageState:t,connectivityState:a,collabEditState:s})=>{let{status:l,steps:c,version:u,disabled:f}=t??{};if(!i.current){if(window?.indexedDB===void 0){f||e?.core.actions.execute(({tr:e})=>e.setMeta(oc,{disabled:"stepsDatabaseError"}));return}switch(c?.length===0&&o.hasLock&&o.clear(!1).then(async e=>{e&&("restore"===o.lockPurpose&&await o.updateDocAndVersion(r).then(e=>{e&&p("restore")}),await o.releaseSyncLock?.())}),l){case"pending":if(s?.initialised.collabInitialisedAt){let t=r.state.tr;t.setMeta("addToHistory",!1),t.setMeta(oc,{status:"restoring"}),r.dispatch(t),oD(e,o,r,0,{createOfflineVersion:d})(r.state.schema)}break;case"restoring":break;case"ready":"visible"===document.visibilityState&&document.hasFocus()&&c&&void 0!==u&&(0,n("91bcx").isOfflineMode)(a?.mode)&&oq({editorView:r,stepsDatabase:o,version:u,steps:c,broadcast:p});break;case"tooManyRetries":f||e?.core.actions.execute(({tr:e})=>e.setMeta(oc,{disabled:"tooManyRetries"}))}}})}}};var o5=n("jTxSS"),o2=n("jSnXV");let o9="heading-links",o3=new(0,n("ks2lK").PluginKey)(o9);(i={}).NOT_ENROLLED="not-enrolled",i.CONTROL="control",i.VARIANT="variant";let o6=async(e,t)=>{try{let o=(0,n("202oG").getHeadingIdForNode)(e);if(!o)return!1;let r=t();if(!r)return!1;let a=new URL(location.origin+r);a.hash=encodeURIComponent(o);let i=a.toString();if(navigator.clipboard&&"function"==typeof navigator.clipboard.writeText)return await navigator.clipboard.writeText(i),!0;return!1}catch{return!1}},o4=(0,n("cgtv4").defineMessages)({tooltipCopyMessage:{id:"editor-heading-links.link-component.tooltip.copy",defaultMessage:"Copy link to heading"},tooltipCopiedMessage:{id:"editor-heading-links.link-component.tooltip.copied",defaultMessage:"Copied!"},iconLabel:{id:"editor-heading-links.link-component.icon.label",defaultMessage:"Link icon"}}),o8=({node:t,intl:o,analytics:r,isRightAligned:a,getHeadingLinkPath:i})=>{let s,[c,d]=(0,l.useState)(!1),u=(0,l.useRef)(),{colorMode:p}=(0,n("cOrQJ").default)();(0,l.useLayoutEffect)(()=>{u.current?.()},[c]);let f=(0,l.useCallback)(async()=>{await o6(t,i)&&d(!0),r?.fireAnalyticsEvent?.({action:n("d925B").ACTION.CLICKED,actionSubject:n("d925B").ACTION_SUBJECT.BUTTON,actionSubjectId:n("d925B").ACTION_SUBJECT_ID.HEADING_ANCHOR_LINK,eventType:n("d925B").EVENT_TYPE.UI})},[t,r,i]),m=(0,l.useCallback)(({update:e})=>(u.current=e,c?o.formatMessage(o4.tooltipCopiedMessage):o.formatMessage(o4.tooltipCopyMessage)),[c,o]),g=(0,l.useCallback)(()=>{d(!1)},[]),h=t.attrs.level;return s=c?"dark"===p?"link-widget-clicked-dark":"link-widget-clicked-light":"dark"===p?"link-widget-hovered-dark":"link-widget-hovered-light",e(l).createElement(n("3gadb").default,{tag:"span",delay:0,position:"top",content:m},e(l).createElement("span",{"data-testid":"heading-link-copy-button",className:`link-widget ${a?"link-widget-right":"link-widget-left"} ${h>3?"link-widget-small":"link-widget-medium"} ${s}`,onClick:f,onMouseLeave:g}))},o7=(t,o,r,a,i,s)=>n("ftzrq").Decoration.widget(t,()=>{let t=document.createElement("span"),n=document.createElement("span");return e(o5).render(e(l).createElement(o8,{node:o,intl:a,analytics:i,isRightAligned:r,getHeadingLinkPath:s}),n),t.appendChild(n),t},{side:r?-1:1,key:`heading-link-${t}`,ignoreSelection:!1}),re=(t,o,r)=>{let a=e(o2)((e,t)=>{let n=e.posAtCoords({left:t.clientX,top:t.clientY}),o=n?.pos;if(void 0!==o){let t=e.state.doc.resolve(o);if("heading"!==t.parent.type.name){let n=Math.min(o+1,e.state.doc.content.size);t=e.state.doc.resolve(n)}"heading"===t.parent.type.name&&e.dispatch(e.state.tr.setMeta(o3,{applyHoverDecoration:!0,from:t.start(),node:t.parent}))}return!1},150),i=new(0,n("1S4f7").SafePlugin)({key:o3,state:{init:()=>({hoveredHeading:void 0,start:void 0}),apply:(e,t,n,o)=>{let r=e.getMeta(o3);if(r?.applyHoverDecoration)return{hoveredHeading:r.node,start:r.from};if(void 0!==t.start){let n=e.mapping.map(t.start),r=o.doc.resolve(n);return 0===r.parent.content.size||"heading"!==r.parent.type.name?{hoveredHeading:void 0,start:void 0}:{hoveredHeading:r.parent,start:r.start()}}return t}},props:{decorations(e){let a=i.getState(e),s=a?.hoveredHeading,l=a?.start;if(s&&void 0!==l){let a=s.marks.find(e=>e.attrs?.align==="end"),i=o7(a?l:l+s.content.size,s,void 0!==a,t,o,r);return n("ftzrq").DecorationSet.create(e.doc,[i])}return n("ftzrq").DecorationSet.empty},handleDOMEvents:{mouseover:a}}});return i},rt=({api:e,config:{getHeadingLinkPath:t}})=>({name:o9,pmPlugins:()=>[{name:o9,plugin:({getIntl:n})=>re(n(),e?.analytics?.actions,t)}]});var rn=n("a4TK8");let ro=(0,n("cgtv4").defineMessages)({title:{id:"editor-presets.conflicts-resolved-flag.title",defaultMessage:"All conflicts have been resolved"},description:{id:"editor-presets.conflicts-resolved-flag.description",defaultMessage:"Your offline edits have been successfully synced."},viewHistoryButton:{id:"editor-presets.conflicts-resolved-flag.view-history-button",defaultMessage:"View version history"}}),rr="conflicts-resolved-flag",ra=(e,t,o,r)=>{if(!e)return;let a=n("1NBp8").CONTENT_HISTORY.toUrl({spaceKey:r,contentId:o});e.showSuccessFlag({id:rr,title:t.formatMessage(ro.title),description:t.formatMessage(ro.description),actions:[{content:t.formatMessage(ro.viewHistoryButton),href:a,onClick:()=>{ri(e)}}]})},ri=e=>{e&&e.hideFlag(rr)},rs=(e,t,o=!1)=>n("ftzrq").Decoration.widget(e.from,()=>{let r=document.createElement("span"),a=(0,n("24P9d").convertToInlineCss)({background:o?"var(--ds-background-accent-orange-subtlest-hovered, #FCE4A6)":"var(--ds-background-accent-orange-subtlest, #FFF5DB)",textDecoration:"underline",textDecorationStyle:"dotted",textDecorationThickness:"var(--ds-space-025, 2px)",textDecorationColor:"var(--ds-border-accent-orange, #E06C00)"});return r.setAttribute("style",a),r.appendChild(n("5SAOw").DOMSerializer.fromSchema(t.doc.type.schema).serializeFragment(function e(t,o){if(!o)return t;let r=o.create({}),a=[];return t.forEach(t=>{t.isText?a.push(t.mark([...t.marks,r])):a.push(t.copy(e(t.content,o)))}),n("5SAOw").Fragment.fromArray(a)}(e?.local.content,t.doc.type.schema.marks.strike))),r},{side:-1,ignoreSelection:!1}),rl={"tableView-content-wrap":"table","mediaSingleView-content-wrap":".rich-media-item","bodiedExtensionView-content-wrap":".extension-container","multiBodiedExtensionView-content-wrap":".multiBodiedExtension--container","embedCardView-content-wrap":".rich-media-item","datasourceView-content-wrap":".datasourceView-content-inner-wrap"},rc=e=>{let t=Object.keys(rl).find(t=>e.classList.contains(t)),n=t&&rl[t];if(n){let t=e.querySelector(n);if(t)return window.getComputedStyle(t)}},rd=e=>ru(e,["height","padding-top","padding-bottom","border-top-width","border-bottom-width"]),ru=(e,t)=>{let[n,...o]=t,r=[e.getPropertyValue(n)];"content-box"===e.getPropertyValue("box-sizing")&&o.forEach(t=>{r.push(e.getPropertyValue(t))});let a=0;for(let e=0;e<r.length;e++)a+=parseFloat(r[e]);return a},rp=(e,t)=>n("ftzrq").Decoration.widget(t,(t,n)=>{let o=n(),r=document.createElement("span");r.className="conflictmarker",r.appendChild(document.createElement("span"));let a=void 0!==o?t.nodeDOM(o):null;if(a instanceof HTMLElement&&r.firstChild){let t,n=rc(a)||window.getComputedStyle(a),i=r.firstChild;i.style.height=`${rd(n)}px`;let s=e&&((e.attrs.layout&&(t=e.attrs.layout),e.marks&&e.marks.length&&(t=(e.marks.find(e=>"breakout"===e.type.name)||{attrs:{mode:""}}).attrs.mode),"table"===e.type.name&&e.attrs.width&&(t="fixed-width"),-1===["wide","full-width","fixed-width"].indexOf(t))?"":t);for(let[t,r]of((0!==o||s||e?.type.name==="table")&&(i.style.marginTop=n.getPropertyValue("margin-top")),Object.entries({content:"''",position:"absolute",background:"var(--ds-background-accent-red-bolder, #C9372C)",width:"var(--ds-space-075, 6px)",marginLeft:"var(--ds-space-negative-075, -6px)",borderRadius:"var(--ds-radius-small, 4px) 0 0 var(--ds-radius-small, 4px)"})))i.style.setProperty(t.replace(/[A-Z]/gu,e=>`-${e.toLowerCase()}`).replace(/^ms/u,"-ms"),r);i.className="conflictmarker",i.setAttribute("data-testid","conflictmarker")}return r},{side:-1}),rf=(e,t)=>{let n=t.doc.resolve(e),o=n?.node();return o&&o.isBlock&&!o.isTextblock?o:null},rm=(e,t,o)=>{let r=rf(e.from+1,t);if(r)return rp(r,e.from);let a={textDecoration:"underline",textDecorationStyle:"dotted",textDecorationThickness:"var(--ds-space-025, 2px)",textDecorationColor:"var(--ds-border-accent-orange, #E06C00)"};return(0,n("9wGTI").fg)("platform_editor_offline_editing_web_ga_fixes")?"resolving"===o&&(a.background="var(--ds-background-accent-orange-subtlest, #FFF5DB)"):a.background="var(--ds-background-accent-orange-subtlest, #FFF5DB)",n("ftzrq").Decoration.inline(e.from,e.to,{style:(0,n("24P9d").convertToInlineCss)(a)})},rg=(e,t)=>{if("deleted"===e.type)return rs(e,t,!0);let o=rf(e.from+1,t);return o?rp(o,e.from):n("ftzrq").Decoration.inline(e.from,e.to,{style:(0,n("24P9d").convertToInlineCss)({background:"var(--ds-background-accent-orange-subtlest-hovered, #FCE4A6)",textDecoration:"underline",textDecorationStyle:"dotted",textDecorationThickness:"var(--ds-space-025, 2px)",textDecorationColor:"var(--ds-border-accent-orange, #E06C00)"})})};function rh(e){return void 0!==e}let rE=(e,t,n,o)=>{if(!e)return[];if(!t)return[...e.inserted.map(e=>rm(e,n,o)),...e.deleted.map(e=>rs(e,n)).filter(rh)];{let r=rg(t,n),a=[...e.inserted.filter(e=>e.id!==t.id).map(e=>rm(e,n,o)),...e.deleted.filter(e=>e.id!==t.id).map(e=>rs(e,n)).filter(rh)];return r?a.concat(r):a}},ry=(e,t,n)=>{let o=t.map(e.from),r=t.map(e.to);if("inserted"!==n||o!==r)return{...e,from:o,to:r}},r_=(e,t)=>t.from>=e.from&&t.from<=e.to||t.to>=e.from&&t.to<=e.to,rS=(e,t)=>{if(!e)return;let n=e?.inserted.find(e=>r_(e,t)),o=e?.deleted.find(e=>r_(e,t));return n?{...n,type:"inserted"}:o?{...o,type:"deleted"}:void 0},rk=()=>new(0,n("1S4f7").SafePlugin)({key:n("cyZvy").conflictResolutionPluginKey,state:{init:()=>({decorations:n("ftzrq").DecorationSet.empty,conflicts:void 0,selected:void 0,isNextEnabled:!1,isPreviousEnabled:!1,resolutionMode:"viewing"}),apply:(e,t)=>{let o,r=e.getMeta(n("cyZvy").conflictResolutionPluginKey),a=e.getMeta("nextConflict");if(void 0===t.conflicts&&void 0===r)return t;let i=(0,n("djYcq").getNewConflicts)(r,t.conflicts),s=t.conflicts?{inserted:t.conflicts.inserted.map(t=>ry(t,e.mapping,"inserted")).filter(rh),deleted:t.conflicts.deleted.map(t=>ry(t,e.mapping,"deleted")).filter(rh)}:void 0,l=i??s,c=t.resolutionMode;return(0,n("9wGTI").fg)("platform_editor_offline_editing_web_ga_fixes")&&(r?.type==="startResolving"?c="resolving":r?.type==="stopResolving"?c="viewing":i&&!t.conflicts&&(c="viewing")),(0,n("9wGTI").fg)("platform_editor_offline_editing_web_ga_fixes")?a?o=a:"resolving"===c&&(o=rS(l,e.selection)):o=a??rS(l,e.selection),{decorations:i||o||t.selected?n("ftzrq").DecorationSet.create(e.doc,rE(l,o,e,c)):t.decorations.map(e.mapping,e.doc),conflicts:l,selected:o,isPreviousEnabled:!!l&&!!o&&(0,n("djYcq").getNavigationInfo)(l,o,"previous").isAbleToNavigate,isNextEnabled:!!l&&!!o&&(0,n("djYcq").getNavigationInfo)(l,o,"next").isAbleToNavigate,resolutionMode:c}}},props:{decorations:e=>n("cyZvy").conflictResolutionPluginKey.getState(e)?.decorations}}),rT=(0,l.lazy)(async()=>({default:(await n("fEcUb")).ContentComponent})),rb=({api:t,config:o,editorView:r})=>{let a=(0,n("8C5kA").default)(),i=(0,l.useRef)(0);return(0,n("6qdjm").usePluginStateEffect)(t,["conflictResolutionUI"],({conflictResolutionUIState:e})=>{if(!(0,n("9wGTI").fg)("platform_editor_offline_editing_web_ga_fixes")||!o?.flags||!o?.contentId||!o?.spaceKey)return;let t=(e?.conflicts?.inserted?.length??0)+(e?.conflicts?.deleted?.length??0);i.current>0&&0===t&&ra(o.flags,a,o.contentId,o.spaceKey),i.current=t}),e(l).createElement(l.Suspense,{fallback:null},e(l).createElement(rT,{api:t,editorView:r}))},rN=({api:t,config:o})=>({name:"conflictResolutionUI",contentComponent:({editorView:n})=>n?e(l).createElement(rb,{api:t,config:o,editorView:n}):null,getSharedState:e=>{if(e)return{selected:n("cyZvy").conflictResolutionPluginKey.getState(e)?.selected,isNextEnabled:n("cyZvy").conflictResolutionPluginKey.getState(e)?.isNextEnabled??!0,isPreviousEnabled:n("cyZvy").conflictResolutionPluginKey.getState(e)?.isPreviousEnabled??!0,conflicts:n("cyZvy").conflictResolutionPluginKey.getState(e)?.conflicts,resolutionMode:n("cyZvy").conflictResolutionPluginKey.getState(e)?.resolutionMode??"viewing"}},commands:{navigateToFirstConflict:({tr:e})=>{let o=t?.conflictResolutionUI?.sharedState.currentState()?.conflicts;return o&&(o.inserted.length>0||o?.deleted.length>0)?(0,n("djYcq").navigateToAvailable)(void 0,e,o):null},startResolvingConflicts:({tr:e})=>{let o=t?.conflictResolutionUI?.sharedState.currentState()?.conflicts;if(!o||0===o.inserted.length&&0===o.deleted.length)return null;let r=e.setMeta(n("cyZvy").conflictResolutionPluginKey,{type:"startResolving"});return(0,n("djYcq").navigateToAvailable)(void 0,r,o)||r}},pmPlugins:()=>[{name:"conflictResolutionPlugin",plugin:rk}],usePluginHook:({editorView:o})=>{let r=(0,l.useRef)();(0,n("6qdjm").usePluginStateEffect)(t,["collabEdit"],({collabEditState:a})=>{let{lastReconnectionConflictMetadata:i}=a??{};i&&!e(rn)(r.current,i)&&((0,n("djYcq").setMetadata)(o,{type:"update",data:i},{api:t}),r.current=i)})}}),rv=()=>({name:"empty",getSharedState(e){if(e)return{editorIsEmpty:(0,n("2pjJ5").isEmptyDocument)(e.doc)}}}),rM=()=>({name:"ssr-plugin",pmPlugins:()=>[{name:"ssr-disable-transactions",plugin:()=>new(0,n("1S4f7").SafePlugin)({filterTransaction:()=>!0})}]}),rI=()=>({tr:e})=>{let t=(0,n("1gpr6").isValidTargetNode)(e.doc.firstChild)?new(0,n("adhil").GapCursorSelection)(e.doc.resolve(0)):n("ks2lK").Selection.atStart(e.doc);return e.setSelection(t),e},rw=()=>({tr:e})=>{let{paragraph:t,heading:o}=e.doc.type.schema.nodes,r=e.doc.firstChild;if(r&&[t,o].includes(r.type)&&!r.childCount)return rI()({tr:e});let a=e.doc.type.schema.nodes.paragraph.create();return e.insert(0,a),e.setSelection(n("ks2lK").TextSelection.near(e.doc.resolve(0))),e},rA=()=>({name:"pageTitleUtils",dependencies:[],commands:{selectDocStart:rI,insertNewLineAtDocStart:rw}});t.exports.createFullPageEditorPreset=function(e){let{intl:t,appearance:o,prevAppearance:r}=e;return(function(e){let{intl:t,providers:o,enabledOptionalPlugins:r}=e,a=e.pluginOptions;return new(0,n("bupcf").EditorPresetBuilder)().maybeAdd([ny,function({options:e}){return{showFlag:e.showFlag,contentId:e.contentId}}({options:a.limitedMode})],(0,nm.expValEquals)("cc_editor_limited_mode","isEnabled",!0)).add([n("l7rln").featureFlagsPlugin,function({}){return{lpLinkPicker:!0,tableDragAndDrop:!0,tableWithFixedColumnWidthsOption:!0,tableSelector:(0,eN.editorExperiment)("platform_editor_tables_table_selector",!0),macroInteractionUpdates:!0,moreElementsInQuickInsertView:!0,catchAllTracking:!1,showAvatarGroupAsPlugin:!1,errorBoundaryDocStructure:!1,synchronyErrorDocStructure:!1,enableViewUpdateSubscription:!1,collabAvatarScroll:!1,twoLineEditorToolbar:!1,disableSpellcheckByBrowser:void 0}}({options:a.featureFlags})]).add([n("jmHSv").analyticsPlugin,function({}){return{}}({options:a.analytics})]).add(n("55skd").betterTypeHistoryPlugin).add([nv.pastePlugin,function({providers:e}){return{cardOptions:{provider:e.cardProvider,allowBlockCards:!0,allowDatasource:!0,allowEmbeds:!0,resolveBeforeMacros:nH},sanitizePrivateContent:!0,isFullPage:!0}}({options:a.paste,providers:o})]).add(n("acwPl").default).add(n("jS0a0").focusPlugin).add(n("gyXPd").compositionPlugin).add([n("kbe7k").contextIdentifierPlugin,function({providers:e}){return{contextIdentifierProvider:e.contextIdentifierProvider}}({options:a.contextIdentifier,providers:o})]).add([n("fi7Vj").default,function({options:e}){return{allowInlineCursorTarget:!0,allowScrollGutter:!(0,n("dh538").fg)("confluence_frontend_content_wrapper")&&e.__livePage&&(0,n("dh538").fg)("confluence_frontend_comments_panel_v2")?void 0:{getScrollElement:()=>document.querySelector(".fabric-editor-popup-scroll-parent")}}}({options:a.base})]).maybeAdd([n("hEicH").userPreferencesPlugin,function({providers:e}){return{userPreferencesProvider:e.userPreferencesProviderNext,initialUserPreferences:void 0}}({providers:o})],r.userPreferences).add(n("4KTOl").decorationsPlugin).add([nD.typeAheadPlugin,function({}){return{isMobile:!1}}({options:a.typeAhead})]).add(n("HYzBP").default).add([n("itirX").primaryToolbarPlugin,function({options:e}){return{contextualFormattingEnabled:e.contextualFormattingEnabled}}({options:a.primaryToolbar})]).maybeAdd([n("3JBsx").toolbarPlugin,function({options:e}){return{contextualFormattingEnabled:e.contextualFormattingEnabled}}({options:a.toolbar})],!!r.toolbar).maybeAdd([t2,{getLinkPath:a.blockMenu?.getLinkPath,blockLinkHashPrefix:a.blockMenu?.blockLinkHashPrefix}],(0,nU.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)).add(nF.undoRedoPlugin).add([t9.blockTypePlugin,function({}){return{includeBlockQuoteAsTextstyleOption:!0,lastNodeMustBeParagraph:!1,isUndoRedoButtonsEnabled:!0,allowBlockType:void 0}}({options:a.blockType})]).add(n("kXH7i").clearMarksOnEmptyDocPlugin).add([nA.selectionToolbarPlugin,function({options:e,providers:t}){return{preferenceToolbarAboveSelection:!1,contextualFormattingEnabled:e.contextualFormattingEnabled,userPreferencesProvider:t.userPreferencesProvider}}({options:a.selectionToolbar,providers:o})]).add([nu.hyperlinkPlugin,function({options:e}){return{editorAppearance:e.editorAppearance,lpLinkPicker:!0,linkPicker:e.linkPicker,onClickCallback:e.onClickCallback,platform:"web"}}({options:a.hyperlink})]).add([nL.textFormattingPlugin,function({}){return{responsiveToolbarMenu:!0}}({options:a.textFormatting})]).add(n("fI6T7").widthPlugin).add([nM.quickInsertPlugin,function({options:e}){return{enableElementBrowser:!0,elementBrowserHelpUrl:"",disableDefaultItems:!1,headless:!1,emptyStateHandler:e?.emptyStateHandler,prioritySortingFn:"object"==typeof e.quickInsert?e.quickInsert.prioritySortingFn:void 0,onInsert:"object"==typeof e.quickInsert?e.quickInsert.onInsert:void 0}}({options:a.quickInsert})]).add([n("kYgUn").placeholderPlugin,function({intl:e,options:t}){let o=t.isAIEnabled&&(0,n("dh538").fg)("platform_editor_ai_aifc_streaming");return{placeholder:(()=>{if("view"!==t.viewMode&&!(o&&(0,n("dh538").fg)("platform_editor_ai_aifc_patch_ga")))return o&&!(0,n("dh538").fg)("platform_editor_ai_aifc_patch_ga")?e.formatMessage(nJ.editorEmptyDocumentSpaceShortcutPlaceholder):!t.isAIEnabled&&(0,eN.editorExperiment)("platform_editor_ai_quickstart_command",!0)?e.formatMessage(nJ.editorEmptyDocumentPlaceholderAI):(0,eN.editorExperiment)("platform_editor_controls","variant1")?e.formatMessage(nJ.defaultPlaceholder):t.isAIEnabled?e.formatMessage(nJ.easyMentionsPlaceholder):e.formatMessage(nJ.aiPlaceholder)})(),placeholderADF:(()=>{if("view"!==t.viewMode&&o&&(0,n("dh538").fg)("platform_editor_ai_aifc_space_shortcut"))return(0,n("dh538").fg)("platform_editor_ai_aifc_adf_placeholder")?nY(e.formatMessage(nJ.placeholderADF)):n$(e)})(),withEmptyParagraph:(0,n("dh538").fg)("platform_editor_ai_aifc_streaming")}}({intl:t,options:a.placeholder})]).add(n("vxKdN").unsupportedContentPlugin).add([n("lgjGE").editorDisabledPlugin,function({options:e}){return{initialDisabledState:e?.disabled}}({options:a.editorDisabled})]).add([n("6borH").submitEditorPlugin,function({}){}({options:a.submitEditor})]).add(n("kIhx9").copyButtonPlugin).maybeAdd(nl.floatingToolbarPlugin,r.floatingToolbar??!0).maybeAdd(n("6AqNX").interactionPlugin,!!r.interaction).add([n("bULcr").selectionPlugin,function({options:e}){return{useLongPressSelection:!1,__livePage:e.__livePage}}({options:a.selection})]).add([t4.default,function({}){return{allowCopyToClipboard:!0,useLongPressSelection:!1,allowCompositionInputOverride:!1}}({options:a.codeBlock})]).add(n("bz4KD").ufoPlugin).add(n("2nH2Y").dataConsumerPlugin).add(n("3ihIB").accessibilityUtilsPlugin).add(n("2yr9J").contentInsertionPlugin).add(n("fPXRH").batchAttributeUpdatesPlugin).add([t3.breakoutPlugin,function({options:e}){return{allowBreakoutButton:"full-page"===e.editorAppearance,appearance:e.editorAppearance}}({options:a.breakout})]).add(I.alignmentPlugin).add([nR.textColorPlugin,function({}){return!0}({options:a.textColor})]).add(n_.listPlugin).add(nI.rulePlugin).add([na.expandPlugin,function({options:e}){return{allowInsertion:!0,useLongPressSelection:!1,appearance:e.editorAppearance,allowInteractiveExpand:!0,__livePage:e.__livePage}}({options:a.expand})]).add(n("fCLXZ").guidelinePlugin).add([n("fYKTL").gridPlugin,function({}){return{shouldCalcBreakoutGridLines:!0}}({options:a.grid})]).add([n("cpn0f").annotationPlugin,function({options:e,providers:t}){if(t.inlineCommentAnnotationProvider)return{inlineComment:t.inlineCommentAnnotationProvider,createCommentExperience:e.createCommentExperience,selectCommentExperience:{selectAnnotation:{complete:t=>{e.selectCommentExperience?.selectAnnotation.complete({pageClass:"editor",annotationId:t,entryPoint:"annotation-change"})}}},viewInlineCommentTraceUFOPress:e.viewInlineCommentTraceUFOPress,annotationManager:e.annotationManager}}({options:a.annotation,providers:o})]).add([nk.mediaPlugin,function({intl:e,options:t,providers:n}){return{provider:n.mediaProvider,syncProvider:n.syncMediaProvider,allowMediaSingle:!0,allowResizing:!0,allowResizingInTables:!0,allowLinking:!0,allowAltTextOnImages:!0,allowCaptions:!0,allowMediaInlineImages:!0,allowPixelResizing:!0,altTextValidator:t=>RegExp("^([\\p{L}\\p{N},'\\.\\s\\-_\\(\\)]|&amp;[0-9]{2};)*$","u").test(t)?[]:[e.formatMessage(nV.invalidAltText)],featureFlags:{mediaInline:!0},allowLazyLoading:!0,allowBreakoutSnapPoints:!0,allowAdvancedToolBarOptions:!0,allowCommentsOnMedia:!0,allowDropzoneDropLine:!0,allowMediaSingleEditable:!0,allowRemoteDimensionsFetch:!0,allowMarkingUploadsAsIncomplete:!1,allowImagePreview:!0,fullWidthEnabled:"full-width"===t.editorAppearance,editorAppearance:t.editorAppearance,isCopyPasteEnabled:!0,alignLeftOnInsert:!1,waitForMediaUpload:!0}}({intl:t,options:a.media,providers:o})]).add(nT.mediaInsertPlugin).add(n("duFi2").default).add([nb.mentionsPlugin,function({options:e,providers:t}){return{sanitizePrivateContent:!0,insertDisplayName:!0,allowZeroWidthSpaceAfter:!0,profilecardProvider:t.profilecardProvider,handleMentionsChanged:e.handleMentionsChanged,mentionProvider:t.mentionProvider}}({options:a.mentions,providers:o})]).add([nr.emojiPlugin,function({providers:e}){return{emojiProvider:e.emojiProvider,emojiNodeDataProvider:e.emojiNodeDataProvider}}({options:a.emoji,providers:o})]).add([nP.default,function({options:e}){return{tableOptions:{allowTableResizing:!0,allowTableAlignment:!0,allowBackgroundColor:!0,allowColumnResizing:!0,allowColumnSorting:!0,allowDistributeColumns:!0,allowHeaderColumn:!0,allowHeaderRow:!0,allowMergeCells:!0,allowNumberColumn:!0,allowNestedTables:!0,allowControls:!0,stickyHeaders:!0,allowAddColumnWithCustomStep:!1},dragAndDropEnabled:!0,isTableScalingEnabled:!0,allowContextualMenu:!0,fullWidthEnabled:"full-width"===e.editorAppearance,maxWidthEnabled:"max"===e.editorAppearance,wasFullWidthEnabled:e.prevEditorAppearance&&"full-width"===e.prevEditorAppearance,getEditorFeatureFlags:()=>({tableWithFixedColumnWidthsOption:!0,tableSelector:(0,eN.editorExperiment)("platform_editor_tables_table_selector",!0)}),isCommentEditor:!1,isChromelessEditor:!1}}({options:a.table})]).add([nx.tasksAndDecisionsPlugin,function({options:e,providers:t}){return{allowNestedTasks:!0,consumeTabs:!0,useLongPressSelection:!1,taskDecisionProvider:t.taskDecisionProvider,hasEditPermission:e.hasEditPermission,requestToEditContent:e.requestToEditContent,hasRequestedEditPermission:e.hasRequestedEditPermission,allowBlockTaskItem:!0}}({options:a.tasksAndDecisions,providers:o})]).add([nc.helpDialogPlugin,function({options:e}){return!!(0,eN.editorExperiment)("platform_editor_ai_quickstart_command",!0)&&e}({options:{imageUploadProviderExists:!1,aiEnabled:r.aiExperience}})]).add([n("5AZDw").collabEditPlugin,function({options:e,providers:t}){return{provider:t.collabEditProvider,userId:e.collabEdit?.userId,useNativePlugin:e.collabEdit?.useNativePlugin,sanitizePrivateContent:!0,hideTelecursorOnLoad:e.__livePage||(0,nm.expValEquals)("platform_editor_no_cursor_on_edit_page_init","isEnabled",!0),inviteToEditHandler:e.collabEdit?.inviteToEditHandler,isInviteToEditButtonSelected:e.collabEdit?.isInviteToEditButtonSelected,inviteToEditComponent:e.collabEdit?.inviteToEditComponent,EXPERIMENTAL_allowInternalErrorAnalytics:e.collabEdit?.EXPERIMENTAL_allowInternalErrorAnalytics??(0,n("NPJKR").shouldForceTracking)()}}({options:a.collabEdit,providers:o})]).add([nN.default,function({}){return{useLongPressSelection:!1,allowCustomPanel:!0,allowCustomPanelEdit:!0}}({options:a.panel})]).add([n("1nZXu").contextPanelPlugin,function({options:e}){if(e)return(0,n("dh538").fg)("confluence_frontend_content_wrapper")&&(0,n("dh538").fg)("platform_editor_ai_object_sidebar_injection")?{objectSideBar:e.objectSideBar}:void 0}({options:a.contextPanel})]).add([ni.extensionPlugin,function({options:e}){return{breakoutEnabled:"full-page"===e.editorAppearance,extensionHandlers:e.extensionHandlers,useLongPressSelection:!1,appearance:e.editorAppearance,__rendererExtensionOptions:e.__rendererExtensionOptions,getExtensionHeight:e.getExtensionHeight}}({options:a.extension})]).add([t8.default,function({}){return{weekStartDay:void 0}}({options:a.date})]).add([n("8HLyI").default,function({}){return{}}({options:a.placeholderText})]).add([nf.layoutPlugin,function({options:e}){return{allowBreakout:!0,UNSAFE_addSidebarLayouts:!0,useLongPressSelection:!1,UNSAFE_allowSingleColumnLayout:void 0,editorAppearance:e.editorAppearance}}({options:a.layout})]).add([t6.cardPlugin,function({options:e,providers:t}){return{allowDatasource:!0,provider:t.cardProvider,resolveBeforeMacros:nK,allowBlockCards:!0,allowEmbeds:!0,onClickCallback:e.onClickCallback,fullWidthMode:"full-width"===e.editorAppearance,linkPicker:e.linkPicker,lpLinkPicker:!0,editorAppearance:e.editorAppearance,__livePage:e.__livePage,isPageSSRed:!!((0,n("eTj7Y").isSSR)()||window.__SSR_RENDERED__),CompetitorPrompt:e.CompetitorPrompt}}({options:a.card,providers:o})]).add([n("bS1lJ").customAutoformatPlugin,function({providers:e}){return{autoformattingProvider:e.autoformattingProvider}}({options:a.customAutoformat,providers:o})]).add([nC.statusPlugin,function({}){return{menuDisabled:!1,allowZeroWidthSpaceAfter:!0}}({options:a.status})]).maybeAdd([nO.syncedBlockPlugin,function({options:e}){if(!e)return;let{syncedBlockRenderer:t,syncBlockDataProvider:n}=e;return{syncedBlockRenderer:t,syncBlockDataProvider:n}}({options:a.syncedBlock})],!!a.syncedBlock&&(0,eN.editorExperiment)("platform_synced_block",!0)).add(n("aUwPP").indentationPlugin).add(n("1GAIu").scrollIntoViewPlugin).add([nB.toolbarListsIndentationPlugin,function({}){return{showIndentationButtons:!0,allowHeadingAndParagraphIndentation:!0}}({options:a.toolbarListsIndentation})]).add([np.insertBlockPlugin,function({options:e}){return{allowTables:!0,allowExpand:!0,horizontalRuleEnabled:!0,tableSelectorSupported:(0,eN.editorExperiment)("platform_editor_tables_table_selector",!0),nativeStatusSupported:!0,showElementBrowserLink:!0,appearance:e.editorAppearance,toolbarButtons:e.toolbarButtons}}({options:a.insertBlock})]).add([w.avatarGroupPlugin,function({options:e}){return{collabEdit:e.collabEdit,takeFullWidth:!0,showAvatarGroup:!1}}({options:a.avatarGroup})]).maybeAdd([ns.findReplacePlugin,function({}){return{takeFullWidth:!0,twoLineEditorToolbar:!1}}({options:a.findReplace})],r.findReplace).add(n("hSJYu").borderPlugin).add(n("6q6xk").fragmentPlugin).add(n("59fTa").pasteOptionsToolbarPlugin).maybeAdd([n("01uqX").codeBidiWarningPlugin,function({options:e}){return{appearance:e.editorAppearance}}({options:a.codeBidiWarning})],!(0,nm.expValEquals)("platform_editor_remove_bidi_char_warning","isEnabled",!0)).maybeAdd([nG.referentialityPlugin,r.referentiality?function({options:e}){return{api:e.referentialityContext.api??void 0,appearance:e.referentialityContext.options.appearance,extensionHandlers:e.referentialityContext.options.extensionHandlers,externalObservers:e.referentialityContext.options.externalObservers,nodeNameCallback:e.referentialityContext.options.nodeNameCallback,nodeFocusCallback:e.referentialityContext.options.nodeFocusCallback,editorAnalyticsAPI:e.referentialityContext.options.editorAnalyticsAPI,editorView:e.referentialityContext.options.editorView,featureFlags:e.referentialityContext.options.featureFlags,__livePage:e.referentialityContext.options.__livePage,__rendererExtensionOptions:e.referentialityContext.options.__rendererExtensionOptions,getExtensionHeight:e.referentialityContext.options.getExtensionHeight}}({options:a.referentiality}):void 0],r.referentiality).maybeAdd([nS.loomPlugin,function({options:e}){return{renderButton:e.renderButton,shouldShowToolbarButton:!(0,n("dh538").fg)("confluence_frontend_content_wrapper")&&void 0}}({options:a.loom})],r.loom).add([n("3mcWz").editorViewModePlugin,function({options:e}){return{mode:e.viewMode}}({options:a.editorViewMode})]).add(no).maybeAdd([n("1ewUw").aiDefinitionsPlugin,function({options:e}){return e}({options:a.aiDefinitions})],r.aiDefinitions).maybeAdd([nq.aiPlugin,function({options:e}){return e}({options:a.ai})],r.aiExperience).maybeAdd([nj.aiProactivePlugin,function({options:e}){return e}({options:a.aiProactive})],r.aiProactive).add([n("5Qu3R").selectionMarkerPlugin,function({options:e}){return{hideCursorOnInit:e.__livePage||(0,nm.expValEquals)("platform_editor_no_cursor_on_edit_page_init","isEnabled",!0)}}({options:a.selectionMarker})]).add(n("2E0F0").blockControlsPlugin).add(nd.highlightPlugin).add([n("8ABVP").engagementPlatformPlugin,function({options:e}){return{epComponents:{EngagementSpotlight:n("iPfZG").EngagementSpotlight,EngagementInlineDialog:n("kkQZq").default,Coordination:n("axAnW").default},epHooks:{useCoordination:n("hwWwS").useCoordination},coordinationClient:e.coordinationClient}}({options:a.engagementPlatform})]).maybeAdd(n("5y9PZ").connectivityPlugin,r.connectivity).maybeAdd(n("kcvNv").ncsStepMetricsPlugin,r.ncsStepMetrics&&!(0,nm.expValEquals)("platform_editor_remove_ncsstepmetrics_plugin","isEnabled",!0)).maybeAdd([n("dH9DB").metricsPlugin,function({options:e}){return e}({options:a.metrics})],r.metrics).maybeAdd([n("jgFdO").codeBlockAdvancedPlugin,function({}){return{allowCodeFolding:(0,nm.expValEquals)("platform_editor_code_block_fold_gutter","isEnabled",!0)}}({options:a.codeBlockAdvanced})],r.codeBlockAdvanced).maybeAdd([nw.selectionExtensionPlugin,function({options:e}){return e}({options:a.selectionExtension})],r.selectionExtension).add(n("3O0YV").userIntentPlugin).maybeAdd([n("84Iqc").showDiffPlugin,function({options:e}){if(e?.originalDoc&&e?.steps)return{originalDoc:e.originalDoc,steps:e.steps,colourScheme:e.colourScheme}}({options:a.showDiff})],r.showDiff).maybeAdd([n("aB4bz").trackChangesPlugin,function({options:e}){return{ButtonWrapper:e?.ButtonWrapper,showOnToolbar:(0,n("dh538").fg)("platform_editor_toolbar_aifc_undo_redo_confluence")}}({options:a.trackChanges})],r.trackChanges).maybeAdd(n("lQotL").localIdPlugin,r.localId).maybeAdd(n("dF1N1").aiStreamingOrchestratorPlugin,(0,n("dh538").fg)("platform_editor_ai_aifc_streaming"))})({intl:t,pluginOptions:{base:{__livePage:e.__livePage},helpDialog:{imageUploadProviderExists:!1,aiEnabled:e.isAIEnabledForContent??!1},hyperlink:{editorAppearance:o,linkPicker:e.linking?.linkPicker,onClickCallback:e.linking?.smartLinks?.onClickCallback},quickInsert:{emptyStateHandler:e.elementBrowser?.emptyStateHandler,quickInsert:e.quickInsert},placeholder:{viewMode:e.viewMode,isAIEnabled:e.isAIEnabledForContent??!1},selection:{__livePage:e.__livePage},editorDisabled:{disabled:e.disabled},breakout:{editorAppearance:o},expand:{editorAppearance:o,__livePage:e.__livePage},annotation:{annotationManager:e.annotationProviders?.annotationManager,createCommentExperience:n("3YBks").createInlineCommentCompoundExperience,selectCommentExperience:n("4EKKB").selectInlineCommentCompoundExperience,viewInlineCommentTraceUFOPress:()=>(0,n("4TXTZ").default)("view-inline-comment-action")},media:{editorAppearance:o},mentions:{handleMentionsChanged:e.handleMentionsChanged},table:{editorAppearance:o,prevEditorAppearance:r},tasksAndDecisions:{hasEditPermission:e.hasEditPermission,requestToEditContent:e.requestToEditContent,hasRequestedEditPermission:e.hasRequestedEditPermission},collabEdit:{collabEdit:e.collabEdit,__livePage:e.__livePage},contextPanel:e.contextPanelOptions?{objectSideBar:e.contextPanelOptions.objectSideBar}:void 0,extension:{extensionHandlers:e.extensionHandlers,editorAppearance:o,__rendererExtensionOptions:e.__rendererExtensionOptions,getExtensionHeight:e.getExtensionHeight},layout:{editorAppearance:o},card:{editorAppearance:o,linkPicker:e.linking?.linkPicker,onClickCallback:e.linking?.smartLinks?.onClickCallback,__livePage:e.__livePage,CompetitorPrompt:e.isEligibleCreateNewWhiteboard?n("bODUD").PromptPopupContainer:void 0},insertBlock:{editorAppearance:o,toolbarButtons:(0,n("9wGTI").fg)("platform_editor_toolbar_aifc_undo_redo_confluence")?{emoji:{enabled:!0,showAt:"lg"},insert:{enabled:!0,showAt:"lg"},layout:{enabled:!0,showAt:"lg"},media:{enabled:!0,showAt:"lg"},mention:{enabled:!0,showAt:"lg"},table:{enabled:!0,showAt:"md"},taskList:{enabled:!0,showAt:"lg"}}:void 0},avatarGroup:{collabEdit:e.collabEdit},codeBidiWarning:{editorAppearance:o},referentiality:{referentialityContext:e.referentialityContext},ai:e.editorPluginAIOptions,loom:{renderButton:e.loomPluginOptions.renderButton},editorViewMode:{viewMode:e.viewMode},aiDefinitions:e.editorPluginAIDefinitionsConfig,aiProactive:e.editorPluginAIProactiveConfig,selectionMarker:{__livePage:e.__livePage??!1},engagementPlatform:{coordinationClient:e.editorEngagementPlatformPluginConfig.coordinationClient},selectionExtension:(0,n("9wGTI").fg)("platform_editor_controls_selection_extension")?e.selectionExtensionPluginOptions:{},metrics:(0,n("6mKj3").expValEquals)("platform_editor_controls","cohort","variant1")?{userPreferencesProvider:e.userPreferencesProvider}:void 0,primaryToolbar:{contextualFormattingEnabled:e.contextualFormattingEnabled},selectionToolbar:{contextualFormattingEnabled:e.contextualFormattingEnabled},blockMenu:{getLinkPath:e.getHeadingLinkPath,blockLinkHashPrefix:e.blockLinkHashPrefix},showDiff:e.showDiffPluginParams,syncedBlock:e.syncedBlockProvider&&(0,n("6mKj3").expValEquals)("platform_synced_block","isEnabled",!0)?{syncedBlockRenderer:u({syncBlockRendererOptions:void 0}),syncBlockDataProvider:e.syncedBlockProvider}:void 0,limitedMode:e.limitedModePluginOptions||{},toolbar:{contextualFormattingEnabled:(0,n("9wGTI").fg)("platform_editor_toolbar_aifc_placement_config")?"controlled":void 0},trackChanges:{ButtonWrapper:e.trackChangesPluginOptions?.ButtonWrapper}},providers:{userPreferencesProvider:e.userPreferencesProvider,userPreferencesProviderNext:e.userPreferencesProviderNext,cardProvider:e.linking?.smartLinks?.provider,contextIdentifierProvider:e.contextIdentifierProvider,inlineCommentAnnotationProvider:e.annotationProviders?.inlineComment,mediaProvider:e.media?.provider,syncMediaProvider:e.media?.syncProvider,mentionProvider:e.mentionProvider,profilecardProvider:e.mention?.profilecardProvider,emojiProvider:e.emojiProvider,emojiNodeDataProvider:e.emojiNodeDataProvider,collabEditProvider:e.collabEdit?.provider,autoformattingProvider:e.autoformattingProvider,taskDecisionProvider:e.taskDecisionProvider},enabledOptionalPlugins:{limitedMode:!1,findReplace:!!e.allowFindReplace,referentiality:!!e.referentialityContext.plugin,loom:e.isLoomPluginEnabled,aiDefinitions:!!(0,n("9wGTI").fg)("confluence_ai_access_policy")||e.editorPluginAIDefinitionsEnabled,aiProactive:e.editorPluginAIProactiveEnabled,connectivity:e.isDesktop||(0,n("6mKj3").expVal)("platform_editor_offline_editing_web","isEnabled",!1),metrics:(0,n("9wGTI").fg)("platform_editor_ease_of_use_metrics"),ncsStepMetrics:!0,codeBlockAdvanced:!0,selectionExtension:(0,n("6mKj3").expValEquals)("platform_editor_controls","cohort","variant1"),aiExperience:"disabled"!==e.editorPluginAIOptions.aiGlobalOptIn.status,interaction:!!e?.__livePage||(0,n("6mKj3").expValEquals)("platform_editor_no_cursor_on_edit_page_init","isEnabled",!0),userPreferences:(0,n("9wGTI").fg)("platform_editor_use_preferences_plugin"),trackChanges:(0,n("9wGTI").fg)("platform_editor_ai_aifc_streaming"),showDiff:!!e?.showDiffPluginParams||(0,n("9wGTI").fg)("platform_editor_ai_aifc_streaming"),toolbar:!e?.disableToolbar&&((0,n("9wGTI").fg)("platform_editor_ai_aifc_streaming")||"enabled"!==e.editorPluginAIOptions.aiGlobalOptIn.status&&(0,n("6mKj3").expValEquals)("platform_editor_toolbar_aifc_confluence","isEnabled",!0)),blockMenu:(0,n("6mKj3").expValEquals)("platform_editor_block_menu","isEnabled",!0),localId:(0,n("9wGTI").fg)("platform_editor_adf_with_localid"),aiStreamingOrchestrator:(0,n("9wGTI").fg)("platform_editor_ai_aifc_streaming"),syncedBlock:(0,n("6mKj3").expValEquals)("platform_synced_block","isEnabled",!0),floatingToolbar:!e?.disableFloatingToolbar,codeBidiWarning:!(0,n("6mKj3").expValEquals)("platform_editor_remove_bidi_char_warning","isEnabled",!0)}}).add(rM).add([rt,{getHeadingLinkPath:e.getHeadingLinkPath}]).add(rA).add(oi).add(n("dMGoR").forgeEditorPlugin).maybeAdd([o1,{flags:e.flags}],e.isDesktop||(0,n("6mKj3").expVal)("platform_editor_offline_editing_web","isEnabled",!1)).maybeAdd([rN,{flags:e.flags,contentId:e.contentId,spaceKey:e.spaceKey}],e.isDesktop||(0,n("6mKj3").expVal)("platform_editor_offline_editing_web","isEnabled",!1)).add(rv).add(n("iHrpD").legacyContentMacroPlugin).maybeAdd(M,e.isCompanyHub)}}),o("djYcq",function(t,o){var r=n("kyKWe");let a=e=>t=>e?.attachAnalyticsEvent(t),i=(e,t,n)=>{let o=[...e?.inserted??[],...e?.deleted??[]].sort((e,t)=>e.from-t.from);if(!t)return{isAbleToNavigate:!0,newConflict:o.length>0?o[0]:void 0};let r=o.findIndex(e=>e.id===t.id);if("next"===n){let e=r<o.length-1;return{isAbleToNavigate:e,newConflict:e?o[r+1]:void 0}}{let e=r>0;return{isAbleToNavigate:e,newConflict:e?o[r-1]:void 0}}},s=(e,t)=>{let n=t.deleted.find(t=>t.id===e.id)?"deleted":"inserted";return{...e,type:n}},l=(e,t,o)=>{let{isAbleToNavigate:r,newConflict:a}=i(o,e.data,e.direction);return r&&a?t.setSelection(n("ks2lK").TextSelection.create(t.doc,a.from,a.to)).setMeta("nextConflict",s(a,o)).scrollIntoView():null},c=(e,t,n)=>l({type:"navigate",direction:"next",data:e},t,n)??l({type:"navigate",direction:"previous",data:e},t,n);t.exports.getNewConflicts=(t,n)=>{if(t)switch(t.type){case"navigate":case"startResolving":case"stopResolving":return n;case"update":return{inserted:t.data.inserted.map(t=>({...t,id:e(r)()})),deleted:t.data.deleted.map(t=>({...t,id:e(r)()}))};case"resolve":case"restore":if(!n)return n;return{inserted:n.inserted.filter(e=>e.id!==t.data.id),deleted:n.deleted.filter(e=>e.id!==t.data.id)};case"resolveAll":return{inserted:[],deleted:[]};default:return}},t.exports.getNavigationInfo=i,t.exports.navigateToAvailable=c,t.exports.setMetadata=(e,t,o)=>{let{dispatch:r,state:{tr:i}}=e;if("navigate"===t.type){let o=n("cyZvy").conflictResolutionPluginKey.getState(e.state);o?.conflicts&&l(t,i,o?.conflicts)}else if("restore"===t.type)i.replace(t.data.from,t.data.to,t.data.local);else if("update"===t.type)a(o?.api?.analytics?.actions)({actionSubject:n("d925B").ACTION_SUBJECT.EDITOR,attributes:{inserted:t.data.inserted.length,deleted:t.data.deleted.length},eventType:n("d925B").EVENT_TYPE.TRACK,action:"offlineReconnectionConflict"})?.(i);else if("resolve"===t.type){let o=n("cyZvy").conflictResolutionPluginKey.getState(e.state);o?.conflicts&&c(t.data,i,o?.conflicts)}r(i.setMeta(n("cyZvy").conflictResolutionPluginKey,t))}}),o("fEcUb",function(e,t){e.exports=n("4mJKd")(5)("4LYSa").then(()=>n("50nRh"))}),o("4mJKd",function(e,t){e.exports=e=>t=>import(n("8tirZ").shardUrl(n("02nRr").resolve(t),e))}),o("8tirZ",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.applyShardToDomain=i,e.exports.domainShardingKey=void 0,e.exports.getDomainShardIndex=o,e.exports.shardUrl=function(e,t){return globalThis[n]?s(e,t):e},e.exports.shardUrlUnchecked=s;let n="__ATLASPACK_ENABLE_DOMAIN_SHARDS";function o(e,t){let n=t+1,o=e.split("").reduce((e,t)=>{let o=(e<<n)-e+t.charCodeAt(0);return o&o},0);return(o%=n)<0&&(o+=n),o}let r=/-\d+$/;function a(e){if(!r.test(e))return e;let t=e.lastIndexOf("-");return e.slice(0,t)}function i(e,t){let n=e.indexOf("."),o=0===t?"":`-${t-1}`;if(-1===n)return`${a(e)}${o}`;let r=a(e.slice(0,n));return`${r}${o}${e.slice(n)}`}function s(e,t){let n=new URL(e),r=o(function(e){let t=e.lastIndexOf("/");if(-1===t||t===e.length-1)throw Error("Expected an absolute URL with a file name, unable to apply sharding.");return e.slice(t+1)}(n.pathname),t);return n.hostname=i(n.hostname,r),n.toString()}e.exports.domainShardingKey=n}),o("02nRr",function(e,n){t(e.exports,"register",()=>o,e=>o=e),t(e.exports,"resolve",()=>r,e=>r=e);var o,r,a=new Map;o=function(e,t){for(var n=0;n<t.length-1;n+=2)a.set(t[n],{baseUrl:e,path:t[n+1]})},r=function(e){var t=a.get(e);if(null==t)throw Error("Could not resolve bundle with id "+e);return new URL(t.path,t.baseUrl).toString()}}),o("cyZvy",function(e,t){let o=new(0,n("ks2lK").PluginKey)("conflictResolutionPluginKey");e.exports.conflictResolutionPluginKey=o});
//# sourceMappingURL=FullPageEditorComponent.18cd9bf7.js.map
