function e(e){return e&&e.__esModule?e.default:e}var t=globalThis.parcelRequired477,n=t.register;n("cZa7r",function(n,r){var o=t("9HkI0"),E=t("42omo");let a=(0,E.createContext)({selectionProps:null,hoverProps:null,viewProps:null,editorCreateProps:null,editorViewProps:null,showCreateComponent:!1,showHighlightActions:!1,selectionOptions:void 0,stepGenerationError:!1,newlyCreatedAnnotationId:void 0,isOffline:!1,storedCommentData:null});a.displayName="AnnotationsContext";let i=(0,E.createContext)(!1);i.displayName="AnnotationsOfflineContext";let s=({children:n,value:r})=>(0,t("6mKj3").expVal)("platform_editor_offline_editing_web","isEnabled",!1)?e(E).createElement(i.Provider,{value:r},n):e(E).createElement(e(E).Fragment,null,n),I=(0,E.createContext)({setSelectionProps:()=>{},setHoverProps:()=>{},setViewProps:()=>{},setEditorCreateProps:()=>{},setEditorViewProps:()=>{},setShowCreateComponent:()=>{},setShowHighlightActions:()=>{},setSelectionOptions:()=>{},setStepGenerationError:()=>{},setSelectionOptionsForCreateEditor:()=>{},setNewlyCreatedAnnotationId:()=>{},handleSaveSuccess:()=>{},handleClose:()=>{},setIsOffline:()=>{},setStoredCommentData:()=>{},clearStoredCommentData:()=>{}});I.displayName="AnnotationDispatchContext";let l=(0,E.createContext)(void 0);l.displayName="AnnotationManagerContext",n.exports.AnnotationsProvider=({children:n})=>{let[r,i]=(0,E.useState)(null),[c,_]=(0,E.useState)(null),[T,N]=(0,E.useState)(null),[u,C]=(0,E.useState)(null),[p,d]=(0,E.useState)(null),[m,A]=(0,E.useState)(!1),[M,R]=(0,E.useState)(!1),[f,O]=(0,E.useState)(),[g,P]=(0,E.useState)(!1),[S,D]=(0,E.useState)(),[L,b]=(0,E.useState)(null),[h]=(0,t("ep3mz").usePageContentId)(),x=(0,t("9QIM2").usePageClass)(),v=(0,E.useMemo)(()=>(0,t("9wGTI").fg)("platform_editor_comments_api_manager")?(0,t("cVw8q").createAnnotationManager)():void 0,[]),[V,F]=(0,E.useState)(!1),[X,y]=(0,E.useState)(null),k=(0,t("8WQTF").useRendererActions)(),w=k?.rendererActions;(0,E.useEffect)(()=>{let e=(0,t("gczDe").getRendererAnnotationEventEmitter)();function n({annotationId:e}){if(!e)return void t("4EKKB").selectInlineComment.debug("Renderer emitted event indicating no focused annotation.");t("4EKKB").selectInlineCommentCompoundExperience.selectAnnotation.complete({pageClass:x,entryPoint:"unknown:RendererFocus",annotationId:e})}return e.on(t("21K7m").AnnotationUpdateEvent.SET_ANNOTATION_FOCUS,n),()=>{e.off(t("21K7m").AnnotationUpdateEvent.SET_ANNOTATION_FOCUS,n)}},[x]);let G=(0,E.useCallback)(()=>{i(null),_(null),N(null),C(null),d(null),A(!1),R(!1),O(void 0),P(!1),D(void 0),y(null)},[]);(0,E.useEffect)(()=>{h&&(L&&h!==L&&G(),b(h))},[h]);let H=(0,E.useCallback)(()=>{A(!1),P(!1),O(void 0),v?v.clearDraft():r&&r.onClose(),i(null)},[A,P,O,r,v]),B=(0,E.useCallback)(({experienceAttributes:n}={})=>{let E;A(!1);let a=e(o)(),i="renderer"===x?"renderer":"editor";if(t("3YBks").createInlineCommentCompoundExperience.start({attributes:{pageClass:(0,t("9wGTI").fg)("confluence_fe_create_inline_comment_exp_coverage")?i:"renderer",commentType:"inline",annotationId:a,...n??{}}}),t("3YBks").createInlineCommentCompoundExperience.initExperience.start(),v){let e=v.startDraft();e.success&&(E=e.actionResult)}else{if(!r){(0,t("gczDe").getRendererAnnotationEventEmitter)().emit(t("21K7m").AnnotationUpdateEvent.DESELECT_ANNOTATIONS),t("3YBks").createInlineCommentCompoundExperience.initExperience.softFail(Error("Attempted to create inline comment when no selection was present"));return}E=r.applyDraftMode({annotationId:a,keepNativeSelection:!1})}let s=E?.ancestorNodeTypes??[],I=[...s].sort();t("3YBks").createInlineCommentCompoundExperience.addCommonAttributes({inlineNodeTypes:E?.inlineNodeTypes??[],ancestorNodeTypes:s,alphabeticalAncestorNodeTypes:I,initialPosition:[E?.step?.from,E?.step?.to]}),E?(O({step:E.step,inlineNodeTypes:E.inlineNodeTypes,originalSelection:E.originalSelection,numMatches:E.numMatches,matchIndex:E.matchIndex,createdFrom:t("afGoD").CommentCreationLocation.RENDERER,pos:E.pos,targetNodeType:E.targetNodeType}),(0,t("gczDe").getRendererAnnotationEventEmitter)().emit(t("21K7m").AnnotationUpdateEvent.DESELECT_ANNOTATIONS),R(!1)):(P(!0),t("3YBks").createInlineCommentCompoundExperience.initExperience.fail(Error("Failed to generate step")))},[r,A,R,P,v,x]),U=(0,E.useCallback)((e,n)=>{P(!1),n&&y(n);let o=!1;if(v){let t=v.applyDraft(e);if(t.success&&t.actionResult?.doc)r.updateDocument&&r.updateDocument(t.actionResult.doc),D(e);else throw Error("Error ocurred when applying the step to the active document")}else if(w&&f?.step&&(0,t("9wGTI").fg)("confluence_frontend_comment_highlight_apply_fixes")){let n=f.step,o=f.pos?{to:f.pos,from:f.pos}:{to:n.to,from:n.from},E=w.applyAnnotation(o,{annotationId:e,annotationType:t("cUycv").AnnotationTypes.INLINE_COMMENT});if(E&&E.doc){let n=(0,t("gczDe").getRendererAnnotationEventEmitter)();X||r.removeDraftMode(),r.updateDocument&&r.updateDocument(E.doc),setTimeout(()=>{n.emit(t("21K7m").AnnotationUpdateEvent.ON_ANNOTATION_CLICK,{annotationIds:[e],eventTarget:document.getElementById(e)})&&(n.emit(t("21K7m").AnnotationUpdateEvent.SET_ANNOTATION_FOCUS,{annotationId:e}),D(e))},250)}else throw Error("Error ocurred when applying the step to the active document")}else if(o=r.onCreate(e)){let n=(0,t("gczDe").getRendererAnnotationEventEmitter)();X||r.removeDraftMode(),r.updateDocument&&r.updateDocument(o.doc),setTimeout(()=>{n.emit(t("21K7m").AnnotationUpdateEvent.ON_ANNOTATION_CLICK,{annotationIds:[e],eventTarget:document.getElementById(e)})&&(n.emit(t("21K7m").AnnotationUpdateEvent.SET_ANNOTATION_FOCUS,{annotationId:e}),D(e))},250)}else throw Error("Error ocurred when applying the step to the active document")},[v,P,D,r,y,X,w,f]),z=(0,E.useMemo)(()=>({selectionProps:r,hoverProps:c,viewProps:T,editorCreateProps:u,editorViewProps:p,showCreateComponent:m,showHighlightActions:M,selectionOptions:f,stepGenerationError:g,newlyCreatedAnnotationId:S,isOffline:V,storedCommentData:X}),[r,c,T,u,p,m,M,f,g,S,V,X]),K=(0,E.useMemo)(()=>({setSelectionProps:i,setHoverProps:_,setViewProps:N,setEditorCreateProps:C,setEditorViewProps:d,setShowCreateComponent:A,setShowHighlightActions:R,setSelectionOptions:O,setStepGenerationError:P,setSelectionOptionsForCreateEditor:B,setNewlyCreatedAnnotationId:D,handleSaveSuccess:U,handleClose:H,setIsOffline:F,setStoredCommentData:e=>y(e??null),clearStoredCommentData:()=>y(null)}),[i,_,N,C,d,A,R,O,P,B,D,U,H,F,y]);return e(E).createElement(l.Provider,{value:v},e(E).createElement(a.Provider,{value:z},e(E).createElement(I.Provider,{value:K},e(E).createElement(s,{value:V},n))))},n.exports.useAnnotations=()=>(0,E.useContext)(a),n.exports.useAnnotationsDispatch=()=>(0,E.useContext)(I),n.exports.useAnnotationManager=()=>(0,E.useContext)(l),n.exports.useAnnotationsIsOffline=()=>(0,E.useContext)(i)}),n("afGoD",function(e,t){var n,r,o,E,a=((n={}).DATABASE="DATABASE",n.EDITOR="EDITOR",n.LIVE="LIVE",n.RENDERER="RENDERER",n.WHITEBOARD="WHITEBOARD",n);(r={}).ATLAS_DOC_FORMAT="ATLAS_DOC_FORMAT",r.EDITOR="EDITOR",r.EDITOR2="EDITOR2",r.EXPORT_VIEW="EXPORT_VIEW",r.PLAIN="PLAIN",r.RAW="RAW",r.STORAGE="STORAGE",r.STYLED_VIEW="STYLED_VIEW",r.VIEW="VIEW",r.WIKI="WIKI",(o={}).ANDROID="ANDROID",o.IOS="IOS",o.WEB="WEB",(E={}).ANONYMOUS="ANONYMOUS",E.APP="APP",E.EXTERNAL="EXTERNAL",E.INTERNAL="INTERNAL",E.JSD="JSD",e.exports.CommentCreationLocation=a}),n("9QIM2",function(e,n){e.exports.usePageClass=function(){let e=(0,t("de2j9").useIsEditorPage)(),n=(0,t("3jwuS").useIsCurrentPageLive)(),r=(0,t("dPJCf").useRouteName)({selector:e=>e});if(e||n)return"editor";if("undefined"!=typeof document&&['[data-testid="TinyMCERendererTestId"]',".tinymce-editor"].some(e=>null!==document.querySelector(e)))return(0,t("9wGTI").fg)("confluence_frontend_fix_page_class_route_detection")?"tinyMCE":"not-page-or-doc";if((0,t("9wGTI").fg)("confluence_frontend_fix_page_class_route_detection")){if((0,t("gEtAQ").isDatabase)(r))return"database";if((0,t("gEtAQ").isWhiteboard)(r))return"whiteboard"}else if((0,t("gEtAQ").isDatabase)()||(0,t("gEtAQ").isWhiteboard)())return"not-page-or-doc";return"renderer"}}),n("3YBks",function(n,r){let o;var E=t("kyKWe");let a={},i=[],s=!1,I=0;function l(e){return function({error:n,createAnalyticsEvent:r,extraAttributes:o}){let E=(0,t("fGzMp").getExperienceTracker)().getExperienceState(t("irVI7").CREATE_INLINE_COMMENT_EXPERIENCE);r({type:"sendOperationalEvent",data:{action:"error",actionSubject:t("irVI7").CREATE_INLINE_COMMENT_EXPERIENCE,source:e,attributes:{...E,...a,...o,error:n.message||String(n),stack:n.stack}}}).fire()}}let c={start:function({attributes:n}){i=[t("irVI7").CREATE_INLINE_COMMENT_EXPERIENCE],a={},o=void 0,s=!1,I=0;let r=e(E)();(0,t("fGzMp").getExperienceTracker)().start({name:t("irVI7").CREATE_INLINE_COMMENT_EXPERIENCE,id:r,attributes:{...n,compoundTaskId:r,...(0,t("gtj7V").getCommentsDataManagerExperimentAttributes)()},collect:(e,n)=>{(0,t("1A7bE").collectAll)([t("irVI7").CREATE_INLINE_COMMENT_INIT_EXPERIENCE,t("irVI7").CREATE_INLINE_COMMENT_DRAFT_TO_PUBLISH_EXPERIENCE])(e,n)}}),a={compoundTaskId:r,annotationId:n.annotationId,pageClass:n.pageClass,entryPoint:n.entryPoint,...(0,t("gtj7V").getCommentsDataManagerExperimentAttributes)()}},debug:l(t("irVI7").CREATE_INLINE_COMMENT_EXPERIENCE),addCommonAttributes:e=>{let n=(0,t("fGzMp").getExperienceTracker)();for(let t of(a={...a,...e},i))n.updateAttributes({name:t,attributes:a})},attachCommonAttributes:e=>{(0,t("fGzMp").getExperienceTracker)().updateAttributes({name:e,attributes:a})},initExperience:{start:()=>{i.push(t("irVI7").CREATE_INLINE_COMMENT_INIT_EXPERIENCE),(0,t("fGzMp").getExperienceTracker)().start({name:t("irVI7").CREATE_INLINE_COMMENT_INIT_EXPERIENCE,timeout:5e3,attributes:{...a}}),c.attachCommonAttributes(t("irVI7").CREATE_INLINE_COMMENT_INIT_EXPERIENCE)},fail:e=>{(0,t("fGzMp").getExperienceTracker)().fail({name:t("irVI7").CREATE_INLINE_COMMENT_INIT_EXPERIENCE,error:e})},softFail:e=>{o||(o={error:e,pointOfFailure:"init"}),(0,t("fGzMp").getExperienceTracker)().succeed({name:t("irVI7").CREATE_INLINE_COMMENT_INIT_EXPERIENCE,attributes:{softFailure:e.message}})},abort:({abortReason:e})=>{(0,t("fGzMp").getExperienceTracker)().abort({name:t("irVI7").CREATE_INLINE_COMMENT_INIT_EXPERIENCE,reason:e})},complete:()=>{(0,t("fGzMp").getExperienceTracker)().succeed({name:t("irVI7").CREATE_INLINE_COMMENT_INIT_EXPERIENCE})},debug:l(t("irVI7").CREATE_INLINE_COMMENT_INIT_EXPERIENCE),debugPoint:(e,n)=>{(0,t("fGzMp").getExperienceTracker)().attachDebugPoint({name:t("irVI7").CREATE_INLINE_COMMENT_INIT_EXPERIENCE,message:e,attributes:n})}},draftToPublishExperience:{start:()=>{i.push(t("irVI7").CREATE_INLINE_COMMENT_DRAFT_TO_PUBLISH_EXPERIENCE),(0,t("fGzMp").getExperienceTracker)().start({name:t("irVI7").CREATE_INLINE_COMMENT_DRAFT_TO_PUBLISH_EXPERIENCE,attributes:a}),c.attachCommonAttributes(t("irVI7").CREATE_INLINE_COMMENT_DRAFT_TO_PUBLISH_EXPERIENCE)},publishFailed:e=>{s=!0,o||(o={error:e,pointOfFailure:"publish-failed"})},publishSucceeded:()=>{I+=1},abort:({abortReason:e})=>{(0,t("fGzMp").getExperienceTracker)().abort({name:t("irVI7").CREATE_INLINE_COMMENT_DRAFT_TO_PUBLISH_EXPERIENCE,reason:e})},fail:(e,n)=>{(0,t("fGzMp").getExperienceTracker)().fail({name:t("irVI7").CREATE_INLINE_COMMENT_DRAFT_TO_PUBLISH_EXPERIENCE,error:e,attributes:n})},stopOnError:(e,n)=>{(0,t("fGzMp").getExperienceTracker)().stopOnError({name:t("irVI7").CREATE_INLINE_COMMENT_DRAFT_TO_PUBLISH_EXPERIENCE,error:e,attributes:n})},dismissed:()=>{let e=(0,t("fGzMp").getExperienceTracker)();I>0?e.fail({name:t("irVI7").CREATE_INLINE_COMMENT_DRAFT_TO_PUBLISH_EXPERIENCE,error:Error("Draft comment dismissed after publish success")}):s?e.fail({name:t("irVI7").CREATE_INLINE_COMMENT_DRAFT_TO_PUBLISH_EXPERIENCE,error:Error("Draft comment dismissed after publish attempt")}):e.abort({name:t("irVI7").CREATE_INLINE_COMMENT_DRAFT_TO_PUBLISH_EXPERIENCE,reason:"Draft comment dismissed"})},softFail:e=>{let n=(0,t("fGzMp").getExperienceTracker)();o||(o={error:e,pointOfFailure:"multiple-saves-without-error"}),n.succeed({name:t("irVI7").CREATE_INLINE_COMMENT_DRAFT_TO_PUBLISH_EXPERIENCE,attributes:{softFailure:e.message}})},complete:()=>{let e=(0,t("fGzMp").getExperienceTracker)();if(o)return void e.succeed({name:t("irVI7").CREATE_INLINE_COMMENT_DRAFT_TO_PUBLISH_EXPERIENCE,attributes:{softFailure:o.error.message,pointOfFailure:o.pointOfFailure}});e.succeed({name:t("irVI7").CREATE_INLINE_COMMENT_DRAFT_TO_PUBLISH_EXPERIENCE})},debug:l(t("irVI7").CREATE_INLINE_COMMENT_DRAFT_TO_PUBLISH_EXPERIENCE),debugPoint:(e,n)=>{(0,t("fGzMp").getExperienceTracker)().attachDebugPoint({name:t("irVI7").CREATE_INLINE_COMMENT_DRAFT_TO_PUBLISH_EXPERIENCE,message:e,attributes:n})}},attachCommentExperience:{start:()=>{i.push(t("irVI7").CREATE_INLINE_COMMENT_ATTACH_COMMENT_EXPERIENCE),(0,t("fGzMp").getExperienceTracker)().start({name:t("irVI7").CREATE_INLINE_COMMENT_ATTACH_COMMENT_EXPERIENCE,timeout:6e3,attributes:a}),c.attachCommonAttributes(t("irVI7").CREATE_INLINE_COMMENT_ATTACH_COMMENT_EXPERIENCE)},fail:(e,n)=>{(0,t("fGzMp").getExperienceTracker)().fail({name:t("irVI7").CREATE_INLINE_COMMENT_ATTACH_COMMENT_EXPERIENCE,error:e,attributes:n})},complete:()=>{let e=(0,t("fGzMp").getExperienceTracker)();if(o)return void e.succeed({name:t("irVI7").CREATE_INLINE_COMMENT_ATTACH_COMMENT_EXPERIENCE,attributes:{softFailure:o.error.message,pointOfFailure:o.pointOfFailure}});e.succeed({name:t("irVI7").CREATE_INLINE_COMMENT_ATTACH_COMMENT_EXPERIENCE})},debug:l(t("irVI7").CREATE_INLINE_COMMENT_ATTACH_COMMENT_EXPERIENCE),debugPoint:(e,n)=>{(0,t("fGzMp").getExperienceTracker)().attachDebugPoint({name:t("irVI7").CREATE_INLINE_COMMENT_ATTACH_COMMENT_EXPERIENCE,message:e,attributes:n})}}};n.exports.createInlineCommentCompoundExperience=c});
//# sourceMappingURL=QuickReload.749d1374.js.map
