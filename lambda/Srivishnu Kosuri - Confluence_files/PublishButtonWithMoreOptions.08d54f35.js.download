function e(e){return e&&e.__esModule?e.default:e}var t=globalThis.parcelRequired477,a=t.register;a("8G6ap",function(a,i){let s={argumentDefinitions:[],kind:"Fragment",name:"usePublishModalActionsSchedulePublishInfoFragment",selections:[{concreteType:"SchedulePublishInfo",kind:"LinkedField",name:"schedulePublishInfo",plural:!1,selections:[{kind:"ScalarField",name:"date"},{kind:"ScalarField",name:"minorEdit"},{kind:"ScalarField",name:"targetType"},{kind:"ScalarField",name:"versionComment"},{kind:"ScalarField",name:"__typename"}]}],type:"Content"};s.hash="5dc641b473052bf1fb2921bbc4960dcc";var n=t("42omo"),r=t("3Vbz9"),o=t("9xGvk");let l=({flags:a,attributes:i,customFlagMessage:s})=>{a&&a.showErrorFlag({title:s&&s.title?s.title:e(n).createElement(t("gtD4K").default,(0,t("dF5uX").blogifyErrorMessage)(i?.error).title),description:s&&s.description?s.description:e(n).createElement(t("gtD4K").default,(0,t("dF5uX").blogifyErrorMessage)(i?.error).description)})},c=(0,t("cgtv4").defineMessages)({scheduledPublishMessage:{id:"publish-modal.schedule.publish.message",defaultMessage:"{pageTitle} will be published on {date} at {time}"},scheduledUpdateMessage:{id:"publish-modal.schedule.update.message",defaultMessage:"{pageTitle} will be updated on {date} at {time}"},scheduledPublishTitle:{id:"publish-modal.schedule.publish.title",defaultMessage:"Publish scheduled"},scheduledUpdateTitle:{id:"publish-modal.schedule.update.title",defaultMessage:"Update scheduled"}});a.exports.usePublishModalActions=()=>{let e=(0,t("8C5kA").default)(),{createAnalyticsEvent:a}=(0,t("f5bZm").usePublishModalAnalyticsEvent)(),i=(0,t("3Gp1y").useConvertPageToBlog)(),[d]=(0,t("sLZsl").useAutoConvertState)(),[u]=(0,t("ep3mz").usePageSpaceKey)(),[p]=(0,t("ep3mz").usePageContentId)(),{push:h}=(0,t("dPJCf").useRouteActions)(),{userId:g,cloudId:b}=(0,t("bQm3c").useSessionData)(),{versionComments:f,publishAsBlog:y,shouldNotifyComputedValue:S,scheduledPublishDate:P,onClickPublish:m,onClickPreview:I,retrieveEditorTitleAndContent:w,flags:C,hasModifiedSettings:E,moveParams:v,restrictionsRestObj:T,hasModifiedRestrictions:_,isBlog:A}=(0,n.useContext)(t("ibgjl").PublishModalContext),O=v?.closeMove,R=(0,t("ij4CE").useWriteFragmentInterop)({fragmentSpec:s}),D=async(a,i)=>{if(P){let s=(0,t("dWCFT").default)(P,"PP").replace(/[^,]*$/g,""),n=(0,r.format)(P,"h:mm aaaa z"),{title:o}=await w();a({endPublishExperience:!0}),C.showInfoFlag({title:e.formatMessage(i?c.scheduledPublishTitle:c.scheduledUpdateTitle),description:e.formatMessage(i?c.scheduledPublishMessage:c.scheduledUpdateMessage,{pageTitle:o,date:s,time:n})})}},j=({analyticsSource:e,closeModal:i,isUnpublishedDraft:s,shouldNotifyOverride:n})=>{if(!E&&P&&i)return void D(i,s);P&&p&&(0,t("jVFPV").cacheSchedulePublishTime)({contentId:p,schedulePublishDate:P?.toISOString(),fragmentWriterInterop:R});let r=[];if(v&&v.newParentPageId&&v?.newParentPageId!=="VIRTUAL_LOCAL_ROOT_ID"){let e=v?.newParentPageId;r.push({id:e})}let o=A||v&&v.newParentPageId&&"VIRTUAL_LOCAL_ROOT_ID"!==v.newParentPageId?v?.newSpaceKey:void 0,l=n??S;m({suppressNotifyWatchers:!l,message:f,schedulePublishDate:P?P?.toISOString():null,ancestors:r,newSpaceKey:o,moveRequest:{targetId:v?.targetId,position:v?.position,previousParentPageId:v?.previousParentPageId},restrictions:_&&T?(0,t("jVFPV").convertRestrictionsObjForContentREST)(T):void 0})(),a({type:"sendUIEvent",data:{actionSubject:"button",action:"clicked",actionSubjectId:"PublishModalPublishButton",source:e,attributes:{notifyWatchers:l,hasModifiedRestrictions:_,hasNewSpaceKey:v?.newSpaceKey!==void 0&&v?.newSpaceKey!==u,hasNewParentPage:0!==r.length,hasComments:!!f,isSchedulePublish:!!P,isUnpublishedDraft:!!s}}}).fire(),d&&(0,t("cQhbe").sendEditorConversionAnalyticsPageEvent)(a,{pageAction:t("cQhbe").AutoConvertEvent.PUBLISHED,source:e},t("cQhbe").AutoConvertActionSubject.AUTO_CONVERSION)},U=e=>{let a=e?.experimentalPublishPageAsBlog?._links?.webui;h(`${t("jlIaF").CONTEXT_PATH}${a}`,!0)},N=({links:e,errorMessage:a,flags:i})=>{l({flags:i,attributes:{error:a}}),h(`${t("jlIaF").CONTEXT_PATH}${e?.editui}`,!0)},M=a=>({error:i,flags:s})=>{let n=`${i?.message||i}`,r=(0,t("dF5uX").knownEditorError)(n);r?l({flags:s,attributes:{error:r},customFlagMessage:(0,t("cHfGW").buildEditorFlagMessage)({errorData:{[r]:!0},spaceKey:u,formatMessage:e.formatMessage,statusCode:void 0,nextTryIn:0,isUnpublishedDraft:a})}):l({flags:s,attributes:{error:n}}),(0,t("7Sm4c").markErrorAsHandled)(i)},F=async({analyticsSource:e,isUnpublishedDraft:s})=>{a({type:"sendUIEvent",data:{actionSubject:"button",action:"clicked",actionSubjectId:"PublishModalPublishAsBlog",source:e,attributes:{notifyWatchers:S,hasModifiedRestrictions:_,hasNewSpaceKey:v?.newSpaceKey!==void 0&&v?.newSpaceKey!==u,hasComments:!!f,isSchedulePublish:!!P,isUnpublishedDraft:!!s}}}).fire(),await i({flags:C,sourceAction:t("iVd6X").PublishPageAsBlogSources.EditPage,contentId:p||"",spaceKey:v?.newSpaceKey||u,message:f,suppressNotifyWatchers:!S,schedulePublishDate:P?.toISOString(),retrieveEditorTitleAndContent:w,onConvertAndPublishSucceed:U,onPublishFail:N,onConvertFail:M(s),restrictions:_&&T?(0,t("jVFPV").convertRestrictionsObjForContentREST)(T):void 0})};return{handlePreview:async({analyticsSource:e,isUnpublishedDraft:t})=>{I(y,v),a({type:"sendUIEvent",data:{actionSubject:"button",action:"clicked",actionSubjectId:"PublishModalPreviewButton",source:e,attributes:{isUnpublishedDraft:!!t}}}).fire(),O?.()},handlePublish:async({analyticsSource:e,closeModal:i,isUnpublishedDraft:s,source:n="",shouldNotifyOverride:r})=>{if(y)F({analyticsSource:e,isUnpublishedDraft:s});else{if((0,t("9wGTI").fg)("cross-join-3p-nudges-v2")&&(0,o.runCrossJoinThirdPartyNudgeExperiment)({cloudId:b,userId:g,createAnalyticsEvent:a}),n){let e=t("1C3B1").EDITOR_UPDATE_BUTTON_IN_MODAL_CLICK;"shortcut"===n&&(e=t("1C3B1").EDITOR_UPDATE_SHORTCUT_IN_MODAL_PRESS),(0,t("lXYVJ").setViewTransitionSource)(e)}j({analyticsSource:e,closeModal:i,isUnpublishedDraft:s,shouldNotifyOverride:r})}i?.({endPublishExperience:!0}),O?.()}}}}),a("9xGvk",function(e,a){let i=async(e,t,a)=>{let i={featureVisitedCount:e,collaborators:t.map(e=>e.id),accessCapability:a},s=await fetch("/gateway/api/pi-gateway/webhooks/frontend/confluence/cross-join-third-party-nudge",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});return await s.json()},s=async()=>{try{if(c())return!0;return o(),!1}catch(e){return!0}},n=()=>parseInt(t("17wUi").confluenceLocalStorageInstance.getItem(u()),10)||0,r=()=>{let e=n();t("17wUi").confluenceLocalStorageInstance.setItem(u(),e+1)},o=()=>{l(604800)},l=e=>{t("17wUi").confluenceLocalStorageInstance.setItem(d(),!0,e)},c=()=>t("17wUi").confluenceLocalStorageInstance.getItemAsBoolean(d());function d(){return t("1UApO").keys.CROSS_JOIN_THIRD_PARTY_NUDGES_VISITED_KEY}function u(){return t("1UApO").keys.CROSS_JOIN_THIRD_PARTY_NUDGES_VISITED_COUNT}let p=(e,{attributes:t={}}={})=>(a,i,s,n,r)=>e({type:a,data:{action:s,actionSubject:i,actionSubjectId:n,source:"confluenceCrossJoin3PNudges",attributes:{...t,...r}}}).fire(),h=(e,t)=>{e("sendTrackEvent","eligibility","tracked",void 0,{flagKey:"confluenceCrossJoin3PNudges",ineligibilityReason:t})},g=(e,t)=>e("sendOperationalEvent","showCrossJoin3PNudges","failed",void 0,{message:String(t),details:{...t||{}}}),b=async({userId:e,cloudId:t,collaborators:a,accessCapability:s,createAnalyticsEvent:r})=>{let o=n(),l={collaborators:a.length,userId:e,cloudId:t,featureVisitedCount:o,accessCapability:s},c=p(r,{attributes:l});await i(o,a,s),c("sendTrackEvent","thirdPartyNudge","send",void 0,l)},f=async(e,t)=>{let a=`ari:cloud:${e}::site/${t}`,i=new URLSearchParams({resource:a}),s=await fetch(`/gateway/api/invitations/v1/access-requests/capabilities?${i.toString()}`,{method:"GET",headers:{"Content-Type":"application/json"}});return(await s.json())?.results[a]},y=async(e,t)=>{let a=t.map(e=>e.id),i=await fetch("/gateway/api/growth/cross-join-third-party-nudges/get-permitted-users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cloudId:e,product:"jira-software",accountIds:a})}),s=await i.json();return t.filter(e=>s.includes(e.id))},S=async(e,t,a)=>{let i=await fetch("/gateway/api/collaboration/v1/collaborationgraph/user/user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:{contextType:e,principalId:a,siteId:t},modelRequestParams:{experience:"CgUserNearbyUser"},expanded:!0,maxNumberOfResults:50,userId:a})});return(await i.json())?.collaborationGraphEntities?.filter(e=>e?.userProfile!==void 0&&e?.userProfile?.account_type!=="app"&&e?.userProfile?.account_status!=="deactivated"&&e?.userProfile?.account_status!=="deleted").map(({userProfile:{account_id:e,name:t,picture:a}})=>({id:e,name:t,avatar:a}))},P=async(e,t)=>{let a={permissionId:"write",resourceId:`ari:cloud:${e}::site/${t}`},i=await fetch("/gateway/api/permissions/permitted",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return(await i.json()).permitted},m=async(e,t)=>{let a=I[e]||void 0;if(!a)throw Error(`Unknown activation trait key for site product ${e}`);let i=(await C(t)).find(e=>e.name===a);if(i?.value){let e=new Date(i?.value);return e.setDate(e.getDate()+7),new Date>=e}return!1},I={"jira-software":"jira-software.ondemand.activationDate","jira-product-discovery":"jira-product-discovery.activationDate"},w=e=>`/gateway/api/tap-delivery/api/v3/personalization/site/${e}`,C=async e=>{let t=await fetch(w(e),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json","x-atlassian-mau-ignore":"true"}}),{attributes:a}=await t.json();return a},E=async({userId:e,cloudId:t})=>{if(await P("jira-software",t))return{ineligibilityReason:"ALREADY_HAVE_ACCESS"};let a=await S("confluenceCrossJoin3PNudges",t,e);if(void 0===a||0===a.length)return{ineligibilityReason:"NO_COLLABORATORS_FOUND"};let i=await y(t,a);if(0===i.length)return{ineligibilityReason:"COLLABORATORS_HAVE_NO_ACCESS"};let s=await f("jira-software",t);return"DIRECT_ACCESS"!==s&&"REQUEST_ACCESS"!==s?{ineligibilityReason:"NOT_ELIGIBLE_FOR_REQUEST_ACCESS"}:await m("jira-software",t)?(r(),{ineligibilityReason:null,collaborators:i,accessCapability:s}):{ineligibilityReason:"NEW_SITE_LESS_THAN_7_DAYS_OLD"}},v=async({cloudId:e,userId:t,createAnalyticsEvent:a})=>{let i=p(a);try{if(!t||await s())return;let n=await E({userId:t,cloudId:e});null!==n.ineligibilityReason?h(i,n.ineligibilityReason):null!==n.collaborators&&(h(i,"ELIGIBLE"),await b({userId:t,cloudId:e,collaborators:n.collaborators,accessCapability:n.accessCapability,createAnalyticsEvent:a}))}catch(e){g(i,e)}};e.exports.runCrossJoinThirdPartyNudgeExperiment=v});
//# sourceMappingURL=PublishButtonWithMoreOptions.08d54f35.js.map
