function e(e,t,n,o){Object.defineProperty(e,t,{get:n,set:o,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var n=globalThis.parcelRequired477,o=n.register;o("9eydB",function(t,o){e(t.exports,"captionPlugin",()=>n("duFi2").default)}),o("4Vpub",function(t,o){e(t.exports,"datePlugin",()=>n("4iQt6").default),n("4iQt6")}),o("58fnx",function(t,o){e(t.exports,"guidelinePlugin",()=>n("fCLXZ").guidelinePlugin)}),o("d5BeT",function(t,o){e(t.exports,"helpDialogPlugin",()=>n("flknw").helpDialogPlugin),e(t.exports,"deprecatedOpenHelpCommand",()=>n("bQUgf").openHelpCommand),n("flknw")}),o("6N2nV",function(t,o){e(t.exports,"mediaPlugin",()=>n("cWFvG").mediaPlugin),n("cWFvG")}),o("dU3Nv",function(t,o){e(t.exports,"mediaInsertPlugin",()=>n("2U68K").mediaInsertPlugin),n("2U68K")}),o("8WOs1",function(t,o){e(t.exports,"placeholderTextPlugin",()=>n("8HLyI").default)}),o("ii4wo",function(t,o){e(t.exports,"statusPlugin",()=>n("c8680").statusPlugin),n("c8680")}),o("1t2ub",function(t,o){e(t.exports,"contentInsertionPlugin",()=>n("2yr9J").contentInsertionPlugin)}),o("1crCh",function(t,o){e(t.exports,"expandPlugin",()=>n("fTvEN").expandPlugin),n("fTvEN")}),o("dcNOI",function(t,o){e(t.exports,"layoutPlugin",()=>n("05jmd").layoutPlugin),n("05jmd")}),o("fdbx8",function(t,o){e(t.exports,"panelPlugin",()=>n("b3BjA").default),n("b3BjA")}),o("1C8xV",function(t,o){e(t.exports,"rulePlugin",()=>n("5DsxN").rulePlugin),n("5DsxN")}),o("ituSb",function(t,o){e(t.exports,"tablesPlugin",()=>n("eeGWn").default),n("eeGWn")}),o("i0V8C",function(t,o){e(t.exports,"tasksAndDecisionsPlugin",()=>n("jaskt").tasksAndDecisionsPlugin),n("jaskt")}),o("5AZDw",function(t,o){let a,i;var r,s,l=n("1oCLl"),c=n("iu6m9");let d=(e,t,o,a)=>i=>{let r=(0,n("1HVk8").sniffUserBrowserExtensions)({extensions:["grammarly"]}),s={action:n("d925B").ACTION.SYNCHRONY_ERROR,actionSubject:n("d925B").ACTION_SUBJECT.EDITOR,eventType:n("d925B").EVENT_TYPE.OPERATIONAL,attributes:{error:i,browserExtensions:r}};return o.synchronyErrorDocStructure&&(s.attributes.docStructure=(0,n("56Wjx").getDocStructure)(e.doc,{compact:!0})),a?.attachAnalyticsEvent(s)(t),t},p=(e,t)=>(e,o)=>(o?.attachAnalyticsEvent({action:"error"===e?n("d925B").ACTION.SYNCHRONY_ENTITY_ERROR:n("d925B").ACTION.SYNCHRONY_DISCONNECTED,actionSubject:n("d925B").ACTION_SUBJECT.EDITOR,eventType:n("d925B").EVENT_TYPE.OPERATIONAL,attributes:{onLine:navigator.onLine,visibilityState:document.visibilityState}})(t),t);var u={};e(u,"InsertTypeAheadStages",()=>n("cuprm").InsertTypeAheadStages),e(u,"InsertTypeAheadStep",()=>n("cuprm").InsertTypeAheadStep),e(u,"SetAttrsStep",()=>n("9YoeD").SetAttrsStep),e(u,"AnalyticsStep",()=>n("jy7VG").AnalyticsStep),e(u,"LinkMetaStep",()=>n("8EkET").LinkMetaStep),e(u,"OverrideDocumentStep",()=>n("lBdHV").OverrideDocumentStep),e(u,"BatchAttrsStep",()=>n("7Mtx3").BatchAttrsStep);var f={};e(f,"TableSortOrder",()=>n("5rHEx").SortOrder),e(f,"TableSortStep",()=>n("cCTpf").TableSortStep),e(f,"AddColumnStep",()=>n("1rJN9").AddColumnStep);let g=(e,t)=>t.find().reduce((t,n)=>n.spec.pointer.presenceId===e?t.concat(n):t,[]);function m(e){let t=(0,n("jyw2s").getParticipantColor)(e);return{index:t.index,backgroundColor:t.color.backgroundColor,textColor:t.color.textColor}}let y=(e,t,o,a,i,r,s,l)=>{let c=[],d=m(r),p=d.index.toString();if(a){let a=`telepointer color-${p} telepointer-selection`;c.push(n("ftzrq").Decoration.inline(e,t,{class:a},{pointer:{sessionId:o,presenceId:r}}))}let u=document.createElement("span");u.textContent=n("TfRUG").ZERO_WIDTH_JOINER;let f=document.createElement("span");f.textContent=n("TfRUG").ZERO_WIDTH_JOINER;let g=document.createElement("span");g.textContent=n("TfRUG").ZERO_WIDTH_JOINER,g.className=`telepointer color-${p} telepointer-selection-badge`,g.style.cssText=`${function(e){let t=e&&e.color||"black";return`border-right: 2px solid ${t}; margin-right: -2px; z-index: 1`}({color:d.backgroundColor})};`,g.setAttribute("aria-label",`${s} cursor position`),g.setAttribute("role","button"),g.setAttribute(n("h3X17").TELEPOINTER_DATA_SESSION_ID_ATTR,o),l&&g.classList.add(n("h3X17").TELEPOINTER_PULSE_DURING_TR_CLASS);let y=document.createElement("span");y.textContent=s,y.className="telepointer-fullname",y.style.backgroundColor=d.backgroundColor,y.style.color=d.textColor,y.setAttribute("aria-hidden","true"),g.appendChild(y);let S=document.createElement("span");return S.textContent=i,S.className="telepointer-initial",S.style.backgroundColor=d.backgroundColor,S.style.color=d.textColor,S.setAttribute("aria-hidden","true"),g.appendChild(S),c.concat(n("ftzrq").Decoration.widget(t,f,{pointer:{sessionId:o,presenceId:r},key:`telepointer-${o}-zero`})).concat(n("ftzrq").Decoration.widget(t,g,{pointer:{sessionId:o,presenceId:r},key:`telepointer-${o}`})).concat(n("ftzrq").Decoration.widget(t,u,{pointer:{sessionId:o,presenceId:r},key:`telepointer-${o}-zero`}))},S=(e,t,o,a,i,r)=>{let{schema:s,tr:l}=t,c=(0,n("6tl2G").processRawValueWithoutValidation)(s,e,r?.fireAnalyticsEvent),d=!!c?.childCount,p=c?.content;if(d){l.setMeta("addToHistory",!1),l.replaceWith(0,t.doc.nodeSize-2,p);let e=t.selection;if(i){if(e.to<l.doc.content.size-2){let t=l.doc.resolve(e.from),o=l.doc.resolve(e.to),a=new(0,n("ks2lK").TextSelection)(t,o);l.setSelection(a)}}else l.setSelection(n("ks2lK").Selection.atStart(l.doc));l.setMeta("replaceDocument",!0),a&&a.useNativePlugin&&l.setMeta("collab$",{version:o,unconfirmed:[]})}return l},h=(e,t)=>{let n;return t.find().forEach(t=>{t.type.spec.pointer.sessionId===e&&(n=t.from)}),n},b=e=>e instanceof n("aXG5V").ReplaceStep,k=(e,t)=>{if(e.getMeta(t))return!0;let o=e.getMeta("appendedTransaction");return o instanceof n("ks2lK").Transaction&&k(o,t)},E=["__contextId","localId","__autoSize","attr_colwidth","originalHeight","originalWidth"],C=e=>!!e.docChanged&&e.steps.some(t=>!(t instanceof n("jy7VG").AnalyticsStep)&&(!(t instanceof n("aXG5V").AttrStep)||"localId"!==t.attr)&&(t instanceof n("7Mtx3").BatchAttrsStep&&(0,n("dh538").fg)("platform_editor_inorganic_batchattrsstep_localid")?t.data.map(e=>Object.keys(e.attrs)).flat().some(e=>!E.includes(e))&&!e.doc.eq(e.before):!(t instanceof n("9YoeD").SetAttrsStep)||Object.keys(t.attrs).some(e=>!E.includes(e))&&!e.doc.eq(e.before))),A=(e,t)=>{let o=t.get(e),a=!1;return o&&(a=Date.now()-o<n("h3X17").TELEPOINTER_PULSE_DURING_TR_DURATION_MS),a},T=(e,t,n,o)=>{let{doc:a,json:i,version:r,reserveCursor:s}=e;if(a){let{state:e}=t,i=S(a,e,r,n,s,o);i.setMeta("isRemote",!0),t.dispatch(i)}else i&&w(i,t)},P=(e,t)=>{let{state:{tr:n}}=t;t.dispatch(n.setMeta("sessionId",e))},v=(e,t)=>{let{state:{tr:n}}=t;t.dispatch(n.setMeta("presence",e))},O=(e,t,n)=>{let{json:o,userIds:a=[]}=e;o&&w(o,t,a,n)},w=(e,t,o,a)=>{let i;if(!e||!e.length)return;let{state:r,state:{schema:s}}=t,l=e.map(e=>n("cO9ey").Step.fromJSON(s,e));a&&a.useNativePlugin&&o?i=(0,n("9NwnH").receiveTransaction)(r,l,o,{mapSelectionBackward:!0}):(i=r.tr,l.forEach(e=>i.step(e))),i&&(i.setMeta("addToHistory",!1),i.setMeta("isRemote",!0),r.tr.storedMarks&&i.setStoredMarks(r.tr.storedMarks),t.dispatch(i))},B=(e,t)=>{let{state:{tr:n}}=t;t.dispatch(n.setMeta("telepointer",e))},I=e=>({type:"textSelection",anchor:e.anchor,head:e instanceof n("ks2lK").AllSelection||e instanceof n("ks2lK").NodeSelection?e.head-1:e.head}),_=new(0,n("ks2lK").PluginKey)("collabEditPlugin"),N=({originalTransaction:e,transactions:t,oldEditorState:o,newEditorState:a,useNativePlugin:i,viewMode:r,hideTelecursorOnLoad:s})=>l=>{let d=t.find(e=>e.docChanged),p=_.getState(a),u=o.tr;if(d?.steps.forEach(e=>{e instanceof n("jy7VG").AnalyticsStep||u.step(e)}),!p?.isReady)return;let f=(0,c.editorExperiment)("platform_editor_reduce_noisy_steps_ncs",!0,{exposure:!0})?u:d,g=!e.getMeta("isRemote")&&!e.getMeta("scaleTable")&&(!(0,c.editorExperiment)("platform_editor_reduce_noisy_steps_ncs",!0)||f?.docChanged);(i||g)&&l.send(f,o,a);let{activeParticipants:m}=_.getState(o)||{},{activeParticipants:y,sessionId:S}=p,h=!o.selection.eq(a.selection),b=m&&!m.eq(y);if((0,n("dh538").fg)("platform_editor_ai_generic_prep_for_aifc")){if(!S||"edit"!==r)return;let t=d?.getMeta("uiEvent")==="paste",n=e.getMeta("useSelectionBookmarkForRemote");if(n){if(!0!==n&&"resolve"in n){let e={type:"telepointer",selection:I(n.resolve(a.doc)),sessionId:S};l.sendMessage(e)}}else if(h&&(!d||t)||b&&!s){let e=I(a.selection);l.sendMessage({type:"telepointer",selection:e,sessionId:S})}}else if(S&&"edit"===r&&(h&&!d||b&&!s)){let e=I(a.selection);l.sendMessage({type:"telepointer",selection:e,sessionId:S})}},M=new(0,n("ks2lK").PluginKey)("trackLastRemoteConflict"),x=()=>new(0,n("1S4f7").SafePlugin)({key:M,state:{init(){},apply(e,t){let n=e.getMeta(M);return n||t}}}),D=(r=(e,t,n,o,a,i)=>{let r,s={disconnectedHandler:()=>{p(e.state,e.state.tr)("disconnected",i)},errorHandler:()=>{p(e.state,e.state.tr)("error",i)}},l=()=>{r&&(r.off("disconnected",s.disconnectedHandler),r.off("error",s.errorHandler))},c=t=>{e.dispatch(e.state.tr.setMeta("collabInitialised",!0)),T(t,e,n,i)},u=t=>P(t,e),f=t=>O(t,e,n),g=t=>v(t,e),m=t=>B(t,e),y=t=>{let{steps:n}=t,{state:o}=e,{tr:a}=o;n.forEach(e=>a.step(e)),e.dispatch(a)},S=t=>{d(e.state,e.state.tr,o,i)(t)},h=({entity:e})=>{l(),n.EXPERIMENTAL_allowInternalErrorAnalytics&&(e.on("disconnected",s.disconnectedHandler),e.on("error",s.errorHandler),r=e)},b=t=>{e.dispatch(e.state.tr.setMeta(M,t))};return t.on("init",c).on("connected",u).on("data",f).on("presence",g).on("telepointer",m).on("local-steps",y).on("error",S).on("entity",h).on("data:conflict",b),()=>{l(),t.off("init",c).off("connected",u).off("data",f).off("presence",g).off("telepointer",m).off("local-steps",y).off("error",S).off("entity",h).off("data:conflict",b)}},s=(e,t)=>t&&t.every((t,n)=>t===e[n]),(...e)=>(i&&s(a,e)||(i=r(...e),a=e),i)),L=(e,t,n,o)=>{e.setup({getState:()=>t.state,editorApi:n,onSyncUpError:o})},R=(0,n("2XqLN").default)((e,t)=>{e.initialize&&e.initialize(()=>t.state,e=>n("cO9ey").Step.fromJSON(t.state.schema,e))}),j=({options:e,providerFactory:t,view:n,featureFlags:o,editorAnalyticsApi:a,pluginInjectionApi:i})=>r=>{let s,l=_.getState(n.state);return l?.isReady&&s&&s(),s=D(n,r,e,o,t,a),e.useNativePlugin?L(r,n,i,e.onSyncUpError):R(r,n),s};class F{add(e){let t=new Map(this.participants);return e.forEach(e=>{t.set(e.sessionId,e)}),new F(t)}remove(e){let t=new Map(this.participants);return e.forEach(e=>{t.delete(e)}),new F(t)}update(e,t){let n=new Map(this.participants),o=n.get(e);return o?(n.set(e,{...o,lastActive:t}),new F(n)):this}updateCursorPos(e,t){let n=new Map(this.participants),o=n.get(e);return o?(n.set(e,{...o,cursorPos:t}),new F(n)):this}toArray(){return Array.from(this.participants.values())}get(e){return this.participants.get(e)}size(){return this.participants.size}eq(e){return this.toArray().map(e=>e.sessionId).sort((e,t)=>e>t?-1:1).join("")===e.toArray().map(e=>e.sessionId).sort((e,t)=>e>t?-1:1).join("")}constructor(e=new Map){this.participants=void 0,this.participants=e}}let V=(e,t)=>{let o=e.doc.nodeSize-2;if(t<=o){let o=e.doc.resolve(t),a=n("ks2lK").Selection.findFrom(o,-1,!0),i=n("ks2lK").Selection.findFrom(o,1,!0);return a?a.from:i?i.from:t}return o};class U{get decorations(){return this.decorationSet}get activeParticipants(){return this.participants}get sessionId(){return this.sid}getFullName(e){let t=this.participants.get(e);return t?t.name:"X"}getInitial(e){return this.getFullName(e).substring(0,1).toUpperCase()}getPresenceId(e){let t=this.participants.get(e);return t?.presenceId??e}apply(e){let{participants:t,sid:o,isReady:a}=this,i=e.getMeta("presence"),r=e.getMeta("telepointer"),s=e.getMeta("nudgeTelepointer"),c=e.getMeta("sessionId"),d=e.getMeta("collabInitialised");"boolean"!=typeof d&&(d=a),c&&(o=c.sid);let p=[],u=[];if(i){let{joined:e=[],left:n=[]}=i;t=(t=t.remove(n.map(e=>e.sessionId))).add(e),n.forEach(e=>{let t=g(this.getPresenceId(e.sessionId),this.decorationSet);t&&(u=u.concat(t))})}if(r){let{sessionId:n}=r;if(t.get(n)&&n!==o){let t=g(this.getPresenceId(n),this.decorationSet);t&&(u=u.concat(t));let o=e.doc.nodeSize-2,a=r.selection.anchor,i=r.selection.head,s=a<i?a:i,l=a>=i?a:i;s>o&&(s=o),l>o&&(l=o);let c=l-s>0,d=1,f=1;try{d=V(e,c?Math.max(s,0):s),f=c?V(e,l):d}catch(e){this.onError(e)}p=p.concat(y(d,f,n,c,this.getInitial(n),this.getPresenceId(n),this.getFullName(n),A(n,this.nudgeAnimations)))}}if(e.docChanged){try{this.decorationSet=this.decorationSet.map(e.mapping,e.doc,{onRemove:t=>{if(t.pointer&&t.pointer.sessionId&&t.key===`telepointer-${t.pointer.sessionId}`){let n=e.steps.filter(b)[0];if(n){let{sessionId:o,presenceId:a}=t.pointer,{slice:{content:{size:i}},from:r}=n,s=V(e,i?Math.min(r+i,e.doc.nodeSize-3):Math.max(r,1));p=p.concat(y(s,s,o,!1,this.getInitial(o),a,this.getFullName(o),A(o,this.nudgeAnimations)))}}}})}catch(e){this.onError(e)}(0,n("dh538").fg)("platform_editor_ai_generic_prep_for_aifc")||e.steps.filter(b).forEach(e=>{let{from:t,to:n}=e;this.decorationSet.find(t,n).forEach(e=>{e.from!==e.to&&u.push(e)})})}let{selection:f}=e;if(this.decorationSet.find().forEach(e=>{if(e.type.toDOM){let t=e.type.toDOM.classList.contains(n("h3X17").TELEPOINTER_DIM_CLASS),o=(0,l.expValEquals)("platform_editor_hydratable_ui","isEnabled",!0)?(0,n("d7ZU3").getBrowserInfo)():n("d7ZU3").browser;e.from===f.from&&e.to===f.to?(t||e.type.toDOM.classList.add(n("h3X17").TELEPOINTER_DIM_CLASS),o.gecko||(e.type.side=-1)):(t&&e.type.toDOM.classList.remove(n("h3X17").TELEPOINTER_DIM_CLASS),e.type.side=0)}}),s){let e=s?.sessionId;this.decorationSet.find().forEach(o=>{o.type.toDOM&&t.get(e)&&o.spec?.pointer?.sessionId===e&&o.spec?.key===`telepointer-${e}`&&(o.type.toDOM.classList.remove(n("h3X17").TELEPOINTER_PULSE_DURING_TR_CLASS),o.type.toDOM.classList.remove(n("h3X17").TELEPOINTER_PULSE_CLASS),o.type.toDOM.offsetWidth,o.type.toDOM.classList.add(n("h3X17").TELEPOINTER_PULSE_CLASS),this.nudgeAnimations.set(e,Date.now()))})}if(u.length&&(this.decorationSet=this.decorationSet.remove(u)),p.length&&(this.decorationSet=this.decorationSet.add(e.doc,p)),r){let{sessionId:e}=r;if(t.get(e)){let n=h(e,this.decorationSet);n&&(t=t.updateCursorPos(e,n))}}let m=new U(this.decorationSet,t,o,d,this.onError,this.nudgeAnimations);return U.eq(m,this)?this:m}static eq(e,t){return e.participants===t.participants&&e.sessionId===t.sessionId&&e.isReady===t.isReady}static init(e){let{doc:t,onError:o}=e;return new U(n("ftzrq").DecorationSet.create(t,[]),new F,void 0,void 0,o)}constructor(e,t,n,o=!1,a,i=new Map){this.decorationSet=void 0,this.participants=void 0,this.nudgeAnimations=void 0,this.onError=e=>console.error(e),this.sid=void 0,this.isReady=void 0,this.decorationSet=e,this.participants=t,this.sid=n,this.isReady=o,this.onError=a||this.onError,this.nudgeAnimations=i}}let X=()=>{let e=e=>{for(let t of Object.values(e)){let e=t?.prototype?.jsonID;if("string"==typeof e)try{n("cO9ey").Step.jsonID(e,t)}catch(e){}}};e(f),e(u)},z=(e,t,o,a,i,r,s)=>(X(),new(0,n("1S4f7").SafePlugin)({key:_,state:{init:e=>U.init(e),apply(t,n,o,a){let i=n.apply(t);return e(_,i),i}},props:{decorations:e=>_.getState(e)?.decorations,handleDOMEvents:{click(e,t){if(!(t.target instanceof HTMLElement)||!e.state.selection.empty)return!1;let{pos:o}=e.state.tr.selection.$from;if(!o)return!1;let a=_.getState(e.state)?.decorations?.find(o,o);if(!a?.length)return!1;(0,n("ajtqX").fireAnalyticsEvent)(s?.analytics?.sharedState.currentState()?.createAnalyticsEvent??void 0)({payload:{action:n("d925B").ACTION.CLICKED,actionSubject:n("d925B").ACTION_SUBJECT.TELEPOINTER,actionSubjectId:n("d925B").ACTION_SUBJECT_ID.TELEPOINTER,eventType:n("d925B").EVENT_TYPE.TRACK}})}}},filterTransaction(e,t){let n=_.getState(t);return!!e.getMeta("collabInitialised")||!!n?.isReady||!e.docChanged},view(e){let l=d(e.state,e.state.tr,r,s?.analytics?.actions);i.onSyncUpError=e=>{(0,n("ajtqX").fireAnalyticsEvent)(s?.analytics?.sharedState.currentState()?.createAnalyticsEvent??void 0)({payload:{action:n("d925B").ACTION.NEW_COLLAB_SYNC_UP_ERROR_NO_STEPS,actionSubject:n("d925B").ACTION_SUBJECT.EDITOR,eventType:n("d925B").EVENT_TYPE.OPERATIONAL,attributes:e}})};let c=a(j({view:e,options:i,providerFactory:t,featureFlags:r,pluginInjectionApi:s,editorAnalyticsApi:s?.analytics?.actions}),l);return t&&t.subscribe("collabEditProvider",(e,t)=>{t&&t.then(e=>o(e))}),{destroy(){t.unsubscribeAll("collabEditProvider"),c&&c.then(e=>{e&&e()})}}}})),W=e=>e.origin instanceof n("ks2lK").Transaction&&e.origin.getMeta("mergeIsLocked"),G=new(0,n("ks2lK").PluginKey)("collabTrackLastOrganicChangePlugin"),K=()=>new(0,n("1S4f7").SafePlugin)({key:G,state:{init:()=>({lastLocalOrganicChangeAt:null,lastRemoteOrganicChangeAt:null,lastLocalOrganicBodyChangeAt:null,lastRemoteOrganicBodyChangeAt:null}),apply(e,t){if(e.getMeta("appendedTransaction"))return t;let o=!!e.getMeta("isRemote"),a=o&&!!e.getMeta("replaceDocument"),i=!!e.steps.find(e=>(e instanceof n("aXG5V").AddMarkStep||e instanceof n("aXG5V").RemoveMarkStep)&&e.mark?.type?.name==="annotation");return a||(0,n("h3X17").isDirtyTransaction)(e)?t:C(e)?o?{lastLocalOrganicChangeAt:t.lastLocalOrganicChangeAt,lastRemoteOrganicChangeAt:Date.now(),lastLocalOrganicBodyChangeAt:t.lastLocalOrganicBodyChangeAt,lastRemoteOrganicBodyChangeAt:i?t.lastRemoteOrganicBodyChangeAt:Date.now()}:{lastLocalOrganicChangeAt:Date.now(),lastRemoteOrganicChangeAt:t.lastRemoteOrganicChangeAt,lastLocalOrganicBodyChangeAt:i?t.lastLocalOrganicBodyChangeAt:Date.now(),lastRemoteOrganicBodyChangeAt:t.lastRemoteOrganicBodyChangeAt}:t}}}),H=new(0,n("kt8c2").default)(n("25jxS").NCS_STORAGE.NCS_STORAGE_CLIENT_KEY),Y=(e,t,n)=>{let o=e[t]??{ncsSessionId:t,totalStepSize:0,numberOfSteps:0,maxStepSize:0,stepSizeSumForP90:[]};return n.forEach(e=>{let t=JSON.stringify(e).length;o.totalStepSize+=t,o.numberOfSteps+=1,o.maxStepSize=Math.max(o.maxStepSize,t||0),o.stepSizeSumForP90.push(t||0)}),o},J=e=>{let t=JSON.parse(H.getItem(n("25jxS").NCS_STORAGE.NCS_ACTIVE_SESSIONS)||"{}");t[e]||H.setItemWithExpiry(n("25jxS").NCS_STORAGE.NCS_ACTIVE_SESSIONS,JSON.stringify({...t,[e]:!0}))},$=({api:e,steps:t})=>{let o=e?.collabEdit?.sharedState.currentState()?.sessionId;if(!o)return;let a=JSON.parse(H.getItem(n("25jxS").NCS_STORAGE.NCS_SESSION_STEP_METRICS)||"{}"),i=Y(a,o,t);H.setItemWithExpiry(n("25jxS").NCS_STORAGE.NCS_SESSION_STEP_METRICS,JSON.stringify({...a,[o]:i})),J(o)},q=e=>{let t={stepType:e.toJSON().stepType};return e instanceof n("aXG5V").AttrStep||e instanceof n("aXG5V").DocAttrStep?t.attr=e.attr:e instanceof n("9YoeD").SetAttrsStep?t.attr=Object.keys(e.attrs).sort().join("_"):e instanceof n("aXG5V").AddMarkStep||e instanceof n("aXG5V").RemoveMarkStep||e instanceof n("aXG5V").RemoveNodeMarkStep||e instanceof n("aXG5V").AddNodeMarkStep?t.markType=e.mark.type.name:e instanceof n("7Mtx3").BatchAttrsStep&&(t.attr=e.data.map(({nodeType:e,attrs:t})=>`${e}_${Object.keys(t).sort().join("_")}`).sort().join("_")),t},Z=e=>Object.entries(function(e,t){if("groupBy"in Object&&"function"==typeof Object.groupBy)return Object.groupBy(e,t);let n={};return e.forEach(e=>{let o=t(e);n[o]||(n[o]=[]),n[o].push(e)}),n}(e,e=>Object.values(e).join("_"))).reduce((e,[t,n])=>(e[t]=Array.isArray(n)?n.length:0,e),{}),Q=(e,t)=>{let n=[];for(let t of e.values()){let{startedAt:e,endedAt:o,steps:a}=t,i=Z(a.map(q));n.push({startedAt:e,endedAt:o,stepTypesAmount:i})}e.clear(),n.length>0&&t(n)},ee=new Map,et=e=>e&&"scheduler"in e?e.scheduler:null,en=({api:e,newEditorState:t,transactions:o,onTrackDataProcessed:a})=>{let i=o.flatMap(e=>e.steps),r=(0,n("9NwnH").sendableSteps)(t),s=et(window);if(!i.length||!s||!r)return;let{version:l}=r,d=ee.get(l),p=d?.startedAt||Date.now(),u=Date.now(),f=(d?.steps||[]).concat(i);ee.set(l,{startedAt:p,endedAt:u,steps:f}),$({api:e,steps:(0,c.editorExperiment)("platform_editor_reduce_noisy_steps_ncs",!0)?i.filter(e=>!(e instanceof n("jy7VG").AnalyticsStep)):i}),s.postTask(()=>{Q(ee,a)},{priority:"background",delay:1e4})},eo=[],ea=e=>e&&"scheduler"in e?e.scheduler:null,ei=(e,t)=>{let n=[];for(let t of e){let{steps:e,...o}=t,a=Z(e.map(q));n.push({...o,stepTypesAmount:a})}e.length=0,n.length>0&&t(n)},er=({newEditorState:e,oldEditorState:t,transactions:o,onDataProcessed:a})=>{let i=o.flatMap(e=>e.steps).filter(e=>!(e instanceof n("jy7VG").AnalyticsStep)),r=ea(window);if(!i.length||!r)return;let s=G.getState(t),l=G.getState(e);if(i.length&&s?.lastLocalOrganicBodyChangeAt!==l?.lastLocalOrganicBodyChangeAt){let e=Date.now(),t=!s?.lastLocalOrganicBodyChangeAt;if(eo.length>0&&e-eo[eo.length-1].startedAt<2e3){let n=eo.pop();eo.push({transactions:n.transactions+1,startedAt:n.startedAt,endedAt:e,isFirstChange:n.isFirstChange||t,steps:n.steps.concat(i)})}else eo.push({transactions:1,startedAt:e,endedAt:e,isFirstChange:t,steps:i});1===eo.length&&r.postTask(()=>{ei(eo,a)},{priority:"background",delay:1e4})}},es=new(0,n("ks2lK").PluginKey)("nativeCollabProviderPlugin"),el=({providerPromise:e})=>new(0,n("1S4f7").SafePlugin)({key:es,state:{init:()=>null,apply:(e,t)=>e.getMeta(es)||t},view:t=>(e.then(e=>{let{dispatch:n,state:o}=t,a=o.tr;a.setMeta(es,e),n(a)}),{})}),ec=e=>{let t={stepType:e.toJSON().stepType,stepInstance:"unknown"};return e instanceof n("aXG5V").AttrStep?(t.attr=e.attr,t.stepInstance="AttrStep"):e instanceof n("aXG5V").DocAttrStep?(t.attr=e.attr,t.stepInstance="DocAttrStep"):e instanceof n("9YoeD").SetAttrsStep?(t.attr=Object.keys(e.attrs).sort().join("_"),t.stepInstance="SetAttrsStep"):e instanceof n("aXG5V").AddMarkStep?(t.markType=e.mark.type.name,t.stepInstance="AddMarkStep"):e instanceof n("aXG5V").RemoveMarkStep?(t.markType=e.mark.type.name,t.stepInstance="RemoveMarkStep"):e instanceof n("aXG5V").RemoveNodeMarkStep?(t.markType=e.mark.type.name,t.stepInstance="RemoveNodeMarkStep"):e instanceof n("aXG5V").AddNodeMarkStep?(t.markType=e.mark.type.name,t.stepInstance="AddNodeMarkStep"):e instanceof n("aXG5V").ReplaceStep?t.stepInstance="ReplaceStep":e instanceof n("aXG5V").ReplaceAroundStep?t.stepInstance="ReplaceAroundStep":e instanceof n("jy7VG").AnalyticsStep?t.stepInstance="AnalyticsStep":e instanceof n("cuprm").InsertTypeAheadStep?t.stepInstance="InsertTypeAheadStep":e instanceof n("8EkET").LinkMetaStep&&(t.stepInstance="LinkMetaStep"),t},ed=(e,t)=>o=>{if(o.getMeta("appendTransaction")||o.getMeta("isRemote")||o.steps.some(e=>e instanceof n("jy7VG").AnalyticsStep||e instanceof n("aXG5V").ReplaceStep||e instanceof n("aXG5V").ReplaceAroundStep||e instanceof n("8EkET").LinkMetaStep))return!0;if(o.docChanged&&o.doc.eq(o.before)){let a=function(e){let t=e.steps.map(e=>{if(e instanceof n("aXG5V").RemoveNodeMarkStep||e instanceof n("aXG5V").AddNodeMarkStep||e instanceof n("9YoeD").SetAttrsStep||e instanceof n("aXG5V").AttrStep){if(void 0!==e.pos)return`${e.pos}`}else if(e instanceof n("aXG5V").AddMarkStep||e instanceof n("aXG5V").RemoveMarkStep)return`from_${e.from}_to_${e.to}`;else if(e instanceof n("cuprm").InsertTypeAheadStep)return"insertTypeAheadStep";return""});return t.some(e=>!!e)?t.join("_"):""}(o);return!a||((e.forEach((t,n)=>{o.time-t.timestamp>50&&e.delete(n)}),e.get(a))?(t(o),!1):(e.set(a,{timestamp:o.time,steps:o.steps}),!0))}return!0},ep=new(0,n("ks2lK").PluginKey)("trackAndFilterSpammingStepsPluginKey"),eu=e=>{let t=new Map;return new(0,n("1S4f7").SafePlugin)({key:ep,filterTransaction:ed(t,e)})},ef=new(0,n("ks2lK").PluginKey)("collabTrackNCSInitializationPlugin"),eg=()=>new(0,n("1S4f7").SafePlugin)({key:ef,state:{init:()=>({collabInitialisedAt:null,firstChangeAfterInitAt:null,firstContentBodyChangeAfterInitAt:null}),apply(e,t,o){if(e.getMeta("collabInitialised"))return{collabInitialisedAt:Date.now(),firstChangeAfterInitAt:null,firstContentBodyChangeAfterInitAt:null};if(!(t.collabInitialisedAt&&!t.firstContentBodyChangeAfterInitAt))return t;let a=k(e,"isRemote");if(a&&k(e,"replaceDocument")||(0,n("h3X17").isDirtyTransaction)(e))return t;if(e.docChanged&&!e.doc.eq(o.doc)){let o=!!e.steps.find(e=>e instanceof n("aXG5V").AddMarkStep&&e.mark?.type?.name==="annotation");return{collabInitialisedAt:t.collabInitialisedAt,firstChangeAfterInitAt:Date.now(),firstContentBodyChangeAfterInitAt:o||a?t.firstContentBodyChangeAfterInitAt:Date.now()}}return t}},props:{attributes(e){let t=ef.getState(e);return{"data-has-collab-initialised":`${!!t?.collabInitialisedAt}`}}}}),em=e=>async(t,n)=>{try{let n=await e;if(n)return t(n)}catch(e){n?n(e):console.error(e)}},ey=e=>({from:t,to:o,mark:a})=>(e.then(e=>{let i=new(0,n("aXG5V").AddMarkStep)(Math.min(t,o),Math.max(t,o),a);e.api?.addComment([i])}),!1),eS=e=>({pos:t,mark:o})=>(e.then(e=>{let a=new(0,n("aXG5V").AddNodeMarkStep)(t,o);e.api?.addComment([a])}),!1);t.exports.collabEditPlugin=({config:e,api:t})=>{let o=t?.featureFlags?.sharedState.currentState()||{},a=()=>{},i=new Promise(e=>{a=e}),r=em(i);return{name:"collabEdit",getSharedState(e){if(!e)return{initialised:{collabInitialisedAt:null,firstChangeAfterInitAt:null,firstContentBodyChangeAfterInitAt:null,lastLocalOrganicChangeAt:null,lastRemoteOrganicChangeAt:null,lastLocalOrganicBodyChangeAt:null,lastRemoteOrganicBodyChangeAt:null},activeParticipants:void 0,sessionId:void 0,lastReconnectionConflictMetadata:void 0};let t=_.getState(e),n=ef.getState(e),o=G.getState(e),a=M.getState(e);return{activeParticipants:t?.activeParticipants,sessionId:t?.sessionId,initialised:{collabInitialisedAt:n?.collabInitialisedAt||null,firstChangeAfterInitAt:n?.firstChangeAfterInitAt||null,firstContentBodyChangeAfterInitAt:n?.firstContentBodyChangeAfterInitAt||null,lastLocalOrganicChangeAt:o?.lastLocalOrganicChangeAt||null,lastRemoteOrganicChangeAt:o?.lastRemoteOrganicChangeAt||null,lastLocalOrganicBodyChangeAt:o?.lastLocalOrganicBodyChangeAt||null,lastRemoteOrganicBodyChangeAt:o?.lastRemoteOrganicBodyChangeAt||null},lastReconnectionConflictMetadata:a}},actions:{getAvatarColor:m,addInlineCommentMark:ey(i),addInlineCommentNodeMark:eS(i),isRemoteReplaceDocumentTransaction:e=>e.getMeta("isRemote")&&e.getMeta("replaceDocument"),getCurrentCollabState:()=>({content:new(0,n("h9yJL").JSONTransformer)().encode(null.state.doc),version:(0,n("9NwnH").getCollabState)(null.state)?.version||0,sendableSteps:(0,n("9NwnH").sendableSteps)(null.state)}),validatePMJSONDocument:e=>(e.content||[]).map(e=>null.state.schema.nodeFromJSON(e)).every(e=>{try{e.check()}catch{return!1}return!0})},pmPlugins(){let{useNativePlugin:s=!1,userId:d=null}=e||{},p=e=>{let o=e;return(0,c.editorExperiment)("platform_editor_reduce_noisy_steps_ncs",!0,{exposure:!0})&&(o=o.reduce((e,t)=>(t.step instanceof n("jy7VG").AnalyticsStep||e.push(new(0,n("9NwnH").Rebaseable)(t.step,t.inverted,t.origin)),e),[])),((0,c.editorExperiment)("platform_editor_offline_editing_web",!0)||(0,l.expValEquals)("platform_editor_enable_single_player_step_merging","isEnabled",!0))&&(o=o.reduce((e,o)=>{let a=e[e.length-1],i=(0,n("91bcx").isOfflineMode)(t?.connectivity?.sharedState.currentState()?.mode),r=(0,l.expValEquals)("platform_editor_enable_single_player_step_merging","isEnabled",!0);if((i||r)&&a&&!W(a)&&!W(o)){let t=a.step.merge(o.step),r=o.inverted.merge(a.inverted),s=a.origin;if(t&&r)return e[e.length-1]=new(0,n("9NwnH").Rebaseable)(t,r,s instanceof n("ks2lK").Transaction?s.setMeta("isOffline",!0===s.getMeta("isOffline")||i):s),e}return e.push(new(0,n("9NwnH").Rebaseable)(o.step,o.inverted,o.origin instanceof n("ks2lK").Transaction?o.origin.setMeta("isOffline",!0===o.origin.getMeta("isOffline")||i):o.origin)),e},[])),o},u=[...s?[{name:"pmCollab",plugin:()=>(0,n("9NwnH").collab)({clientID:d,transformUnconfirmed:p})},{name:"nativeCollabProviderPlugin",plugin:()=>el({providerPromise:i})}]:[],{name:"collab",plugin:({dispatch:n,providerFactory:i})=>z(n,i,a,r,e,o,t)},{name:"collabTrackNCSInitializationPlugin",plugin:eg}];return u.push({name:"trackAndFilterSpammingSteps",plugin:()=>eu(e=>{let o=e.steps.map(e=>ec(e));t?.analytics?.actions?.fireAnalyticsEvent({action:n("d925B").ACTION.STEPS_FILTERED,actionSubject:n("d925B").ACTION_SUBJECT.COLLAB,attributes:{steps:o},eventType:n("d925B").EVENT_TYPE.OPERATIONAL})})}),u.push({name:"collabTrackLastOrganicChangePlugin",plugin:K}),(0,c.editorExperiment)("platform_editor_offline_editing_web",!0)&&u.push({name:"trackLastRemoteConflictPlugin",plugin:x}),u},onEditorViewStateUpdated(a){let i=d(a.newEditorState,a.newEditorState.tr,o,t?.analytics?.actions),s=(0,n("2pjJ5").isEmptyDocument)(a.newEditorState.doc),l=t?.editorViewMode?.sharedState.currentState()?.mode;r(N({originalTransaction:a.originalTransaction,transactions:a.transactions,oldEditorState:a.oldEditorState,newEditorState:a.newEditorState,useNativePlugin:e.useNativePlugin??!1,hideTelecursorOnLoad:!s&&(e.hideTelecursorOnLoad??!1),viewMode:l}),i),en({api:t,...a,onTrackDataProcessed:e=>{t?.analytics?.actions?.fireAnalyticsEvent({action:n("d925B").ACTION.STEPS_TRACKED,actionSubject:n("d925B").ACTION_SUBJECT.COLLAB,attributes:{steps:e},eventType:n("d925B").EVENT_TYPE.OPERATIONAL})}}),(0,n("dh538").fg)("platform_editor_collab_organic_change_reporting")&&er({api:t,...a,onDataProcessed:e=>{t?.analytics?.actions?.fireAnalyticsEvent({action:n("d925B").ACTION.ORGANIC_CHANGES_TRACKED,actionSubject:n("d925B").ACTION_SUBJECT.COLLAB,attributes:{organicChanges:e},eventType:n("d925B").EVENT_TYPE.OPERATIONAL})}})},commands:{nudgeTelepointer:e=>({tr:t})=>(t.setMeta("nudgeTelepointer",{sessionId:e}),t)}}}}),o("efDik",function(e,o){var a,i=n("l998X");n("42omo");var r=n("3pLGZ");let s=e=>e.sourceManager.flush(),l=e=>e.referenceManager.flush();var c=n("8m4tT");let d=(e,t,o)=>{if(!t.docChanged)return e;let a=new(0,n("aXG5V").Mapping)(t.mapping.maps),i=o.tr;return e.steps.forEach(e=>{let t=e.map(a);t&&(i.step(t),a.appendMap(t.getMap()))}),i},p=e=>(0,n("ftpVl").withLazyLoading)({nodeName:"bodiedSyncBlock",getNodeViewOptions:()=>{},loader:()=>n("6PgjL").then(({bodiedSyncBlockNodeView:t})=>t(e))}),u=e=>(0,n("ftpVl").withLazyLoading)({nodeName:"syncBlock",getNodeViewOptions:()=>{},loader:()=>n("aXgFn").then(({syncBlockNodeView:t})=>t(e))});var f=((a={}).CANNOT_DELETE_WHEN_OFFLINE="cannot-delete-when-offline",a.CANNOT_EDIT_WHEN_OFFLINE="cannot-edit-when-offline",a.CANNOT_CREATE_WHEN_OFFLINE="cannot-create-when-offline",a.FAIL_TO_DELETE="fail-to-delete",a.SYNC_BLOCK_COPIED="sync-block-copied",a);let g=(e,t)=>()=>{e?.core?.actions.execute(({tr:e})=>e.setMeta(B,{bodiedSyncBlockDeletionStatus:"processing",activeFlag:!1})),t.sourceManager.retryDeletion()},m=e=>t=>(e.sourceManager.clearPendingDeletion(),t.setMeta(B,{bodiedSyncBlockDeletionStatus:"none"})),y=(e,t,o,a,i)=>(o.sourceManager.clearPendingDeletion(),o.sourceManager.deleteSyncBlocksWithConfirmation(t.map(e=>e.attrs),()=>{let e=i.current;e&&a?.core?.actions.execute(()=>{let t=e.setMeta("isConfirmedSyncBlockDeletion",!0);return t.getMeta(n("l9G9n").pmHistoryPluginKey)||t.setMeta("addToHistory",!1),t})},e=>{a?.core?.actions.execute(({tr:t})=>{let n;return e||(n={activeFlag:{id:f.FAIL_TO_DELETE,onRetry:g(a,o),onDismissed:m(o)}}),n={...n,bodiedSyncBlockDeletionStatus:o.sourceManager.isRetryingDeletion()?"none":"completed"},t.setMeta(B,n)})},()=>{i.current=void 0}),!1),S=(e,t,n)=>{if(n?.connectivity?.sharedState.currentState()?.mode!=="offline")return;let{bodiedSyncBlock:o}=e.state.schema.nodes,a=e.posAtCoords({left:t.clientX,top:t.clientY})?.pos;if(void 0===a)return;let i=e.state.doc.resolve(a);if((0,c.findParentNodeOfTypeClosestToPos)(i,o))return!0},h=(e,t,o)=>{let{bodiedSyncBlock:a}=o.nodes,i=(0,c.findParentNodeOfType)(a)(t);if(i){let{node:t,pos:o}=i,a=n("ftzrq").Decoration.node(o,o+t.nodeSize,{class:`${n("e6n00").BodiedSyncBlockSharedCssClassName.selectionInside}`});return n("ftzrq").DecorationSet.create(e,[a])}return n("ftzrq").DecorationSet.empty},b=(e,t,o)=>{let a={},i={};if(!t.docChanged)return{removed:[],added:[]};if(t.steps.filter(e=>e instanceof n("aXG5V").ReplaceStep||e instanceof n("aXG5V").ReplaceAroundStep).some(t=>{let{from:n,to:a}=t,i=!1;return n!==a&&t.getMap().forEach((t,n)=>{t===n||i||o.doc.slice(Math.max(0,t),Math.min(o.doc.content.size,n)).content.forEach(t=>{!i&&e(t)&&(i=!0)})}),t.slice.content.size>0&&!i&&t.slice.content.forEach(t=>{e(t)&&!i&&(i=!0)}),i})){let n=o.doc,r=t.doc,s={},l={};for(let t in n.content.forEach(t=>{if(e(t)){let e=t.attrs;s[e.localId]={attrs:e}}}),r.content.forEach((t,n)=>{if(e(t)){let e=t.attrs;l[e.localId]={attrs:e,from:n,to:n+t.nodeSize}}}),s)l[t]||(a[t]=s[t]);for(let e in l)s[e]||(i[e]=l[e])}return{removed:Object.values(a),added:Object.values(i)}},k=(e,t)=>{let{bodiedSyncBlock:n}=t.schema.nodes;for(let t of e.steps){let o=t.getMap(),{doc:a}=e,i=[];if("from"in t&&"number"==typeof t.from&&"to"in t&&"number"==typeof t.to){let{from:e,to:n}=t;i.push(e,n)}else if("pos"in t&&"number"==typeof t.pos){let{pos:e}=t;i.push(e)}for(let e of i){let t=o.map(e);if(t>=0&&t<=a.content.size&&(0,c.findParentNodeOfTypeClosestToPos)(a.resolve(t),n))return!0}}return!1},E=(e,t)=>{let{syncBlock:n}=e.nodes;return(0,c.findSelectedNodeOfType)(n)(t)},C=(e,t)=>(0,c.findSelectedNodeOfType)(e.nodes.bodiedSyncBlock)(t)||(0,c.findParentNodeOfType)(e.nodes.bodiedSyncBlock)(t),A=(e,t)=>E(e,t)||C(e,t),T=(e,t)=>e.type===t,P=new Set(["inlineExtension","extension","bodiedExtension","syncBlock","bodiedSyncBlock"]),v=e=>{let{nodes:t}=e.$from.doc.type.schema,o=e.from,a=e.to,i=e.content().content;if(e instanceof n("7XFGZ").CellSelection){let t=(0,n("id9O1").findTable)(e);if(!t)return!1;i=n("5SAOw").Fragment.from([t.node]),o=t.pos,a=t.pos+t.node.nodeSize}else if(e instanceof n("ks2lK").TextSelection){let r=(0,c.findParentNodeOfType)([t.bulletList,t.orderedList,t.taskList,t.blockquote])(e);r&&(i=n("5SAOw").Fragment.from([r.node]),o=r.pos,a=r.pos+r.node.nodeSize)}let r=!0;return e.$from.doc.nodesBetween(o,a,e=>{if(P.has(e.type.name))return r=!1,!1}),!!r&&{contentToInclude:i=O(i),from:o,to:a}},O=e=>{let t=[];return e.forEach(e=>{let n=e.marks.filter(e=>"breakout"!==e.type.name);if(e.isText)t.push(e);else{let o=e.type.create(e.attrs,e.content,n);t.push(o)}}),n("5SAOw").Fragment.from(t)},w=(e,t)=>{let n=e.content.firstChild?.type===t.type&&e.content.firstChild?.attrs.resourceId===t.attrs.resourceId,o=e.content.lastChild?.type===t.type&&e.content.lastChild?.attrs.resourceId===t.attrs.resourceId,a=n&&e.openStart>0,i=o&&e.openEnd>0;return!a&&!i},B=new(0,n("ks2lK").PluginKey)("syncedBlockPlugin"),I=e=>{setTimeout(()=>{e?.core.actions.execute(({tr:e})=>e.setMeta(B,{activeFlag:{id:f.SYNC_BLOCK_COPIED}}))},0)},_=(e,t,o,a)=>{let{useLongPressSelection:i=!1}=e||{},r={current:void 0},s=!1;return new(0,n("1S4f7").SafePlugin)({key:B,state:{init(e,t){let a=t.doc.children.filter(e=>"syncBlock"===e.type.name);return o.referenceManager.fetchSyncBlocksData((0,n("gtauf").convertPMNodesToSyncBlockNodes)(a)),{selectionDecorationSet:h(t.doc,t.selection,t.schema),activeFlag:!1,syncBlockStore:o}},apply:(e,t,n)=>{let a=e.getMeta(B),{activeFlag:i,selectionDecorationSet:r,bodiedSyncBlockDeletionStatus:s}=t,l=r.map(e.mapping,e.doc);return e.selection.eq(n.selection)||(l=h(e.doc,e.selection,e.doc.type.schema)),{activeFlag:a?.activeFlag??i,selectionDecorationSet:l,syncBlockStore:o,bodiedSyncBlockDeletionStatus:a?.bodiedSyncBlockDeletionStatus??s}}},props:{nodeViews:{syncBlock:u({options:e,pmPluginFactoryParams:t,api:a}),bodiedSyncBlock:p({pluginOptions:e,pmPluginFactoryParams:t,api:a})},decorations:e=>{let t=B.getState(e)?.selectionDecorationSet??n("ftzrq").DecorationSet.empty,{doc:o}=e,i=(0,n("91bcx").isOfflineMode)(a?.connectivity?.sharedState.currentState()?.mode),r=a?.editorViewMode?.sharedState.currentState()?.mode==="view",s=[],l=[];return e.doc.descendants((e,t)=>{"bodiedSyncBlock"===e.type.name&&i&&s.push(n("ftzrq").Decoration.node(t,t+e.nodeSize,{class:n("e6n00").SyncBlockStateCssClassName.disabledClassName})),("bodiedSyncBlock"===e.type.name||"syncBlock"===e.type.name)&&r&&l.push(n("ftzrq").Decoration.node(t,t+e.nodeSize,{class:n("e6n00").SyncBlockStateCssClassName.viewModeClassName}))}),t.add(o,s).add(o,l)},handleClickOn:(0,n("3tffm").createSelectionClickHandler)(["bodiedSyncBlock"],e=>!!e.closest(`.${n("e6n00").BodiedSyncBlockSharedCssClassName.prefix}`),{useLongPressSelection:i}),handleDOMEvents:{mouseover:(e,t)=>S(e,t,a),mousedown:(e,t)=>S(e,t,a),copy:()=>(s=!0,!1)},transformCopied:(e,{state:t})=>{let o=B.getState(t),i=o?.syncBlockStore,{schema:r}=t,l=s;return(s=!1,i)?(0,n("3Ter7").mapSlice)(e,t=>{if("syncBlock"===t.type.name)return l&&I(a),t;if("bodiedSyncBlock"===t.type.name&&t.attrs.resourceId){if(!w(e,t))return t.content;l&&I(a);let n=i.referenceManager.generateResourceIdForReference(t.attrs.resourceId),o={...t.attrs,resourceId:n},s=r.nodes.syncBlock.markSet?t.marks.filter(e=>r.nodes.syncBlock.markSet?.includes(e.type)):t.marks;return r.nodes.syncBlock.create(o,null,s)}return t}):e}},filterTransaction:(e,t)=>{let i=(0,n("91bcx").isOfflineMode)(a?.connectivity?.sharedState.currentState()?.mode),s=!!e.getMeta("isConfirmedSyncBlockDeletion");if(!e.docChanged||!o?.sourceManager.requireConfirmationBeforeDelete()&&!o.sourceManager.hasPendingCreation()||e.getMeta("isRemote")||e.getMeta("isCommitSyncBlockCreation")||!i&&s)return!0;let{removed:l,added:c}=b(o.sourceManager.isSourceBlock,e,t);if(i){let{removed:n,added:o}=b(e=>"syncBlock"===e.type.name,e,t),i=!1;if(s||l.length>0||n.length>0?i=f.CANNOT_DELETE_WHEN_OFFLINE:c.length>0||o.length>0?i=f.CANNOT_CREATE_WHEN_OFFLINE:k(e,t)&&(i=f.CANNOT_EDIT_WHEN_OFFLINE),i)return setTimeout(()=>{a?.core.actions.execute(({tr:e})=>e.setMeta(B,{activeFlag:{id:i}}))},0),!1}else{if(l.length>0)return r.current=e,y(e,l,o,a,r);if(c.length>0)return!!e.getMeta(n("l9G9n").pmHistoryPluginKey)||(o.sourceManager.registerCreationCallback(()=>{a?.core?.actions.execute(()=>e.setMeta("isCommitSyncBlockCreation",!0)),a?.core.actions.focus()}),!1)}return!0},appendTransaction:(e,t,a)=>{for(let i of(e.filter(e=>e.docChanged).forEach(e=>{r.current&&(r.current=d(r.current,e,a))}),e)){if(!i.getMeta(n("l9G9n").pmHistoryPluginKey))continue;let{added:e}=b(o.sourceManager.isSourceBlock,i,t);if(e.length>0){let t=a.tr;return e.forEach(e=>{void 0!==e.from&&void 0!==e.to&&t.delete(e.from,e.to)}),t}}return null}})},N=({tr:e,syncBlockStore:t,typeAheadInsert:o})=>{let{schema:{nodes:{bodiedSyncBlock:a,paragraph:i}}}=e.doc.type;if(e.selection.empty){let n=t.sourceManager.generateBodiedSyncBlockAttrs(),r=i.createAndFill({}),s=a.createAndFill(n,r?[r]:[]);if(!s)return!1;t.sourceManager.createBodiedSyncBlockNode(n),e=o?o(s):(0,c.safeInsert)(s)(e).scrollIntoView()}else{let o=v(e.selection);if(!o)return!1;let i=t.sourceManager.generateBodiedSyncBlockAttrs(),r=a.createAndFill(i,o.contentToInclude);if(!r)return!1;t.sourceManager.createBodiedSyncBlockNode(i),e.replaceWith(o.from>0?o.from-1:0,o.to,r).scrollIntoView(),e.setSelection(n("ks2lK").TextSelection.create(e.doc,o.to+1))}return e},M=(e,t)=>({tr:n})=>D(n.doc.type.schema,n.selection,e,t)?n:null,x=(e,t)=>(n,o,a)=>D(n.tr.doc.type.schema,n.tr.selection,e,t),D=(e,t,o,a)=>{let i=A(e,t);if(!i)return!1;let r=T(i.node,e.nodes.bodiedSyncBlock),s=null;if(r){let{nodes:{syncBlock:t}}=e;if(!(s=t.createAndFill({resourceId:o.referenceManager.generateResourceIdForReference(i.node.attrs.resourceId)})))return!1}else s=i.node;if(!s)return!1;let l=(0,n("kgnzE").toDOM)(s,e);return(0,n("kgnzE").copyDomNode)(l,s.type,t),setTimeout(()=>{a?.core.actions.execute(({tr:e})=>e.setMeta(B,{activeFlag:{id:f.SYNC_BLOCK_COPIED}}))},0),!0},L=(e,t)=>(o,a,i)=>{let r=E(o.schema,o.selection),s=r?.node?.attrs?.resourceId;if(!s)return!1;let l=e.referenceManager.getSyncBlockURL(s);if(l)window.open(l,"_blank");else{let e=o.tr;t?.analytics?.actions?.attachAnalyticsEvent({eventType:n("d925B").EVENT_TYPE.OPERATIONAL,action:n("d925B").ACTION.ERROR,actionSubject:n("d925B").ACTION_SUBJECT.SYNCED_BLOCK,actionSubjectId:n("d925B").ACTION_SUBJECT_ID.SYNCED_BLOCK_SOURCE_URL,attributes:{error:"No URL resolved for synced block"}})(e),a?.(e)}return!0},R=e=>(t,n,o)=>{let{schema:{nodes:a},tr:i}=t;if(!n)return!1;let r=i;return!!(r=(0,c.findSelectedNodeOfType)(a.syncBlock)(i.selection)||(0,c.findSelectedNodeOfType)(a.bodiedSyncBlock)(i.selection)?(0,c.removeSelectedNode)(i):(0,c.removeParentNodeOfType)(a.bodiedSyncBlock)(i))&&(n(r),e?.core.actions.focus(),!0)};n("42omo");var j=n("42omo");let F=({api:e})=>{let{formatMessage:o}=(0,n("8C5kA").default)(),{selection:a,menuTriggerByNode:r,mode:s}=(0,n("eiA8Z").useSharedPluginStateWithSelector)(e,["selection","blockControls","connectivity"],e=>({selection:e.selectionState?.selection,menuTriggerByNode:e.blockControlsState?.menuTriggerByNode??void 0,mode:e.connectivityState?.mode})),l=r&&r.rootPos!==r.pos,c=(0,j.useMemo)(()=>a&&v(a),[a]);if(l||!c)return null;let d=(0,n("91bcx").isOfflineMode)(s);return(0,i.jsx)(n("2GVu1").ToolbarDropdownItem,{elemBefore:(0,i.jsx)(t(n("l1bBg")),{label:""}),onClick:()=>{e?.core?.actions.execute(e?.syncedBlock.commands.insertSyncedBlock()),e?.core?.actions.execute(e?.blockControls?.commands?.toggleBlockMenu({closeMenu:!0}))},isDisabled:d,elemAfter:(0,i.jsx)(n("5nBzc").default,{appearance:"new",children:o(n("eKkkY").messages.newLozenge)}),children:o(n("eKkkY").messages.createSyncedBlock)})},V=({api:e})=>{let{formatMessage:o}=(0,n("8C5kA").default)(),{mode:a}=(0,n("eiA8Z").useSharedPluginStateWithSelector)(e,["connectivity"],e=>({mode:e.connectivityState?.mode}));return(0,i.jsx)(n("2GVu1").ToolbarDropdownItem,{elemBefore:(0,i.jsx)(t(n("l1bBg")),{label:""}),onClick:()=>{e?.core?.actions.execute(e?.syncedBlock.commands.copySyncedBlockReferenceToClipboard()),e?.core?.actions.execute(e?.blockControls?.commands?.toggleBlockMenu({closeMenu:!0}))},isDisabled:(0,n("91bcx").isOfflineMode)(a),elemAfter:(0,i.jsx)(n("5nBzc").default,{appearance:"new",children:o(n("eKkkY").messages.newLozenge)}),children:o(n("eKkkY").messages.copySyncedBlock)})},U=({api:e})=>{let{menuTriggerByNode:t}=(0,n("eiA8Z").useSharedPluginStateWithSelector)(e,["blockControls"],e=>({menuTriggerByNode:e.blockControlsState?.menuTriggerByNode??void 0}));return t?.nodeType==="syncBlock"||t?.nodeType==="bodiedSyncBlock"?(0,i.jsx)(V,{api:e}):(0,i.jsx)(F,{api:e})},X=e=>[{type:"block-menu-item",key:n("btNLq").BLOCK_ACTIONS_CREATE_SYNCED_BLOCK_MENU_ITEM.key,parent:{type:"block-menu-section",key:n("btNLq").BLOCK_ACTIONS_MENU_SECTION.key,rank:n("gEb6G").BLOCK_ACTIONS_MENU_SECTION_RANK[n("btNLq").BLOCK_ACTIONS_CREATE_SYNCED_BLOCK_MENU_ITEM.key]},component:()=>(0,i.jsx)(U,{api:e})}],z=({syncBlockStoreManager:e,api:o})=>{let[a,r]=(0,j.useState)(!1),[s,l]=(0,j.useState)(1),{mode:c,bodiedSyncBlockDeletionStatus:d,activeFlag:p}=(0,n("eiA8Z").useSharedPluginStateWithSelector)(o,["connectivity","syncedBlock"],e=>({mode:e.connectivityState?.mode,bodiedSyncBlockDeletionStatus:e.syncedBlockState?.bodiedSyncBlockDeletionStatus,activeFlag:e.syncedBlockState?.activeFlag})),{formatMessage:u}=(0,n("8C5kA").default)(),f=t(j).useRef(void 0),g=(0,j.useCallback)(e=>()=>{f.current&&(f.current(e),f.current=void 0),e||r(!1),o?.core?.actions.execute(({tr:t})=>t.setMeta(B,{bodiedSyncBlockDeletionStatus:e?"processing":"none",activeFlag:!1}))},[o?.core?.actions]),m=(0,j.useCallback)(e=>{r(!0),l(e);let t=new Promise(e=>{f.current=e});return p&&o?.core?.actions.execute(({tr:e})=>e.setMeta(B,{activeFlag:!1})),t},[p,o?.core?.actions]);return(0,j.useEffect)(()=>{let t=e.sourceManager.registerConfirmationCallback(m);return()=>{t()}},[e,m]),(0,j.useEffect)(()=>{"completed"===d&&a&&(r(!1),o?.core?.actions.execute(({tr:e})=>e.setMeta(B,{bodiedSyncBlockDeletionStatus:"none"})))},[o?.core?.actions,d,a]),(0,i.jsx)(n("6xdDU").default,{children:a&&(0,i.jsxs)(n("8CZUH").default,{onClose:g(!1),testId:"sync-block-delete-confirmation",children:[(0,i.jsx)(n("9ot3w").default,{hasCloseButton:!0,children:(0,i.jsx)(n("d8eRd").default,{appearance:"warning",children:u(n("fzXn1").syncBlockMessages.deleteConfirmationModalTitle)})}),(0,i.jsx)(n("1DHa6").default,{children:(0,i.jsx)(n("iXCQx").default,{children:u(n("fzXn1").syncBlockMessages.deleteConfirmationModalDescription,{syncBlockCount:s})})}),(0,i.jsxs)(n("8o1lj").default,{children:[(0,i.jsx)(n("ccHMk").default,{appearance:"subtle",onClick:g(!1),children:u(n("fzXn1").syncBlockMessages.deleteConfirmationModalCancelButton)}),(0,i.jsx)(n("ccHMk").default,{appearance:"warning",onClick:g(!0),autoFocus:!0,isDisabled:(0,n("91bcx").isOfflineMode)(c),isLoading:"processing"===d,children:u(n("fzXn1").syncBlockMessages.deleteConfirmationModalDeleteButton)})]})]})})};n("42omo");let W={[f.CANNOT_DELETE_WHEN_OFFLINE]:{title:n("fzXn1").syncBlockMessages.failToDeleteTitle,description:n("fzXn1").syncBlockMessages.failToDeleteWhenOfflineDescription,type:"error"},[f.CANNOT_EDIT_WHEN_OFFLINE]:{title:n("fzXn1").syncBlockMessages.failToEditTitle,description:n("fzXn1").syncBlockMessages.failToEditWhenOfflineDescription,type:"error"},[f.CANNOT_CREATE_WHEN_OFFLINE]:{title:n("fzXn1").syncBlockMessages.failToCreateTitle,description:n("fzXn1").syncBlockMessages.failToCreateWhenOfflineDescription,type:"error"},[f.FAIL_TO_DELETE]:{title:n("fzXn1").syncBlockMessages.cannotDeleteTitle,description:n("fzXn1").syncBlockMessages.cannotDeleteDescription,type:"error"},[f.SYNC_BLOCK_COPIED]:{title:n("fzXn1").syncBlockMessages.syncBlockCopiedTitle,description:n("fzXn1").syncBlockMessages.syncBlockCopiedDescription,action:n("fzXn1").syncBlockMessages.syncBlockCopiedAction,type:"info"}},G=({api:e})=>{let{activeFlag:t,mode:o}=(0,n("eiA8Z").useSharedPluginStateWithSelector)(e,["syncedBlock","connectivity"],e=>({activeFlag:e.syncedBlockState?.activeFlag,mode:e.connectivityState?.mode})),{formatMessage:a}=(0,n("8C5kA").default)();if(!t)return;let{title:r,description:s,action:l,type:c}=W[t.id],{onRetry:d,onDismissed:p}=t;if((0,n("91bcx").isOfflineMode)(o)&&d)return void e?.core.actions.execute(({tr:e})=>(e.setMeta(B,{activeFlag:!1}),e));let u="info"===c?n("aD1SW").default:n("eCEXz").default;return(0,i.jsx)(n("6uGcC").default,{children:(0,i.jsx)(u,{onDismissed:()=>{e?.core.actions.execute(({tr:e})=>{p?.(e);let t=e.getMeta(B);return e.setMeta(B,{...t,activeFlag:!1}),e}),e?.core.actions.focus()},title:a(r),description:a(s),id:t.id,testId:t.id,icon:K(c),actions:(()=>{if("error"===c){if(d)return[{content:a(n("fzXn1").syncBlockMessages.deleteRetryButton),onClick:d}]}else if("info"===c&&l)return[{content:a(l),href:"https://atlaskit.atlassian.com/",target:"_blank"}]})()})})},K=e=>"error"===e?(0,i.jsx)(t(n("ebrpi")),{label:"",color:"var(--ds-icon-warning, #E06C00)"}):(0,i.jsx)(t(n("fZtQj")),{label:""});n("42omo");let H=(e,o,a,r)=>{let s=A(e.schema,e.selection);if(!s)return;let{schema:{nodes:{bodiedSyncBlock:l}}}=e,d=T(s.node,l),{formatMessage:p}=o,u=s.node.type,f=a?.decorations?.actions.hoverDecoration,g=(e,t)=>({onMouseEnter:f?.(e,!0,t),onMouseLeave:f?.(e,!1,t),onFocus:f?.(e,!0,t),onBlur:f?.(e,!1,t)}),m=[],y={id:"editor.syncedBlock.copy",type:"button",appearance:"subtle",icon:t(n("2MuFw")),title:p(n("fzXn1").syncBlockMessages.copySyncBlockLabel),showTitle:!1,tooltipContent:p(n("fzXn1").syncBlockMessages.copySyncBlockTooltip),onClick:x(r,a),...g(u,n("aFUXX").akEditorSelectedNodeClassName)};m.push(y);let S=!r.referenceManager.getSyncBlockURL(s.node.attrs.resourceId);if(!d){let e={id:"editor.syncedBlock.editSource",type:"button",disabled:S,appearance:"subtle",icon:t(n("1Zr9M")),title:p(n("fzXn1").syncBlockMessages.editSourceLabel),showTitle:!1,tooltipContent:p(S?n("fzXn1").syncBlockMessages.editSourceTooltipDisabled:n("fzXn1").syncBlockMessages.editSourceTooltip),onClick:L(r,a),...g(u,n("aFUXX").akEditorSelectedNodeClassName)};m.push(e)}let h=[{type:"overflow-dropdown",testId:"synced-block-overflow-dropdown-trigger",options:[{title:p(n("61p3e").default.delete),onClick:R(a),icon:(0,i.jsx)(t(n("gKvd9")),{label:""}),...g(u)}]}];return m.push(...h),{title:"Synced Block floating controls",getDomRef:e=>{let t=e.domAtPos.bind(e);return(0,c.findDomRefAtPos)(s.pos,t)},nodeType:u,items:m,scrollable:!0,groupLabel:p(n("fzXn1").syncBlockMessages.syncBlockGroup),visible:a?.connectivity?.sharedState.currentState()?.mode!=="offline"}},Y=({syncBlockStoreManager:e,api:t})=>{let{mode:o}=(0,n("eiA8Z").useSharedPluginStateWithSelector)(t,["connectivity"],e=>({mode:e.connectivityState?.mode}));return(0,j.useEffect)(()=>{let t=-1;return"offline"!==o?t=window.setInterval(()=>{document?.visibilityState==="visible"&&e.referenceManager.refreshSubscriptions()},3e3):-1!==t&&window.clearInterval(t),()=>{window.clearInterval(t)}},[e,o]),null};n("42omo");var J=n("1oCLl");let $=({api:e})=>{let o=(0,n("8C5kA").default)(),{selection:a,mode:r}=(0,n("eiA8Z").useSharedPluginStateWithSelector)(e,["selection","connectivity"],e=>({selection:e.selectionState?.selection,mode:e.connectivityState?.mode})),s=!!(a&&v(a)),l=!!a?.empty,c=!!((0,n("91bcx").isOfflineMode)(r)||!s&&!l),d=(0,j.useCallback)(()=>{e?.core?.actions.execute(({tr:t})=>e?.syncedBlock.commands.insertSyncedBlock()({tr:t})),e?.core?.actions.focus()},[e]),p=o.formatMessage(n("fzXn1").syncBlockMessages.createSyncBlockLabel);return(0,i.jsx)(n("iIVVb").ToolbarTooltip,{content:p,children:(0,i.jsx)(n("7ERUE").ToolbarButton,{label:p,iconBefore:(0,i.jsx)(t(n("l1bBg")),{size:"small",label:""}),isDisabled:c,onClick:d})})},q={type:n("cPCP8").SYNCED_BLOCK_GROUP.type,key:n("cPCP8").SYNCED_BLOCK_GROUP.key,component:(0,J.expValEquals)("platform_editor_toolbar_aifc_responsive","isEnabled",!0)?({children:e})=>(0,i.jsx)(n("aro2m").Show,{above:"md",children:(0,i.jsx)(n("kDB94").ToolbarButtonGroup,{children:e})}):void 0,parents:[{type:n("cPCP8").INSERT_BLOCK_SECTION.type,key:n("cPCP8").INSERT_BLOCK_SECTION.key,rank:n("4Chin").INSERT_BLOCK_SECTION_RANK[n("cPCP8").SYNCED_BLOCK_GROUP.key]}]},Z=e=>[q,{type:n("cPCP8").SYNCED_BLOCK_BUTTON.type,key:n("cPCP8").SYNCED_BLOCK_BUTTON.key,component:()=>(0,i.jsx)($,{api:e}),parents:[{type:n("cPCP8").SYNCED_BLOCK_GROUP.type,key:n("cPCP8").SYNCED_BLOCK_GROUP.key,rank:n("4Chin").SYNCED_BLOCK_SECTION_RANK[n("cPCP8").SYNCED_BLOCK_BUTTON.key]}]}];e.exports.syncedBlockPlugin=({config:e,api:t})=>{let o=new(0,n("lEQpi").SyncBlockStoreManager)(e?.syncBlockDataProvider,t?.analytics?.actions?.fireAnalyticsEvent);return t?.blockMenu?.actions.registerBlockMenuComponents(X(t)),t?.toolbar?.actions.registerComponents(Z(t)),{name:"syncedBlock",nodes:()=>[{name:"syncBlock",node:n("8WAFY").syncBlock},{name:"bodiedSyncBlock",node:n("3EiOU").bodiedSyncBlock}],pmPlugins:()=>[{name:"syncedBlockPlugin",plugin:n=>_(e,n,o,t)}],commands:{copySyncedBlockReferenceToClipboard:()=>M(o,t),insertSyncedBlock:()=>({tr:e})=>N({tr:e,syncBlockStore:o})||null},actions:{flushBodiedSyncBlocks:()=>s(o),flushSyncedBlocks:()=>l(o)},pluginsOptions:{quickInsert:({formatMessage:e})=>[{id:"syncBlock",title:e(n("2UWDO").messages.syncedBlock),description:e(n("2UWDO").messages.syncedBlockDescription),priority:800,keywords:["synced","block","synced-block","sync","sync-block","auto","update","excerpt","connect"],isDisabledOffline:!0,keyshortcut:"",lozenge:(0,i.jsx)(n("5nBzc").default,{appearance:"new",children:e(n("2UWDO").messages.newLozenge)}),icon:()=>(0,i.jsx)(r.IconSyncBlock,{label:e(n("2UWDO").messages.syncedBlock)}),action:(e,t)=>N({tr:t.tr,syncBlockStore:o,typeAheadInsert:e})}],floatingToolbar:(e,n)=>H(e,n,t,o)},contentComponent:()=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Y,{syncBlockStoreManager:o,api:t}),(0,i.jsx)(z,{syncBlockStoreManager:o,api:t}),(0,i.jsx)(G,{api:t})]}),getSharedState:e=>{if(!e)return;let{activeFlag:t,syncBlockStore:n,bodiedSyncBlockDeletionStatus:o}=B.getState(e);return{activeFlag:t,syncBlockStore:n,bodiedSyncBlockDeletionStatus:o}}}}}),o("6PgjL",function(e,t){e.exports=n("4mJKd")(5)("9H9aT").then(()=>n("d80Tb"))}),o("4mJKd",function(e,t){e.exports=e=>t=>import(n("8tirZ").shardUrl(n("02nRr").resolve(t),e))}),o("8tirZ",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.applyShardToDomain=r,e.exports.domainShardingKey=void 0,e.exports.getDomainShardIndex=o,e.exports.shardUrl=function(e,t){return globalThis[n]?s(e,t):e},e.exports.shardUrlUnchecked=s;let n="__ATLASPACK_ENABLE_DOMAIN_SHARDS";function o(e,t){let n=t+1,o=e.split("").reduce((e,t)=>{let o=(e<<n)-e+t.charCodeAt(0);return o&o},0);return(o%=n)<0&&(o+=n),o}let a=/-\d+$/;function i(e){if(!a.test(e))return e;let t=e.lastIndexOf("-");return e.slice(0,t)}function r(e,t){let n=e.indexOf("."),o=0===t?"":`-${t-1}`;if(-1===n)return`${i(e)}${o}`;let a=i(e.slice(0,n));return`${a}${o}${e.slice(n)}`}function s(e,t){let n=new URL(e),a=o(function(e){let t=e.lastIndexOf("/");if(-1===t||t===e.length-1)throw Error("Expected an absolute URL with a file name, unable to apply sharding.");return e.slice(t+1)}(n.pathname),t);return n.hostname=r(n.hostname,a),n.toString()}e.exports.domainShardingKey=n}),o("02nRr",function(t,n){e(t.exports,"register",()=>o,e=>o=e),e(t.exports,"resolve",()=>a,e=>a=e);var o,a,i=new Map;o=function(e,t){for(var n=0;n<t.length-1;n+=2)i.set(t[n],{baseUrl:e,path:t[n+1]})},a=function(e){var t=i.get(e);if(null==t)throw Error("Could not resolve bundle with id "+e);return new URL(t.path,t.baseUrl).toString()}}),o("aXgFn",function(e,t){let o=n("4mJKd")(5);e.exports=Promise.all([o("5tz7G"),o("87Teh")]).then(()=>n("hoY46"))}),o("l1bBg",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.default=void 0;var o=i(n("42omo")),a=i(n("aSNrY"));function i(e){return e&&e.__esModule?e:{default:e}}let r=e=>o.default.createElement(a.default,Object.assign({name:"BlockSyncedIcon",dangerouslySetGlyph:'<path fill="currentcolor" d="M13.5 3a.5.5 0 0 0-.5-.5H3a.5.5 0 0 0-.5.5v10a.5.5 0 0 0 .5.5h3V15H3a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v2h-1.5z"/><path fill="currentcolor" d="M14.9 8.71a3.75 3.75 0 0 1 0 5.303l-.024.026.439.146a.75.75 0 0 1-.13 1.454l-2.476.354a.75.75 0 0 1-.848-.849l.353-2.474.029-.125a.75.75 0 0 1 1.425-.006l.147.44.025-.026a2.25 2.25 0 0 0 0-3.183l-.707-.707 1.06-1.06zm-3.818-1.98a.75.75 0 0 1 .85.849l-.354 2.475a.75.75 0 0 1-1.454.13l-.147-.44-.025.026a2.25 2.25 0 0 0 0 3.183l.707.707-1.06 1.06-.708-.707a3.75 3.75 0 0 1 0-5.303l.026-.026-.44-.146a.75.75 0 0 1 .13-1.454z"/>'},e));r.displayName="BlockSyncedIcon",e.exports.default=r}),o("arL2z",function(t,o){e(t.exports,"alignmentPlugin",()=>n("hr8mu").alignmentPlugin),n("hr8mu")}),o("6ukH4",function(t,o){e(t.exports,"annotationPlugin",()=>n("cpn0f").annotationPlugin)}),o("9sDYf",function(t,o){e(t.exports,"breakoutPlugin",()=>n("cwPVT").breakoutPlugin),n("cwPVT")}),o("8ElOg",function(t,o){e(t.exports,"contextPanelPlugin",()=>n("1nZXu").contextPanelPlugin)}),o("aAppb",function(t,o){e(t.exports,"extensionPlugin",()=>n("eyggb").extensionPlugin),n("eyggb")}),o("fvSfu",function(t,o){e(t.exports,"default",()=>j);var a=n("42omo");n("arL2z");var i=n("hr8mu");n("6ukH4");var r=n("PJ00O");n("9sDYf");var s=n("cwPVT");n("9eydB");var l=n("j5BTD");n("1t2ub"),n("8ElOg"),n("4Vpub");var c=n("4iQt6"),d=n("8uNa8");n("1crCh");var p=n("fTvEN");n("aAppb");var u=n("eyggb"),f=n("3Vesv"),g=n("dtCIm"),m=n("bn2AM");n("58fnx"),n("d5BeT");var y=n("flknw"),S=n("8POG7"),h=n("5zfRA");n("dcNOI");var b=n("05jmd"),k=n("88OoA");n("6N2nV");var E=n("cWFvG");n("dU3Nv");var C=n("2U68K"),A=n("dhgPE");n("fdbx8");var T=n("b3BjA");n("8WOs1"),n("1C8xV");var P=n("5DsxN"),v=n("kPcbV");n("ii4wo");var O=n("c8680"),w=n("efDik");n("ituSb");var B=n("eeGWn");n("i0V8C");var I=n("jaskt"),_=n("gcsWd"),N=n("fH5dz"),M=n("1oCLl"),x=n("iu6m9"),D=n("gVoWJ");function L({allowExpand:e}){return!!e&&"object"==typeof e&&!!e.allowInsertion}function R({props:e,prevProps:t,initialPluginConfiguration:o}){return function({appearance:e,props:t,featureFlags:o,initialPluginConfiguration:a,prevAppearance:R,createAnalyticsEvent:j}){let F="comment"===e,V="chromeless"===e,U=(0,n("geLSP").isFullPage)(e),X=()=>o,z=(0,D.createDefaultPreset)({...t,appearance:e,createAnalyticsEvent:j,hyperlinkOptions:{lpLinkPicker:o.lpLinkPicker??!1,...t.hyperlinkOptions},__livePage:t.__livePage,toolbar:a?.toolbarPlugin}),W=!t.allowStatus||"object"==typeof t.allowStatus&&!!t.allowStatus.menuDisabled,G=e=>!!e&&"before"in e&&!!e.before;return z.add(n("bz4KD").ufoPlugin).add(n("2nH2Y").dataConsumerPlugin).add(n("3ihIB").accessibilityUtilsPlugin).add(n("2yr9J").contentInsertionPlugin).add(n("fPXRH").batchAttributeUpdatesPlugin).maybeAdd([s.breakoutPlugin,{allowBreakoutButton:"full-page"===e,appearance:e}],!!(t.allowBreakout&&U)).maybeAdd(i.alignmentPlugin,!!t.allowTextAlignment).maybeAdd([_.textColorPlugin,t.allowTextColor],!!t.allowTextColor).add(k.listPlugin).maybeAdd(P.rulePlugin,!!t.allowRule).maybeAdd([p.expandPlugin,{allowInsertion:L(t),useLongPressSelection:!1,appearance:e,allowInteractiveExpand:"boolean"==typeof t.allowExpand?t.allowExpand:!!(t.allowExpand&&!1!==t.allowExpand.allowInteractiveExpand),__livePage:t.__livePage}],!!t.allowExpand).maybeAdd(n("fCLXZ").guidelinePlugin,!!(!F&&!V&&(t.media||t.allowTables)||(0,x.editorExperiment)("platform_editor_breakout_resizing",!0,{exposure:!0})&&(t.allowExpand||t.allowLayouts||t.codeBlock))).maybeAdd([m.gridPlugin,{shouldCalcBreakoutGridLines:U}],!!t.media).maybeAdd([n("cpn0f").annotationPlugin,t.annotationProviders],!!t.annotationProviders).maybeAdd([E.mediaPlugin,{...t.media,allowLazyLoading:!0,allowBreakoutSnapPoints:U,allowAdvancedToolBarOptions:void 0!==t.media?.allowAdvancedToolBarOptions?t.media?.allowAdvancedToolBarOptions:U||F,allowCommentsOnMedia:U&&!!t.annotationProviders,allowDropzoneDropLine:U,allowMediaSingleEditable:!0,allowRemoteDimensionsFetch:!0,allowMarkingUploadsAsIncomplete:!1,allowImagePreview:void 0!==t.media?.allowImagePreview?t.media?.allowImagePreview:U,fullWidthEnabled:"full-width"===e,editorAppearance:e,uploadErrorHandler:t.uploadErrorHandler,waitForMediaUpload:t.waitForMediaUpload,isCopyPasteEnabled:!0,alignLeftOnInsert:void 0!==t.media?.alignLeftOnInsert?t.media?.alignLeftOnInsert:F,getEditorFeatureFlags:X}],!!t.media).maybeAdd(C.mediaInsertPlugin,!!t.media).maybeAdd(n("duFi2").default,!!t.media?.allowCaptions).maybeAdd([A.mentionsPlugin,{sanitizePrivateContent:t.sanitizePrivateContent,insertDisplayName:t.mention?.insertDisplayName??t.mentionInsertDisplayName,allowZeroWidthSpaceAfter:!0,HighlightComponent:t.mention?.HighlightComponent,profilecardProvider:t.mention?.profilecardProvider,mentionProvider:t.mentionProvider,...a?.mentionsPlugin}],!!t.mentionProvider).maybeAdd([d.emojiPlugin,{emojiProvider:t.emojiProvider,...(0,M.expValEquals)("platform_editor_plain_text_support","isEnabled",!0)?a?.emojiPlugin:{}}],!!t.emojiProvider).maybeAdd([B.default,{tableOptions:t.allowTables&&"boolean"!=typeof t.allowTables?t.allowTables:{},dragAndDropEnabled:o?.tableDragAndDrop&&(U||(F||V)&&(0,x.editorExperiment)("support_table_in_comment",!0,{exposure:!0}))||F&&(0,x.editorExperiment)("support_table_in_comment_jira",!0,{exposure:!0}),isTableScalingEnabled:U||F&&(0,x.editorExperiment)("support_table_in_comment",!0,{exposure:!0})||F&&(0,x.editorExperiment)("support_table_in_comment_jira",!0,{exposure:!0}),allowContextualMenu:!0,fullWidthEnabled:"full-width"===e,wasFullWidthEnabled:R&&"full-width"===R,getEditorFeatureFlags:X,isCommentEditor:F,isChromelessEditor:V}],!!t.allowTables).maybeAdd([I.tasksAndDecisionsPlugin,{allowNestedTasks:t.allowNestedTasks,consumeTabs:U,useLongPressSelection:!1,taskDecisionProvider:t.taskDecisionProvider,...a?.tasksAndDecisionsPlugin}],!!(t.allowTasksAndDecisions||t.taskDecisionProvider)).maybeAdd([f.feedbackDialogPlugin,{coreVersion:n("75KVc").version,...t.feedbackInfo}],!!t.feedbackInfo).maybeAdd([y.helpDialogPlugin,!!t.legacyImageUploadProvider],!!t.allowHelpDialog).maybeAdd([v.saveOnEnterPlugin,t.onSave],!!(t.saveOnEnter&&t.onSave)).maybeAdd(n("kwFBr").imageUploadPlugin,!!t.legacyImageUploadProvider).maybeAdd([E.mediaPlugin,{allowMediaSingle:{disableLayout:!0},allowMediaGroup:!1,isCopyPasteEnabled:!0}],!!(t.legacyImageUploadProvider&&!t.media)).maybeAdd([n("5AZDw").collabEditPlugin,{...t.collabEdit,sanitizePrivateContent:t.sanitizePrivateContent,EXPERIMENTAL_allowInternalErrorAnalytics:t.collabEdit?.EXPERIMENTAL_allowInternalErrorAnalytics??(0,n("NPJKR").shouldForceTracking)()}],!!(t.collabEdit||t.collabEditProvider)).maybeAdd([n("h8AH9").default,t.maxContentSize],!!t.maxContentSize).maybeAdd([T.default,{useLongPressSelection:!1,allowCustomPanel:"object"==typeof t.allowPanel&&t.allowPanel.allowCustomPanel,allowCustomPanelEdit:"object"==typeof t.allowPanel&&t.allowPanel.allowCustomPanelEdit}],!!t.allowPanel).maybeAdd(n("1nZXu").contextPanelPlugin,!!U).maybeAdd([u.extensionPlugin,{breakoutEnabled:"full-page"===e&&!1!==("object"!=typeof t.allowExtension||t.allowExtension.allowBreakout),extensionHandlers:t.extensionHandlers,useLongPressSelection:!1,appearance:e,...a?.extensionPlugin}],!!t.allowExtension).maybeAdd([n("cpn0f").annotationPlugin,void 0],!!(!t.annotationProviders&&t.allowConfluenceInlineComment)).maybeAdd([c.default,{weekStartDay:"object"==typeof t.allowDate?t.allowDate.weekStartDay:void 0}],!!t.allowDate).maybeAdd([n("8HLyI").default,!0!==t.allowTemplatePlaceholders?t.allowTemplatePlaceholders:{}],!!t.allowTemplatePlaceholders).maybeAdd([b.layoutPlugin,{..."object"==typeof t.allowLayouts?t.allowLayouts:{},useLongPressSelection:!1,UNSAFE_allowSingleColumnLayout:"object"==typeof t.allowLayouts?t.allowLayouts.UNSAFE_allowSingleColumnLayout:void 0,editorAppearance:e}],!!t.allowLayouts).maybeAdd([l.cardPlugin,{...t.UNSAFE_cards,...t.smartLinks,...t.linking?.smartLinks,fullWidthMode:"full-width"===e,linkPicker:t.linking?.linkPicker,lpLinkPicker:o.lpLinkPicker??!1,editorAppearance:e,__livePage:t.__livePage}],!!(t.linking?.smartLinks||t.smartLinks||t.UNSAFE_cards)).maybeAdd([n("bS1lJ").customAutoformatPlugin,{autoformattingProvider:t.autoformattingProvider}],!!t.autoformattingProvider).maybeAdd([O.statusPlugin,{menuDisabled:W,allowZeroWidthSpaceAfter:!0}],!!t.allowStatus).maybeAdd([w.syncedBlockPlugin,t.syncBlock],!!t.syncBlock&&(0,x.editorExperiment)("platform_synced_block",!0)).maybeAdd(S.indentationPlugin,!!t.allowIndentation).maybeAdd(n("1GAIu").scrollIntoViewPlugin,!1!==t.autoScrollIntoView).add([N.toolbarListsIndentationPlugin,{showIndentationButtons:!!t.showIndentationButtons,allowHeadingAndParagraphIndentation:!!t.allowIndentation}]).add([h.insertBlockPlugin,{allowTables:!!t.allowTables,allowExpand:L(t),insertMenuItems:t.insertMenuItems,horizontalRuleEnabled:t.allowRule,tableSelectorSupported:o?.tableSelector&&U,nativeStatusSupported:!W,showElementBrowserLink:t.elementBrowser&&t.elementBrowser.showModal||!1,appearance:e,...a?.insertBlockPlugin}]).maybeAdd([n("ksXET").beforePrimaryToolbarPlugin,{beforePrimaryToolbarComponents:t.primaryToolbarComponents?.before}],!!(G(t.primaryToolbarComponents)&&!o.twoLineEditorToolbar)).add([r.avatarGroupPlugin,{collabEdit:t.collabEdit,takeFullWidth:!G(t.primaryToolbarComponents),showAvatarGroup:!0===o.showAvatarGroupAsPlugin&&!o.twoLineEditorToolbar}]).maybeAdd([g.findReplacePlugin,{takeFullWidth:!1==!!o.showAvatarGroupAsPlugin&&!G(t.primaryToolbarComponents),twoLineEditorToolbar:!!t.primaryToolbarComponents&&!!o.twoLineEditorToolbar}],!!t.allowFindReplace).maybeAdd(n("hSJYu").borderPlugin,!!t.allowBorderMark).maybeAdd(n("6q6xk").fragmentPlugin,!!t.allowFragmentMark).add(n("59fTa").pasteOptionsToolbarPlugin).maybeAdd([n("01uqX").codeBidiWarningPlugin,{appearance:e}],!(0,M.expValEquals)("platform_editor_remove_bidi_char_warning","isEnabled",!0))}({appearance:e.appearance,props:(0,n("1B55v").getDefaultPresetOptionsFromEditorProps)(e),initialPluginConfiguration:o,featureFlags:(0,n("6DQRK").createFeatureFlagsFromProps)(e.featureFlags),prevAppearance:t?.appearance})}function j({props:e,initialPluginConfiguration:t}){let o=(0,n("7541v").default)(e),[i,r]=(0,a.useState)(()=>R({props:e,prevProps:o,initialPluginConfiguration:t}));return(0,a.useLayoutEffect)(()=>{o&&["appearance","persistScrollGutter","allowUndoRedoButtons","placeholder","sanitizePrivateContent"].reduce((t,n)=>t||o[n]!==e[n],!1)&&r(R({props:e,prevProps:o,initialPluginConfiguration:t}))},[e,o,t]),i}}),o("ksXET",function(e,t){var o=n("l998X");n("42omo");let a={name:"4jjuk5",styles:"display:flex;margin-right:var(--ds-space-100, 8px);flex-grow:1;justify-content:flex-end;align-items:center"},i=e=>(0,n("9K4OG").jsx)("div",{css:a,"data-testid":"before-primary-toolbar-components-plugin"},e.beforePrimaryToolbarComponents);e.exports.beforePrimaryToolbarPlugin=({api:e,config:t})=>{let n=()=>(0,o.jsx)(i,{beforePrimaryToolbarComponents:t?.beforePrimaryToolbarComponents});return e?.primaryToolbar?.actions.registerComponent({name:"beforePrimaryToolbar",component:n}),{name:"beforePrimaryToolbar",primaryToolbarComponent:e?.primaryToolbar?void 0:n}}}),o("lBdHV",function(e,t){let o="override-document";class a extends n("cO9ey").Step{apply(e){return this.oldDocumentSize=e.content.size,n("aXG5V").StepResult.ok(this.nextDocument)}map(){return new a({nextDocument:this.nextDocument,inverted:this.inverted})}getMap(){if(!this.nextDocument||!this.oldDocumentSize)return new(0,n("aXG5V").StepMap)([0,0,0]);let e=this.oldDocumentSize,t=this.nextDocument.content.size;return new(0,n("aXG5V").StepMap)([0,e,t])}invert(e){return new a({nextDocument:e,inverted:!0})}toJSON(){return{stepType:o,inverted:this.inverted,nextDocument:this.nextDocument.toJSON()}}static fromJSON(e,t){if(!t||t.stepType!==o)throw RangeError("Invalid overrideDocument step OverrideDocumentStep.fromJSON");return new a({inverted:t.inverted,nextDocument:e.nodeFromJSON(t.nextDocument)})}constructor(e){super(),this.inverted=!1,this.nextDocument=void 0,this.oldDocumentSize=0;let{inverted:t,nextDocument:n}=e;if("doc"!==n.type.name)throw Error("nextDocument should be the entire prosemirror doc node and not only its content.");this.nextDocument=n,this.inverted=!!t}}n("cO9ey").Step.jsonID(o,a),e.exports.OverrideDocumentStep=a}),o("3Vesv",function(e,t){let o,a,i;var r=n("l998X");n("42omo");var s=n("3pLGZ"),l=e=>{let t,n,o,a,i;return -1!==(a=e.indexOf("OPR/"))?(t="Opera",n=e.substring(a+4)):-1!==(a=e.indexOf("Opera"))?(t="Opera",n=-1!==(a=e.indexOf("Version"))?e.substring(a+8):e.substring(a+6)):-1!==(a=e.indexOf("MSIE"))?(t="Microsoft Internet Explorer",n=e.substring(a+5)):-1!==(a=e.indexOf("Chrome"))?(t="Chrome",n=e.substring(a+7)):-1!==(a=e.indexOf("Safari"))?(t="Safari",n=-1!==(a=e.indexOf("Version"))?e.substring(a+8):e.substring(a+7)):-1!==(a=e.indexOf("Firefox"))?(t="Firefox",n=e.substring(a+8)):(o=e.lastIndexOf(" ")+1)<(a=e.lastIndexOf("/"))?(t=e.substring(o,a),n=e.substring(a+1),t.toLowerCase()===t.toUpperCase()&&(t=navigator.appName)):(t=navigator.appName,n=""+parseFloat(navigator.appVersion)),-1!==(i=n.indexOf(";"))&&(n=n.substring(0,i)),-1!==(i=n.indexOf(" "))&&(n=n.substring(0,i)),`${t} ${n}`},c=(e,t)=>{let n,o="",a="",i=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(let t in i){let n=i[t];if(n.r.test(e)){o=n.s;break}}switch(/Windows/.test(o)&&(a=(n=/Windows (.*)/.exec(o))&&n[1],o="Windows"),o){case"Mac OS X":a=(n=/Mac OS X (10[\.\_\d]+)/.exec(e))&&n[1];break;case"Android":a=(n=/Android ([\.\_\d]+)/.exec(e))&&n[1];break;case"iOS":a=(n=/OS (\d+)_(\d+)_?(\d+)?/.exec(t))&&n[1]+"."+n[2]+"."+(n[3]||0)}return`${o} ${a}`},d=(e,t,n,o,a,i,r)=>new Promise(async(s,d)=>{window.jQuery?(window.ATL_JQ_PAGE_PROPS={triggerFunction:e=>{"function"==typeof e?s(e):d("Failed to initialize showCollectorDialog")},fieldValues:{description:`Please describe the problem you're having or feature you'd like to see:


`,customfield_11711:e||[],customfield_11712:`version: ${t}@${o} (${n})
              Browser: ${l(navigator.userAgent)}
              OS: ${c(navigator.userAgent,navigator.appVersion)}`},environment:{"Editor Package":t,"Editor Version":o,"Editor Core Version":n,sessionId:a,contentId:i,tabId:r},priority:"1",components:"15306"},window.jQuery.ajax({url:"https://product-fabric.atlassian.net/s/d41d8cd98f00b204e9800998ecf8427e-T/-w0bwo4/b/14/e73395c53c3b10fde2303f4bf74ffbf6/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-US&collectorId=98644b9c",type:"get",cache:!0,dataType:"script"})):d("jQuery is not defined")});let p=e=>{let{product:t,packageName:n,packageVersion:o,labels:a}=e;return[t,n,o,...a||[]].join("|")},u=async e=>new Promise(async(t,n)=>{let r={product:"n/a",labels:[],packageName:"",packageVersion:"",coreVersion:"",sessionId:"",contentId:"",tabId:"",...i,...e},s=p(r);if(!o||a!==s)try{o=await d([r.product,...r.labels],r.packageName,r.coreVersion,r.packageVersion,r.sessionId,r.contentId,r.tabId),a=s}catch(e){n(e)}t(window.setTimeout(o,0))});e.exports.feedbackDialogPlugin=({config:e,api:t})=>(i=e??{},{name:"feedbackDialog",actions:{openFeedbackDialog:u},pluginsOptions:{quickInsert:({formatMessage:o})=>[{id:"feedbackdialog",title:o(n("4HWgE").toolbarInsertBlockMessages.feedbackDialog),description:o(n("4HWgE").toolbarInsertBlockMessages.feedbackDialogDescription),priority:400,keywords:["bug"],icon:()=>(0,r.jsx)(s.IconFeedback,{}),action(o,a){let i=o("");return u(e),t?.analytics?.actions.attachAnalyticsEvent({action:n("d925B").ACTION.OPENED,actionSubject:n("d925B").ACTION_SUBJECT.FEEDBACK_DIALOG,attributes:{inputMethod:n("d925B").INPUT_METHOD.QUICK_INSERT},eventType:n("d925B").EVENT_TYPE.UI})(i),i}}]}})}),o("kwFBr",function(e,t){var o=n("8m4tT");let a=e=>{let{media:t}=e.schema.nodes;return e.selection instanceof n("ks2lK").NodeSelection&&e.selection.node.type===t},i=e=>{let{mediaSingle:t}=e.schema.nodes,{$to:n}=e.selection;if(t)for(let e=n.depth;e>=0;e--){let o=n.index(e);if(n.node(e).canReplaceWith(o,o,t))return!0}return!1},r=(e,t)=>{let{media:n,mediaSingle:o}=t.nodes;if(!n||!o)return null;let a=n.createChecked({type:"external",url:e});return o.createChecked({},a)},s=new(0,n("ks2lK").PluginKey)("imageUploadPlugin"),l=(e,t)=>e.setMeta(s,t),c=e=>t=>l(t,{name:"START_UPLOAD",event:e}),d=e=>(t,n)=>{let a=s.getState(t);if(!a?.enabled||!e.src)return!1;let i=r(e.src,t.schema);return!!i&&(n&&n((0,o.safeInsert)(i,t.selection.$to.pos)(t.tr).scrollIntoView()),!0)},p=e=>(t,n)=>{let o=s.getState(t);return(!o||!!o.enabled)&&(n&&n(c(e)(t.tr)),!0)},u=e=>(t,n)=>!!e.current&&(e.current(void 0,e=>{d(e)(t,n)}),!0);var f=function(e,t){if(!e.nodes.media||!e.nodes.mediaSingle)return;let o=(0,n("l03WE").createRule)(/!\[(.*)\]\((\S+)\)$/,(e,t,n,o)=>{let{schema:a}=e,i=r({src:t[2],alt:t[1]}.src,a);return i?e.tr.replaceWith(n,o,i):null});return new(0,n("1S4f7").SafePlugin)((0,n("aIMBk").createPlugin)("image-upload",[o]))};let g=e=>"clipboardData"in e,m=e=>"dataTransfer"in e;function y(e){return!!e.dataTransfer&&-1!==Array.prototype.slice.call(e.dataTransfer.types).indexOf("Files")}let S=e=>{let{clipboardData:t}=e;if(!t||1!==t.files.length)return!1;let n=!!t.getData("text/plain"),o=t.getData("text/html").includes("urn:schemas-microsoft-com:office:office"),a=t.files[0];return"image/png"===a.type&&"image.png"===a.name&&n&&o},h=e=>{if(!m(e)&&!g(e))return null;let t=m(e)?e.dataTransfer?.files:e.clipboardData?.files;if(!t)return null;let n=Array.from(t).reduce((e,t)=>(e.items.add(t),e),new DataTransfer);return{type:m(e)?"drop":"paste",...m(e)&&{dataTransfer:n},...g(e)&&{clipboardData:n}}},b=(e,t,n)=>(t,o)=>{if(!e(o))return!1;let a=!S(o),i=h(o);return a&&i&&(o.preventDefault(),o.stopPropagation(),n.current&&n.current(i,e=>{d(e)(t.state,t.dispatch)}),p(i)(t.state,t.dispatch)),a},k=(e,t)=>{let n=e.getMeta(s);return n&&"START_UPLOAD"===n.name?{event:n.event}:t.activeUpload},E=e=>({dispatch:t,providerFactory:o})=>new(0,n("1S4f7").SafePlugin)({state:{init:(e,t)=>({active:!1,enabled:i(t),hidden:!t.schema.nodes.media||!t.schema.nodes.mediaSingle}),apply(e,n,o,r){let l=a(r),c=i(r),d=k(e,n);if(l!==n.active||c!==n.enabled||d!==n.activeUpload){let e={...n,active:l,enabled:c,activeUpload:d};return t(s,e),e}return n}},key:s,view:()=>{let t=async(t,n)=>{if("imageUploadProvider"===t&&n)try{e.current=await n}catch(t){e.current=null}};return o.subscribe("imageUploadProvider",t),{destroy(){e.current=null,o.unsubscribe("imageUploadProvider",t)}}},props:{handleDOMEvents:{drop:b(y,"atlassian.editor.image.drop",e),paste:b(e=>(0,n("8gdgt").isPastedFile)(e),"atlassian.editor.image.paste",e)}}});e.exports.imageUploadPlugin=()=>{let e={current:null};return{name:"imageUpload",getSharedState(e){if(e)return s.getState(e)},actions:{startUpload:()=>u(e)},pmPlugins:()=>[{name:"imageUpload",plugin:E(e)},{name:"imageUploadInputRule",plugin:({schema:e,featureFlags:t})=>f(e,t)}]}}});
//# sourceMappingURL=FullPageEditorComponent.5b6e73e3.js.map
