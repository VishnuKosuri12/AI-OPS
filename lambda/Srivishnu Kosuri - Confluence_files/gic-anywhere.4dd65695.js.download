var e=globalThis.parcelRequired477,a=e.register;a("cfwlu",function(a,i){var r=e("l998X"),t=e("42omo"),s=e("liF9q");let o={loading:"loading",timeout:"timeout",error:"error",idle:"idle"},n={hiddenDisplay:"_1e0cglyw",gicAnywhere:"_1bsb1osq _4t3i1osq",loadingScreen:"_1e0c1txw _2lx21bp4 _4cvr1h6o _1bah1h6o _y3gn1h6o"},l=({cloudId:a,overrideCloudId:i,configuration:l,summary:c,assignee:u,descriptionAdf:m,consumer:E,timeoutMs:_=e("7u9UW").DEFAULT_TIMEOUT,onInit:f,onSuccess:g,onFailure:p,onClose:A,onTimeout:I,projectId:b,issueTypeId:S,issueTypes:h,isPayloadReady:y=!1,additionalMappedFields:v,baseUrlForAvailableSites:C})=>{let{availableSites:R,domainName:x,isOverrideSiteAvailable:w}=(0,e("g5o3i").useGetDomainAndAvailableSites)({cloudId:a,overrideCloudId:i,baseUrlForAvailableSites:C}),T=R&&R.length>1,[M,j]=(0,t.useState)(o.loading),{createAnalyticsEvent:D}=(0,e("inPa6").useAnalyticsEvents)(),{formatMessage:U}=(0,e("8C5kA").default)();(0,t.useEffect)(()=>{let a=(()=>{switch(M){case o.loading:return setTimeout(()=>{(0,e("3C50A").fireOperationalAnalytics)(D({}),"globalIssueCreateEmbed timedOut",{consumer:E,timeoutMs:_}),j(o.timeout),I?.()},_);case o.timeout:return setTimeout(()=>{(0,e("3C50A").fireOperationalAnalytics)(D({}),"globalIssueCreateEmbed error",{consumer:E,timeoutMs:2*_}),j(o.error),p(Error("GIC has timed out"))},_)}})();return()=>a&&clearTimeout(a)},[E,D,p,I,M,_]);let F=(0,t.useCallback)(()=>(j(o.idle),{summary:c||"No summary provided",descriptionAdf:m||(0,e("b4emg").getEmptyADF)(),projectId:b,issueTypeId:S,issueTypes:h?.join(","),assignee:u,fieldData:v}),[c,m,b,S,h,u,v]),O=(0,t.useMemo)(()=>{switch(M){case o.timeout:case o.loading:return(0,r.jsxs)(e("gdv5Z").default,{testId:"gic-anywhere-loading",xcss:(0,e("1Whri").cx)(n.gicAnywhere,n.loadingScreen),children:[(0,r.jsx)(e("9hlns").default,{size:"large"}),(0,r.jsx)(e("iXCQx").default,{children:U(M===o.timeout?e("4SDuV").messages.iFrameSlowLoading:e("4SDuV").messages.iFrameLoading,{br:(0,r.jsx)("br",{})})})]});case o.error:return(0,r.jsx)(e("gdv5Z").default,{testId:"gic-anywhere-error",xcss:n.gicAnywhere,children:(0,r.jsx)(e("abC4X").default,{header:U(e("4SDuV").messages.errorHeader),description:U(e("4SDuV").messages.errorBody),primaryAction:(0,r.jsx)(e("7p4As").default,{onClick:()=>{A()},href:x||"/",target:"_blank",appearance:"primary",children:U(e("4SDuV").messages.openInJiraButton)}),imageUrl:s&&s.__esModule?s.default:s,imageWidth:e("7u9UW").MAX_ERROR_IMAGE_WIDTH,maxImageWidth:e("7u9UW").MAX_ERROR_IMAGE_WIDTH,maxImageHeight:e("7u9UW").MAX_ERROR_IMAGE_HEIGHT})});default:return}},[M,U,x,A]);return(0,r.jsxs)(r.Fragment,{children:[O,(0,r.jsx)(e("fwDOR").default,{name:"gic-anywhere-iframe-loading",hold:M===o.loading}),(0,r.jsx)(e("gdv5Z").default,{xcss:M!==o.idle?n.hiddenDisplay:n.gicAnywhere,children:void 0!==x&&(0,r.jsx)(d,{domainName:x,consumer:E,onGICReady:F,onInit:f,onSuccess:g,onFailure:p,onClose:A,configuration:l,displaySitePicker:T,isPayloadReady:y,overrideCloudId:w?i:void 0})})]})},d=({onGICReady:a,consumer:i,domainName:s,overrideCloudId:o,onClose:n,onFailure:l,onSuccess:d,onInit:u,configuration:m,displaySitePicker:E=!0,isPayloadReady:_=!1})=>{(0,e("fBMbo").di)(c);let f=(0,t.useRef)(null),{createAnalyticsEvent:g}=(0,e("inPa6").useAnalyticsEvents)(),{colorMode:p}=(0,e("cOrQJ").default)(),[A,I]=(0,t.useState)(!1),[b,S]=(0,t.useState)(!1),h=(0,t.useRef)(b),y=(0,t.useRef)(a);y.current=a;let v=(0,t.useMemo)(()=>({product:i,actionSource:"issue-create-anywhere-embed"}),[i]),C=(0,t.useMemo)(()=>{if(u)return(0,e("dh538").fg)("jira_ai_fix_aiwc_duplicated_analytics")?(0,e("0XxK1").debounce)(()=>u(),2e3):u},[u]);(0,t.useEffect)(()=>()=>{C&&"function"==typeof C.cancel&&C.cancel()},[C]),(0,t.useEffect)(()=>{let a=async a=>{if(!f.current?.contentWindow)return;let r=a?.data?.event,t=g({});switch(r){case e("4KAVh").JIRA_EMBED_ISSUE_CREATE_READY:(0,e("3C50A").fireOperationalAnalytics)(t,"globalIssueCreateEmbed initialised",{consumer:i}),S(!0);break;case e("4KAVh").JIRA_EMBED_ISSUE_CREATE_SUCCESS:I(!0),d(a.data.payload),(0,e("3C50A").fireTrackAnalytics)(t,"globalIssueCreateEmbed succeeded",{consumer:i});break;case e("4KAVh").JIRA_EMBED_ISSUE_CREATE_FAILURE:l(Error("issueCreate failed to save")),(0,e("3C50A").fireOperationalAnalytics)(t,"globalIssueCreateEmbed failed",{consumer:i});break;case e("4KAVh").JIRA_EMBED_ISSUE_CREATE_CLOSE:n(A),A||(0,e("3C50A").fireUIAnalytics)(t,"globalIssueCreateEmbed closed",{consumer:i})}};return window.addEventListener("message",a),()=>{window.removeEventListener("message",a)}},[f,i,g,u,n,l,d,A,I,S]),(0,t.useEffect)(()=>{_&&b&&Promise.resolve(y.current()).then(a=>{let i=f.current?.contentWindow;if(i){let{fieldData:r,...t}=a??{};i.postMessage({event:e("4KAVh").JIRA_EMBED_ISSUE_CREATE_INIT,payload:{defaultValues:t,...r&&{fieldData:{...r,...t}}}},"*"),C?.()}})},[_,b,y,C]);let R=(0,e("0XxK1").getIframeSrc)({colorMode:p,domainName:s,params:v,displaySitePicker:!(0,e("dh538").fg)("jira_ai_gic_embed_exception_on_timeout")||E,...m,overrideCloudId:o});return(0,t.useEffect)(()=>{(0,e("dh538").fg)("jira_ai_gic_embed_exception_on_timeout")&&(h.current=b)},[b]),(0,t.useEffect)(()=>{(0,e("dh538").fg)("jira_ai_gic_embed_exception_on_timeout")&&S(!1)},[R]),(0,t.useEffect)(()=>{if(!(0,e("dh538").fg)("jira_ai_gic_embed_exception_on_timeout"))return;let a=setTimeout(()=>{if(!h.current)throw Error("jira-ai/gic-anywhere: The latest GIC iframe window was not initialized")},1e4);return()=>clearTimeout(a)},[R]),(0,r.jsx)(c,{name:"gic-anywhere-iframe",sandbox:void 0,ref:f,height:"100%",width:"100%",frameBorder:0,src:R,"data-testid":"gic-anywhere"})},c=(0,t.forwardRef)((e,a)=>(0,r.jsx)("iframe",{title:"Jira Embed Global Issue Create",ref:a,...e}));a.exports.GicAnywhere=a=>(0,r.jsx)(e("0XxK1").AnalyticsProvider,{children:(0,r.jsx)(e("fVTNs").ContextWrapper,{sourceType:e("bHD89").MODAL,sourceName:"gicAnywhere",children:(0,r.jsx)(l,{...a})})})}),a("liF9q",function(e,a){e.exports=new URL("error.5fbc7fe9.png",import.meta.url).toString()}),a("4KAVh",function(e,a){e.exports.ERROR_IFRAME_SOURCE_CHAR_LIMIT_EXCEEDED="Jira GIC Anywhere - Iframe Source character limit exceeded",e.exports.JIRA_EMBED_ISSUE_CREATE_INIT="jiraEmbedIssueCreateInit",e.exports.JIRA_EMBED_ISSUE_CREATE_READY="jiraEmbedIssueCreateReady",e.exports.JIRA_EMBED_ISSUE_CREATE_SUCCESS="jiraEmbedIssueCreateSuccess",e.exports.JIRA_EMBED_ISSUE_CREATE_FAILURE="jiraEmbedIssueCreateAppFailed",e.exports.JIRA_EMBED_ISSUE_CREATE_CLOSE="jiraEmbedIssueCreateClose"}),a("0XxK1",function(a,i){var r=e("l998X"),t=e("42omo");let s={env:"prod",product:"jira"},o="auto",n=["jira-software.ondemand","jira-core.ondemand","jira-servicedesk.ondemand","jira-product-discovery"];async function l(a){let i={method:"POST",credentials:"include",headers:{Accept:"application/json","Cache-Control":"no-cache","Content-Type":"application/json"},body:JSON.stringify({products:n})},r=a?a.replace(/\/$/,""):"",t=(0,e("dh538").fg)("issue_create_modal_site_picker_api_unit_compliant")?"/gateway/api/experimental/available-sites":"/gateway/api/available-sites",s=await fetch(`${r}${t}`,i);if(s.ok)return s.json();throw s}a.exports.getIframeSrc=({colorMode:a=o,domainName:i="",overrideCloudId:r,params:t,onFailure:s,displaySitePicker:n,disableProjectDropdown:l,displayOnlyRequiredFields:d})=>{let c=new URLSearchParams(t);c.append("postMessageInit","1"),!1===n&&c.append("displaySitePicker","false"),l&&c.append("disableProjectDropdown","true"),d&&c.append("displayOnlyRequiredFields","true"),a&&c.append("themeMode",a),r&&c.append("overrideCloudId",r);let u=`${i}/jira/issues/create/embed?${c}`;return u.length>2048&&s?.(Error(e("4KAVh").ERROR_IFRAME_SOURCE_CHAR_LIMIT_EXCEEDED)),u},a.exports.getAvailableJiraSites=l,a.exports.AnalyticsProvider=a=>{let i=(0,t.useRef)(new(0,e("a9sR2").default)(s,{})),o=(0,t.useCallback)(a=>{let{type:r,payload:t}=a;switch(r){case e("bHD89").UI_EVENT_TYPE:i.current.sendUIEvent(t);break;case e("bHD89").TRACK_EVENT_TYPE:i.current.sendTrackEvent(t);break;case e("bHD89").OPERATIONAL_EVENT_TYPE:i.current.sendOperationalEvent(t);break;case e("bHD89").SCREEN_EVENT_TYPE:i.current.sendScreenEvent(t.name,null,t.attributes)}},[]);return(0,r.jsx)(e("kDuN4").default,{channel:e("bHD89").ANALYTICS_BRIDGE_CHANNEL,onEvent:a=>o((0,e("hzZxz").extractAWCDataFromEvent)(a)),children:a.children})},a.exports.debounce=(a,i)=>{let r;if(!(0,e("dh538").fg)("jira_ai_fix_aiwc_duplicated_analytics"))return a;let t=(...e)=>{clearTimeout(r),r=setTimeout(()=>{r=void 0,a(...e)},i)};return t.cancel=()=>{clearTimeout(r)},t}}),a("g5o3i",function(a,i){var r=e("42omo");let t=({onComplete:a,onError:i,baseUrlForAvailableSites:t})=>{(0,e("fBMbo").di)(e("0XxK1").getAvailableJiraSites);let[s,o]=(0,r.useState)([]),[n,l]=(0,r.useState)(!1),[d,c]=(0,r.useState)(void 0),u=(0,r.useRef)(!1);return(0,r.useEffect)(()=>{u.current||(l(!0),(async()=>{try{let{sites:i}=await (0,e("0XxK1").getAvailableJiraSites)(t);o(i??[]),a?.({availableSites:i})}catch(e){i&&i(e),c(e.message)}finally{l(!1)}})(),u.current=!0)},[t,a,i]),{availableSites:s,loading:n,error:d}},s=({sites:e,preferredCloudId:a})=>({domain:(e.find(e=>e.cloudId===a)??e[0])?.url??""});a.exports.useGetFirstAvailableSiteDomain=({preferredCloudId:a,onComplete:i,onError:t})=>{(0,e("fBMbo").di)(e("0XxK1").getAvailableJiraSites);let[s,o]=(0,r.useState)(void 0),[n,l]=(0,r.useState)([]),[d,c]=(0,r.useState)(!1),[u,m]=(0,r.useState)(void 0);return(0,r.useEffect)(()=>{(async()=>{c(!0);try{let{sites:r}=await (0,e("0XxK1").getAvailableJiraSites)();l(r??[]);let t=(r.find(e=>e.cloudId===a)??r[0])?.url??"";o(t),i?.({domain:t,availableSites:r})}catch(e){t&&t(e),m(e.message)}finally{c(!1)}})()},[a,i,t]),{domain:s,availableSites:n,loading:d,error:u}},a.exports.useGetDomainAndAvailableSites=({cloudId:e,overrideCloudId:a,baseUrlForAvailableSites:i})=>{let{availableSites:r,loading:o,error:n}=t({baseUrlForAvailableSites:i}),{domain:l}=s({sites:r,preferredCloudId:e}),{domain:d}=s({sites:r,preferredCloudId:a});if(n)throw Error("Failed to fetch available sites");return o?{availableSites:[],domainName:void 0,isOverrideSiteAvailable:void 0}:{availableSites:r,domainName:l,isOverrideSiteAvailable:d}}}),a("7u9UW",function(e,a){e.exports.DEFAULT_TIMEOUT=7e3,e.exports.MAX_ERROR_IMAGE_WIDTH=188,e.exports.MAX_ERROR_IMAGE_HEIGHT=250}),a("4SDuV",function(a,i){let r=(0,e("cgtv4").defineMessages)({iFrameLoading:{id:"jira-ai.gic-anywhere.iframe-loading",defaultMessage:"Loading work item details, this might take a few seconds."},iFrameSlowLoading:{id:"jira-ai.gic-anywhere.iframe-slow-loading",defaultMessage:"It is taking longer than usual to load your work item.{br}Give it a few more seconds, or try again later."},openInJiraButton:{id:"jira-ai.gic-anywhere.open-in-jira-button",defaultMessage:"Log in to Jira to view"},errorHeader:{id:"jira-ai.gic-anywhere.error-header",defaultMessage:"Something's gone wrong"},errorBody:{id:"jira-ai.gic-anywhere.error-body",defaultMessage:"Try opening this in Jira. If the problem persists, please contact Atlassian support."}});a.exports.messages=r});
//# sourceMappingURL=gic-anywhere.4dd65695.js.map
