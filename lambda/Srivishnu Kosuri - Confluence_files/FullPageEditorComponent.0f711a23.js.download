function e(e,t,o,n){Object.defineProperty(e,t,{get:o,set:n,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var o=globalThis,n={},a={},r=o.parcelRequired477;null==r&&(r=function(e){var t=n[e];if(void 0!==t)return t.exports;var o=a[e];if(void 0!==o){delete a[e];var r={id:e,exports:{}};return n[e]=r,o.call(r.exports,r,r.exports),r.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i},r.register=function(e,t){a[e]=t},o.parcelRequired477=r);var i=r.register;o.lb||(o.lb=new Set,o.bq=[],o.rlb=e=>{o.lb.add(e),o.pq()},o.rwr=(e,t,n)=>{o.bq.push({b:e,r:t,d:n}),o.pq()},o.pq=()=>{var e=o.bq.find(e=>e.d.every(e=>o.lb.has(e)));e&&(o.bq=o.bq.filter(t=>t.b!==e.b),e.r(),o.pq())}),i("eiCiP",function(e,t){async function o(){let{userId:e,isLicensed:t}=(0,r("xwvlW").getPreloaderFnContext)();return(0,r("i6sMX").getRemoteLocalStorage)({userId:e,isLicensed:t})}e.exports.preloadLocalStorage=o}),i("8nle6",function(t,o){e(t.exports,"preloadSpaceDetail",()=>r("5SzHz").preloadSpaceDetail),e(t.exports,"preloadPersonalSpaceDetail",()=>r("jLyos").preloadPersonalSpaceDetail),e(t.exports,"ConfluenceSpaceType",()=>r("bgmQP").ConfluenceSpaceType);let n=(0,r("jmjWc").LoadableAfterPaint)({__loadable_id__:"7NksR",name:"SpaceTargetSelect",loader:async()=>(await Promise.resolve(r("bgmQP"))).SpaceTargetSelect});t.exports.SpaceTargetSelect=n}),i("bgmQP",function(e,o){var n,a=r("3u0dr"),i=r("frIzR"),s=r("42omo"),l=((n={}).ALL="ALL",n.ALL_EXCEPT_PERSONAL="ALL_EXCEPT_PERSONAL",n.ALL_EXCEPT_SPECIFIC="ALL_EXCEPT_SPECIFIC",n.PERSONAL="PERSONAL",n.SPECIFIC="SPECIFIC",n);let d=(0,r("cgtv4").defineMessages)({ariaLabel:{id:"space-utils.permissions-export.form.space-target-select.aria-label",defaultMessage:"For which spaces"},all:{id:"space-utils.space-target-select.all",defaultMessage:"All"},allDescription:{id:"space-utils.space-target-select.allDescription",defaultMessage:"All spaces, regardless of type"},allExcludingPersonal:{id:"space-utils.space-target-select.allExcludingPersonal",defaultMessage:"All (excluding personal)"},allExcludingPersonalDescription:{id:"space-utils.space-target-select.allExcludingPersonalDescription",defaultMessage:"Don't include any personal spaces"},allExcludingSpecific:{id:"space-utils.space-target-select.allExcludingSpecific",defaultMessage:"All (excluding specific spaces)"},allExcludingSpecificDescription:{id:"space-utils.space-target-select.allExcludingSpecificDescription",defaultMessage:"Choose specific spaces to exclude"},personal:{id:"space-utils.space-target-select.personal",defaultMessage:"Only personal"},personalDescription:{id:"space-utils.space-target-select.personalDescription",defaultMessage:"All personal spaces"},specific:{id:"space-utils.space-target-select.specific",defaultMessage:"Only specific spaces"},specificDescription:{id:"space-utils.space-target-select.specificDescription",defaultMessage:"Choose specific spaces to include"}}),c={style:"_zulp1b66 _1e0c1txw _2lx21bp4"},p=t(s).memo((0,a.isReactCompilerActiveV1)()?e=>{let o,n,a,l,d=(0,i.c)(10);return d[0]!==e.data.label?(o=t(s).createElement(r("iXCQx").default,null,e.data.label),d[0]=e.data.label,d[1]=o):o=d[1],d[2]!==e.data.description?(n=t(s).createElement(r("iXCQx").default,{color:"color.text.subtlest"},e.data.description),d[2]=e.data.description,d[3]=n):n=d[3],d[4]!==o||d[5]!==n?(a=t(s).createElement(r("gdv5Z").default,{xcss:c.style},o,n),d[4]=o,d[5]=n,d[6]=a):a=d[6],d[7]!==e||d[8]!==a?(l=t(s).createElement(r("3hOY6").components.Option,e,a),d[7]=e,d[8]=a,d[9]=l):l=d[9],l}:e=>t(s).createElement(r("3hOY6").components.Option,e,t(s).createElement(r("gdv5Z").default,{xcss:c.style},t(s).createElement(r("iXCQx").default,null,e.data.label),t(s).createElement(r("iXCQx").default,{color:"color.text.subtlest"},e.data.description)))),u={isSearchable:!1,styles:{menu:e=>({...e,width:"320px",padding:0,margin:0,zIndex:r("dTk3A").layers.modal()+1}),menuPortal:e=>({...e,zIndex:r("dTk3A").layers.modal()+1}),control:e=>({...e,width:"320px",padding:0,margin:0})}},m=[{label:"all",value:"ALL",description:"allDescription"},{label:"allExcludingPersonal",value:"ALL_EXCEPT_PERSONAL",description:"allExcludingPersonalDescription"},{label:"allExcludingSpecific",value:"ALL_EXCEPT_SPECIFIC",description:"allExcludingSpecificDescription"},{label:"personal",value:"PERSONAL",description:"personalDescription"},{label:"specific",value:"SPECIFIC",description:"specificDescription"}],f=(0,a.isReactCompilerActiveV1)()?e=>{let o,n,a,l,c,f,g,h=(0,i.c)(23),{onChange:b,spaceTargetValue:y,menuPortalTarget:_}=e,{formatMessage:S}=(0,r("8C5kA").default)();if(h[0]!==S||h[1]!==b||h[2]!==y){let e,t;h[7]!==S?(e=e=>({label:S(d[e.label]),value:e.value,description:S(d[e.description])}),h[7]=S,h[8]=e):e=h[8];let i=m.map(e);o=r("2gD2K").default,n=i,h[9]!==b?(a=e=>b(e?.value),h[9]=b,h[10]=a):a=h[10],h[11]!==y?(t=e=>String(e.value)===String(y),h[11]=y,h[12]=t):t=h[12],l=i.find(t),h[0]=S,h[1]=b,h[2]=y,h[3]=o,h[4]=n,h[5]=a,h[6]=l}else o=h[3],n=h[4],a=h[5],l=h[6];return h[13]===Symbol.for("react.memo_cache_sentinel")?(c={Option:p},h[13]=c):c=h[13],h[14]!==S?(f=S(d.ariaLabel),h[14]=S,h[15]=f):f=h[15],h[16]!==o||h[17]!==_||h[18]!==n||h[19]!==a||h[20]!==l||h[21]!==f?(g=t(s).createElement(o,{options:n,onChange:a,value:l,components:c,menuPosition:"fixed",menuPortalTarget:_,"aria-label":f,...u}),h[16]=o,h[17]=_,h[18]=n,h[19]=a,h[20]=l,h[21]=f,h[22]=g):g=h[22],g}:({onChange:e,spaceTargetValue:o,menuPortalTarget:n})=>{let{formatMessage:a}=(0,r("8C5kA").default)(),i=m.map(e=>({label:a(d[e.label]),value:e.value,description:a(d[e.description])}));return t(s).createElement(r("2gD2K").default,{options:i,onChange:t=>e(t?.value),value:i.find(e=>String(e.value)===String(o)),components:{Option:p},menuPosition:"fixed",menuPortalTarget:n,"aria-label":a(d.ariaLabel),...u})};e.exports.ConfluenceSpaceType=l,e.exports.SpaceTargetSelect=f}),i("cbHql",function(e,t){var o;let n={fragment:{argumentDefinitions:[],kind:"Fragment",name:"EditorPreferencesQuery",selections:o=[{concreteType:"UserPreferences",kind:"LinkedField",name:"userPreferences",plural:!1,selections:[{concreteType:"ConfluenceEditorSettings",kind:"LinkedField",name:"confluenceEditorSettings",plural:!1,selections:[{kind:"ScalarField",name:"toolbarDockingInitialPosition"}]}]}],type:"Query"},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"EditorPreferencesQuery",selections:o},params:{cacheID:"c67b40e0841cbe3641e147b8f635e291",id:"8cba7661cae04b18a2f396c25dedbd53d2bb4184aef34b7e93cfb70fbef58af5",metadata:{},name:"EditorPreferencesQuery",operationKind:"query",text:"query EditorPreferencesQuery{userPreferences{confluenceEditorSettings{toolbarDockingInitialPosition}}}"}};n.hash="49dd5f6cf6c26477ad455a4c7f501e60",e.exports.default=n}),i("iUV81",function(e,t){r("furnK");var o=r("7WOVi"),n=r("cvj7x");r("8nle6");var a=r("8CHHT"),i=r("hr9NW");let s=(0,r("eSUdr").default)`query LivePageUnifiedQuery($userId:ID$contentId:ID!$spaceKey:String!$isUsdSsr:Boolean!){content(id:$contentId status:["current" "draft"]){nodes{id status type emojiTitlePublished:properties(key:"emoji-title-published"){nodes{id key value version{number}}}emojiTitleDraft:properties(key:"emoji-title-draft"){nodes{id key value version{number}}}contentProperties{latest{defaultTitleEmoji}}properties(key:"content-appearance-draft"){nodes{id key value version{number}}}metadata{frontend{coverPictureWidth}currentuser{favourited{isFavourite}}}contentState(isDraft:false){id name color restrictionLevel isCallerPermitted}contentStateLastUpdated(format:USER_FRIENDLY){value}operations{operation targetType}subType version{number ncsStepVersion by{type ...on KnownUser{accountId}}}labels{nodes{id name}}}}space(key:$spaceKey){id settings{customHeaderAndFooter{header{html js css spaUnfriendlyMacros{name}}footer{html js css spaUnfriendlyMacros{name}}}}}availableContentStates(contentId:$contentId){customContentStates{name color id}spaceContentStates{name color id restrictionLevel}}publicLinkPage(pageId:$contentId)@include(if:$isUsdSsr){pageId pageStatus}user:confluence_atlassianUser(id:$userId){id displayName photos{value isPrimary}}}`;var l=r("dpyxe");let d=async(e,t)=>{let{isLicensed:d,userId:c,edition:p,cloudId:u,activationId:m,accessStatus:f,isLoggedIn:g,isAdminHubAIEnabled:h,isRovoEnabled:b,isRovoLLMEnabled:y,environment:_}=(0,r("xwvlW").getPreloaderFnContext)(),S=[],{spaceKey:E,contentId:v}=e.params,T=(0,r("1swiX").getUsername)(e),C=(0,r("1swiX").getIsEmbeddedConfluence)(e),x=!!(0,r("kM8fE").matchBlogPage)(t);if((0,r("6mKj3").expValEquals)("confluence_live_pages_unified_query_v2","isEnabled",!0)?S.push(function({userId:e,contentId:t,spaceKey:o}){let n=[];if(t){if(n.push((0,r("9OYfw").preloadCollabDraftContent)(t,"",!1)),((0,r("6mKj3").expVal)("platform_editor_smart_card_otp","isEnabled",!1)||(0,r("6mKj3").expVal)("platform_editor_emoji_otp","isEnabled",!1))&&n.push((0,i.preloadEditorNodeDataProvidersData)(t)),(0,r("6mKj3").expValEquals)("confluence_compact_text_format","isEnabled",!0)||(0,r("6mKj3").expValEquals)("cc_editor_ai_content_mode","variant","test")&&(0,r("9wGTI").fg)("platform_editor_content_mode_button_mvp")){let{isArchived:e}=(0,r("9sGCn").getCachedPageData)(t??void 0);n.push((0,r("4trRg").preloadContentMode)({contentId:t,isDraft:!1,useCache:!1,isArchived:e}))}n.push((0,r("kDt9L").preloadMentionsProvider)())}return n.push((0,r("4vyfK").preloadWebItemLocation)({contentId:t,location:r("eSLr0").SYSTEM_CONTENT_BYLINE}),(0,a.preloadUseExtensionList)({spaceKey:o||"",moduleType:r("7Ndnw").FORGE_MODULE_BYLINE,skipFilter:!0})),n.push((0,r("cRQNp").preloadReadTime)({contentId:t,useCache:!1})),(0,r("lyWac").waitForAllReturnWhenError)([(()=>{let n=(0,r("4JHZe").beforePreloaderAsyncCall)();return(0,r("dYU3e").query)({query:s,variables:{userId:e,contentId:t,spaceKey:o,isUsdSsr:(0,r("9wGTI").fg)("confluence_frontend_usd_ssr")},fetchPolicy:"network-only"}).then(e=>{(0,r("4JHZe").afterPreloaderAsyncCall)(n),e.data&&(0,r("dYU3e").writeQuery)({query:r("l1kdf").NativeCollabQuery,variables:{contentId:t,status:["draft","current"]},data:e.data})})})(),...n])}({userId:c,contentId:v,spaceKey:E})):S.push((0,r("kkLBe").prepareGuardExceptionTask)("EditorData",()=>(0,n.preloadEditorData)({spaceKey:E,contentId:v,shouldPreloadMentionsProvider:!0,useCache:!1,cloudId:u,isBlog:x,isLivePage:!0}))),S.push((()=>{let e=(0,r("4JHZe").beforePreloaderAsyncCall)();return(0,o.preloadContentHeader)({spaceKey:E,contentId:v,isLicensed:d,userId:c,username:T,edition:p,isPrevEditRoute:!1,useNewContentTopper:!0,isLivePageRoute:!0}).then(t=>{if((0,r("4JHZe").afterPreloaderAsyncCall)(e),"boolean"==typeof t){if(t)return(0,r("lcQ5b").preloadContentPrerequisites)(v,E)}else{let{results:e,hasErrors:o}=t;return o?(0,r("lcQ5b").preloadContentPrerequisites)(v,E):e}})})(),(0,r("lt4mJ").preloadLegacyBridge)({contentId:v,isBlog:x})),(0,r("6mKj3").expValEquals)("confluence_live_pages_unified_query_v2","isEnabled",!0)||S.push((0,r("gBI6h").preloadPageStatusQuery)(v)),!(0,r("6mKj3").expVal)("platform_editor_smart_card_otp","isEnabled",!1)){let e=`ari:cloud:confluence:${u}:page/${v}`;S.push((0,r("2WwwU").preloadContentSmartLinks)(e,!0))}if((0,r("6mKj3").expValEquals)("confluence_live_pages_unified_query_v2","isEnabled",!0)||S.push((0,r("fyUox").preloadPageTitleContentProperties)({contentId:v,spaceKey:E})),(0,r("6mKj3").expValEquals)("confluence_live_pages_unified_query_v2","isEnabled",!0)||S.push((0,r("5SzHz").preloadSpaceDetail)(E)),(0,r("9wGTI").fg)("confluence_frontend_content_wrapper")&&S.push((0,r("4zhNK").preloadContentTypesHeader)(v,(0,r("9wGTI").fg)("confluence_frontend_content_wrapper"))),!(0,r("6mKj3").expValEquals)("confluence_live_pages_unified_query_v2","isEnabled",!0)&&(0,r("9wGTI").fg)("confluence_frontend_usd_ssr")&&S.push((0,r("gDMf3").preloadShareAndRestrictButtonQuery)(v)),C||S.push((0,l.preloadNavigationTasks)(E,v,d,x)),(0,r("9wGTI").fg)("cc_activation_hide_changeboarding_for_new_users")&&S.push((0,r("4VWAo").preloadSiteUserTraits)()),e?.query.focusedCommentId&&S.push((0,r("kZZXz").preloadFocusedInlineComment)(e?.query.focusedCommentId,v)),(!C||(0,r("1swiX").hasEmbeddedAllowedFeatures)("page-reactions",e))&&(S.push((0,r("5Rwa0").preloadWebPanelLocation)({contentId:v,location:r("eSLr0").ATL_PAGE_CONTENT_FOOTER_ACTIONS})),S.push((0,r("9ycGg").preloadPageReactions)({pageId:v,containerId:E}))),S.push((0,r("1i2qc").preloadMediaToken)(v)),(0,r("6mKj3").expValEquals)("confluence_live_pages_unified_query_v2","isEnabled",!0)||(0,r("iV8Fk").preloadCustomHeaderAndFooter)(E),(f===r("d9tcB").AccessStatus.LICENSED_ADMIN_ACCESS||f===r("d9tcB").AccessStatus.LICENSED_USE_ACCESS||f===r("d9tcB").AccessStatus.EXTERNAL_COLLABORATOR_ACCESS)&&(0,r("6mKj3").expVal)("confluence_centralized_onboarding_state","isEnabled",!1)&&S.push((0,r("1k2r8").preloadAllOnboardingState)()),S.push((0,r("5Rwa0").preloadWebPanelLocation)({contentId:v,location:r("eSLr0").ATL_GENERAL}),(0,r("5Rwa0").preloadWebPanelLocation)({contentId:v,location:r("eSLr0").ATL_FOOTER})),h&&S.push((0,r("28DDG").preloadAIFloatingContextMenu)(v,x)),(f===r("d9tcB").AccessStatus.LICENSED_ADMIN_ACCESS||f===r("d9tcB").AccessStatus.LICENSED_USE_ACCESS)&&g&&S.push((0,r("7tT2b").preloadRecordLoomButton)({cloudId:u,activationId:m,accessStatus:f,isLoggedIn:g,userId:c,environment:_})),(0,r("9wGTI").fg)("confluence_ai_access_policy")){let e=(0,r("9wGTI").fg)("rovo_use_rovo_llm_enabled_check")?y:b;(h||e)&&S.push((0,r("fNrAc").preloadUseIsAIEnabledForContentQuery)(v))}(0,r("9wGTI").fg)("confluence_preload_forge_viewport_heights_editor")&&S.push((0,a.preloadUseExtensionList)({contentId:v,spaceKey:E,moduleType:r("7Ndnw").FORGE_MODULE_XEN_MACRO})),(0,r("9wGTI").fg)("confluence_frontend_content_wrapper")&&((0,r("9wGTI").fg)("confluence_frontend_content_wrapper")&&((0,r("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)?S.push((0,r("3U5ab").preloadObjectComments)(v)):S.push((0,r("ePnB5").preloadFooterComments)(v))),(0,r("6mKj3").expVal)("cc_comments_new_comments_data_manager","isEnabled",!1)&&S.push((0,r("5rce2").preloadAnnotationsData)(v,!1))),(0,r("9wGTI").fg)("confluence_frontend_content_wrapper")&&(0,r("9wGTI").fg)("confluence_frontend_content_wrapper")&&S.push((0,r("jsQRz").preloadAddCommentPermissionCheck)(v));let A=r("4VJDS").default.getNumber("confluence_frontend_preload_recommendation_timeout",r("wPrRK").SLOW_QUERY_DEFAULT_TIMEOUT);return S.push((0,r("wPrRK").slowQueryGuard)("preloadEndOfPageRecommendation",()=>(0,r("dhOY2").preloadEndOfPageRecommendation)({contentId:v,spaceKey:E,contentType:x?"blogpost":"page"}),A)),(0,r("9wGTI").fg)("aifc_create_enabled")&&S.push((0,r("22UVa").preloadSmartCreateFeedbackBanner)(v)),(0,r("9wGTI").fg)("cfind-5063-revamped-bpqa-live-page-preload-gate")&&S.push((0,r("h8QBE").preloadLandUsersInEditorWithRevampedBpqa)()),(0,r("lyWac").waitForAllReturnWhenError)(S)};e.exports.preloadLivePageRoute=d}),i("furnK",function(t,o){e(t.exports,"preloadContentHeader",()=>r("7WOVi").preloadContentHeader),r("7WOVi")}),i("wPrRK",function(e,t){let o=async(e,t,o,n)=>{let a=null,i=Math.max(o,r("4VJDS").default.getNumber("confluence_frontend_slow_query_guard_timeout",500)),s=new Promise(t=>{a=setTimeout(()=>{r("3mugH").ssrPrepareErrorsClient.submitError(Error(`SlowQueryGuard "${e}" timed out after ${i}ms`)),t(!1)},i)}),l=async()=>(await (async()=>{let o=(0,r("4JHZe").beforePreloaderAsyncCall)(),n=await r("9WAeG").SSRMeasures.run(`ssr-app/prepare/preloadQuery/slowQueryGuard:${e}`,t);return(0,r("4JHZe").afterPreloaderAsyncCall)(o),n})(),a&&clearTimeout(a),!0);return Promise.race(n?[s,n.then(()=>!0),l()]:[s,l()])};e.exports.SLOW_QUERY_DEFAULT_TIMEOUT=500,e.exports.slowQueryGuard=o}),i("3D1KL",function(e,t){var o,n,a;let i={fragment:{argumentDefinitions:o=[{defaultValue:null,kind:"LocalArgument",name:"spaceKey"}],kind:"Fragment",name:"preloadEditButtonWithSpaceKeyQuery",selections:a=[{args:[{kind:"Variable",name:"key",variableName:"spaceKey"}],concreteType:"Space",kind:"LinkedField",name:"space",plural:!1,selections:[n={kind:"ScalarField",name:"id"},{kind:"ScalarField",name:"key"}]},{args:[{kind:"Variable",name:"spaceKey",variableName:"spaceKey"}],concreteType:"Content",kind:"LinkedField",name:"spaceHomepage",plural:!1,selections:[n,{kind:"ScalarField",name:"type"},{concreteType:"OperationCheckResult",kind:"LinkedField",name:"operations",plural:!0,selections:[{kind:"ScalarField",name:"operation"},{kind:"ScalarField",name:"targetType"}]},{concreteType:"ContentMetadata",kind:"LinkedField",name:"metadata",plural:!1,selections:[{concreteType:"ContentMetadata_SpaFriendlyMetadataProvider_frontend",kind:"LinkedField",name:"frontend",plural:!1,selections:[{kind:"ScalarField",name:"fabricEditorSupported"},{kind:"ScalarField",name:"embedded"},{kind:"ScalarField",name:"collabService"}]}]},{kind:"ScalarField",name:"subType"}]}],type:"Query"},kind:"Request",operation:{argumentDefinitions:o,kind:"Operation",name:"preloadEditButtonWithSpaceKeyQuery",selections:a},params:{cacheID:"28437bd051bb517523bd8bb255843261",id:"85b3986006d63f89d3e19402da0bff784515f638a958aa69ec615c07da730c60",metadata:{},name:"preloadEditButtonWithSpaceKeyQuery",operationKind:"query",text:"query preloadEditButtonWithSpaceKeyQuery($spaceKey:String!){space(key:$spaceKey){id,key},spaceHomepage(spaceKey:$spaceKey){id,type,operations{operation,targetType},metadata{frontend{fabricEditorSupported,embedded,collabService}},subType}}"}};i.hash="d44363b7caa9c4f4861198079067c51c",e.exports.preloadEditButton=function({spaceKey:e,contentId:t=""}){if(e&&!t){let t=(0,r("4JHZe").beforePreloaderAsyncCall)();return(0,r("dYU3e").query)({query:i,variables:{spaceKey:e}}).then(({data:e})=>{(0,r("4JHZe").afterPreloaderAsyncCall)(t),e?.spaceHomepage?.id&&(0,r("dYU3e").writeQuery)({query:r("4YBSq").default,variables:{contentId:e?.spaceHomepage?.id},data:{content:e?.spaceHomepage?{nodes:[{...e.spaceHomepage,space:e?.space||null}],__typename:"PaginatedContentListWithChild"}:null}})})}return(0,r("dYU3e").query)({query:r("4YBSq").default,variables:{contentId:t}})}}),i("3Tnjq",function(e,t){e.exports.preloadPageRestrictionsQuery=function(e,t){return(0,r("dYU3e").query)({query:r("hL5Va").PageRestrictionsQuery,variables:{contentId:e,status:r("gYXuI").ALLOWED_CONTENT_STATUSES,includeAncestors:t},fetchPolicy:"network-only"})}}),i("kb8ij",function(e,t){let o=(0,r("eSUdr").default)`query WatchDialogWithSpaceKeyQuery($spaceKey:String!){space(key:$spaceKey){id key currentUser{isWatched isWatchingBlogs}operations{operation targetType}}spaceHomepage(spaceKey:$spaceKey){id type currentUserIsWatching}}`;e.exports.preloadWatchDialog=function({spaceKey:e,isLicensed:t=!1,userId:n,contentId:a}){if(!t||!n||!e&&!a)return Promise.resolve({});if(e&&!a){let t=(0,r("4JHZe").beforePreloaderAsyncCall)();return(0,r("dYU3e").query)({query:o,variables:{spaceKey:e},fetchPolicy:"network-only"}).then(({data:e})=>{(0,r("4JHZe").afterPreloaderAsyncCall)(t),e?.spaceHomepage?.id&&(0,r("dYU3e").writeQuery)({query:(0,r("hpr9b").getWatchDialogQuery)(),variables:{contentId:e?.spaceHomepage?.id},data:{singleContent:e?.spaceHomepage&&e?.space?{currentUserIsWatching:e?.spaceHomepage?.currentUserIsWatching,id:e?.spaceHomepage?.id,space:e?.space,type:e?.spaceHomepage?.type,__typename:"Content"}:null}})})}return(0,r("dYU3e").query)({query:(0,r("hpr9b").getWatchDialogQuery)(),variables:{contentId:a},fetchPolicy:"network-only"})}}),i("4zhNK",function(e,t){e.exports.preloadContentTypesHeader=function(e,t){return(0,r("dYU3e").query)({query:r("6LsQQ").ContentTypesHeaderQuery,variables:{contentId:e,useObjectHeader:t}})}}),i("iV8Fk",function(e,t){e.exports.preloadCustomHeaderAndFooter=function(e){return(0,r("dYU3e").query)({query:r("lPNkm").default,variables:{spaceKey:e}})}}),i("1i2qc",function(e,t){let o=async e=>await (async()=>{let t=(0,r("4JHZe").beforePreloaderAsyncCall)(),o=await (0,r("dYU3e").query)({query:r("1qiwK").MediaDownloadTokenQuery,variables:{contentId:e,status:["current","draft","archived"]}});return(0,r("4JHZe").afterPreloaderAsyncCall)(t),o})();e.exports.preloadMediaToken=o}),i("kZZXz",function(e,t){e.exports.preloadFocusedInlineComment=function(e,t){return(0,r("dYU3e").query)({query:r("8Ya23").FocusedInlineCommentQuery,variables:{commentId:e,contentId:t}})}}),i("7tT2b",function(e,t){var o=r("5spQU");let n=({accessStatus:e,isLoggedIn:t})=>{let n=(0,r("lzcvT").isFedRamp)(),a=(0,r("8dwdz").isMobileUserAgent)()||(0,r("8dwdz").shouldShowMobileWeb)(),i=(0,r("9wGTI").fg)("use_frontend_feature_encoding_sdk")?(0,o.isFeatureEnabled)("confluence","confluence-loom-integration"):!n,s=e==r("d9tcB").AccessStatus.LICENSED_ADMIN_ACCESS||e==r("d9tcB").AccessStatus.LICENSED_USE_ACCESS;return!t||!s||!i||!!a},a=e=>{let t=e===r("d9tcB").AccessStatus.LICENSED_ADMIN_ACCESS||e===r("d9tcB").AccessStatus.LICENSED_USE_ACCESS,o=(0,r("8dwdz").isMobileUserAgent)()||(0,r("8dwdz").shouldShowMobileWeb)();return t&&!o&&(0,r("9wGTI").fg)("confluence_loom_beta_enabled")},i=(0,r("eSUdr").default)`query LoomEntryPointsQuery($cloudId:ID!){confluence_loomEntryPoints(cloudId:$cloudId){isLoomEntryPointsEnabled}}`;async function s({cloudId:e,activationId:t,accessStatus:o,isLoggedIn:i,userId:s,environment:d}){let c=n({accessStatus:o,isLoggedIn:i}),p=a(o),[u,m]=await (async()=>{let n=(0,r("4JHZe").beforePreloaderAsyncCall)(),a=await Promise.allSettled([l(e,t,o),(0,r("dYU3e").query)({query:r("4zCDj").GetLicensedProductsQuery})]);return(0,r("4JHZe").afterPreloaderAsyncCall)(n),a})(),f="fulfilled"!==u.status||u.value;if(window.__SSR_LOOM_ENTRY_POINT__)return Promise.resolve();if(c||!f)return window.__SSR_LOOM_ENTRY_POINT__={entryPointVariant:"DISABLED"},Promise.resolve();if(p)return window.__SSR_LOOM_ENTRY_POINT__={entryPointVariant:"BETA"},Promise.resolve();if(!(0,r("9wGTI").fg)("confluence_frontend_loom_cross_sell"))return window.__SSR_LOOM_ENTRY_POINT__={entryPointVariant:"DISABLED"},Promise.resolve();if("fulfilled"!==m.status)return window.__SSR_LOOM_ENTRY_POINT__={entryPointVariant:"CROSS_FLOW",error:!0},(0,r("9wGTI").fg)("confluence_frontend_loom_cross_flow_ads_opt_out")&&(window.__SSR_LOOM_ENTRY_POINT__={entryPointVariant:"DISABLED"}),Promise.resolve();{let e=m.value.data;if((e?.confluence_tenantContext?.licensedProducts.some(e=>"loom"===e.productKey&&e.licenseStatus===r("bxT4f").LicenseStatus.ACTIVE)?r("5CUwy").LoomTenantProvisionStatus.PROVISIONED:r("5CUwy").LoomTenantProvisionStatus.NOT_PROVISIONED)===r("5CUwy").LoomTenantProvisionStatus.NOT_PROVISIONED)return window.__SSR_LOOM_ENTRY_POINT__={entryPointVariant:"CROSS_FLOW"},(0,r("9wGTI").fg)("confluence_frontend_loom_cross_flow_ads_opt_out")&&(window.__SSR_LOOM_ENTRY_POINT__={entryPointVariant:"DISABLED"}),Promise.resolve()}window.__SSR_LOOM_ENTRY_POINT__={entryPointVariant:"CROSS_JOIN"};let g=await (async()=>{let t=(0,r("4JHZe").beforePreloaderAsyncCall)(),o=await (0,r("5CUwy").getLoomUserPermissionStatus)(e,s,d);return(0,r("4JHZe").afterPreloaderAsyncCall)(t),o})();return g===r("5CUwy").LoomUserPermissionStatus.NOT_PERMITTED||(g===r("5CUwy").LoomUserPermissionStatus.ERROR?window.__SSR_LOOM_ENTRY_POINT__={entryPointVariant:"CROSS_JOIN",error:!0}:window.__SSR_LOOM_ENTRY_POINT__={entryPointVariant:"CO_USE"}),Promise.resolve()}let l=async(e,t,o)=>{if(o!==r("d9tcB").AccessStatus.LICENSED_ADMIN_ACCESS&&o!==r("d9tcB").AccessStatus.LICENSED_USE_ACCESS)return;let{data:n,hasErrors:a}=await (async()=>{let o=(0,r("4JHZe").beforePreloaderAsyncCall)(),n=await (0,r("dYU3e").queryAgg)({query:i,variables:{cloudId:e},context:{headers:{...(0,r("i8Ofl").createAtlAttributionHeader)(e,t)}},errorPolicy:"all"});return(0,r("4JHZe").afterPreloaderAsyncCall)(o),n})();return!!a||n?.confluence_loomEntryPoints?.isLoomEntryPointsEnabled};e.exports.preloadRecordLoomButton=s}),i("kkLBe",function(e,t){let o=[],n=async(e,t)=>{let n=r("9WAeG").SSRMeasures.run(`ssr-app/prepare/preloadQuery/guardException:${e}`,t);return o.push(n),n};e.exports.prepareGuardExceptionTask=n}),i("9ycGg",function(e,t){e.exports.preloadPageReactions=function({pageId:e,containerId:t}){let{query:o,queryVariables:n}=(0,r("8wyJO").getReactionsQueryInfo)(!1,e,t);return(0,r("dYU3e").query)({query:o,variables:n})}}),i("lcQ5b",function(e,t){let o=(e,t)=>(0,r("dYU3e").query)({query:r("9inwL").default,errorPolicy:"all",variables:{contentId:e,missingSpaceKey:!t,spaceKey:t}}),n=({contentId:e,versionOverride:t})=>(0,r("dYU3e").query)({query:r("4uNpa").default,errorPolicy:"all",variables:{contentId:e,versionOverride:t}});e.exports.preloadContentPrerequisites=(e,t,a)=>(0,r("lyWac").waitForAllReturnWhenError)([o(e,t),n({contentId:e,...a})])}),i("gBI6h",function(e,t){let o=(0,r("eSUdr").default)`query PreloadPageStatusQuery($contentId:ID!){content(id:$contentId status:["archived" "current"]){nodes{id status}}}`;e.exports.preloadPageStatusQuery=function(e){return(0,r("dYU3e").query)({query:o,variables:{contentId:e}})}}),i("h8QBE",function(e,t){e.exports.preloadLandUsersInEditorWithRevampedBpqa=()=>(0,r("dYU3e").query)({query:r("66UJS").getOnboardingStateGQL,variables:{key:(0,r("9wGTI").fg)("cfind-4971-improved-templates-bar-gate")?[...Object.values(r("dBcar").LAND_USERS_IN_EDITOR_WITH_REVAMPED_BPQA),r("dBcar").FOUNDING_ADMIN_REVAMPED_BPQA_ELIGIBLE]:[...Object.values(r("dBcar").LAND_USERS_IN_EDITOR_WITH_REVAMPED_BPQA)]}})}),i("lt4mJ",function(e,t){let o=(0,r("eSUdr").default)`query PreloadLegacyBridgeQuery($contentId:ID!$isBlog:Boolean!){ptpage(id:$contentId status:[CURRENT])@skip(if:$isBlog){id nearestAncestors(first:1){edges{node{id title}}}}content(id:$contentId){nodes{id type title version{number}space{id key name type}operations{operation targetType}}}}`;async function n({contentId:e,isBlog:t}){if(e)return(0,r("dYU3e").query)({query:o,variables:{contentId:e,isBlog:t},errorPolicy:"all"})}e.exports.preloadLegacyBridge=n}),i("dhOY2",function(e,t){e.exports.preloadEndOfPageRecommendation=function({contentId:e,spaceKey:t,contentType:o}){return(0,r("dYU3e").query)({query:r("4XcQZ").EndOfPageRecommendationQuery,variables:{type:o,id:e,exp:(0,r("6mKj3").expVal)("cc_ai_discovery_linked_pages_on_related_pages","experience","end_of_page_v5"),key:t,keyString:t},fetchPolicy:"network-only"})}}),i("5Rwa0",function(e,t){e.exports.preloadWebPanelLocation=function(e){return(0,r("dYU3e").query)({query:r("8pvtc").WebPanelLocationQuery,variables:e})}}),i("28DDG",function(e,t){e.exports.preloadAIFloatingContextMenu=function(e,t){return(0,r("dYU3e").query)({query:r("8G3G6").default,variables:{contentId:e,contentType:t?"BLOGPOST":"PAGE"}})}}),i("gDMf3",function(e,t){let o=(0,r("eSUdr").default)`query ShareAndRestrictButtonSpaceOverviewQuery($cloudId:ID!$spaceKey:String!){spaceHomepage(spaceKey:$spaceKey){id hasInheritedRestrictions hasRestrictions hasViewRestrictions title}confluence_publicLinkSpaceHomePage(cloudId:$cloudId spaceKey:$spaceKey)@optIn(to:"AskInCcApiPlatformBeforeUsing"){pageId pageStatus}}`;async function n(e,t){let{isLoggedIn:n,cloudId:a}=(0,r("xwvlW").getPreloaderFnContext)();if(n){if(!e&&t&&(0,r("6mKj3").expValEquals)("fix_preload_share_and_restrict_query_chaining_","cohort","test")){let e=await (async()=>{let e=(0,r("4JHZe").beforePreloaderAsyncCall)(),n=await (0,r("dYU3e").query)({query:o,variables:{cloudId:a,spaceKey:t},errorPolicy:"all"});return(0,r("4JHZe").afterPreloaderAsyncCall)(e),n})();if(e.hasErrors)return e;let n=e.data,i=n?.spaceHomepage?.id;if(!i)return;let s={singleContent:n?.spaceHomepage||null,publicLinkPage:n?.confluence_publicLinkSpaceHomePage||null};return void(0,r("dYU3e").writeQuery)({query:r("gyneS").ShareAndRestrictButtonQuery,variables:{contentId:i,isContentTypePublicLinkEligible:!0},data:s})}if(e){let t=await (async()=>{let t=(0,r("4JHZe").beforePreloaderAsyncCall)(),o=await (0,r("dYU3e").query)({query:r("gyneS").ShareAndRestrictButtonQuery,variables:{contentId:e,isContentTypePublicLinkEligible:!0},errorPolicy:"all"});return(0,r("4JHZe").afterPreloaderAsyncCall)(t),o})();return t.hasErrors?t:void 0}console.error("Either contentId or spaceKey must be provided")}}e.exports.preloadShareAndRestrictButtonQuery=n}),i("fNrAc",function(e,t){e.exports.preloadUseIsAIEnabledForContentQuery=function(e){return(0,r("dYU3e").query)({query:r("gejop").default,variables:{contentId:e}})}}),i("2WwwU",function(e,t){var o,n,a,i;let s={fragment:{argumentDefinitions:o=[{defaultValue:null,kind:"LocalArgument",name:"contentId"}],kind:"Fragment",name:"preloadContentSmartLinksQuery",selections:n=[{args:[{kind:"Variable",name:"id",variableName:"contentId"}],concreteType:"PaginatedSmartLinkList",kind:"LinkedField",name:"contentSmartLinks",plural:!1,selections:[{kind:"LinkedField",name:"nodes",plural:!0,selections:[{kind:"ScalarField",name:"__typename"},{kind:"ScalarField",name:"url"}]}]}],type:"Query"},kind:"Request",operation:{argumentDefinitions:o,kind:"Operation",name:"preloadContentSmartLinksQuery",selections:n},params:{cacheID:"de2055f79d838c6ae662c546481a203f",id:"a0ca02317789aa09b7ec67b818534de3b2bac61f0029863077ab8e2260e3f601",metadata:{},name:"preloadContentSmartLinksQuery",operationKind:"query",text:"query preloadContentSmartLinksQuery($contentId:ID!){contentSmartLinks(id:$contentId){nodes{__typename,url}}}"}};s.hash="b754ba4177177d2190e5f0f97831d643";let l={fragment:{argumentDefinitions:a=[{defaultValue:null,kind:"LocalArgument",name:"contentId"}],kind:"Fragment",name:"preloadContentSmartLinksForDraftQuery",selections:i=[{args:[{kind:"Variable",name:"id",variableName:"contentId"}],concreteType:"PaginatedSmartLinkList",kind:"LinkedField",name:"confluence_contentSmartLinksForDraft",plural:!1,selections:[{kind:"LinkedField",name:"nodes",plural:!0,selections:[{kind:"ScalarField",name:"__typename"},{kind:"ScalarField",name:"url"}]}]}],type:"Query"},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"preloadContentSmartLinksForDraftQuery",selections:i},params:{cacheID:"2a5f4905dcbc76da595fe8890b24298f",id:"7f3c621bc35f3ba6d02a3b87249fc43d5791f8786491fb9e379a75bf485380ea",metadata:{},name:"preloadContentSmartLinksForDraftQuery",operationKind:"query",text:"query preloadContentSmartLinksForDraftQuery($contentId:ID!){confluence_contentSmartLinksForDraft(id:$contentId){nodes{__typename,url}}}"}};l.hash="c2988d2bbcf31a9c9c8985520d25900f";let d=e=>e?.__typename==="InlineSmartLink",c=(e,t)=>t?e?.data?.confluence_contentSmartLinksForDraft?.nodes||[]:e?.data?.contentSmartLinks?.nodes||[],p=(e,t=!1)=>c(e,t).filter(d).slice(0,50).filter(e=>!!e).map(e=>({appearance:"inline",resourceUrl:e?.url}));function u(e){return e.includes("/jira/")||e.includes("/servicedesk/")||e.includes("/helpcenter/")||e.includes("/projects/")?"jira":e.includes("/wiki/")?"confluence":e.includes("bitbucket")?"bitbucket":e.includes("atlassian")||e.includes("jira-dev")?(console.log(`Resolving other atlassian link type: ${function(e){try{let t=new URL(e),o=t.hostname,n=t.pathname.split("/")[1];return n?`${o}/${n}`:o}catch{return""}}(e)}`),"otherAtlassian"):"thirdParty"}let m=async(e,t=!1)=>t?p(await (async()=>{let t=(0,r("4JHZe").beforePreloaderAsyncCall)(),o=await (0,r("dYU3e").query)({query:l,variables:{contentId:e}});return(0,r("4JHZe").afterPreloaderAsyncCall)(t),o})(),t):p(await (async()=>{let t=(0,r("4JHZe").beforePreloaderAsyncCall)(),o=await (0,r("dYU3e").query)({query:s,variables:{contentId:e}});return(0,r("4JHZe").afterPreloaderAsyncCall)(t),o})(),t),f=(e,t,o,n)=>{let a=o.reduce((e,{status:t,body:o})=>(504===t&&(e[o?.data?.url]="timeout"),200===t&&(e[o?.data?.url]="resolved"),e),{});return{fetch:e.length,fetchTimeout:n,links:t.reduce((e,{resourceUrl:t,appearance:o})=>{let n=u(t);return e?.[n]?.[o]||(e[n]={[o]:{total:0,timeout:0,resolved:0}}),e[n][o].total++,a[t]&&("timeout"===a[t]&&e[n][o].timeout++,"resolved"===a[t]&&e[n][o].resolved++),e},{})}};async function g(e,t,o,n){if(0===e.length)return[];let{customURLs:a,userContext:i}=(0,r("60cDW").getSSRRenderInputs)(),s=a?.["object-resolver-service"],l=u(e[0].resourceUrl);return(0,r("8tmcF").timeGuard)(async()=>{try{let o=await (async()=>{let o=(0,r("4JHZe").beforePreloaderAsyncCall)(),n=await (0,r("jhATi").fetchORSForSSR)({url:`${s}?timeout=${t}`,body:JSON.stringify(e),userContext:i});return(0,r("4JHZe").afterPreloaderAsyncCall)(o),n})();if(!o.ok)throw Error(`${o.status} ${o.statusText}`);return o.json()}catch(e){r("3mugH").ssrPrepareErrorsClient.submitError(Error(`Smart link content ORS call failed: ${e.message}`))}return[]},()=>(n[l]=n[l]||0,n[l]++,[]),o)}let h=async(e,t=!1)=>{let o=await (async()=>{let o=(0,r("4JHZe").beforePreloaderAsyncCall)(),n=await m(e,t);return(0,r("4JHZe").afterPreloaderAsyncCall)(o),n})();if(!o?.length)return;let n=r("4VJDS").default.getNumber("confluence_ssr_content_smart_link_max_time",250),a=r("4VJDS").default.getNumber("confluence_ssr_content_smart_link_batch_max_time",350),i=r("4VJDS").default.getNumber("confluence_ssr_content_smart_link_min_batch_count",1),s=Math.max(i,r("4VJDS").default.getNumber("confluence_ssr_content_smart_link_max_batch_count",50));await (async()=>{let e=(0,r("4JHZe").beforePreloaderAsyncCall)(),t=await r("9WAeG").SSRMeasures.run("ssr-app/prepare/preloadQuery/fetch:contentSmartLinksORS",async()=>{let e=[],t={},l=Object.values(o.reduce((e,t)=>{var o;try{let o=new URL(t.resourceUrl).hostname;(e[o]||(e[o]=[])).push(t)}catch(n){(e[o="unknown"]||(e[o]=[])).push(t)}return e},{}));for(let o of l=function(e,t){let o=[];for(let n of e)if(n.length<=t)o.push(n);else for(let e=0;e<n.length;e+=t)o.push(n.slice(e,e+t));return o}(l=function(e,t){let o=[],n=[];for(let a of e)a.length>=t||"thirdParty"!==u(a[0].resourceUrl)?o.push(a):n.push(...a);return n.length>0&&o.push(n),o}(l,i),s))e.push(g(o,n,a,t));let d=(await (async()=>{let t=(0,r("4JHZe").beforePreloaderAsyncCall)(),o=await Promise.all(e);return(0,r("4JHZe").afterPreloaderAsyncCall)(t),o})()).flat();window.__SSR_SMARTLINKS__=(0,r("hR977").getInitialState)(d),window.__SSR_SMARTLINKS_STATS__=f(e,o,d,t)});return(0,r("4JHZe").afterPreloaderAsyncCall)(e),t})()};e.exports.preloadContentSmartLinks=h}),i("ePnB5",function(e,t){let o=(0,r("7W8i8").getLogger)("preloadFooterComments");e.exports.preloadFooterComments=function(e,t){try{(0,r("fEmGS").writeQueryInterop)({query:r("b1hSc").default,variables:(0,r("9rE3H").buildConsistentActiveCommentsQueryPreloadVariables)(e,t),data:{comments:{nodes:[],totalCount:r("9rE3H").ACTIVE_COMMENTS_QUERY_PRELOAD_LOADING_FLAG,__typename:"PaginatedCommentList"}}}),(0,r("fEmGS").writeQueryInterop)({query:r("b1hSc").default,variables:(0,r("9rE3H").buildConsistentActiveCommentsQueryVariables)({pageId:e,type:"FOOTER",isArchived:t}),data:{comments:{nodes:[],totalCount:r("9rE3H").ACTIVE_COMMENTS_QUERY_PRELOAD_LOADING_FLAG,__typename:"PaginatedCommentList"}}})}catch(t){o.error`Error clearing preload cache for footer comments for contentId: ${e}, error: ${t}`}if(!e)return Promise.resolve({});let n=(0,r("4JHZe").beforePreloaderAsyncCall)();return(0,r("dYU3e").query)({query:r("b1hSc").default,variables:(0,r("9rE3H").buildConsistentActiveCommentsQueryPreloadVariables)(e,t),fetchPolicy:"network-only"}).then(a=>{(0,r("4JHZe").afterPreloaderAsyncCall)(n);try{(0,r("fEmGS").writeQueryInterop)({query:r("b1hSc").default,variables:(0,r("9rE3H").buildConsistentActiveCommentsQueryVariables)({pageId:e,type:"FOOTER",isArchived:t}),data:a.data})}catch(t){o.error`Error writing to full cache for footer comments for contentId: ${e}, error: ${t}`}})}}),i("3U5ab",function(e,t){let o=async e=>{if(!e)return Promise.resolve({data:null});try{(0,r("fEmGS").writeQueryInterop)({query:r("1ydBT").default,variables:(0,r("MJaSd").buildPreloadObjectCommentsQueryVariables)(e),data:{comments:{nodes:[],totalCount:r("MJaSd").PRELOAD_LOADING_FLAG,__typename:"PaginatedCommentList"}}})}catch{}return{data:(await (async()=>{let t=(0,r("4JHZe").beforePreloaderAsyncCall)(),o=await (0,r("dYU3e").query)({query:r("1ydBT").default,variables:(0,r("MJaSd").buildPreloadObjectCommentsQueryVariables)(e),fetchPolicy:"network-only"});return(0,r("4JHZe").afterPreloaderAsyncCall)(t),o})()).data}};e.exports.preloadObjectComments=o}),i("jsQRz",function(e,t){var o,n;let a={fragment:{argumentDefinitions:o=[{defaultValue:null,kind:"LocalArgument",name:"contentId"}],kind:"Fragment",name:"PermissionCheckAddCommentQuery",selections:n=[{args:[{kind:"Variable",name:"id",variableName:"contentId"},{kind:"Literal",name:"status",value:["draft","current"]}],concreteType:"PaginatedContentListWithChild",kind:"LinkedField",name:"content",plural:!1,selections:[{concreteType:"Content",kind:"LinkedField",name:"nodes",plural:!0,selections:[{kind:"ScalarField",name:"id"},{kind:"ScalarField",name:"type"},{concreteType:"OperationCheckResult",kind:"LinkedField",name:"operations",plural:!0,selections:[{kind:"ScalarField",name:"operation"},{kind:"ScalarField",name:"targetType"}]}]}]}],type:"Query"},kind:"Request",operation:{argumentDefinitions:o,kind:"Operation",name:"PermissionCheckAddCommentQuery",selections:n},params:{cacheID:"de86fc84348e13b32c99266ab09fdd15",id:"2d28f479a584c65d21cfc6be5ba0b8e0680e7c4c73253a16db371a14cc265297",metadata:{},name:"PermissionCheckAddCommentQuery",operationKind:"query",text:'query PermissionCheckAddCommentQuery($contentId:ID!){content(id:$contentId,status:["draft","current"]){nodes{id,type,operations{operation,targetType}}}}'}};a.hash="3e9291acefbd65375263a2c6c3f07da2",e.exports.preloadAddCommentPermissionCheck=function(e){return(0,r("dYU3e").query)({query:a,variables:{contentId:e}})}}),i("5rce2",function(e,t){let o=async(e,t=!1)=>{if(!e)return Promise.resolve({data:null});let o=t?r("cD1qu").PageMode.VIEW:r("cD1qu").PageMode.LIVE;return(0,r("dYU3e").query)({query:r("kmYOg").default,variables:(0,r("kDIns").buildPreloadAnnotationsDataQueryVariables)(e,o),fetchPolicy:"cache-first"})};e.exports.preloadAnnotationsData=o}),i("1swiX",function(e,t){e.exports.getIsEmbeddedConfluence=e=>!!(e?.query.embedded||e?.query.parentProduct),e.exports.hasEmbeddedAllowedFeatures=(e,t)=>t?.query.initialAllowedFeatures?.indexOf(e)||t?.query.initialAllowedFeatures==="all",e.exports.getUsername=e=>{let t=e?.query.username;return t?Array.isArray(t)?t[0]:t:""},e.exports.shouldPreloadNavigationForTransition=e=>e?.name===r("1NBp8").HOME.name||e?.name===r("1NBp8").ADVANCED_SEARCH.name||e?.name===r("1NBp8").SPACE_OVERVIEW.name}),i("kM8fE",function(e,t){let o=e=>r("1NBp8").VIEW_BLOG.match(e)||r("1NBp8").VIEW_BLOG_DATE_LEGACY.match(e);e.exports.matchHome=e=>r("1NBp8").BASE.match(e)||r("1NBp8").WIKI.match(e)||r("1NBp8").HOME.match(e),e.exports.matchLivePage=e=>{let t=r("1NBp8").VIEW_PAGE.match(e),o=t?.params?.contentId;if(o){let{subType:e,isArchived:n}=(0,r("9sGCn").getCachedPageData)(o);if("live"===e&&!n)return t}return null},e.exports.matchViewPage=e=>r("1NBp8").VIEW_PAGE.match(e)||o(e),e.exports.matchBlogPage=o,e.exports.matchWhiteboardPage=e=>r("1NBp8").WHITEBOARD_BOARD.match(e),e.exports.matchDatabasePage=e=>r("1NBp8").DATABASE_VIEW.match(e),e.exports.matchEmbedPage=e=>r("1NBp8").EMBED_VIEW.match(e),e.exports.matchSpaceOverview=e=>r("1NBp8").SPACE_OVERVIEW.match(e)||r("1NBp8").SPACE_INDEX.match(e),e.exports.matchCompanyHub=e=>r("1NBp8").COMPANY_HUB.match(e),e.exports.matchFabricEditor=e=>r("1NBp8").EDIT_PAGE_V2.match(e)||r("1NBp8").EDIT_BLOG_V2.match(e)||r("1NBp8").COMPANY_HUB_EDIT.match(e)||r("1NBp8").HUB_EDIT.match(e),e.exports.matchEditBlog=e=>r("1NBp8").EDIT_BLOG_V2.match(e),e.exports.matchExternalShare=e=>r("1NBp8").EXTERNAL_SHARE.match(e),e.exports.matchSpacePages=e=>r("1NBp8").SPACE_PAGES.match(e),e.exports.matchContentHistory=e=>r("1NBp8").CONTENT_HISTORY.match(e),e.exports.matchEmbeddedEditor=e=>r("1NBp8").EDIT_PAGE_EMBED.match(e),e.exports.matchSmartCreateEditor=e=>r("1NBp8").EDIT_PAGE_SMART_CREATE.match(e),e.exports.matchCreateContent=e=>r("1NBp8").CREATE_CONTENT.match(e),e.exports.matchPdfExport=e=>r("1NBp8").PDF_EXPORT_PAGE.match(e),e.exports.matchSearch=e=>r("1NBp8").ADVANCED_SEARCH.match(e)}),i("dpyxe",function(e,t){let o=RegExp("^[^/]+/[^/].*$|^/[^/].*$","i"),n=e=>e?.__typename==="SpaceSidebarLink",a=e=>(e?.data?.spaceSidebarLinks?.quick??[]).filter(n).map(e=>({appearance:"inline",resourceUrl:o.test(e?.url)?window.location.origin+e?.url:e?.url})),i=async e=>{let{customURLs:t,userContext:o}=(0,r("60cDW").getSSRRenderInputs)(),n=t?.["object-resolver-service"];if(!n)return;let i=a(await (async()=>{let t=(0,r("4JHZe").beforePreloaderAsyncCall)(),o=await (0,r("dYU3e").query)({query:r("eohUr").SpaceShortcutsSpaceNavigationQuery,variables:{spaceKey:e}});return(0,r("4JHZe").afterPreloaderAsyncCall)(t),o})());i?.length&&await (async()=>{let e=(0,r("4JHZe").beforePreloaderAsyncCall)(),t=await r("9WAeG").SSRMeasures.run("ssr-app/prepare/preloadQuery/fetch:sidenavSmartLinksORS",async()=>{let e=r("4VJDS").default.getNumber("confluence_ssr_sidenav_smart_link_max_time",250),t=await (async()=>{let t=(0,r("4JHZe").beforePreloaderAsyncCall)(),a=await (0,r("8tmcF").timeGuard)(async()=>{try{let t=await (async()=>{let t=(0,r("4JHZe").beforePreloaderAsyncCall)(),a=await (0,r("jhATi").fetchORSForSSR)({url:`${n}?timeout=${e}`,userContext:o,body:JSON.stringify(i)});return(0,r("4JHZe").afterPreloaderAsyncCall)(t),a})();if(!t.ok)throw Error(`${t.status} ${t.statusText}`);return t.json()}catch(e){r("3mugH").ssrPrepareErrorsClient.submitError(Error(`Smart link shortcuts ORS call failed: ${e.message}`))}return[]},[],e);return(0,r("4JHZe").afterPreloaderAsyncCall)(t),a})();t.length&&(window.__SSR_SHORTCUTS__=(0,r("hR977").getInitialState)(t))});return(0,r("4JHZe").afterPreloaderAsyncCall)(e),t})()};var s=r("IGlEW");let l=async(e,t,o,n)=>{let a=[];return a.push((0,r("dYU3e").query)({query:r("jW8MZ").ViewSpaceExternalCollaboratorsDialogQuery,variables:{spaceKey:e}}),i(e),(0,s.preloadSideNavigation)(e),(0,s.preloadSideNavigationNeedsContentId)(e,t),(0,r("7A94k").preloadSpaceViews)(e,o)),a.push((0,r("6anVB").preloadPageTree)({spaceKey:e,...n?{}:{contentId:t},statuses:r("ivyMZ").PAGE_TREE_STATUSES,isSuperAdmin:!1}),(0,r("5iG5Q").preloadBlogTree)({spaceKey:e})),(0,r("lyWac").waitForAllReturnWhenError)(a)};e.exports.preloadNavigationTasks=l}),i("IGlEW",function(e,t){r("bFNdd");var o=r("cdE3K"),n=r("8CHHT");async function a(){return(0,r("dYU3e").query)({query:r("66UJS").getOnboardingStateGQL,variables:{key:[r("dBcar").ONBOARDING_EXPERIENCES.IS_FOUNDING_ADMIN,...Object.values(r("da9fp").OPTIONAL_NTH_USER_GUIDED_TOUR_ONBOARDING_STATE_KEYS)]}})}async function i(e,t){return(0,r("6mKj3").expVal)("confluence_fix_space_apps_flickering","isEnabled",!1)?(0,n.preloadUseExtensionList)({spaceKey:e,moduleType:r("7Ndnw").FORGE_MODULE_SPACE_PAGE}):(0,n.preloadUseExtensionList)({contentId:t,spaceKey:e,moduleType:r("7Ndnw").FORGE_MODULE_SPACE_PAGE})}async function s(e){let t=(0,r("xwvlW").getPreloaderFnContext)(),n=(0,r("1dnxO").getIsNav4Enabled)(),i=[];return i.push((0,r("dYU3e").query)({query:r("8q3aB").SpaceNavigationQuery,variables:{spaceKey:e,isLicensed:t.isLicensed}})),i.push((0,r("2fsJn").preloadPersistentInviteButtonEligible)({spaceKey:e},!1)),n&&(i.push((0,r("4vyfK").preloadWebItemLocation)({location:"system.header/left"})),(0,r("9wGTI").fg)("cc_engagement_optional_guided_tour_for_nth_users")&&i.push(a())),(0,r("9wGTI").fg)("po-connie-side-nav-ssr-shadow")&&i.push((0,o.preloadPostOfficeConfluenceSideNav)(t)),(0,r("lyWac").waitForAllReturnWhenError)(i)}e.exports.preloadSideNavigationNeedsContentId=i,e.exports.preloadSideNavigation=s}),i("bFNdd",function(t,o){e(t.exports,"preloadPostOfficeConfluenceSideNav",()=>r("cdE3K").preloadPostOfficeConfluenceSideNav),r("cdE3K")}),i("2fsJn",function(e,t){let o=(0,r("eSUdr").default)`query PersistentInviteEligibleQuery($spaceKey:String$skipLicenseQuery:Boolean!$skipSpaceQuery:Boolean!){space(key:$spaceKey)@skip(if:$skipSpaceQuery){id currentUser{isAnonymouslyAuthorized}}license@skip(if:$skipLicenseQuery){licenseConsumingUserCount trialEndDate}}`;async function n({spaceKey:e},t=!1){if((0,r("9wGTI").fg)("confluence_nav4_global-invite")){let{edition:n,isLicensed:a,userId:i}=(0,r("xwvlW").getPreloaderFnContext)(),s=n===r("euL71").ConfluenceEdition.FREE;return(0,r("dYU3e").query)({query:o,variables:{spaceKey:e,skipLicenseQuery:s||!a||!i||t,skipSpaceQuery:!e},context:{headers:{"X-ATL-WARM-CACHE-HINT":"get"}}})}}e.exports.preloadPersistentInviteButtonEligible=n}),i("7A94k",function(e,t){e.exports.preloadSpaceViews=function(e,t){let o=[];return o.push((0,r("dYU3e").query)({query:r("aGl35").SpaceRootQuery,variables:{spaceKey:e}})),t&&o.push((0,r("dYU3e").query)({query:r("27YEi").PersistenceQuery,variables:{spaceKey:e}})),(0,r("lyWac").waitForAllReturnWhenError)(o)}}),i("6anVB",function(e,t){async function o({spaceKey:e,statuses:t,isSuperAdmin:o,contentId:a=""}){let i=[n({spaceKey:e,statuses:t,isSuperAdmin:o,contentId:a}),(0,r("dYU3e").query)({query:r("2fQCH").default,errorPolicy:"all",variables:{spaceKey:e}})];return(0,r("lyWac").waitForAllReturnWhenError)(i)}async function n({spaceKey:e,statuses:t,isSuperAdmin:o,contentId:n=""}){if(e&&!n){let{data:n}=await (async()=>{let n=(0,r("4JHZe").beforePreloaderAsyncCall)(),a=await (0,r("dYU3e").query)({query:r("inLKs").PageTreeWithSpaceKeyQuery,variables:{spaceKey:e,isSuperAdmin:o,statuses:t,ptStatuses:t,paginationLimit:r("1oGPE").INITIAL_PAGE_SIZE,isReplacePagesWithPTPageEnabled:!0}});return(0,r("4JHZe").afterPreloaderAsyncCall)(n),a})();n?.space?.homepageId&&n?.space?.id&&(0,r("dYU3e").writeQuery)({query:r("inLKs").PageTreeQuery,variables:{spaceKey:e,isSuperAdmin:o,statuses:t,ptStatuses:t,contentId:n?.space?.homepageId,paginationLimit:r("1oGPE").INITIAL_PAGE_SIZE,isReplacePagesWithPTPageEnabled:!0},data:{currentPage:n?.space?.pageTree||null,ptpage:n?.ptpage||null,space:n?.space?{id:n?.space?.id,homepage:{id:n?.space?.homepageId,__typename:"Content"},operations:n?.space?.operations,__typename:"Space"}:null}})}else await (async()=>{let a=(0,r("4JHZe").beforePreloaderAsyncCall)(),i=await (0,r("dYU3e").query)({query:r("inLKs").PageTreeQuery,variables:{spaceKey:e,isSuperAdmin:o,statuses:t,ptStatuses:t,...n&&{contentId:n},paginationLimit:r("1oGPE").INITIAL_PAGE_SIZE,isReplacePagesWithPTPageEnabled:!0}});return(0,r("4JHZe").afterPreloaderAsyncCall)(a),i})()}e.exports.preloadPageTree=o}),i("5iG5Q",function(e,t){async function o(){try{let e=(await (async()=>{let e=(0,r("4JHZe").beforePreloaderAsyncCall)(),t=await (0,r("eiCiP").preloadLocalStorage)();return(0,r("4JHZe").afterPreloaderAsyncCall)(e),t})()).find(e=>e.key.endsWith(r("1UApO").PERSISTED_KEYS_ON_SERVER.PERSISTED_SPACE_NAV_SECTIONS_EXPANDED_STATES));if(e.value&&JSON.parse(e.value).blogTree)return!0}catch{}return!1}let n=async({spaceKey:e})=>{let t=(0,r("dYU3e").query)({query:r("fL5TY").default,variables:{spaceKey:e,first:r("6DMfJ").PAGE_SIZE,statuses:r("6DMfJ").BLOG_STATUSES,orderBy:"metadata.createdDate desc"}}),n=(0,r("4JHZe").beforePreloaderAsyncCall)();return o().then(e=>{if((0,r("4JHZe").afterPreloaderAsyncCall)(n),e)return t})};e.exports.preloadBlogTree=n}),i("22UVa",function(e,t){e.exports.preloadSmartCreateFeedbackBanner=function(e){return(0,r("dYU3e").query)({query:r("gRzR4").default,variables:{contentId:e}})}}),i("4VWAo",function(e,t){let o=async()=>{if(window.__SSR_TAP_CONTEXT__?.siteUser)return;let{accessStatus:e,cloudId:t,userId:o}=(0,r("xwvlW").getPreloaderFnContext)();if("LICENSED_USE_ACCESS"!==e&&"LICENSED_ADMIN_ACCESS"!==e||!t||!o)return;let{tapContext:n}=(0,r("60cDW").getSSRRenderInputs)();(0,r("dcJRl").formatTapTraits)(n?.siteUser)&&n&&(window.__SSR_TAP_CONTEXT__={...n})};e.exports.preloadSiteUserTraits=o}),i("dA1Sn",function(e,o){var n=r("3u0dr"),a=r("frIzR"),i=r("42omo");let s=(e,t)=>{let o=window.__FULLCYCLE__?.[e],n=!window.__SSR_RENDERED__,[a,r]=(0,i.useState)(n||!o||!window.__HYDRATABLE__||!t);return(0,i.useEffect)(()=>{r(!0);let t=()=>{delete window.__FULLCYCLE__?.[e]};return setTimeout(t,3e4),t},[e]),{hydrated:a,fullCycleOutput:o}},l=(0,n.isReactCompilerActiveV1)()?e=>{let o,n,l=(0,a.c)(20),{style:d,name:c,children:p,enabled:u}=e,m=void 0!==u&&u,{hydrated:f,fullCycleOutput:g}=s(c,m);if((0,r("6mKj3").expValEquals)("cc_fix_hydration_ttvc","isEnabled",!0)){let e,o,n;if(!m)return p;if(f){let e,o;return l[0]===Symbol.for("react.memo_cache_sentinel")?(e={position:"relative",height:"100%",width:"100%"},l[0]=e):e=l[0],l[1]!==p||l[2]!==c?(o=t(i).createElement("div",{"data-testid":"two-stage-hydration","data-fullcycle-name":c,style:e},p),l[1]=p,l[2]=c,l[3]=o):o=l[3],o}return l[4]!==g?(e={__html:g},l[4]=g,l[5]=e):e=l[5],l[6]===Symbol.for("react.memo_cache_sentinel")?(o={position:"relative",height:"100%",width:"100%"},l[6]=o):o=l[6],l[7]!==c||l[8]!==e?(n=t(i).createElement("div",{"data-testid":"two-stage-hydration","data-fullcycle-name":c,dangerouslySetInnerHTML:e,style:o}),l[7]=c,l[8]=e,l[9]=n):n=l[9],n}return!m||f?p:(l[14]!==g?(o={__html:g},l[14]=g,l[15]=o):o=l[15],l[16]!==c||l[17]!==d||l[18]!==o?(n=t(i).createElement("div",{style:d,"data-testid":"two-stage-hydration","data-fullcycle-name":c,dangerouslySetInnerHTML:o}),l[16]=c,l[17]=d,l[18]=o,l[19]=n):n=l[19],n)}:({style:e,name:o,children:n,enabled:a=!1})=>{let{hydrated:l,fullCycleOutput:d}=s(o,a);return(0,r("6mKj3").expValEquals)("cc_fix_hydration_ttvc","isEnabled",!0)?a?l?t(i).createElement("div",{"data-testid":"two-stage-hydration","data-fullcycle-name":o,style:{position:"relative",height:"100%",width:"100%"}},n):t(i).createElement("div",{"data-testid":"two-stage-hydration","data-fullcycle-name":o,dangerouslySetInnerHTML:{__html:d},style:{position:"relative",height:"100%",width:"100%"}}):n:!a||l?n:t(i).createElement("div",{style:e,"data-testid":"two-stage-hydration","data-fullcycle-name":o,dangerouslySetInnerHTML:{__html:d}})},d=(0,n.isReactCompilerActiveV1)()?e=>{let o,n,s=(0,a.c)(5),{name:d,style:c,children:p}=e;return s[0]===Symbol.for("react.memo_cache_sentinel")?(o=(0,r("6mKj3").expValEquals)("confluence_editor_hydration_partial","isEnabled",!0),s[0]=o):o=s[0],s[1]!==p||s[2]!==d||s[3]!==c?(n=t(i).createElement(l,{name:d,style:c,enabled:o},p),s[1]=p,s[2]=d,s[3]=c,s[4]=n):n=s[4],n}:({name:e,style:o,children:n})=>t(i).createElement(l,{name:e,style:o,enabled:(0,r("6mKj3").expValEquals)("confluence_editor_hydration_partial","isEnabled",!0)},n);e.exports.saveFullCycleOutput=()=>{let e=document.querySelectorAll("[data-fullcycle-name]");e.length>0&&(window.__FULLCYCLE__=Array.from(e).reduce((e,t)=>(e[t.dataset.fullcycleName]=t.innerHTML,e),{}))},e.exports.TwoStageHydration=d}),i("2JYae",function(e,t){e.exports.useIsDesktop=()=>({isDesktop:(0,r("bmTgR").isDesktop)()})}),i("7f6xB",function(e,o){var n=r("42omo");e.exports.HeadingLinksStyleWrapper=({children:e})=>t(n).createElement("div",{className:(0,r("gMc0m").default)(["_1tk1glyw _p7zlh2mm _wx3btlke _1cuh7vkz _1cgp1h22 _ubne14id _1gl21nu9 _12nk1nu9 _4v031nu9 _12fa1nu9 _syhn1nu9 _1r3i1nu9 _193y14id _13i6stnw _1sfutlke _w25x1qgb _rtxh92b3 _1gjm1ssu _99kk15i3 _12r2gktf _dv30gktf _10lodlk8 _1atodlk8"])},e)}),i("6gbpH",function(e,o){var n=r("42omo"),a=r("biMIt");let i=(0,n.forwardRef)(({as:e="div",style:o,...a},i)=>t(n).createElement(e,{...a,style:o,ref:i,className:(0,r("gMc0m").default)(["_19121cl4 _piutysee _mnh0vuon _duwl16wv _zpcaihuw _1lp21h6o _14lf1wug _1tvp1i3y _d4p1xy5q _wpot1ejb _1bl4idpf _apxy1b66",a.className])}));e.exports.HubEditorWrapper=({children:e})=>t(n).createElement(a.AudienceSegmentationContextProvider,{isCompanyHub:!0,shouldFetchUserGroups:!0},t(n).createElement(i,null,e))}),i("2E0F0",function(e,o){var n=r("l998X");r("42omo");var a=r("dZ8uq"),i=r("iu6m9"),s=r("8m4tT"),l=r("bSjaC"),d=r("4T4vf"),c=r("1oCLl");let p="data-node-anchor",u="data-prosemirror-node-name",m=()=>(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)?p:"data-drag-handler-anchor-name",f=()=>(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)?u:"data-drag-handler-node-type",g=e=>["H1","H2","H3","H4","H5","H6"].includes(e.tagName),h=e=>{if(!e)return"";let t=e?.getAttribute(u);if(!t)return"";if(g(e))switch(e.tagName){case"H1":return"heading-1";case"H2":return"heading-2";case"H3":return"heading-3";case"H4":return"heading-4";case"H5":return"heading-5";case"H6":return"heading-6"}return t};var b=r("jTxSS"),y=r("dQl1W");let _="drop-target-decoration",S="drag-handle",E="node-decoration",v=e=>{let t=C.getForNode(e);return`--node-anchor-${e.type.name}-${t}`},T=e=>{let t=e.attrs.level?`-${e.attrs.level}`:"";return e.type.name+t};class C{static getForNode(e){if(this.caching.has(e))return this.caching.get(e);let o=t(y)();return this.caching.set(e,o),o}}C.caching=new WeakMap;let x=(e,o,n)=>{document.querySelectorAll(`[${o}="true"]`).forEach(e=>{t(b).unmountComponentAtNode(e)})},A=["tableCell","tableHeader","tableRow","listItem","caption","layoutColumn"],k=["tableCell","tableHeader","tableRow","listItem","caption"],I=["listItem","taskList","decisionList","mediaSingle"],P=["listItem","taskList","decisionList"],N=e=>(!["tableCell","tableHeader"].includes(e.type.name)||1!==e.childCount||e.firstChild?.type.name!=="paragraph"||0!==e.firstChild.childCount)&&((0,i.editorExperiment)("advanced_layouts",!0)?!P.includes(e.type.name):!I.includes(e.type.name)),w=(e,t,o,n)=>{let a="embedCard"===e.type.name,r="mediaSingle"===e.type.name,s=e.type.schema.nodes,l=e.type.name===s?.table?.name,d=n&&[s.tableHeader,s.tableCell].includes(n.type);return!!l&&!!d||!(n?.type.name==="table"&&1===o&&e===n.firstChild&&"tableRow"===e.type.name&&(0,i.editorExperiment)("advanced_layouts",!0))&&("extension"===e.type.name&&e.attrs?.extensionType==="com.atlassian.confluence.migration"&&e.attrs?.extensionKey==="legacy-content"||!!((a||r)&&["wrap-right","wrap-left"].includes(e.attrs.layout))||t.includes(e.type.name))},D=(e,t)=>{if(t<=0||t>=e.doc.nodeSize-2)return t;let o=e.doc.resolve(t);return o.depth>0?o.before():t},O=(e,t,o,n)=>{let a=o;if((0,i.editorExperiment)("platform_editor_block_control_optimise_render",!0)){if("number"==typeof n&&"number"==typeof a&&a>n)return[];let e=t.find(a,n,e=>e.type===E);return"number"==typeof n&&"number"==typeof a&&(e=e.filter(e=>e.from>=(a||0)&&e.from<n)),e}{let e=n;return(void 0!==a&&a++,void 0!==e&&e--,void 0!==a&&void 0!==e&&a>e)?[]:t.find(a,e,e=>e.type===E)}},M=(e,t,o)=>{let n=[];if((0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0))return[];let a=void 0===t||t<0?0:t,s=void 0===o||o>e.doc.nodeSize-2?e.doc.nodeSize-2:o,l=(0,i.editorExperiment)("advanced_layouts",!0)?k:A;return e.doc.nodesBetween(a,s,(t,o,s,d)=>{let c=0,p=N(t),u=v(t),m=T(t);if((0,i.editorExperiment)("platform_editor_block_control_optimise_render",!0)&&o<D(e,a))return p;if(t.isInline)return!1;if(w(t,l,c=e.doc.resolve(o).depth,s))return p;let f=`anchor-name: ${u};`;return n.push(r("ftzrq").Decoration.node(o,o+t.nodeSize,{style:f,"data-drag-handler-anchor-name":u,"data-drag-handler-node-type":m,"data-drag-handler-anchor-depth":`${c}`},{type:E,anchorName:u,nodeType:t.type.name,nodeTypeWithLevel:m})),p&&c<100}),n};var R=r("42omo"),L=r("afUmf");let B=new(0,r("ks2lK").PluginKey)("selectionPreservationPlugin"),V=(e,t,o,n,a,i,s,l,d,c)=>l?.analytics?.actions?.attachAnalyticsEvent({eventType:r("d925B").EVENT_TYPE.TRACK,action:r("d925B").ACTION.MOVED,actionSubject:r("d925B").ACTION_SUBJECT.ELEMENT,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.ELEMENT_DRAG_HANDLE,attributes:{nodeDepth:o,nodeType:n,nodeTypes:d,hasSelectedMultipleNodes:c,destinationNodeDepth:a,destinationNodeType:i,isSameParent:s,inputMethod:t}})(e),F=(e,t,o,n,a)=>{t?.analytics?.actions?.attachAnalyticsEvent({action:r("d925B").ACTION.INSERTED,actionSubject:r("d925B").ACTION_SUBJECT.DOCUMENT,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.LAYOUT,attributes:{inputMethod:r("d925B").INPUT_METHOD.DRAG_AND_DROP,nodeTypes:o,hasSelectedMultipleNodes:n,columnCount:a},eventType:r("d925B").EVENT_TYPE.TRACK})(e)},U=(e,t,o)=>{let n=[],a=Math.min(t,o),i=Math.max(t,o);return e.doc.nodesBetween(a,i,(e,t)=>t<a||(n.push(e.type.name),!1)),{nodeTypes:(0,r("dh538").fg)("platform_editor_track_node_types")?[...new Set(n)].sort().join(","):void 0,hasSelectedMultipleNodes:n.length>1}},G=r("aFUXX").akRichMediaResizeZIndex+r("aFUXX").akEditorUnitZIndex,q=r("Yqd3z").DRAG_HANDLE_WIDTH+12,H={width:24,height:24},j=["embedCard","mediaSingle","table"],$=["expand","layoutSection","codeBlock"],K=(e,t)=>{if(t&&"doc"!==t)return 4;let o=(0,i.editorExperiment)("platform_synced_block",!0)?r("fJNzZ").breakoutResizableNodes:$;if((0,i.editorExperiment)("platform_editor_breakout_resizing",!0)&&o.includes(e))if("layoutSection"===e)return 32;else return 12;return"layoutSection"===e?28:j.includes(e)?12:8},z=e=>{let t=(0,i.editorExperiment)("platform_synced_block",!0)?r("fJNzZ").breakoutResizableNodes:$;if(j.includes(e)||(0,i.editorExperiment)("platform_editor_breakout_resizing",!0)&&t.includes(e))if("layoutSection"===e)return 32;else return 12;return"layoutSection"===e?24:8},W=e=>{switch(e){case"bodiedExtension":return"28px";case"expand":case"nestedExpand":return"24px";case"layoutColumn":return"20px";case"panel":return"40px";case"tableCell":case"tableHeader":return"8px";default:return`${r("Yqd3z").DRAG_HANDLE_WIDTH+4}px`}},Y=e=>{if((0,i.editorExperiment)("advanced_layouts",!0)&&"layoutSection"===e)return 8;switch(e){case"rule":return -6;case"table":return 24;case"paragraph":case"heading-2":return 2;case"heading-1":return 5;case"heading-3":return -1;case"heading-4":case"heading-5":case"heading-6":return -3;default:return 0}},X={[-24]:"var(--ds-space-negative-300, -24px)",[-20]:"var(--ds-space-negative-250, -20px)",[-16]:"var(--ds-space-negative-200, -16px)",[-12]:"var(--ds-space-negative-150, -12px)",[-8]:"var(--ds-space-negative-100, -8px)",[-6]:"var(--ds-space-negative-075, -6px)",[-4]:"var(--ds-space-negative-050, -4px)",[-2]:"var(--ds-space-negative-025, -2px)",0:"var(--ds-space-0, 0)",2:"var(--ds-space-025, 2px)",4:"var(--ds-space-050, 4px)",6:"var(--ds-space-075, 6px)",8:"var(--ds-space-100, 8px)",12:"var(--ds-space-150, 12px)",16:"var(--ds-space-200, 16px)",20:"var(--ds-space-250, 20px)",24:"var(--ds-space-300, 24px)"};Object.fromEntries(Array.from({length:49},(e,t)=>{let o=t-24,n=Object.keys(X).map(Number).reduce((e,t)=>Math.abs(o-t)<Math.abs(o-e)?t:e,1e3);return[o,X[n]]}));let J={paragraph:{top:"0.75rem",bottom:"0"},heading1:{top:"1.45833em",bottom:"0"},heading2:{top:"1.4em",bottom:"0"},heading3:{top:"1.31249em",bottom:"0"},heading4:{top:"1.25em",bottom:"0"},heading5:{top:"1.45833em",bottom:"0"},heading6:{top:"1.59091em",bottom:"0"},table:{top:"0",bottom:"0"},bulletList:{top:"10px",bottom:"0"},orderedList:{top:"10px",bottom:"0"},decisionList:{top:"0.5rem",bottom:"0"},taskList:{top:"0.75rem",bottom:"0"},codeBlock:{top:"0.75rem",bottom:"0"},panel:{top:"0.75rem",bottom:"0"},rule:{top:"1.5rem",bottom:"1.5rem"},mediaSingle:{top:"24px",bottom:"24px"},media:{top:"24px",bottom:"24px"},bodiedExtension:{top:"0",bottom:"0"},extension:{top:"0",bottom:"0"},layoutSection:{top:"0",bottom:"0"},blockquote:{top:"0",bottom:"0"},embedCard:{top:"24px",bottom:"24px"},blockCard:{top:"0.75rem",bottom:"0"},default:{top:"0",bottom:"0"}},Q={table:{top:24,bottom:16},paragraph:{top:12,bottom:6},bulletList:{top:16,bottom:0},orderedList:{top:16,bottom:0},decisionList:{top:12,bottom:0},taskList:{top:8,bottom:0},codeBlock:{top:12,bottom:0},panel:{top:8,bottom:0},rule:{top:24,bottom:24},mediaSingle:{top:24,bottom:24},media:{top:24,bottom:24},bodiedExtension:{top:0,bottom:0},extension:{top:12,bottom:12},heading1:{top:40,bottom:0},heading2:{top:40,bottom:0},heading3:{top:36,bottom:0},heading4:{top:22,bottom:0},heading5:{top:22,bottom:0},heading6:{top:18,bottom:0},layoutSection:{top:8,bottom:0},blockquote:{top:12,bottom:0},expand:{top:4,bottom:0},nestedExpand:{top:1,bottom:0},default:{top:0,bottom:0}},Z={1:100,2:50,3:33.33,4:25,5:20},ee=["panel","table","expand","layoutSection","bodiedExtension"],et=(e,t)=>{if(!e)return"auto";let o=e.querySelector("table");if(o&&(!t||"table"===t))return`${e.offsetTop+(o?.offsetTop||0)}px`;if("rule"===t)return`${e.offsetTop-6}px`;if("layoutColumn"===t)return`${-e.offsetTop/2}px`;if("heading-1"===t)return`${e.offsetTop+5}px`;if("heading-2"===t)return`${e.offsetTop+2}px`;else if("heading-3"===t)return`${e.offsetTop}px`;else if("heading-4"===t)return`${e.offsetTop-3}px`;else if("heading-5"===t)return`${e.offsetTop-3}px`;else if("heading-6"===t)return`${e.offsetTop-3}px`;else if("paragraph"===t)return`${e.offsetTop+2}px`;else return`${e.offsetTop}px`},eo=(e,t,o,n,a)=>{if(!e)return"auto";if(!o)return"layoutColumn"===t?`${e.offsetLeft+e.clientWidth/2-12}px`:`${e.offsetLeft-K(t,a)-r("Yqd3z").DRAG_HANDLE_WIDTH}px`;let i=n?e.querySelector("span.relative"):null,s=i?i.offsetLeft:0;return"none"===getComputedStyle(o).transform?`${o.offsetLeft+s-K(t,a)-r("Yqd3z").DRAG_HANDLE_WIDTH}px`:`${o.offsetLeft+s-o.offsetWidth/2-K(t,a)-r("Yqd3z").DRAG_HANDLE_WIDTH}px`},en=(e,t,o)=>o?.getHeight(t)||e?.offsetHeight,ea=e=>(0,i.editorExperiment)("platform_editor_controls","variant1")&&ee.includes(e),er=(e,t,o,n)=>(0,i.editorExperiment)("advanced_layouts",!0)&&n||!t||!o?{bottom:"unset"}:{bottom:`anchor(${e} end)`},ei=(e,t,o,n,a)=>(0,i.editorExperiment)("advanced_layouts",!0)&&a||!t||!o?{height:"unset"}:{height:`${e||n}px`},es=(e,t)=>t&&["table"].includes(e)&&(0,i.editorExperiment)("platform_editor_controls","variant1"),el=(e,t,o)=>{let n=e.resolve(t),a=t,r=!1,i=0;return e.nodesBetween(n.pos,n.pos+o,(e,t)=>(e.isInline&&(i=t+e.nodeSize),e.isInline&&!r&&(a=t,r=!0),!0)),{inlineNodePos:a,inlineNodeEndPos:i}},ed=(e,t,o)=>{let n=e.resolve(t),a=!1;return e.nodesBetween(n.pos,n.pos+o,e=>{["media","extension"].includes(e.type.name)&&(a=!0)}),a},ec=(e,t)=>{let o=e.doc.nodeAt(t),n=o&&r("ks2lK").NodeSelection.isSelectable(o),a=o?o.nodeSize:1,i=e.doc.resolve(t),s=o?.type.name,l="blockquote"===s&&ed(e.doc,t,a),d="bulletList"===s&&ed(e.doc,t,a)||"orderedList"===s&&ed(e.doc,t,a);if(n&&"blockquote"!==s||d||l||["decisionList","layoutColumn"].includes(s||""))return new(0,r("ks2lK").NodeSelection)(i);if("mediaGroup"===s&&o?.childCount===1){let o=e.doc.resolve(t+1);return new(0,r("ks2lK").NodeSelection)(o)}{if("mediaGroup"===s)return new(0,r("ks2lK").NodeSelection)(i);if("taskList"===s)return r("ks2lK").TextSelection.create(e.doc,t,t+a);let{inlineNodePos:o,inlineNodeEndPos:n}=el(e.doc,t,a);return new(0,r("ks2lK").TextSelection)(e.doc.resolve(o),e.doc.resolve(n))}},ep=(e,t,o)=>{let n=e.nodeAt(o),i=n&&r("ks2lK").NodeSelection.isSelectable(n),s=n?n.nodeSize:1,l=n?.type.name;if("paragraph"===l&&t&&n?.childCount===0&&!(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0))return!1;let d=["paragraph","heading"].includes(l||"")&&t&&n?.childCount===0,c=["orderedList","bulletList","taskList"].includes(l||"")&&t&&n?.textContent==="";if((d||c)&&(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0))return r("ks2lK").TextSelection.create(e,o+1,o+1);let p="blockquote"===l&&ed(e,o,s),u="bulletList"===l&&ed(e,o,s)||"orderedList"===l&&ed(e,o,s);if(i&&("blockquote"!==l||(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0))||u||p||["decisionList","layoutColumn"].includes(l||"")||"mediaGroup"===l&&"number"==typeof n?.childCount&&n?.childCount>1)return new(0,r("ks2lK").NodeSelection)(e.resolve(o));if("mediaGroup"===l){let t=e.resolve(o+1);return new(0,r("ks2lK").NodeSelection)(t)}if("taskList"===l&&!(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0))return r("ks2lK").TextSelection.create(e,o,o+s);let{inlineNodePos:m,inlineNodeEndPos:f}=el(e,o,s);return new(0,r("ks2lK").TextSelection)(e.resolve(m),e.resolve(f))},eu=(e,t,o)=>(0,r("iHzeA").areToolbarFlagsEnabled)(!!o?.toolbar)?ep(e.doc,e.selection.empty,t):ec(e,t),em=(e,t,o,n)=>{if("table"===o)return e=(0,r("kEbNW").selectTableClosestToPos)(e,e.doc.resolve(t+1));let a=eu(e,t,n);return a&&e.setSelection(a),e},ef=(e,t,o)=>{let n,a=e.doc.nodeAt(t),i=a&&r("ks2lK").NodeSelection.isSelectable(a),s=a?a.nodeSize:1;if(i&&"blockquote"!==a.type.name||a?.type.name==="decisionList")return n=new(0,r("adhil").GapCursorSelection)(e.doc.resolve(t+a.nodeSize),r("adhil").Side.RIGHT),e.setSelection(n),e;if(a?.type.name==="paragraph"&&a?.childCount===0&&(0,r("iHzeA").areToolbarFlagsEnabled)(!!o?.toolbar)){let o=new(0,r("ks2lK").TextSelection)(e.doc.resolve(t));return e.setSelection(o),e}let{inlineNodeEndPos:l}=el(e.doc,t,s);return n=new(0,r("ks2lK").TextSelection)(e.doc.resolve(l)),e.setSelection(n),e},eg=(e,t,o)=>{let n;if(t.empty)return!1;let a=t.$from;(n=a.before(a.sharedDepth(t.to)+1))===a.pos&&(n=a.depth?a.before():a.pos);let r=e.doc.resolve(n);if(["tableRow","tableCell","tableHeader"].includes(r.node().type.name)){let o=(0,s.findParentNodeOfType)(e.schema.nodes.table)(t),a=o?.pos;n=void 0===a?n:a}else if(["listItem"].includes(r.node().type.name))n=r.before(eh(r));else if(["taskList"].includes(r.node().type.name)){let e=eb(r);n=r.before(e)}else["blockquote"].includes(r.node().type.name)&&(n=r.before());return!!(o<t.$to.pos&&o>=n)},eh=e=>{let t;for(let o=e.depth;o>1;o-=2)if("listItem"===e.node(o).type.name)t=o-1;else break;return t},eb=e=>{let t;for(let o=e.depth;o>0;o--){let n=e.node(o);if("taskList"===n.type.name||"taskItem"===n.type.name)t=o;else break}return t},ey=(e,t)=>{let o=ep(e.doc,!0,e.pos),n=t.nodeBefore?.nodeSize??0,a=t.pos-n,r=ep(e.doc,!0,a);return{$from:e.doc.resolve(o?o.from:e.pos),$to:t.doc.resolve(r?r.to:t.pos)}},e_=(e,t,o)=>{let n=e?.blockControls?.sharedState.currentState(),a=n?.multiSelectDnD??o?.getMeta(nn)?.multiSelectDnD;if(a&&a.anchor>=0&&a.head>=0){let e=Math.min(a.anchor,a.head),o=Math.max(a.anchor,a.head);return t>=e-1&&t<o?{anchor:a.anchor,head:a.head}:{}}return{}},eS=(e,t,o)=>{let{anchor:n,head:a}=e_(o,e,t),r=void 0!==n&&void 0!==a,i=r?Math.min(n||0,a||0):e,s=t.doc.nodeAt(e),l=e+(s?.nodeSize??1);return{from:i,to:r?Math.max(n||0,a||0):l}},eE=(e,t)=>{let o=e.$anchor.doc;if(t<0||t>o.nodeSize-2||e.empty)return e;let n=o.resolve(t),a=n.nodeAfter;if(n.node().isTextblock||!a)return e;let i=t<e.anchor?n:o.resolve(a.nodeSize+t);return new(0,r("ks2lK").TextSelection)(e.$anchor,i)},ev=(e,t)=>e instanceof r("ks2lK").NodeSelection&&Math.max(t,e.anchor)===e.anchor?new(0,r("ks2lK").TextSelection)(e.$head,e.$anchor):e,eT=(e,t)=>{let{preservedSelectionMapping:o}=nf(t)||{},n=o||t.mapping;if(e instanceof r("ks2lK").TextSelection){let o=n.map(e.from),a=n.map(e.to),i=o===a,s=e.from===e.to;if(i&&!s)return;let l=(0,r("l6okE").expandToBlockRange)(t.doc.resolve(o),t.doc.resolve(a)),d=l.$from.nodeAfter,c=d===l.$to.nodeBefore&&d?.content.size===0;if(i&&c)return r("ks2lK").TextSelection.create(t.doc,o);let{$from:p,$to:u}=ey(l.$from,l.$to);if(p.pos<0||u.pos>t.doc.content.size||p.pos>=u.pos)return;return new(0,r("ks2lK").TextSelection)(p,u)}try{return e.map(t.doc,n)}catch{return}},eC={borderColor:`var(--ds-border, ${r("6fnsQ").N30})`,borderStyle:"solid",borderRadius:"var(--ds-radius-small, 3px)",borderWidth:"var(--ds-border-width-selected, 2px)",backgroundColor:`var(--ds-skeleton-subtle, ${r("6fnsQ").N20})`},ex=(e,t)=>{let o=e,n=e.querySelector("iframe");"embedCard"===t?o=e.querySelector(".rich-media-item")||e:"extension"===t&&n&&(o=n);let a=o.getBoundingClientRect();return{width:a.width,height:a.height}},eA=e=>{let t=0,o=0;for(let n=0;n<e.length;n++){let a=e[n],{width:r,height:i}=ex(a.dom,a.nodeType);r>t&&(t=r),o+=i}return{width:t,height:o}},ek=()=>{let e=document.createElement("div");return e.classList.add("ProseMirror","block-ctrl-drag-preview"),e.style.border=`${eC.borderWidth} ${eC.borderStyle} ${eC.borderColor}`,e.style.borderRadius=eC.borderRadius,e.style.backgroundColor=eC.backgroundColor,e.style.height="100%",e.setAttribute("data-testid","block-ctrl-generic-drag-preview"),e},eI=(e,t,o)=>{let n=document.createElement("div");n.classList.add("ProseMirror","block-ctrl-drag-preview");let a=e.querySelector(".resizer-item"),i=a&&["mediaSingle","table"].includes(t)?a.cloneNode(!0):e.cloneNode(!0),s=(0,c.expValEquals)("platform_editor_hydratable_ui","isEnabled",!0)?(0,r("d7ZU3").getBrowserInfo)():r("d7ZU3").browser;return i.style.marginLeft="0",i.style.marginTop=o?`${o.top}`:"0",i.style.marginRight="0",i.style.marginBottom=o?`${o.bottom}`:"0",i.style.boxShadow="none",i.style.opacity=s.windows?"1":"0.31",n.appendChild(i),n},eP=(e,t)=>{let o=e.querySelector(".embedCardView-content-wrap");return"embedCard"===t||!!o||"extension"===t&&!!e.querySelector("iframe")},eN=(e,t,o)=>eP(e,t)?ek():eI(e,t,o),ew=(e,t)=>{e.style.pointerEvents="none",Array.isArray(t)||"object"!=typeof t||(t=[t]);let{width:o,height:n}=eA(t);e.style.width=`${o}px`,e.style.height=`${n}px`;let a=document.createDocumentFragment();for(let e=0;e<t.length;e++){let o=t[e],n=eN(o.dom,o.nodeType,o.nodeSpacing);a.appendChild(n)}e.appendChild(a);let r=document.querySelector(".fabric-editor-popup-scroll-parent");return e.className=r?.className||"",e.classList.remove("fabric-editor-popup-scroll-parent"),e.style.overflow="visible",()=>e},eD=({getPos:e,view:t,anchorName:o})=>{let n=o||"";if((0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0))return n;let a=e();if(o||void 0===a)return n;let r=t.state.doc.nodeAt(a),i=nn.getState(t.state);if(i?.decorations){let e=O(t.state,i.decorations,a,a+(r?.nodeSize??0)).at(0);if(!e)return n;n=e.spec.anchorName}return n};r("42omo");let eO=(0,r("ecnYn").xcss)({transition:"opacity 0.1s ease-in-out, visibility 0.1s ease-in-out"}),eM=(0,r("ecnYn").xcss)({opacity:1,visibility:"visible"}),eR=(0,r("ecnYn").xcss)({opacity:0,visibility:"hidden"}),eL=(0,r("9K4OG").css)({transition:"opacity 0.1s ease-in-out, visibility 0.1s ease-in-out",[`@container editor-area (max-width: ${r("aFUXX").akEditorFullPageNarrowBreakout}px)`]:{opacity:0,visibility:"hidden"}}),eB={name:"nk3zlf",styles:"opacity:1;visibility:visible"},eV={name:"8792bh",styles:"opacity:0;visibility:hidden"},eF=({api:e,children:t})=>{let o=(0,r("b3YrF").useSharedPluginStateSelector)(e,"typeAhead.isOpen"),n=(0,r("b3YrF").useSharedPluginStateSelector)(e,"blockControls.isEditing"),a=(0,r("b3YrF").useSharedPluginStateSelector)(e,"blockControls.isMouseOut"),s=(0,r("b3YrF").useSharedPluginStateSelector)(e,"userIntent.currentUserIntent"),l=o||n||a||"aiStreaming"===s;return(0,i.editorExperiment)("platform_editor_preview_panel_responsiveness",!0,{exposure:!0})?(0,r("9K4OG").jsx)("div",{css:[eL,l?eV:eB]},t):(0,r("9K4OG").jsx)(r("6f0Oj").default,{xcss:[eO,l?eR:eM]},t)},eU=(0,r("ecnYn").xcss)({display:"flex",justifyContent:"center",alignItems:"center"}),eG=(0,r("9K4OG").css)({display:"flex",justifyContent:"center",alignItems:"center",'[data-blocks-drag-handle-container]:has(+ [data-prosemirror-node-name="table"] .pm-table-with-controls tr.sticky) &':{background:"linear-gradient(to bottom, var(--ds-surface, #FFFFFF) 90%, transparent)",marginBottom:"var(--ds-space-negative-200, -16px)",paddingBottom:"var(--ds-space-200, 16px)",marginTop:"var(--ds-space-negative-400, -32px)",paddingTop:"calc(var(--ds-space-400, 32px) - 1px)",marginRight:"var(--ds-space-negative-150, -12px)",paddingRight:"var(--ds-space-150, 12px)",boxSizing:"border-box"},'[data-prosemirror-mark-name="breakout"]:has([data-blocks-drag-handle-container]):has(+ [data-prosemirror-node-name="table"] .pm-table-with-controls tr.sticky) &':{background:"linear-gradient(to bottom, var(--ds-surface, #FFFFFF) 90%, transparent)",marginBottom:"var(--ds-space-negative-200, -16px)",paddingBottom:"var(--ds-space-200, 16px)",marginTop:"var(--ds-space-negative-400, -32px)",paddingTop:"calc(var(--ds-space-400, 32px) - 1px)",marginRight:"var(--ds-space-negative-150, -12px)",paddingRight:"var(--ds-space-150, 12px)",boxSizing:"border-box"}}),eq=(0,r("9K4OG").css)({'[data-blocks-drag-handle-container]:has(+ [data-prosemirror-node-name="table"] .pm-table-with-controls [data-number-column="true"] tr.sticky) &':{marginRight:-r("aFUXX").akEditorTableToolbarSize,paddingRight:r("aFUXX").akEditorTableToolbarSize},'[data-prosemirror-mark-name="breakout"]:has([data-blocks-drag-handle-container]):has(+ [data-prosemirror-node-name="table"] .pm-table-with-controls [data-number-column="true"] tr.sticky) &':{marginRight:-r("aFUXX").akEditorTableToolbarSize,paddingRight:r("aFUXX").akEditorTableToolbarSize}}),eH={name:"101f0nf",styles:"color:var(--ds-icon-subtle, #505258)"},ej=(0,r("9K4OG").css)({display:"flex",boxSizing:"border-box",flexDirection:"column",justifyContent:"center",alignItems:"center",height:24,width:r("Yqd3z").DRAG_HANDLE_WIDTH,border:"none",background:"transparent",borderRadius:4,color:"var(--ds-icon, #44546F)",cursor:"grab",zIndex:G,outline:"none","&:hover":{backgroundColor:"var(--ds-background-neutral-subtle-hovered, #091E420F)"},"&:active":{backgroundColor:"var(--ds-background-neutral-subtle-pressed, #091E4224)"},"&:disabled":{color:"var(--ds-icon-disabled, #8993A4)",backgroundColor:"transparent"},"&:hover:disabled":{backgroundColor:"var(--ds-background-disabled, transparent)"}}),e$=(0,r("9K4OG").css)({height:(0,r("aFUXX").relativeSizeToBaseFontSize)(24),width:(0,r("aFUXX").relativeSizeToBaseFontSize)(r("Yqd3z").DRAG_HANDLE_WIDTH)}),eK=(0,r("9K4OG").css)({[`@container editor-area (max-width: ${r("aFUXX").akEditorFullPageNarrowBreakout}px)`]:{opacity:0,visibility:"hidden"}}),ez=(0,r("9K4OG").css)({position:"absolute",paddingTop:"var(--ds-space-025, 2px)",paddingBottom:"var(--ds-space-025, 2px)",paddingLeft:"0",paddingRight:"0",boxSizing:"border-box",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:24,width:r("Yqd3z").DRAG_HANDLE_WIDTH,border:"none",background:"transparent",borderRadius:4,color:"var(--ds-icon, #44546F)",cursor:"grab",zIndex:G,outline:"none","&:hover":{backgroundColor:"var(--ds-background-neutral-subtle-hovered, #091E420F)"},"&:active":{backgroundColor:"var(--ds-background-neutral-subtle-pressed, #091E4224)"},"&:focus":{outline:"var(--ds-border-width-focused, 2px) solid var(--ds-border-focused, #388BFF)"},"&:disabled":{color:"var(--ds-icon-disabled, #8993A4)",backgroundColor:"transparent"},"&:hover:disabled":{backgroundColor:"var(--ds-background-disabled, transparent)"}}),eW=(0,r("9K4OG").css)({"&:focus":{outline:"var(--ds-border-width-focused, 2px) solid var(--ds-border-focused, #388BFF)"}}),eY=(0,r("9K4OG").css)({"&:focus-visible":{outline:"var(--ds-border-width-focused, 2px) solid var(--ds-border-focused, #388BFF)"}}),eX=(0,r("9K4OG").css)({outline:"var(--ds-border-width-focused, 2px) solid var(--ds-border-focused, #388BFF)"}),eJ=(0,r("ecnYn").xcss)({position:"absolute",boxSizing:"border-box"}),eQ=(0,r("9K4OG").css)({bottom:"-8px",position:"sticky",display:"block",zIndex:100}),eZ=(0,r("9K4OG").css)({top:"8px",'[data-blocks-drag-handle-container]:has(+ [data-prosemirror-node-name="table"] .pm-table-with-controls tr.sticky) &':{top:"0"},'[data-prosemirror-mark-name="breakout"]:has([data-blocks-drag-handle-container]):has(+ [data-prosemirror-node-name="table"] .pm-table-with-controls tr.sticky) &':{top:"0"}}),e0=(0,r("9K4OG").css)({top:"8px",'[data-blocks-drag-handle-container]:has(+ [data-prosemirror-node-name="table"] .pm-table-with-controls tr.sticky) &':{top:"0"},'[data-prosemirror-mark-name="breakout"]:has([data-blocks-drag-handle-container]):has(+ [data-prosemirror-node-name="table"] .pm-table-with-controls tr.sticky) &':{top:"0"},'[data-blocks-drag-handle-container]:has(+ [data-prosemirror-mark-name="fragment"] >[data-prosemirror-node-name="table"] .pm-table-with-controls tr.sticky) &':{top:r("1zav4").tableControlsSpacing},'[data-prosemirror-mark-name="breakout"]:has([data-blocks-drag-handle-container]):has(+ [data-prosemirror-mark-name="fragment"] >[data-prosemirror-node-name="table"] .pm-table-with-controls tr.sticky) &':{top:r("1zav4").tableControlsSpacing},'[data-blocks-drag-handle-container]:has(+ [data-prosemirror-node-name="table"] tr.pm-table-row-native-sticky.pm-table-row-native-sticky-active) &':{top:"24px"},'[data-prosemirror-mark-name="breakout"]:has([data-blocks-drag-handle-container]):has(+ [data-prosemirror-node-name="table"] tr.pm-table-row-native-sticky.pm-table-row-native-sticky-active) &':{top:"24px"},'[data-blocks-drag-handle-container]:has(+ [data-prosemirror-mark-name="fragment"] >[data-prosemirror-node-name="table"] tr.pm-table-row-native-sticky.pm-table-row-native-sticky-active) &':{top:"24px"},'[data-prosemirror-mark-name="breakout"]:has([data-blocks-drag-handle-container]):has(+ [data-prosemirror-mark-name="fragment"] > [data-prosemirror-node-name="table"] tr.pm-table-row-native-sticky.pm-table-row-native-sticky-active) &':{top:"24px"}}),e1=(0,r("9K4OG").css)({top:"8px",'[data-blocks-drag-handle-container]:has(+ [data-prosemirror-node-name="table"] .pm-table-with-controls tr.sticky) &':{top:r("1zav4").tableControlsSpacing},'[data-prosemirror-mark-name="breakout"]:has([data-blocks-drag-handle-container]):has(+ [data-prosemirror-node-name="table"] .pm-table-with-controls tr.sticky) &':{top:r("1zav4").tableControlsSpacing}}),e2={name:"ut0e3u",styles:"&::selection{background-color:transparent;}"},e5={name:"jbgpyq",styles:"transform:rotate(90deg)"},e4={name:"19uky9m",styles:"background-color:var(--ds-background-selected, #E9F2FF);color:var(--ds-icon-selected, #0C66E4)"},e9=e=>{if(!((0,c.expValEquals)("platform_editor_hydratable_ui","isEnabled",!0)?(0,r("d7ZU3").getBrowserInfo)():r("d7ZU3").browser).chrome)return;e.stopPropagation();let t=new DragEvent("dragstart",{bubbles:!0,cancelable:!0,dataTransfer:e.dataTransfer});e.target instanceof HTMLElement&&e.target.closest("button")?.dispatchEvent(t)},e3=e=>{if(!e)return J.default;let t=e.type.name;return"heading"===t?J[`heading${e.attrs.level}`]||J.default:J[t]||J.default},e8=e=>{if(!e)return Q.default;let t=e.type.name;return"heading"===t?Q[`heading${e.attrs.level}`]||Q.default:Q[t]||Q.default},e6=e=>{if(e.endIndex-e.startIndex<=1)return!1;let t=0;for(let o=e.startIndex;o<e.endIndex;o++)if(e.parent.child(o).isBlock&&t++,t>1)return!0;return!1},e7=(e,t)=>t.start<=e&&t.end>=e+1,te=({selection:e,doc:t,resolvedStartPos:o,isShiftPressed:n})=>{let a=o.pos<e.from,i=n&&a?o:e.$from,s=n&&!a?t.resolve(o.pos+1):e.$to;return(0,r("l6okE").expandToBlockRange)(i,s)},tt=({view:e,api:o,formatMessage:n,getPos:l,anchorName:p,nodeType:u,handleOptions:f,isTopLevelNode:g=!0,anchorRectCache:h})=>{let b,y=(0,R.useRef)(null),[_,S]=(0,R.useState)(!1),[E,v]=(0,R.useState)(!1),[C,x]=(0,R.useState)(768),[A,k]=(0,R.useState)(!1),[I,P]=(0,R.useState)({display:"none"}),[N,w]=(0,R.useState)(!!f?.isFocused),{macroInteractionUpdates:D}=(0,r("eiA8Z").useSharedPluginStateWithSelector)(o,["featureFlags"],e=>({macroInteractionUpdates:e.featureFlagsState?.macroInteractionUpdates})),O=(0,r("b3YrF").useSharedPluginStateSelector)(o,"selection.selection"),M=(0,r("b3YrF").useSharedPluginStateSelector)(o,"blockControls.isShiftDown"),V=(0,r("b3YrF").useSharedPluginStateSelector)(o,"interaction.interactionState"),F=l(),G="layoutColumn"===u,q=(0,i.editorExperiment)("platform_editor_element_drag_and_drop_multiselect",!0);(0,R.useEffect)(()=>{if(!(0,i.editorExperiment)("platform_editor_block_control_optimise_render",!0)&&"blockCard"===u){let t=e.dom.querySelector(`[${m()}="${p}"]`),o=t?.querySelector(".datasourceView-content-inner-wrap");if(o){let e=new ResizeObserver(e=>{x(e[0].contentBoxSize[0].inlineSize)});return e.observe(o),()=>e.unobserve(o)}}},[p,u,e.dom]);let H=(0,R.useCallback)(t=>{o?.core?.actions.execute(({tr:n})=>{let a=l();if(void 0===a)return n;let s=n.doc.resolve(a),d=B.getState(e.state)?.preservedSelection||n.selection;o?.analytics?.actions.attachAnalyticsEvent({eventType:r("d925B").EVENT_TYPE.UI,action:r("d925B").ACTION.CLICKED,actionSubject:r("d925B").ACTION_SUBJECT.BUTTON,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.ELEMENT_DRAG_HANDLE,attributes:{nodeDepth:s.depth,nodeType:s.nodeAfter?.type.name||""}})(n);let c=te({doc:n.doc,selection:d,resolvedStartPos:s,isShiftPressed:t.shiftKey});if(c.range&&e7(a,c.range)&&e6(c.range)){let e=ey(c.$from,c.$to);n.setSelection(r("ks2lK").TextSelection.create(n.doc,Math.min(d.from,e.$from.pos),Math.max(d.to,e.$to.pos)))}else n=em(n,a,u,o);return o?.blockControls?.commands.startPreservingSelection()({tr:n}),o?.blockControls?.commands.toggleBlockMenu({anchorName:p,openedViaKeyboard:!1,triggerByNode:(0,i.editorExperiment)("platform_synced_block",!0)?{nodeType:u,pos:a,rootPos:n.doc.resolve(a).before(1)}:void 0})({tr:n}),n.setMeta("scrollIntoView",!1),n}),e.focus()},[o,e,l,u,p]),j=(0,R.useCallback)(t=>{q||S(!_),o?.core?.actions.execute(({tr:e})=>{let n=l();if(void 0===n)return e;let a=o?.blockControls.sharedState.currentState()?.multiSelectDnD,i=a?.anchor!==void 0?e.doc.resolve(a?.anchor):e.selection.$anchor;if(q&&!e.selection.empty&&t.shiftKey){if(g&&i.depth<=3&&t.shiftKey&&(0,r("dh538").fg)("platform_editor_elements_dnd_shift_click_select")){let t=eE(ev(e.selection,n),n);e.setSelection(t),o?.blockControls?.commands.setMultiSelectPositions()({tr:e})}}else e=em(e,n,u,o);let s=e.doc.resolve(n),d=s.nodeAfter;return e.setMeta("scrollIntoView",!1),o?.analytics?.actions.attachAnalyticsEvent({eventType:r("d925B").EVENT_TYPE.UI,action:r("d925B").ACTION.CLICKED,actionSubject:r("d925B").ACTION_SUBJECT.BUTTON,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.ELEMENT_DRAG_HANDLE,attributes:{nodeDepth:s.depth,nodeType:d?.type.name||""}})(e),e}),e.focus()},[q,o,e,_,l,g,u]),$=(0,R.useCallback)(t=>{if(t.repeat||" "!==t.key)[t.altKey,t.ctrlKey,t.shiftKey].some(e=>e)||e.focus();else{let e=l();o?.core?.actions.execute(({tr:t})=>{if(void 0===e)return t;let o=t.doc.nodeAt(e);if(!o)return t;let n=t.doc.resolve(e+o.nodeSize),a=new(0,r("ks2lK").TextSelection)(n);return t.setSelection(a),q||t.setMeta(nn,{pos:e}),t})}},[l,o?.core?.actions,q,e]),z=(0,R.useCallback)(t=>{if("Enter"!==t.key&&(t.repeat||" "!==t.key))[t.altKey,t.ctrlKey,t.shiftKey].some(e=>e)||e.focus();else{if((0,r("hTKp4").getDocument)()?.activeElement!==y.current)return;t.preventDefault(),t.stopPropagation();let e=l();o?.core?.actions.execute(({tr:t})=>{if(void 0===e)return t;t=em(t,e,u,o),q||t.setMeta(nn,{pos:e});let n=(0,i.editorExperiment)("platform_synced_block",!0)?t.doc.resolve(e).before(1):void 0,r=(0,a.expValEqualsNoExposure)("platform_synced_block","isEnabled",!0)?{nodeType:u,pos:e,rootPos:n}:void 0;return o?.blockControls?.commands.toggleBlockMenu({anchorName:p,triggerByNode:r,openedViaKeyboard:!0})({tr:t}),o?.userIntent?.commands.setCurrentUserIntent("blockMenuOpen")({tr:t}),t})}},[l,o,u,q,p,e]);(0,R.useEffect)(()=>{let t=y.current;if(t)return(0,d.draggable)({element:t,getInitialData:()=>({type:"element",start:F}),onGenerateDragPreview:({nativeSetDragImage:t})=>{q&&o?.core?.actions.execute(({tr:t})=>{let n=l();if("number"!=typeof n)return t;let a=eg(e.state,t.selection,n);return!t.selection.empty&&a?o?.blockControls?.commands.setMultiSelectPositions()({tr:t}):t=em(t,n,u,o),t});let n=l(),{doc:a,selection:r}=e.state,i=r.from,d=r.to,c=o?.blockControls.sharedState.currentState()?.multiSelectDnD;if(c){let{anchor:e,head:t}=c;i=Math.min(e,t),d=Math.max(e,t)}let f=a.slice(i,d),g=q&&void 0!==n&&n>=i&&n<d&&f.content.childCount>1;(0,L.setCustomNativeDragPreview)({getOffset:()=>{if(!g)return{x:0,y:0};{let t=e.domAtPos.bind(e),o=0,a=[],r=[],l=0;for(let e=0;e<f.content.childCount;e++)if(0===e?(a[e]=i,r[e]=i+(f.content.maybeChild(e)?.nodeSize||0)):(a[e]=r[e-1],r[e]=a[e]+(f.content.maybeChild(e)?.nodeSize||0)),r[e]<=n){let n=(0,s.findDomRefAtPos)(a[e],t),r=f.content.maybeChild(e),i=r?e8(r).top+e8(r).bottom:0;o=o+n.offsetHeight+i}else{let t=f.content.maybeChild(e);l=t?e8(t).top:0;break}return{x:0,y:o+l}}},render:({container:t})=>{let o=e.dom.querySelector(`[${m()}="${p}"]`);if(o)if(!g)return ew(t,{dom:o,nodeType:u});else{let o=e.domAtPos.bind(e),n=[];return f.content.descendants((e,t)=>{let a=(0,s.findDomRefAtPos)(i+t,o),r=e3(e);return n.push({dom:a,nodeType:e.type.name,nodeSpacing:r}),!1}),ew(t,n)}},nativeSetDragImage:t})},onDragStart(){void 0!==F&&(o?.core?.actions.execute(({tr:e})=>{let t,n,a=e.doc.resolve(F),i=a.nodeAfter,s=o?.blockControls.sharedState.currentState()?.multiSelectDnD;if(s){let o=U(e,s.anchor,s.head);t=o.nodeTypes,n=o.hasSelectedMultipleNodes}else t=i?.type.name,n=!1;return o?.blockControls?.commands.setNodeDragged(l,p,u)({tr:e}),e.setMeta("scrollIntoView",!1),o?.analytics?.actions.attachAnalyticsEvent({eventType:r("d925B").EVENT_TYPE.UI,action:r("d925B").ACTION.DRAGGED,actionSubject:r("d925B").ACTION_SUBJECT.ELEMENT,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.ELEMENT_DRAG_HANDLE,attributes:{nodeDepth:a.depth,nodeType:i?.type.name||"",...q&&{nodeTypes:t,hasSelectedMultipleNodes:n}}})(e),e}),e.focus())}})},[p,o,l,q,u,F,e]);let W=(0,R.useMemo)(()=>{if(!(0,i.editorExperiment)("platform_editor_block_control_optimise_render",!0))return{};A&&k(A);let t=l(),o=(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)?"number"==typeof t&&e.state.doc.resolve(t):t&&e.state.doc.resolve(t),n=o&&o.depth?o.before():void 0,a=void 0!==n?e.state.doc.nodeAt(n):void 0,s=a?.type.name,d=CSS.supports("top",`anchor(${p} start)`)&&CSS.supports("left",`anchor(${p} start)`),f=(0,i.editorExperiment)("platform_editor_controls","variant1")?eD({getPos:l,view:e,anchorName:p}):p,b=e.dom.querySelector(`[${m()}="${f}"]`),y="table"===u||"mediaSingle"===u,_="extension"===u||"bodiedExtension"===u||"multiBodiedExtension"===u,S="blockCard"===u,E="embedCard"===u,v=D&&_,C=null;b&&(E?C=b.querySelector(".rich-media-item"):y?C=b.querySelector(".resizer-item"):_?C=b.querySelector(".extension-container[data-layout]"):S&&(C=b.querySelector(".datasourceView-content-inner-wrap")));let x=(y||_||E||S)&&C,I=ea(u);if(d){let e=(0,i.editorExperiment)("platform_editor_controls","variant1")?er(f,I,g,G):{};return{left:x?`calc(anchor(${f} start) + ${eo(b,u,C,v,s)})`:(0,i.editorExperiment)("advanced_layouts",!0)&&G?`calc((anchor(${f} right) + anchor(${f} left))/2 - 12px)`:`calc(anchor(${f} start) - ${r("Yqd3z").DRAG_HANDLE_WIDTH}px - ${K(u,s)}px)`,top:(0,i.editorExperiment)("advanced_layouts",!0)&&G?`calc(anchor(${f} top) - ${r("Yqd3z").DRAG_HANDLE_WIDTH}px)`:`calc(anchor(${f} start)+ ${Y((0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)&&o&&o.nodeAfter&&T(o.nodeAfter)||u)}px)`,...e}}let P=(0,i.editorExperiment)("platform_editor_controls","variant1")?ei(en(b,f,h)||0,I,g,"24",G):{};return{left:x?`calc(${b?.offsetLeft||0}px + ${eo(b,u,C,v,s)})`:eo(b,u,C,v,s),top:et(b,u),...P}},[p,l,e,u,D,h,g,G,A]),X=(0,R.useCallback)(()=>{let t=l(),o=(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)?"number"==typeof t&&e.state.doc.resolve(t):t&&e.state.doc.resolve(t),n=o&&o.depth?o.before():void 0,a=void 0!==n?e.state.doc.nodeAt(n):void 0,s=a?.type.name,d=CSS.supports("top",`anchor(${p} start)`)&&CSS.supports("left",`anchor(${p} start)`),f=(0,i.editorExperiment)("platform_editor_controls","variant1")?eD({getPos:l,view:e,anchorName:p}):p,b=e.dom.querySelector(`[${m()}="${f}"]`),y="table"===u||"mediaSingle"===u,_="extension"===u||"bodiedExtension"===u||"multiBodiedExtension"===u,S="blockCard"===u&&!!C,E="embedCard"===u,v=D&&_,x=null;b&&(E?x=b.querySelector(".rich-media-item"):y?x=b.querySelector(".resizer-item"):_?x=b.querySelector(".extension-container[data-layout]"):S&&(x=b.querySelector(".datasourceView-content-inner-wrap")));let A=(y||_||E||S)&&x,k=ea(u);if(d){let e=(0,i.editorExperiment)("platform_editor_controls","variant1")?er(f,k,g,G):{};return{left:A?`calc(anchor(${f} start) + ${eo(b,u,x,v,s)})`:(0,i.editorExperiment)("advanced_layouts",!0)&&G?`calc((anchor(${f} right) + anchor(${f} left))/2 - 12px)`:`calc(anchor(${f} start) - ${r("Yqd3z").DRAG_HANDLE_WIDTH}px - ${K(u,s)}px)`,top:(0,i.editorExperiment)("advanced_layouts",!0)&&G?`calc(anchor(${f} top) - ${r("Yqd3z").DRAG_HANDLE_WIDTH}px)`:`calc(anchor(${f} start) + ${Y((0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)&&o&&o.nodeAfter&&T(o.nodeAfter)||u)}px)`,...e}}let I=(0,i.editorExperiment)("platform_editor_controls","variant1")?ei(en(b,f,h)||0,k,g,"24",G):{};return{left:A?`calc(${b?.offsetLeft||0}px + ${eo(b,u,x,v,s)})`:eo(b,u,x,v,s),top:et(b,u),...I}},[p,l,e,u,C,D,h,g,G]);(0,R.useEffect)(()=>{let t;if((0,i.editorExperiment)("platform_editor_block_control_optimise_render",!0))return;if("extension"===u||"embedCard"===u){let o=e.dom.querySelector(`[${m()}="${p}"]`);if(!o)return;t=(0,r("fFa3V").bind)(o,{type:"transitionend",listener:()=>{P(X())}})}let o=requestAnimationFrame(()=>{P(X())});return()=>{cancelAnimationFrame(o),t?.()}},[X,e.dom,p,u]),(0,R.useEffect)(()=>{let t;if((0,i.editorExperiment)("platform_editor_block_control_optimise_render",!0)){if("extension"===u||"embedCard"===u){let o=e.dom.querySelector(`[${m()}="${p}"]`);if(!o)return;t=(0,r("fFa3V").bind)(o,{type:"transitionend",listener:()=>{k(!A)}})}return()=>{t?.()}}},[e,p,u,A]),(0,R.useEffect)(()=>{if(f?.isFocused&&y.current){let t=requestAnimationFrame(()=>{y.current?.focus()});return()=>{cancelAnimationFrame(t),(0,i.editorExperiment)("platform_editor_block_control_optimise_render",!0)||e.focus()}}},[y,f?.isFocused,e]),(0,R.useEffect)(()=>{q&&"number"==typeof F&&O&&S(eg(e.state,O,F))},[F,O,e,q]),(0,R.useEffect)(()=>{if(!q||void 0===M||e.state.selection.empty||!(0,r("dh538").fg)("platform_editor_elements_dnd_shift_click_select"))return;let t=o?.blockControls.sharedState.currentState()?.multiSelectDnD,n=t?.anchor!==void 0?e.state.doc.resolve(t?.anchor):e.state.selection.$anchor;M&&(!g||g&&n.depth>3)?v(!0):v(!1)},[o?.blockControls.sharedState,q,M,g,e]);let J=(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)?n(r("dwl7L").messages.dragToMoveClickToOpen,{br:(0,r("9K4OG").jsx)("br",null)}):n(r("dwl7L").messages.dragToMove),Q=(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)?n(r("dwl7L").messages.dragToMoveClickToOpen,{br:" "}):n(r("dwl7L").messages.dragToMove),Z=g?[{description:J},{description:n(r("dwl7L").messages.moveUp),keymap:r("hgeg8").dragToMoveUp},{description:n(r("dwl7L").messages.moveDown),keymap:r("hgeg8").dragToMoveDown},{description:n(r("dwl7L").messages.moveLeft),keymap:r("hgeg8").dragToMoveLeft},{description:n(r("dwl7L").messages.moveRight),keymap:r("hgeg8").dragToMoveRight}]:[{description:J},{description:n(r("dwl7L").messages.moveUp),keymap:r("hgeg8").dragToMoveUp},{description:n(r("dwl7L").messages.moveDown),keymap:r("hgeg8").dragToMoveDown}];if(!g){let t=l();if("number"==typeof t){let o=e.state.doc.resolve(t);b=o?.parent?.type.name==="layoutColumn"}b&&(Z=[...Z,{description:n(r("dwl7L").messages.moveLeft),keymap:r("hgeg8").dragToMoveLeft},{description:n(r("dwl7L").messages.moveRight),keymap:r("hgeg8").dragToMoveRight}])}(0,i.editorExperiment)("advanced_layouts",!0)&&"layoutColumn"===u&&(Z=[{description:n(r("dwl7L").messages.dragToRearrange)},{description:n(r("dwl7L").messages.moveUp),keymap:r("hgeg8").dragToMoveUp},{description:n(r("dwl7L").messages.moveDown),keymap:r("hgeg8").dragToMoveDown},{description:n(r("dwl7L").messages.moveLeft),keymap:r("hgeg8").dragToMoveLeft},{description:n(r("dwl7L").messages.moveRight),keymap:r("hgeg8").dragToMoveRight}]),(0,i.editorExperiment)("platform_editor_controls","variant1")&&(Z=[{description:J}]);let ee=Z.map(e=>e.keymap?[e.description,(0,r("hgeg8").getAriaKeyshortcuts)(e.keymap)]:[e.description]).join(". "),el=e=>{(0,i.editorExperiment)("platform_editor_element_drag_and_drop_multiselect",!0)&&e.stopPropagation()},ed="hasNotHadInteraction"!==V,ec=(0,c.expValEquals)("platform_editor_hydratable_ui","isEnabled",!0)?(0,r("d7ZU3").getBrowserInfo)():r("d7ZU3").browser,ep=()=>(0,r("9K4OG").jsx)("button",{type:"button",css:[(0,i.editorExperiment)("platform_editor_controls","variant1")?ej:ez,(0,i.editorExperiment)("platform_editor_controls","variant1")&&eH,ec.gecko&&e2,(0,i.editorExperiment)("advanced_layouts",!0)&&G&&e5,_&&ed&&e4,(0,i.editorExperiment)("platform_editor_preview_panel_responsiveness",!0)&&(0,i.editorExperiment)("platform_editor_controls","control")&&eK,(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)&&N&&eX,(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)?eY:eW,((0,c.expValEquals)("confluence_compact_text_format","isEnabled",!0)||(0,c.expValEquals)("cc_editor_ai_content_mode","variant","test")&&(0,r("dh538").fg)("platform_editor_content_mode_button_mvp"))&&e$],ref:y,style:(0,i.editorExperiment)("platform_editor_controls","variant1")?{}:(0,i.editorExperiment)("platform_editor_block_control_optimise_render",!0)?W:I,onClick:(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)?H:j,onKeyDown:(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)?z:$,onDrop:el,disabled:E,"data-editor-block-ctrl-drag-handle":!0,"data-testid":"block-ctrl-drag-handle","aria-label":(0,c.expValEquals)("platform_editor_drag_handle_aria_label","isEnabled",!0)?Q:"",onBlur:(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)?()=>w(!1):void 0},(0,r("9K4OG").jsx)(r("6f0Oj").default,{xcss:eU,onDragStart:e9},(0,r("9K4OG").jsx)(t(r("8aNCk")),{spacing:"spacious",label:"",size:"small"}))),eu=!E,ef=eu?(0,r("9K4OG").jsx)(r("6f0Oj").default,{style:(0,i.editorExperiment)("platform_editor_block_control_optimise_render",!0)?W:I,xcss:[eJ],as:"span",testId:"block-ctrl-drag-handle-container"},(0,r("9K4OG").jsx)("span",{css:[eQ,es(u,g)&&((0,c.expValEquals)("platform_editor_table_sticky_header_improvements","cohort","test_with_overflow")&&(0,r("dh538").fg)("platform_editor_table_sticky_header_patch_6")?e0:eZ),!es(u,g)&&e1]},(0,r("9K4OG").jsx)(r("3gadb").default,{content:(0,r("9K4OG").jsx)(r("hgeg8").TooltipContentWithMultipleShortcuts,{helpDescriptors:Z}),ignoreTooltipPointerEvents:!0,position:"top",onShow:()=>{o?.accessibilityUtils?.actions.ariaNotify(ee,{priority:"important"})}},(0,r("9K4OG").jsx)("span",{css:[es(u,g)&&eG,eq]},ep())))):(0,r("9K4OG").jsx)(r("6f0Oj").default,{style:(0,i.editorExperiment)("platform_editor_block_control_optimise_render",!0)?W:I,xcss:[eJ],as:"span",testId:"block-ctrl-drag-handle-container"},(0,r("9K4OG").jsx)("span",{css:[eQ,es(u,g)&&eZ,!es(u,g)&&e1]},(0,r("9K4OG").jsx)("span",{css:[es(u,g)&&eG,eq]},ep()))),eh=eu?(0,r("9K4OG").jsx)(r("3gadb").default,{content:(0,r("9K4OG").jsx)(r("hgeg8").TooltipContentWithMultipleShortcuts,{helpDescriptors:Z}),ignoreTooltipPointerEvents:!0,onShow:()=>{o?.accessibilityUtils?.actions.ariaNotify(ee,{priority:"important"})}},ep()):ep();return(0,i.editorExperiment)("platform_editor_controls","variant1")?ef:eh},to=({view:e,api:t,formatMessage:o,getPos:n,anchorName:a,nodeType:i,handleOptions:s,anchorRectCache:l})=>(0,r("9K4OG").jsx)(eF,{api:t},(0,r("9K4OG").jsx)(tt,{view:e,api:t,formatMessage:o,getPos:n,anchorName:a,nodeType:i,handleOptions:s,anchorRectCache:l})),tn=(e,t)=>{let{alignment:o}=e.schema.marks,n=e.doc.resolve(t),a=n.marks().filter(e=>e.type===o);if(a.length>0&&(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)&&(0,r("dh538").fg)("platform_editor_native_anchor_patch_1")){let e=n.nodeAfter?.marks.filter(e=>e.type===o)||[],t=a.length===e.length&&a.some(t=>e.some(e=>e.eq(t)));if(0===e.length||!t)return[]}return a},ta=()=>{let e="--node-anchor-paragraph-0",t=`anchor-name: ${e}; margin-top: 0px;`;return r("ftzrq").Decoration.node(0,2,{style:t,"data-drag-handler-anchor-name":e},{type:E})},tr=(e,t,o)=>e.find(t,o,e=>e.type===S),ti=(e,t=-1)=>{let o=e.doc.type.schema.marks.alignment,n=e.doc.type.schema.marks.indentation;if(!o&&!n)return t;if(e.nodeBefore&&e.nodeAfter){let a=e.nodeBefore?.marks.filter(e=>e.type===o||e.type===n)||[],r=e.nodeAfter?.marks.filter(e=>e.type===o||e.type===n)||[];if(0===a.length)return t;if(0===r.length||a.some(e=>!r.some(t=>t.eq(e))))return 0}return t},ts=({api:e,formatMessage:o,pos:n,anchorName:a,nodeType:s,nodeViewPortalProviderAPI:l,handleOptions:d,anchorRectCache:p,editorState:u})=>{let m;(0,i.editorExperiment)("platform_editor_block_control_optimise_render",!0,{exposure:!0})||x(l,"data-blocks-drag-handle-container","data-blocks-drag-handle-key");let f=t(y)(),g=u.doc.resolve(n),h=(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)&&(0,r("dh538").fg)("platform_editor_native_anchor_patch_1")?ti(g):-1,_=(0,i.editorExperiment)("platform_editor_breakout_resizing",!0)?{side:h,type:S,testid:`${S}-${t(y)()}`,marks:tn(u,n),destroy:e=>{m&&m(),(0,i.editorExperiment)("platform_editor_block_control_optimise_render",!0)&&e instanceof HTMLElement&&t(b).unmountComponentAtNode(e)}}:{side:h,type:S,testid:`${S}-${t(y)()}`,destroy:e=>{m&&m(),(0,i.editorExperiment)("platform_editor_block_control_optimise_render",!0)&&e instanceof HTMLElement&&t(b).unmountComponentAtNode(e)}};return r("ftzrq").Decoration.widget(n,(n,l)=>{let c=document.createElement("span");c.style.display="block",c.setAttribute("data-testid","block-ctrl-decorator-widget"),c.setAttribute("data-blocks-drag-handle-container","true"),c.setAttribute("data-blocks-drag-handle-key",f);let u=!0,g=()=>{try{return l()}catch(e){return}},h=g();if("number"==typeof h){let e=n.state.doc.resolve(h);u=e?.parent.type.name==="doc"}return void 0!==h&&u||((0,r("dh538").fg)("platform_editor_fix_widget_destroy")?c.onmouseover=e=>{e.stopPropagation()}:m=(0,r("fFa3V").bind)(c,{type:"mouseover",listener:e=>{e.stopPropagation()}})),c.style.clear="unset",(0,i.editorExperiment)("platform_editor_controls","variant1")?t(b).render((0,R.createElement)(to,{view:n,api:e,formatMessage:o,getPos:g,anchorName:a,nodeType:s,handleOptions:d,isTopLevelNode:u,anchorRectCache:p}),c):t(b).render((0,R.createElement)(tt,{view:n,api:e,formatMessage:o,getPos:g,anchorName:a,nodeType:s,handleOptions:d,isTopLevelNode:u,anchorRectCache:p}),c),c},_)};var tl=r("5rDjV");let td=new class{getActiveAnchor(){return this.lastActiveAnchor}subscribe(e,t){this.emitter&&this.emitter.on(e,t)}unsubscribe(e,t){this.emitter&&this.emitter.removeListener(e,t)}emit(e){this.lastActiveAnchor!==e&&this.emitter&&(this.emitter.emit(this.lastActiveAnchor,!1),this.emitter.emit(e,!0),this.lastActiveAnchor=e)}reset(){this.emitter&&(this.emitter.removeAllListeners(),this.emitter=null,this.emitter=new(0,tl.EventEmitter))}constructor(){this.emitter=void 0,this.lastActiveAnchor="",this.emitter=new(0,tl.EventEmitter)}},tc=(e,t=td)=>{let[o,n]=(0,R.useState)(!1),a=e=>{n(e)};return(0,R.useEffect)(()=>{if(t&&e&&(0,i.editorExperiment)("advanced_layouts",!0))return t.subscribe(e,a),t.getActiveAnchor()===e&&n(!0),()=>{t.unsubscribe(e,a)}},[t,e]),[o,(0,R.useCallback)(()=>{t.emit(e)},[t,e])]},tp=(0,r("2XqLN").default)(()=>!!window.CSS&&!!window.CSS.supports&&window.CSS.supports("anchor-name: --a"));class tu{clear(){this.isDirty=!0,this.anchorRectMap={}}getRects(){if(this.isDirty){let e=this.view?.dom.querySelectorAll(`[${m()}]`)||[];this.anchorRectMap=Array.from(e).reduce((e,t)=>{let o=t.getAttribute(m());return o?{...e,[o]:{height:t.clientHeight,top:t.offsetTop,left:t.offsetLeft,right:t.offsetLeft+t.clientWidth,width:t.clientWidth,bottom:t.offsetTop+t.clientHeight}}:e},{}),this.isDirty=!1}return this.anchorRectMap}setEditorView(e){this.view!==e&&(this.view=e)}getHeight(e){if(this.isAnchorSupported)return null;let t=this.getRects();return t[e]?.height}getWidth(e){if(this.isAnchorSupported)return null;let t=this.getRects();return t[e]?.width}getLeft(e){if(this.isAnchorSupported)return null;let t=this.getRects();return t[e]?.left}getTop(e){if(this.isAnchorSupported)return null;let t=this.getRects();return t[e]?.top}getRight(e){if(this.isAnchorSupported)return null;let t=this.getRects();return t[e]?.right}getRect(e){return this.isAnchorSupported?null:this.getRects()[e]}constructor(){this.anchorRectMap={},this.isAnchorSupported=tp(),this.isDirty=!0,this.view=null}}let tm=e=>!!("mediaSingle"===e?.type.name&&["wrap-right","wrap-left"].includes(e.attrs.layout)),tf=()=>(0,i.editorExperiment)("advanced_layouts",!0)?5:3,tg=["syncBlock","bodiedSyncBlock"],th=(e,t,o=!1,n)=>!((0,i.editorExperiment)("advanced_layouts",!1)||e||tm(t)||n?.nodeType==="layoutSection"||(tg.includes(n?.nodeType||"")||tg.includes(t?.type.name||""))&&(0,i.editorExperiment)("platform_synced_block",!0))&&(t?.type.name==="layoutSection"?t.childCount<tf()||o:!(0,r("l9G9n").isEmptyParagraph)(t)),tb=e=>e.steps.find(e=>e instanceof r("aXG5V").ReplaceStep&&["layoutSection","layoutColumn"].includes(e.slice.content.firstChild?.type.name||"")),ty=(e,t,o)=>{let n=e.doc.resolve(t).nodeAfter,a=n?.content.lastChild;if(!n||!a)return e;let i=n.nodeSize;return"layoutSection"===n.type.name&&(o?(a=n.content.lastChild?.lastChild,i=n.nodeSize-1):(a=n.content.firstChild?.lastChild,i=1+(n.content.firstChild?.nodeSize||0))),["paragraph","heading"].includes(a?.type.name||"")?e.setSelection(r("ks2lK").TextSelection.near(e.doc.resolve(t+i-2))):a&&e.setSelection(new(0,r("adhil").GapCursorSelection)(e.doc.resolve(t+i-1),r("adhil").Side.RIGHT)),e},t_="--editor-blocks-inline-hover-zone-width",tS="--editor-blocks-inline-hover-zone-height",tE="--editor-blocks-inline-hover-zone-top",tv="--editor-blocks-inline-hover-zone-bottom",tT="--editor-blocks-inline-hover-zone-anchor-name",tC=(0,r("9K4OG").css)({position:"absolute",zIndex:120,positionAnchor:`var(${tT})`,minWidth:"var(--ds-space-100, 8px)",left:0,right:0,width:`var(${t_})`,height:`var(${tS})`}),tx=(0,r("9K4OG").css)({right:"unset",top:`var(${tE})`,bottom:"unset"}),tA=(0,r("9K4OG").css)({left:"unset",top:"unset",bottom:`var(${tv})`}),tk=(0,r("9K4OG").css)({height:"100%",position:"absolute",borderRight:`var(--ds-border-width, 1px) dashed var(--ds-border-focused, ${r("6fnsQ").B200})`,width:0,left:0}),tI={name:"go864d",styles:"left:unset;right:0"},tP={width:"0",height:"0",top:"unset",bottom:"unset"},tN=(e,t,o)=>{if(["mediaSingle","table","embedCard"].includes(e.type.name)||"blockCard"===e.type.name&&!e.attrs.datasource){let n="left"===o;if("align-start"===e.attrs.layout||"blockCard"===e.type.name)return n?`-0.5*(var(--ak-editor--line-length) - ${t})`:`0.5*(var(--ak-editor--line-length) - ${t})`;if(e?.attrs.layout==="align-end")return n?`0.5*(var(--ak-editor--line-length) - ${t})`:`-0.5*(var(--ak-editor--line-length) - ${t})`}if("bodiedExtension"===e.type.name||"extension"===e.type.name)return"-12px"},tw=({api:e,nextNode:t,position:o,anchorRectCache:n,getPos:a})=>{let i=(0,R.useRef)(null),[s,l]=(0,R.useState)(!1),p=(0,R.useMemo)(()=>(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)?t&&e?.core.actions.getAnchorIdForNode(t,a()??-1)||"":t?v(t):"",[e,a,t]),[u]=tc(p),m="left"===o,f=(0,R.useMemo)(()=>{if(!t)return tP;let i=a(),s=null,l=p;if(["blockCard","embedCard","extension"].includes(t.type.name)){if("wide"===t.attrs.layout?s="max(var(--ak-editor--legacy-breakout-wide-layout-width), var(--ak-editor--line-length))":"full-width"===t.attrs.layout&&(s=`min(calc(100cqw - ${r("aFUXX").akEditorBreakoutPadding}px), 1800px)`),"blockCard"===t.type.name&&!t.attrs.layout&&t.attrs.datasource&&(s="var(--ak-editor-block-card-width)"),"embedCard"===t.type.name&&["center","align-start","align-end"].includes(t.attrs.layout)){let e=((parseFloat(t.attrs.width)||100)/100).toFixed(2);s=`calc(var(--ak-editor--line-length) * ${e})`}}else if("table"===t.type.name&&t.firstChild){let o=(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)?"number"==typeof i&&e?.core.actions.getAnchorIdForNode(t.firstChild,i+1)||"":v(t.firstChild),a=!!t.attrs.isNumberColumnEnabled;s=tp()?a?`calc(anchor-size(${o} width) + 42px)`:`anchor-size(${o} width)`:`${(n?.getRect(o)?.width||0)+42}px`,t.attrs.width&&(s=`min(${t.attrs.width}px, ${s})`)}else"mediaSingle"===t.type.name&&t.firstChild&&((0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)?"number"==typeof i&&t.firstChild?.type.name==="media"&&(l=e?.core.actions.getAnchorIdForNode(t.firstChild,i+1)||""):l=v(t.firstChild));let d=l;if("layoutSection"===t.type.name&&t.firstChild&&t.lastChild)if(m)d=(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)?"number"==typeof i&&e?.core.actions.getAnchorIdForNode(t.firstChild,i+1)||"":v(t.firstChild);else if((0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0))if("number"==typeof i){let o=t.content.size-t.lastChild.nodeSize;d=e?.core.actions.getAnchorIdForNode(t.lastChild,o+1)||""}else d="";else d=v(t.lastChild);if(tp()){let e=s||`anchor-size(${l} width)`;return{width:e,height:`anchor-size(${d} height)`,top:"anchor(top)",bottom:"anchor(bottom)",widthOffset:tN(t,e,o)}}if(n){let e=n.getRect(l),a=s||`${e?.width||0}px`,r=e?.top?`${e?.top}px`:"unset",i=`100% - ${e?.bottom||0}px + 4px`,c=`${e?.height||0}px`;if(d!==l){let e=n.getRect(d);c=`${e?.height||0}px + 4px`}return{width:a,height:c,top:r,bottom:i,widthOffset:tN(t,a,o)}}return tP},[t,p,n,a,e,m,o]),g=(0,R.useCallback)(()=>{let t,{activeNode:n}=e?.blockControls?.sharedState.currentState()||{};if(!n)return;let r=a();if(n&&void 0!==r){let{pos:a}=n,i="right"===o;e?.core?.actions.execute(({tr:o})=>{e?.blockControls?.commands?.moveToLayout(a,r,{moveToEnd:i})({tr:o});let n=tb(o);return t=n?.from,o}),e?.core?.actions.execute(({tr:e})=>(void 0!==t&&ty(e,t,i),e))}},[e,a,o]),h=(0,R.useMemo)(()=>{let e=t?.type.name==="layoutSection"?{width:11,height:4,top:6,bottom:2}:void 0;return{[t_]:f.widthOffset?`calc((100% - ${f.width})/2 - 4px + ${f.widthOffset} - ${e?.width||0}px)`:`calc((100% - ${f.width})/2 - 4px - ${e?.width||0}px)`,[tS]:`calc(${f.height} + ${e?.height||0}px)`,[tE]:`calc(${f.top} + ${e?.top||0}px)`,[tv]:`calc(${f.bottom} - ${e?.bottom||0}px)`,[tT]:p}},[t?.type.name,f,p]),b=(0,R.useMemo)(()=>m?"right":"left",[m]);return(0,R.useEffect)(()=>{if(i.current)return(0,d.dropTargetForElements)({element:i.current,onDragEnter:()=>{l(!0)},onDragLeave:()=>{l(!1)},onDrop:g})},[g,l]),(0,r("9K4OG").jsx)("div",{ref:i,"data-testid":`drop-target-hover-zone-${o}`,css:[tC,m?tx:tA],style:h},s?(0,r("9K4OG").jsx)(r("2n8po").DropIndicator,{edge:b}):u&&(0,r("9K4OG").jsx)("div",{"data-testid":"block-ctrl-drop-hint",css:[tk,m&&tI]}))},tD="--editor-block-controls-drop-indicator-width",tO="--editor-block-controls-drop-target-leftMargin",tM="--editor-block-controls-drop-target-zindex",tR="--editor-block-controls-drop-indicator-offset",tL=(0,r("9K4OG").css)({marginLeft:`calc(-1 * var(${tO}, 0))`,paddingLeft:`var(${tO}, 0)`,position:"absolute",left:"0",display:"block",zIndex:`var(${tM}, 110)`,transform:`translateY(var(${tR}, 0))`}),tB=(0,r("9K4OG").css)({height:"100%",margin:"0 auto",position:"relative",width:`var(${tD}, 100%)`,display:"none"}),tV={name:"4zleql",styles:"display:block"},tF={name:"bjn8wh",styles:"position:relative"},tU={name:"y3ufic",styles:"margin:0;position:absolute;width:100%;z-index:110;min-height:4px"},tG={name:"1h4fcj3",styles:"left:4px;right:4px;width:unset"},tq=["paragraph","mediaSingle","heading","codeBlock","decisionList","bulletList","orderedList","taskList","extension","blockCard"],tH={name:"125wnaz",styles:"z-index:0"},tj=({onDragEnter:e,onDragLeave:t,onDrop:o,node:n,pos:a,parent:s,editorWidth:l,anchorRectCache:p,position:u,isNestedDropTarget:m,dropTargetStyle:f,api:g})=>{let h=(0,R.useRef)(null),b="remainingHeight"===f,y=(0,R.useMemo)(()=>{if((0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)){if(n&&"number"==typeof a){let e="upper"===u?-n.nodeSize:0;return g?.core.actions.getAnchorIdForNode(n,a+e)||""}return""}return n?v(n):""},[g,n,a,u]),[_,S]=tc(y);(0,R.useEffect)(()=>{if(h.current)return(0,d.dropTargetForElements)({element:h.current,onDragEnter:()=>{!m&&(0,i.editorExperiment)("advanced_layouts",!0)&&S(),e()},onDragLeave:t,onDrop:o})},[m,e,t,o,S]);let E=(0,R.useMemo)(()=>{let e="var(--editor-block-controls-drop-indicator-gap, 0)/2",t=`var(${tR}, 0)`,o=y&&tq.includes(n?.type.name||"")?tp()?`calc(anchor-size(${y} height)/2 + ${e})`:`calc(${(p?.getHeight(y)||0)/2}px + ${e})`:"4px",a="upper"===u?`translateY(calc(-100% + ${t}))`:`translateY(${t})`;return(0,r("9K4OG").css)({height:o,transform:a,maxWidth:`${l||0}px`})},[y,p,l,n?.type.name,u]),T=(0,R.useMemo)(()=>{if(b&&"upper"===u){let e=n?(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)?g?.core.actions.getAnchorIdForNode(n,a||-1)||"":v(n):"",t="unset";if(e){let o=tq.includes(n?.type.name||"");if(tp())t=o?`calc(anchor(${e} 50%))`:`calc(anchor(${e} bottom) - 4px)`;else{if(!p)return null;let n=p.getTop(e)||0,a=p.getHeight(e)||0;t=o?`calc(${n}px + ${a/2}px)`:`calc(${n}px + ${a}px - 4px)`}}else t="4px";return(0,r("9K4OG").css)({top:t,bottom:"4px",height:"unset",zIndex:10,transform:"none"})}return null},[p,g,b,n,a,u]),C=b&&s?.type.name==="layoutColumn";return(0,r("9K4OG").jsx)("div",{ref:h,className:`drop-target-hover-zone-${u}`,"data-testid":`drop-target-zone-${u}`,css:[tU,m&&tG,E,T,C&&tH]})},t$=e=>{let{api:t,getPos:o,prevNode:n,nextNode:a,parentNode:i,formatMessage:s,anchorRectCache:l,dropTargetStyle:d="default",isSameLayout:c}=e,[p,u]=(0,R.useState)(!1),{lineLength:m}=(0,r("eiA8Z").useSharedPluginStateWithSelector)(t,["width"],e=>({lineLength:e.widthState?.lineLength||760})),f=i?.type.name!=="doc",{activeNode:g}=t?.blockControls?.sharedState.currentState()||{},h=()=>{if(!g)return;let e=o();if(g&&void 0!==e){let{pos:o}=g;t?.core?.actions.execute(t?.blockControls?.commands?.moveNode(o,e,void 0,s))}},b={width:f?"unset":"100%",[tD]:f?"100%":`${m||760}px`,[tO]:f?W(i?.type.name):"0",[tM]:r("dTk3A").layers.navigation()};return(0,r("9K4OG").jsx)(R.Fragment,null,(0,r("9K4OG").jsx)(tj,{onDragEnter:()=>u(!0),onDragLeave:()=>u(!1),onDrop:h,node:n,pos:o(),editorWidth:m,anchorRectCache:l,position:"upper",isNestedDropTarget:f,dropTargetStyle:d,api:t}),(0,r("9K4OG").jsx)("div",{css:[tL,f&&tF],style:b,"data-testid":"block-ctrl-drop-target"},(0,r("9K4OG").jsx)("div",{css:[tB,p&&tV],"data-testid":"block-ctrl-drop-indicator"},(0,r("9K4OG").jsx)(r("2n8po").DropIndicator,{edge:"bottom"}))),"remainingHeight"!==d&&(0,r("9K4OG").jsx)(tj,{onDragEnter:()=>u(!0),onDragLeave:()=>u(!1),onDrop:h,node:a,pos:o(),parent:i,editorWidth:m,anchorRectCache:l,position:"lower",isNestedDropTarget:f,api:t}),th(f,a,c,g)&&(0,r("9K4OG").jsx)(R.Fragment,null,(0,r("9K4OG").jsx)(tw,{...e,position:"left"}),(0,r("9K4OG").jsx)(tw,{...e,position:"right"})))},tK=(0,r("9K4OG").css)({height:"100%",width:"40px",transform:"translateX(-50%)",zIndex:120,position:"relative",display:"flex",justifyContent:"center"}),tz=(0,r("9K4OG").css)({height:"100%",position:"relative",borderRight:`var(--ds-border-width, 1px) dashed var(--ds-border-focused, ${r("6fnsQ").B200})`,width:0}),tW=e=>{let{api:t,getPos:o,parent:n,anchorRectCache:a}=e,i=(0,R.useRef)(null),[s,l]=(0,R.useState)(!1),p=v(n),u=i.current?.parentElement?.nextElementSibling?.getAttribute(m()),f="100%";if(u){if(tp())f=`anchor-size(${u} height)`;else if(a){let e=a.getRect(u);f=`${e?.height||0}px`}}let g=(0,r("9K4OG").css)({[`@container layout-area (max-width:${r("aFUXX").layoutBreakpointWidth.MEDIUM-1}px)`]:{height:f,marginTop:"var(--ds-space-050, 4px)"}}),[h]=tc(p),{activeNode:b}=t?.blockControls?.sharedState.currentState()||{},y=(0,R.useCallback)(()=>{let e;if(!b)return;let n=o();if(void 0!==n){let{pos:o}=b;t?.core?.actions.execute(({tr:a})=>{t?.blockControls?.commands?.moveToLayout(o,n)({tr:a});let r=tb(a);return e=r?.from,a}),t?.core?.actions.execute(({tr:t})=>(void 0!==e&&ty(t,e),t))}},[t,o,b]);return((0,R.useEffect)(()=>{if(i.current)return(0,d.dropTargetForElements)({element:i.current,onDragEnter:()=>{l(!0)},onDragLeave:()=>{l(!1)},onDrop:y})},[y]),b?.nodeType==="layoutSection")?null:(0,r("9K4OG").jsx)("div",{ref:i,css:[tK,g],"data-testid":"block-ctrl-drop-indicator"},s?(0,r("9K4OG").jsx)(r("2n8po").DropIndicator,{edge:"right",gap:"-40px"}):(h||(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0))&&(0,r("9K4OG").jsx)("div",{"data-testid":"block-ctrl-drop-hint",css:tz}))},tY=e=>{let{api:t,getPos:o,parent:n,anchorRectCache:a}=e,i=(0,R.useRef)(null),[s,l]=(0,R.useState)(!1),p=v(n),[u,f]=(0,R.useState)(null),g=(0,R.useCallback)(()=>{let e=i.current?.parentElement?.nextElementSibling,t=m(),o=e?.getAttribute(t)??null;f(e=>e===o?e:o)},[]),h=(0,R.useMemo)(()=>{if(u){if(tp())return`anchor-size(${u} height)`;else if(a){let e=a.getRect(u);return`${e?.height||0}px`}}return"0px"},[u,a]);(0,R.useLayoutEffect)(()=>{let e=requestAnimationFrame(()=>{g()});return()=>cancelAnimationFrame(e)},[g]);let b=(0,r("9K4OG").css)({[`@container layout-area (max-width:${r("aFUXX").layoutBreakpointWidth.MEDIUM-1}px)`]:{height:h,marginTop:"var(--ds-space-050, 4px)"}}),[y]=tc(p),{activeNode:_}=t?.blockControls?.sharedState.currentState()||{},S=(0,R.useCallback)(()=>{let e;if(!_)return;let n=o();if(void 0!==n){let{pos:o}=_;t?.core?.actions.execute(({tr:a})=>{t?.blockControls?.commands?.moveToLayout(o,n)({tr:a});let r=tb(a);return e=r?.from,a}),t?.core?.actions.execute(({tr:t})=>(void 0!==e&&ty(t,e),t))}},[t,o,_]);return((0,R.useEffect)(()=>{if(i.current)return(0,d.dropTargetForElements)({element:i.current,onDragEnter:()=>{l(!0),g()},onDragLeave:()=>{l(!1)},onDrop:S})},[S,g]),_?.nodeType==="layoutSection")?null:(0,r("9K4OG").jsx)("div",{ref:i,css:[tK,b],"data-testid":"block-ctrl-drop-indicator"},s?(0,r("9K4OG").jsx)(r("2n8po").DropIndicator,{edge:"right",gap:"-40px"}):(y||(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0))&&(0,r("9K4OG").jsx)("div",{"data-testid":"block-ctrl-drop-hint",css:tz}))},tX=e=>{let{tableCell:t,tableHeader:o}=e.schema.nodes;return[t,o].indexOf(e)>=0},tJ=e=>e===e.schema.nodes.layoutColumn,tQ=e=>e===e.schema.nodes.doc,tZ=e=>e===e.schema.nodes.expand,t0=e=>e===e.schema.nodes.nestedExpand,t1=(e,t)=>{let o=e.nodeAfter,n=t.nodeAfter;return!!(o&&n&&"layoutColumn"===o.type.name&&["layoutSection","layoutColumn"].includes(n.type.name)&&(e.sameParent(t)||e.parent===n))},t2=e=>{let{expand:t,nestedExpand:o}=e.type.schema.nodes;return e.type===t?o.createChecked(e.attrs,e.content,e.marks):null},t5=e=>{let t=[];try{e.forEach(e=>{if(tZ(e.type)){let o=t2(e);o&&t.push(o)}else t.push(e)})}catch(e){return null}return r("5SAOw").Fragment.fromArray(t)},t4=e=>{let t=t5(e.content);return t?new(0,r("5SAOw").Slice)(t,e.openStart,e.openEnd):null},t9=(0,r("2XqLN").default)(e=>{try{return t2(e)}catch(e){return null}}),t3=(e,t)=>{try{return!!e.every(e=>e.createChecked({},t))}catch(e){return!1}};function t8(e,t,o,n,a){let l=o.type,d=l.schema,{table:c,tableCell:p,tableHeader:u,expand:m,nestedExpand:f,doc:g,panel:h,layoutColumn:b,layoutSection:y}=d.nodes,_=e?.type,S=o?.type,E=o.content,v=(0,r("sxTNo").isNestedTablesSupported)(d)&&(0,r("dh538").fg)("platform_editor_use_nested_table_pm_nodes")&&(0,i.editorExperiment)("nested-tables-in-tables",!0,{exposure:!0});if(S===b&&(0,i.editorExperiment)("advanced_layouts",!0)){if(a?.type===y||_===g)return!0;if(_===p||_===u){let e=(0,s.findChildrenByType)(o,m).length>0?t5(E):E;return!!e&&t3([p,u],e)}if(_===h)return t3([h],E);if(_===m)return t3([m],E);if(_===f)return t3([f],E)}if((_===p||_===u)&&S===c){let e=(0,r("sxTNo").getParentOfTypeCount)(c)(n);if(!v||v&&e>1)return!1}if(tX(e.type)&&tZ(l))if(!t9(o))return!1;else l=f;else(tQ(e.type)||tJ(e.type))&&t0(l)&&(l=m);return e.canReplaceWith(t,t,l)}function t6(e,t,o,n,a,r,i){let s=!0,l=r.doc,d=[];if(r.pos<o&&r.pos>=t||e.content.firstChild?.type.name==="layoutColumn")return!1;for(let o=0;o<e.content.childCount;o++){let c=e.content.maybeChild(o);if(0===o?d[o]=t:d[o]=d[o-1]+(e.content.maybeChild(o-1)?.nodeSize||0),c&&c.isInline){let e=l.resolve(d[o]).parent;if(!e||e&&!t8(n,a,e,r,i)){s=!1;break}}else if(c&&!t8(n,a,c,r,i)){s=!1;break}}return s}let t7=["tableCell","tableHeader","tableRow","layoutColumn","listItem","caption"],oe=["tableCell","tableHeader","panel","layoutColumn","expand","nestedExpand","bodiedExtension"],ot=["orderedList","bulletList"],oo=e=>!["mediaSingle","paragraph","heading"].includes(e.type.name),on=e=>{if(!e)return Q.default;let t=e.type.name;return"heading"===t?Q[`heading${e.attrs.level}`]||Q.default:Q[t]||Q.default},oa=(e,t)=>e?.type.name!=="mediaSingle"&&t?.type.name!=="mediaSingle"||e?.type.name===t?.type.name,or=(e,t,o)=>{if(!e&&t||e&&!t)return{gap:0,offset:0};let n=on(t).top||4,a=on(e).bottom||4,r=oa(e,t)?Math.max(n,a):n+a,i=n-r/2;return e?.type.name==="mediaSingle"&&t?.type.name==="mediaSingle"?i=-i:e?.type.name&&["tableCell","tableHeader"].includes(e?.type.name)&&(i=0),{gap:r,offset:i}},oi=(e,t,o)=>e.find(t,o,e=>e.type===_),os=(e,o,n,a,i,s)=>{let l=t(y)();return r("ftzrq").Decoration.widget(e,(e,t)=>{let a=()=>{try{return t()}catch(e){return}},r=document.createElement("div");r.setAttribute("data-blocks-drop-target-container","true"),r.setAttribute("data-blocks-drop-target-key",l),r.style.clear="unset";let{gap:d,offset:c}=or(o.prevNode,o.nextNode,o.parentNode);return r.style.setProperty(tR,`${c}px`),r.style.setProperty("--editor-block-controls-drop-indicator-gap",`${d}px`),r.style.setProperty("display","block"),n.render(()=>(0,R.createElement)(t$,{...o,getPos:a,anchorRectCache:i,isSameLayout:s}),r,l,void 0,!0),r},{type:_,side:a,destroy:()=>{n.remove(l)}})},ol=(e,o,n,a)=>{let i=t(y)();return r("ftzrq").Decoration.widget(e,(e,t)=>{let r=()=>{try{return t()}catch(e){return}},s=document.createElement("div");s.setAttribute("data-blocks-drop-target-container","true"),s.setAttribute("data-blocks-drop-target-key",i),s.style.clear="unset";let l=(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)?tY:tW;return n.render(()=>(0,R.createElement)(l,{...o,getPos:r,anchorRectCache:a}),s,i,void 0,!0),s},{type:_,destroy:()=>{n.remove(i)}})},od=(e,t,o,n,a,s,l,d)=>{let c=[],p=e.doc.nodeSize-2,u=void 0===d||d>p?p:d,m=a?.pos,f="number"==typeof m&&e.doc.resolve(m),g=f&&f.nodeAfter,h=(0,i.editorExperiment)("platform_editor_element_drag_and_drop_multiselect",!0);s?.clear();let b=[],y=e=>{let t,o=Math.max(e,0);for(;b.length>o;)t=b.pop();return t},_=(e,t)=>{y(t),b.push(e)},S=(0,i.editorExperiment)("advanced_layouts",!0),E=e.selection,{$anchor:v,$head:T}=(0,r("l6okE").expandSelectionBounds)(E.$anchor,E.$head),C=Math.min(v.pos,T.pos),x=Math.max(v.pos,T.pos),A=void 0!==m&&m>=C&&m<=x;return e.doc.nodesBetween(void 0===l||l<0?0:l,u,(i,l,d,p)=>{let u,m=0,b=e.doc.resolve(l),E=f&&t1(f,b);if(m=b.depth,S){if(a?.pos===l&&"layoutColumn"!==a.nodeType)return!1;"layoutColumn"===i.type.name&&d?.type.name==="layoutSection"&&0!==p&&(d?.childCount<tf()||E)&&c.push(ol(l,{api:t,parent:d,formatMessage:o},n,s))}if(i.isInline||!d||ot.includes(d.type.name))return _(i,m),!1;if(t7.includes(i.type.name))return _(i,m),oo(i);if(h){let t=e.doc.slice(C,x,!1),o=t.content.childCount,n=!0,a=!0;if(o>1&&A?a=t6(t,C,x,d,p,b):n=!!(g&&t8(d,p,g,b,i)),!a||!n)return _(i,m),!1}else if(!(g&&t8(d,p,g,b,i)))return _(i,m),!1;d.lastChild===i&&!(0,r("l9G9n").isEmptyParagraph)(i)&&oe.includes(d.type.name)&&(u=l+i.nodeSize);let v=y(m),T=["tableCell","tableHeader","layoutColumn"].includes(d?.type.name||"")&&d?.lastChild===i&&(0,r("l9G9n").isEmptyParagraph)(i);return c.push(os(l,{api:t,prevNode:v,nextNode:i,parentNode:d||void 0,formatMessage:o,dropTargetStyle:T?"remainingHeight":"default"},n,-1,s,E)),void 0!==u&&c.push(os(u,{api:t,prevNode:i,parentNode:d||void 0,formatMessage:o,dropTargetStyle:"remainingHeight"},n,-1,s)),_(i,m),m<100&&oo(i)}),u===p&&c.push(os(p,{api:t,formatMessage:o,prevNode:e.doc.lastChild||void 0,parentNode:e.doc},n,void 0,s)),c},oc=["tableRow","listItem","caption","media"],op=["blockCard","rule","extension"],ou=["orderedList","bulletList"],om=(e,t,o)=>{let n=t.depth;if(op.includes(o||"")||0===t.pos){let e=t.node(n),o=t.nodeAfter,a=t.index(),r=a>0?e.child(a-1):null,i=a<e.childCount-1?e.child(a+1):null;return{pos:t.pos,node:o,parent:e,before:r,after:i,index:a,depth:n}}let a=1===n,r=t.node(n);for(let o=1;o<n;o++){let n=t.node(o).type.name;if(ou.includes(n))return om(e,e.doc.resolve(t.before(o+1)),n)}if(oc.includes(r.type.name)&&!a)return om(e,e.doc.resolve(t.before(n-1)));let i=n>0?t.before(n):0,s=a?e.doc:t.node(n-1),l=t.index(n-1),d=l>0?s.child(l-1):null,c=l<s.childCount-1?s.child(l+1):null;return{pos:i,node:r,parent:s,before:d,after:c,index:l,depth:n}},of=["tableCell","tableHeader","panel","layoutColumn","expand","nestedExpand","bodiedExtension"],og=[...of,"bodiedSyncBlock"],oh=["tableCell","tableHeader","layoutColumn"],ob=["syncBlock","bodiedSyncBlock"],oy=e=>(0,i.editorExperiment)("platform_synced_block",!0)?og.includes(e.type.name):of.includes(e.type.name),o_=(e,t,o,n,a,s)=>{let l=e.selection,{$anchor:d,$head:c}=(0,r("l6okE").expandSelectionBounds)(l.$anchor,l.$head),p=Math.min(d.pos,c.pos),u=Math.max(d.pos,c.pos),m=s?.pos,f="number"==typeof m&&e.doc.resolve(m),g=f&&f.nodeAfter,h=void 0!==m&&m>=p&&m<=u;if(!(0,i.editorExperiment)("platform_editor_element_drag_and_drop_multiselect",!0))return g&&t8(o,n,g,a,t);{let r=e.doc.slice(p,u,!1),i=r.content.childCount,s=!0,l=!0;if(i>1&&h?l=t6(r,p,u,o,n,a):s=!!(g&&t8(o,n,g,a,t)),!l||!s)return!1}return!0},oS=(e,t,o,n,a,s,l,d)=>{let p=[],u=n.filter(e=>!!e),m=l?.pos,f="number"==typeof m&&t.doc.resolve(m),g=t.doc.resolve(e.pos),h=u.map(e=>e.from),{parent:b,index:y,node:_,pos:S,before:E,after:T,depth:C}=om(t,g,e.nodeTypeName);if(oy(_)){let e=0===_.childCount||1===_.childCount&&(0,r("l9G9n").isEmptyParagraph)(_.firstChild),n=S+1;if(_.firstChild&&o_(t,_.firstChild,_,0,t.doc.resolve(n),l)&&(h.includes(n)?u=u.filter(e=>e.from!==n):p.push(os(n,{api:o,prevNode:void 0,nextNode:_.firstChild,parentNode:_,formatMessage:a,dropTargetStyle:e?"remainingHeight":"default"},s,1,d))),!e){let e=S+_.nodeSize-1;_.lastChild&&o_(t,_.lastChild,_,_.childCount-1,t.doc.resolve(e),l)&&(h.includes(e)?u=u.filter(t=>t.from!==e):p.push(os(e,{api:o,prevNode:_.lastChild,nextNode:void 0,parentNode:_,formatMessage:a,dropTargetStyle:"remainingHeight"},s,-1,d)))}}if(!oh.includes(_.type.name)){let e=f&&t1(f,g),n=["tableCell","tableHeader","layoutColumn"].includes(b?.type.name||"")&&b?.lastChild===_&&(0,r("l9G9n").isEmptyParagraph)(_);o_(t,_,b,y,g,l)&&(h.includes(S)?u=u.filter(e=>e.from!==S):p.push(os(S,{api:o,prevNode:E||void 0,nextNode:_,parentNode:b||void 0,formatMessage:a,dropTargetStyle:n?"remainingHeight":"default"},s,-1,d,e)));let i=S+_.nodeSize;o_(t,_,b,y+1,t.doc.resolve(i),l)&&(h.includes(i)?u=u.filter(e=>e.from!==i):p.push(os(i,{api:o,prevNode:_,nextNode:T||void 0,parentNode:b||void 0,formatMessage:a,dropTargetStyle:n?"remainingHeight":"default"},s,-1,d,e)))}let x={node:_,pos:S};if(C>1){let e=om(t,t.doc.resolve(g.before(2)));h.includes(e.pos)?u=u.filter(t=>t.from!==e.pos):p.push(os(e.pos,{api:o,prevNode:e.before||void 0,nextNode:e.node,parentNode:t.doc||void 0,formatMessage:a,dropTargetStyle:"default"},s,-1,d,!1)),x={node:e.node,pos:e.pos}}if((0,i.editorExperiment)("advanced_layouts",!0)){let e=f&&t1(f,t.doc.resolve(x.pos)),n=ob.includes(l?.nodeType||"")&&(0,i.editorExperiment)("platform_synced_block",!0);if("layoutSection"===x.node.type.name&&!n){let t=x.node;(t.childCount<tf()||e)&&t.descendants((e,t,n,r)=>{if("layoutColumn"===e.type.name&&n?.type.name==="layoutSection"&&0!==r){let e=x.pos+t+1;h.includes(e)?u=u.filter(t=>t.from!==e):p.push(ol(x.pos+t+1,{api:o,parent:n,formatMessage:a},s,d))}return!1})}}return td.emit((0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)?o.core.actions.getAnchorIdForNode(x.node,x.pos)||"":v(x.node)),{decsToAdd:p,decsToRemove:u}},oE=(e,t,o,n,a)=>{if(!e)return"auto";if(!n)return`${e.offsetLeft-z(t)-o.width}px`;let r=a?e.querySelector("span.relative"):null,i=r?r.offsetLeft:0;return"none"===getComputedStyle(n).transform?`${n.offsetLeft+i-z(t)-o.width}px`:`${n.offsetLeft+i-n.offsetWidth/2-z(t)-o.width}px`},ov=e=>{let t=e.state.selection;return t instanceof r("ks2lK").NodeSelection&&t.$from.depth>0},oT=(e,t)=>{let o=t.state.doc.nodeAt(e);if(null===o)return!1;let n=e+o.nodeSize,{$from:a,$to:r}=t.state.selection;return a.pos>=e&&n>=r.pos},oC=e=>{let t=e.state.selection;return t instanceof r("ks2lK").TextSelection||(t instanceof r("ks2lK").NodeSelection?t.node.isInline:void 0)},ox=(e,t)=>{let o=t.state.doc.nodeAt(e);if(null===o)return!1;switch(o.type.name){case"mediaGroup":case"mediaSingle":return!0}return o.isBlock&&(o.isAtom||o.isLeaf)},oA=e=>({tr:t})=>{let o=t.doc.nodeAt(e)?.nodeSize;if(void 0===o)return t;let n=e+o;return t.insert(n,t.doc.type.schema.nodes.paragraph.create()),t.setSelection(r("ks2lK").TextSelection.near(t.doc.resolve(n)))},ok=["paragraph","heading","blockquote","taskItem","decisionItem"],oI=(0,r("ecnYn").xcss)({top:"0",position:"sticky",boxSizing:"border-box",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"var(--ds-space-300, 24px)",width:"var(--ds-space-300, 24px)",border:"none",backgroundColor:"color.background.neutral.subtle",borderRadius:"radius.full",zIndex:"card",outline:"none",":hover":{backgroundColor:"color.background.neutral.subtle.hovered"},":active":{backgroundColor:"color.background.neutral.subtle.pressed"},":focus":{outline:"var(--ds-border-width-focused, 2px) solid var(--ds-border-focused, #388BFF)"}}),oP=(0,r("ecnYn").xcss)({height:(0,r("aFUXX").relativeSizeToBaseFontSize)(24),width:(0,r("aFUXX").relativeSizeToBaseFontSize)(24)}),oN=(0,r("ecnYn").xcss)({position:"absolute",zIndex:"card"}),ow={name:"1hhl1l9",styles:"top:8px;bottom:-8px;position:sticky;display:block;z-index:card"},oD=(0,r("9K4OG").css)({'[data-blocks-quick-insert-container]:has(~ [data-prosemirror-node-name="table"] .pm-table-with-controls tr.sticky) &':{top:r("1zav4").tableControlsSpacing}}),oO=(0,r("9K4OG").css)({'[data-blocks-quick-insert-container]:has(~ [data-prosemirror-node-name="table"] .pm-table-with-controls tr.sticky) &':{top:r("1zav4").tableControlsSpacing},'[data-blocks-quick-insert-container]:has(~ [data-prosemirror-mark-name="fragment"] >[data-prosemirror-node-name="table"] tr.pm-table-row-native-sticky.pm-table-row-native-sticky-active) &':{top:"24px"},'[data-blocks-quick-insert-container]:has(~ [data-prosemirror-node-name="table"] tr.pm-table-row-native-sticky.pm-table-row-native-sticky-active) &':{top:"24px"},'[data-blocks-quick-insert-container]:has(~ [data-prosemirror-mark-name="fragment"] >[data-prosemirror-node-name="table"] .pm-table-with-controls tr.sticky) &':{top:r("1zav4").tableControlsSpacing}}),oM=(0,r("9K4OG").css)({'[data-prosemirror-mark-name="breakout"]:has([data-blocks-quick-insert-container]):has(~ [data-prosemirror-node-name="table"] .pm-table-with-controls tr.sticky) &':{top:r("1zav4").tableControlsSpacing}}),oR=(0,r("9K4OG").css)({'[data-prosemirror-mark-name="breakout"]:has([data-blocks-quick-insert-container]):has(~ [data-prosemirror-node-name="table"] .pm-table-with-controls tr.sticky) &':{top:r("1zav4").tableControlsSpacing},'[data-prosemirror-mark-name="breakout"]:has([data-blocks-quick-insert-container]):has(~ [data-prosemirror-mark-name="fragment"] >[data-prosemirror-node-name="table"] .pm-table-with-controls tr.sticky) &':{top:r("1zav4").tableControlsSpacing},'[data-prosemirror-mark-name="breakout"]:has([data-blocks-quick-insert-container]):has(~ [data-prosemirror-node-name="table"] tr.pm-table-row-native-sticky.pm-table-row-native-sticky-active) &':{top:"24px"},'[data-prosemirror-mark-name="breakout"]:has([data-blocks-quick-insert-container]):has(~ [data-prosemirror-mark-name="fragment"] >[data-prosemirror-node-name="table"] tr.pm-table-row-native-sticky.pm-table-row-native-sticky-active) &':{top:"24px"}}),oL=({view:e,api:o,formatMessage:n,getPos:a,anchorName:i,rootAnchorName:l,rootNodeType:d,anchorRectCache:p})=>{let u=(0,r("b3YrF").useSharedPluginStateSelector)(o,"featureFlags.macroInteractionUpdates"),[f,g]=(0,R.useState)({display:"none"}),h=(0,R.useCallback)(()=>{let t=CSS.supports("top",`anchor(${l} start)`)&&CSS.supports("left",`anchor(${l} start)`),o=eD({getPos:a,view:e,anchorName:l}),n=e.dom.querySelector(`[${m()}="${o}"]`),r="table"===d||"mediaSingle"===d,s="extension"===d||"bodiedExtension"===d,c="blockCard"===d,f="embedCard"===d,g=u&&s,h=null;n&&(f?h=n.querySelector(".rich-media-item"):r?h=n.querySelector(".resizer-item"):s?h=n.querySelector(".extension-container[data-layout]"):c&&(h=n.querySelector(".datasourceView-content-inner-wrap")));let b=(r||s||f||c)&&h,y=ea(d),_=er(o||i,y,!0);if(t)return{left:b?`calc(anchor(${o} start) + ${oE(n,d,H,h,g)} + -16px)`:`calc(anchor(${o} start) - ${H.width}px - ${z(d)}px + -16px)`,top:`calc(anchor(${o} start) + ${Y(d)}px)`,..._};let S=ei(en(n,o||i,p)||0,y,!0,"var(--ds-space-300, 24px)");return{left:b?`calc(${n?.offsetLeft||0}px + ${oE(n,d,H,h,g)} + -16px)`:`calc(${oE(n,d,H,h,g)} + -16px)`,top:et(n,d),...S}},[l,a,e,d,u,i,p]);(0,R.useEffect)(()=>{let t;if("extension"===d||"embedCard"===d){let o=e.dom.querySelector(`[${m()}="${l}"]`);if(!o)return;t=(0,r("fFa3V").bind)(o,{type:"transitionend",listener:()=>{g(h())}})}let o=requestAnimationFrame(()=>{g(h())});return()=>{cancelAnimationFrame(o),t?.()}},[h,e.dom,l,d]);let b=(0,R.useCallback)(()=>{let t=a();if(void 0!==t){let n=oT(t,e);(!n||ox(t,e))&&o.core.actions.execute(oA(t));let{codeBlock:a}=e.state.schema.nodes,{selection:i}=e.state,l=(0,s.findParentNodeOfType)(a)(i);if(l)o.core.actions.execute(oA(l.pos));else if(n){let t=e.state.selection;if(oC(e)&&t.from!==t.to){let n=(0,s.findParentNode)(e=>ok.includes(e.type.name))(t);if(n){let a=t.anchor===t.to?n.pos:n.pos+n.node.nodeSize-1;o.core.actions.execute(({tr:t})=>(t.setSelection(r("ks2lK").TextSelection.create(e.state.selection.$from.doc,a)),t))}}if(ov(e)&&(ox(e.state.selection.from,e)?o.core.actions.execute(oA(e.state.selection.from)):o.core.actions.execute(({tr:t})=>(oA(e.state.selection.from)({tr:t}),t.setSelection(r("ks2lK").TextSelection.create(t.doc,e.state.selection.from)),t))),t instanceof r("7XFGZ").CellSelection){let t=r("ks2lK").TextSelection.near(e.state.selection.$to,-1);t&&o.core.actions.execute(({tr:e})=>(t instanceof r("ks2lK").TextSelection?e.setSelection(t):(oA(t.from)({tr:e}),e.setSelection(r("ks2lK").TextSelection.create(e.doc,t.to))),e))}}}o.quickInsert?.actions.openTypeAhead("blockControl",!0)},[o,a,e]),y=(0,R.useCallback)(()=>{o.typeAhead?.actions.isOpen(e.state)&&o.typeAhead.actions.close({insertCurrentQueryAsRawText:!1})},[o,e.state]);return(0,r("9K4OG").jsx)(r("6f0Oj").default,{style:f,xcss:[oN]},(0,r("9K4OG").jsx)("span",{css:[ow,(0,c.expValEquals)("platform_editor_table_sticky_header_improvements","cohort","test_with_overflow")&&(0,r("dh538").fg)("platform_editor_table_sticky_header_patch_6")?oO:oD,(0,c.expValEquals)("platform_editor_table_sticky_header_improvements","cohort","test_with_overflow")&&(0,r("dh538").fg)("platform_editor_table_sticky_header_patch_6")?oR:oM]},(0,r("9K4OG").jsx)(r("3gadb").default,{position:"top",content:(0,r("9K4OG").jsx)(r("hgeg8").ToolTipContent,{description:n(r("dwl7L").messages.insert)})},(0,r("9K4OG").jsx)(r("2W0qg").default,{testId:"editor-quick-insert-button",type:"button","aria-label":n(r("dwl7L").messages.insert),xcss:[oI,((0,c.expValEquals)("confluence_compact_text_format","isEnabled",!0)||(0,c.expValEquals)("cc_editor_ai_content_mode","variant","test")&&(0,r("dh538").fg)("platform_editor_content_mode_button_mvp"))&&oP],onClick:b,onMouseDown:y},(0,r("9K4OG").jsx)(t(r("g5gZt")),{label:"add",color:"var(--ds-icon-subtle, #505258)",size:"small"})))))},oB=({view:e,api:t,formatMessage:o,getPos:n,nodeType:a,anchorName:i,rootAnchorName:s,rootNodeType:l,anchorRectCache:d})=>(0,r("9K4OG").jsx)(eF,{api:t},(0,r("9K4OG").jsx)(oL,{view:e,api:t,formatMessage:o,getPos:n,nodeType:a,anchorName:i,rootAnchorName:s,rootNodeType:l,anchorRectCache:d})),oV=({rootAnchorName:e,anchorName:t,view:o,getPos:n,rootNodeType:a,macroInteractionUpdates:r,anchorRectCache:i})=>{let s=CSS.supports("top",`anchor(${e} start)`)&&CSS.supports("left",`anchor(${e} start)`),l=eD({getPos:n,view:o,anchorName:e}),d=o.dom.querySelector(`[${m()}="${l}"]`),c="table"===a||"mediaSingle"===a,p="extension"===a||"bodiedExtension"===a,u="blockCard"===a,f="embedCard"===a,g=r&&p,h=null;d&&(f?h=d.querySelector(".rich-media-item"):c?h=d.querySelector(".resizer-item"):p?h=d.querySelector(".extension-container[data-layout]"):u&&(h=d.querySelector(".datasourceView-content-inner-wrap")));let b=(c||p||f||u)&&h,y=ea(a),_=er(l||t,y,!0);if(s)return{left:b?`calc(anchor(${l} start) + ${oE(d,a,H,h,g)} + -16px)`:`calc(anchor(${l} start) - ${H.width}px - ${z(a)}px + -16px)`,top:`calc(anchor(${l} start) + ${Y(a)}px)`,..._};let S=ei(en(d,l||t,i)||0,y,!0,"var(--ds-space-300, 24px)");return{left:b?`calc(${d?.offsetLeft||0}px + ${oE(d,a,H,h,g)} + -16px)`:`calc(${oE(d,a,H,h,g)} + -16px)`,top:et(d,a),...S}},oF={name:"offset",options:{offset:[0,4]}},oU={name:"offset",options:{offset:[0,8]}};class oG{createPopperInstance(){this.popperInstance=(0,r("i4Myo").createPopper)(this.button,this.tooltip,{placement:"top",modifiers:[oF]})}destroy(){this.popperInstance?.destroy(),this.listeners.forEach(e=>{e()})}hide(e=!1){clearTimeout(this.currentTimeoutId),this.shouldHidePopover=!0,this.currentTimeoutId=setTimeout(()=>{this.popperInstance?.setOptions(e=>({...e,modifiers:[oF,{name:"eventListeners",enabled:!1}]})),this.tooltip.style.opacity="0",this.isDisplayed=!1,"none"===this.tooltip.style.transition&&this.tooltip.hidePopover()},e?0:this.timeout)}show(){this.isDisplayed||(clearTimeout(this.currentTimeoutId),this.shouldHidePopover=!1,this.tooltip.style.visibility="hidden",this.tooltip.showPopover(),this.popperInstance?this.popperInstance.update():this.createPopperInstance(),this.currentTimeoutId=setTimeout(()=>{this.tooltip.style.opacity="1",this.tooltip.style.visibility="visible",this.popperInstance?.setOptions(e=>({...e,modifiers:[oU,{name:"eventListeners",enabled:!0}]})),this.isDisplayed=!0},this.timeout))}constructor(e,t,o,n=300){this.button=e,this.timeout=n,this.popperInstance=void 0,this.listeners=[],this.currentTimeoutId=void 0,this.shouldHidePopover=!1,this.tooltip=void 0,this.isDisplayed=!1;let a=document.createElement("span");a.role="tooltip",a.popover="hint",a.className="blocks-quick-insert-tooltip",a.id=o,a.textContent=t,this.tooltip=a,e.appendChild(a),e.setAttribute("popovertarget",a.id),e.setAttribute("aria-describedby",a.id),["mouseenter","focus"].forEach(t=>{this.listeners.push((0,r("fFa3V").bind)(e,{type:t,listener:()=>this.show()}))}),["mouseleave","blur"].forEach(t=>{this.listeners.push((0,r("fFa3V").bind)(e,{type:t,listener:()=>this.hide()}))}),this.listeners.push((0,r("fFa3V").bind)(window,{type:"keydown",listener:e=>{"Escape"===e.key&&this.hide(!0)}})),this.tooltip.ontransitionend=()=>{this.shouldHidePopover&&this.tooltip.hidePopover()}}}let oq=["http://www.w3.org/2000/svg svg",{width:"12",height:"12",fill:"none",viewBox:"0 0 12 12",style:"pointer-events: none;"},["http://www.w3.org/2000/svg path",{fill:"currentcolor","fill-rule":"evenodd",d:"M5.25 6.75V11h1.5V6.75H11v-1.5H6.75V1h-1.5v4.25H1v1.5z","clip-rule":"evenodd",style:"pointer-events: none;"}]],oH=({view:e,getPos:t,rootNodeType:o,anchorRectCache:n,anchorName:a,rootAnchorName:i,api:s})=>["div",{style:(0,r("24P9d").convertToInlineCss)({position:"absolute",...oV({rootAnchorName:i,anchorName:a,view:e,getPos:t,rootNodeType:o,macroInteractionUpdates:s?.featureFlags?.sharedState.currentState()?.macroInteractionUpdates??!1,anchorRectCache:n})})},["button",{class:"blocks-quick-insert-button","data-testid":"editor-quick-insert-button"},oq]],oj=e=>{let{dom:t}=r("5SAOw").DOMSerializer.renderSpec(document,oH(e));if(t instanceof HTMLElement){let o=t.querySelector('button[data-testid="editor-quick-insert-button"]');if(o instanceof HTMLButtonElement){o.onclick=()=>oK(e);let t=new oG(o,e.formatMessage(r("dwl7L").messages.insert),"quick-insert-button-tooltip");e.cleanupCallbacks.push(()=>{t.destroy()})}}let o=e.api.typeAhead?.sharedState.currentState()?.isOpen,n=e.api.blockControls?.sharedState.currentState()?.isEditing,a=()=>{t instanceof HTMLElement&&(o||n?(t.classList.add("blocks-quick-insert-invisible-container"),t.classList.remove("blocks-quick-insert-visible-container")):(t.classList.add("blocks-quick-insert-visible-container"),t.classList.remove("blocks-quick-insert-invisible-container")))};return a(),e.cleanupCallbacks.push(e.api.typeAhead?.sharedState.onChange(({nextSharedState:e})=>{o=e?.isOpen,a()})),e.cleanupCallbacks.push(e.api.blockControls?.sharedState.onChange(({nextSharedState:e})=>{n=e?.isEditing,a()})),t},o$=["paragraph","heading","blockquote","taskItem","decisionItem"],oK=({api:e,view:t,getPos:o})=>{let n=o();if(void 0!==n){let o=oT(n,t);(!o||ox(n,t))&&e.core.actions.execute(oA(n));let{codeBlock:a}=t.state.schema.nodes,{selection:i}=t.state,l=(0,s.findParentNodeOfType)(a)(i);if(l)e.core.actions.execute(oA(l.pos));else if(o){let o=t.state.selection;if(oC(t)&&o.from!==o.to){let n=(0,s.findParentNode)(e=>o$.includes(e.type.name))(o);if(n){let a=o.anchor===o.to?n.pos:n.pos+n.node.nodeSize-1;e.core.actions.execute(({tr:e})=>(e.setSelection(r("ks2lK").TextSelection.create(t.state.selection.$from.doc,a)),e))}}if(ov(t)&&(ox(t.state.selection.from,t)?e.core.actions.execute(oA(t.state.selection.from)):e.core.actions.execute(({tr:e})=>(oA(t.state.selection.from)({tr:e}),e.setSelection(r("ks2lK").TextSelection.create(e.doc,t.state.selection.from)),e))),o instanceof r("7XFGZ").CellSelection){let o=r("ks2lK").TextSelection.near(t.state.selection.$to,-1);o&&e.core.actions.execute(({tr:e})=>(o instanceof r("ks2lK").TextSelection?e.setSelection(o):(oA(o.from)({tr:e}),e.setSelection(r("ks2lK").TextSelection.create(e.doc,o.to))),e))}}}e.quickInsert?.actions.openTypeAhead("blockControl",!0)},oz="INSERT_BUTTON",oW=(e,t,o)=>e.find(t,o,e=>e.type===oz),oY=({api:e,formatMessage:o,rootPos:n,anchorName:a,nodeType:s,nodeViewPortalProviderAPI:l,rootAnchorName:d,rootNodeType:p,anchorRectCache:u,editorState:m})=>{let f=t(y)(),g=[],h=(0,i.editorExperiment)("platform_editor_breakout_resizing",!0)?{side:-2,type:oz,marks:tn(m,n),destroy:e=>{(0,r("dh538").fg)("platform_editor_fix_widget_destroy")&&l.remove(f),g.forEach(e=>{e()})}}:{side:-2,type:oz,destroy:e=>{(0,r("dh538").fg)("platform_editor_fix_widget_destroy")&&l.remove(f),g.forEach(e=>{e()})}};return r("ftzrq").Decoration.widget(n,(t,n)=>{let r=document.createElement("span");if(r.style.display="block",(0,c.expValEquals)("platform_editor_quick_insert_image_wrap_right_fix","isEnabled",!0)&&(r.style.clear="unset"),r.contentEditable="false",r.setAttribute("data-blocks-quick-insert-container","true"),r.setAttribute("data-testid","block-ctrl-quick-insert-button"),(0,i.editorExperiment)("platform_editor_block_control_optimise_render",!0,{exposure:!0})){let i=oj({formatMessage:o,api:e,view:t,getPos:n,cleanupCallbacks:g,rootAnchorName:d??s,anchorName:a,rootNodeType:p??s,anchorRectCache:u});return r.appendChild(i),r}return l.render(()=>(0,R.createElement)(oB,{api:e,getPos:n,formatMessage:o,view:t,nodeType:s,anchorName:a,rootAnchorName:d,rootNodeType:p??s,anchorRectCache:u}),r,f,void 0,!0),r},h)},oX=e=>(t,o)=>{if(!(o.target instanceof HTMLElement))return!1;if(t.editable){let t=null!==o.target.closest((0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)?r("Yqd3z").DRAG_HANDLE_SELECTOR:"[data-editor-block-ctrl-drag-handle]");e?.core.actions.execute(({tr:o})=>(e?.blockControls.commands.setSelectedViaDragHandle(t)({tr:o}),(0,r("dh538").fg)("platform_editor_toolbar_aifc_user_intent_fix")&&((0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)?t||e?.userIntent?.commands.setCurrentUserIntent("default")({tr:o}):e.userIntent?.commands.setCurrentUserIntent(t?"dragHandleSelected":"default")({tr:o})),o))}else{let n=t.posAtDOM(o.target,0),a=t.state.doc.resolve(n).before(1),r=t.state.doc.nodeAt(a);if(!r)return!1;if((0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)){let t=e?.core.actions.getAnchorIdForNode(r,a);if(!t)return!1;e?.core.actions.execute(e?.blockControls.commands.showDragHandleAt(a,t,r.type.name??"",void 0,a,t,r.type.name??""))}else e?.core.actions.execute(e?.blockControls.commands.showDragHandleAt(a,"",r.type.name??"",void 0,a,"",r.type.name??""))}return!1},oJ=e=>!!(e instanceof HTMLHeadingElement||e instanceof HTMLParagraphElement)&&!e.parentElement?.classList.contains("ProseMirror")&&""===e.textContent,oQ=(e,t)=>{let o=`[${p}]`;if(0===e.length&&0===t.length)return o;let n=[...e.map(e=>`[data-prosemirror-node-name="${e}"]`),...t.map(e=>"table"===e?['[data-prosemirror-node-name="tableCell"] > [data-node-anchor]','[data-prosemirror-node-name="tableCell"] > *:not([data-node-anchor]) > [data-node-anchor]','[data-prosemirror-node-name="tableHeader"] > [data-node-anchor]','[data-prosemirror-node-name="tableHeader"] > *:not([data-node-anchor]) > [data-node-anchor]']:`[data-prosemirror-node-name="${e}"] [data-node-anchor]`).flat(),'[data-prosemirror-node-inline="true"]'].join(", ");return`${o}:not(${n})`},oZ=(0,r("2XqLN").default)(()=>oQ([...k,"media"],[...P,"table"])),o0=(e,t,o)=>{let{isDragging:n,activeNode:s,isMenuOpen:l,menuTriggerBy:d}=o?.blockControls?.sharedState.currentState()||{},{editorDisabled:p}=o?.editorDisabled?.sharedState.currentState()||{editorDisabled:!1},u=(0,r("iHzeA").areToolbarFlagsEnabled)(!!o?.toolbar);if(p&&(0,r("dh538").fg)("platform_editor_ai_generic_prep_for_aifc")||n)return!1;let g=t.target,b=(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0);if(g?.classList?.contains("ProseMirror"))return!1;let y=g?.closest(b?oZ():"[data-drag-handler-anchor-name]");if(y){let t,n,r,p,g;if(oJ(y)||"media"===y.getAttribute(f())&&(0,i.editorExperiment)("advanced_layouts",!0)&&!b&&!(y=y.closest(`[${m()}][${f()}="mediaSingle"]`)))return!1;let _=y.parentElement?.closest(`[${m()}]`),S=b?h(_):_?.getAttribute("data-drag-handler-node-type");if((0,i.editorExperiment)("advanced_layouts",!0)){if(_&&"table"===S)y=_;else if(_&&"tableRow"===S){let e=_?.parentElement?.closest(`[${m()}]`),t=b?h(e):e?.getAttribute("data-drag-handler-node-type");e&&"table"===t&&(y=e)}}else _&&"table"===S&&(y=_);if((0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)){if(!(t=y.getAttribute(m())))return!1}else t=y.getAttribute(m());if(s?.anchorName===t||["wrap-right","wrap-left"].includes(y.getAttribute("layout")||""))return!1;let E=y.parentElement;if(E){let t=Array.from(E.childNodes).indexOf(y);n=e.posAtDOM(E,t);let o=E?.children[0]?.classList.contains("ProseMirror-widget");if(_&&"panel"===S&&!_.classList.contains("ak-editor-panel__no-icon")&&(0===t||o&&1===t))return!1}else n=e.posAtDOM(y,0);if(E&&"true"===E.getAttribute("data-layout-section")&&1===E.querySelectorAll("[data-layout-column]").length&&(0,i.editorExperiment)("advanced_layouts",!0))return!1;let v=e.state.doc.resolve(n).pos;if(u&&v!==(g=e.state.doc.resolve(n).before(1))){let t=e.nodeDOM(g);t instanceof HTMLElement&&(r=t.getAttribute(m())??void 0,p=b?h(t):t.getAttribute("data-drag-handler-node-type"))}let T=b?h(y):y.getAttribute("data-drag-handler-node-type");T&&(u?o?.core?.actions.execute(o?.blockControls?.commands.showDragHandleAt(v,t,T,void 0,g??v,r??t,p??T)):o?.core?.actions.execute(o?.blockControls?.commands.showDragHandleAt(v,t,T)),(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)&&l&&d&&o?.userIntent?.sharedState.currentState()?.currentUserIntent==="blockMenuOpen"&&o?.core?.actions.execute(o?.blockControls?.commands.toggleBlockMenu()))}},o1=({selection:e,schema:t,resolve:o})=>{let n=e.$from.before(1);if(e instanceof r("ks2lK").TextSelection){let a=o(n=e.$from.before());if(a.depth<1)return n;let r=(0,s.findParentNodeOfType)([t.nodes.bulletList,t.nodes.orderedList,t.nodes.blockquote,t.nodes.taskList,t.nodes.decisionList])(e);if(r){let e=r.node.type.name;n=["bulletList","orderedList"].includes(e)?a.before(a.depth-1):["blockquote","taskList","decisionList"].includes(e)?a.before():n}}else n=e.$from.pos;return n},o2=({selection:e,schema:t,resolve:o})=>{let n=e.$from.before(1);if(e instanceof r("ks2lK").TextSelection){let a=o(n=e.$from.before());if(a.depth<1)return n;let{bulletList:r,orderedList:i,taskList:l,decisionList:d,caption:c}=t.nodes,p=(0,s.findParentNodeOfType)([r,i,l])(e),u=(0,s.findParentNodeOfType)([c,d])(e);p?n=o5(a,o):u&&(n=a.before())}else n=e.$from.pos;return n},o5=(e,t)=>{if(0===e.depth)return e.pos;let o=e.before(),n=e.parent;return n&&["bulletList","listItem","orderedList","taskList","taskItem"].includes(n.type.name)?o5(t(o),t):e.pos},o4=e=>{let{selection:{$from:t}}=e,{activeNode:o}=nn.getState(e)||{};if(o&&o.handleOptions?.isFocused){let t=e.doc.resolve(o.pos);if(0===t.depth)return;return t.before()}if(t.depth<=1)return t.before(1);let n=(0,s.findParentNodeOfType)([e.schema.nodes.table])(e.selection);return n?n.pos:(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)?o2({selection:e.selection,schema:e.schema,resolve:e.doc.resolve.bind(e.doc)}):o1({selection:e.selection,schema:e.schema,resolve:e.doc.resolve.bind(e.doc)})},o9=e=>{let t=nc(e);if(!t)return;let o=o4(e);if(void 0===o)return;let n=e.doc.nodeAt(o),a=n&&O(e,t,o,o+n.nodeSize);if(a&&0!==a.length&&0!==(a=a.filter(e=>e.from<=o)).length)return a.sort((e,t)=>e.from===t.from?e.to-t.to:t.from-e.from),a[0]},o3=e=>{let t=o4(e.state);if(void 0===t)return;let o=e.nodeDOM(t);if(!(o instanceof HTMLElement))return;let n=o.closest(`[${p}]`);if(!n)return;let a=n?.getAttribute(u),r=n?.getAttribute(p);if(a&&r)return{pos:t,nodeType:a,anchorName:r}},o8=e=>(t,o,n)=>{if(n&&(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)){let t=o3(n);if(e&&t){let{pos:o,anchorName:n,nodeType:a}=t;return e.core.actions.execute(e.blockControls.commands.showDragHandleAt(o,n,a,{isFocused:!0})),!0}return!1}{let o=o9(t);return!!e&&!!o&&(e.core.actions.execute(e.blockControls.commands.showDragHandleAt(o.from,o.spec.anchorName,o.spec.nodeTypeWithLevel,{isFocused:!0})),!0)}},o6=(e,t)=>(0,r("dus6D").keydownHandler)(function(e,t){let o={};return e&&((0,r("hgeg8").bindKeymapWithCommand)(r("hgeg8").showElementDragHandle.common,(t,o,n)=>(o8(e)(t,o,n),!0),o),(0,r("hgeg8").bindKeymapWithCommand)(r("hgeg8").dragToMoveUp.common,nI(e,r("ah4M9").DIRECTION.UP,t),o),(0,r("hgeg8").bindKeymapWithCommand)(r("hgeg8").dragToMoveDown.common,nI(e,r("ah4M9").DIRECTION.DOWN,t),o),(0,r("hgeg8").bindKeymapWithCommand)(r("hgeg8").dragToMoveLeft.common,nI(e,r("ah4M9").DIRECTION.LEFT,t),o),(0,r("hgeg8").bindKeymapWithCommand)(r("hgeg8").dragToMoveRight.common,nI(e,r("ah4M9").DIRECTION.RIGHT,t),o)),o}(e,t)),o7=e=>{let t=e.slice.content.firstChild;return e.from===e.to&&1===e.slice.content.childCount&&!!t&&!!t.text},ne=e=>{let t=e.slice.content;return e.to===e.from+1&&0===t.size},nt=e=>{if(e instanceof r("aXG5V").ReplaceAroundStep){let t=e.to-e.from;return e.slice.content.size===t}return!1},no=(e,t)=>{let o,n,a=0,i=!0,s=!1;return e.steps.forEach(l=>{if(l instanceof r("aXG5V").ReplaceStep||l instanceof r("aXG5V").ReplaceAroundStep){(l instanceof r("aXG5V").ReplaceAroundStep||l instanceof r("aXG5V").ReplaceStep&&!o7(l)&&!ne(l))&&(i=!1),t.toolbarFlagsEnabled&&(s=nt(l));let d=e.mapping.map(l.to),c=l.from+l.slice.size;c=c>d?c:d,o=void 0===o||o>l.from?l.from:o,n=void 0===n||n<c?c:n,a++}}),void 0===o&&(o=0),(void 0===n||n>e.doc.nodeSize-2)&&(n=e.doc.nodeSize-2),{from:o,to:n,numReplaceSteps:a,isAllText:i,isReplacedWithSameSize:s}},nn=new(0,r("ks2lK").PluginKey)("blockControls"),na="Editor Blocks Drag Initialization Time",nr="Editor Blocks Drop Initialization Time",ni=(e,t)=>"requestIdleCallback"in window?requestIdleCallback(e,{timeout:5e3,...t}):requestAnimationFrame(e),ns=e=>e instanceof HTMLElement,nl=(e,t)=>{let o=document.querySelector(".fabric-editor-popup-scroll-parent"),n=[];o&&n.push((0,r("51lK8").autoScrollForElements)({element:o}));let a=0;return n.push((0,d.monitorForElements)({canMonitor:({source:e})=>"element"===e.data.type,onDrag:()=>{(0,r("dh538").fg)("platform_editor_drag_and_drop_perf_analytics")?(0,r("2T4ch").isMeasuring)(na)&&(0,r("2T4ch").stopMeasure)(na,e=>{a=e}):(0,r("2T4ch").isMeasuring)(na)&&(0,r("2T4ch").stopMeasure)(na,(o,n)=>{e?.analytics?.actions.fireAnalyticsEvent({action:r("d925B").ACTION.BLOCKS_DRAG_INIT,actionSubject:r("d925B").ACTION_SUBJECT.EDITOR,eventType:r("d925B").EVENT_TYPE.OPERATIONAL,attributes:{duration:o,startTime:n,nodesCount:t?.state.doc.nodeSize}})})},onDragStart:()=>{ns(o)&&o.style.setProperty("scroll-behavior","unset")},onDrop:({location:n,source:s})=>{ns(o)&&o.style.setProperty("scroll-behavior",null),(0,r("dh538").fg)("platform_editor_drag_and_drop_perf_analytics")&&(0,r("2T4ch").startMeasure)(nr),e&&(e.core?.actions.execute(({tr:t})=>{let o=(0,i.editorExperiment)("platform_editor_element_drag_and_drop_multiselect",!0);if(o){let{multiSelectDnD:o}=e.blockControls?.sharedState.currentState()||{};if(o&&o.textAnchor===t.selection.anchor&&o.textHead===t.selection.head){let n=t.doc.resolve(o.userAnchor),a=t.doc.resolve(o.userHead);if(a.node()===n.node()){let o=n.min(a);em(t,o.pos,o.node().type.name,e)}else t.setSelection(r("ks2lK").TextSelection.create(t.doc,o.userAnchor,o.userHead))}e.selection?.commands.clearManualSelection()({tr:t})}let{start:a}=s.data,l=0===n.current.dropTargets.length;if(l){let n,i;if(o){let o=eS(a,t,e),r=U(t,o.from,o.to);n=r.nodeTypes,i=r.hasSelectedMultipleNodes}let s=t.doc.resolve(a),l=s.nodeAfter;e.analytics?.actions.attachAnalyticsEvent({eventType:r("d925B").EVENT_TYPE.UI,action:r("d925B").ACTION.CANCELLED,actionSubject:r("d925B").ACTION_SUBJECT.DRAG,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.ELEMENT_DRAG_HANDLE,attributes:{nodeDepth:s.depth,nodeType:l?.type.name||"",...o&&{nodeTypes:n,hasSelectedMultipleNodes:i}}})(t)}return(0,r("dh538").fg)("platform_editor_ease_of_use_metrics")&&e.metrics?.commands.startActiveSessionTimer()({tr:t}),e.userIntent?.commands.setCurrentUserIntent("default")({tr:t}),t.setMeta(nn,{...t.getMeta(nn),isDragging:!1,isPMDragging:!1,lastDragCancelled:l})}),(0,r("dh538").fg)("platform_editor_drag_and_drop_perf_analytics")&&ni(()=>{(0,r("2T4ch").isMeasuring)(nr)&&(0,r("2T4ch").stopMeasure)(nr,o=>{let i=0===n.current.dropTargets.length;e?.analytics?.actions.fireAnalyticsEvent({action:r("d925B").ACTION.ENDED,eventType:r("d925B").EVENT_TYPE.TRACK,actionSubject:r("d925B").ACTION_SUBJECT.DRAG,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.ELEMENT_DRAG_HANDLE,attributes:{dragInitializationDuration:a,dropProcessingDuration:o,isCancelled:i,nodesCount:t?.state.doc.nodeSize}})})}))}})),(0,l.combine)(...n)},nd={decorations:r("ftzrq").DecorationSet.empty,activeNode:void 0,isDragging:!1,isMenuOpen:!1,editorHeight:0,editorWidthLeft:0,editorWidthRight:0,isResizerResizing:!1,isDocSizeLimitEnabled:null,isPMDragging:!1,multiSelectDnD:void 0,lastDragCancelled:!1,isSelectedViaDragHandle:!1},nc=e=>nn.getState(e)?.decorations,np=(e,t,o,n)=>O(e,t,(0,i.editorExperiment)("platform_editor_block_control_optimise_render",!0)?o:o-1,n).filter(e=>e?.from===o).pop(),nu=(e,t,o,n,s,l,d,p,u,m)=>{let f,g,{activeNode:h,decorations:b,isResizerResizing:y,multiSelectDnD:_}=n,{editorHeight:S,editorWidthLeft:E,editorWidthRight:v,isDragging:T,isMenuOpen:C,menuTriggerBy:x,menuTriggerByNode:A,blockMenuOptions:k,isPMDragging:I,isShiftDown:P,lastDragCancelled:N,isSelectedViaDragHandle:w}=n,D=!1,{from:R,to:L,numReplaceSteps:B,isAllText:V,isReplacedWithSameSize:F}=no(o,l),U=o.getMeta(nn);if(e?.limitedMode?.sharedState.currentState()?.limitedModePluginKey.getState(s)?.documentSizeBreachesThreshold){let e=document.querySelector(".fabric-editor-popup-scroll-parent");return e&&u&&u.unobserve(e),m?.(),n}if(o.docChanged){if(b=b.map(o.mapping,o.doc),l.toolbarFlagsEnabled){if(h&&U?.isDragging!==!0){let e,t;D=((0,c.expValEquals)("platform_editor_hydratable_ui","isEnabled",!0)?(0,r("d7ZU3").getBrowserInfo)():r("d7ZU3").browser).webkit&&(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)?(e=o.mapping.mapResult(h.pos)).deleted:(e=o.mapping.mapResult(h.pos,-1)).deletedAfter,void 0!==h.rootPos&&(t=o.mapping.mapResult(h.rootPos,-1)),h={pos:e.pos,anchorName:h.anchorName,nodeType:h.nodeType,rootPos:t?.pos??h.rootPos,rootAnchorName:h.rootAnchorName,rootNodeType:h.rootNodeType}}}else if(h){let e=o.mapping.mapResult(h.pos);D=e.deleted,h={pos:e.pos,anchorName:h.anchorName,nodeType:h.nodeType}}_&&l.isMultiSelectEnabled&&(_.anchor=o.mapping.map(_.anchor),_.head=o.mapping.map(_.head))}let G=o.getMeta("is-resizer-resizing");y=G??y,(_=U?.multiSelectDnD??_)&&l.isMultiSelectEnabled&&(_=(U?.isDragging??T)&&(0,c.expValEquals)("platform_editor_block_controls_perf_optimization","isEnabled",!0)?o.docChanged&&o.selectionSet&&o.selection.empty?void 0:_:U?.isDragging===!1||o.selection.empty?void 0:_);let q=!V&&B>0,H=U?.activeNode;H||D&&!F||(H=h);let j=b===r("ftzrq").DecorationSet.empty,$=j||q||(0,i.editorExperiment)("platform_editor_breakout_resizing",!0)&&!1===G,K=!y&&($||U?.isDragging)&&!((0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)&&(0,r("dh538").fg)("editor_native_anchor_remove_decoration_in_apply")),z=!1;if(e&&K){let e=O(s,b,R,L);b=b.remove(e);let t=M(s,j?void 0:R,j?void 0:L);if(b=b.add(s.doc,t),l.toolbarFlagsEnabled){if(H&&(!D||F)){let e=np(s,b,H.pos,L),t=np(s,b,H.rootPos,L);(e||t)&&(z=!0),e&&(H.anchorName=e.spec.anchorName,H.nodeType=e.spec.nodeType),t&&(H.rootAnchorName=t.spec.anchorName,H.rootNodeType=t.spec.nodeType)}}else if(H&&!D){let e=O(s,b,(0,i.editorExperiment)("platform_editor_block_control_optimise_render",!0)?H.pos:H.pos-1,L).filter(e=>e?.from===H.pos).pop();e&&(z=!0,H.anchorName=e.spec.anchorName,H.nodeType=e.spec.nodeType)}}let W=U?.editorHeight!==void 0&&U?.editorHeight!==S||U?.editorWidthLeft!==void 0&&U?.editorWidthLeft!==E||U?.editorWidthRight!==void 0&&U?.editorWidthRight!==v,Y=U?.activeNode&&(U?.activeNode.pos!==h?.pos&&U?.activeNode.anchorName!==h?.anchorName||U?.activeNode.handleOptions?.isFocused),X=U?.activeNode&&U?.activeNode.rootPos!==h?.rootPos&&U?.activeNode.rootAnchorName!==h?.rootAnchorName,J=K&&!tp(),Q=H&&(Y||z||W||J),Z=H&&(X||z||W||J),ee=!H||y||D&&!F||U?.nodeMoved;if(l.toolbarFlagsEnabled&&(ee=ee||U?.editorBlurred),ee){let e=tr(b,h?.pos,h?.pos);if(b=b.remove(e),l.toolbarFlagsEnabled){let e=oW(b,h?.rootPos,h?.rootPos);b=b.remove(e)}}else if(e){if(Q){let o=tr(b,h?.pos,h?.pos);b=b.remove(o);let n=ts({api:e,formatMessage:t,pos:H?.pos,anchorName:H?.anchorName,nodeType:H?.nodeType,handleOptions:H?.handleOptions,nodeViewPortalProviderAPI:d,anchorRectCache:p,editorState:s});b=b.add(s.doc,[n])}if(Z&&H?.rootPos!==void 0&&l.toolbarFlagsEnabled){let o=oW(b,h?.rootPos,h?.rootPos);b=b.remove(o);let n=oY({api:e,formatMessage:t,anchorName:H?.anchorName,nodeType:H?.nodeType,nodeViewPortalProviderAPI:d,rootPos:H?.rootPos,rootAnchorName:H?.rootAnchorName,rootNodeType:H?.rootNodeType,anchorRectCache:p,editorState:s});b=b.add(s.doc,[n])}}let et=(U?.isDragging??T)&&q&&!U?.nodeMoved;if(U?.isDragging===!1||et){let e=oi(b);b=b.remove(e)}let eo=T?n.activeDropTargetNode:void 0;if(e){if((0,c.expValEquals)("platform_editor_block_controls_perf_optimization","isEnabled",!0)){if(et){let e=oi(b);b=b.remove(e)}if(U?.activeDropTargetNode){eo=U?.activeDropTargetNode;let o=oi(b),{decsToAdd:n,decsToRemove:a}=oS(U.activeDropTargetNode,s,e,o,t,d,H,p);b=b.remove(a),n.length>0&&(b=b.add(s.doc,n))}}else if(U?.isDragging||et){let o=od(s,e,t,d,H,p);b=b.add(s.doc,o)}}let en=(0,r("2pjJ5").isEmptyDocument)(s.doc);en&&!(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)&&(O(s,b).length||(b=b.add(s.doc,[ta()]))),f=l.toolbarFlagsEnabled?U?.activeNode||0!==tr(b,H?.pos,H?.pos).length?H:null:en||!U?.activeNode&&0===tr(b,H?.pos,H?.pos).length?null:H;let ea=C;if((0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)){if(U?.closeMenu)ea=!1;else if(U?.toggleMenu){let e=U?.toggleMenu.anchorName===x;ea=void 0!==x&&!e&&(C||e)?C:!C}}else U?.toggleMenu&&(ea=!C);return g=l.toolbarFlagsEnabled&&(0,c.expValEquals)("platform_editor_controls_block_controls_state_fix","isEnabled",!0)?U?.isSelectedViaDragHandle!==void 0?U?.isSelectedViaDragHandle:w:U?.isSelectedViaDragHandle!==void 0&&l.toolbarFlagsEnabled&&U?.isSelectedViaDragHandle,{decorations:b,activeNode:f,activeDropTargetNode:eo,isDragging:U?.isDragging??T,isMenuOpen:ea,menuTriggerBy:l.toolbarFlagsEnabled||(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)?U?.toggleMenu?.anchorName||x:void 0,menuTriggerByNode:(0,i.editorExperiment)("platform_synced_block",!0)?U?.toggleMenu?.triggerByNode||A:void 0,blockMenuOptions:(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)?{canMoveUp:U?.toggleMenu?.moveUp!==void 0?U?.toggleMenu?.moveUp:k?.canMoveUp,canMoveDown:U?.toggleMenu?.moveDown!==void 0?U?.toggleMenu?.moveDown:k?.canMoveDown,openedViaKeyboard:U?.toggleMenu?.openedViaKeyboard!==void 0?U?.toggleMenu?.openedViaKeyboard:k?.openedViaKeyboard}:void 0,editorHeight:U?.editorHeight??S,editorWidthLeft:U?.editorWidthLeft??E,editorWidthRight:U?.editorWidthRight??v,isResizerResizing:y,isDocSizeLimitEnabled:nd.isDocSizeLimitEnabled,isPMDragging:U?.isPMDragging??I,multiSelectDnD:_,isShiftDown:U?.isShiftDown??P,lastDragCancelled:U?.lastDragCancelled??N,isSelectedViaDragHandle:g}},nm=(e,t,o)=>{let n,s,{formatMessage:l}=t(),d=(0,i.editorExperiment)("advanced_layouts",!0,{exposure:!0}),p=(0,i.editorExperiment)("platform_editor_element_drag_and_drop_multiselect",!0,{exposure:!0}),u={isMultiSelectEnabled:p,toolbarFlagsEnabled:(0,r("iHzeA").areToolbarFlagsEnabled)(!!e?.toolbar)};tp()||(n=new tu);let f=null;return new(0,r("1S4f7").SafePlugin)({key:nn,state:{init:()=>nd,apply:(t,a,r,i)=>nu(e,l,t,a,i,u,o,n,s,f)},props:{decorations:t=>{if(!e?.limitedMode?.sharedState.currentState()?.enabled&&!e?.editorDisabled?.sharedState.currentState()?.editorDisabled)return nn.getState(t)?.decorations},handleDOMEvents:{drop(t,o){let{dispatch:n,dragging:a,state:i}=t,s=i.tr,l=nn.getState(i),d=l?.lastDragCancelled;if((l?.isPMDragging||d&&p)&&((0,r("dh538").fg)("platform_editor_ease_of_use_metrics")&&e?.metrics?.commands.startActiveSessionTimer()({tr:s}),n(s.setMeta(nn,{...s.getMeta(nn),isPMDragging:!1,lastDragCancelled:!1}))),l=nn.getState(t.state),!(o.target instanceof HTMLElement)||!l?.activeNode)return!1;let c=a?.slice.content.firstChild;if(d&&p||c?.type.name==="layoutColumn")return o.preventDefault(),!1;let u=o.target?.closest?.(`[${m()}]`);if(!u)return!1;let f=Math.max(t.posAtDOM(u,0)-1,0),g=i.doc.nodeAt(f);return!!(g&&c?.eq(g))&&(o.preventDefault(),!0)},dragenter(t,o){if(!e?.limitedMode?.sharedState.currentState()?.enabled){if(ns(o.target)&&(0,c.expValEquals)("platform_editor_block_controls_perf_optimization","isEnabled",!0)){let n=o.target.closest("[data-prosemirror-node-name]");if(n){let o=n?.getAttribute("data-prosemirror-node-name"),a=t.posAtDOM(n,-1),r=e?.blockControls.sharedState.currentState()?.activeDropTargetNode;(r?.pos!==a||r?.nodeTypeName!==o)&&t.dispatch(t.state.tr.setMeta(nn,{activeDropTargetNode:{pos:a,nodeTypeName:o}}))}}else if(d&&ns(o.target)){let e=o.target.closest('[data-drag-handler-anchor-depth="0"]');if(e){let t=e.getAttribute(m());t&&td.emit(t)}}}},dragstart(t){e?.limitedMode?.sharedState.currentState()?.enabled||((0,r("2T4ch").startMeasure)(na),d&&td.reset(),(0,c.expValEquals)("platform_editor_block_controls_perf_optimization","isEnabled",!0)&&n?.clear(),n?.setEditorView(t),t.dispatch(t.state.tr.setMeta(nn,{...t.state.tr.getMeta(nn),isPMDragging:!0})))},dragend(t){if(e?.limitedMode?.sharedState.currentState()?.enabled)return;let{state:o,dispatch:n}=t;if(nn.getState(o)?.isPMDragging){let t=o.tr;t.setMeta(nn,{...o.tr.getMeta(nn),isPMDragging:!1}),(0,r("dh538").fg)("platform_editor_ease_of_use_metrics")&&e?.metrics?.commands.startActiveSessionTimer()({tr:t}),n(t)}},mouseover:(t,o)=>{if(!e?.limitedMode?.sharedState.currentState()?.enabled&&!((0,r("b7atO").getNodeIdProvider)(t)?.isLimitedMode()&&(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)&&(0,r("dh538").fg)("platform_editor_native_anchor_patch_2")))return o0(t,o,e),!1},mousedown:(t,o)=>{if(!e?.limitedMode?.sharedState.currentState()?.enabled)return(0,i.editorExperiment)("platform_editor_controls","variant1")?oX(e)(t,o):void 0},keydown(t,o){if(!e?.limitedMode?.sharedState.currentState()?.enabled)if(p){if(o.shiftKey&&o.ctrlKey&&!o.repeat&&o6(e,l)(t,o))return o.preventDefault(),!0;if(("Enter"===o.key||" "===o.key)&&o.target instanceof HTMLElement&&(0,i.editorExperiment)("platform_editor_controls","variant1")){let t=null!==o.target.closest((0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)?r("Yqd3z").DRAG_HANDLE_SELECTOR:'[data-editor-block-ctrl-drag-handle="true"]');e?.core.actions.execute(e?.blockControls.commands.setSelectedViaDragHandle(t))}if(("ArrowLeft"===o.key||"ArrowRight"===o.key||"ArrowDown"===o.key||"ArrowUp"===o.key)&&(0,i.editorExperiment)("platform_editor_controls","variant1")){let t=e?.blockControls.sharedState.currentState()?.isMenuOpen&&(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0);e?.blockControls.sharedState.currentState()?.isSelectedViaDragHandle&&!t&&e?.core.actions.execute(e?.blockControls.commands.setSelectedViaDragHandle(!1))}return!o.repeat&&o.shiftKey&&(0,r("dh538").fg)("platform_editor_elements_dnd_shift_click_select")&&t.dispatch(t.state.tr.setMeta(nn,{...t.state.tr.getMeta(nn),isShiftDown:!0})),!1}else{if(o.shiftKey&&o.ctrlKey&&!o.repeat&&o6(e,l)(t,o))return o.preventDefault(),!0;if(("Enter"===o.key||" "===o.key)&&o.target instanceof HTMLElement&&(0,i.editorExperiment)("platform_editor_controls","variant1")){let t=null!==o.target.closest((0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)?r("Yqd3z").DRAG_HANDLE_SELECTOR:'[data-editor-block-ctrl-drag-handle="true"]');e?.core.actions.execute(e?.blockControls.commands.setSelectedViaDragHandle(t))}if(("ArrowLeft"===o.key||"ArrowRight"===o.key||"ArrowDown"===o.key||"ArrowUp"===o.key)&&(0,i.editorExperiment)("platform_editor_controls","variant1")){let t=e?.blockControls.sharedState.currentState()?.isMenuOpen&&(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0);e?.blockControls.sharedState.currentState()?.isSelectedViaDragHandle&&!t&&e?.core.actions.execute(e?.blockControls.commands.setSelectedViaDragHandle(!1))}}},keyup(t,o){!e?.limitedMode?.sharedState.currentState()?.enabled&&(o.repeat||"Shift"!==o.key||t.dispatch(t.state.tr.setMeta(nn,{...t.state.tr.getMeta(nn),isShiftDown:!1})))},blur(t,o){if(!e?.limitedMode?.sharedState.currentState()?.enabled&&(0,i.editorExperiment)("platform_editor_controls","variant1"))return!(o.relatedTarget instanceof HTMLElement&&null!==o.relatedTarget.closest(`#${r("f9zLy").EDIT_AREA_ID}`)||t.hasFocus())&&(e?.core?.actions.execute(({tr:e})=>{let t=e.getMeta(nn);return e.setMeta(nn,{...t,editorBlurred:!0}),e}),!1)}}},view:t=>{let o=t.dom,n=t.dom.closest(".fabric-editor-popup-scroll-parent");s=new ResizeObserver((0,r("2P8Ax").default)(e=>{let n=nn.getState(t.state);if(!n?.isDragging){let a=!!o.querySelector(".is-resizing"),r=t.state.tr;if(n?.isResizerResizing!==a&&r.setMeta("is-resizer-resizing",a),!a){let t=e[0].target,o=t.getBoundingClientRect().right,n=t.getBoundingClientRect().left;r.setMeta(nn,{...r.getMeta(nn),editorWidthLeft:n,editorWidthRight:o})}t.dispatch(r)}}));let a=!((0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)&&(0,r("dh538").fg)("platform_editor_native_anchor_patch_1"))||!tp();return n&&a&&s.observe(n),f=nl(e,t),{destroy(){n&&s.unobserve(n),f?.()}}}})},nf=e=>e.getMeta(nn),ng=(e,t)=>1===e.childCount&&e.firstChild?.type.name===t,nh=(e,t)=>{for(let o=0;o<e.childCount;o++)if(e.child(o).type.name===t)return!0;return!1},nb=(e,t,o,n)=>{let a=Z[n];return a&&t.content.forEach((t,n)=>{"layoutColumn"===t.type.name&&e.setNodeAttribute(o+n+1,"width",a)}),{newColumnWidth:a,tr:e}},ny=(e,t,o)=>{let n=t.nodeAfter,a=n?.type.name==="layoutColumn",l=t.pos+(n?.nodeSize||1);if((0,i.editorExperiment)("platform_editor_element_drag_and_drop_multiselect",!0)&&(a=ng(n=e.doc.slice(t.pos,o).content,"layoutColumn"),l=void 0===o?t.pos+n.size:o),!n)return e;if(a&&!(0,i.editorExperiment)("single_column_layouts",!0)){let o=t.parent;if(2===o.childCount){if(e.delete(t.pos+1,l-1),2===o.childCount){let o=0===t.parentOffset?r("5SAOw").Fragment.from(t.parent.lastChild?.content):r("5SAOw").Fragment.from(t.parent.firstChild?.content),n=(0,s.findParentNodeClosestToPos)(t,e=>"layoutSection"===e.type.name);if(n&&o){let t=e.mapping.map(n.pos),a=e.doc.resolve(t).nodeAfter?.nodeSize||0;e.replaceWith(t,t+a,o)}}return e}nb(e,t.parent,t.before(t.depth),o.childCount-1)}return e.delete(t.pos,l),e},n_=({selection:e,schema:t,resolve:o})=>{let n=-1;return e.empty&&(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)&&(n=e.$from.pos),(0,r("iYC9s").isTableSelected)(e)?n=(0,r("id9O1").findTable)(e)?.pos??n:e instanceof r("ks2lK").NodeSelection&&e.node.type===t.nodes.media&&"file"===e.node.attrs.type&&(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)?n=e.$from.pos-1:e instanceof r("adhil").GapCursorSelection||(n=e.$from.before(1),e.$from.depth>0&&(n=o1({selection:e,schema:t,resolve:o}))),n},nS=(e,t)=>{let o=e.index(),n=e.depth>1&&0===o?e.node(e.depth):e.nodeBefore;return n?.type.name==="layoutColumn"&&(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)?-1:n?t-n.nodeSize:-1},nE=({$currentNodePos:e,nodeAfterPos:t,tr:o})=>{if(t>e.end())return -1;let n=o.doc.nodeAt(t);if((0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)){let a=o.doc.nodeAt(e.pos);if(a?.content.size===0&&"extension"!==a.type.name&&n?.content.size===0&&"extension"!==n.type.name)return t}return n?t+n.nodeSize:-1},nv=({currentNodePos:e,moveToPos:t,tr:o})=>t>-1&&o.doc.resolve(e).depth===o.doc.resolve(t).depth,nT=e=>{let t=n_({selection:e.selection,schema:e.doc.type.schema,resolve:e.doc.resolve.bind(e.doc)});if(t<=-1)return{moveUp:!1,moveDown:!1};let o=e.doc.resolve(t),n=o.posAtIndex(o.index()+1),a=nS(o,t),r=nE({$currentNodePos:o,nodeAfterPos:n,tr:e});return{moveUp:nv({currentNodePos:t,moveToPos:a,tr:e}),moveDown:nv({currentNodePos:t,moveToPos:r,tr:e})}},nC=["tableCell","tableHeader","panel","expand","nestedExpand"],nx=(e,t)=>{let o=0===t.depth,n=nC.includes(t.parent.type.name);return e.nodeAfter?.type.name==="layoutColumn"&&"layoutSection"===e.parent.type.name&&(n||o)},nA=e=>{let{selection:t}=e,o=-1,n=nk(e);return n?o=n.pos:(0,r("bMyNT").isInTable)(e)?(0,r("iYC9s").isTableSelected)(t)&&(o=(0,r("id9O1").findTable)(t)?.pos??o):e.selection instanceof r("adhil").GapCursorSelection||(o=t.$from.before(1),t.$from.depth>0&&(o=o1({selection:t,schema:e.schema,resolve:e.doc.resolve.bind(e.doc)}))),o},nk=e=>{let{activeNode:t}=nn.getState(e)||{};return t&&t.handleOptions?.isFocused?t:void 0},nI=(e,t,o)=>n=>{let a,{selection:l}=n,d=!!(0,s.findParentNodeOfType)([n.schema.nodes.layoutSection])(n.selection),c=(0,i.editorExperiment)("platform_editor_element_drag_and_drop_multiselect",!0),p=(0,r("l6okE").expandSelectionBounds)(l.$anchor,l.$head),u=p.$anchor.pos,m=p.$head.pos,f=Math.min(u,m);d&&(a=n.doc.resolve(f).before(3));let g=!c||nk(n)||l.empty?nA(n):a??f;if(g>-1){let a=n.doc.resolve(g),s=c&&!nk(n)?Math.max(u,m):a.posAtIndex(a.index()+1),p=0===a.depth,f=-1,h=l instanceof r("ks2lK").NodeSelection&&"layoutColumn"===l.node.type.name;if(t===r("ah4M9").DIRECTION.LEFT)if(p&&(0,i.editorExperiment)("advanced_layouts",!0)){let t=a.nodeBefore;return t&&(f=g-t.nodeSize),!(f<0)&&(e?.core?.actions.execute(({tr:t})=>{e?.blockControls?.commands?.moveToLayout(g,f,{moveToEnd:!0,moveNodeAtCursorPos:!0})({tr:t});let o=tb(t);return ty(t,o?.from,!0),t}),e?.core?.actions.focus(),!0)}else{if(h)return f=l.from-(a.nodeBefore?.nodeSize||1),e?.core?.actions.execute(e?.blockControls?.commands?.moveToLayout(g,f,{selectMovedNode:!0})),!0;if(a.depth<2||!d)return!1;let t=a.index(a.depth-1),o=a.node(a.depth-1),n=o?o.maybeChild(t-1):null;f=a.start()-(n?.nodeSize||1)}else if(t===r("ah4M9").DIRECTION.RIGHT)if(p&&(0,i.editorExperiment)("advanced_layouts",!0)){let t=a.end();return!((f=a.posAtIndex(a.index()+1))>=t)&&(e?.core?.actions.execute(({tr:t})=>{e?.blockControls?.commands?.moveToLayout(g,f,{moveNodeAtCursorPos:!0})({tr:t});let o=tb(t);return ty(t,o?.from),t}),e?.core?.actions.focus(),!0)}else if(h){let t=a.index(a.depth),o=a.node(a.depth),n=o?o.maybeChild(t+1):null;if(t>=o.childCount-1)return!0;let r=t===o.childCount-2;return f=r?a.before():l.to+(n?.nodeSize||1),e?.core?.actions.execute(e?.blockControls?.commands?.moveToLayout(g,f,{moveToEnd:r,selectMovedNode:!0})),!0}else{if(a.depth<2||!d)return!1;f=a.after(a.depth)+1}else if(t===r("ah4M9").DIRECTION.UP)f=h?a.start()-1:nS(a,g);else{if(s>a.end())return!1;f=h?n.selection.$from.end()+1:nE({$currentNodePos:a,nodeAfterPos:s,tr:n.tr})}let b=n.doc.nodeAt(g)?.type.name,y=!1;if(f>-1){let e=a.depth===n.doc.resolve(f).depth,t="layoutColumn"===b;y=e||t}let{$anchor:_,$head:S}=(0,r("l6okE").expandSelectionBounds)(a,l.$to);if(y)return e?.core?.actions.execute(({tr:t})=>(e?.blockControls.commands.setMultiSelectPositions(_.pos,S.pos)({tr:t}),nP(e)(g,f,r("d925B").INPUT_METHOD.SHORTCUT,o)({tr:t}),t.scrollIntoView(),t)),!0;if(b&&!c)return e?.core?.actions.execute(({tr:t})=>(em(t,g,b,e),t.scrollIntoView(),t)),!0;if(c)return e?.core?.actions.execute(({tr:t})=>(e?.blockControls.commands.setMultiSelectPositions(_.pos,S.pos)({tr:t}),t.scrollIntoView(),t)),!0}return!1},nP=e=>(t,o,n=r("d925B").INPUT_METHOD.DRAG_AND_DROP,l)=>({tr:d})=>{let c,p,u;if(!e||t<0||o<0)return d;let m=d.doc.nodeAt(t);if(!m)return d;let f=t,g=(0,i.editorExperiment)("platform_editor_element_drag_and_drop_multiselect",!0);(0,r("dh538").fg)("platform_editor_ease_of_use_metrics")&&e?.metrics?.commands.setContentMoved()({tr:d});let h=(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)?e?.blockControls.sharedState.currentState()?.preservedSelection:void 0;if(h){let e=d.doc.resolve(Math.min(t,h.from)).blockRange(h.$to),o=U(d,f=e?e.start:h.from,c=e?e.end:h.to);u=o.hasSelectedMultipleNodes,p=o.nodeTypes}else if(g){let o=eS(t,d,e),n=U(d,f=o.from,c=o.to);u=n.hasSelectedMultipleNodes,p=n.nodeTypes}else c=f+(m?.nodeSize??1);let{expand:b,nestedExpand:y}=d.doc.type.schema.nodes,_=d.doc.resolve(o),S=d.doc.resolve(t),E=d.doc.slice(f,c,!1),v=_.node(),T=v.type,C=_.node(_.depth),x=S.nodeAfter;if(x&&nx(S,_)){let e,t=x.content;if(["tableCell","tableHeader"].includes(_.parent.type.name)){if(!(e=(0,s.findChildrenByType)(x,b).length>0?t5(r("5SAOw").Fragment.from(t)):r("5SAOw").Fragment.from(t)))return d}else e=r("5SAOw").Fragment.from(t);ny(d,S,S.pos+x.nodeSize);let n=d.mapping.map(o);return d.insert(n,e).setSelection(r("ks2lK").Selection.near(d.doc.resolve(n))).scrollIntoView(),d}if(!t8(C,_.index(),S.node().child(S.index()),_))return d;let A=function(e,t){let o=e.content.firstChild,n=o?.type.schema;if(!n)return e;let{doc:a,layoutColumn:i}=n.nodes,s=tX(t),l=[a,i].includes(t);if(!s&&!l)return e;let d=!1,c=!1;for(let t=0;t<e.content.childCount;t++){let o=e.content.child(t);if(o.type===n.nodes.expand?d=!0:o.type===n.nodes.nestedExpand&&(c=!0),d&&c)break}return d&&s?t4(e):c&&l?(0,r("hcbpx").transformSliceNestedExpandToExpand)(e,n):e}(E,T),k=A?.content;if(!k)return d;if(x?.type.name==="taskList"&&f>0&&(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)&&(f-=1),"bodiedSyncBlock"===v.type.name&&(0,i.editorExperiment)("platform_synced_block",!0)){let e=[];A?.content.forEach(t=>{e.push(t.mark(t.marks.filter(e=>"breakout"!==e.type.name)))}),k=(A=new(0,r("5SAOw").Slice)(r("5SAOw").Fragment.from(e),0,0)).content}d.delete(f,c);let I=d.mapping.map(o),P="doc"!==C.type.name&&1===C.childCount&&(0,r("l9G9n").isEmptyParagraph)(_.nodeAfter);A&&P?d.replace(I,I+1,A):d.insert(I,k);let N=c-f;if(n===r("d925B").INPUT_METHOD.DRAG_AND_DROP)d=ef(d,I,e);else if(h){let e=d.getMeta(nn),t=I-f;d.setMeta(nn,{...e,preservedSelectionMapping:new(0,r("aXG5V").Mapping)([new(0,r("aXG5V").StepMap)([0,0,t])])})}else d=g?e?.blockControls.commands.setMultiSelectPositions(I,I+N)({tr:d})??d:em(d,I,m.type.name,e);let w=d.getMeta(nn);d.setMeta(nn,{...w,nodeMoved:!0}),n===r("d925B").INPUT_METHOD.BLOCK_MENU&&(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)||e?.core.actions.focus();let D=d.doc.resolve(I),O=(0,s.findParentNodeOfTypeClosestToPos)(_,[b,y]);if(O){let e=r("adayn").expandedState.get(O.node),t=(0,s.findParentNodeOfTypeClosestToPos)(D,[b,y]);void 0!==e&&t&&r("adayn").expandedState.set(t.node,e)}(0,i.editorExperiment)("advanced_layouts",!0)?V(d,n,S.depth,m.type.name,D?.depth,D?.parent.type.name,S.sameParent(D),e,p,u):e?.analytics?.actions.attachAnalyticsEvent({eventType:r("d925B").EVENT_TYPE.TRACK,action:r("d925B").ACTION.MOVED,actionSubject:r("d925B").ACTION_SUBJECT.ELEMENT,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.ELEMENT_DRAG_HANDLE,attributes:{nodeDepth:S.depth,nodeType:m.type.name,destinationNodeDepth:D?.depth,destinationNodeType:D?.parent.type.name,inputMethod:n,...g&&{sourceNodeTypes:p,hasSelectedMultipleNodes:u}}})(d);let M=o>f?r("dwl7L").messages.movedDown:r("dwl7L").messages.movedup;return e?.accessibilityUtils?.actions.ariaNotify(l?l(M):M.defaultMessage,{priority:"important"}),d},nN=(e,t,o)=>{let n=t.index(o);return t.indexAfter(o)===n&&n>e?n-1:n},nw=(e,t)=>({tr:o})=>{if(!(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0))return o;let n=e?.blockControls.sharedState.currentState()?.preservedSelection??o.selection,i=n_({selection:n,schema:o.doc.type.schema,resolve:o.doc.resolve.bind(o.doc)}),{$from:s,$to:l}=n,d=o.doc.resolve(i).depth,c=s.index(d),p=o;if(t===r("ah4M9").DIRECTION.UP){if(c>0){let t=s.posAtIndex(c-1,d);p=nP(e)(i,t,r("d925B").INPUT_METHOD.BLOCK_MENU)({tr:o})||o}}else{let t=nN(c,l,d)+2;if(t<=l.node(d).childCount){let n=l.posAtIndex(t,d);p=nP(e)(i,n,r("d925B").INPUT_METHOD.BLOCK_MENU)({tr:o})||o}}let u=eT(n,p);u&&p.setSelection(u);let{moveUp:m,moveDown:f}=nT(p),g={...p.getMeta(nn),toggleMenu:{moveUp:m,moveDown:f}};return p.setMeta(nn,g)},nD=(e,t)=>{if(0===t.length||t.length>tf())return null;let o=Z[t.length];if(!o)return null;let{layoutSection:n,layoutColumn:a}=e.nodes||{};try{let e=r("5SAOw").Fragment.fromArray(t.map(e=>a.createChecked({width:o},e)));return n.createChecked(void 0,e)}catch(e){(0,r("hWRJP").logException)(e,{location:"editor-plugin-block-controls/move-to-layout"})}return null},nO=(e,t,o,n,a,s,l,d,c,p)=>{let u,m,f=t1(l,d),g=-1;if((0,i.editorExperiment)("platform_editor_element_drag_and_drop_multiselect",!0)){if(o instanceof r("5SAOw").Fragment){g=n+o.size;let e=U(s,n,g);m=e.hasSelectedMultipleNodes,u=e.nodeTypes}}else o instanceof r("5SAOw").Node&&(g=n+o.nodeSize);if(-1===g)return s;if(f){s.delete(n,g);let e=s.mapping.map(a);s.insert(e,o),p&&s.setSelection(new(0,r("ks2lK").NodeSelection)(s.doc.resolve(e))).scrollIntoView(),V(s,r("d925B").INPUT_METHOD.DRAG_AND_DROP,l.depth,l.nodeAfter?.type.name||"",1,"layoutSection",!0,c,u,m)}else e.childCount<tf()&&(ny(s,s.doc.resolve(n),g),nM(s,s.mapping.map(a),o),V(s,r("d925B").INPUT_METHOD.DRAG_AND_DROP,l.depth,l.nodeAfter?.type.name||"",1,"layoutSection",!1,c,u,m));return s},nM=(e,t,o)=>{let{layoutColumn:n}=e.doc.type.schema.nodes||{},a=null;try{(0,i.editorExperiment)("platform_editor_element_drag_and_drop_multiselect",!0)?o instanceof r("5SAOw").Fragment&&(a=n.createChecked({width:0},ng(o,"layoutColumn")?o.firstChild?.content:o)):o instanceof r("5SAOw").Node&&(a=n.createChecked({width:0},"layoutColumn"===o.type.name?o.content:o))}catch(e){(0,r("hWRJP").logException)(e,{location:"editor-plugin-block-controls/move-to-layout"})}return a&&e.insert(t,a),e},nR=(e,t,o,n,a)=>{if(t===o)return;let{layoutSection:s,layoutColumn:l,doc:d}=n.doc.type.schema.nodes||{};if(!s||!l)return;let c=n.doc.resolve(o);if(!c.nodeAfter||![d,s].includes(c.parent.type))return;let p=n.doc.resolve(t),u=(0,i.editorExperiment)("platform_editor_element_drag_and_drop_multiselect",!0);if(!p.nodeAfter||p.nodeAfter.type===s)return;let m=p.nodeAfter,f=t,g=t+m.nodeSize;if(u&&!a){let{anchor:o,head:a}=e_(e,t);if(void 0!==o&&void 0!==a){if(f=Math.min(o,a),g=Math.max(o,a),nh(m=n.doc.slice(f,g).content,"layoutSection"))return}else m=r("5SAOw").Fragment.from(p.nodeAfter)}return{toNode:c.nodeAfter,$to:c,sourceContent:m,$sourceFrom:n.doc.resolve(f),sourceTo:g}},nL=(e,t,o)=>{let n=t.nodeAfter,{breakout:a}=e.doc.type.schema.marks||{};return(0,i.editorExperiment)("platform_editor_element_drag_and_drop_multiselect",!0)?(e.doc.nodesBetween(t.pos,o,(t,o,n)=>(!(0,c.expValEquals)("platform_editor_breakout_resizing","isEnabled",!0)||"layoutSection"!==t.type.name)&&(n?.type.name==="doc"&&t.marks.some(e=>e.type===a)&&e.removeNodeMark(o,a),!1)),n=e.doc.slice(t.pos,o).content):a&&t.nodeAfter&&t.nodeAfter.marks.some(e=>e.type===a)&&(e.removeNodeMark(t.pos,a),n=e.doc.resolve(t.pos).nodeAfter),n},nB=(e,t)=>{if((0,i.editorExperiment)("platform_editor_element_drag_and_drop_multiselect",!0)){if(e instanceof r("5SAOw").Node)return e.marks.find(e=>e.type===t)?.attrs.mode;else if(e instanceof r("5SAOw").Fragment){let o;for(let n=0;n<e.childCount;n++){let a=e.child(n).marks.find(e=>e.type===t);if(a){o=a.attrs.mode;break}}return o}}else if(e instanceof r("5SAOw").Node)return e.marks.find(e=>e.type===t)?.attrs.mode},nV=(e,t)=>{let o=e=>e.marks.find(e=>e.type===t),n=e=>e?{breakoutMode:e.attrs.mode,breakoutWidth:e.attrs.width}:null;if((0,i.editorExperiment)("platform_editor_element_drag_and_drop_multiselect",!0)){if(e instanceof r("5SAOw").Node)return n(o(e));else if(e instanceof r("5SAOw").Fragment)for(let t=0;t<e.childCount;t++){let a=o(e.child(t));if(a)return n(a)}}else if(e instanceof r("5SAOw").Node)return n(o(e));return null},nF=e=>(t,o,n)=>({tr:a})=>{let s,l;if(!e)return a;let d=nR(e,t,o,a,n?.moveNodeAtCursorPos);if(!d)return a;let{toNode:p,$to:u,sourceContent:m,$sourceFrom:f,sourceTo:g}=d,{layoutSection:h,layoutColumn:b}=a.doc.type.schema.nodes||{},{breakout:y}=a.doc.type.schema.marks||{};(0,c.expValEquals)("platform_editor_breakout_resizing","isEnabled",!0)?{breakoutMode:s,breakoutWidth:l}=nV(p,y)||nV(m,y)||{}:s=nB(p,y)||nB(m,y);let _=!(f.node().type===h&&(0,i.editorExperiment)("platform_editor_element_drag_and_drop_multiselect",!0)),S=(0,i.editorExperiment)("platform_editor_element_drag_and_drop_multiselect",!0)?a.doc.slice(f.pos,g).content:f.nodeAfter,E=_?nL(a,f,g):S;if(!E)return a;(0,r("dh538").fg)("platform_editor_ease_of_use_metrics")&&e?.metrics?.commands.setContentMoved()({tr:a});let v=(0,i.editorExperiment)("platform_editor_element_drag_and_drop_multiselect",!0);if(p.type===h){let t=n?.moveToEnd?o+p.nodeSize-1:o+1;return nO(p,o,E,f.pos,t,a,f,u,e,n?.selectMovedNode)}if(p.type===b){let t=u.parent,r=o-u.parentOffset-1,i=n?.moveToEnd?o+p.nodeSize:o;return nO(t,r,E,f.pos,i,a,f,u,e,n?.selectMovedNode)}{let t=p;y&&u.nodeAfter&&u.nodeAfter.marks.some(e=>e.type===y)&&(a.removeNodeMark(o,y),t=a.doc.resolve(o).nodeAfter||p),v?ng(E,"layoutColumn")&&E.firstChild&&(E=E.firstChild.content):E instanceof r("5SAOw").Node&&"layoutColumn"===E.type.name&&(E=E.content);let i=n?.moveToEnd?[t,E]:[E,t],d=nD(a.doc.type.schema,i);if(d){let n,i;if(v){let e=U(a,f.pos,g);i=e.hasSelectedMultipleNodes,n=e.nodeTypes}let p=(a=ny(a,f,g)).mapping.map(o);a.delete(p,p+t.nodeSize).insert(p,d),(0,c.expValEquals)("platform_editor_breakout_resizing","isEnabled",!0)?s&&a.setNodeMarkup(p,d.type,d.attrs,[y.create({mode:s,width:l})]):s&&a.setNodeMarkup(p,d.type,d.attrs,[y.create({mode:s})]),(0,r("dh538").fg)("platform_editor_column_count_analytics")?F(a,e,n,i,2):F(a,e,n,i)}return a}},nU=new(0,r("ks2lK").PluginKey)("firstNodeDec"),nG=e=>{let t=e.doc.firstChild;if(!t)return r("ftzrq").DecorationSet.empty;let o=(0,c.expValEquals)("platform_editor_breakout_resizing","isEnabled",!0)?r("ftzrq").Decoration.node(0,t.nodeSize,{style:"margin-top: 0;",class:"first-node-in-document"}):r("ftzrq").Decoration.node(0,t.nodeSize,{style:"margin-top: 0"});return r("ftzrq").DecorationSet.create(e.doc,[o])},nq=()=>new(0,r("1S4f7").SafePlugin)({key:nU,state:{init:(e,t)=>nG(t),apply:(e,t,o,n)=>e.docChanged&&e.steps.some(e=>e instanceof r("aXG5V").ReplaceStep||e instanceof r("aXG5V").ReplaceAroundStep)?nG(n):t},props:{decorations:e=>nU.getState(e)}}),nH=e=>{e.dispatch(e.state.tr.setMeta(nJ,{type:"stopEditing"}))},nj=e=>{e.dispatch(e.state.tr.setMeta(nJ,{type:"startEditing"}))},n$=e=>{e.dispatch(e.state.tr.setMeta(nJ,{type:"mouseLeave"}))},nK=e=>{e.dispatch(e.state.tr.setMeta(nJ,{type:"mouseEnter"}))},nz=(e,t)=>{if(t.ctrlKey||t.metaKey||t.altKey||1!==t.key.length&&"Backspace"!==t.key&&"Delete"!==t.key&&" "!==t.key&&"Enter"!==t.key)return!1;let o=nZ(e.state);return o?.isEditing||nj(e),!1},nW=e=>{let t=nZ(e.state);return t?.isEditing&&nH(e),!1},nY=e=>(n$(e),!1),nX=e=>(nK(e),!1),nJ=new(0,r("ks2lK").PluginKey)("interactionTrackingPlugin"),nQ=()=>new(0,r("1S4f7").SafePlugin)({key:nJ,state:{init(){let e={isEditing:!1};return(0,i.editorExperiment)("platform_editor_controls","variant1")&&(e.isMouseOut=!1),e},apply(e,t){let o=e.getMeta(nJ),n={};switch(o?.type){case"startEditing":n.isEditing=!0;break;case"stopEditing":n.isEditing=!1;break;case"mouseLeave":n.isMouseOut=!0;break;case"mouseEnter":n.isMouseOut=!1}return{...t,...n}}},props:{handleKeyDown:nz,handleDOMEvents:{mousemove:nW}},view:(0,i.editorExperiment)("platform_editor_controls","variant1")?e=>{let t,o,n=e.dom.closest(".ak-editor-content-area");return n&&(t=(0,r("fFa3V").bind)(n,{type:"mouseenter",listener:()=>{nX(e)}}),o=(0,r("fFa3V").bind)(n,{type:"mouseleave",listener:()=>{nY(e)}})),{destroy:()=>{t?.(),o?.()}}}:void 0}),nZ=e=>nJ.getState(e),n0=({tr:e})=>e.setMeta(B,{type:"startPreserving"}),n1=({tr:e})=>e.setMeta(B,{type:"stopPreserving"}),n2=e=>e.some(e=>e.getMeta("pointer")&&e.selectionSet),n5=e=>e.getMeta(B),n4=e=>()=>new(0,r("1S4f7").SafePlugin)({key:B,state:{init:()=>({preservedSelection:void 0}),apply(e,t){let o=n5(e),n={...t};return o?.type==="startPreserving"?n.preservedSelection=eT(e.selection,e):o?.type==="stopPreserving"&&(n.preservedSelection=void 0),n.preservedSelection&&e.docChanged&&(n.preservedSelection=eT(n.preservedSelection,e)),n}},appendTransaction(e,t,o){let n=B.getState(o),a=n?.preservedSelection;if(!a)return null;if(n2(e))return n1({tr:o.tr});let i=o.selection,s=i.from===a.from&&i.to===a.to,l=a.from<0||a.to>o.doc.content.size;if(s||l)return null;try{return o.tr.setSelection(a)}catch(e){(0,r("hWRJP").logException)(e,{location:"editor-plugin-block-controls/SelectionPreservationPlugin"})}return null},props:{handleClick:(e,t,o)=>{let{preservedSelection:n}=B.getState(e.state)||{};if(!n||!(o.target instanceof HTMLElement&&o.target.closest(r("Yqd3z").DRAG_HANDLE_SELECTOR)))return!1;let a=e.state.tr;return n1({tr:a}),e.dispatch(a),!1},handleKeyDown:(t,o)=>{let{preservedSelection:n}=B.getState(t.state)||{};if(!n)return!1;if("Backspace"===o.key||"Delete"===o.key)return!0;if(e?.userIntent?.sharedState.currentState()?.currentUserIntent!=="blockMenuOpen"){let e=t.state.tr;return n1({tr:e}),t.dispatch(e),!1}}}}),n9='[data-drag-handler-anchor-name]:not([data-drag-handler-node-type="tableRow"], [data-drag-handler-node-type="media"])',n3=`[${p}]:not([data-prosemirror-node-name="tableRow"], [data-prosemirror-node-name="tableCell"],  [data-prosemirror-node-name="tableHeader"], [data-prosemirror-node-name="media"], [data-prosemirror-node-inline="true"])`,n8=()=>(0,i.editorExperiment)("platform_editor_controls","variant1")?`${(0,r("aFUXX").akEditorGutterPaddingDynamic)()}px`:"100%",n6=()=>(0,i.editorExperiment)("platform_editor_controls","variant1")?`-${(0,r("aFUXX").akEditorGutterPaddingDynamic)()}px`:"-100px",n7=()=>(0,r("9K4OG").css)({[`.block-ctrl-drag-preview ${n9}::after`]:{display:"none !important"},".ProseMirror":{[`&& ${n9}::after`]:{content:'""',position:"absolute",top:0,left:`-${q}px`,width:`${q}px`,height:"100%",cursor:"default",zIndex:1},[`&& [data-drag-handler-anchor-depth="0"]${n9}::after`]:{content:'""',position:"absolute",top:0,left:n6(),width:n8(),height:"100%",cursor:"default",zIndex:-1},[`&& :is(.pm-table-cell-content-wrap, .pm-table-header-content-wrap) > ${n9}::after`]:{content:'""',position:"absolute",top:0,left:0,width:0,height:"100%",cursor:"default",zIndex:1},"&& [data-drag-handler-anchor-name][data-layout-column]::after":{content:'""',position:"absolute",top:`${-r("Yqd3z").DRAG_HANDLE_WIDTH/2}px`,left:0,width:"100%",height:`${r("Yqd3z").DRAG_HANDLE_WIDTH}px`,cursor:"default",zIndex:1}},"hr[data-drag-handler-anchor-name]":{overflow:"visible"},'[data-blocks-drag-handle-container="true"] + [data-drag-handler-anchor-depth="0"]::after':{display:"none"}}),ae=()=>(0,r("9K4OG").css)({[`.block-ctrl-drag-preview ${n3}::after`]:{display:"none !important"},".ProseMirror":{[`&& ${n3}::after`]:{content:'""',position:"absolute",top:0,left:`-${q}px`,width:`${q}px`,height:"100%",cursor:"default",zIndex:1},[`&& ${n3}:not([${p}] [${p}])::after`]:{content:'""',position:"absolute",top:0,left:n6(),width:n8(),height:"100%",cursor:"default",zIndex:-1},[`&& :is(.pm-table-cell-content-wrap, .pm-table-header-content-wrap) > ${n3}::after`]:{content:'""',position:"absolute",top:0,left:0,width:0,height:"100%",cursor:"default",zIndex:1}},"hr[data-drag-handler-anchor-name]":{overflow:"visible"},[`[data-blocks-drag-handle-container="true"] + ${n3}:not([${p}] [${p}])::after`]:{display:"none"}}),at=(0,r("9K4OG").css)({".ProseMirror":{[`&&& ${n3}[data-layout-column]::after`]:{content:'""',position:"absolute",top:`${-r("Yqd3z").DRAG_HANDLE_WIDTH/2}px`,left:0,width:"100%",height:`${r("Yqd3z").DRAG_HANDLE_WIDTH}px`,cursor:"default",zIndex:1}}}),ao=(0,r("9K4OG").css)({".ProseMirror":{[`&&& ${n3}[data-layout-column]::after`]:{display:"none"}}}),an=(0,r("9K4OG").css)({".ProseMirror":{[`&& [data-drag-handler-anchor-depth="0"]${n9}::after`]:{[`@container editor-area (max-width: ${r("aFUXX").akEditorFullPageNarrowBreakout}px)`]:{left:`-${r("aFUXX").akEditorGutterPaddingReduced}px`,width:`${r("aFUXX").akEditorGutterPaddingReduced}px`}}}}),aa=(0,r("9K4OG").css)({".ProseMirror":{[`> ${n3}::after`]:{[`@container editor-area (max-width: ${r("aFUXX").akEditorFullPageNarrowBreakout}px)`]:{left:`-${r("aFUXX").akEditorGutterPaddingReduced}px`,width:`${r("aFUXX").akEditorGutterPaddingReduced}px`}}}}),ar=(0,r("9K4OG").css)({".ProseMirror":{[`&& [data-drag-handler-anchor-depth="0"]${n9}::after`]:{width:"var(--ak-editor-max-container-width)",left:"calc((100% - var(--ak-editor-max-container-width))/2)"}}}),ai=(0,r("9K4OG").css)({".ProseMirror":{[`&& ${n3}:not([${p}] [${p}])::after`]:{width:"var(--ak-editor-max-container-width)",left:"calc((100% - var(--ak-editor-max-container-width))/2)"}}}),as='.ProseMirror-widget[data-blocks-drag-handle-container="true"]',al='button[data-testid="block-ctrl-drag-handle"]',ad='.ProseMirror-widget[data-blocks-drop-target-container="true"]',ac=`${as}:has(+ :is(p, h1, h2, h3, h4, h5, h6) > .ProseMirror-trailingBreak:only-child) ${al}, ${as}:has(+ div.fabric-editor-indentation-mark > :is(p, h1, h2, h3, h4, h5, h6) > .ProseMirror-trailingBreak:only-child) ${al}, ${as}:has(+ p > .placeholder-decoration) ${al}`,ap=`${as}:first-child + .fabric-editor-indentation-mark > p:first-child, ${as}:first-child + .fabric-editor-alignment > p:first-child, ${as}:first-child + ${ad} + .fabric-editor-indentation-mark > p:first-child, ${as}:first-child + ${ad} + .fabric-editor-alignment > p:first-child, ${ad}:first-child + .fabric-editor-alignment > p:first-child, ${ad}:first-child + .fabric-editor-indentation-mark > p:first-child, ${as}:first-child + .fabric-editor-indentation-mark > :is(h1, h2, h3, h4, h5, h6):first-child`,au=(0,r("9K4OG").css)({[ac]:{transform:"scale(0)"}}),am=(0,r("9K4OG").css)({'.ProseMirror-widget[data-blocks-drop-target-container="true"]':{"--ak-editor--legacy-breakout-wide-layout-width":`${r("aFUXX").akEditorCalculatedWideLayoutWidthSmallViewport}px`,"@media (width>=1280px)":{"--ak-editor--legacy-breakout-wide-layout-width":`${r("aFUXX").akEditorCalculatedWideLayoutWidth}px`}}}),af={name:"rngdgu",styles:".ProseMirror{[data-layout-content]{user-drag:none;}}"};var ag={name:"6tfzz7",styles:'.ProseMirror-widget:first-child + *:not([data-panel-type], .code-block, [data-node-type="nestedExpand"], [data-node-type="expand"], [data-layout-section="true"], [data-prosemirror-node-name="bodiedSyncBlock"]){margin-top:0 !important;}'};let ah=()=>ag,ab=()=>(0,r("9K4OG").css)({".blocks-quick-insert-button":{backgroundColor:"transparent",top:"var(--top-override,8px)",position:"sticky",boxSizing:"border-box",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"var(--ds-space-300, 24px)",width:"var(--ds-space-300, 24px)",border:"none",borderRadius:"var(--ds-radius-full, 9999px)",zIndex:r("dTk3A").layers.card(),outline:"none",cursor:"pointer",color:"var(--ds-icon-subtle, #505258)"},'[data-blocks-quick-insert-container]:has(~ [data-prosemirror-node-name="table"] .pm-table-with-controls tr.sticky) &':{"--top-override":`${r("1zav4").tableControlsSpacing}px`},'[data-prosemirror-mark-name="breakout"]:has([data-blocks-quick-insert-container]):has(~ [data-prosemirror-node-name="table"] .pm-table-with-controls tr.sticky) &':{"--top-override":`${r("1zav4").tableControlsSpacing}px`},".blocks-quick-insert-button:hover":{backgroundColor:"var(--ds-background-neutral-subtle-hovered, #0515240F)"},".blocks-quick-insert-button:active":{backgroundColor:"var(--ds-background-neutral-subtle-pressed, #0B120E24)"},".blocks-quick-insert-button:focus":{outline:"var(--ds-border-width-focused, 2px) solid var(--ds-border-focused, #388BFF)"},".blocks-quick-insert-visible-container":{transition:"opacity 0.1s ease-in-out, visibility 0.1s ease-in-out",opacity:1,visibility:"visible"},".blocks-quick-insert-invisible-container":{transition:"opacity 0.1s ease-in-out, visibility 0.1s ease-in-out",opacity:0,visibility:"hidden"},".blocks-quick-insert-tooltip":{zIndex:r("dTk3A").layers.tooltip(),borderRadius:"var(--ds-radius-small, 4px)",padding:"var(--ds-space-050, 4px) 0",boxSizing:"border-box",maxWidth:"240px",backgroundColor:"var(--ds-background-neutral-bold, #292A2E)",color:"var(--ds-text-inverse, #FFFFFF)",font:'var(--ds-font-body-UNSAFE_small, normal 400 12px/16px ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Ubuntu, "Helvetica Neue", sans-serif)',insetBlockStart:"var(--ds-space-0, 0px)",insetInlineStart:"var(--ds-space-0, 0px)",overflowWrap:"break-word",paddingBlockEnd:"var(--ds-space-025, 2px)",paddingBlockStart:"var(--ds-space-025, 2px)",paddingInlineEnd:"var(--ds-space-075, 6px)",paddingInlineStart:"var(--ds-space-075, 6px)",wordWrap:"break-word",pointerEvents:"none",userSelect:"none",transition:"opacity .1s ease-in-out, transform .1s ease-in-out, visibility .1s ease-in-out","@media (prefers-reduced-motion: reduce)":{transition:"none"}}}),ay={name:"13jrzwf",styles:'.ProseMirror{> .ProseMirror-widget:first-child + .ProseMirror-gapcursor + *:not([data-layout-section="true"], [data-prosemirror-node-name="bodiedSyncBlock"]), > .ProseMirror-widget:first-child + *:not([data-layout-section="true"], [data-prosemirror-node-name="bodiedSyncBlock"]){margin-top:0 !important;}}'},a_=(0,r("9K4OG").css)({"[data-panel-type].ak-editor-panel__no-icon .ProseMirror-widget:first-child + .ProseMirror-widget:nth-child(2) + hr, [data-panel-type] hr:first-child":{marginTop:"0 !important"}}),aS=(0,r("9K4OG").css)({[`p[data-drag-handler-anchor-name] ${as}`]:{display:"none !important"}}),aE=(0,r("9K4OG").css)({'.ProseMirror.ua-firefox .mediaSingleView-content-wrap[data-drag-handler-node-type="mediaSingle"][data-drag-handler-anchor-name], .ProseMirror.ua-firefox [data-drag-handler-anchor-name][data-drag-handler-node-type] .mediaSingleView-content-wrap':{userSelect:"auto",cursor:"pointer"}}),av=(0,r("9K4OG").css)({[`${ap}`]:{marginTop:"0 !important"}}),aT=(0,r("9K4OG").css)({[`${as}:first-child + .fabric-editor-indentation-mark > :is(h1, h2, h3, h4, h5, h6):first-child`]:{marginTop:"0 !important"}}),aC=(0,r("9K4OG").css)({".ProseMirror":{[`&& ${n9}`]:{position:"relative"},[`&& ${n9}:has(> .ProseMirror-trailingBreak:only-child)::before`]:{content:`"${r("TfRUG").ZERO_WIDTH_SPACE}"`}}}),ax=(0,r("9K4OG").css)({".ProseMirror":{[`&& ${n3}`]:{position:"relative"},[`&& ${n3}:has(> .ProseMirror-trailingBreak:only-child)::before`]:{content:`"${r("TfRUG").ZERO_WIDTH_SPACE}"`}}}),aA={name:"okzdt4",styles:'.ProseMirror{&& [data-drag-handler-anchor-depth="0"][data-drag-handler-anchor-name]{z-index:1;}}'},ak=(0,r("9K4OG").css)({".ProseMirror":{[`&& [${p}]:not([${p}] [${p}])`]:{zIndex:1}}}),aI=(0,r("9K4OG").css)({'.ak-editor-content-area.fabric-editor--full-width-mode .ProseMirror .ProseMirror-widget[data-blocks-drop-target-container="true"]':{"--ak-editor-block-card-width":`min(calc(100cqw - ${r("aFUXX").akEditorBreakoutPadding}px), 1800px)`},'.ak-editor-content-area .ProseMirror .ProseMirror-widget[data-blocks-drop-target-container="true"]':{"--ak-editor-block-card-width":"max(var(--ak-editor--legacy-breakout-wide-layout-width), var(--ak-editor--line-length))"}}),aP="&[data-node-anchor], &:not([data-node-anchor]) [data-node-anchor]:first-of-type, &.ProseMirror-widget + [data-node-anchor], &.ProseMirror-widget + :not([data-node-anchor]) [data-node-anchor]:first-of-type",aN=(0,r("9K4OG").css)({".ProseMirror":{'[data-testid="block-ctrl-decorator-widget"] + *':{[`${aP}`]:{anchorName:`var(${r("04H9b").ANCHOR_VARIABLE_NAME}, attr(data-node-anchor type(<custom-ident>)))`}},'[data-testid="block-ctrl-quick-insert-button"] + *':{[`${aP}`]:{anchorName:`var(${r("04H9b").ANCHOR_VARIABLE_NAME}, attr(data-node-anchor type(<custom-ident>)))`}}}}),aw=(0,r("9K4OG").css)({".ProseMirror":{"[data-node-anchor]:not([data-node-anchor] [data-node-anchor])":{anchorName:`var(${r("04H9b").ANCHOR_VARIABLE_NAME}, attr(data-node-anchor type(<custom-ident>)))`},"[data-node-anchor]:has([data-blocks-drop-target-container]) [data-node-anchor]":{anchorName:`var(${r("04H9b").ANCHOR_VARIABLE_NAME}, attr(data-node-anchor type(<custom-ident>)))`},'[data-prosemirror-node-name="media"][data-node-anchor]':{anchorName:`var(${r("04H9b").ANCHOR_VARIABLE_NAME}, attr(data-node-anchor type(<custom-ident>)))`},'[data-prosemirror-node-name="table"] [data-prosemirror-node-name="tableRow"][data-node-anchor]:first-of-type':{anchorName:`var(${r("04H9b").ANCHOR_VARIABLE_NAME}, attr(data-node-anchor type(<custom-ident>)))`}}}),aD=({api:e})=>{let t=(0,r("b3YrF").useSharedPluginStateSelector)(e,"blockControls.isDragging",{disabled:!(0,c.expValEquals)("platform_editor_block_controls_perf_optimization","isEnabled",!0)}),o=(0,r("04H9b").isCSSAnchorSupported)()&&(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0),n=(0,r("iHzeA").areToolbarFlagsEnabled)(!!e?.toolbar);return(0,r("9K4OG").jsx)(r("9K4OG").Global,{styles:[ah(),af,(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)?ae():n7(),t&&((0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)?ai:ar),(0,i.editorExperiment)("platform_editor_preview_panel_responsiveness",!0,{exposure:!0})?(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)?aa:an:void 0,n?void 0:au,(0,i.editorExperiment)("platform_editor_block_control_optimise_render",!0)?ab:void 0,aS,aE,am,aT,(0,i.editorExperiment)("advanced_layouts",!0)?aI:void 0,a_,av,(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)?ax:aC,ay,(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)?ak:aA,(0,c.expValEquals)("platform_editor_native_anchor_with_dnd","isEnabled",!0)&&(0,c.expValEquals)("advanced_layouts","isEnabled",!0)?at:ao,o&&(t?aw:aN)]})};e.exports.blockControlsPlugin=({api:e})=>({name:"blockControls",pmPlugins(){let t=[{name:"blockControlsPmPlugin",plugin:({getIntl:t,nodeViewPortalProviderAPI:o})=>nm(e,t,o)}];return(0,i.editorExperiment)("platform_editor_controls","variant1")&&t.push({name:"blockControlsInteractionTrackingPlugin",plugin:nQ}),(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)&&t.push({name:"blockControlsSelectionPreservationPlugin",plugin:n4(e)}),(0,r("iHzeA").areToolbarFlagsEnabled)(!!e?.toolbar)&&t.push({name:"firstNodeDec",plugin:nq}),t},commands:{moveNode:nP(e),moveToLayout:nF(e),showDragHandleAt:(e,t,o,n,a,r,i)=>({tr:s})=>{let l=s.getMeta(nn);return s.setMeta(nn,{...l,activeNode:{pos:e,anchorName:t,nodeType:o,handleOptions:n,rootPos:a,rootAnchorName:r,rootNodeType:i}}),s},toggleBlockMenu:t=>({tr:o})=>{if(!(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0))return o;let n=o.getMeta(nn),i=e?.userIntent?.sharedState.currentState()?.currentUserIntent;if(t?.closeMenu)return o.setMeta(nn,{...n,closeMenu:!0}),"blockMenuOpen"===i&&e?.userIntent?.commands.setCurrentUserIntent("default")({tr:o}),n1({tr:o}),o;if(t?.anchorName?.includes("layoutColumn"))return"blockMenuOpen"===i&&e?.userIntent?.commands.setCurrentUserIntent("default")({tr:o}),o.setMeta(nn,{...n,closeMenu:!0}),o;let s={anchorName:t?.anchorName,triggerByNode:t?.triggerByNode},l=e?.blockControls?.sharedState.currentState()?.menuTriggerBy;if(t?.anchorName){let{moveUp:e,moveDown:n}=nT(o);s={...s,moveUp:e,moveDown:n,openedViaKeyboard:t?.openedViaKeyboard}}if(o.setMeta(nn,{...n,toggleMenu:s}),(void 0===l||l&&l===t?.anchorName)&&"blockMenuOpen"===i){let t=e?.blockControls.sharedState.currentState();t?.isSelectedViaDragHandle&&(0,r("dh538").fg)("platform_editor_toolbar_aifc_user_intent_fix")?e?.userIntent?.commands.setCurrentUserIntent("dragHandleSelected")({tr:o}):e?.userIntent?.commands.setCurrentUserIntent("default")({tr:o})}return o},setNodeDragged:(t,o,n)=>({tr:a})=>{let i=t();if(void 0===i)return a;let s=a.getMeta(nn);return a.setMeta(nn,{...s,isDragging:!0,activeNode:{pos:i,anchorName:o,nodeType:n}}),(0,r("dh538").fg)("platform_editor_ease_of_use_metrics")&&e?.metrics?.commands.handleIntentToStartEdit({shouldStartTimer:!1,shouldPersistActiveSession:!0})({tr:a}),e?.userIntent?.commands.setCurrentUserIntent("dragging")({tr:a}),a},setMultiSelectPositions:(t,o)=>({tr:n})=>{let a,i,s,{anchor:l,head:d}=n.selection;if(void 0!==t&&void 0!==o)a=n.doc.resolve(t),i=n.doc.resolve(o);else{let e=(0,r("l6okE").expandSelectionBounds)(n.selection.$anchor,n.selection.$head);a=e.$anchor,i=e.$head}e?.selection?.commands.setManualSelection(a.pos,i.pos)({tr:n});let c=a.min(i),p=a.max(i);c.nodeAfter===p.nodeBefore?(em(n,c.pos,a.node().type.name,e),s=n.selection):(s=p.nodeBefore?.type.name==="mediaSingle"||c.nodeAfter?.type.name==="mediaSingle"?new(0,r("ks2lK").TextSelection)(a,i):r("ks2lK").TextSelection.between(a,i),n.setSelection(s));let u={anchor:a.pos,head:i.pos,textAnchor:s.anchor,textHead:s.head,userAnchor:l,userHead:d},m=n.getMeta(nn);return n.setMeta(nn,{...m,multiSelectDnD:u}),n},setSelectedViaDragHandle:e=>({tr:t})=>{let o=t.getMeta(nn);return t.setMeta(nn,{...o,isSelectedViaDragHandle:e})},moveNodeWithBlockMenu:t=>nw(e,t),startPreservingSelection:()=>n0,stopPreservingSelection:()=>n1},getSharedState(e){if(!e)return;let t={isMenuOpen:nn.getState(e)?.isMenuOpen??!1,menuTriggerBy:nn.getState(e)?.menuTriggerBy??void 0,menuTriggerByNode:nn.getState(e)?.menuTriggerByNode??void 0,blockMenuOptions:nn.getState(e)?.blockMenuOptions??void 0,activeNode:nn.getState(e)?.activeNode??void 0,activeDropTargetNode:nn.getState(e)?.activeDropTargetNode??void 0,isDragging:nn.getState(e)?.isDragging??!1,isPMDragging:nn.getState(e)?.isPMDragging??!1,multiSelectDnD:nn.getState(e)?.multiSelectDnD??void 0,isShiftDown:nn.getState(e)?.isShiftDown??void 0,lastDragCancelled:nn.getState(e)?.lastDragCancelled??!1,isEditing:nJ.getState(e)?.isEditing,isSelectedViaDragHandle:nn.getState(e)?.isSelectedViaDragHandle??!1};return(0,i.editorExperiment)("platform_editor_controls","variant1")&&(t.isMouseOut=nJ.getState(e)?.isMouseOut??!1),(0,a.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)&&(t.preservedSelection=B.getState(e)?.preservedSelection),t},contentComponent:()=>(0,n.jsx)(aD,{api:e})})}),i("Yqd3z",function(e,t){e.exports.DRAG_HANDLE_SELECTOR="[data-editor-block-ctrl-drag-handle]",e.exports.DRAG_HANDLE_WIDTH=12}),i("5y9PZ",function(e,t){var o=r("42omo");let n=new(0,r("ks2lK").PluginKey)("offlineMode"),a=()=>new(0,r("1S4f7").SafePlugin)({key:n,state:{init:()=>({browserState:"online",externalState:void 0}),apply:(e,t)=>{let o=e.getMeta(n);if(o){let{externalState:e,browserState:n}=o;return{browserState:n??t?.browserState,externalState:null===e?void 0:e??t?.externalState}}return t}}});e.exports.connectivityPlugin=()=>{let e;return{name:"connectivity",getSharedState(e){if(!e)return{mode:"online"};let t=n.getState(e);return{mode:t?.externalState??t?.browserState??"online"}},commands:{setMode:t=>({tr:o})=>t===e?null:(e=t,o.setMeta(n,{externalState:t}))},pmPlugins:()=>[{name:"connectivity",plugin:a}],usePluginHook:({editorView:e})=>{(0,o.useEffect)(()=>{let t=t=>{let{dispatch:o,state:{tr:a}}=e;o(a.setMeta(n,{browserState:t}))};!1===window.navigator.onLine&&t("offline");let o=(0,r("fFa3V").bind)(window,{type:"online",listener:()=>t("online")}),a=(0,r("fFa3V").bind)(window,{type:"offline",listener:()=>t("offline")});return()=>{o(),a()}},[e])}}}}),i("3mcWz",function(e,t){let o=new(0,r("ks2lK").PluginKey)("editorViewMode"),n=({initialMode:e})=>new(0,r("1S4f7").SafePlugin)({key:o,state:{init:()=>({mode:e??"edit"}),apply:(e,t)=>{let n=e.getMeta(o);return n||t}},props:{editable:e=>"view"!==o.getState(e)?.mode&&void 0}});e.exports.editorViewModePlugin=({config:e,api:t})=>({name:"editorViewMode",getSharedState:t=>t?{mode:o.getState(t)?.mode??"edit"}:{mode:e?.mode==="view"?"view":"edit"},commands:{updateViewMode:e=>({tr:t})=>t.setMeta(o,{mode:e})},pmPlugins:()=>[{name:"editorViewMode",plugin:()=>n({initialMode:e?.mode})}]})}),i("8ABVP",function(e,t){let o=new(0,r("ks2lK").PluginKey)("engagementPlatformPmPlugin"),n=e=>({tr:t})=>{let n=t.getMeta(o)??{commands:[]},a={...n,commands:[...n.commands,e]};return t.setMeta(o,a)},a=e=>new(0,r("1S4f7").SafePlugin)({key:o,state:{init:()=>({messageStates:{},startMessagePromises:{},stopMessagePromises:{},epComponents:e.epComponents,epHooks:e.epHooks,coordinationClient:e.coordinationClient}),apply:(e,t)=>{let n=e.getMeta(o);if(!n)return t;let a={...t};for(let e of n.commands)switch(e.type){case"setMessageState":a={...a,messageStates:{...a.messageStates,[e.messageId]:e.state}};break;case"setStartMessagePromise":if(void 0!==e.promise)a={...a,startMessagePromises:{...a.startMessagePromises,[e.messageId]:e.promise}};else{let{[e.messageId]:t,...o}=a.startMessagePromises;a={...a,startMessagePromises:o}}break;case"setStopMessagePromise":if(void 0!==e.promise)a={...a,stopMessagePromises:{...a.stopMessagePromises,[e.messageId]:e.promise}};else{let{[e.messageId]:t,...o}=a.stopMessagePromises;a={...a,stopMessagePromises:o}}}return a}}});e.exports.engagementPlatformPlugin=({config:e,api:t})=>{var i,s;return{name:"engagementPlatform",actions:{startMessage:(i=e.coordinationClient,(e,o)=>{if(!t)return Promise.resolve(!1);let a=(t.engagementPlatform.sharedState.currentState()?.messageStates??{})[e];if(void 0!==a)return Promise.resolve(a);let s=(t.engagementPlatform.sharedState.currentState()?.startMessagePromises??{})[e];if(s)return s;let l=i.start(e,o).then(o=>(t.core.actions.execute(n({type:"setMessageState",messageId:e,state:o})),o)).catch(e=>(t?.analytics?.actions.fireAnalyticsEvent({action:r("d925B").ACTION.ERRORED,actionSubject:r("d925B").ACTION_SUBJECT.ENGAGEMENT_PLATFORM,eventType:r("d925B").EVENT_TYPE.OPERATIONAL,attributes:{error:e instanceof Error?e.message:`${e}`,errorStack:e instanceof Error?e.stack:void 0}}),!1)).finally(()=>{t.core.actions.execute(n({type:"setStartMessagePromise",messageId:e,promise:void 0}))});return t.core.actions.execute(n({type:"setStartMessagePromise",messageId:e,promise:l})),l}),stopMessage:(s=e.coordinationClient,e=>{if(!t)return Promise.resolve(!1);if(!1===(t.engagementPlatform.sharedState.currentState()?.messageStates??{})[e])return Promise.resolve(!0);let o=(t.engagementPlatform.sharedState.currentState()?.stopMessagePromises??{})[e];if(o)return o;let a=s.stop(e).then(o=>(o&&t.core.actions.execute(n({type:"setMessageState",messageId:e,state:!1})),o)).catch(e=>(t?.analytics?.actions.fireAnalyticsEvent({action:r("d925B").ACTION.ERRORED,actionSubject:r("d925B").ACTION_SUBJECT.ENGAGEMENT_PLATFORM,eventType:r("d925B").EVENT_TYPE.OPERATIONAL,attributes:{error:e instanceof Error?e.message:`${e}`,errorStack:e instanceof Error?e.stack:void 0}}),!1)).finally(()=>{t.core.actions.execute(n({type:"setStopMessagePromise",messageId:e,promise:void 0}))});return t.core.actions.execute(n({type:"setStopMessagePromise",messageId:e,promise:a})),a})},pmPlugins:()=>[{name:"engagementPlatformPmPlugin",plugin:()=>a(e)}],getSharedState(e){if(e)return o.getState(e)}}}}),i("dH9DB",function(e,t){var o,n=r("dZ8uq");class a{constructor(e){this.timerId=void 0,this.api=void 0,this.startTimer=()=>{this.timerId&&clearTimeout(this.timerId),this.timerId=window.setTimeout(()=>{this.api&&this.api.core.actions.execute(this.api.metrics?.commands.stopActiveSession()),this.cleanupTimer()},5e3)},this.cleanupTimer=()=>{this.timerId&&(clearTimeout(this.timerId),this.timerId=null)},this.timerId=null,this.api=e}}function i(e){let t={};return e.forEach(e=>{t[e.type.name]=(t[e.type.name]||0)+1}),t}let s=({currentContent:e,pluginState:t})=>{if(t?.initialContent){let o=i(t.initialContent),n=i(e);return Object.keys({...o,...n}).filter(e=>!["paragraph","heading"].includes(e)).reduce((e,t)=>{let a=(n[t]||0)-(o[t]||0);return 0!==a&&(e[t]=a),e},{})}return{}},l=({currentContent:e,pluginState:t,toolbarDocking:o})=>{let n,a=s({currentContent:e,pluginState:t}),i=0,l=0;return Object.entries(a).forEach(([e,t])=>{t>0?i+=t:t<0&&(l+=Math.abs(t))}),{action:r("d925B").ACTION.ENDED,actionSubject:r("d925B").ACTION_SUBJECT.ACTIVITY_SESSION,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.ACTIVITY,attributes:{efficiency:{totalActiveTime:t.activeSessionTime/1e3,totalActionCount:t.totalActionCount,actionByTypeCount:{...t.actionTypeCount??{},nodeDeletionCount:l,nodeInsertionCount:i,other:(n=0,Object.entries(t.actionTypeCount).forEach(([e,t])=>{n+=t}),t.totalActionCount-n)}},effectiveness:{undoCount:t.actionTypeCount.undoCount,repeatedActionCount:t.repeatedActionCount,safeInsertCount:t.safeInsertCount},contentSizeChanged:t.contentSizeChanged,toolbarDocking:o},eventType:r("d925B").EVENT_TYPE.TRACK}};var d=((o={}).TEXT_INPUT="textInput",o.EMPTY_LINE_ADDED_OR_DELETED="emptyLineAddedOrDeleted",o.INSERTED_FROM_TYPE_AHEAD="insertedFromTypeAhead",o.INSERTING_NEW_LIST_TYPE_NODE="insertingNewListTypeNode",o.UPDATING_NEW_LIST_TYPE_ITEM="updatingNewListItem",o.ADDING_LINK="addingLink",o.UPDATING_STATUS="updatingStatus",o.CHANGING_MARK="changingMark",o.CHANGING_ATTRS="changingAttrs",o.MOVING_CONTENT="contentMoved",o.PASTING_CONTENT="contentPasted",o.DELETING_CONTENT="deletingContent",o.SAFE_INSERT="safeInsert",o.UNDO="undo",o);let c=e=>{let t=e.getMeta(M)?.contentMoved,o="paste"===e.getMeta("uiEvent");return t?{type:d.MOVING_CONTENT}:o?{type:d.PASTING_CONTENT}:void 0},p=e=>{let{slice:{content:t},from:o,to:n}=e;if(n!==o&&0===t.childCount)return{type:d.DELETING_CONTENT}},u=e=>{let{slice:{content:t},from:o,to:n}=e;if(n-o==2&&0===t.size)return{type:d.EMPTY_LINE_ADDED_OR_DELETED};let a=!1;if(t.forEach(e=>{a="paragraph"===e.type.name&&0===e.content.size}),a)return{type:d.EMPTY_LINE_ADDED_OR_DELETED}},m=e=>{let{slice:{content:t}}=e,o=t.childCount;if(!(o<1)){for(let e of t.content)if(["decisionList","decisionItem","bulletList","listItem","orderedList","taskList","taskItem"].includes(e.type.name))return 1===o?{type:d.INSERTING_NEW_LIST_TYPE_NODE}:{type:d.UPDATING_NEW_LIST_TYPE_ITEM}}},f=e=>{if(e instanceof r("aXG5V").AddMarkStep||e instanceof r("aXG5V").RemoveMarkStep)return{type:d.CHANGING_MARK}},g=(e,t)=>{for(let o of new Set([...Object.keys(e),...Object.keys(t)]))if(e[o]!==t[o]&&"localId"!==o)return o},h=(e,t)=>{if(!e&&!t)return;let o=new Map(e.map(e=>[e.type.name,e.attrs])),n=new Map(t.map(e=>[e.type.name,e.attrs]));for(let e of new Set([...o.keys(),...n.keys()])){let t=o.get(e),a=n.get(e);if(JSON.stringify(t)!==JSON.stringify(a))return e}},b=(e,t)=>{let{slice:o,from:n,to:a}=t,r=e.docs[0].nodeAt(n),i=o.content.firstChild;if(!r||!i||r.type.name!==i.type.name)return;let s=g(r.attrs,i.attrs);if(s)return{type:d.CHANGING_ATTRS,extraData:{attr:s,from:n,to:a}};let l=h(r.marks,i.marks);if(l)return{type:d.CHANGING_ATTRS,extraData:{attr:l,from:n,to:a}}},y=e=>{let{slice:t}=e,o=t.content.firstChild;if(o)return"status"===o.type.name?{type:d.UPDATING_STATUS,extraData:{statusId:o.attrs.localId}}:void 0},_=e=>{let t,o="colwidth",n=e.steps.find(e=>e instanceof r("aXG5V").AttrStep||e instanceof r("7Mtx3").BatchAttrsStep);if(!n)return;if(n instanceof r("7Mtx3").BatchAttrsStep){if(0===n.data.length)return;let{attrs:e,nodeType:a,position:r}=n.data[0];["tableHeader","tableCell"].includes(a)&&e?.[o]&&(t=r)}else n instanceof r("aXG5V").AttrStep&&n.attr===o&&(t=n.pos);if(!t)return;let a=e.doc.resolve(t).blockRange();if(!a)return;let i=a.start,s=i+a.parent.content.size;return{type:d.CHANGING_ATTRS,extraData:{attr:o,from:i,to:s}}},S=e=>{let{slice:{content:t},from:o,to:n}=e,a=t.firstChild,r=o===n&&1===t.childCount&&!!a&&!!a.text&&1===a.text.length,i=n-o==1&&0===t.childCount;if(r||i)return{type:d.TEXT_INPUT}},E=e=>{if(e.steps.length<=0)return;let t=c(e);if(t)return t;let o=_(e);if(o)return o;let[n]=e.steps,a=n instanceof r("aXG5V").ReplaceStep,i=n instanceof r("aXG5V").ReplaceAroundStep,s=f(n);if(s)return s;if(!(a||i))return;if(a){let e=S(n);if(e)return e;let t=u(n);if(t)return t;let o=p(n);if(o)return o;let a=y(n);if(a)return a}let l=m(n);if(l)return l;let d=b(e,n);if(d)return d},v=e=>{if(void 0===e.getMeta("undoRedoPlugin$"))return!1;let t=!1;return e.steps.forEach(e=>{if(e instanceof r("aXG5V").ReplaceStep){let{slice:o}=e;o.content&&o.content.forEach(e=>{"text"!==e.type.name&&(t=!0)})}else t=!0}),t},T=(e,t,o)=>{if(o||t>e.doc.content.size)return!1;let[n]=e.steps;if(!(n instanceof r("aXG5V").ReplaceStep))return!1;let a=n.from;if(a===t)return!1;let i=e.doc.resolve(a);if("paragraph"===i.node().type.name)return!1;let s=i.node(i.depth)?.type.name,l=e.doc.resolve(t);return l.node(l.depth-1)?.type.name!==s},C=[d.TEXT_INPUT,d.EMPTY_LINE_ADDED_OR_DELETED],x=[d.UPDATING_NEW_LIST_TYPE_ITEM,d.INSERTING_NEW_LIST_TYPE_NODE],A=[...C,...x,d.UPDATING_STATUS],k=(e,t)=>e&&t.includes(e.type),I=(e,t)=>e?t+1:t,P=({now:e,intentToStartEditTime:t,shouldPersistActiveSession:o,tr:n,pluginState:a,oldState:r,newState:i})=>{let{actionTypeCount:s,timeOfLastTextInput:l,totalActionCount:c,previousTrType:p,safeInsertCount:u,contentSizeChanged:m}=a,f={...a,activeSessionTime:e-t,contentSizeChanged:m+Math.abs(i.doc.content.size-r.doc.content.size),intentToStartEditTime:t,shouldPersistActiveSession:o},g=E(n),h=I(T(n,r.tr.selection.from,g?.type),u),b=I(v(n),s.undoCount);if(!g)return{...f,totalActionCount:c+1,timeOfLastTextInput:void 0,actionTypeCount:{...s,undoCount:b},previousTrType:g,safeInsertCount:h};let y=g.type===d.UPDATING_STATUS&&p?.type===d.UPDATING_STATUS&&g?.extraData?.statusId===p?.extraData?.statusId,_=g.type===d.TEXT_INPUT&&k(p,x),S=p?.type===d.TEXT_INPUT&&g.type===d.UPDATING_NEW_LIST_TYPE_ITEM,P=C.includes(g.type),N=I(!(l&&(P||y||_||S)),c),w=I(P&&!(l&&k(p,[...C,...x])),s.textInputCount),D=I(g?.type===d.CHANGING_ATTRS,s.nodeAttributeChangeCount),O=I(g?.type===d.CHANGING_ATTRS&&p?.type===d.CHANGING_ATTRS&&g.extraData.attr===p.extraData.attr&&g.extraData.from===p.extraData.from&&g.extraData.to===p.extraData.to,a.repeatedActionCount),M=I(g?.type===d.MOVING_CONTENT,s.contentMovedCount),R=I(g?.type===d.CHANGING_MARK,s.markChangeCount),L=I(g?.type===d.DELETING_CONTENT,s.contentDeletedCount),B=A.includes(g.type)||y;return{...f,totalActionCount:N,timeOfLastTextInput:B?e:void 0,actionTypeCount:{...s,textInputCount:w,undoCount:b,nodeAttributeChangeCount:D,contentMovedCount:M,markChangeCount:R,contentDeletedCount:L},previousTrType:g,repeatedActionCount:O,safeInsertCount:h}},N=e=>e.steps.length>0&&e.steps?.some(e=>e instanceof r("aXG5V").ReplaceStep||e instanceof r("aXG5V").ReplaceAroundStep||e instanceof r("aXG5V").AddMarkStep||e instanceof r("aXG5V").AttrStep||e instanceof r("aXG5V").RemoveMarkStep||e instanceof r("7Mtx3").BatchAttrsStep),w=e=>{let t=e.steps.find(e=>e instanceof r("8EkET").LinkMetaStep);return!!(e.steps.some(e=>e instanceof r("aXG5V").ReplaceStep)&&t instanceof r("8EkET").LinkMetaStep&&t.getMetadata()?.cardAction==="RESOLVE")},D=e=>{if(e.getMeta("typeAheadPlugin$")?.action==="INSERT_RAW_QUERY")return"INSERT_RAW_QUERY";if(!e.getMeta("appendedTransaction"))return!1;let t=e.steps.find(e=>e instanceof r("cuprm").InsertTypeAheadStep),o=e.steps.find(e=>e instanceof r("aXG5V").ReplaceStep);return!!t&&!!o&&t instanceof r("cuprm").InsertTypeAheadStep&&t.stage},O=e=>{if(w(e))return!0;let t=D(e);return t?"INSERTING_ITEM"!==t:e.getMeta("appendedTransaction")},M=new(0,r("ks2lK").PluginKey)("metricsPlugin"),R={intentToStartEditTime:void 0,lastSelection:void 0,activeSessionTime:0,totalActionCount:0,contentSizeChanged:0,shouldPersistActiveSession:void 0,timeOfLastTextInput:void 0,initialContent:void 0,actionTypeCount:{textInputCount:0,nodeInsertionCount:0,nodeAttributeChangeCount:0,contentMovedCount:0,nodeDeletionCount:0,undoCount:0,markChangeCount:0,contentDeletedCount:0},repeatedActionCount:0,safeInsertCount:0},L=(e,t)=>{let o=new a(e);return new(0,r("1S4f7").SafePlugin)({key:M,state:{init:(e,t)=>({...R,initialContent:t.doc.content}),apply(e,t,n,a){if(e.getMeta("isRemote")||e.getMeta("replaceDocument"))return t;let r=e.getMeta(M);if(r&&r.stopActiveSession)return{...R,initialContent:a.doc.content};let i=r?.shouldPersistActiveSession??t.shouldPersistActiveSession,s=N(e),l=r?.intentToStartEditTime||t.intentToStartEditTime,d=performance.now();return l||s||e.storedMarksSet?(!l&&(s||e.storedMarksSet)&&(l=d),l&&r?.shouldStartTimer&&!i&&o.startTimer(),s)?(o.startTimer(),O(e))?{...t,shouldPersistActiveSession:i}:P({now:d,intentToStartEditTime:l,shouldPersistActiveSession:i,tr:e,pluginState:t,oldState:n,newState:a}):{...t,lastSelection:r?.newSelection||t.lastSelection,intentToStartEditTime:l,shouldPersistActiveSession:i}:{...t,shouldPersistActiveSession:i}}},view(a){let i=()=>{let o,r=M.getState(a.state);if(!r)return;(0,n.expValEqualsNoExposure)("platform_editor_controls","cohort","variant1")&&(o=t?.getPreference("toolbarDockingInitialPosition"));let i=l({currentContent:a.state.doc.content,pluginState:r,toolbarDocking:o||void 0});r&&r.totalActionCount>0&&r.activeSessionTime>0&&e?.analytics?.actions?.fireAnalyticsEvent(i,void 0,{immediate:!0})},s=(0,r("fFa3V").bind)(window,{type:"beforeunload",listener:()=>{i()}});return{destroy(){i(),o.cleanupTimer(),s()}}},props:{handleDOMEvents:{click:t=>{let o=t.state.tr.selection,n=e?.metrics.sharedState.currentState();return n?.lastSelection?.from!==o.from&&n?.lastSelection?.to!==o.to&&e?.core.actions.execute(e?.metrics.commands.handleIntentToStartEdit({newSelection:o})),!1}}}})};e.exports.metricsPlugin=({config:e,api:t})=>({name:"metrics",pmPlugins:()=>[{name:"metrics",plugin:()=>L(t,e?.userPreferencesProvider)}],commands:{setContentMoved:()=>({tr:e})=>e.setMeta(M,{contentMoved:!0}),startActiveSessionTimer:()=>({tr:e})=>{let o=t?.metrics.sharedState.currentState();return o?.intentToStartEditTime?e.setMeta(M,{shouldStartTimer:!0,shouldPersistActiveSession:!1}):e},stopActiveSession:()=>({tr:o})=>{if(!t)return o;let a=t?.metrics.sharedState.currentState();if(a?.shouldPersistActiveSession)return o;if(a&&a.totalActionCount>0&&a.activeSessionTime>0){let i;(0,n.expValEqualsNoExposure)("platform_editor_controls","cohort","variant1")&&(i=i=(0,r("dh538").fg)("platform_editor_use_preferences_plugin")?t?.userPreferences?.sharedState.currentState()?.preferences?.toolbarDockingPosition:e?.userPreferencesProvider?.getPreference("toolbarDockingInitialPosition"));let s=l({currentContent:o.doc.content,pluginState:a,toolbarDocking:i||void 0});t?.analytics?.actions.attachAnalyticsEvent(s)(o)}return o.setMeta(M,{stopActiveSession:!0}),o.setMeta("scrollIntoView",!1),o.setMeta("addToHistory",!1),o},handleIntentToStartEdit:({newSelection:e,shouldStartTimer:o=!0,shouldPersistActiveSession:n})=>({tr:a})=>{if(!t)return a;let r=t?.metrics.sharedState.currentState();return n&&r?.intentToStartEditTime?a.setMeta(M,{shouldPersistActiveSession:n}):(!r||r.intentToStartEditTime||a.setMeta(M,{intentToStartEditTime:performance.now(),shouldStartTimer:o,newSelection:e,shouldPersistActiveSession:n}),a)}},getSharedState:e=>e?M.getState(e):R})}),i("kcvNv",function(e,t){let o=e=>({action:r("d925B").ACTION.NCS_SESSION_STEP_METRICS,actionSubject:r("d925B").ACTION_SUBJECT.COLLAB,attributes:e,eventType:r("d925B").EVENT_TYPE.OPERATIONAL}),n=e=>{if(!e||e?.length===0)return 0;let t=e.sort((e,t)=>e-t),o=Math.ceil(.9*t.length)-1;return t[o]||0},a=new(0,r("kt8c2").default)(r("25jxS").NCS_STORAGE.NCS_STORAGE_CLIENT_KEY),i=e=>({ncsSessionId:e.ncsSessionId,totalStepSize:e.totalStepSize,numberOfSteps:e.numberOfSteps,maxStepSize:e.maxStepSize,p90StepSize:n(e.stepSizeSumForP90)}),s=e=>{if(!e)return;let t=JSON.parse(a.getItem(r("25jxS").NCS_STORAGE.NCS_SESSION_STEP_METRICS)||"{}")[e];if(t)return i(t)},l=e=>{if(!e)return;let t=JSON.parse(a.getItem(r("25jxS").NCS_STORAGE.NCS_SESSION_STEP_METRICS)||"{}");t[e]&&(delete t[e],0===Object.keys(t).length?a.removeItem(r("25jxS").NCS_STORAGE.NCS_SESSION_STEP_METRICS):a.setItemWithExpiry(r("25jxS").NCS_STORAGE.NCS_SESSION_STEP_METRICS,JSON.stringify(t))),d(e)},d=e=>{if(!e)return;let t=JSON.parse(a.getItem(r("25jxS").NCS_STORAGE.NCS_ACTIVE_SESSIONS)||"{}");t[e]&&(delete t[e],0===Object.keys(t).length?a.removeItem(r("25jxS").NCS_STORAGE.NCS_ACTIVE_SESSIONS):a.setItemWithExpiry(r("25jxS").NCS_STORAGE.NCS_ACTIVE_SESSIONS,JSON.stringify(t)))},c=e=>{let t=JSON.parse(a.getItem(r("25jxS").NCS_STORAGE.NCS_SESSION_STEP_METRICS)||"{}"),n=JSON.parse(a.getItem(r("25jxS").NCS_STORAGE.NCS_ACTIVE_SESSIONS)||"{}");Object.keys(t).forEach(a=>{if(!n[a]){let n=i(t[a]);if(n){let t=o(n);e?.analytics?.actions?.fireAnalyticsEvent(t),l(a)}}})};e.exports.ncsStepMetricsPlugin=({api:e})=>{let t,n;return{name:"ncsStepMetrics",pmPlugins:()=>[{name:"ncsStepMetricsPlugin",plugin:()=>new(0,r("1S4f7").SafePlugin)({view:()=>{e?.collabEdit?.sharedState?.onChange(({nextSharedState:o})=>{void 0!==o.sessionId&&t!==o.sessionId&&(t=o.sessionId,c(e))});let a=e?.analytics?.sharedState?.onChange(({nextSharedState:e})=>{e.createAnalyticsEvent&&(n=e.createAnalyticsEvent,a?.())}),i=!1,p=()=>{if(i||!n||!t)return;i=!0;let e=s(t);e&&((0,r("ajtqX").fireAnalyticsEvent)(n,{immediate:!0})({payload:o(e)}),l(t))},u=(0,r("fFa3V").bind)(window,{type:"beforeunload",listener:()=>{d(t)}});return{destroy(){requestAnimationFrame(()=>{document.querySelector(".akEditor")||(p(),u())})}}}})}]}}}),i("4NiQW",function(e,o){var n,a=r("l998X");r("42omo");var i=r("1oCLl");let s=e=>(t,o)=>{let{tr:n,schema:a}=t;try{let i=t.doc.content.size,s=r("5SAOw").Node.fromJSON(a,e);return s.check(),n.insert(n.mapping.map(i),s).scrollIntoView(),o(n),{status:"success"}}catch(e){return{status:"failed"}}};var l=((n={}).SET_ACTIVE_EXTENSION="set-active-extension",n.UPDATE_ACTIVE_EXTENSION_COORDS="update-active-extension-coords",n.CLEAR_ACTIVE_EXTENSION="clear-active-extension",n.SET_SELECTED_NODE="set-selected-node",n.START_TRACK_CHANGES="start-track-changes",n);let d=new(0,r("ks2lK").PluginKey)("selectionExtensionPlugin"),c=()=>new(0,r("1S4f7").SafePlugin)({key:d,state:{init:()=>({activeExtension:void 0}),apply:(e,t)=>{let o=e.getMeta(d);switch(o?.type){case l.SET_ACTIVE_EXTENSION:return{...t,activeExtension:o.extension};case l.CLEAR_ACTIVE_EXTENSION:return{...t,activeExtension:void 0};case l.SET_SELECTED_NODE:return{...t,selectedNode:o.selectedNode,nodePos:o.nodePos,startTrackChanges:!0,docChangedAfterClick:!1};case l.START_TRACK_CHANGES:return{...t,startTrackChanges:o.startTrackChanges}}return t.startTrackChanges&&e.steps.some(e=>e instanceof r("aXG5V").ReplaceStep||e instanceof r("aXG5V").ReplaceAroundStep)?{...t,docChangedAfterClick:!0,startTrackChanges:!1}:e.selectionSet&&!e.selection.empty?{...t,activeExtension:void 0}:t}}}),p=(e,t)=>(o,n)=>{let{tr:a,schema:i}=o,s=d.getState(o)?.docChangedAfterClick||!1;if(a.setMeta(d,{type:l.START_TRACK_CHANGES,startTrackChanges:!1}),s)return n(a),{status:"document-changed"};try{let s=d.getState(o)?.selectedNode,l=d.getState(o)?.nodePos;if(!s||void 0===l)throw Error("No selected node or node position found");let c="doc"===s.type.name&&(0,r("dh538").fg)("platform_editor_selection_extension_improvement")?l+s.content.size:l+s.nodeSize,p=r("5SAOw").Node.fromJSON(i,e);p.check();let u=a.replaceWith(l,c,p).scrollIntoView();return n(t?.editorViewModeEffects?.actions.allowViewModeTransaction(u)||u),{status:"success"}}catch{return n(a),{status:"failed-to-replace"}}},u=(e,t,o,n={top:0,bottom:0})=>{let a=1/0,r=1/0,i=-1/0,s=-1/0;for(let n=t;n<=o;n++){let t=e.coordsAtPos(n);a=Math.min(a,t.top),r=Math.min(r,t.left),i=Math.max(i,t.bottom),s=Math.max(s,t.right)}return{top:a-=n.top,left:r,bottom:i-=n.bottom,right:s}},m=new Set(["taskItem","decisionItem","listItem"]),f=new Set(["taskList","bulletList","orderedList","decisionList"]),g=(e,t)=>{let o=Math.min(e.depth,t.depth);for(let n=0;n<=o;n++)if(e.node(n)!==t.node(n))return n-1;return o},h=(e,t)=>{let o=g(e,t),n=null,a=-1,r=null,i=-1;for(let t=o;t>0;t--){let o=e.node(t);f.has(o.type.name)?(n=o,a=e.before(t)):r||"doc"===o.type.name||(r=o,i=e.before(t))}return n?{node:n,pos:a}:{node:r,pos:i}},b=(e,t)=>{if(0===t.length)return e.nodes.doc.createChecked({},r("5SAOw").Fragment.empty);if(1===t.length)return t[0];try{return e.node("doc",null,r("5SAOw").Fragment.from(t))}catch(t){return(0,r("hWRJP").logException)(t,{location:"editor-plugin-selection-extension"}),e.nodes.doc.createChecked({},r("5SAOw").Fragment.empty)}},y=e=>{let{$from:t,$to:o}=e;return{selectedNode:t.node(),selectionRanges:[{start:{pointer:`/content/${t.index()}/text`,position:t.parentOffset},end:{pointer:`/content/${t.index()}/text`,position:o.parentOffset}}],nodePos:t.before()}},_=(e,t)=>{let{$from:o,$to:n}=e;if(o.parent===n.parent){let{node:e,pos:t}=h(o,n);if(e)return{selectedNode:e,nodePos:t};let a=o.before();return{selectedNode:o.node(),nodePos:a}}let a=o.blockRange(n);if(!a)return{selectedNode:o.node(),nodePos:o.depth>0?o.before():o.pos};if("doc"!==a.parent.type.name){if(f.has(a.parent.type.name)||m.has(a.parent.type.name)){let{node:e,pos:t}=h(o,n);if(e)return{selectedNode:e,nodePos:t}}let e=a.depth>0?o.before(a.depth):0;return{selectedNode:a.parent,nodePos:e}}let r=[];for(let e=a.startIndex;e<a.endIndex;e++)r.push(a.parent.child(e));return{selectedNode:b(t,r),nodePos:a.start}},S=e=>{let{$anchorCell:t,$headCell:o}=e,n=t.node(-1),a=r("LmqWp").TableMap.get(n),i=t.start(-1);return a.rectBetween(t.pos-i,o.pos-i)},E=e=>{let t=e.$anchorCell.node(-1),o=e.$anchorCell.before(-1),n=[],a=S(e);for(let e=a.top;e<a.bottom;e++)n.push({start:{pointer:`/content/${e}/content/${a.left}`},end:{pointer:`/content/${e}/content/${a.right-1}`}});return{selectedNode:t,selectionRanges:n,nodePos:o}},v=(e,t)=>{let{selection:o}=e.state,n=t?.userPreferences?.sharedState.currentState()?.preferences?.toolbarDockingPosition,a=t?.editorViewMode?.sharedState.currentState()?.mode==="edit",i="top"===n&&a,{from:s,to:l}=o,d=e.state.doc.textBetween(s,l,"\n"),c=u(e,s,l,{top:i?r("aFUXX").akEditorFullPageToolbarHeight:0,bottom:i?r("aFUXX").akEditorFullPageToolbarHeight:0});return{text:d,from:s,to:l,coords:c}},T=(e,t,o)=>{let n=(0,r("dh538").fg)("platform_editor_use_preferences_plugin")?o?.userPreferences?.sharedState.currentState()?.preferences?.toolbarDockingPosition:o?.selectionToolbar?.sharedState?.currentState()?.toolbarDocking,a=o?.editorViewMode?.sharedState.currentState()?.mode==="edit",i="top"===n&&a,{from:s,to:l}=e,d=t.state.doc.textBetween(s,l,"\n"),c=u(t,s,l,{top:i?r("aFUXX").akEditorFullPageToolbarHeight:0,bottom:i?r("aFUXX").akEditorFullPageToolbarHeight:0});return{text:d,from:s,to:l,coords:c}},C=e=>{let t,{schema:o,selection:n}=e,a=n.content();try{let{schema:o}=e,n=o.node("doc",null,[o.node("paragraph",null,[])]);t=new(0,r("aXG5V").Transform)(n).replaceRange(0,2,a).doc}catch(e){t=o.nodes.doc.createChecked({},r("5SAOw").Fragment.empty),(0,r("hWRJP").logException)(e,{location:"editor-plugin-selection-extension"})}return{selectedNodeAdf:new(0,r("h9yJL").JSONTransformer)().encodeNode(t)}},x=e=>{let t,{schema:o}=e.$from.doc.type,n=e.content();try{let e=o.node("doc",null,[o.node("paragraph",null,[])]);t=new(0,r("aXG5V").Transform)(e).replaceRange(0,2,n).doc}catch(e){t=o.nodes.doc.createChecked({},r("5SAOw").Fragment.empty),(0,r("hWRJP").logException)(e,{location:"editor-plugin-selection-extension"})}return{selectedNodeAdf:new(0,r("h9yJL").JSONTransformer)().encodeNode(t)}};function A(e){let t=e.selection,o={selectedNode:t.$from.node(),nodePos:t.$from.depth>0?t.$from.before():t.from};if(t instanceof r("ks2lK").TextSelection)if((0,r("dh538").fg)("platform_editor_selection_extension_improvement"))o=_(t,e.schema);else{let{$from:e,$to:n}=t;e.parent===n.parent&&(o=y(t))}else t instanceof r("7XFGZ").CellSelection&&(o=E(t));let n=new(0,r("h9yJL").JSONTransformer)().encodeNode(o.selectedNode);return{...o,selectedNodeAdf:n}}function k(e){let t=e.$from.doc.type.schema,o={selectedNode:e.$from.node(),nodePos:e.$from.depth>0?e.$from.before():e.from};if(e instanceof r("ks2lK").TextSelection)if((0,r("dh538").fg)("platform_editor_selection_extension_improvement"))o=_(e,t);else{let{$from:t,$to:n}=e;t.parent===n.parent&&(o=y(e))}else e instanceof r("7XFGZ").CellSelection&&(o=E(e));let n=new(0,r("h9yJL").JSONTransformer)().encodeNode(o.selectedNode);return{...o,selectedNodeAdf:n}}var I=r("42omo");let P=({api:e,editorAnalyticsAPI:t})=>{let o=(0,I.useRef)(),n=!!e?.toolbar&&(0,i.expValEquals)("platform_editor_toolbar_aifc_selection_extension","isEnabled",!0),{activeExtension:s,mode:l}=(0,r("eiA8Z").useSharedPluginStateWithSelector)(e,["selectionExtension","editorViewMode"],e=>({activeExtension:e.selectionExtensionState?.activeExtension,mode:e.editorViewModeState?.mode})),d=(0,I.useCallback)(()=>{e?.core.actions.execute(e?.selectionExtension.commands.clearActiveExtension()),o.current=void 0,t&&t.fireAnalyticsEvent({action:r("d925B").ACTION.CLOSED,actionSubject:r("d925B").ACTION_SUBJECT.EDITOR_PLUGIN_SELECTION_EXTENSION,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.EDITOR_PLUGIN_SELECTION_EXTENSION_COMPONENT,eventType:r("d925B").EVENT_TYPE.TRACK})},[t,e]);(0,I.useEffect)(()=>{void 0!==o.current&&d()},[d,l]),(0,I.useEffect)(()=>{let e=s?.extension;if(e){if(n||(0,i.expValEquals)("platform_editor_block_menu","isEnabled",!0)){let n;"contentComponent"in e&&void 0!==e.contentComponent?n=e.contentComponent:"component"in e&&void 0!==e.component&&(n=e.component),o.current!==n&&void 0!==n&&(t&&t.fireAnalyticsEvent({action:r("d925B").ACTION.VIEWED,actionSubject:r("d925B").ACTION_SUBJECT.EDITOR_PLUGIN_SELECTION_EXTENSION,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.EDITOR_PLUGIN_SELECTION_EXTENSION_COMPONENT,eventType:r("d925B").EVENT_TYPE.TRACK}),o.current=n);return}e&&"component"in e&&o.current!==e.component&&void 0!==e.component&&(t&&t.fireAnalyticsEvent({action:r("d925B").ACTION.VIEWED,actionSubject:r("d925B").ACTION_SUBJECT.EDITOR_PLUGIN_SELECTION_EXTENSION,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.EDITOR_PLUGIN_SELECTION_EXTENSION_COMPONENT,eventType:r("d925B").EVENT_TYPE.TRACK}),o.current=e.component)}},[s,t,n]);let c=s?.extension;if(!c)return null;if(n||(0,i.expValEquals)("platform_editor_block_menu","isEnabled",!0)){let e;if("contentComponent"in c&&void 0!==c.contentComponent)e=c.contentComponent;else"component"in c&&void 0!==c.component&&(e=c.component);return e?(0,a.jsx)(e,{closeExtension:d,selection:s.selection}):null}if(!("component"in c)||!c.component)return null;let p=c.component;return(0,a.jsx)(p,{closeExtension:d,selection:s.selection})},N=(e,t)=>e.reduce((e,o)=>{let n=o[t];return n?.getToolbarItem&&e.push({getToolbarItem:n.getToolbarItem,getMenuItems:n.getMenuItems}),e},[]),w=(e,t)=>e.reduce((e,o)=>{let{source:n,inlineToolbar:a}=o;return n===t&&a?.getMenuItems&&!a.getToolbarItem&&a.getMenuItems().forEach(t=>{"label"in t&&"icon"in t&&e.push({name:t.label,icon:t.icon,onClick:t.onClick,isDisabled:()=>!!t.isDisabled,component:t.contentComponent})}),e},[]);var D=r("h4TOP");let O=({primaryToolbarItemExtensions:e})=>(0,a.jsx)(a.Fragment,{children:e.map((e,t)=>{let o=e.getToolbarItem();return(0,a.jsx)(M,{toolbarItem:o},o.tooltip)})}),M=({toolbarItem:e,getMenuItems:t})=>{let[o,n]=(0,I.useState)(!1),{icon:i,tooltip:s,isDisabled:l,onClick:d,label:c}=e;if(!t)return(0,a.jsx)(r("a4eZN").default,{spacing:"default",disabled:l,selected:o,title:s,"aria-label":s,"aria-expanded":o,"aria-haspopup":!0,onClick:d,iconBefore:(0,a.jsx)(i,{label:s})});let p=()=>{n(e=>!e)},u=o?t().map((e,t)=>{if("label"in e&&"icon"in e)return{key:`menu-item-${t}`,content:e.label,elemBefore:(0,a.jsx)(e.icon,{label:e.label}),onClick:()=>{e.onClick?.()},isDisabled:e.isDisabled,"aria-label":e.label,value:{name:e.label}}}).filter(e=>void 0!==e):[];return(0,a.jsx)(D.DropdownMenuWithKeyboardNavigation,{arrowKeyNavigationProviderOptions:{type:r("5v8Ta").ArrowKeyNavigationType.MENU},items:[{items:u}],isOpen:o,onItemActivated:({item:e,shouldCloseMenu:t=!0})=>{e.onClick?.(),t&&n(!1)},onOpenChange:e=>{n(!!e?.isOpen)},fitWidth:200,children:(0,a.jsx)(r("a4eZN").default,{spacing:"default",disabled:l,selected:o,title:s,"aria-label":s,"aria-expanded":o,"aria-haspopup":!0,onClick:p,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),p())},iconBefore:(0,a.jsx)(i,{label:s})})})};r("42omo");let R=({overflowOptions:e,extensionList:t=[]})=>{let o=N(t,"inlineToolbar");return{items:[...o.length?[{type:"separator",fullHeight:!0,supportsViewMode:!0},...o.map(({getToolbarItem:e,getMenuItems:t})=>({type:"custom",render:()=>(0,a.jsx)(M,{toolbarItem:e(),getMenuItems:t}),fallback:[],supportsViewMode:!0}))]:[],{type:"separator",fullHeight:!0,supportsViewMode:!0},{type:"overflow-dropdown",dropdownWidth:240,supportsViewMode:!0,options:e}],rank:-6}};r("42omo"),r("42omo");let L=({extensionMenuItems:e,api:t})=>{let{editorView:o}=(0,r("gzUv9").useEditorToolbar)();if(!e?.length||!o||!t)return null;let n=e=>()=>{if(e.contentComponent){let n=v(o,t);t.core.actions.execute(t.selectionExtension.commands.setActiveExtension({extension:e,selection:n}))}t.core.actions.execute(({tr:e})=>{let{selectedNode:t,nodePos:o}=k(e.selection);return e.setMeta(d,{type:l.SET_SELECTED_NODE,selectedNode:t,nodePos:o}),e}),e.onClick&&e.onClick()};return(0,a.jsx)(a.Fragment,{children:e.map(e=>{let t=e.icon;return(0,a.jsxs)(r("2GVu1").ToolbarDropdownItem,{elemBefore:(0,a.jsx)(t,{size:"small",label:""}),onClick:n(e),isDisabled:e.isDisabled,children:[e.label,e.lozenge&&(0,r("dh538").fg)("platform_editor_selection_extension_lozenge")&&(0,a.jsx)(r("gdv5Z").default,{as:"span",paddingInline:"space.100",children:(0,a.jsx)(r("5nBzc").default,{appearance:"new",children:e.lozenge.label})})]},e.label)})})};r("42omo"),r("42omo");let B=(0,r("dTb09").conditionalHooksFactory)(()=>(0,i.expValEquals)("platform_editor_toolbar_aifc_patch_3","isEnabled",!0),e=>{let{editorToolbarDockingPreference:t}=(0,r("gzUv9").useEditorToolbar)();return{editorToolbarDockingPreference:t}},e=>({editorToolbarDockingPreference:(0,r("b3YrF").useSharedPluginStateSelector)(e,"userPreferences.preferences.toolbarDockingPosition")})),V=({api:e,config:t})=>{let{editorToolbarDockingPreference:o}=B(e);if("top"===o)return null;let n=t.icon;return(0,a.jsx)(r("iIVVb").ToolbarTooltip,{content:t.tooltip,children:(0,a.jsx)(r("7ERUE").ToolbarButton,{iconBefore:(0,a.jsx)(n,{label:""}),isDisabled:t.isDisabled,onClick:t.onClick,children:t.label})})};r("42omo");let F=(0,r("dTb09").conditionalHooksFactory)(()=>(0,i.expValEquals)("platform_editor_toolbar_aifc_patch_3","isEnabled",!0),e=>{let{editorToolbarDockingPreference:t}=(0,r("gzUv9").useEditorToolbar)();return{editorToolbarDockingPreference:t}},e=>({editorToolbarDockingPreference:(0,r("b3YrF").useSharedPluginStateSelector)(e,"userPreferences.preferences.toolbarDockingPosition")})),U=({api:e,config:t,children:o})=>{let{editorToolbarDockingPreference:n}=F(e);if("top"===n)return null;let i=t.icon;return(0,a.jsx)(r("iIVVb").ToolbarTooltip,{content:t.tooltip,children:(0,a.jsx)(r("bTiiT").ToolbarDropdownMenu,{iconBefore:(0,a.jsx)(i,{label:""}),isDisabled:t.isDisabled,onClick:t.onClick,children:o})})},G=({api:e,extension:t,index:o})=>{let{key:n,inlineToolbar:i}=t,s=`selection-extension-${n}`,l=[];if(!i)return l;let{getToolbarItem:d,getMenuItems:c}=i,p=`${s}-toolbar-group`,u=`${s}-toolbar-${c?"menu":"button"}`,m=`${s}-toolbar-menu-section`;if(d){l.push({type:"group",key:p,parents:[{type:r("cPCP8").APPS_SECTION.type,key:r("cPCP8").APPS_SECTION.key,rank:(o+1)*100}]});let t=d();c?l.push({type:"menu",key:u,parents:[{type:"group",key:p,rank:100}],component:()=>(0,a.jsx)(U,{api:e,config:t})}):l.push({type:"button",key:u,parents:[{type:"group",key:p,rank:100}],component:()=>(0,a.jsx)(V,{api:e,config:t})})}if(c){d&&l.push({type:"menu-section",key:m,parents:[{type:"menu",key:u,rank:100}]});let t=c().filter(e=>"label"in e&&"icon"in e);l.push({type:"menu-item",key:n,parents:[{type:"menu-section",key:d?m:(0,r("dh538").fg)("platform_editor_toolbar_aifc_overflow_menu_update")?r("cPCP8").OVERFLOW_EXTENSIONS_MENU_SECTION.key:r("cPCP8").SELECTION_EXTENSION_MENU_SECTION.key,rank:(o+1)*100}],component:()=>(0,a.jsx)(L,{api:e,extensionMenuItems:t})})}return l},q=(e,t)=>{if(!e.icon)return;let o=()=>{let e=t?.selectionExtension.sharedState.currentState();return e?.activeExtension?.selection};return{label:e.name,icon:e.icon,isDisabled:e.isDisabled&&e.isDisabled({selection:o(),selectedNodeAdf:void 0,selectionRanges:void 0}),onClick:()=>{let n=t?.selectionExtension.actions.getSelectionAdf();e.onClick&&e.onClick({selection:o(),selectedNodeAdf:n?.selectedNodeAdf,selectionRanges:n?.selectionRanges})},contentComponent:e.component}},H=({api:e,config:t})=>{let o=t?.extensionList?.flatMap((t,o)=>G({api:e,extension:t,index:o}))||[],n=t?.extensions?.firstParty?.map(t=>q(t,e)).filter(e=>void 0!==e)||[],a=t?.extensions?.external?.map(t=>q(t,e)).filter(e=>void 0!==e)||[];return[{type:r("cPCP8").APPS_SECTION.type,key:r("cPCP8").APPS_SECTION.key,parents:[{type:"toolbar",key:r("cPCP8").TOOLBARS.INLINE_TEXT_TOOLBAR,rank:r("4Chin").TOOLBAR_RANK[r("cPCP8").APPS_SECTION.key]},{type:"toolbar",key:r("cPCP8").TOOLBARS.PRIMARY_TOOLBAR,rank:r("4Chin").TOOLBAR_RANK[r("cPCP8").APPS_SECTION.key]}]},...(0,r("dh538").fg)("platform_editor_toolbar_aifc_overflow_menu_update")?[]:[{type:r("cPCP8").SELECTION_EXTENSION_MENU_SECTION.type,key:r("cPCP8").SELECTION_EXTENSION_MENU_SECTION.key,parents:[{key:r("cPCP8").OVERFLOW_MENU.key,type:r("cPCP8").OVERFLOW_MENU.type,rank:r("4Chin").OVERFLOW_MENU_RANK[r("cPCP8").SELECTION_EXTENSION_MENU_SECTION.key]}]}],...o,...j(e,n),...$(e,a)]},j=(e,t)=>{let o=[];return(0,r("dh538").fg)("platform_editor_toolbar_aifc_overflow_menu_update")?o.push({type:r("cPCP8").FIRST_PARTY_EXTENSIONS_MENU_ITEM.type,key:r("cPCP8").FIRST_PARTY_EXTENSIONS_MENU_ITEM.key,parents:[{type:r("cPCP8").OVERFLOW_EXTENSIONS_MENU_SECTION.type,key:r("cPCP8").OVERFLOW_EXTENSIONS_MENU_SECTION.key,rank:r("4Chin").OVERFLOW_EXTENSIONS_MENU_SECTION_RANK[r("cPCP8").FIRST_PARTY_EXTENSIONS_MENU_ITEM.key]}],component:()=>(0,a.jsx)(L,{api:e,extensionMenuItems:t})}):o.push({type:"menu-item",key:"first-party-extensions-menu-item",parents:[{type:"menu-section",key:r("cPCP8").SELECTION_EXTENSION_MENU_SECTION.key,rank:100}],component:()=>(0,a.jsx)(L,{api:e,extensionMenuItems:t})}),o},$=(e,t)=>{let o=[];return(0,r("dh538").fg)("platform_editor_toolbar_aifc_overflow_menu_update")?o.push({type:r("cPCP8").EXTERNAL_EXTENSIONS_MENU_ITEM.type,key:r("cPCP8").EXTERNAL_EXTENSIONS_MENU_ITEM.key,parents:[{type:r("cPCP8").OVERFLOW_EXTENSIONS_MENU_SECTION.type,key:r("cPCP8").OVERFLOW_EXTENSIONS_MENU_SECTION.key,rank:r("4Chin").OVERFLOW_EXTENSIONS_MENU_SECTION_RANK[r("cPCP8").EXTERNAL_EXTENSIONS_MENU_ITEM.key]}],component:()=>(0,a.jsx)(L,{api:e,extensionMenuItems:t})}):o.push({type:"menu-item",key:"external-extensions-menu-item",parents:[{type:"menu-section",key:r("cPCP8").SELECTION_EXTENSION_MENU_SECTION.key,rank:200}],component:()=>(0,a.jsx)(L,{api:e,extensionMenuItems:t})}),o};r("42omo"),r("42omo");let K=e=>"getMenuItems"in e&&"function"==typeof e.getMenuItems;r("42omo");let z=(0,I.createContext)(void 0),W=z.Provider,Y=()=>{let e=(0,I.useContext)(z);if(!e)throw Error("useSelectionExtensionComponentContext must be used within SelectionExtensionComponentContextProvider");return e},X=({dropdownItem:e})=>{let t=e.icon,{api:o,editorView:n,extensionKey:i,extensionSource:s,extensionLocation:c}=Y();return(0,a.jsx)(r("2GVu1").ToolbarDropdownItem,{elemBefore:t?(0,a.jsx)(t,{label:""}):void 0,onClick:()=>{let t=o?.blockControls?.sharedState.currentState()?.preservedSelection||n.state.selection;if(e.contentComponent){let a=T(t,n,o);o.core.actions.execute(o.selectionExtension.commands.setActiveExtension({extension:e,selection:a}))}o.core.actions.execute(({tr:e})=>{let{selectedNode:o,nodePos:n}=k(t);return e.setMeta(d,{type:l.SET_SELECTED_NODE,selectedNode:o,nodePos:n}),e}),e.onClick?.(),o.analytics?.actions.fireAnalyticsEvent({action:r("d925B").ACTION.CLICKED,actionSubject:r("d925B").ACTION_SUBJECT.BUTTON,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.EDITOR_PLUGIN_SELECTION_EXTENSION_ITEM,eventType:r("d925B").EVENT_TYPE.TRACK,attributes:{extensionKey:i,extensionSource:s,extensionLocation:c,extensionElement:"dropdown-item",extensionItemKey:e.key}})},isDisabled:e.isDisabled,children:e.label})};r("42omo");let J=({nestedDropdownMenu:e})=>{let t=e.getMenuItems();return(0,a.jsx)(r("6UWPx").ToolbarDropdownItemSection,{children:t.map(e=>(0,a.jsx)(X,{dropdownItem:e},e.key||e.label))})},Q=({nestedDropdownMenu:e})=>{let o=e.icon,{api:n,extensionKey:i,extensionSource:s,extensionLocation:l}=Y();return(0,a.jsx)(r("87Gms").ToolbarNestedDropdownMenu,{text:e.label,elemBefore:o?(0,a.jsx)(o,{label:""}):void 0,elemAfter:(0,a.jsx)(t(r("6R5uz")),{label:""}),onClick:()=>{n.analytics?.actions.fireAnalyticsEvent({action:r("d925B").ACTION.CLICKED,actionSubject:r("d925B").ACTION_SUBJECT.BUTTON,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.EDITOR_PLUGIN_SELECTION_EXTENSION_DROPDOWN,eventType:r("d925B").EVENT_TYPE.TRACK,attributes:{extensionKey:i,extensionSource:s,extensionLocation:l,extensionElement:"nested-dropdown",extensionItemKey:e.key}})},dropdownTestId:"editor-selection-extension-menu",children:(0,a.jsx)(J,{nestedDropdownMenu:e})})},Z=({getMenuItems:e})=>{let t=e();return t?.length?(0,a.jsx)(a.Fragment,{children:t.map(e=>K(e)?(0,a.jsx)(Q,{nestedDropdownMenu:e},e.key||e.label):(0,a.jsx)(X,{dropdownItem:e},e.key||e.label))}):null};e.exports.selectionExtensionPlugin=({api:e,config:t})=>{let o,n,u={},m=!!e?.toolbar,{extensionList:f=[],extensions:g={}}=t||{},{firstParty:h=[],external:b=[]}=g||{};if(!m){let t=N(f,"primaryToolbar");t?.length&&e?.primaryToolbar?.actions?.registerComponent({name:"selectionExtension",component:()=>(0,a.jsx)(O,{primaryToolbarItemExtensions:t})})}return(0,i.expValEquals)("platform_editor_block_menu","isEnabled",!0)&&function({extensionList:e,api:t,editorViewRef:o}){e.forEach(({source:e,key:n,blockMenu:i})=>{"first-party"===e&&i&&t?.blockMenu&&t.blockMenu.actions.registerBlockMenuComponents([{type:"block-menu-item",key:`selection-extension-${n}`,parent:{type:"block-menu-section",key:r("btNLq").TRANSFORM_CREATE_MENU_SECTION.key,rank:r("gEb6G").TRANSFORM_MENU_ITEM_RANK[r("btNLq").TRANSFORM_CREATE_MENU_SECTION.key]},component:()=>{let r=o?.current;return r?(0,a.jsx)(W,{value:{api:t,editorView:r,extensionKey:n,extensionSource:e,extensionLocation:"block-menu"},children:(0,a.jsx)(Z,{getMenuItems:i.getMenuItems})}):null}}])})}({extensionList:f,api:e,editorViewRef:u}),{name:"selectionExtension",getSharedState:e=>e&&d.getState(e)||null,commands:{setActiveExtension:e=>({tr:t})=>t.setMeta(d,{type:"set-active-extension",extension:e}),clearActiveExtension:()=>({tr:e})=>e.setMeta(d,{type:"clear-active-extension"})},actions:{replaceWithAdf:t=>{if(!u.current)return{status:"failed-to-replace"};let{state:o,dispatch:n}=u.current;return p(t,e)(o,n)},insertAdfAtEndOfDoc:e=>{if(!u.current)return{status:"failed"};let{state:t,dispatch:o}=u.current;return s(e)(t,o)},getSelectionAdf:()=>{if(!u.current)return null;let{state:t}=u.current;if((0,i.expValEquals)("platform_editor_block_menu","isEnabled",!0))return k(e?.blockControls?.sharedState.currentState()?.preservedSelection||t.selection);let{selectionRanges:o,selectedNodeAdf:n}=A(t);return{selectedNodeAdf:n,selectionRanges:o}},getDocumentFromSelection:()=>{if(!u.current)return null;let{state:t}=u.current;if((0,i.expValEquals)("platform_editor_block_menu","isEnabled",!0))return x(e?.blockControls?.sharedState.currentState()?.preservedSelection||t.selection);let{selectedNodeAdf:o}=C(t);return{selectedNodeAdf:o}}},usePluginHook:()=>{(0,r("6qdjm").usePluginStateEffect)(e,["selection"],()=>{!((0,i.expValEquals)("platform_editor_hydratable_ui","isEnabled",!0)&&(0,r("eTj7Y").isSSR)())&&m&&(0,i.expValEquals)("platform_editor_toolbar_aifc_selection_extension","isEnabled",!0)&&e?.toolbar?.actions.registerComponents(H({api:e,config:t}),!0)})},contentComponent:({editorView:t})=>!t||(0,i.expValEquals)("platform_editor_hydratable_ui","isEnabled",!0)&&(0,r("eTj7Y").isSSR)()?null:(0,a.jsx)(P,{editorView:t,api:e,editorAnalyticsAPI:e?.analytics?.actions}),pluginsOptions:{selectionToolbar:m?void 0:(i,s)=>{if(!t)return;let{pageModes:c}=t;if(!h?.length&&!b?.length&&!f?.length)return;let p=e?.editorViewMode?.sharedState.currentState()?.mode;if(c&&(!p||!(Array.isArray(c)?c:[c]).includes(p)))return;let m=d.getState(i);if(m?.activeExtension)return;let g=t=>o=>{let n=v(t,e);o.component&&e?.core.actions.execute(e?.selectionExtension.commands.setActiveExtension({extension:o,selection:n}));let{selectedNodeAdf:a,selectionRanges:r,selectedNode:i,nodePos:s}=A(t.state);o.onClick?.({selectedNodeAdf:a,selectionRanges:r}),e?.core?.actions.execute(({tr:e})=>(e.setMeta(d,{type:l.SET_SELECTED_NODE,selectedNode:i,nodePos:s}),e))},y=(t,o)=>{let n=t?.isDisabled instanceof Function?t?.isDisabled?.({selection:u.current?v(u.current,e):void 0}):t?.isDisabled;return{title:t.name,icon:t.icon?(0,a.jsx)(t.icon,{label:""}):void 0,disabled:n,rank:o,onClick:()=>(u.current&&g(u.current)(t),!0)}};if(n&&i.selection.eq(o))return R({overflowOptions:n,extensionList:f});let _=[...h,...w(f,"first-party")],S=[...b,...w(f,"external")];return n=[..._.map(e=>y(e,30)),...(e=>{let t=[];if(e?.length){t=e.map(e=>y(e));let o={type:"overflow-dropdown-heading",title:s.formatMessage(r("1o1Zn").selectionExtensionMessages.externalExtensionsHeading)};t.unshift(o)}return t})(S)],o=i.selection,R({overflowOptions:n,extensionList:f})}},pmPlugins:()=>[{name:"selectionExtension",plugin:()=>c()},{name:"selectionExtensionGetEditorViewReferencePlugin",plugin:()=>new(0,r("1S4f7").SafePlugin)({view:e=>(u.current=e,{destroy:()=>{delete u.current}})})}]}}}),i("5Qu3R",function(e,o){var n=r("l998X"),a=r("42omo"),i=r("dZ8uq"),s=r("jSnXV"),l=r("1oCLl");let d=`
    background-color: var(--ds-background-neutral, #DCDFE4);
  `,c=`
    background-color: var(--ds-background-accent-blue-subtlest, #E9F2FF);
    border-bottom: var(--ds-border-width-selected, 2px) solid var(--ds-background-accent-blue-subtler, #cce0ff);
  `,p=(e,t,o)=>{let n=[];return e.nodesBetween(t.from,t.to,(e,a)=>{if(!e.isText)return!0;let i=t.from,s=t.to;return a>t.from&&(i=a),a+e.nodeSize<t.to&&(s=a+e.nodeSize),n.push(r("ftzrq").Decoration.inline(i,s,{style:o?c:d,"data-testid":"selection-marker-selection"})),!0}),n},u={content:"''",position:"absolute",backgroundImage:"url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMyIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDMgMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMSAxSDBMMSAxLjg1NzE0VjE4LjE0MzNMMCAxOS4wMDA0SDNMMiAxOC4xNDMzVjEuODU3MTRMMyAxSDJIMVoiIGZpbGw9IiM1NzlERkYiLz4KPHJlY3QgeT0iMTkiIHdpZHRoPSIzIiBoZWlnaHQ9IjEiIGZpbGw9IiM1NzlERkYiLz4KPHJlY3Qgd2lkdGg9IjMiIGhlaWdodD0iMSIgZmlsbD0iIzU3OURGRiIvPgo8L3N2Zz4K')",top:"var(--ds-space-0, 0px)",bottom:"var(--ds-space-negative-025, -2px)",backgroundRepeat:"no-repeat",backgroundPositionX:"center",backgroundPositionY:"center",backgroundSize:"contain",aspectRatio:"3/20",left:"0px",marginLeft:"var(--ds-space-negative-025, -2px)",right:"0px",marginRight:"var(--ds-space-negative-025, -2px)",pointerEvents:"none"},m={content:"''",position:"absolute",background:`var(--ds-text, ${r("6fnsQ").N500})`,width:"1px",display:"inline-block",top:"var(--ds-space-0, 0px)",bottom:"var(--ds-space-negative-025, -2px)",left:"1px",marginLeft:"var(--ds-space-negative-025, -2px)",right:"0px",marginRight:"var(--ds-space-negative-025, -2px)",pointerEvents:"none"},f={content:"''",position:"relative",pointerEvents:"none",borderLeft:`var(--ds-border-width, 1px) solid var(--ds-text, ${r("6fnsQ").N500})`,marginLeft:"-1px",left:"0.5px"},g=({type:e,isHighlight:t,isInWord:o})=>{let n=document.createElement("span");for(let[e,a]of Object.entries(t?u:o?f:m))n.style.setProperty(e.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`).replace(/^ms/,"-ms"),a);return n.setAttribute("contentEditable","false"),n.dataset.testid=`selection-marker-${e}-cursor`,n},h=(e,t,o)=>{let n=document.createElement("span");return n.contentEditable="false",n.setAttribute("style","position: relative;"),n.appendChild(g({type:e,isHighlight:t,isInWord:o})),n},b=e=>{let{nodeBefore:t,nodeAfter:o}=e;return t?.isInline||o?.isInline},y=(e,t,o,n)=>{if(!(o instanceof r("ks2lK").TextSelection)||!1===b(e)||!o.empty)return[];let{nodeBefore:a,nodeAfter:i,parent:s}=e,l=s.isTextblock&&a?.isText&&i?.isText,d=a?.textContent?.slice(-1),c=i?.textContent?.slice(0,1),p=/\S/u.test(d||"")&&/\S/u.test(c||"");return[r("ftzrq").Decoration.widget(e.pos,h(t,n,!!(l&&p)),{side:-1,key:`${t}WidgetDecoration`,stopEvent:()=>!0,ignoreSelection:!0})]},_=new(0,r("ks2lK").PluginKey)("selectionMarker"),S=(e,t,o)=>{let n=e.getMeta(_);if(!n&&!e.selectionSet)return t;let a=n?.forceHide??t.forceHide,i=n?.shouldHideDecorations??t.shouldHideDecorations,s=i||(0,r("2pjJ5").isEmptyDocument)(e.doc)?"none":"blur",l=t.decorations;return{decorations:l=o.selection.empty&&!e.selection.empty||t.decorationType!==s?function(e,t){let{selection:o}=e;switch(t){case"none":return r("ftzrq").DecorationSet.empty;case"highlight":return r("ftzrq").DecorationSet.create(e.doc,[...y(o.$anchor,"anchor",o,!0),...p(e.doc,o,!0),...y(o.$head,"head",o,!0)]);case"blur":return r("ftzrq").DecorationSet.create(e.doc,[...y(o.$anchor,"anchor",o,!1),...p(e.doc,o,!1)])}}(e,s):l.map(e.mapping,e.doc,{}),shouldHideDecorations:i,forceHide:a,decorationType:s}},E=t(s)(e=>_.getState(e)?.decorations,25),v=e=>new(0,r("1S4f7").SafePlugin)({key:_,state:{init:()=>({decorations:r("ftzrq").DecorationSet.empty,shouldHideDecorations:!0,forceHide:!1,decorationType:"none"}),apply:S},props:{decorations:e=>((0,l.expValEquals)("platform_editor_hydratable_ui","isEnabled",!0)?(0,r("d7ZU3").getBrowserInfo)():r("d7ZU3").browser).ie?E(e):_.getState(e)?.decorations}}),T={name:"1dgyfx",styles:'.ProseMirror:not(:focus):not([contenteditable="false"]) ::selection:not(input, .cm-editor){background:unset;}'},C={name:"1ors4v5",styles:".ProseMirror  *.danger::selection{background:transparent;}"},x=()=>(0,r("9K4OG").jsx)(r("9K4OG").Global,{styles:[T,(0,i.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)&&C]});e.exports.selectionMarkerPlugin=({config:e,api:t})=>({name:"selectionMarker",pmPlugins:()=>[{name:"selectionMarkerPmPlugin",plugin:()=>v(t)}],getSharedState(e){if(e)return{isForcedHidden:_.getState(e)?.forceHide??!1,isMarkerActive:!_.getState(e)?.shouldHideDecorations}},actions:{hideDecoration:()=>{if(!t?.selectionMarker?.sharedState.currentState()?.isForcedHidden&&t?.core?.actions.execute(({tr:e})=>e.setMeta(_,{forceHide:!0}))){var e;let o;return e=t,o=!1,()=>{if(!o&&e?.selectionMarker?.sharedState.currentState()?.isForcedHidden)return o=!0,e?.core?.actions.execute(({tr:e})=>e.setMeta(_,{forceHide:!1}))}}},queueHideDecoration:e=>{let o=t?.selectionMarker.actions.hideDecoration();if(void 0===o){let o=t?.selectionMarker?.sharedState.onChange(({nextSharedState:n})=>{n?.isForcedHidden===!1&&n?.isMarkerActive===!1&&(e(t?.selectionMarker.actions.hideDecoration()),o?.())});return o}return e(o),()=>{}}},usePluginHook({editorView:o}){let n=(0,a.useRef)(!0);(0,a.useEffect)(()=>{n.current=!0},[o]);let{hasFocus:s,isOpen:l,editorDisabled:d,showToolbar:c,hasDangerDecorations:p,currentUserIntent:u}=(0,r("eiA8Z").useSharedPluginStateWithSelector)(t,["focus","typeAhead","editorDisabled","toolbar","decorations","userIntent"],e=>({hasFocus:e.focusState?.hasFocus,isOpen:e.typeAheadState?.isOpen,editorDisabled:e.editorDisabledState?.editorDisabled,showToolbar:e.toolbarState?.shouldShowToolbar,hasDangerDecorations:(0,i.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)?e.decorationsState?.hasDangerDecorations:void 0,currentUserIntent:e.userIntentState?.currentUserIntent})),m=(0,r("b3YrF").useSharedPluginStateSelector)(t,"selectionMarker.isForcedHidden");(0,a.useEffect)(()=>{!0===s&&(n.current=!1);let t="blockMenuOpen"===u&&(0,i.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0),a=e?.hideCursorOnInit&&n.current||s||(l??!1)||m||(d??!1)||(c??!1)||!!p&&(0,i.expValEqualsNoExposure)("platform_editor_block_menu","isEnabled",!0)||t;requestAnimationFrame(()=>(function(e,t){let{dispatch:o,state:n}=e;o(n.tr.setMeta(_,{shouldHideDecorations:t}))})(o,a))},[o,s,l,m,d,c,p,u])},contentComponent:()=>(0,n.jsx)(x,{})})}),i("1ewUw",function(e,o){var n,a=r("l998X"),i=r("42omo"),s=r("1oCLl"),l=r("iu6m9"),d=((n={}).UPDATE_STATE="UPDATE_STATE",n.UPDATE_KEYWORD_REGEX="UPDATE_KEYWORD_REGEX",n.UPDATE_KEYWORD_DECORATIONS_SESSION_ID="UPDATE_KEYWORD_DECORATIONS_SESSION_ID",n.UPDATE_KEYWORD_DECORATIONS="UPDATE_KEYWORD_DECORATIONS",n.OPEN_READING_AIDS_POPUP="OPEN_READING_AIDS_POPUP",n.CLOSE_READING_AIDS_POPUP="CLOSE_READING_AIDS_POPUP",n.READING_AIDS_POPUP_LOADED="READING_AIDS_POPUP_LOADED",n),c=r("cUcZ5");function p(e){let{name:t}=e.mark.type;return"annotation"===t}let u=new(0,r("ks2lK").PluginKey)("aiDefinitions"),{createCommand:m,getPluginState:f,createPluginState:g}=(0,r("lkJUe").pluginFactory)(u,(e,o)=>{switch(o.type){case d.UPDATE_STATE:return{...e,enabled:o.enabled??e.enabled,autoHighlightEnabled:o.autoHighlightEnabled??e.autoHighlightEnabled,enablementSource:o.enablementSource??e.enablementSource};case d.UPDATE_KEYWORD_REGEX:return{...e,keywordRegex:o.keywordRegex};case d.UPDATE_KEYWORD_DECORATIONS_SESSION_ID:return{...e,keywordDecorationsSessionId:t(c)()};case d.UPDATE_KEYWORD_DECORATIONS:return{...e,keywordDecorations:o.keywordDecorations};case d.OPEN_READING_AIDS_POPUP:return{...e,currentKeywordId:o.keywordId,isReadingAidsPopupOpen:!0,readingAidsPopupKey:t(c)(),readingAidsPopupProps:o.readingAidsPopupProps,isReadingAidsPopupLoading:!0};case d.CLOSE_READING_AIDS_POPUP:return{...e,currentKeywordId:void 0,isReadingAidsPopupOpen:!1,readingAidsPopupKey:void 0,readingAidsPopupProps:void 0};case d.READING_AIDS_POPUP_LOADED:return{...e,isReadingAidsPopupLoading:!1};default:return e}},{mapping:function(e,t){let{enabled:o,autoHighlightEnabled:n}=t,{keywordDecorations:a}=t;return o&&n?(a=a.map(e.mapping,e.doc),{...t,keywordDecorations:a}):t},onDocChanged:function(e,o){let{enabled:n,autoHighlightEnabled:a,keywordDecorationsSessionCounter:i}=o;return n&&a?o.keywordRegex?e.steps.every(e=>e instanceof r("aXG5V").AddMarkStep&&!p(e)||e instanceof r("aXG5V").RemoveMarkStep&&!p(e)||e instanceof r("aXG5V").AddNodeMarkStep&&!p(e)||e instanceof r("aXG5V").RemoveNodeMarkStep&&!p(e)||e instanceof r("aXG5V").AttrStep||e instanceof r("aXG5V").DocAttrStep||e instanceof r("9YoeD").SetAttrsStep||e instanceof r("8EkET").LinkMetaStep||e instanceof r("cuprm").InsertTypeAheadStep||e instanceof r("jy7VG").AnalyticsStep)?o:{...o,keywordRegex:void 0,keywordDecorationsSessionId:t(c)(),keywordDecorationsSessionCounter:i+1}:{...o,keywordDecorationsSessionCounter:i+1}:o}});var h=r("jSnXV");let b=(e,t)=>({action:r("d925B").ACTION.CLICKED,actionSubject:r("d925B").ACTION_SUBJECT.BUTTON,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.AI_DEFINITIONS_DEFINE_BUTTON,eventType:r("d925B").EVENT_TYPE.UI,attributes:{readingAidsSessionId:e,wordCount:t}}),y=e=>({action:r("d925B").ACTION.CLICKED,actionSubject:r("d925B").ACTION_SUBJECT.DECORATION,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.AI_DEFINITIONS_AUTO_HIGHLIGHT,eventType:r("d925B").EVENT_TYPE.UI,attributes:{readingAidsSessionId:e}}),_=({source:e,readingAidsSessionId:t,wordCount:o})=>"define-button-click"===e?b(t,o):y(t),S=({error:e,errorInfo:t})=>({action:r("d925B").ACTION.ERRORED,actionSubject:r("d925B").ACTION_SUBJECT.AI_DEFINITIONS,eventType:r("d925B").EVENT_TYPE.OPERATIONAL,attributes:{errorMessage:r("2QlXt").ErrorUtils.extractErrorMessage(e),componentStack:t?.componentStack||""}}),E="editor-ai-definitions-reading-aids-popup-portal-container",v="ai-definitions-keyword-decoration",T="ai-definitions-keyword-styler",C="ai-definitions-keyword-styler-hover",x="ai-definitions-keyword-styler-loading",A=e=>{let{from:t,to:o}=e.selection;return e.doc.textBetween(t,o,"\n").trim()},k=e=>!e.selection.empty&&A(e).length>0,I=e=>A(e).split(/\s+/u).length,P=(e,t)=>I(e)>(t.readingAidsMaxWordCount??1);function N(e){let t=document.getElementById(E);if(!t)return null;let o=t.getBoundingClientRect(),n=e.getBoundingClientRect();return{top:n.top-o.top,left:n.left-o.left,width:n.width,height:n.height}}let w=e=>{if(!e||!e.selection||e.selection.empty)return null;let t=window.getSelection();if(!t||!t.rangeCount)return null;let o=t.getRangeAt(0);if(!o||o.collapsed)return null;let{from:n,to:a}=e.selection,r=e.doc.textBetween(n,a,"\n"),i=N(o);return{selectionRange:o,selectionRect:i,selectedText:r,isEditor:!0}},D=e=>{let t=document.querySelector(`.${T}-${e}`);t&&t.classList.add(`${x}`)},O=()=>{for(let e of document.querySelectorAll(`.${x}`))e.classList.remove(`${x}`)},M=e=>{let{target:t}=e;if(V(t)&&t.dataset.id){let e=t.dataset.id,o=document.querySelector(`.${T}-${e}`);o&&o.classList.add(`${C}`)}},R=e=>{let{target:t}=e;if(V(t)&&t.dataset.id){let e=t.dataset.id,o=document.querySelector(`.${T}-${e}`);o&&o.classList.remove(`${C}`)}},L=e=>{let t=e.dataset.id;if(!t)return;let o=document.querySelectorAll(`.${v}-${t}`),n=o[0],a=o[o.length-1];if(e&&e instanceof HTMLSpanElement&&V(n)&&V(a)){let t=document.createRange();t.setStartBefore(n),t.setEndAfter(a);let o=t.getBoundingClientRect();e.style.setProperty("--ai-definitions-keyword-styler-width",`${o.width}px`),e.style.setProperty("--ai-definitions-keyword-styler-height",`${o.height}px`)}},B=({id:e})=>{let t=document.createElement("span");return t.classList.add(T,`${T}-${e}`),t.dataset.id=e,t};function V(e){return!!(e&&e instanceof HTMLSpanElement&&e.classList.contains(v))}let F=({event:e,editorView:t,api:o})=>{let{target:n}=e,{isReadingAidsPopupOpen:a,currentKeywordId:r,isReadingAidsPopupLoading:i}=f(t.state);if(V(n)&&n.dataset.id){let s=n.dataset.id;if(s===r&&i)return e.stopPropagation(),e.preventDefault(),!0;if(!a)return function({event:e,editorView:t,api:o,id:n}){let a=document.querySelectorAll(`.${v}-${n}`),r=a[0],i=a[a.length-1];if(V(r)&&V(i)){let a=function({keywordStart:e,keywordEnd:t,editorView:o}){let n=document.createRange();n.setStartBefore(e),n.setEndAfter(t);let a=N(n),r=e.parentElement,i=r?r.textContent||r.innerText:"";return{selectedText:n.toString(),additionalContext:i,selectionRange:n,selectionRect:a,onResult:()=>{},onLoad:()=>{O(),j()(o.state,o.dispatch)},onClose:()=>{W({editorView:o})},isAutohighlighted:!0,isEditor:!0}}({keywordStart:r,keywordEnd:i,editorView:t});return D(n),q({api:o,source:"auto-highlight-click",keywordId:n,readingAidsPopupProps:a})(t.state,t.dispatch),e.preventDefault(),e.stopPropagation(),!0}return!1}({event:e,editorView:t,api:o,id:s})}return a&&W({editorView:t}),!1},U=({keywordMatch:e})=>{let{from:t,to:o,text:n}=e,a=`${t}-${o}-${""===n?"_":n.replace(/[^a-zA-Z0-9-]/g,function(e){return"_"+e[0].charCodeAt(0).toString(16)})}`;return[r("ftzrq").Decoration.inline(t,o,{class:`${v} ${v}-${a}`,"data-id":a,"data-testid":v},{type:"keyword",key:`${v}-${a}`}),r("ftzrq").Decoration.widget(o,()=>B({id:a}),{type:"keywordStyler",key:`${T}-${a}`,stopEvent:()=>!0,ignoreSelection:!0})]},G=({keywordRegex:e})=>m({type:d.UPDATE_KEYWORD_REGEX,keywordRegex:e}),q=({api:e,source:o,keywordId:n,readingAidsPopupProps:a})=>{let r=t(c)();return m({type:d.OPEN_READING_AIDS_POPUP,keywordId:n,readingAidsPopupProps:{...a,sessionId:r}},t=>{if(e){let n=_({source:o,readingAidsSessionId:r,wordCount:a.selectedText.split(/\s+/u).length});e.analytics?.actions.attachAnalyticsEvent(n)(t)}return t})},H=()=>m({type:d.CLOSE_READING_AIDS_POPUP}),j=()=>m({type:d.READING_AIDS_POPUP_LOADED}),$=({keywordDecorations:e})=>m({type:d.UPDATE_KEYWORD_DECORATIONS,keywordDecorations:e}),K=async({api:e,config:t,editorView:o})=>{try{let e=f(o.state),{keywordRegex:n}=e;if(!n){let{keywordDecorationsSessionId:a}=e,i=await t.queryHighlightAcronyms?.({cacheKey:a});if(function({editorView:e,keywordDecorationsSessionId:t}){return t!==f(e.state).keywordDecorationsSessionId}({editorView:o,keywordDecorationsSessionId:a}))return;if(i&&i.acronymRegex){n=i.acronymRegex,G({keywordRegex:n})(o.state,o.dispatch);let e=function({editorView:e,keywordRegex:t}){let o=r("ftzrq").DecorationSet.empty;for(let n of function({content:e,keywordRegex:t,contentIndex:o=0}){let n=new Set,a=[],r=null,i=e=>{if(!e)return;let{text:r,pos:i}=e,s=o+i;for(let e of r.matchAll(t)){let o=e[0],r=t.ignoreCase?o.toUpperCase():o;n.has(r)||(n.add(r),a.push({from:s+e.index,to:s+e.index+o.length,text:o}))}};return e.descendants((e,t)=>{if(function(e){let{name:t}=e.type;return"codeBlock"===t||"status"===t}(e))return!1;if(e.isText&&e.text){let o=e.text;e.isText&&e.marks.some(e=>{let{name:t}=e.type;return"annotation"===t||"link"===t||"code"===t})&&(o=" ".repeat(o.length)),null===r?r={pos:t,text:o}:r.text+=o}else r&&i(r),r=null}),r&&i(r),a}({content:e.state.doc,keywordRegex:t})){let t=U({keywordMatch:n});o=o.add(e.state.doc,t)}return o}({editorView:o,keywordRegex:n});$({keywordDecorations:e})(o.state,o.dispatch)}}}catch(t){e?.analytics?.actions.fireAnalyticsEvent(S({error:t}))}},z=t(h)(K,1e3);function W({editorView:e}){O(),H()(e.state,e.dispatch)}let Y=({api:e,config:t,editorView:o,autoHighlightEnabled:n,livePageMode:a})=>{if(W({editorView:o}),n&&"view"===a){let n=function(e){let t=new MutationObserver(e=>{for(let t of e)for(let e of t.addedNodes)e instanceof HTMLSpanElement&&e.classList.contains(T)&&L(e)});return t.observe(e,{childList:!0,subtree:!0}),()=>{t.disconnect()}}(o.dom);for(let e of document.querySelectorAll(`.${T}`))e instanceof HTMLSpanElement&&L(e);return K({api:e,config:t,editorView:o}),n}},X=({dispatch:e},{api:o,config:n})=>new(0,r("1S4f7").SafePlugin)({key:u,state:g(e,()=>(function({config:e}){return{enabled:e.enabled??!0,autoHighlightEnabled:e.autoHighlightEnabled??!0,enablementSource:e.enablementSource,keywordDecorationsSessionId:t(c)(),keywordDecorationsSessionCounter:0,keywordDecorations:r("ftzrq").DecorationSet.empty,isReadingAidsPopupOpen:!1,isReadingAidsPopupLoading:!1}})({config:n})),view:e=>({update:(e,t)=>{let{enabled:a,autoHighlightEnabled:r}=f(e.state);if(!a||!r)return;let{keywordRegex:i,keywordDecorationsSessionCounter:s}=f(e.state),l=f(t);o?.editorViewMode.sharedState.currentState()?.mode!=="view"||i||s===l.keywordDecorationsSessionCounter||z({api:o,config:n,editorView:e})}}),props:{decorations(e){let{enabled:t,autoHighlightEnabled:n,keywordDecorations:a}=f(e);if(t&&n)return o?.editorViewMode.sharedState.currentState()?.mode==="view"?a:r("ftzrq").DecorationSet.empty},handleDOMEvents:{mouseover:(e,t)=>{let{enabled:n,autoHighlightEnabled:a}=f(e.state);n&&a&&o?.editorViewMode.sharedState.currentState()?.mode==="view"&&M(t)},mouseout:(e,t)=>{let{enabled:n,autoHighlightEnabled:a}=f(e.state);n&&a&&o?.editorViewMode.sharedState.currentState()?.mode==="view"&&R(t)},click:(e,t)=>{let{enabled:n,autoHighlightEnabled:a}=f(e.state);n&&a&&o?.editorViewMode.sharedState.currentState()?.mode==="view"&&F({editorView:e,event:t,api:o})}}}});r("42omo");let J=(0,r("cgtv4").defineMessages)({aiDefineToolbarButtonTitle:{id:"fabric.editor.ai.selectionToolbar.define.title",defaultMessage:"Define"},aiDefineToolbarButtonDisabledTooltip:{id:"fabric.editor.ai.selectionToolbar.define.disabled.tooltip",defaultMessage:"Highlight a term, acronym, or abbreviation"}}),Q=({intl:e,state:o,config:n,api:i})=>{let s=f(o),l=w(o),d=P(o,n)||!l;return{title:e.formatMessage(J.aiDefineToolbarButtonTitle),type:"button",showTitle:!0,testId:"ak-editor-ai-selection-toolbar-define-button",icon:()=>"rovo"===s.enablementSource?(0,a.jsx)(r("lAFHW").RovoIcon,{size:"small"}):(0,a.jsx)(t(r("3Mg7y")),{label:""}),iconFallback:()=>(0,a.jsx)(r("4Nwes").AtlassianIcon,{size:"small"}),tooltipContent:d?e.formatMessage(J.aiDefineToolbarButtonDisabledTooltip):void 0,disabled:d,onClick:l?q({api:i,source:"define-button-click",readingAidsPopupProps:l}):void 0,supportsViewMode:!0}};r("42omo");let Z={name:"yu6qqn",styles:".ai-definitions-keyword-decoration{position:relative;cursor:pointer;}.ai-definitions-keyword-styler{--ai-definitions-keyword-styler-width:0;--ai-definitions-keyword-styler-height:0;position:relative;&::after{content:' ';position:absolute;top:0;right:0;width:var(--ai-definitions-keyword-styler-width);height:var(--ai-definitions-keyword-styler-height);cursor:pointer;pointer-events:none;border-image:linear-gradient(to right, #0065ff, #bf63f3, #f5e6a8) 0 0 100% 0;border-width:var(--ds-border-width-selected, 2px);border-bottom-style:solid;}&-hover{&::after{background:linear-gradient(to right, rgba(0, 101, 255, 0.1), rgba(191, 99, 243, 0.1));}}&-loading{&::after{border-color:transparent;border-image:none;}}}"};function ee(){return(0,a.jsx)(r("9K4OG").Global,{styles:Z})}let et=e=>{let{api:t,editorView:o}=e,{enabled:n,autoHighlightEnabled:s,readingAidsPopupProps:l,readingAidsPopupKey:d,isReadingAidsPopupOpen:c,mode:p}=(0,r("eiA8Z").useSharedPluginStateWithSelector)(t,["aiDefinitions","editorViewMode"],e=>({enabled:e.aiDefinitionsState?.enabled,autoHighlightEnabled:e.aiDefinitionsState?.autoHighlightEnabled,readingAidsPopupProps:e.aiDefinitionsState?.readingAidsPopupProps,readingAidsPopupKey:e.aiDefinitionsState?.readingAidsPopupKey,isReadingAidsPopupOpen:e.aiDefinitionsState?.isReadingAidsPopupOpen,mode:e.editorViewModeState?.mode})),u=(0,i.useCallback)(()=>{},[]),m=(0,i.useCallback)(()=>{l?.onLoad?.()},[l]),f=(0,i.useCallback)(()=>{H()(o.state,o.dispatch)},[o]),{show:g,contentId:h,ReadingAidsPopup:b,readingAidsPopupKey:y,readingAidsPopupProps:_}=function({props:e,enabled:t,autoHighlightEnabled:o,readingAidsPopupProps:n,readingAidsPopupKey:a,isReadingAidsPopupOpen:r}){let{contentId:i,ReadingAidsPopup:s,editorView:l}=e;return l&&void 0!==t&&void 0!==o&&i&&s&&r&&a&&n?{show:!0,contentId:i,ReadingAidsPopup:s,isReadingAidsPopupOpen:r,readingAidsPopupKey:a,readingAidsPopupProps:n}:{show:!1,contentId:void 0,ReadingAidsPopup:void 0,isReadingAidsPopupOpen:!1,readingAidsPopupKey:void 0,readingAidsPopupProps:void 0}}({props:e,enabled:n,autoHighlightEnabled:s,readingAidsPopupProps:l,readingAidsPopupKey:d,isReadingAidsPopupOpen:c});return(!function({api:e,show:t}){(0,i.useEffect)(()=>(t?e?.selectionToolbar.actions?.suppressToolbar?.():e?.selectionToolbar.actions?.unsuppressToolbar?.(),()=>{e?.selectionToolbar.actions?.unsuppressToolbar?.()}),[e,t])}({api:t,show:g}),n&&s&&((0,r("dh538").fg)("platform_editor_ai_aifc_streaming")||"view"===p))?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ee,{}),(0,a.jsx)("div",{id:E,className:(0,r("gMc0m").default)(["_kqswh2mm"])}),g?(0,a.jsx)(b,{..._,isReadingAidsOpen:!0,popupPortalContainerId:E,contentId:h,onResult:_?.onResult||u,onLoad:m,onClose:_?.onClose||f},y):null]}):null};class eo extends t(i).Component{static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,t){this.props.api?.analytics?.actions.fireAnalyticsEvent(S({error:e,errorInfo:t}))}render(){return this.state.hasError?null:this.props.children}constructor(...e){super(...e),this.state={hasError:!1}}}e.exports.aiDefinitionsPlugin=({api:e,config:t})=>{let o={current:void 0};return{name:"aiDefinitions",usePluginHook:({editorView:o})=>{let n=(0,r("b3YrF").useSharedPluginStateSelector)(e,"aiDefinitions.enabled"),a=(0,r("b3YrF").useSharedPluginStateSelector)(e,"aiDefinitions.autoHighlightEnabled"),s=(0,r("b3YrF").useSharedPluginStateSelector)(e,"editorViewMode.mode");(0,i.useEffect)(()=>{if(n)return Y({api:e,config:t,editorView:o,livePageMode:s,autoHighlightEnabled:a})},[o,n,a,s])},pmPlugins(){let n=[{name:"aiDefinitionsEditorViewRef",plugin:()=>new(0,r("1S4f7").SafePlugin)({view:e=>(o.current=e,{})})}];return n.push({name:"aiDefinitions",plugin:o=>X(o,{api:e,config:t})}),n},getSharedState(e){if(!e)return null;let t=u.getState(e);return t?{enabled:t.enabled,autoHighlightEnabled:t.autoHighlightEnabled,isReadingAidsPopupOpen:t.isReadingAidsPopupOpen,readingAidsPopupKey:t.readingAidsPopupKey,readingAidsPopupProps:t.readingAidsPopupProps}:null},contentComponent:({editorView:o})=>!o||(0,r("eTj7Y").isSSR)()&&(0,s.expValEquals)("platform_editor_hydratable_ui","isEnabled",!0)?null:(0,a.jsx)(eo,{api:e,children:(0,a.jsx)(et,{api:e,editorView:o,contentId:t.contentId,ReadingAidsPopup:t.ReadingAidsPopup})}),pluginsOptions:{selectionToolbar:(o,n)=>{if(!f(o).enabled)return;let a=[];if(e&&k(o)){let r=e?.editorViewMode.sharedState.currentState()?.mode==="view"?Q({intl:n,state:o,config:t,api:e}):null;r&&a.push(r)}if(a.length)return{rank:(0,l.editorExperiment)("platform_editor_controls","variant1")?10:-10,isToolbarAbove:!0,items:a}}},commands:{updateState:function({editorViewRef:e}){return t=>({tr:o})=>{if(!e.current)return null;let n=f(e.current.state);if(["enabled","autoHighlightEnabled","enablementSource"].every(e=>void 0===t[e]||t[e]===n[e]))return null;let a={type:d.UPDATE_STATE,...t};return o.setMeta(u,a)}}({editorViewRef:o})},actions:{openReadingAidsPopup:()=>{let t=w(o.current?.state);o.current&&o.current.state&&o.current.dispatch&&t&&q({api:e,readingAidsPopupProps:t,source:"define-button-click"})(o.current.state,o.current.dispatch)},selectionExceedsMaxWordCount:()=>{let e=o.current?.state;return!!e&&P(e,t)}}}}}),i("7OCNe",function(e,o){let n,a;var i,s,l=r("l998X");r("42omo");var d=r("jSnXV"),c={},p=r("5jDm8"),u=r("4U5Tv"),m=r("h86W2"),f=parseFloat,g=Math.min,h=Math.random;c=function(e,t,o){if(o&&"boolean"!=typeof o&&u(e,t,o)&&(t=o=void 0),void 0===o&&("boolean"==typeof t?(o=t,t=void 0):"boolean"==typeof e&&(o=e,e=void 0)),void 0===e&&void 0===t?(e=0,t=1):(e=m(e),void 0===t?(t=e,e=0):t=m(t)),e>t){var n=e;e=t,t=n}if(o||e%1||t%1){var a=h();return g(e+a*(t-e+f("1e-"+((a+"").length-1))),t)}return p(e,t)};class b{get retries(){return this._retries}isActive(){return this.active}isExhausted(){return this._retries>=this.maxRetries}init({onRetry:e,onRetryEnqueue:t,onRetriesExhausted:o}){return this.onRetry=e,this.onRetryEnqueue=t,this.onRetriesExhausted=o,()=>{this.reset(),this.onRetry=void 0,this.onRetryEnqueue=void 0,this.onRetriesExhausted=void 0}}enqueueRetry(e){if(this.isExhausted()&&!this.onRetriesExhausted?.(this._retries))return!1;if(!this.active){this.active=!0;let o=e??this.delay*2**this._retries,n=t(c)(0,this.jitter*1.3**this._retries);if(!this.onRetryEnqueue?.(this._retries))return this.timerId=setTimeout(this.onComplete.bind(this),o+n),!0}return!1}onComplete(){this.active=!1,this.timerId=void 0,this._retries++,this.onRetry?.(this._retries)}reset(){clearTimeout(this.timerId),this.timerId=void 0,this._retries=0,this.active=!1}constructor(e,t=2e3,o=3){this.delay=e,this.jitter=t,this.maxRetries=o,this.active=!1,this._retries=0,this.onRetry=void 0,this.onRetryEnqueue=void 0,this.onRetriesExhausted=void 0,this.timerId=void 0}}let y=new(0,r("ks2lK").PluginKey)("aiProactivePlugin");var _=r("iSWIi");let S=(0,r("cgtv4").defineMessages)({toggleAllSuggestionsTitle:{id:"fabric.editor.ai.proactive.moreMenu.toggleAllSuggestionsTitle.non-final",defaultMessage:"All suggestions"},toggleAllSuggestionsDescription:{id:"fabric.editor.ai.proactive.moreMenu.toggleAllSuggestionsDescription.non-final",defaultMessage:"Toggle to turn suggested edits on or off."},toggleAllPanelSuggestionsTitle:{id:"fabric.editor.ai.proactive.moreMenu.toggleAllPanelSuggestionsTitle.non-final",defaultMessage:"Panels"},toggleAllPanelSuggestionsDescription:{id:"fabric.editor.ai.proactive.moreMenu.toggleAllPanelSuggestionsDescription.non-final",defaultMessage:"Use panels to make your message stand out."},toggleErrorPanelTitle:{id:"fabric.editor.ai.proactive.moreMenu.toggleErrorPanelTitle.non-final",defaultMessage:"Error panel"},toggleErrorPanelDescription:{id:"fabric.editor.ai.proactive.moreMenu.toggleErrorPanelDescription.non-final",defaultMessage:"Transform text into a red error panel."},toggleInfoPanelTitle:{id:"fabric.editor.ai.proactive.moreMenu.toggleInfoPanelTitle.non-final",defaultMessage:"Info panel"},toggleInfoPanelDescription:{id:"fabric.editor.ai.proactive.moreMenu.toggleInfoPanelDescription.non-final",defaultMessage:"Transform text into a blue information panel."},toggleNotePanelTitle:{id:"fabric.editor.ai.proactive.moreMenu.toggleNotePanelTitle.non-final",defaultMessage:"Note panel"},toggleNotePanelDescription:{id:"fabric.editor.ai.proactive.moreMenu.toggleNotePanelDescription.non-final",defaultMessage:"Transform text into a purple note panel."},toggleSuccessPanelTitle:{id:"fabric.editor.ai.proactive.moreMenu.toggleSuccessPanelTitle.non-final",defaultMessage:"Success panel"},toggleSuccessPanelDescription:{id:"fabric.editor.ai.proactive.moreMenu.toggleSuccessPanelDescription.non-final",defaultMessage:"Transform text into a green success panel."},toggleWarningPanelTitle:{id:"fabric.editor.ai.proactive.moreMenu.toggleWarningPanelTitle.non-final",defaultMessage:"Warning panel"},toggleWarningPanelDescription:{id:"fabric.editor.ai.proactive.moreMenu.toggleWarningPanelDescription.non-final",defaultMessage:"Transform text into a yellow warning panel."},toggleTableTitle:{id:"fabric.editor.ai.proactive.moreMenu.toggleTableTitle.non-final",defaultMessage:"Table"},toggleTableDescription:{id:"fabric.editor.ai.proactive.moreMenu.toggleTableDescription.non-final",defaultMessage:"Format content in a table to improve readability."},toggleSplitParagraphTitle:{id:"fabric.editor.ai.proactive.moreMenu.toggleSplitParagraphTitle.non-final",defaultMessage:"Paragraph break"},toggleSplitParagraphDescription:{id:"fabric.editor.ai.proactive.moreMenu.toggleSplitParagraphDescription.non-final",defaultMessage:"Add paragraph breaks to separate key ideas."},toggleFormatParagraphTitle:{id:"fabric.editor.ai.proactive.moreMenu.toggleFormatParagraphTitle.non-final",defaultMessage:"Enhance content"},toggleFormatParagraphDescription:{id:"fabric.editor.ai.proactive.moreMenu.toggleFormatParagraphDescription.non-final",defaultMessage:"Suggestions for writing, lists, content structure, and spelling."}}),E=(0,r("cgtv4").defineMessages)({recommendationDefaultTitle:{id:"fabric.editor.ai.proactive.recommendation.default.title.non-final",defaultMessage:"Suggestion"},recommendationDefaultDescription:{id:"fabric.editor.ai.proactive.recommendation.default.description.non-final",defaultMessage:"A suggestion to improve the content."},recommendationConvertToTableTitle:{id:"fabric.editor.ai.proactive.recommendation.convertToTable.title.non-final",defaultMessage:"Format in table"},recommendationConvertToTableDescription:{id:"fabric.editor.ai.proactive.recommendation.convertToTable.description.non-final",defaultMessage:"Format content in a table to improve readability."},recommendationConvertToNotePanelTitle:{id:"fabric.editor.ai.proactive.recommendation.convertToNotePanel.title.non-final",defaultMessage:"Frame with note panel"},recommendationConvertToNotePanelDescription:{id:"fabric.editor.ai.proactive.recommendation.convertToNotePanel.description.non-final",defaultMessage:"Use a purple note panel to make your message stand out."},recommendationConvertToInfoPanelTitle:{id:"fabric.editor.ai.proactive.recommendation.convertToInfoPanel.title.non-final",defaultMessage:"Frame with info panel"},recommendationConvertToInfoPanelDescription:{id:"fabric.editor.ai.proactive.recommendation.convertToInfoPanel.description.non-final",defaultMessage:"Use a blue info panel to make your message stand out.           "},recommendationConvertToWarnPanelTitle:{id:"fabric.editor.ai.proactive.recommendation.convertToWarnPanel.title.non-final",defaultMessage:"Frame with warning panel"},recommendationConvertToWarnPanelDescription:{id:"fabric.editor.ai.proactive.recommendation.convertToWarnPanel.description.non-final",defaultMessage:"Use a yellow warning panel to make your message stand out."},recommendationConvertToErrorPanelTitle:{id:"fabric.editor.ai.proactive.recommendation.convertToErrorPanel.title.non-final",defaultMessage:"Frame with error panel"},recommendationConvertToErrorPanelDescription:{id:"fabric.editor.ai.proactive.recommendation.convertToErrorPanel.description.non-final",defaultMessage:"Use a red error panel to make your message stand out."},recommendationConvertToSuccessPanelTitle:{id:"fabric.editor.ai.proactive.recommendation.convertToSuccessPanel.title.non-final",defaultMessage:"Frame with success panel"},recommendationConvertToSuccessPanelDescription:{id:"fabric.editor.ai.proactive.recommendation.convertToSuccessPanel.description.non-final",defaultMessage:"Use a green success panel to make your message stand out."},recommendationSplitParagraphTitle:{id:"fabric.editor.ai.proactive.recommendation.splitParagraph.title.non-final",defaultMessage:"Divide paragraph"},recommendationSplitParagraphDescription:{id:"fabric.editor.ai.proactive.recommendation.splitParagraph.description.non-final",defaultMessage:"Add paragraph breaks to separate key ideas."},recommendationFormatParagraphTitle:{id:"fabric.editor.ai.proactive.recommendation.formatParagraph.title.non-final",defaultMessage:"Enhance content"},recommendationFormatParagraphDescription:{id:"fabric.editor.ai.proactive.recommendation.formatParagraph.description.non-final",defaultMessage:"Clarify content writing and structure."},recommendationFormatParagraphClarityTitle:{id:"fabric.editor.ai.proactive.recommendation.formatParagraphClarity.title.non-final",defaultMessage:"Clarify writing"},recommendationFormatParagraphClarityDescription:{id:"fabric.editor.ai.proactive.recommendation.formatParagraphClarity.description.non-final",defaultMessage:"Simplify phrasing and grammar."},recommendationFormatParagraphListTitle:{id:"fabric.editor.ai.proactive.recommendation.formatParagraphList.title.non-final",defaultMessage:"Create list"},recommendationFormatParagraphListDescription:{id:"fabric.editor.ai.proactive.recommendation.formatParagraphList.description.non-final",defaultMessage:"Turn content into a scannable list."},recommendationFormatParagraphStructureTitle:{id:"fabric.editor.ai.proactive.recommendation.formatParagraphStructure.title.non-final",defaultMessage:"Improve structure"},recommendationFormatParagraphStructureDescription:{id:"fabric.editor.ai.proactive.recommendation.formatParagraphStructure.description.non-final",defaultMessage:"Add paragraph breaks and headings."},recommendationFormatParagraphSpellcheckTitle:{id:"fabric.editor.ai.proactive.recommendation.formatParagraphSpellcheck.title.non-final",defaultMessage:"Fix spelling"},recommendationFormatParagraphSpellcheckDescription:{id:"fabric.editor.ai.proactive.recommendation.formatParagraphSpellcheck.description.non-final",defaultMessage:"Spot and correct spelling errors."}});r("42omo"),r("42omo"),r("42omo");var v=e=>(0,l.jsx)(t(r("eugUs")),{...e});let T=Number.POSITIVE_INFINITY,C=Number.POSITIVE_INFINITY,x=Number.POSITIVE_INFINITY;[...Array.from(String.fromCharCode(39,145,147))],Array.from(String.fromCharCode(34,39,146,148)),Array.from(String.fromCharCode(45,95,150,151,39,146));var A=((i={}).ALL_SUGGESTIONS="displayAllSuggestions",i.ALL_PANELS="displayAllPanelSuggestions",i.CONVERT_TO_ERROR_PANEL="displayErrorPanel",i.CONVERT_TO_INFO_PANEL="displayInfoPanel",i.CONVERT_TO_NOTE_PANEL="displayNotePanel",i.CONVERT_TO_SUCCESS_PANEL="displaySuccessPanel",i.CONVERT_TO_WARN_PANEL="displayWarningPanel",i.CONVERT_TO_TABLE="displayTable",i.SPLIT_PARAGRAPH="displaySplitParagraph",i.FORMAT_PARAGRAPH="displayFormatParagraph",i.UNKNOWN="unknownRecommendation",i);let k=[{Icon:t(r("e2ZTm")),settingKey:"displayAllSuggestions",title:S.toggleAllSuggestionsTitle,description:S.toggleAllSuggestionsDescription},{Icon:t(r("lW0cT")),settingKey:"displayFormatParagraph",title:S.toggleFormatParagraphTitle,description:S.toggleFormatParagraphDescription,parentSetting:"displayAllSuggestions"},{Icon:e=>{let{color:t,label:o}=e;return(0,l.jsx)("svg",{width:24,height:24,viewBox:"0 0 24 24",style:{color:t},"aria-label":o,role:o?"img":"presentation",className:(0,r("gMc0m").default)(["_1reo15vq _18m915vq _lswuvuon _lcxvglyw"]),children:(0,l.jsx)("path",{d:"M2.5 4.5H8M2.5 7.5H13.5M15.25 9.25V2.75C15.25 1.64543 14.3546 0.75 13.25 0.75H2.75C1.64543 0.75 0.75 1.64543 0.75 2.75V9.25C0.75 10.3546 1.64543 11.25 2.75 11.25H13.25C14.3546 11.25 15.25 10.3546 15.25 9.25Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinejoin:"round",transform:"translate(4,4)"})})},settingKey:"displayAllPanelSuggestions",title:S.toggleAllPanelSuggestionsTitle,description:S.toggleAllPanelSuggestionsDescription,parentSetting:"displayAllSuggestions"},{Icon:t(r("a3fRD")),settingKey:"displayErrorPanel",title:S.toggleErrorPanelTitle,parentSetting:"displayAllPanelSuggestions"},{Icon:t(r("eXmBZ")),settingKey:"displayInfoPanel",title:S.toggleInfoPanelTitle,parentSetting:"displayAllPanelSuggestions"},{Icon:t(r("3gddQ")),settingKey:"displayNotePanel",title:S.toggleNotePanelTitle,parentSetting:"displayAllPanelSuggestions"},{Icon:t(r("3sFtD")),settingKey:"displaySuccessPanel",title:S.toggleSuccessPanelTitle,parentSetting:"displayAllPanelSuggestions"},{Icon:t(r("ebrpi")),settingKey:"displayWarningPanel",title:S.toggleWarningPanelTitle,parentSetting:"displayAllPanelSuggestions"},{Icon:v,settingKey:"displaySplitParagraph",title:S.toggleSplitParagraphTitle,description:S.toggleSplitParagraphDescription,parentSetting:"displayAllSuggestions"},{Icon:t(r("4ymSL")),settingKey:"displayTable",title:S.toggleTableTitle,description:S.toggleTableDescription,parentSetting:"displayAllSuggestions"}],I={title:E.recommendationDefaultTitle,description:E.recommendationDefaultDescription,icon:t(r("e66a9"))},P=[{title:E.recommendationConvertToErrorPanelTitle,description:E.recommendationConvertToErrorPanelDescription,icon:t(r("a3fRD")),transformAction:"CONVERT_TO_ERROR_PANEL",type:"CONVERT_TO_PANEL",details:{panel_type:"ERROR"},settingKey:"displayErrorPanel"},{title:E.recommendationConvertToInfoPanelTitle,description:E.recommendationConvertToInfoPanelDescription,icon:t(r("eXmBZ")),transformAction:"CONVERT_TO_INFO_PANEL",type:"CONVERT_TO_PANEL",details:{panel_type:"INFO"},settingKey:"displayInfoPanel"},{title:E.recommendationConvertToNotePanelTitle,description:E.recommendationConvertToNotePanelDescription,icon:t(r("3gddQ")),transformAction:"CONVERT_TO_NOTE_PANEL",type:"CONVERT_TO_PANEL",details:{panel_type:"NOTE"},settingKey:"displayNotePanel"},{title:E.recommendationConvertToSuccessPanelTitle,description:E.recommendationConvertToSuccessPanelDescription,icon:t(r("3sFtD")),transformAction:"CONVERT_TO_SUCCESS_PANEL",type:"CONVERT_TO_PANEL",details:{panel_type:"SUCCESS"},settingKey:"displaySuccessPanel"},{title:E.recommendationConvertToWarnPanelTitle,description:E.recommendationConvertToWarnPanelDescription,icon:t(r("ebrpi")),transformAction:"CONVERT_TO_WARN_PANEL",type:"CONVERT_TO_PANEL",details:{panel_type:"WARN"},settingKey:"displayWarningPanel"},{title:E.recommendationSplitParagraphTitle,description:E.recommendationSplitParagraphDescription,icon:v,transformAction:"SPLIT_PARAGRAPH",type:"SPLIT_PARAGRAPH",settingKey:"displaySplitParagraph"},{title:E.recommendationConvertToTableTitle,description:E.recommendationConvertToTableDescription,icon:t(r("4ymSL")),transformAction:"CONVERT_TO_TABLE",type:"CONVERT_TO_TABLE",settingKey:"displayTable"},{title:E.recommendationFormatParagraphClarityTitle,description:E.recommendationFormatParagraphClarityDescription,icon:e=>{let{color:t,label:o}=e;return(0,l.jsx)("svg",{width:24,height:24,viewBox:"0 0 24 24",style:{color:t},"aria-label":o,role:o?"img":"presentation",className:(0,r("gMc0m").default)(["_1reo15vq _18m915vq _lswuvuon _lcxvglyw"]),children:(0,l.jsx)("path",{d:"M12.5 5.5L14.0581 3.94194C14.3021 3.69786 14.3021 3.30214 14.0581 3.05806L12.9419 1.94194C12.6979 1.69786 12.3021 1.69786 12.0581 1.94194L10.5 3.5M12.5 5.5L7.01762 10.9824C6.84312 11.1569 6.62087 11.2758 6.37888 11.3242L4.25 11.75L4.67578 9.62112C4.72417 9.37913 4.84312 9.15688 5.01762 8.98238L10.5 3.5M12.5 5.5L10.5 3.5M1 14.25H6M12 14.25H10.5M15 14.25H13.5M9 14.25H7.5",stroke:"currentColor","stroke-width":"1.5","stroke-linejoin":"round",transform:"translate(4,4)"})})},type:"FORMAT_PARAGRAPH",details:{writing_fixes:["CLARITY_CONCISENESS","GRAMMAR_SYNTAX"]},settingKey:"displayFormatParagraph"},{title:E.recommendationFormatParagraphListTitle,description:E.recommendationFormatParagraphListDescription,icon:t(r("cUQMr")),type:"FORMAT_PARAGRAPH",details:{writing_fixes:["BULLETING_NUMBERING"]},settingKey:"displayFormatParagraph"},{title:E.recommendationFormatParagraphStructureTitle,description:E.recommendationFormatParagraphStructureDescription,icon:v,type:"FORMAT_PARAGRAPH",details:{writing_fixes:["PARAGRAPH_SPLIT","HEADINGS"]},settingKey:"displayFormatParagraph"},{title:E.recommendationFormatParagraphStructureTitle,description:E.recommendationFormatParagraphStructureDescription,icon:t(r("dLjaJ")),type:"FORMAT_PARAGRAPH",details:{writing_fixes:["SPELLING"]},settingKey:"displayFormatParagraph"},{title:E.recommendationFormatParagraphTitle,description:E.recommendationFormatParagraphDescription,icon:t(r("lW0cT")),transformAction:"FORMAT_PARAGRAPH",type:"FORMAT_PARAGRAPH",settingKey:"displayFormatParagraph"}],N=()=>k.filter(e=>(0,r("dh538").fg)("aix_proactive_format_paragraph_feature_enabled")?"displaySplitParagraph"!==e.settingKey:"displayFormatParagraph"!==e.settingKey),w=()=>P.filter(e=>(0,r("dh538").fg)("aix_proactive_format_paragraph_feature_enabled")?"SPLIT_PARAGRAPH"!==e.transformAction:"FORMAT_PARAGRAPH"!==e.transformAction),D=e=>e.replace(/[^\w\-/.:%?=]+/g,""),O=async(e,t,o)=>{let n,{view:a,getMentionNameDetails:i}=o,{from:s,to:l}=t,d=e.nodeAt(s);if(!d)return;i&&(n=await (0,r("iSJi5").getMentionMap)({node:d,getMentionNameDetails:i}));let c=e.resolve(s).nodeBefore,p=e.resolve(l).nodeAfter,u=new(0,r("h9yJL").JSONTransformer)(a.state.schema,n);return{...t,content:u.encodeNode(d),before:c&&0!==c.textContent.trim().length?u.encodeNode(c):void 0,after:p&&0!==p.textContent.trim().length?u.encodeNode(p):void 0}};async function M(e){if(429===e.status){let t=parseInt(e.headers.get("Retry-After")??"");return{state:"failed",reason:"rate-limited",retryAfter:isNaN(t)?void 0:1e3*t,statusCode:e.status,errors:["tooManyRequests"]}}try{let t=await e.json();if("object"==typeof t&&null!==t&&"ai_feature_output"in t)return{state:"success",body:t};if("object"==typeof t&&null!==t&&"errorMessage"in t&&"errors"in t&&"statusCode"in t)return{state:"failed",reason:"backend",errors:[t.errorMessage,...t.errors],statusCode:t.statusCode}}catch(t){return{state:"failed",reason:"parsing",errors:["parsingError"],statusCode:e.status}}return e.body?{state:"failed",reason:"backend",errors:["Invalid response"],statusCode:e.status}:{state:"failed",reason:"network",errors:["response.body missing"],statusCode:e.status}}async function*R({endpoint:e,paragraphs:o,product:n,context:a,rateLimiter:i}){if(!o.length)return void(yield{state:"done"});let{view:s,locale:l}=a,d=s.state.doc,c=new AbortController,p=[],u=o.length,m=0,[f,g]=t(_)(o,e=>e.text.length<=T);for(p.push(...g.map(e=>e.id));f.length&&m<=2;){m++;let t=[],o=0;for(;f.length&&o+f[0].text.length<=C&&t.length<=x;){let e=f.shift();if(!e)break;o+=e.text.length;let n=await O(d,e,a);n&&t.push(n)}if(!t.length)break;let p=t.map(e=>e.id);try{let o={ai_feature_input:{triggers:t.map(e=>({trigger_id:e.id,content_url:D(document.location.href),trigger_type:"PARAGRAPH_COMPLETE",paragraph_content:e.content,before_context:e.before??{},after_context:e.after??{}}))}},a=performance.now(),d=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json;charset=UTF-8","X-Experience-Id":"proactive-paragraph-complete","Accept-Language":l,...(0,r("3MD1q").getXProductHeader)(n)},body:JSON.stringify(o),credentials:"include",signal:c.signal,mode:"cors"});yield{state:"trackedDuration",duration:performance.now()-a};let u=await M(d);if("failed"===u.state){if("rate-limited"===u.reason&&i?.enqueueRetry(u?.retryAfter?u.retryAfter:void 0)){yield{state:"rate-limited",failedChunkIds:p};break}yield{...u,failedChunkIds:p};break}let{triggers:m}=u.body.ai_feature_output,f=m.reduce((e,t)=>("errors"in t&&e.push(t.errors.error_type),e),[]),g=new(0,r("h9yJL").JSONTransformer)(s.state.schema),h=m.reduce((e,t)=>"recommendations"in t?e.concat(t.recommendations.map(e=>{let o=e.transformation_details.replacement_adf,n="doc"!==o.type?{version:1,type:"doc",content:[o]}:o;return{chunkId:t.trigger_id,rid:e.recommendation_id,id:`${t.trigger_id}_${e.recommendation_id}`,transformContent:{document:n,getContent:()=>g.parse(n).content},transformType:e.transformation_type,transformAction:e.recommendation_name,details:e.recommendation_details,type:e.recommendation_type,score:e.recommendation_score??0,isViewed:!1,filtered:!1}})):e,[]);i?.reset(),yield{state:"parsed",recommendations:h},f.length&&(yield{state:"failed",reason:"backend",errors:f,statusCode:d.status,failedChunkIds:p})}catch(e){"AbortError"===e.name?yield{state:"failed",reason:"aborted",errors:["Streaming aborted"],statusCode:e.status,failedChunkIds:p}:yield{state:"failed",reason:"unhandled",errors:e instanceof Error&&["RangeError","TypeError","TransformError"].includes(e.name)?[e.message]:["unhandled"],statusCode:e.status,failedChunkIds:p}}}f.length&&p.push(...f.map(e=>e.id)),p.length&&(yield{state:"purged",totalParts:u,totalPurgedParts:p.length,purgedChunkIds:p}),yield{state:"done"}}let L=e=>e.from===e.to||!e.text||!e.text.trim().length,B=(e,t,o,n)=>a=>{let r=a.filter(e=>!L(e));if(r.length)return R({endpoint:e,paragraphs:r,product:t,context:o,rateLimiter:n})};var V=r("8m4tT"),F=r("cUcZ5");let U=(e,t)=>{let o=e=>{let n=e.parentSetting;if(!n)return!0;let a=t.find(e=>e.settingKey===n);if(!a)return!1;let r=a.defaultValue??!1;return!!r&&r&&o(a)};return o(e)},G=e=>{let t=[],o=new Set,n=N(),a=r=>{if(!o.has(r.settingKey)){if(r.parentSetting&&!o.has(r.parentSetting)){let e=n.find(e=>e.settingKey===r.parentSetting);e&&a(e)}o.add(r.settingKey),t.push({...r,defaultValue:e?.[r.settingKey]??!0,display:U(r,t),settingKey:r.settingKey,indent:!!r.parentSetting&&r.parentSetting!==A.ALL_SUGGESTIONS})}};return n.forEach(a),t},q=(e,t)=>{let o=G(e),n=o.reduce((e,t)=>(e[t.settingKey]=t.defaultValue,e),{});if(t){n[t]=!n[t];let e=(t,a)=>{o.forEach(o=>{o.parentSetting===t&&(n[o.settingKey]=a,e(o.settingKey,a))})};e(t,n[t])}return n},H=(e,t)=>Object.entries(e).every(([e,o])=>{if(void 0===o)return!0;let n=t[e];return void 0!==n&&(Array.isArray(o)?Array.isArray(n)&&n.every(e=>o.includes(e)):"object"==typeof o?"object"==typeof n&&!Array.isArray(n)&&null!==n&&Object.entries(o).every(([e,t])=>n[e]===t):n===o)}),j=(e,t)=>{let o=w().filter(t=>void 0!==e.type&&t.type===e.type?!t.details||H(t.details,e.details||{}):!!e.transformAction&&t.transformAction===e.transformAction);if(0===o.length){let{transformAction:t,type:o,details:n}=e;return{transformAction:t,type:o,details:n,settingKey:A.UNKNOWN,...I}}return t?o.filter(e=>!1!==t[e.settingKey])[0]:o[0]},$=(e,t)=>e.map(e=>({...e,filtered:!j(e,t)})),K=(e,t)=>e.filter(e=>!!j(e,t)),z=e=>{let t=j(e);return t?{title:t.title,description:t.description,icon:t.icon}:I},W=({schema:{nodes:e}})=>new Set([e.bulletList,e.listItem,e.orderedList,e.paragraph]),Y=({schema:{nodes:e}})=>new Set([e.bulletList,e.orderedList,e.paragraph]),X=({nodes:e})=>new Set([e.heading,e.taskItem,e.decisionItem]),J=({nodes:e})=>new Set([e.listItem,e.tableHeader,e.blockquote]),Q=(e,t,o)=>X(e).has(t.type)?t.type:t.type===e.nodes.paragraph&&o&&J(e).has(o.type)?o.type:t.type,Z=({schema:{marks:e}})=>t=>!!(t.isText&&(t.marks.some(t=>t.type===e.code)||t.marks.some(o=>o.type===e.link&&t.text===o.attrs?.href)))||!1;function ee(e,t){return new Set((e??t.proactiveAIBlocks).reduce((e,t)=>e.concat(t.recommendations?.map(e=>e.id)??[]),[]))}let et=({node:e,ignoredMarkRangesPredicate:t})=>{let o=[];return e.descendants((e,n)=>(!e.isText&&e.isInline?o.push({pos:n,size:e.nodeSize,type:"inlineNode"}):t&&t(e)&&o.push({pos:n,size:e.nodeSize,type:"mark"}),!1)),o};function eo(e,t){let{proactiveAIBlocks:o}=e;if(o?.length)for(let e=0;e<o.length;e++){let n=o[e];if(t>=n.from&&t<=n.to)return n}}function en(e,t){return e.map(e=>({...e,recommendations:e.recommendations?.filter(e=>e.id!==t)}))}function ea(e,t){let{proactiveAIBlocks:o}=e,n=o.length;for(let e=0;e<n;e++){let n=o[e],a=n.recommendations?.find(e=>e.id===t);if(n&&a)return{block:n,recommendation:a}}return{block:void 0,recommendation:void 0}}function er(e){let t=function(e){let{proactiveAIBlocks:t}=e;return t?function(e){let t=Array.from(e);return t.sort((e,t)=>e.from-t.from),t.reduce((e,t)=>{if(t.recommendations){let o=Array.from(t.recommendations);o.sort((e,t)=>t.score-e.score),e=e.concat(o)}return e},[])||[]}(t):[]}(e)??[];return(e?.settings?.displayAllSuggestions?t:[]).filter(e=>!e.filtered)}function ei(e,t){return e.availableRecommendationIds.has(t)}let es=(e,t)=>e.dismissedCount%t==0;async function el({recommendationId:e,aiProactivePluginState:t,editorView:o,locale:n,sentiment:a,product:i,handleFeedbackSubmission:s,triggeredFrom:l,fireAnalyticsEvent:d}){if(!e||!s)return;let{block:c,recommendation:p}=e?ea(t,e):{block:void 0,recommendation:void 0};try{await s({sentiment:a,getAIExperience:e=>({browserLocale:window.navigator.languages,userLocale:n,...e&&p&&c?{originalParagraph:c.text,suggestedParagraph:JSON.stringify(p.transformContent.document.content),recommendationId:p.id,triggeredFrom:l}:{}}),editorAttributes:{product:i}})}catch(e){d?.({action:r("d925B").ACTION.ERRORED,actionSubject:r("d925B").ACTION_SUBJECT.EDITOR,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.AI_PROACTIVE_FEEDBACK_DIALOG,eventType:r("d925B").EVENT_TYPE.OPERATIONAL,attributes:{errorMessage:r("2QlXt").ErrorUtils.extractErrorMessage(e)}})}}var ed={},ec={},ep={};ep=function(e,t){for(var o,n=-1,a=e.length;++n<a;){var r=t(e[n]);void 0!==r&&(o=void 0===o?r:o+r)}return o};var eu=0/0;ec=function(e,t){var o=null==e?0:e.length;return o?ep(e,t)/o:eu};var em=r("eN7zR");ed=function(e){return ec(e,em)};let ef=(e,t,o)=>r("ftzrq").Decoration.inline(e,t,{nodeName:"span",class:"ai-proactive-recommendation",id:`ai-proactive-${o}`,"data-testid":"ai-proactive-recommendation"},{key:eS.RECOMMENDATION,blockId:o}),eg=({decorationSet:e,tr:t,pluginState:o})=>{let{proactiveAIBlocks:n}=o,a=n.filter(e=>!!e?.recommendations?.length).filter(e=>!(e?.recommendations?.length===1&&e.recommendations[0].filtered)),r=a.map(e=>e.id),i=new Set,s=e.find(void 0,void 0,e=>e.key===eS.RECOMMENDATION&&(i.add(e.blockId),!r.includes(e.blockId)));e=(e=e.remove(s)).map(t.mapping,t.doc);let l=a?.reduce((e,{id:t,from:o,to:n})=>(i.has(t)||e.push(ef(o,n,t)),e),[]);return l?.length?e.add(t.doc,l):e},eh=({decorationSet:e,pluginState:t})=>e.remove(ev(eS.RECOMMENDATION_HOVERED,e)),eb=({decorationSet:e,tr:t,pluginState:o})=>{let{proactiveAIBlocks:n,hoveredRecommendationId:a,selectedRecommendationId:i}=o;if(!a||!n.length)return e;let s=n.find(e=>!!e.recommendations?.some(e=>e.id===a&&e.id!==i));if(s){let{from:o,to:n}=s;return e.add(t.doc,[r("ftzrq").Decoration.inline(o,n,{class:"ai-proactive-recommendation-hovered"},{key:eS.RECOMMENDATION_HOVERED})])}return e},ey=({decorationSet:e,pluginState:t})=>e.remove(ev(eS.RECOMMENDATION_SELECTED,e)),e_=({decorationSet:e,tr:t,pluginState:o})=>{let{proactiveAIBlocks:n,selectedRecommendationId:a}=o;if(!a||!n.length)return e;let i=n.find(e=>!!e.recommendations?.some(e=>e.id===a));if(i){let{from:o,to:n}=i;return e.add(t.doc,[r("ftzrq").Decoration.inline(o,n,{class:"ai-proactive-recommendation-selected"},{key:eS.RECOMMENDATION_SELECTED})])}return e},eS={RECOMMENDATION:"aiProactiveRecommendation",RECOMMENDATION_SELECTED:"aiProactiveRecommendationSelected",RECOMMENDATION_HOVERED:"aiProactiveRecommendationHovered"},eE=e=>({decorationSet:t,tr:o,pluginState:n})=>e.reduce((e,t)=>t({decorationSet:e,tr:o,pluginState:n}),t),ev=(e,t)=>t.find(void 0,void 0,t=>t.key.indexOf(e)>-1),eT=e=>eE([ey,e_])(e),eC=e=>eE([eh,eb])(e),ex=e=>eE([ey,eh,eg,e_,eb])(e);var eA=((s={})[s.UPDATE_PLUGIN_STATE=0]="UPDATE_PLUGIN_STATE",s[s.TOGGLE_PROACTIVE_ENABLED=1]="TOGGLE_PROACTIVE_ENABLED",s[s.TOGGLE_PROACTIVE_CONTEXT_PANEL=2]="TOGGLE_PROACTIVE_CONTEXT_PANEL",s[s.SELECT_PROACTIVE_RECOMMENDATION=3]="SELECT_PROACTIVE_RECOMMENDATION",s[s.API_ERROR=4]="API_ERROR",s[s.TOGGLE_DISPLAY_CONTEXT_PANEL_SETTINGS=5]="TOGGLE_DISPLAY_CONTEXT_PANEL_SETTINGS",s[s.UPDATE_IS_LOADING_STATE=6]="UPDATE_IS_LOADING_STATE",s);let ek="proactiveAISettings",eI=new(0,r("kt8c2").default)("@atlaskit/editor-plugin-ai"),eP=e=>eI.getItem(ek)??e,eN=e=>{eI.setItemWithExpiry(ek,e)},ew=({proactiveAIApiUrl:e,documentChecker:o,rateLimiter:n,defaultToggledState:a,product:i})=>s=>{let{proactiveAIBlocks:l}=function(e){let o=Y(e),n=W(e),a=[],r=Z(e);return e.doc.descendants((i,s,l)=>{if(o.has(i.type)){let o=et({node:i,ignoredMarkRangesPredicate:r}),n=s+i.nodeSize,d=Q(e.schema,i,l);return a.push({id:t(F)(),text:i.textContent,from:s,to:n,nodeTypeName:i.type.name,ignoredRanges:o,invalidated:!1,invalidatedForDocChecker:!0,containerType:d}),!1}return n.has(i.type)}),{proactiveAIBlocks:a}}(s),d=eP(q(null,null)),c=!!a;return{product:i,proactiveAIBlocks:l,initialToggleState:c,isProactiveEnabled:!0,isProactiveContextPanelOpen:!1,canProactiveContextPanelOpen:!1,alwaysDisplayProactiveInlineDecorations:!1,alwaysOpenProactiveContextPanelOnInlineSelection:!1,validateBlocksOnMissingRecommendations:!0,allowInlineHoverHighlightWhileRecommendationSelected:!0,hasRunFullDocumentScanOnReplaceDocument:!1,decorationSet:r("ftzrq").DecorationSet.empty,proactiveAIApiUrl:e,availableRecommendationIds:new Set,toggleCount:+!!c,insertionCount:0,dismissedCount:0,documentChecker:o,rateLimiter:n,docChangeCountUntilLimit:0,isFirstInitiatedEventSent:!1,settings:d,isLoading:!1,filteredRecommendations:[],hasNoMoreSuggestions:!0}},{createPluginState:eD,createCommand:eO,getPluginState:eM}=(0,r("lkJUe").pluginFactory)(y,(e,o)=>{switch(o.type){case eA.UPDATE_PLUGIN_STATE:{let t=ee(o.data?.proactiveAIBlocks,e);return{...e,...o.data,canProactiveContextPanelOpen:t.size>0,availableRecommendationIds:t,filteredRecommendations:er(e)}}case eA.TOGGLE_PROACTIVE_ENABLED:return{...e,toggleCount:e.toggleCount+1,isProactiveEnabled:!e.isProactiveEnabled,...e.isProactiveEnabled&&{docChangeCountUntilLimit:0}};case eA.TOGGLE_PROACTIVE_CONTEXT_PANEL:{let o=e.isProactiveContextPanelOpen,n={...e,isProactiveContextPanelOpen:!e.isProactiveContextPanelOpen,analyticsAIInteractionId:t(F)(),toggleCount:e.toggleCount+1,selectedRecommendationId:e.isProactiveContextPanelOpen?void 0:e.selectedRecommendationId};return o&&(n.proactiveAIBlocks=function(e){let{proactiveAIBlocks:t}=e;return t?.map(e=>({...e,recommendations:e.recommendations?.map(e=>({...e,isViewed:!0}))}))}(e)),n}case eA.SELECT_PROACTIVE_RECOMMENDATION:return{...e,...o.data,proactiveAIBlocks:function(e,t){let{proactiveAIBlocks:o}=e;return o?.map(e=>({...e,recommendations:e.recommendations?.map(e=>e.id===t?{...e,isViewed:!0}:e)}))}(e,o.data.selectedRecommendationId),hoveredRecommendationId:e.allowInlineHoverHighlightWhileRecommendationSelected?e.hoveredRecommendationId:void 0};case eA.TOGGLE_DISPLAY_CONTEXT_PANEL_SETTINGS:return{...e,...o.data,filteredRecommendations:er({...e,...o.data,settings:{...e.settings,...o.data.settings}}),settings:{...e.settings,...o.data.settings}};case eA.UPDATE_IS_LOADING_STATE:return{...e,isLoading:o.data};default:return e}},{onDocChanged:(e,o,n)=>{let{updatedProactiveAIBlock:a}=function(e,o,n){let{proactiveAIBlocks:a,isProactiveEnabled:i}=o,s=!i||e.getMeta("isRemote")||e.getMeta("replaceDocument")||e.getMeta("suggestionAccepted")||e.getMeta("isAiContentTransformation"),l=e.getMeta("replaceDocument")||!i&&!e.getMeta("suggestionAccepted")&&!e.getMeta("isAiContentTransformation"),d=Y(n),c=W(n),p=Z(n),u=e.getMeta("isInsertedBelowNode"),m=e.docs.concat([e.doc]),f=e.steps.reduce((e,t,o)=>((t instanceof r("aXG5V").ReplaceStep||t instanceof r("aXG5V").ReplaceAroundStep)&&e.push({step:t,doc:m[o+1],prevDoc:m[o]}),e),[]);if(a&&f.length>0){let e=Array.from(a);return f.forEach(({step:o,doc:a,prevDoc:i})=>{let m=[],f=new WeakMap,g=new(0,r("aXG5V").Mapping),h=o.getMap();g.appendMap(h),h.forEach((e,o,r,i)=>{a.nodesBetween(r,Math.min(i,a.content.size),(e,o,a)=>{if(d.has(e.type)&&f.get(e)?.from!==o){let r=et({node:e,ignoredMarkRangesPredicate:p}),i=o+e.nodeSize,d=Q(n.schema,e,a),c={id:t(F)(),from:o,to:i,text:e.textContent,nodeTypeName:e.type.name,invalidated:!s,invalidatedForDocChecker:l,ignoredRanges:r,containerType:d};return m.push(c),f.set(e,c),!1}return c.has(e.type)})});let b=m.map(t=>{let o=e.find(e=>e.nodeTypeName===t.nodeTypeName&&(e.from===t.from&&e.to===t.to||g.map(e.from+1)===t.from+1&&g.map(e.to-1)===t.to-1)&&e.text===t.text);if(!o)return t;let n=i.nodeAt(o.from),r=a.nodeAt(t.from);return n&&r&&n.eq(r)?{id:t.id,from:t.from,to:t.to,text:t.text,nodeTypeName:t.nodeTypeName,invalidated:o.invalidated,invalidatedForDocChecker:l,ignoredRanges:t.ignoredRanges,containerType:t.containerType,recommendations:o.recommendations?.map(e=>({...e,chunkId:t.id,id:`${t.id}_${e.rid}`}))}:t}),y=-1,_=-1;for(let t=0;t<e.length;t++){let n=e[t],a=n.from+1,r=n.to-1;if(0===t&&o.from<a&&o.to<r){y=0,_=0;break}if((a<=o.from&&r>=o.from||a<=o.to&&r>=o.to)&&(-1===y?(y=t,_=t+1):y>-1&&(_=t+1)),a>=o.from&&r<=o.to&&(-1===y?(y=t,_=t+1):y>-1&&(_=t+1)),t<e.length-1){let n=e[t+1];if(o.from>r&&o.to<n.from){y=t+1,_=t+1;break}}t===e.length-1&&o.from>r&&o.to>r&&(y=t+1,_=t+1)}y>-1&&_>-1&&e.splice(y,_-y,...b),e=e.map((e,t)=>{var n,a;return b.length&&t>=y&&t<y+b.length||u&&e.to<=o.from?e:(n=g,{id:(a=e).id,text:a.text,ignoredRanges:a.ignoredRanges,nodeTypeName:a.nodeTypeName,invalidated:a.invalidated,invalidatedForDocChecker:a.invalidatedForDocChecker,from:n.map(a.from),to:n.map(a.to),containerType:a.containerType,recommendations:a.recommendations})})}),{originProactiveAIBlock:a,updatedProactiveAIBlock:e}}return{originProactiveAIBlock:a,updatedProactiveAIBlock:a}}(e,o,n),{decorationSet:i,documentChecker:s,hasRunFullDocumentScanOnReplaceDocument:l}=o,d=!l&&e.getMeta("replaceDocument")&&(0,r("dh538").fg)("platform_editor_ai_proactive_full_scan_on_load");d&&(s?.reset(),s?.start());let c=ee(a,o);return{...o,hasRunFullDocumentScanOnReplaceDocument:l||d,decorationSet:ex({decorationSet:i,tr:e,pluginState:{...o,proactiveAIBlocks:a}}),availableRecommendationIds:c,proactiveAIBlocks:a,...(0,r("2pjJ5").isEmptyDocument)(n.doc)&&{hasNoMoreSuggestions:!0}}},onSelectionChanged:(e,t)=>{var o;let{decorationSet:n,selectedRecommendationId:a}=t,r=e.selection.from===e.selection.to?(o=e.selection.from,eo(t,o)?.recommendations):void 0,i=!!r?.find(e=>e.id===a)?.id,s={...t,selectedRecommendationId:i?a:void 0};return{...s,decorationSet:eT({decorationSet:n,tr:e,pluginState:s})}}}),eR=(n=0,a=[],({analyticsApi:e,view:o,duration:i,totalSuggestions:s,totalAcceptedSuggestions:l,totalDismissedSuggestions:d})=>{if(n++,a.push(i),n>=10){let o=Math.min(...a),i=Math.max(...a),c=t(ed)(a),p=function(e){let t=Math.floor(e.length/2),o=[...e].sort((e,t)=>e-t);return e.length%2!=0?o[t]:(o[t-1]+o[t])/2}(a);e?.fireAnalyticsEvent({eventType:r("d925B").EVENT_TYPE.OPERATIONAL,action:r("d925B").ACTION.API_RECEIVED,actionSubject:r("d925B").ACTION_SUBJECT.EDITOR_PLUGIN_AI,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.PROACTIVE_SUGGESTION,attributes:{meanDuration:c,medianDuration:p,minDuration:o,maxDuration:i,totalSuggestions:s,totalAcceptedSuggestions:l,totalDismissedSuggestions:d}}),n=0,a=[]}});function eL({state:e,triggeredFrom:t}){let{isProactiveContextPanelOpen:o,availableRecommendationIds:n}=eM(e);return{eventType:r("d925B").EVENT_TYPE.TRACK,action:r("d925B").ACTION.TOGGLED,actionSubject:r("d925B").ACTION_SUBJECT.EDITOR_PLUGIN_AI,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.PROACTIVE_SUGGESTION,attributes:{toggledToValue:!o,triggeredFrom:t,totalSuggestions:n.size}}}let eB=e=>t=>(0,r("dAtrv").withAnalytics)(e,e=>eL({state:e,triggeredFrom:t}))(e$()),eV=e=>t=>(0,r("dAtrv").withAnalytics)(e,e=>eL({state:e,triggeredFrom:t}))(eW()),eF=e=>t=>(0,r("dAtrv").withAnalytics)(e,e=>{let{proactiveAIBlocks:o}=eM(e),n=o.reduce((e,t)=>e+Number(t.invalidated||t.invalidatedForDocChecker),0);return{eventType:r("d925B").EVENT_TYPE.OPERATIONAL,action:r("d925B").ACTION.API_PURGED,actionSubject:r("d925B").ACTION_SUBJECT.EDITOR_PLUGIN_AI,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.PROACTIVE_SUGGESTION,attributes:{reason:t,totalParts:o.length,totalPurgedParts:n}}})(e0()),eU=e=>(t,o)=>o?(0,r("dAtrv").withAnalytics)(e,t=>{let n=eM(t),{reason:a,statusCode:i}=o;return o.errors.forEach(t=>{e?.fireAnalyticsEvent({eventType:r("d925B").EVENT_TYPE.OPERATIONAL,action:r("d925B").ACTION.API_ERROR,actionSubject:r("d925B").ACTION_SUBJECT.EDITOR_PLUGIN_AI,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.PROACTIVE_SUGGESTION,attributes:{error:t,reason:a,statusCode:i}})}),(0,r("ilIeg").createUnifiedAnalyticsPayload)({action:r("d925B").ACTION.ERROR,interactionID:n.analyticsAIInteractionId,experienceName:"Proactive AI",isProactive:!0,attributes:{aiErrorMessage:a,aiErrorCode:i}})})(te(t)):te(t),eG=e=>(o,n=t(F)())=>(0,r("dAtrv").withAnalytics)(e,e=>{let{recommendation:t}=ea(eM(e),o);if(t)return(0,r("ilIeg").createUnifiedAnalyticsPayload)({action:r("d925B").ACTION.INITIATED,interactionID:n,experienceName:t.transformAction,isProactive:!0})})(eJ(o,n)),eq=e=>(t,o,n)=>e(t,e=>{e.setMeta("addToHistory",!1),o&&o(e)},n),eH=({analyticsApi:e,recommendationId:t,triggeredFrom:o,insertionMethod:n})=>eO(e=>{let o=eM(e),{decorationSet:n,insertionCount:a,proactiveAIBlocks:r}=o;if(!r?.length||!ei(o,t))return!1;let i=en(r,t);return{type:eA.UPDATE_PLUGIN_STATE,data:{decorationSet:ex({decorationSet:n,tr:e.tr,pluginState:{...o,selectedRecommendationId:void 0,proactiveAIBlocks:i}}),selectedRecommendationId:void 0,proactiveAIBlocks:i,insertionCount:a+1}}},(a,i)=>{let s=eM(i);if(ei(s,t)){let{block:i,recommendation:l}=ea(s,t);if(i&&l){let{from:t,to:d}=i,{transformContent:c,transformAction:p,transformType:u,type:m,details:f}=l;if(c)switch(e?.attachAnalyticsEvent((0,r("ilIeg").createUnifiedAnalyticsPayload)({action:r("d925B").ACTION.ACTIONED,interactionID:s.analyticsAIInteractionId,experienceName:l.transformAction,isProactive:!0,attributes:{aiResultAction:"recommendationAccepted"}}))(a),e?.attachAnalyticsEvent({eventType:r("d925B").EVENT_TYPE.TRACK,action:r("d925B").ACTION.INSERTED,actionSubject:r("d925B").ACTION_SUBJECT.EDITOR_PLUGIN_AI,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.PROACTIVE_SUGGESTION,attributes:{aiInteractionID:s.analyticsAIInteractionId,triggeredFrom:o,transformAction:p,type:m,details:f,transformType:u,insertionMethod:n}})(a),a.setMeta("suggestionAccepted",!0),n){case"replace":return a.replaceWith(t,d,c.getContent());case"insertBelow":(0,V.safeInsert)(c.getContent(),d)(a),a.setMeta("isInsertedBelowNode",!0)}}}return a}),ej=({analyticsApi:e,recommendationId:t,triggeredFrom:o,feedback:n})=>eq(eO(e=>{let o=eM(e),{decorationSet:n,proactiveAIBlocks:a,dismissedCount:r}=o;if(!a?.length||!ei(o,t))return!1;let i=en(a,t);return{type:eA.UPDATE_PLUGIN_STATE,data:{decorationSet:ex({decorationSet:n,tr:e.tr,pluginState:{...o,selectedRecommendationId:void 0,proactiveAIBlocks:i}}),selectedRecommendationId:void 0,proactiveAIBlocks:i,dismissedCount:r+1,hasNoMoreSuggestions:!1}}},(a,i)=>{let s=eM(i),{recommendation:l}=ea(s,t);if(l){let{transformAction:t,transformType:n,type:i,details:d}=l;e?.attachAnalyticsEvent((0,r("ilIeg").createUnifiedAnalyticsPayload)({action:r("d925B").ACTION.DISMISSED,interactionID:s.analyticsAIInteractionId,experienceName:l.transformAction,isProactive:!0}))(a),e?.attachAnalyticsEvent({eventType:r("d925B").EVENT_TYPE.TRACK,action:r("d925B").ACTION.DISMISSED,actionSubject:r("d925B").ACTION_SUBJECT.EDITOR_PLUGIN_AI,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.PROACTIVE_SUGGESTION,attributes:{aiInteractionID:s.analyticsAIInteractionId,triggeredFrom:o,transformAction:t,transformType:n,type:i,details:d}})(a)}if((0,r("dh538").fg)("platform_editor_ai_aggressive_feedback_proactive")){let a={recommendationId:t,sentiment:"dismiss-recommendation",editorView:n.editorView,locale:n.locale,handleFeedbackSubmission:n.handleFeedbackSubmission,aiProactivePluginState:s,product:n.product,triggeredFrom:o,fireAnalyticsEvent:e?.fireAnalyticsEvent};"preview"!==o||n.feedbackSubmitted?"contextPanel"===o&&es(s,3)&&requestAnimationFrame(()=>{el(a)}):requestAnimationFrame(()=>{el(a)})}return a})),e$=()=>eq(eO(e=>{let{isProactiveEnabled:t,isProactiveContextPanelOpen:o,documentChecker:n,toggleCount:a}=eM(e);return!t||o||0!==a||n?.isActive()||(n?.reset(),n?.start()),{type:eA.TOGGLE_PROACTIVE_CONTEXT_PANEL}})),eK=e=>eO(t=>{let o=eM(t),{decorationSet:n,proactiveAIBlocks:a,settings:r}=o,i=q(r,e),s=a.map(e=>({...e,recommendations:e.recommendations?$(e.recommendations,i):e.recommendations}));return eN(i),{type:eA.TOGGLE_DISPLAY_CONTEXT_PANEL_SETTINGS,data:{decorationSet:ex({decorationSet:n,tr:t.tr,pluginState:{...o,proactiveAIBlocks:s}}),proactiveAIBlocks:s,settings:{...i}}}}),ez=()=>eO(e=>{let{isProactiveEnabled:t,documentChecker:o,hasRunFullDocumentScanOnReplaceDocument:n,proactiveAIBlocks:a}=eM(e);return!!(t&&!n&&!o?.isActive()&&a.length>0&&(0,r("dh538").fg)("platform_editor_ai_proactive_full_scan_on_load"))&&(o?.reset(),o?.start(),{type:eA.UPDATE_PLUGIN_STATE,data:{hasRunFullDocumentScanOnReplaceDocument:!0}})},(e,t)=>e.setMeta("addToHistory",!1)),eW=()=>eq(eO(e=>{let{isProactiveContextPanelOpen:t}=eM(e);return!!t&&{type:eA.TOGGLE_PROACTIVE_CONTEXT_PANEL}})),eY=e=>eO(t=>{let o=eM(t),{decorationSet:n,proactiveAIBlocks:a,allowInlineHoverHighlightWhileRecommendationSelected:r,selectedRecommendationId:i}=o;return!!a?.length&&!!ei(o,e)&&(!!r||!i)&&{type:eA.UPDATE_PLUGIN_STATE,data:{decorationSet:eC({decorationSet:n,tr:t.tr,pluginState:{...o,hoveredRecommendationId:e}}),hoveredRecommendationId:e}}},(e,t)=>e.setMeta("addToHistory",!1)),eX=()=>eO(e=>{let t=eM(e),{decorationSet:o,hoveredRecommendationId:n}=t;return!!n&&{type:eA.UPDATE_PLUGIN_STATE,data:{decorationSet:eC({decorationSet:o,tr:e.tr,pluginState:{...t,hoveredRecommendationId:void 0}}),hoveredRecommendationId:void 0}}},(e,t)=>e.setMeta("addToHistory",!1)),eJ=(e,t)=>eO(o=>{let n=eM(o),{decorationSet:a,proactiveAIBlocks:r,selectedRecommendationId:i}=n;return e!==i&&!!r?.length&&!!ei(n,e)&&{type:eA.SELECT_PROACTIVE_RECOMMENDATION,data:{analyticsAIInteractionId:t,selectedRecommendationId:e,decorationSet:eT({decorationSet:a,tr:o.tr,pluginState:{...n,selectedRecommendationId:e}})}}},e=>e.setMeta("addToHistory",!1)),eQ=()=>eO(e=>{let t=eM(e),{decorationSet:o,selectedRecommendationId:n}=t;return!!n&&{type:eA.UPDATE_PLUGIN_STATE,data:{selectedRecommendationId:void 0,decorationSet:eT({decorationSet:o,tr:e.tr,pluginState:{...t,selectedRecommendationId:void 0}})}}},e=>e.setMeta("addToHistory",!1)),eZ=e=>eO(t=>{let{showNewRecommendationsNotification:o}=eM(t);return!!o!==e&&{type:eA.UPDATE_PLUGIN_STATE,data:{showNewRecommendationsNotification:e}}},(e,t)=>e.setMeta("addToHistory",!1)),e0=()=>eq(eO(e=>{let{proactiveAIBlocks:t,rateLimiter:o}=eM(e);return o?.reset(),{type:eA.UPDATE_PLUGIN_STATE,data:{proactiveAIBlocks:t?.map(e=>({...e,invalidated:!1,invalidatedForDocChecker:!1}))}}})),e1=async({analyticsApi:e,chunks:t,context:o})=>{let{view:n}=o,{proactiveAIApiUrl:a,product:r,rateLimiter:i}=eM(n.state);if(i?.isActive())return;let s=B(a,r,o,i)(t);if(s){for await(let o of(e7(!0)(n.state,n.dispatch),s))switch(o.state){case"cached":case"parsed":{let e=o.recommendations,a=eM(n.state),{decorationSet:r,proactiveAIBlocks:i,isProactiveContextPanelOpen:s}=a;if(!i?.length)break;let l=t.reduce((t,o)=>(e.some(e=>e.chunkId===o.id)||t.add(o.id),t),new Set),d=function(e,t,o){let{proactiveAIBlocks:n,validateBlocksOnMissingRecommendations:a,settings:r}=e;return n?.map(e=>{let n=$(t,r).filter(t=>t.chunkId===e.id);return{...e,...n.length&&{recommendations:n,invalidated:!1,invalidatedForDocChecker:!1},...a&&o.has(e.id)&&{invalidated:!1,invalidatedForDocChecker:!1}}})}(a,e,l);eO(()=>({type:eA.UPDATE_PLUGIN_STATE,data:{proactiveAIBlocks:d,showNewRecommendationsNotification:!s&&e.length>0,decorationSet:ex({decorationSet:r,tr:n.state.tr,pluginState:{...a,proactiveAIBlocks:d}})}}),(e,t)=>e.setMeta("addToHistory",!1))(n.state,n.dispatch);break}case"trackedDuration":{let{insertionCount:t,dismissedCount:a,availableRecommendationIds:r}=eM(n.state);eR({analyticsApi:e,view:n,duration:o.duration,totalSuggestions:r.size,totalAcceptedSuggestions:t,totalDismissedSuggestions:a});break}case"failed":o.failedChunkIds.length>0&&eU(e)(o.failedChunkIds,o)(n.state,n.dispatch)}e2(n),e7(!1)(n.state,n.dispatch)}},e2=t(d)(e=>eZ(!1)(e.state,e.dispatch),1e3),e5=(e,t,o)=>o.from<=e&&o.to>=e||o.from<=t&&o.to>=t,e4=(e,t)=>{let{from:o,to:n}=e.selection,{proactiveAIBlocks:a}=eM(e);return a.filter(e=>!!e.invalidated).filter(e=>{let a=e5(o,n,e);return t?a:!a})},e9=async({analyticsApi:e,context:t})=>{let o=e4(t.view.state,!0);o.length&&await e1({analyticsApi:e,chunks:o,context:t})},e3=async({analyticsApi:e,context:t})=>{let o=e4(t.view.state,!1);o.length&&await e1({analyticsApi:e,chunks:o,context:t})},e8=({analyticsApi:e,timings:o})=>{let n=t(d)(e3,o.nonCurrentChunks),a=t(d)(e9,o.currentChunks,{maxWait:o.currentChunksMaxWait}),r=()=>{n.cancel(),a.cancel()};return{triggerProactiveCheck:t=>{o.nonCurrentChunks>=0&&n({analyticsApi:e,context:t}),o.currentChunks>=0&&a({analyticsApi:e,context:t})},cancelDebouncedAndThrottledCheck:r,triggerProactiveCheckImmediately:t=>{r(),e3({analyticsApi:e,context:t}),e9({analyticsApi:e,context:t})}}},e6=()=>eO(e=>{let{proactiveAIBlocks:t}=eM(e);return{type:eA.UPDATE_PLUGIN_STATE,data:{proactiveAIBlocks:t.map(e=>({...e,invalidatedForDocChecker:!0})),hasNoMoreSuggestions:!0}}},e=>e.setMeta("addToHistory",!1)),e7=e=>eO(()=>({type:eA.UPDATE_IS_LOADING_STATE,data:e}),e=>e.setMeta("addToHistory",!1)),te=e=>eq(eO(t=>{let{proactiveAIBlocks:o}=eM(t);return{type:eA.UPDATE_PLUGIN_STATE,data:{proactiveAIBlocks:o.map(t=>e.includes(t.id)?{...t,invalidatedForDocChecker:!1}:t)}}}));class tt{isActive(){return this.active}async checkNextBlocks(){if(!this.view||!this.active)return;let e=this.commands.getChunks(this.view.state).slice(0,this.config.blocksPerRequest);e?.length?(await this.commands.triggerCallback(e,this.view),this.active&&this.next()):this.stop()}next(){this.timerId=setTimeout(this.checkNextBlocks.bind(this),this.getStepDelay(++this.stepCount))}getStepDelay(e){let{delayBetweenChecks:t,delayIncrease:o,maxDelay:n,numberOfRequestsForIncrease:a}=this.config.timings;return Math.max(t,Math.min(n,t+o*Math.floor(e/Math.max(a,1))))}setView(e){this.reset(),this.view=e}start(){this.active||(this.active=!0,this.startTime=Date.now(),this.checkNextBlocks())}stop(){this.active&&this.commands.onScanComplete&&this.view&&this.commands.onScanComplete(this.view,Date.now()-this.startTime),this.active=!1,clearTimeout(this.timerId),this.timerId=void 0}reset(){this.stop(),this.stepCount=0}refresh(){this.view&&(this.reset(),this.commands.resetChunksForDocChecker?.(this.view),this.start())}constructor(e,t){this.config=e,this.commands=t,this.view=void 0,this.timerId=void 0,this.stepCount=0,this.active=!1,this.startTime=0}}let to=t(d)(e=>ez()(e.state,e.dispatch),1e3);r("42omo");var tn=r("42omo");let ta=t(tn).createContext(void 0),tr=ta.Provider,ti=()=>{let e=(0,tn.useContext)(ta);if(!e)throw Error("No Editor view or API available in the context, make sure to have container wrapped with ContentComponentContextProvider");return e};var ts=r("iu6m9");let tl={name:"181ksdh",styles:"padding:inherit;border-bottom:inherit;box-shadow:inherit"},td={name:"1djwtw9",styles:"background-color:var(--ds-background-accent-yellow-subtlest, #FFF7D6)"},tc=(0,r("9K4OG").css)({borderBottom:"var(--ds-border-width-selected, 2px) solid var(--ds-background-accent-magenta-subtle-hovered, #F797D2)",borderBottomStyle:"dashed"}),tp=(0,r("9K4OG").css)({borderBottom:"var(--ds-border-width-selected, 2px) solid var(--ds-text-accent-teal, #206A83)",borderBottomStyle:"dotted"}),tu=(0,r("9K4OG").css)({borderBottom:"var(--ds-border-width-selected, 2px) dotted var(--ds-chart-blue-bolder, #1D7AFC)",cursor:"pointer"}),tm=(0,r("9K4OG").css)({borderBottom:"var(--ds-border-width-selected, 2px) dotted var(--ds-chart-blue-bolder, #1D7AFC)",backgroundColor:"var(--ds-background-accent-blue-subtlest, #E9F2FF)",cursor:"pointer"}),tf=(0,r("9K4OG").css)({borderBottom:"var(--ds-border-width-selected, 2px) dotted var(--ds-chart-blue-bolder, #1D7AFC)",cursor:"pointer"}),tg=(0,r("9K4OG").css)({borderBottom:"var(--ds-border-width-selected, 2px) dotted var(--ds-chart-blue-bolder, #1D7AFC)",backgroundColor:"var(--ds-background-accent-blue-subtlest, #E9F2FF)",cursor:"pointer"});var th={name:"1pr32me",styles:"button[data-testid='ak-editor-ai-selection-toolbar-ai-button'],button[data-testid='ak-editor-ai-selection-toolbar-ai-button']:disabled,button[data-testid='ak-editor-ai-selection-toolbar-ai-button']:hover,button[data-testid='ak-editor-ai-selection-toolbar-ai-button']:focus,button[data-testid='ak-editor-annotation-toolbar-create-button'],button[data-testid='ak-editor-annotation-toolbar-create-button']:disabled,button[data-testid='ak-editor-annotation-toolbar-create-button']:hover,button[data-testid='ak-editor-annotation-toolbar-create-button']:focus{padding:0px var(--ds-space-100, 8px);}button[data-testid='ak-editor-ai-selection-toolbar-ai-button'] svg{padding-right:var(--ds-space-050, 4px);}button[data-testid='ak-editor-ai-selection-toolbar-ai-button']>span:only-child{svg{padding:0px var(--ds-space-100, 8px);}}"},tb={name:"2wdbgh",styles:"button[data-testid='ak-editor-ai-selection-toolbar-ai-button'],button[data-testid='ak-editor-ai-selection-toolbar-ai-button']:disabled,button[data-testid='ak-editor-ai-selection-toolbar-ai-button']:hover,button[data-testid='ak-editor-ai-selection-toolbar-ai-button']:focus{padding:0px var(--ds-space-075, 6px);}button[data-testid='ak-editor-annotation-toolbar-create-button'],button[data-testid='ak-editor-annotation-toolbar-create-button']:disabled,button[data-testid='ak-editor-annotation-toolbar-create-button']:hover,button[data-testid='ak-editor-annotation-toolbar-create-button']:focus{padding:0px var(--ds-space-075, 6px);span:first-child{margin:0;}span[role='img'],svg{padding:0;}}"};let ty=()=>(0,ts.editorExperiment)("platform_editor_controls","variant1")?tb:th,t_=()=>(0,r("9K4OG").css)(".akEditor div.ProseMirror{.ai-proactive-recommendation{",tf," .ak-editor-annotation-draft,.ak-editor-annotation-blur,.ak-editor-annotation-focus{border-bottom:inherit;box-shadow:inherit;}}.ai-proactive-recommendation-selected,.ai-proactive-recommendation-hovered{",tg," .ak-editor-annotation-draft,.ak-editor-annotation-blur,.ak-editor-annotation-focus{border-bottom:inherit;box-shadow:inherit;background-color:inherit;}}.ai-spelling-error{",tc,";}.ai-auto-correct{",tp,";}.ai-suggestions{",tu,";}.ai-suggestions-selected{",tm,";}.ai-suggestions{.ak-editor-annotation-draft,.ak-editor-annotation-blur,.ak-editor-annotation-focus{",tl,";}}.ai-suggestions-selected{&.ak-editor-annotation-blur,&.ak-editor-annotation-focus{",td,";}}.ak-editor-annotation-focus{&:has(.ai-suggestions-selected){",tl,";}.ai-suggestions-selected{",td,";}}}",ty(),";"),tS=({children:e})=>(0,r("9K4OG").jsx)(t(tn).Fragment,null,(0,r("9K4OG").jsx)(r("9K4OG").Global,{styles:t_()}),e);var tE=function({modalElement:e,editorViewElement:t}){let o=(0,tn.useRef)(null);(0,tn.useEffect)(()=>{if(!e)return;let n=new ResizeObserver(n=>{if(!o.current||!e)return;let a=n.find(t=>t.target===e);if(!a)return;let r=Math.max(a.target.offsetTop+a.contentRect.height-(t.offsetTop+t.offsetHeight),0);o.current.style.height=`${r}px`});return n.observe(e),()=>{n.disconnect()}},[e,t]),(0,tn.useEffect)(()=>{if(o.current)return;let e=document.createElement("div");return e.className="ai-height-div",e.style.height="0px",t.parentNode.appendChild(e),o.current=e,()=>{t.parentNode?.removeChild(e)}},[t])};function tv({from:e,modalElement:t,direction:o}){let n="top"===o?"offsetTop":"offsetLeft",a=e[n],r=e.offsetParent,i=function(e){let t=e.offsetParent;if(t)return t;let o=e.parentElement;for(;o;){if("static"!==getComputedStyle(o).position)return o;o=o.parentElement}return document.body}(t);for(;r&&r instanceof HTMLElement&&r!==i;)a+=r[n],r=r.offsetParent;return a}let tT=Math.min(500,Math.max(402,r("aFUXX").akEditorFloatingPanelZIndex+2)),tC=({children:e,decoration:o,modalDecorationElement:n,endExperience:a,autoScroll:i})=>{let{api:s,editorView:c,appearance:p,wrapperElement:u}=ti(),m=u?.offsetParent,f=c.dom,g=t(tn).useRef(null),[h,b]=t(tn).useState(0),[y,_]=t(tn).useState(0),[S,E]=t(tn).useState(0),[v,T]=t(tn).useState(""),C=(0,tn.useMemo)(()=>(function(e,t){let o=e.state.doc.resolve(t),{nodes:n,marks:a}=e.state.schema,i=e.domAtPos.bind(e),s=(0,V.findParentNodeClosestToPos)(o,e=>e.type===n.table);if(s){let e=(0,V.findDomRefAtPos)(s.start,i);if(e instanceof HTMLElement){let t=e.closest(`.${r("1zav4").TableSharedCssClassName.TABLE_RESIZER_CONTAINER}`);if(t instanceof HTMLElement)return t}}let l=(0,V.findParentNodeClosestToPos)(o,e=>e.type===n.table&&"default"!==e.attrs.layout||e.marks.some(e=>e.type===a.breakout));if(!l)return;let d=(0,V.findDomRefAtPos)(l.start,i);if(d instanceof HTMLElement&&d){if([n.layoutSection,n.expand].includes(l.node.type))return d.parentElement||void 0;if(l.node.type===n.table){let e=d.closest(`.${r("1zav4").TableSharedCssClassName.TABLE_CONTAINER}`);return e instanceof HTMLElement?e:void 0}}})(c,o.to),[c,o]);if((0,tn.useEffect)(()=>{if("comment"===p){let e=null;if(e=m?m.querySelector(".ak-editor-content-area"):n.closest(".ak-editor-content-area")){let t=getComputedStyle(e),o="none"!==t.maxHeight,n=t.position;return o&&(e.style.position="relative"),()=>{o&&e&&(e.style.position=n)}}}},[n,p,m]),(0,tn.useEffect)(()=>{let e=()=>{if(!g.current||C&&!f.contains(C))return;let e=C||f,t=function({modalElement:e,editorRelativeWrapper:t,modalDecorationElement:o}){return function({modalDecorationElement:e,modalElement:t}){return tv({from:e,modalElement:t,direction:"top"})+e.offsetHeight}({modalDecorationElement:o,modalElement:e})}({modalElement:g.current,editorRelativeWrapper:m,modalDecorationElement:n});b(function({relativePositionElement:e,modalElement:t}){return tv({from:e,modalElement:t,direction:"left"})}({relativePositionElement:e,modalElement:g.current})),_(t),E(e.offsetWidth),v||T("all 0.1s ease-in")};e();let o=t(d)(()=>{e()},20),a=new ResizeObserver(o);a.observe(f);let r=f.offsetParent;return r&&a.observe(r),C&&a.observe(C),()=>{a.disconnect(),o.cancel()}},[f,n,m,C]),(0,tn.useEffect)(()=>{if(!i||!y)return;let e=g.current;if(!e)return;let t=(0,r("7YjFd").findOverflowScrollParent)(e);if(!t)return;let o=t.scrollTop,a=t.scrollTop+(t.offsetHeight-32),s=Math.max(0,y-n.offsetHeight),l=y+e.offsetHeight,d=t.offsetHeight-32<e.scrollHeight;if(!(s>=o&&l<=a)){if(d||s<o)return void t.scroll({top:Math.max(0,s-32),behavior:"instant"});t.scroll({top:o+Math.max(l-a,0)+32,behavior:"instant"})}},[i,y,n]),tE({modalElement:g.current,editorViewElement:f}),(0,r("b3YrF").useSharedPluginStateSelector)(s,"aiProactive.decorationSet")===r("ftzrq").DecorationSet.empty)return a(),null;let x={top:y,left:h,"--content-width":`${S}px`,transition:v,display:S?"block":"none"};return(0,l.jsx)("div",{"data-testid":"ai-plugin-modal",ref:g,"data-editor-popup":!0,className:(0,r("gMc0m").default)(["_19pkpxbi _kqswstnw _1pby1kbs _2hwxmgjw _18u0mgjw _1bsbxj84 _j7hq1w10 _5sagfnf5 _1pgl6ui8 _1o51q7pw _ta6yglyw"]),style:{...x,"--_1dsp0pi":(0,r("7sObp").default)(tT)},children:e})},tx=(0,r("cgtv4").defineMessages)({loadingIconAltText:{id:"fabric.editor.ai.proactive.loading.iconAltText.non-final",defaultMessage:"Loading icon"},findingSuggestionsLabel:{id:"fabric.editor.ai.proactive.findingSuggestionsLabel.non-final",defaultMessage:"Finding suggestions"},findingSuggestionsLoadingLabel:{id:"fabric.editor.ai.proactive.findingSuggestionsLoadingLabel.non-final",defaultMessage:"Finding suggestions"},findingMoreSuggestionsLoadingLabel:{id:"fabric.editor.ai.proactive.findingMoreSuggestionsLoadingLabel.non-final",defaultMessage:"Finding more suggestions"},unhandledErrorMessage:{id:"fabric.editor.ai.proactive.error.unhandledErrorMessage",defaultMessage:"We're having trouble. Close the dialog and try again."},markdownErrorMessage:{id:"fabric.editor.ai.proactive.error.markdownErrorMessage",defaultMessage:"We're having trouble generating the preview. Close the dialog and try again."},recommendationPreviewButtonLabel:{id:"fabric.editor.ai.proactive.recommendation.preview.button.non-final",defaultMessage:"Preview"},recommendationReplaceButtonLabel:{id:"fabric.editor.ai.proactive.recommendation.replace.button.non-final",defaultMessage:"Replace"},recommendationDismissButtonLabel:{id:"fabric.editor.ai.proactive.recommendation.dismiss.button.non-final",defaultMessage:"Dismiss"},dismissProactiveRecommendation:{id:"fabric.editor.ai.proactive.preview.dismissProactiveRecommendation.non-final",defaultMessage:"Dismiss"},insertBelowProactiveRecommendation:{id:"fabric.editor.ai.proactive.preview.insertBelowProactiveRecommendation",defaultMessage:"Insert below"},replaceProactiveRecommendation:{id:"fabric.editor.ai.proactive.preview.replaceProactiveRecommendation",defaultMessage:"Replace"},spellingAndGrammarLabel:{id:"fabric.editor.ai.proactive.spellingAndGrammar.label.non-final",defaultMessage:"Spelling and grammar"},ManageSuggestionTitle:{id:"fabric.editor.ai.proactive.moreMenu.manageSuggestionsTitle.non-final",defaultMessage:"Manage suggestions"},closeButtonLabel:{id:"fabric.editor.ai.proactive.close.label.non-final",defaultMessage:"Close"},suggestionsTitle:{id:"fabric.editor.ai.proactive.suggestions.title.non-final",defaultMessage:"Suggestions"},betaLabel:{id:"fabric.editor.ai.proactive.beta.label.non-final",defaultMessage:"BETA"},moreMenuLabel:{id:"fabric.editor.ai.proactive.moreMenu.label.non-final",defaultMessage:"more"},moreMenuManageSuggestions:{id:"fabric.editor.ai.proactive.moreMenu.manageSuggestions.non-final",defaultMessage:"Manage Suggestions"},moreMenuGiveFeedback:{id:"fabric.editor.ai.proactive.moreMenu.giveFeedback.non-final",defaultMessage:"Give feedback"},moreActionsLabel:{id:"fabric.editor.ai.proactive.moreActions.label.non-final",defaultMessage:"More actions"},reloadSuggestionsStateTitle:{id:"fabric.editor.ai.proactive.reloadSuggestionsState.title.non-final",defaultMessage:"Your contents looking good"},reloadSuggestionsStateDescription:{id:"fabric.editor.ai.proactive.reloadSuggestionsState.description.non-final",defaultMessage:"Any new suggestions will appear here."},reloadSuggestionsButtonLabel:{id:"fabric.editor.ai.proactive.reloadSuggestionsButtonLabel.non-final",defaultMessage:"View past suggestions"},noSuggestionsStateTitle:{id:"fabric.editor.ai.proactive.noSuggestionsState.title.non-final",defaultMessage:"Suggestions will appear here"},noSuggestionsStateDescription:{id:"fabric.editor.ai.proactive.noSuggestionsState.description.non-final",defaultMessage:"You can also ask AI to improve your page with requests such as <i>Add a table of contents</i> or <i>Create headings</i>."},askAIButtonLabel:{id:"fabric.editor.ai.proactive.askAIButtonLabel.non-final",defaultMessage:"Ask AI"},enableSuggestionsStateTitle:{id:"fabric.editor.ai.proactive.enableSuggestionsState.title.non-final",defaultMessage:"You create. We polish."},enableSuggestionsStateDescription:{id:"fabric.editor.ai.proactive.enableSuggestionsState.description.non-final",defaultMessage:"Turn on suggested edits to quickly preview content improvements."},enableSuggestionsButtonLabel:{id:"fabric.editor.ai.proactive.enableSuggestionsButtonLabel.non-final",defaultMessage:"Turn on"}}),tA=e=>{let{api:t}=ti(),{formatMessage:o}=(0,r("8C5kA").default)();return(0,l.jsx)(tk,{...e,api:t,formatMessage:o})};class tk extends t(tn).Component{shouldRecover(){return this.state.errorCaptured}componentDidCatch(e,t){this.props.api?.analytics?.actions.fireAnalyticsEvent({eventType:r("d925B").EVENT_TYPE.OPERATIONAL,action:r("d925B").ACTION.UNHANDLED_ERROR_CAUGHT,actionSubject:r("d925B").ACTION_SUBJECT.EDITOR_PLUGIN_AI,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.EXPERIENCE_APPLICATION,attributes:{componentStack:t.componentStack||"",errorMessage:r("2QlXt").ErrorUtils.extractErrorMessage(e)}}),this.setState({errorCaptured:!0,fallbackMessage:this.getFallbackMessage(tx.unhandledErrorMessage)})}render(){return this.shouldRecover()?(0,l.jsx)(r("f02sP").UnhandledErrorScreen,{text:this.state.fallbackMessage,onCancel:this.props.onCloseFallback}):this.props.children}constructor(...e){super(...e),this.getFallbackMessage=e=>this.props.formatMessage(e),this.state={errorCaptured:!1,fallbackMessage:this.getFallbackMessage(tx.unhandledErrorMessage)}}}var tI=r("6dSQX");let tP=e=>y.getState(e.state);var tN=r("67O0h");let tw=({jsonDocument:e,showTelepointer:t,providerFactory:o,reduceMargins:n})=>{let a=(0,tn.useRef)(null),i=(0,tn.useRef)(new(0,r("4FxUL").default));return(0,tn.useEffect)(()=>{let e=(e,t)=>{i.current.setProvider(e,t)},t=(e,t)=>{i.current.setProvider(e,t)},n=(e,t)=>{i.current.setProvider(e,t)};return o.subscribe("mentionProvider",e),o.subscribe("emojiProvider",t),o.subscribe("mediaProvider",n),()=>{o.unsubscribe("mentionProvider",e),o.unsubscribe("emojiProvider",t),o.unsubscribe("mediaProvider",n)}},[o]),(0,l.jsx)("div",{"data-testid":"preview-renderer",ref:a,className:(0,r("gMc0m").default)(["_1gxu4jg8 _1u11i7a9 _1ddwi7uo",n&&"_10vmidpf _w9cjidpf _1iwqidpf"]),children:(0,l.jsx)(r("lspPP").RendererActionsContext,{children:(0,l.jsx)(tN.default,{document:e,media:{allowLinking:!1},useSpecBasedValidator:!0,addTelepointer:t,dataProviders:i.current,allowPlaceholderText:!0})})})};function tD(){let{editorView:e,api:o,providerFactory:n,config:{handleFeedbackSubmission:a,product:i}}=ti(),s=o?.analytics?.actions,d=(0,r("b3YrF").useSharedPluginStateSelector)(o,"editorDisabled.editorDisabled"),{formatMessage:c,locale:p}=(0,r("8C5kA").default)(),[u,m]=t(tn).useState(!1),f=(0,r("b3YrF").useSharedPluginStateSelector)(o,"aiProactive.selectedRecommendationId"),g=(0,r("b3YrF").useSharedPluginStateSelector)(o,"aiProactive.analyticsAIInteractionId"),h=tP(e),{block:b,recommendation:y}=f?ea(h,f):{block:void 0,recommendation:void 0};(0,tn.useEffect)(()=>{y?.transformAction&&o?.analytics?.actions?.fireAnalyticsEvent((0,r("ilIeg").createUnifiedAnalyticsPayload)({action:r("d925B").ACTION.VIEWED,interactionID:g,experienceName:y.transformAction,isProactive:!0,attributes:{}}))},[o,g,y?.transformAction]);let _=(0,tn.useCallback)(()=>{eQ()(e.state,e.dispatch)},[e.dispatch,e.state]);if(!f||!b||!y)return null;let{title:S}=z(y),E=(0,l.jsx)(tw,{jsonDocument:y.transformContent.document,showTelepointer:!1,providerFactory:n,reduceMargins:!0}),v=[{label:c(tx.dismissProactiveRecommendation),appearance:"cancel",onClick:()=>{if(!y)return null;ej({analyticsApi:s,recommendationId:y.id,triggeredFrom:"preview",feedback:{feedbackSubmitted:u,product:i,locale:p,editorView:e,handleFeedbackSubmission:a}})(e.state,e.dispatch)},isDisabled:d},{label:c(tx.insertBelowProactiveRecommendation),appearance:"secondary",onClick:()=>{if(!y)return null;eH({analyticsApi:s,recommendationId:y.id,triggeredFrom:"preview",insertionMethod:"insertBelow"})(e.state,e.dispatch)},isDisabled:d},{label:c(tx.replaceProactiveRecommendation),appearance:"primary",onClick:()=>{if(!y)return null;eH({analyticsApi:s,recommendationId:y.id,triggeredFrom:"preview",insertionMethod:"replace"})(e.state,e.dispatch)},isDisabled:d}],T=e=>{s?.fireAnalyticsEvent({eventType:r("d925B").EVENT_TYPE.UI,action:r("d925B").ACTION.CLICK,actionSubject:r("d925B").ACTION_SUBJECT.EDITOR_PLUGIN_AI,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.RESPONSE_FEEDBACK_BUTTON,attributes:{sentiment:e,product:i,configItemTitle:"proactive-recommendation"}})},C=async t=>{if(T(t),m(!0),(0,r("dh538").fg)("platform_editor_ai_aggressive_feedback_proactive"))el({recommendationId:y.id,aiProactivePluginState:h,editorView:e,locale:p,sentiment:t,product:i,handleFeedbackSubmission:a,triggeredFrom:"preview",fireAnalyticsEvent:s?.fireAnalyticsEvent});else{if(!a)return!1;await a({sentiment:t,getAIExperience:e=>({browserLocale:window.navigator.languages,userLocale:p,...e?{originalParagraph:b.text,suggestedParagraph:y.transformContent.document.content,recommendationId:y.id}:{}}),editorAttributes:{product:i}})}};return(0,l.jsx)(tI.PreviewScreen,{staticPromptTitle:c(S),hideHorizontalRule:!0,showBetaLozenge:!0,preview:E,disableActions:!1,disableInterrogation:!0,schema:e.state.schema,providerFactory:n,onCopy:()=>{s?.fireAnalyticsEvent({eventType:r("d925B").EVENT_TYPE.UI,action:r("d925B").ACTION.CLICK,actionSubject:r("d925B").ACTION_SUBJECT.EDITOR_PLUGIN_AI,actionSubjectId:r("d925B").ACTION_SUBJECT_ID.COPY_BUTTON,attributes:{experienceType:"proactive-recommendation"}});let t=y.transformContent.getContent();(0,r("3gD8G").copyPMFragmentToClipboard)({editorView:e,pmFragment:t})},showBack:!1,onGoodResponseButtonClick:()=>C("good-recommendation"),onBadResponseButtonClick:()=>C("bad-recommendation"),onClose:_,applications:v,isInputActive:!1,isClearTitle:!0})}let tO=()=>{let{editorView:e,api:t,providerFactory:o}=ti();(0,r("6qdjm").usePluginStateEffect)(t,["emoji","mention"],({emojiState:e,mentionState:t})=>{e?.emojiProvider&&o.setProvider("emojiProvider",Promise.resolve(e.emojiProvider)),t?.mentionProvider&&o.setProvider("mentionProvider",Promise.resolve(t.mentionProvider))});let n=(0,tn.useCallback)(()=>{e.focus()},[e]),a=(0,r("b3YrF").useSharedPluginStateSelector)(t,"aiProactive.selectedRecommendationId"),i=(0,r("b3YrF").useSharedPluginStateSelector)(t,"aiProactive.decorationSet"),s=i?.find(void 0,void 0,e=>e.key===eS.RECOMMENDATION_SELECTED)?.shift();if(!s||!i)return null;let d=e?.dom.querySelectorAll(".ai-proactive-recommendation-selected"),c=d.length>1?d?.[d.length-1]?.parentElement:d?.[0];return c&&a?(0,l.jsx)(tA,{onCloseFallback:n,children:(0,l.jsx)(tC,{decoration:s,modalDecorationElement:c,endExperience:n,autoScroll:!0,children:(0,l.jsx)(tD,{})},a)}):null},tM=e=>(0,l.jsx)(tS,{children:(0,l.jsx)(tr,{value:{...e},children:(0,l.jsx)(tO,{})})});r("42omo"),r("42omo"),r("42omo");let tR={itemContainerStyle:"_ca0qutpp _n3tdutpp",indentedItemContainerStyle:"_ca0qutpp _n3tdutpp _19bv1jfw",iconContainerStyle:"_ca0qv77o",textContainerStyle:"_1e0c1ule _19bvutpp",titleStyle:"_k48pmoej _n3tdv77o _syazi7uo"},tL=e=>{let{icon:t,title:o,description:n,toggle:a,defaultValue:i,indented:s,display:d}=e;return d?(0,l.jsxs)(r("u9agA").default,{spread:"space-between",alignBlock:"center",xcss:s?tR.indentedItemContainerStyle:tR.itemContainerStyle,children:[(0,l.jsxs)(r("u9agA").default,{children:[(0,l.jsx)(r("u9agA").default,{xcss:tR.iconContainerStyle,children:t}),(0,l.jsxs)(r("u9agA").default,{xcss:tR.textContainerStyle,children:[(0,l.jsx)(r("u9agA").default,{xcss:tR.titleStyle,children:o}),n&&(0,l.jsx)(r("iXCQx").default,{color:"color.text.subtle",children:n})]})]}),(0,l.jsx)(r("82gXq").default,{id:"toggle-default",onChange:a,defaultChecked:i})]}):null},tB={grid:"_1bsb1osq _1lmc1b3l",closeContainer:"_nd5l1bvj",titleContainer:"_nd5l1cy2",stickyHeaderStyle:"_kqsw1if8 _154ize3t _1pbykb7n",scrollableSuggestionStyle:"_1reo15vq _18m91wug _1o9zkb7n",divider:"_1h6d1l7x _189ee4h9"},tV=()=>(0,l.jsx)(r("gdv5Z").default,{xcss:tB.divider}),tF=e=>{let{isOpen:o,toggleModal:n,editorView:a}=e,{formatMessage:i}=(0,r("8C5kA").default)(),s=e=>{let{state:t,dispatch:o}=a;e(t,o)},{settings:d}=eM(a.state),{displayAllSuggestions:c}=d,p=G(d),[u,m]=t(_)(p,e=>e.settingKey===A.ALL_SUGGESTIONS),f=e=>e.map(({defaultValue:e,description:t,display:o,Icon:n,indent:a,settingKey:r,title:d})=>(0,l.jsx)(tL,{icon:(0,l.jsx)(n,{color:"var(--ds-icon-subtle, #505258)"}),title:i(d),description:t?i(t):void 0,defaultValue:e,toggle:()=>{s(eK(r))},display:o,indented:a},r));return(0,l.jsx)(r("6xdDU").default,{children:o&&(0,l.jsxs)(r("8CZUH").default,{onClose:n,children:[(0,l.jsx)(r("9ot3w").default,{children:(0,l.jsxs)(r("d8SNb").default,{gap:"space.200",xcss:tB.grid,children:[(0,l.jsx)(r("1s5hv").default,{xcss:tB.closeContainer,justifyContent:"end",children:(0,l.jsx)(r("8TTLA").CloseButton,{onClick:n})}),(0,l.jsx)(r("1s5hv").default,{xcss:tB.titleContainer,justifyContent:"start",children:(0,l.jsx)(r("d8eRd").default,{children:i(tx.ManageSuggestionTitle)})})]})}),(0,l.jsxs)(r("gdv5Z").default,{xcss:tB.scrollableSuggestionStyle,children:[(0,l.jsxs)(r("gdv5Z").default,{xcss:tB.stickyHeaderStyle,backgroundColor:"elevation.surface",children:[(0,l.jsx)(r("gdv5Z").default,{paddingInline:"space.300",children:f(u)}),c?(0,l.jsx)(tV,{}):null]}),(0,l.jsx)(r("gdv5Z").default,{paddingInline:"space.300",paddingBlockEnd:"space.500",children:f(m)})]})]})})},tU={position:"top"},tG=e=>{let{formatMessage:o}=(0,r("8C5kA").default)(),{editorView:n}=e,{handleFeedbackSubmission:a,product:i}=e.config,s=t(tn).useCallback(()=>{let{state:e,dispatch:t}=n;eQ()(e,t)},[n]),[d,c]=(0,tn.useState)(!1),p=(0,tn.useCallback)(()=>{c(!d),s()},[d,s]);return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)(r("1s5hv").default,{justifyContent:"space-between",xcss:"_4cvr1h6o",children:[(0,l.jsx)(r("5nBzc").default,{children:o(tx.betaLabel)}),(0,r("dh538").fg)("platform_editor_ai_context_panel_more_menu")&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r("52EPl").default,{trigger:({triggerRef:e,...n})=>(0,l.jsx)(r("1qfLF").default,{...n,appearance:"subtle",label:o(tx.moreMenuLabel),icon:t(r("9VJDA")),ref:e}),shouldRenderToParent:!0,placement:"bottom-end",children:(0,l.jsxs)(r("ahaN7").default,{children:[(0,l.jsx)(r("dAYOx").default,{onClick:p,children:o(tx.moreMenuManageSuggestions)}),(0,l.jsx)(r("dAYOx").default,{onClick:()=>{a&&a({sentiment:"recommendation-feedback",editorAttributes:{product:i}})},children:o(tx.moreMenuGiveFeedback)})]})}),(0,l.jsx)(tF,{isOpen:d,toggleModal:p,editorView:n})]})]})})},tq=e=>{let{formatMessage:o}=(0,r("8C5kA").default)(),{onClose:n,editorView:a,onClearSelectRecommendation:i}=e,s=o(tx.closeButtonLabel),{handleFeedbackSubmission:d,product:c}=e.config,[p,u]=(0,tn.useState)(!1),m=(0,tn.useCallback)(()=>{u(!p),i()},[p,i]);return(0,l.jsxs)(r("u9agA").default,{space:"space.100",alignBlock:"center",children:[(0,l.jsxs)(r("u9agA").default,{xcss:"_16jlkb7n _1o9zkb7n _i0dlf1ug",space:"space.100",alignBlock:"center",children:[(0,l.jsx)(r("7hXDW").default,{size:"medium",color:"color.text",children:o(tx.suggestionsTitle)}),(0,l.jsx)(r("5nBzc").default,{children:o(tx.betaLabel)})]}),(0,l.jsxs)(r("u9agA").default,{children:[(0,r("dh538").fg)("platform_editor_ai_context_panel_more_menu")&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r("52EPl").default,{trigger:({triggerRef:e,...n})=>(0,l.jsx)(r("1qfLF").default,{...n,appearance:"subtle",label:o(tx.moreMenuLabel),icon:t(r("9VJDA")),ref:e}),shouldRenderToParent:!0,placement:"bottom-end",children:(0,l.jsxs)(r("ahaN7").default,{children:[(0,l.jsx)(r("dAYOx").default,{onClick:m,children:o(tx.moreMenuManageSuggestions)}),(0,l.jsx)(r("dAYOx").default,{onClick:()=>{d&&d({sentiment:"recommendation-feedback",editorAttributes:{product:c}})},children:o(tx.moreMenuGiveFeedback)})]})}),(0,l.jsx)(tF,{isOpen:p,toggleModal:m,editorView:a})]}),(0,l.jsx)(r("1qfLF").default,{appearance:"subtle",label:s,icon:t(r("hmuev")),onClick:n,isTooltipDisabled:!1,tooltip:tU})]})]})};r("42omo"),r("42omo");let tH={pressable:"_syaz1rpy _k48pi7a9 _19bvze3t _u5f3ze3t _ca0qze3t _n3tdze3t _bfhksm61",pressableSelected:"_4bfu1r31 _1hms8stv _ajmmnqa1",pressableDisabled:"_syaz1gmx",container:"_zulpu2gc _2rko12b0 _19bvutpp _u5f3utpp _ca0qutpp _n3tdutpp _bfhkvuon _80omtlke",extraPadding:"_1q511b66",containerHovered:"_bfhk19i6",containerSelected:"_bfhk15s3",containerDisabled:"_syaz1gmx _80om13gf"},tj=e=>{let{title:t,description:o,onClick:n,onMouseEnter:a,onMouseLeave:i,isHovered:s,isSelected:d,isDisabled:c,iconBefore:p,iconAfter:u,actionButtons:m}=e;return(0,l.jsxs)("div",{onClick:c?void 0:n,onMouseEnter:c?void 0:a,onMouseLeave:c?void 0:i,className:(0,r("gMc0m").default)([tH.container,!c&&d&&tH.containerSelected,!c&&s&&!d&&tH.containerHovered,c&&tH.containerDisabled]),children:[(0,l.jsxs)(r("u9agA").default,{space:"space.150",alignBlock:"center",children:[p,(0,l.jsx)(r("u9agA").default,{grow:"fill",children:(0,l.jsx)(r("iXCQx").default,{weight:"semibold",size:"large",color:c?"color.text.disabled":"color.text",children:t})}),u]}),!!o&&(0,l.jsx)(r("iXCQx").default,{color:c?"color.text.disabled":"color.text.subtle",children:o}),!!m?.length&&(0,l.jsx)(r("u9agA").default,{space:"space.150",alignBlock:"center",xcss:tH.extraPadding,children:m})]})},t$=({key:e,isHovered:t,isDisabled:o,canHover:n,onClick:a,buttonLabel:i})=>(0,l.jsx)(r("fVUfS").default,{xcss:(0,r("1Whri").cx)(tH.pressable,n&&t&&tH.pressableSelected,o&&tH.pressableDisabled),onClick:a,isDisabled:o,children:i},e),tK=e=>{let{action:o,type:n,details:a,isViewed:i,isHovered:s,isSelected:d,isDisabled:c,onApply:p,onDismiss:u,onClick:m,onMouseEnter:f,onMouseLeave:g,onPreview:h}=e,{formatMessage:b}=(0,r("8C5kA").default)(),{description:y,title:_,icon:S}=z({transformAction:o,type:n,details:a}),E=b(_),v=b(y),T=(0,l.jsx)(t$,{canHover:!0,isDisabled:c,isHovered:s,onClick:h,buttonLabel:b(tx.recommendationPreviewButtonLabel)},"preview"),C=(0,l.jsx)(t$,{isDisabled:c,isHovered:s,onClick:p,buttonLabel:b(tx.recommendationReplaceButtonLabel)},"replace"),x=(0,l.jsx)(t$,{isDisabled:c,isHovered:s,onClick:u,buttonLabel:b(tx.recommendationDismissButtonLabel)},"dismiss");return(0,l.jsx)(tj,{title:E,description:v,isHovered:s,isSelected:d,isDisabled:c,onClick:m,onMouseEnter:f,onMouseLeave:g,iconBefore:(0,l.jsx)(S,{size:"small",label:E,color:c?"var(--ds-icon-disabled, #080F214A)":"var(--ds-icon, #292A2E)"}),iconAfter:i?null:(0,l.jsx)(t(r("e66a9")),{LEGACY_size:"small",label:"unread",LEGACY_primaryColor:c?"var(--ds-icon-disabled, #080F214A)":"var(--ds-icon-information, #357DE8)"}),actionButtons:d?[C,x]:[T,x]})},tz=e=>{let{errorCount:o,onClick:n}=e,{formatMessage:a}=(0,r("8C5kA").default)();return(0,l.jsx)(tj,{title:a(tx.spellingAndGrammarLabel),onClick:n,iconBefore:(0,l.jsx)(t(r("dLjaJ")),{label:a(tx.spellingAndGrammarLabel),color:"var(--ds-icon, #292A2E)"}),iconAfter:(0,l.jsx)(r("c4sKh").default,{children:o})})};r("42omo");var tW={};tW=new URL("dark.cacd877b.svg",import.meta.url).toString();var tY={};tY=new URL("light.45af45df.svg",import.meta.url).toString();let tX=({handleEnable:e})=>{let{formatMessage:o}=(0,r("8C5kA").default)();return(0,l.jsxs)(r("eyWa4").default,{space:"space.200",alignInline:"center",grow:"fill",children:[(0,l.jsx)(r("gj7hi").default,{src:t(tY),srcDark:t(tW)}),(0,l.jsxs)(r("eyWa4").default,{space:"space.200",alignInline:"center",children:[(0,l.jsx)(r("7hXDW").default,{color:"color.text",size:"small",children:o(tx.enableSuggestionsStateTitle)}),(0,l.jsx)(r("iXCQx").default,{align:"center",color:"color.text",size:"medium",children:o(tx.enableSuggestionsStateDescription)}),(0,l.jsx)(r("ccHMk").default,{appearance:"primary",onClick:e,children:o(tx.enableSuggestionsButtonLabel)})]})]})};r("42omo");var tJ={};tJ=new URL("dark.aff195af.svg",import.meta.url).toString();var tQ={};tQ=new URL("light.217157f5.svg",import.meta.url).toString();let tZ=({handleAskAI:e,isEditorDisabled:o})=>{let{formatMessage:n}=(0,r("8C5kA").default)();return(0,l.jsx)(r("gj7hi").default,{src:t(tQ),srcDark:t(tJ)}),(0,l.jsxs)(r("eyWa4").default,{space:"space.200",alignInline:"center",grow:"fill",children:[(0,l.jsx)(r("gj7hi").default,{src:t(tQ),srcDark:t(tJ)}),(0,l.jsxs)(r("eyWa4").default,{space:"space.200",alignInline:"center",children:[(0,l.jsx)(r("7hXDW").default,{color:"color.text",size:"small",children:n(tx.noSuggestionsStateTitle)}),(0,l.jsx)(r("iXCQx").default,{align:"center",color:"color.text",size:"medium",children:n(tx.noSuggestionsStateDescription,{i:e=>(0,l.jsx)("i",{children:e})})}),(0,l.jsx)(r("ccHMk").default,{appearance:"default",onClick:e,isDisabled:o,children:n(tx.askAIButtonLabel)})]})]})};r("42omo");var t0={};t0=new URL("dark.438a23d7.svg",import.meta.url).toString();var t1={};t1=new URL("light.f93d0cda.svg",import.meta.url).toString();let t2=({handleReloadSuggestions:e,isEditorDisabled:o})=>{let{formatMessage:n}=(0,r("8C5kA").default)();return(0,l.jsx)(r("gj7hi").default,{src:t(t1),srcDark:t(t0)}),(0,l.jsxs)(r("eyWa4").default,{space:"space.200",alignInline:"center",grow:"fill",children:[(0,l.jsx)(r("gj7hi").default,{src:t(t1),srcDark:t(t0)}),(0,l.jsxs)(r("eyWa4").default,{space:"space.200",alignInline:"center",children:[(0,l.jsx)(r("7hXDW").default,{color:"color.text",size:"small",children:n(tx.reloadSuggestionsStateTitle)}),(0,l.jsx)(r("iXCQx").default,{align:"center",color:"color.text",size:"medium",children:n(tx.reloadSuggestionsStateDescription)}),(0,l.jsx)(r("ccHMk").default,{appearance:"default",onClick:e,isDisabled:o,children:n(tx.reloadSuggestionsButtonLabel)})]})]})},t5={loading:"_1rjcpxbi _syaz1rpy",panelContainer:"_bozgze3t _4t3i1osq _1bsb1osq",emptyState:"_16jlegat _1o9zkb7n _i0dlf1ug",padEmptyState:"_16jlkb7n _1o9zkb7n _i0dlf1ug"},t4=({isLoading:e,isEditorDisabled:t,displayAllSuggestions:o,onReloadSuggestions:n,isEmptyDocument:a,onToggleSuggestions:i,onAskAI:s,hasNoMoreSuggestions:d})=>{let{formatMessage:c}=(0,r("8C5kA").default)();return o?e?(0,l.jsxs)(r("u9agA").default,{space:"space.100",alignInline:"center",grow:"fill",xcss:t5.loading,children:[(0,l.jsx)(r("d7r2R").default,{alt:""}),c(tx.findingSuggestionsLoadingLabel)]}):a||d?(0,l.jsx)(tZ,{handleAskAI:s,isEditorDisabled:t}):(0,l.jsx)(t2,{handleReloadSuggestions:n,isEditorDisabled:t}):(0,l.jsx)(tX,{handleEnable:i})},t9=e=>{let{recommendations:t,isEditorDisabled:o,isLoading:n,hoveredRecommendationId:a,selectedRecommendationId:i,isSpellingGrammarEnabled:s,spellingGrammarErrorCount:d,onRecommendationApply:c,onRecommendationDismiss:p,onRecommendationSelect:u,onSpellingGrammar:m,onRecommendationHover:f,onRecommendationLeave:g,onReloadSuggestions:h,onToggleSuggestions:b,onAskAI:y,displayAllSuggestions:_,isEmptyDocument:S,hasNoMoreSuggestions:E,onPanelClose:v,onClearSelectRecommendation:T,config:C,editorView:x}=e,{formatMessage:A}=(0,r("8C5kA").default)();return(0,l.jsxs)(r("eyWa4").default,{xcss:t5.panelContainer,space:"space.200",children:[!(0,r("dh538").fg)("platform_editor_ai_object_sidebar_injection")&&(0,l.jsx)(tq,{onClose:v,config:C,editorView:x,onClearSelectRecommendation:T}),(0,l.jsx)(r("eyWa4").default,{grow:"fill",alignBlock:"start",children:t?.length>0||(d??0)>0?(0,l.jsxs)(l.Fragment,{children:[s&&(d??0)>0&&(0,l.jsx)(tz,{errorCount:d??0,onClick:m}),t?.map(e=>(0,l.jsx)(tK,{id:e.id,action:e.transformAction,type:e.type,details:e.details,isViewed:e.isViewed,isHovered:e.id===a,isSelected:e.id===i,isDisabled:o,onApply:()=>c({recommendation:e}),onDismiss:()=>p({recommendation:e}),onClick:()=>u({recommendation:e}),onMouseEnter:()=>f({recommendation:e}),onMouseLeave:()=>g({recommendation:e}),onPreview:()=>u({recommendation:e})},e.id)),n&&(0,l.jsxs)(r("u9agA").default,{space:"space.100",grow:"fill",xcss:t5.loading,children:[(0,l.jsx)(r("d7r2R").default,{alt:""}),A(tx.findingMoreSuggestionsLoadingLabel)]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r("u9agA").default,{xcss:t5.emptyState,alignBlock:"center",children:(0,l.jsx)(t4,{isEditorDisabled:o,isLoading:n,displayAllSuggestions:_,onReloadSuggestions:h,onToggleSuggestions:b,onAskAI:y,isEmptyDocument:S,hasNoMoreSuggestions:E})}),(0,l.jsx)(r("gdv5Z").default,{xcss:t5.padEmptyState})]})})]})},t3=(e,t)=>o=>n=>{let a=eM(n);if(!a)return null;let{isProactiveEnabled:r,isProactiveContextPanelOpen:i}=a;if(!r||!i)return null;let s=t?.();return(0,l.jsx)(t8,{api:o,editorView:s,config:e})},t8=({api:e,editorView:t,config:o})=>{let n=e?.analytics?.actions,{locale:a}=(0,r("8C5kA").default)(),{recommendations:i,selectedRecommendationId:s,hoveredRecommendationId:d,displayAllSuggestions:c,isLoading:p,isEmptyDocument:u,hasNoMoreSuggestions:m,editorDisabled:f}=(0,r("eiA8Z").useSharedPluginStateWithSelector)(e,["aiProactive","editorDisabled"],e=>({recommendations:e.aiProactiveState?.recommendations,selectedRecommendationId:e.aiProactiveState?.selectedRecommendationId,hoveredRecommendationId:e.aiProactiveState?.hoveredRecommendationId,displayAllSuggestions:e.aiProactiveState?.displayAllSuggestions,isLoading:e.aiProactiveState?.isLoading,isEmptyDocument:e.aiProactiveState?.isEmptyDocument,hasNoMoreSuggestions:e.aiProactiveState?.hasNoMoreSuggestions,editorDisabled:e.editorDisabledState?.editorDisabled}));if(!i||!t)return null;let{documentChecker:g}=eM(t.state),h="contextPanel",b=e=>{let{state:o,dispatch:n}=t;e(o,n)},y=()=>{(0,r("dh538").fg)("platform_editor_ai_object_sidebar_injection")?b(eV(n)(h)):b(eB(n)(h))},_=async()=>{g&&g.refresh()};return(0,l.jsx)(t9,{isSpellingGrammarEnabled:!1,spellingGrammarErrorCount:0,recommendations:i,hoveredRecommendationId:d,selectedRecommendationId:s,onRecommendationApply:({recommendation:e})=>{b(eH({analyticsApi:n,recommendationId:e.id,triggeredFrom:h,insertionMethod:"replace"}))},onRecommendationDismiss:({recommendation:e})=>{b(ej({analyticsApi:n,recommendationId:e.id,triggeredFrom:h,feedback:{product:o.product,locale:a,editorView:t,handleFeedbackSubmission:o.handleFeedbackSubmission}}))},onRecommendationSelect:({recommendation:e})=>{b(eG(n)(e.id))},onRecommendationHover:({recommendation:e})=>{b(eY(e.id))},onRecommendationLeave:({recommendation:e})=>{b(eX())},onSpellingGrammar:()=>{},onReloadSuggestions:_,isEditorDisabled:f,isLoading:!!p,onClearSelectRecommendation:()=>{b(eQ())},onPanelClose:y,config:o,editorView:t,displayAllSuggestions:!!c,isEmptyDocument:!!u,hasNoMoreSuggestions:!!m,onToggleSuggestions:()=>{b(eK(A.ALL_SUGGESTIONS))},onAskAI:()=>{e?.aiExperience?.actions?.openAIModal({invokedFrom:"proactiveAIEmptyState"}),y()}})},t6=(e,t,o)=>n=>{let a=o.current,r=e?.contextPanel?.actions?.showPanel,i=e?.contextPanel?.actions?.closePanel;if(!a||!r||!i)return!1;let s=eM(a.state);if(!s||!s.isProactiveEnabled)return!1;s?.isProactiveContextPanelOpen?i():(r({id:"proactive-ai-panel",headerComponentElements:{headerLabel:tx.suggestionsTitle,HeaderRightAlignedElement:()=>(0,l.jsx)(tG,{editorView:a,config:t})},BodyComponent:()=>(0,l.jsx)(t8,{api:e,editorView:a,config:t}),closeOptions:{onPanelClose:()=>{eV(e?.analytics?.actions)("contextPanel")(a.state,a.dispatch)}}},"push",320),eB(e?.analytics?.actions)(n)(a.state,a.dispatch))},t7=e=>{let[t,o]=(0,tn.useState)(0);return(0,tn.useEffect)(()=>{if(!e)return;let n=new MutationObserver(e=>{e.forEach(e=>{let{addedNodes:n,removedNodes:a}=e;[...n,...a].some(e=>1===e.nodeType&&"DIV"===e.nodeName)&&o(t+1)})}),a=document.querySelector('[data-testid="ak-editor-main-toolbar"]');return a&&n.observe(a,{childList:!0,subtree:!0}),()=>{n.disconnect()}},[t,e]),t},oe={unreadBadgeCorner:"_kqswstnw _1xi2r5cr _154i1i6y",buttonWrapper:"_kqswh2mm",truncatingText:"_1reo15vq _18m915vq _o5721q9c _1bto1l2s _1e0c1o8l"},ot="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>-1,oo={default:"_16r2w4bv _1s6kw4bv",firefox:"_16r21l3w _1s6k1l3w _19h915ob _1ank15ob"},on={default:"_19oh1pbh _10881pbh _kwc0ymdr _joxlymdr _18lgp3kn _zo24p3kn _18f312c5 _evp612c5",firefox:"_19oh1pbh _10881pbh _kwc09cwz _joxl9cwz _18lgp3kn _zo24p3kn _18f312c5 _evp612c5 _unfq4jg8 _9nev4jg8"},oa=({isLoading:e,children:t})=>{let[o,n]=(0,tn.useState)(e??!1);return((0,tn.useEffect)(()=>{if(e)n(!0);else{let e=setTimeout(()=>n(!1),3600);return()=>clearTimeout(e)}},[e]),e||o)?(0,l.jsx)("div",{className:(0,r("gMc0m").default)(["_2rkobz73 _kqswh2mm _16qsglyw _14mjcvhe _rfx3cvhe _aetrb3bt _1kt9b3bt _18postnw _1cs8stnw _1bqq1mrw _1g0v1mrw _z0ai1b4h _1mp41b4h _1qdg1b4h _kfgt1b4h _15l21n1a _1auk1n1a _19do1n1a _qnec1n1a _clh3161g _7dwz161g _15l21pry _1peq105o _ta6yglyw",oo[ot?"firefox":"default"],"_2rko12b0 _bfhk1bhr _14mj1jb2 _rfx31jb2",e&&on[ot?"firefox":"default"],!e&&o&&"",!e&&o&&"_19oh19vj _108819vj _kwc01ye9 _joxl1ye9 _18lg6ui8 _zo246ui8 _hxkhq7pw _1f25q7pw _1iesi11n _1r9li11n"]),children:t}):(0,l.jsx)(r("gdv5Z").default,{xcss:oe.buttonWrapper,children:t})},or=({onClick:e,isDisabled:o,isSelected:n,isLoading:a,unreadCount:i,api:s})=>{let{formatMessage:d}=(0,r("8C5kA").default)(),c=(0,r("b3YrF").useSharedPluginStateSelector)(s,"width.width"),p=!c||c>=1076,u=n?d(r("SFzFl").default.aiProactiveCloseDescriptor):d(r("SFzFl").default.aiProactiveDescriptor,{count:i}),m=!a&&(i??0)>0&&(0,l.jsx)(r("c4sKh").default,{max:4,appearance:"primary",children:i}),f=(0,l.jsx)(r("d7r2R").default,{alt:d(tx.loadingIconAltText)}),g=(0,l.jsx)(t(r("e2ZTm")),{label:u,color:"currentColor"}),h=!p&&a?f:g,b=(0,l.jsxs)(r("u9agA").default,{space:"space.075",alignBlock:"center",children:[(0,l.jsx)(r("gdv5Z").default,{xcss:oe.truncatingText,children:d(r("SFzFl").default.aiProactiveButtonLabel)}),a&&f,m]});return(0,l.jsxs)(oa,{isLoading:a,children:[(0,l.jsx)(r("a4eZN").default,{onClick:e,buttonId:r("8TW6I").TOOLBAR_ACTION_SUBJECT_ID.AI,"aria-label":u,testId:"atlassian-intelligence-toolbar-button",title:u,iconBefore:h,disabled:o,selected:n??!1,children:p&&b}),!p&&(0,l.jsx)(r("gdv5Z").default,{xcss:oe.unreadBadgeCorner,children:m})]})},oi=({onClick:e,disabled:t,selected:o,loading:n,unreadCount:a,ButtonWrapper:i,api:s})=>{let d=(0,l.jsx)(or,{onClick:e,isDisabled:t,isSelected:o,isLoading:n,unreadCount:a,api:s}),c=t7(i);return(0,l.jsx)("span",{className:(0,r("gMc0m").default)(["_1e0c1txw _4cvr1h6o _18u0idpf _1ul91wug _p7r11txw _1xdi1txw _1ylx1txw _1fvdglyw","_1c1bglyw"]),children:i?(0,l.jsx)(i,{children:d},`${c}-key-wrapper`):d})},os=({api:e,toggleSuggestionsPanel:t,disabled:o,editorView:n})=>{let a=(0,r("b3YrF").useSharedPluginStateSelector)(e,"connectivity.mode"),i=(0,r("b3YrF").useSharedPluginStateSelector)(e,"aiProactive.isProactiveContextPanelOpen"),s=(0,r("b3YrF").useSharedPluginStateSelector)(e,"aiProactive.showNewRecommendationsNotification"),d=(0,r("b3YrF").useSharedPluginStateSelector)(e,"aiProactive.unreadRecommendationCount"),c=(0,tn.useCallback)(()=>{if(t&&(0,r("dh538").fg)("platform_editor_ai_object_sidebar_injection"))t("mainToolbar");else{let{state:t,dispatch:o}=n;eB(e?.analytics?.actions)("mainToolbar")(t,o)}},[e?.analytics?.actions,n,t]),p=(0,r("91bcx").isOfflineMode)(a);return(0,l.jsx)(oi,{api:e,onClick:c,disabled:o||p,selected:!!i,loading:!i&&!!s,unreadCount:d})},ol=({api:e,aiGlobalOptIn:t,toggleSuggestionsPanel:o})=>({editorView:n,disabled:a})=>n?(0,l.jsx)(os,{editorView:n,api:e,aiGlobalOptIn:t,disabled:a,toggleSuggestionsPanel:o}):null,od=({api:e,aiGlobalOptIn:t})=>({editorView:o,disabled:n})=>o?(0,l.jsx)(os,{editorView:o,api:e,aiGlobalOptIn:t,disabled:n}):null;e.exports.aiProactivePlugin=({api:e,config:t})=>{let o={current:void 0},n=async t=>{let{mentionProvider:o}=e?.mention?.sharedState.currentState()||{};if(!o||!(0,r("bqMS3").isResolvingMentionProvider)(o))return;let n=o.resolveMentionName(t);return(0,r("6mYMS").isPromise)(n)?await n:n},{product:a,aiGlobalOptIn:i}=t,s=i||{status:"enabled",triggerOptInFlow:()=>{}};return e?.primaryToolbar?.actions.registerComponent({name:"aiExperience",component:(0,r("dh538").fg)("platform_editor_ai_object_sidebar_injection")?ol({api:e,aiGlobalOptIn:s,toggleSuggestionsPanel:t6(e,t,o)}):od({api:e,aiGlobalOptIn:s})}),{name:"aiProactive",pmPlugins:()=>[{name:"aiProactiveEditorViewRef",plugin:()=>new(0,r("1S4f7").SafePlugin)({view:e=>(o.current=e,{})})},{name:"ai-proactive-plugin",plugin:({dispatch:t,getIntl:o,dispatchAnalyticsEvent:i})=>{i({action:"init",actionSubject:"editor",actionSubjectId:"editorPluginAIProactive",eventType:r("d925B").EVENT_TYPE.TRACK,attributes:{aiGlobalOptIn:s?.status}});let{dispatch:l,getIntl:d,proactiveAIConfig:c,product:p,api:u,getMentionNameDetails:m}={dispatch:t,getIntl:o,proactiveAIConfig:{enabled:!0,defaultToggledState:!1,apiUrl:`${function(){let{origin:e="",port:t="",hostname:o=""}=void 0!==window.location?window.location:{};return"localhost"===o&&"8081"!==t||["atlaskit-website-staging.stg-east.frontend.public.atl-paas.net","statlas.prod.atl-paas.net","atlaskit.atlassian.com"].some(e=>o===e)?"https://pug.jira-dev.com":e}()}/gateway/api/assist/ai/v2/ai-feature/proactive`,timings:{currentChunks:-1,currentChunksMaxWait:3e4,nonCurrentChunks:5e3},documentChecker:{enabled:!0,blocksPerRequest:7,timings:{delayBetweenChecks:0,numberOfRequestsForIncrease:2,delayIncrease:0,maxDelay:0}}},product:a,getMentionNameDetails:n,api:e},f=u?.analytics?.actions;return new(0,r("1S4f7").SafePlugin)({key:y,state:eD(l,ew({proactiveAIApiUrl:c.apiUrl,documentChecker:c.documentChecker?.enabled?new tt(c.documentChecker,{getChunks:e=>{let t=eM(e);return(t?.proactiveAIBlocks??[]).filter(e=>!L(e)&&!!e.invalidatedForDocChecker)},triggerCallback:(e,t)=>e1({analyticsApi:f,chunks:e,context:{view:t,locale:d().locale,getMentionNameDetails:m}}),resetChunksForDocChecker:e=>e6()(e.state,e.dispatch),onScanComplete:(e,t)=>{let{availableRecommendationIds:o,insertionCount:n,dismissedCount:a}=eM(e.state);u?.analytics?.actions.fireAnalyticsEvent({action:"docScanCompleted",actionSubject:"editorPluginAI",actionSubjectId:"proactiveSuggestion",attributes:{duration:t,documentSize:e.state.doc.nodeSize,nodeCount:(0,r("dFD5l").countNodes)(e.state).nodeCount,totalSuggestions:o.size,totalAcceptedSuggestions:n,totalDismissedSuggestions:a},eventType:r("d925B").EVENT_TYPE.TRACK})}}):void 0,rateLimiter:new b(1e3,2e3,3),defaultToggledState:c.defaultToggledState,product:p})),view(e){let{documentChecker:t,rateLimiter:o}=eM(e.state),{locale:n}=d(),{triggerProactiveCheck:a,cancelDebouncedAndThrottledCheck:r,triggerProactiveCheckImmediately:i}=e8({analyticsApi:f,timings:c.timings});t&&t.setView(e);let s=o?.init({onRetry:()=>i({view:e,locale:n,getMentionNameDetails:m}),onRetryEnqueue:()=>{t?.stop(),r()},onRetriesExhausted:()=>{eF(f)("rateLimiterMaxRetries")(e.state,e.dispatch)}}),l=u?.editorViewMode?.sharedState.onChange(t=>{t.nextSharedState?.mode!==t.prevSharedState?.mode&&t.nextSharedState?.mode!=="edit"&&eV(f)("viewModeChanged")(e.state,e.dispatch)});return to(e),{update:(e,t)=>{let{isProactiveEnabled:o}=eM(e.state);!o||t.doc.eq(e.state.doc)&&t.selection.eq(e.state.selection)||a({view:e,locale:n,getMentionNameDetails:m})},destroy:()=>{l?.(),r(),t?.reset(),s?.(),to?.cancel()}}},props:{decorations:e=>{let{isProactiveEnabled:t,decorationSet:o,alwaysDisplayProactiveInlineDecorations:n,isProactiveContextPanelOpen:a,settings:{displayAllSuggestions:i}}=eM(e);return t&&u?.editorViewMode?.sharedState.currentState()?.mode==="edit"&&i&&(n||a)?o:r("ftzrq").DecorationSet.empty},handleClick:(e,t)=>{if(u?.editorDisabled?.sharedState?.currentState()?.editorDisabled)return!1;let{state:o,dispatch:n}=e;if(o.selection.from!==o.selection.to)return!1;let a=eM(o),{isProactiveEnabled:r,selectedRecommendationId:i,isProactiveContextPanelOpen:s}=a;if(!r||!s)return!1;if(i)return eQ()(o,n);{let e=function(e,t){let o=eo(e,t)?.recommendations??[],{settings:n}=e;return K(o,n)}(a,t),r=e?.[0]?.id;if(r)return eG(f)(r)(o,n)}return!1}}})}}],getSharedState(e){if(!e)return{isProactiveEnabled:!1,recommendations:[],displayAllSuggestions:!1,isLoading:!1,isEmptyDocument:!1,hasNoMoreSuggestions:!0,displayAllPanelSuggestions:!1,isProactiveContextPanelOpen:!1,showNewRecommendationsNotification:!1,unreadRecommendationCount:0,decorationSet:void 0};let t=y.getState(e)??{},o=er(t)??[];return{isProactiveEnabled:t.isProactiveEnabled??!1,recommendations:o,selectedRecommendationId:t.selectedRecommendationId,hoveredRecommendationId:t.hoveredRecommendationId,isLoading:t.isLoading,isEmptyDocument:(0,r("2pjJ5").isEmptyDocument)(e.doc),displayAllSuggestions:t?.settings?.displayAllSuggestions??!1,displayAllPanelSuggestions:t?.settings?.displayAllPanelSuggestions??!1,hasNoMoreSuggestions:t.hasNoMoreSuggestions,isProactiveContextPanelOpen:t.isProactiveContextPanelOpen??!1,showNewRecommendationsNotification:t.showNewRecommendationsNotification??!1,unreadRecommendationCount:function(e){let{proactiveAIBlocks:t}=e;return t?.flatMap(e=>e.recommendations??[]).filter(e=>!e.isViewed&&!e.filtered).length??0}(t),decorationSet:t.decorationSet,analyticsAIInteractionId:t.analyticsAIInteractionId}},contentComponent:({editorView:o,wrapperElement:n,appearance:a,providerFactory:r})=>o?(0,l.jsx)(tM,{api:e,editorView:o,wrapperElement:n,appearance:a,config:t,providerFactory:r}):null,pluginsOptions:(0,r("dh538").fg)("platform_editor_ai_object_sidebar_injection")?{}:{contextPanel:t3(t,()=>o.current)(e)}}}}),i("5jDm8",function(e,t){var o=Math.floor,n=Math.random;e.exports=function(e,t){return e+o(n()*(t-e+1))}}),i("jLyos",function(e,t){let o=(0,r("eSUdr").default)`query PersonalSpaceDetailQuery{user:confluence_atlassianUser(current:true){id confluence{space{id key dataClassificationTags}}}}`;e.exports.preloadPersonalSpaceDetail=()=>(0,r("dYU3e").query)({query:o})}),i("7WOVi",function(e,t){let o=e=>(0,r("dYU3e").query)({query:r("kwDQA").default,variables:{contentId:e}});async function n(e){return(0,r("dYU3e").query)({query:r("8EyOs").default,variables:{contentId:e,isDraft:!1,format:"USER_FRIENDLY"},fetchPolicy:"network-only"})}var a=r("fiBb3"),i=r("80xNa");e.exports.preloadContentHeader=function({spaceKey:e,contentId:t,isLicensed:s,userId:l,username:d,edition:c,isPrevEditRoute:p=!1,useNewContentTopper:u=!1,isLivePageRoute:m=!1}){let f=[];"undefined"==typeof window||(0,r("9wGTI").fg)("confluence_preload_favourite_button")&&m||f.push(l?(0,r("dYU3e").query)({query:r("727Kl").default,variables:{contentId:t}}):Promise.resolve({}));let g=!1,h=e=>(g||(g=!!e?.hasErrors),e);if(!p){f.push((()=>{let o=(0,r("4JHZe").beforePreloaderAsyncCall)();return(0,r("dYU3e").query)({query:a.ContentHeaderUnifiedQuery,variables:{contentId:t,spaceKey:e,versionOverride:null,embeddedContentRender:null,limit:i.DEFAULT_CONTRIBUTORS_FETCH_LIMIT,useNewContentTopper:u,includeGeneratedBy:(0,r("9wGTI").fg)("cc-activation-user-generated-by-byline")}}).then(e=>((0,r("4JHZe").afterPreloaderAsyncCall)(o),h(e)))})()),m||f.push((()=>{let e=(0,r("4JHZe").beforePreloaderAsyncCall)();return n(t).then(t=>((0,r("4JHZe").afterPreloaderAsyncCall)(e),h(t)))})()),t&&d&&f.push((0,r("dYU3e").query)({query:r("e3X7L").default,variables:{contentId:t,accountId:d}}));let o=c===i.CONFLUENCE_EDITION.FREE;f.push((0,r("3Tnjq").preloadPageRestrictionsQuery)(t,o))}let b=r("4VJDS").default.getNumber("confluence_frontend_preload_content_header_timeout",r("wPrRK").SLOW_QUERY_DEFAULT_TIMEOUT);f.push((0,r("kb8ij").preloadWatchDialog)({contentId:t,isLicensed:s,userId:l})),f.push((0,r("3D1KL").preloadEditButton)({spaceKey:e,contentId:t})),f.push((0,r("wPrRK").slowQueryGuard)("preloadContentAnalyticsViewers",()=>(()=>{let e=(0,r("4JHZe").beforePreloaderAsyncCall)();return o(t).then(t=>((0,r("4JHZe").afterPreloaderAsyncCall)(e),h(t)))})(),b)),!m&&(0,r("9wGTI").fg)("confluence_frontend_content_wrapper")&&f.push((0,r("4vyfK").preloadWebItemLocation)({location:"page.metadata.banner",contentId:t}));let y=(0,r("4JHZe").beforePreloaderAsyncCall)();return(0,r("lyWac").waitForAllReturnWhenError)(f).then(e=>((0,r("4JHZe").afterPreloaderAsyncCall)(y),!!(e||g)))}}),i("jhATi",function(e,t){let o=async({url:e,userContext:t,body:o})=>{let{host:n,cloudId:a}=(0,r("60cDW").getSSRRenderInputs)(),i={method:"POST",headers:{Cookie:(0,r("jQQYu").createCookie)(t),Accept:"application/json","Content-Type":"application/json",Origin:n.startsWith("http")?n:`https://${n}`,CloudId:a,"X-Product":"CONFLUENCE"},body:o};return(0,r("f7B1p").cfetch)(e,i)};e.exports.fetchORSForSSR=o}),i("hR977",function(e,t){e.exports.getInitialState=e=>!Array.isArray(e)||e?.length<1?{}:e?.reduce((e,t)=>{let o=t?.status,n=t?.body,a=t?.body?.data?.url;if(!a){window.__SSR_SMARTLINKS_ERRORS__=window.__SSR_SMARTLINKS_ERRORS__||{};let t=window.__SSR_SMARTLINKS_ERRORS__;return t[o]=t[o]?t[o]+1:1,e}let i={status:(0,r("8XUSS").getStatus)(o,t?.body?.meta?.access),details:n};return{...e,[a]:i}},{})}),i("8tmcF",function(e,t){e.exports.timeGuard=function(e,t,o){return Promise.race([e(),new Promise(e=>setTimeout(()=>{e("function"==typeof t?t():t)},o))])}}),i("cdE3K",function(e,t){let o=async e=>{let t=[];if(e.userId&&(0,r("9wGTI").fg)("post-office-confluence-side-nav-placement-rollout")){let o=async()=>r("9WAeG").SSRMeasures.run("ssr-app/prepare/preloadQuery/postOffice:ConfluenceSideNav",async()=>(0,r("MyxIQ").preloadPostOfficePlacementWithSessionContext)("confluence-side-nav",e));t.push(o())}return(0,r("lyWac").waitForAllReturnWhenError)(t)};e.exports.preloadPostOfficeConfluenceSideNav=o}),i("8XUSS",function(e,t){let o="forbidden",n="unauthorized";e.exports.getStatus=(e,t)=>t===o||t===n?t:({200:"resolved",401:n,403:o,404:"not_found"})[e]||"errored"}),o.rlb("7pPlh");
//# sourceMappingURL=FullPageEditorComponent.0f711a23.js.map
