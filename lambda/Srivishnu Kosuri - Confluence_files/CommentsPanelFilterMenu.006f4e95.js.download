var e=globalThis.parcelRequired477,t=e.register;t("8pvtc",function(t,r){let o=(0,e("eSUdr").default)`query WebPanelLocationQuery($location:String$contentId:ID$spaceKey:String){webPanels(location:$location contentId:$contentId key:$spaceKey){moduleKey completeKey html location label weight name}}`;t.exports.WebPanelLocationQuery=o}),t("awHlv",function(e,t){var r,o=((r={}).Errored="errored",r.NotFound="not_found",r.Forbidden="forbidden",r.InvalidRequest="invalid_request",r.RateLimited="rate_limited",r.Conflict="conflict",r.ServerError="server_error",r.InvalidContent="invalid_content",r.Offline="offline",r);e.exports.SyncBlockError=o}),t("cFpEg",function(t,r){let o=(t,r)=>({action:e("d925B").ACTION.ERROR,actionSubject:e("d925B").ACTION_SUBJECT.SYNCED_BLOCK,actionSubjectId:t,eventType:e("d925B").EVENT_TYPE.OPERATIONAL,attributes:{error:r}});t.exports.stringifyError=e=>{try{return JSON.stringify(e)}catch{return}},t.exports.fetchErrorPayload=t=>o(e("d925B").ACTION_SUBJECT_ID.SYNCED_BLOCK_FETCH,t),t.exports.getSourceInfoErrorPayload=t=>o(e("d925B").ACTION_SUBJECT_ID.SYNCED_BLOCK_GET_SOURCE_INFO,t),t.exports.updateErrorPayload=t=>o(e("d925B").ACTION_SUBJECT_ID.SYNCED_BLOCK_UPDATE,t),t.exports.updateReferenceErrorPayload=t=>o(e("d925B").ACTION_SUBJECT_ID.REFERENCE_SYNCED_BLOCK_UPDATE,t),t.exports.createErrorPayload=t=>o(e("d925B").ACTION_SUBJECT_ID.SYNCED_BLOCK_CREATE,t),t.exports.deleteErrorPayload=t=>o(e("d925B").ACTION_SUBJECT_ID.SYNCED_BLOCK_DELETE,t),t.exports.updateCacheErrorPayload=t=>o(e("d925B").ACTION_SUBJECT_ID.SYNCED_BLOCK_UPDATE_CACHE,t)}),t("1a6Dn",function(t,r){var o=e("T1bCI");class i extends o.Container{constructor(...t){super(...t),this.state={floatingBanners:[]},this.showFloating=(t,r)=>{let o=(0,e("hrAmX").findBanner)(t,this.state.floatingBanners);-1===o?this.setState(e=>{let o=[...e.floatingBanners];return o.push({name:t,height:r}),{...e,floatingBanners:o}}):this.state.floatingBanners[o].height!==r&&this.setState(e=>{let t=[...e.floatingBanners];return t[o].height=r,{...e,floatingBanners:t}})},this.hideFloating=t=>{let r=(0,e("hrAmX").findBanner)(t,this.state.floatingBanners);r>-1&&this.setState(e=>{let t=[...e.floatingBanners];return t.splice(r,1),{...e,floatingBanners:t}})},this.getFloatingHeightBefore=t=>{let r=(0,e("hrAmX").findBanner)(t,this.state.floatingBanners);return -1===r?0:this.state.floatingBanners.slice(0,r).reduce((e,t)=>e+t.height,0)},this.getFloatingHeight=()=>this.state.floatingBanners.reduce((e,t)=>e+t.height,0)}}t.exports.FloatingBannerStateContainer=i}),t("8WfxO",function(t,r){var o=e("3u0dr"),i=e("frIzR"),n=e("42omo");let a=(0,o.isReactCompilerActiveV1)()?()=>{let t,r,o,a,l,d=(0,i.c)(10);d[0]===Symbol.for("react.memo_cache_sentinel")?(t=[],d[0]=t):t=d[0];let h=(0,n.useRef)(t),[u,y]=(0,n.useState)(s),[f]=(0,e("ep3mz").usePageState)(),{contentId:p,spaceKey:g}=f;d[1]!==p||d[2]!==g?(r={location:e("eSLr0").ATL_GENERAL,fetchPolicy:"cache-first",spaceKey:g,contentId:p},d[1]=p,d[2]=g,d[3]=r):r=d[3];let{panels:E}=(0,e("dS3n9").useWebPanelLocation)(r),v=E.length>0;return d[4]!==v?(o=()=>{let t=t=>{let r;(0,e("6mKj3").expVal)("confluence_p2m_style_recalc_and_expand_joint_exp","isEnabled",!1)?(y(t?.detail?.height??0),r=t?.detail?.height??0):(y(c()),r=c()),"undefined"!=typeof window&&window.__SSR_RENDERED__&&((0===h.current.length?window.__ATL_GENERAL_WEBPANEL_INITIAL_HEIGHT__||0:h.current[h.current.length-1])!==r&&h.current.push(r),window.__ATL_GENERAL_WEBPANEL_HEIGHT_CHANGES__=h.current)};return v&&document.addEventListener("atlGeneralWebPanelHeightUpdated",t),()=>{v&&document.removeEventListener("atlGeneralWebPanelHeightUpdated",t)}},a=[v],d[4]=v,d[5]=o,d[6]=a):(o=d[5],a=d[6]),(0,n.useEffect)(o,a),d[7]!==v||d[8]!==u?(l={isATLGeneralWebPanelFixed:v,atlGeneralWebPanelHeight:u},d[7]=v,d[8]=u,d[9]=l):l=d[9],l}:()=>{let t=(0,n.useRef)([]),[r,o]=(0,n.useState)(()=>"undefined"!=typeof window&&window.__SSR_RENDERED__&&(0,e("6mKj3").expVal)("confluence_p2m_style_recalc_and_expand_joint_exp","isEnabled",!1)?window.__ATL_GENERAL_WEBPANEL_INITIAL_HEIGHT__??0:c()),[{contentId:i,spaceKey:a}]=(0,e("ep3mz").usePageState)(),{panels:s}=(0,e("dS3n9").useWebPanelLocation)({location:e("eSLr0").ATL_GENERAL,fetchPolicy:"cache-first",spaceKey:a,contentId:i}),l=s.length>0;return(0,n.useEffect)(()=>{let r=r=>{let i;(0,e("6mKj3").expVal)("confluence_p2m_style_recalc_and_expand_joint_exp","isEnabled",!1)?(o(r?.detail?.height??0),i=r?.detail?.height??0):(o(c()),i=c()),"undefined"!=typeof window&&window.__SSR_RENDERED__&&((0===t.current.length?window.__ATL_GENERAL_WEBPANEL_INITIAL_HEIGHT__||0:t.current[t.current.length-1])!==i&&t.current.push(i),window.__ATL_GENERAL_WEBPANEL_HEIGHT_CHANGES__=t.current)};return l&&document.addEventListener("atlGeneralWebPanelHeightUpdated",r),()=>{l&&document.removeEventListener("atlGeneralWebPanelHeightUpdated",r)}},[l]),{isATLGeneralWebPanelFixed:l,atlGeneralWebPanelHeight:r}},c=()=>"undefined"==typeof document?0:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--atl-general-webpanel-height"))||0;function s(){return"undefined"!=typeof window&&window.__SSR_RENDERED__&&(0,e("6mKj3").expVal)("confluence_p2m_style_recalc_and_expand_joint_exp","isEnabled",!1)?window.__ATL_GENERAL_WEBPANEL_INITIAL_HEIGHT__??0:c()}t.exports.useATLGeneralWebPanelListener=a}),t("dS3n9",function(t,r){var o=e("42omo"),i=e("j1Ss3");t.exports.useWebPanelLocation=({spaceKey:t,contentId:r,location:n,fetchPolicy:a="cache-and-network",onCompleted:c})=>{let{getQueryParams:s}=(0,o.useContext)(e("7zgzO").RoutesContext),l=s(),d=t||(0,e("c3Qwv").getSingleParam)(l,"spaceKey")||(0,e("c3Qwv").getSingleParam)(l,"key"),h=r||(0,e("c3Qwv").getSingleParam)(l,"pageId"),u={variables:h?{contentId:h,location:n}:{spaceKey:d,location:n},...c&&{onCompleted:c}},{loading:y,data:f,error:p}=(0,e("6mKj3").expValEquals)("confluence_stop_watching_webpanellocationquery","isEnabled",!0)?(0,e("jtuBN").useQueryNoFurtherUpdateInterop)(e("8pvtc").WebPanelLocationQuery,u):(0,i.useQuery)(e("8pvtc").WebPanelLocationQuery,{...u,fetchPolicy:a});return{panels:(f?.webPanels||[]).filter(e=>e),loading:y,error:p}}}),t("gtauf",function(e,t){let r=(e,t)=>({type:"syncBlock",attrs:{localId:e,resourceId:t}}),o=e=>{if("syncBlock"===e.type.name&&e.attrs?.localId&&e.attrs?.resourceId&&"string"==typeof e.attrs.localId&&"string"==typeof e.attrs.resourceId)return r(e.attrs.localId,e.attrs.resourceId)};e.exports.convertSyncBlockPMNodeToSyncBlockData=e=>({blockInstanceId:e.attrs.localId,content:e.content.toJSON(),resourceId:e.attrs.resourceId}),e.exports.createSyncBlockNode=r,e.exports.convertSyncBlockJSONNodeToSyncBlockNode=e=>{if("syncBlock"===e.type&&e.attrs&&"localId"in e.attrs&&"resourceId"in e.attrs&&"string"==typeof e.attrs.localId&&"string"==typeof e.attrs.resourceId)return r(e.attrs.localId,e.attrs.resourceId)},e.exports.convertPMNodesToSyncBlockNodes=e=>e.map(e=>o(e)).filter(e=>void 0!==e)||[],e.exports.getContentIdAndProductFromResourceId=e=>{let t=e.match(/^(confluence-page|jira-work-item)\/([^/]+)/);if(t?.[2])return{sourceProduct:t[1],sourceContentId:t[2]};throw Error(`Invalid resourceId: ${e}`)}}),t("lEQpi",function(t,r){var o=e("42omo");class i{get referenceManager(){return this.referenceSyncBlockStoreManager}get sourceManager(){return this.sourceSyncBlockStoreManager}destroy(){this.referenceSyncBlockStoreManager.destroy(),this.sourceSyncBlockStoreManager.destroy()}constructor(t,r){this.referenceSyncBlockStoreManager=void 0,this.sourceSyncBlockStoreManager=void 0,this.sourceSyncBlockStoreManager=new(0,e("dBGrG").SourceSyncBlockStoreManager)(t,r),this.referenceSyncBlockStoreManager=new(0,e("3RNNl").ReferenceSyncBlockStoreManager)(t,r)}}t.exports.SyncBlockStoreManager=i,t.exports.useMemoizedSyncBlockStoreManager=(e,t)=>(0,o.useMemo)(()=>new i(e,t),[e,t])}),t("3RNNl",function(t,r){t.exports.ReferenceSyncBlockStoreManager=class{generateResourceIdForReference(e){if(!this.dataProvider)throw Error("Data provider not set");return this.dataProvider.generateResourceIdForReference(e)}updateFireAnalyticsEvent(e){this.fireAnalyticsEvent=e}getInitialSyncBlockData(t){let r=(0,e("gtauf").createSyncBlockNode)("",t);return this.getFromCache(t)||this.dataProvider?.getNodeDataFromCache(r)?.data}async refreshSubscriptions(){if(this.isRefreshingSubscriptions)return;this.isRefreshingSubscriptions=!0;let t=[];for(let[r,o]of this.subscriptions.entries())Object.keys(o).forEach(o=>{t.push((0,e("gtauf").createSyncBlockNode)(o,r))});try{await this.fetchSyncBlocksData(t)}catch(t){(0,e("hWRJP").logException)(t,{location:"editor-synced-block-provider/referenceSyncBlockStoreManager"}),this.fireAnalyticsEvent?.((0,e("cFpEg").fetchErrorPayload)(t.message))}finally{this.isRefreshingSubscriptions=!1}}fetchSyncBlockSourceInfo(t){try{if(!t||!this.dataProvider)throw Error("Data provider or resourceId not set");if(this.syncBlockSourceInfoRequests.get(t))return;let r=this.getFromCache(t);if(!r)throw Error("No existing sync block to fetch source info for");if(r.data?.sourceURL&&r.data?.sourceTitle)return;let{sourceAri:o,product:i,blockInstanceId:n}=r.data||{};if(!o||!i||!n)return void this.fireAnalyticsEvent?.((0,e("cFpEg").getSourceInfoErrorPayload)("SourceAri, product or blockInstanceId missing"));this.syncBlockSourceInfoRequests.set(t,!0),this.dataProvider.fetchSyncBlockSourceInfo(n,o,i,this.fireAnalyticsEvent).then(e=>{e&&(this.updateCacheWithSourceInfo(t,e),e.title&&this.updateSourceTitleSubscriptions(t,e.title))}).catch(t=>{this.fireAnalyticsEvent?.((0,e("cFpEg").getSourceInfoErrorPayload)(t.message))}).finally(()=>{this.syncBlockSourceInfoRequests.delete(t)})}catch(t){(0,e("hWRJP").logException)(t,{location:"editor-synced-block-provider/referenceSyncBlockStoreManager"}),this.fireAnalyticsEvent?.((0,e("cFpEg").getSourceInfoErrorPayload)(t.message))}}async fetchSyncBlocksData(t){if(0===t.length)return;if(!this.dataProvider)throw Error("Data provider not set");let r=[];t.forEach(t=>{if(this.syncBlockFetchDataRequests.get(t.attrs.resourceId))return;let o=this.getFromCache(t.attrs.resourceId);o?.error!==e("awHlv").SyncBlockError.NotFound&&r.push(t)}),r.forEach(e=>{this.syncBlockFetchDataRequests.set(e.attrs.resourceId,!0)});let o=await this.dataProvider.fetchNodesData(r).finally(()=>{r.forEach(e=>{this.syncBlockFetchDataRequests.delete(e.attrs.resourceId)})}),i=[];o.forEach(t=>{if(!t.resourceId)return void this.fireAnalyticsEvent?.((0,e("cFpEg").fetchErrorPayload)(t.error||"Returned sync block instance does not have resource id"));let r=this.getFromCache(t.resourceId),o=r?(0,e("4wATI").resolveSyncBlockInstance)(r,t):t;if(this.updateCache(o),i.push(o),t.error)return void this.fireAnalyticsEvent?.((0,e("cFpEg").fetchErrorPayload)(t.error));this.fetchSyncBlockSourceInfo(o.resourceId)})}updateCacheWithSourceInfo(e,t){let r=this.getFromCache(e);r&&r.data&&(r.data.sourceURL=t?.url,r.data={...r.data,sourceURL:t?.url,sourceTitle:t?.title},this.updateCache(r))}updateCache(e){let{resourceId:t}=e;if(t){this.syncBlockCache.set(t,e);let r=this.subscriptions.get(t);r&&Object.values(r).forEach(t=>{t(e)})}}updateSourceTitleSubscriptions(e,t){let r=this.titleSubscriptions.get(e);r&&Object.values(r).forEach(e=>{e(t)})}getFromCache(e){return this.syncBlockCache.get(e)}deleteFromCache(e){this.syncBlockCache.delete(e),this.providerFactories.delete(e)}subscribeToSyncBlock(t,r,o){let i=this.subscriptions.get(t)||{};this.subscriptions.set(t,{...i,[r]:o}),this.isCacheDirty=!0;let n=(0,e("gtauf").createSyncBlockNode)(r,t),a=this.getFromCache(t)||this.dataProvider?.getNodeDataFromCache(n)?.data;return a?o(a):this.fetchSyncBlocksData([n]).catch(t=>{(0,e("hWRJP").logException)(t,{location:"editor-synced-block-provider/referenceSyncBlockStoreManager"}),this.fireAnalyticsEvent?.((0,e("cFpEg").fetchErrorPayload)(t.message))}),()=>{let e=this.subscriptions.get(t);e&&(this.isCacheDirty=!0,delete e[r],0===Object.keys(e).length?(this.subscriptions.delete(t),this.deleteFromCache(t)):this.subscriptions.set(t,e))}}subscribeToSourceTitle(e,t){if("syncBlock"!==e.type.name)return()=>{};let{resourceId:r,localId:o}=e.attrs;if(!o||!r)return()=>{};let i=this.getFromCache(r);i?.data?.sourceTitle&&t(i.data.sourceTitle);let n=this.titleSubscriptions.get(r)||{};return this.titleSubscriptions.set(r,{...n,[o]:t}),()=>{let e=this.titleSubscriptions.get(r);e&&(delete e[o],0===Object.keys(e).length?this.titleSubscriptions.delete(r):this.titleSubscriptions.set(r,e))}}subscribe(t,r){try{if("syncBlock"!==t.type.name)throw Error("Only sync block node subscriptions are supported");let{resourceId:e,localId:o}=t.attrs;if(!o||!e)throw Error("Missing local id or resource id");return this.subscribeToSyncBlock(e,o,r)}catch(t){return(0,e("hWRJP").logException)(t,{location:"editor-synced-block-provider/referenceSyncBlockStoreManager"}),this.fireAnalyticsEvent?.((0,e("cFpEg").fetchErrorPayload)(t.message)),()=>{}}}getSyncBlockURL(e){let t=this.getFromCache(e);if(t)return t.data?.sourceURL}getProviderFactory(t){if(!this.dataProvider){let t=Error("Data provider not set");(0,e("hWRJP").logException)(t,{location:"editor-synced-block-provider/referenceSyncBlockStoreManager"}),this.fireAnalyticsEvent?.((0,e("cFpEg").fetchErrorPayload)(t.message));return}let{parentDataProviders:r,providerCreator:o}=this.dataProvider.getSyncedBlockRendererProviderOptions(),i=this.providerFactories.get(t);if(i||(i=e("4FxUL").default.create({mentionProvider:r?.mentionProvider,profilecardProvider:r?.profilecardProvider,taskDecisionProvider:r?.taskDecisionProvider}),this.providerFactories.set(t,i)),o)try{this.retrieveDynamicProviders(t,i,o)}catch(t){(0,e("hWRJP").logException)(t,{location:"editor-synced-block-provider/referenceSyncBlockStoreManager"}),this.fireAnalyticsEvent?.((0,e("cFpEg").fetchErrorPayload)(t.message))}return i}retrieveDynamicProviders(t,r,o){if(!this.dataProvider)throw Error("Data provider not set");let i=r.hasProvider("mediaProvider"),n=r.hasProvider("emojiProvider");if(i&&n)return;let a=this.getFromCache(t);if(!a||!a.data?.sourceAri||!a.data?.product)return void this.fireAnalyticsEvent?.((0,e("cFpEg").fetchErrorPayload)("Sync block or source ari or product not found"));let c=this.dataProvider.retrieveSyncBlockParentInfo(a.data?.sourceAri,a.data?.product);if(!c)throw Error("Unable to retrive sync block parent info");let{contentId:s,contentProduct:l}=c;if(!i&&o.createMediaProvider&&s&&l){let e=o.createMediaProvider({contentProduct:l,contentId:s});e&&r.setProvider("mediaProvider",e)}if(!n&&o.createEmojiProvider&&s&&l){let e=o.createEmojiProvider({contentProduct:l,contentId:s});e&&r.setProvider("emojiProvider",e)}}async flush(){if(!this.isCacheDirty)return!0;let t=!0;try{if(!this.dataProvider)throw Error("Data provider not set");let r=[];if(Array.from(this.subscriptions.entries()).forEach(([e,t])=>{Object.keys(t).forEach(t=>{r.push({resourceId:e,localId:t})})}),0===r.length)return this.isCacheDirty=!1,!0;this.isCacheDirty=!1;let o=await this.dataProvider.updateReferenceData(r);o.success||(t=!1,this.fireAnalyticsEvent?.((0,e("cFpEg").updateReferenceErrorPayload)(o.error||"Failed to update reference synced blocks on the document")))}catch(r){t=!1,(0,e("hWRJP").logException)(r,{location:"editor-synced-block-provider/referenceSyncBlockStoreManager"}),this.fireAnalyticsEvent?.((0,e("cFpEg").updateReferenceErrorPayload)(r.message))}finally{t||(this.isCacheDirty=!0)}return t}destroy(){this.dataProvider=void 0,this.syncBlockCache.clear(),this.subscriptions.clear(),this.titleSubscriptions.clear(),this.syncBlockFetchDataRequests.clear(),this.syncBlockSourceInfoRequests.clear(),this.providerFactories.clear(),this.isRefreshingSubscriptions=!1,this.providerFactories.forEach(e=>{e.destroy()}),this.providerFactories.clear(),this.fireAnalyticsEvent=void 0}constructor(e,t){this.dataProvider=void 0,this.syncBlockCache=void 0,this.isCacheDirty=!0,this.subscriptions=void 0,this.titleSubscriptions=void 0,this.providerFactories=void 0,this.fireAnalyticsEvent=void 0,this.syncBlockFetchDataRequests=void 0,this.syncBlockSourceInfoRequests=void 0,this.isRefreshingSubscriptions=!1,this.syncBlockCache=new Map,this.subscriptions=new Map,this.titleSubscriptions=new Map,this.dataProvider=e,this.syncBlockFetchDataRequests=new Map,this.syncBlockSourceInfoRequests=new Map,this.providerFactories=new Map,this.fireAnalyticsEvent=t}}}),t("4wATI",function(t,r){t.exports.resolveSyncBlockInstance=(t,r)=>{if(!t.data)return r;if(!r.data)if(r.error===e("awHlv").SyncBlockError.NotFound||r.error===e("awHlv").SyncBlockError.Forbidden)return r;else return t;return{...r,data:{...r.data,sourceURL:r.data?.sourceURL||t.data?.sourceURL||void 0,sourceTitle:r.data?.sourceTitle||t.data?.sourceTitle||void 0}}}}),t("dBGrG",function(t,r){var o=e("dQl1W");t.exports.SourceSyncBlockStoreManager=class{isSourceBlock(e){return"bodiedSyncBlock"===e.type.name}updateSyncBlockData(t){try{if(!this.isSourceBlock(t))throw Error("Invalid sync block node type provided for updateSyncBlockData");let{localId:r,resourceId:o}=t.attrs;if(!r||!o)throw Error("Local ID or resource ID is not set");let i=(0,e("gtauf").convertSyncBlockPMNodeToSyncBlockData)(t);return this.syncBlockCache.set(o,{...i,isDirty:!0}),!0}catch(t){return(0,e("hWRJP").logException)(t,{location:"editor-synced-block-provider/sourceSyncBlockStoreManager"}),this.fireAnalyticsEvent?.((0,e("cFpEg").updateCacheErrorPayload)(t.message)),!1}}async flush(){try{if(!this.dataProvider)throw Error("Data provider not set");let t=[],r=[];if(Array.from(this.syncBlockCache.values()).forEach(e=>{!e.pendingDeletion&&e.isDirty&&(t.push({type:"bodiedSyncBlock",attrs:{localId:e.blockInstanceId,resourceId:e.resourceId}}),r.push(e),e.isDirty=!1)}),0===t.length)return Promise.resolve(!0);let o=await this.dataProvider.writeNodesData(t,r);if(o.forEach(t=>{if(t.resourceId&&t.error&&t.error!==e("awHlv").SyncBlockError.NotFound){let e=this.syncBlockCache.get(t.resourceId);e&&(e.isDirty=!0)}}),o.every(e=>e.resourceId&&!e.error))return!0;return o.filter(e=>!e.resourceId||e.error).forEach(t=>{this.fireAnalyticsEvent?.((0,e("cFpEg").updateErrorPayload)(t.error||"Failed to write data"))}),!1}catch(t){return(0,e("hWRJP").logException)(t,{location:"editor-synced-block-provider/sourceSyncBlockStoreManager"}),this.fireAnalyticsEvent?.((0,e("cFpEg").updateErrorPayload)(t.message)),!1}}registerPendingCreation(e){this.pendingResourceId=e}registerCreationCallback(e){this.creationCallback=e}commitPendingCreation(e){e&&this.creationCallback&&this.creationCallback(),this.pendingResourceId=void 0,this.creationCallback=void 0}hasPendingCreation(){return!!this.pendingResourceId}registerConfirmationCallback(e){return this.confirmationCallback=e,()=>{this.confirmationCallback=void 0}}requireConfirmationBeforeDelete(){return!!this.confirmationCallback}generateBodiedSyncBlockAttrs(){let e=(o&&o.__esModule?o.default:o)(),t=this.dataProvider?.getSourceId();if(!this.dataProvider||!t)throw Error("Data provider not set or source id not set");return{resourceId:this.dataProvider.generateResourceId(t,e),localId:e}}createBodiedSyncBlockNode(t){try{if(!this.dataProvider)throw Error("Data provider not set");let{resourceId:r,localId:o}=t;this.dataProvider.createNodeData({content:[],blockInstanceId:o,resourceId:r}).then(t=>{t.resourceId?this.commitPendingCreation(!0):(this.commitPendingCreation(!1),this.fireAnalyticsEvent?.((0,e("cFpEg").createErrorPayload)(t.error||"Failed to create bodied sync block")))}).catch(t=>{this.commitPendingCreation(!1),(0,e("hWRJP").logException)(t,{location:"editor-synced-block-provider/sourceSyncBlockStoreManager"}),this.fireAnalyticsEvent?.((0,e("cFpEg").createErrorPayload)(t.message))}),this.registerPendingCreation(r)}catch(t){this.hasPendingCreation()&&this.commitPendingCreation(!1),(0,e("hWRJP").logException)(t,{location:"editor-synced-block-provider/sourceSyncBlockStoreManager"}),this.fireAnalyticsEvent?.((0,e("cFpEg").createErrorPayload)(t.message))}}async delete(t,r,o){try{let i;if(!this.dataProvider)throw Error("Data provider not set");t.forEach(e=>{this.setPendingDeletion(e,!0)});let n=await this.dataProvider.deleteNodesData(t.map(e=>e.resourceId)),a=n.every(e=>e.success);return o(a),a?(r(),i=e=>this.syncBlockCache.delete(e.resourceId),this.clearPendingDeletion()):(i=e=>{this.setPendingDeletion(e,!1)},n.filter(e=>void 0===e.resourceId).forEach(t=>{this.fireAnalyticsEvent?.((0,e("cFpEg").deleteErrorPayload)(t.error||"Failed to delete synced block"))})),t.forEach(i),a}catch(r){return t.forEach(e=>{this.setPendingDeletion(e,!1)}),(0,e("hWRJP").logException)(r,{location:"editor-synced-block-provider/sourceSyncBlockStoreManager"}),this.fireAnalyticsEvent?.((0,e("cFpEg").deleteErrorPayload)(r.message)),o(!1),!1}}isRetryingDeletion(){return!!this.deletionRetryInfo}async retryDeletion(){if(!this.deletionRetryInfo)return Promise.resolve();let{syncBlockIds:e,onDelete:t,onDeleteCompleted:r}=this.deletionRetryInfo;this.confirmationCallback&&await this.delete(e,t,r)}clearPendingDeletion(){this.deletionRetryInfo?.destroyCallback(),this.deletionRetryInfo=void 0}async deleteSyncBlocksWithConfirmation(e,t,r,o){this.confirmationCallback&&(await this.confirmationCallback(e.length)?await this.delete(e,t,r)||(this.deletionRetryInfo={syncBlockIds:e,onDelete:t,onDeleteCompleted:r,destroyCallback:o}):o())}destroy(){this.syncBlockCache.clear(),this.confirmationCallback=void 0,this.pendingResourceId=void 0,this.creationCallback=void 0,this.dataProvider=void 0,this.clearPendingDeletion()}constructor(e,t){this.dataProvider=void 0,this.fireAnalyticsEvent=void 0,this.syncBlockCache=void 0,this.confirmationCallback=void 0,this.deletionRetryInfo=void 0,this.pendingResourceId=void 0,this.creationCallback=void 0,this.setPendingDeletion=(e,t)=>{let r=this.syncBlockCache.get(e.resourceId);r&&(r.pendingDeletion=t)},this.dataProvider=e,this.syncBlockCache=new Map,this.fireAnalyticsEvent=t}}}),t("a7tZV",function(t,r){var o=e("42omo");t.exports.useFetchSyncBlockData=(t,r,i,n)=>{let[a,c]=(0,o.useState)(()=>r?t?.referenceManager?.getInitialSyncBlockData(r)??null:null),[s,l]=(0,o.useState)(!0),d=(0,o.useCallback)(async()=>{if(!s){try{let o=r&&i?(0,e("gtauf").createSyncBlockNode)(i,r):null;if(!o)throw Error("Failed to create sync block node from resourceid and localid");l(!0),await t.referenceManager.fetchSyncBlocksData([o])}catch(t){(0,e("hWRJP").logException)(t,{location:"editor-synced-block-provider/useFetchSyncBlockData"}),n?.((0,e("cFpEg").fetchErrorPayload)(t.message)),c({resourceId:r||"",error:e("awHlv").SyncBlockError.Errored})}l(!1)}},[s,i,t.referenceManager,r,n]);return(0,o.useEffect)(()=>{let e=t.referenceManager.subscribeToSyncBlock(r||"",i||"",e=>{c(e),l(!1)});return()=>{e()}},[i,t.referenceManager,r]),{isLoading:s,providerFactory:t.referenceManager.getProviderFactory(r||""),reloadData:d,syncBlockInstance:a}}});
//# sourceMappingURL=CommentsPanelFilterMenu.006f4e95.js.map
